/*!
 * excalibur - 0.25.0-alpha.7657+d37f728 - 2020-12-21
 * https://github.com/excaliburjs/Excalibur
 * Copyright (c) 2020 Excalibur.js <https://github.com/excaliburjs/Excalibur/graphs/contributors>
 * Licensed BSD-2-Clause
 * @preserve
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ex=e():t.ex=e()}(window,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=181)}([function(t,e,i){var s=i(6),n=i(17).f,r=i(16),o=i(41),a=i(49),h=i(98),c=i(99);t.exports=function(t,e){var i,l,u,d,p,f=t.target,g=t.global,_=t.stat;if(i=g?s:_?s[f]||a(f,{}):(s[f]||{}).prototype)for(l in e){if(d=e[l],u=t.noTargetGet?(p=n(i,l))&&p.value:i[l],!c(g?l:f+(_?".":"#")+l,t.forced)&&void 0!==u){if(typeof d==typeof u)continue;h(d,u)}(t.sham||u&&u.sham)&&r(d,"sham",!0),o(i,l,d,t)}}},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,i){var s=i(1);t.exports=!s((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(t,e,i){var s=i(47);t.exports=function(t){return Object(s(t))}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,i){var s=i(6),n=i(50),r=i(10),o=i(38),a=i(55),h=i(66),c=n("wks"),l=s.Symbol,u=h?l:l&&l.withoutSetter||o;t.exports=function(t){return r(c,t)||(a&&r(l,t)?c[t]=l[t]:c[t]=u("Symbol."+t)),c[t]}},function(t,e,i){(function(e){var i=function(t){return t&&t.Math==Math&&t};t.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof e&&e)||function(){return this}()||Function("return this")()}).call(this,i(97))},function(t,e,i){var s=i(2),n=i(59),r=i(12),o=i(22),a=Object.defineProperty;e.f=s?a:function(t,e,i){if(r(t),e=o(e,!0),r(i),n)try{return a(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported");return"value"in i&&(t[e]=i.value),t}},function(t,e,i){var s=i(21),n=Math.min;t.exports=function(t){return t>0?n(s(t),9007199254740991):0}},function(t,e,i){var s=i(2),n=i(1),r=i(10),o=Object.defineProperty,a={},h=function(t){throw t};t.exports=function(t,e){if(r(a,t))return a[t];e||(e={});var i=[][t],c=!!r(e,"ACCESSORS")&&e.ACCESSORS,l=r(e,0)?e[0]:h,u=r(e,1)?e[1]:void 0;return a[t]=!!i&&!n((function(){if(c&&!s)return!0;var t={length:-1};c?o(t,1,{enumerable:!0,get:h}):t[1]=1,i.call(t,l,u)}))}},function(t,e){var i={}.hasOwnProperty;t.exports=function(t,e){return i.call(t,e)}},function(t,e,i){var s=i(28),n=i(47);t.exports=function(t){return s(n(t))}},function(t,e,i){var s=i(4);t.exports=function(t){if(!s(t))throw TypeError(String(t)+" is not an object");return t}},function(t,e,i){"use strict";var s=i(1);t.exports=function(t,e){var i=[][t];return!!i&&s((function(){i.call(null,e||function(){throw 1},1)}))}},function(t,e,i){var s=i(5),n=i(42),r=i(7),o=s("unscopables"),a=Array.prototype;null==a[o]&&r.f(a,o,{configurable:!0,value:n(null)}),t.exports=function(t){a[o][t]=!0}},function(t,e,i){var s=i(43),n=i(28),r=i(3),o=i(8),a=i(34),h=[].push,c=function(t){var e=1==t,i=2==t,c=3==t,l=4==t,u=6==t,d=7==t,p=5==t||u;return function(f,g,_,m){for(var y,w,v=r(f),b=n(v),x=s(g,_,3),A=o(b.length),P=0,S=m||a,E=e?S(f,A):i||d?S(f,0):void 0;A>P;P++)if((p||P in b)&&(w=x(y=b[P],P,v),t))if(e)E[P]=w;else if(w)switch(t){case 3:return!0;case 5:return y;case 6:return P;case 2:h.call(E,y)}else switch(t){case 4:return!1;case 7:h.call(E,y)}return u?-1:c||l?l:E}};t.exports={forEach:c(0),map:c(1),filter:c(2),some:c(3),every:c(4),find:c(5),findIndex:c(6),filterOut:c(7)}},function(t,e,i){var s=i(2),n=i(7),r=i(25);t.exports=s?function(t,e,i){return n.f(t,e,r(1,i))}:function(t,e,i){return t[e]=i,t}},function(t,e,i){var s=i(2),n=i(39),r=i(25),o=i(11),a=i(22),h=i(10),c=i(59),l=Object.getOwnPropertyDescriptor;e.f=s?l:function(t,e){if(t=o(t),e=a(e,!0),c)try{return l(t,e)}catch(t){}if(h(t,e))return r(!n.f.call(t,e),t[e])}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}},function(t,e,i){"use strict";var s=i(22),n=i(7),r=i(25);t.exports=function(t,e,i){var o=s(e);o in t?n.f(t,o,r(0,i)):t[o]=i}},function(t,e,i){var s=i(40);t.exports=Array.isArray||function(t){return"Array"==s(t)}},function(t,e){var i=Math.ceil,s=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?s:i)(t)}},function(t,e,i){var s=i(4);t.exports=function(t,e){if(!s(t))return t;var i,n;if(e&&"function"==typeof(i=t.toString)&&!s(n=i.call(t)))return n;if("function"==typeof(i=t.valueOf)&&!s(n=i.call(t)))return n;if(!e&&"function"==typeof(i=t.toString)&&!s(n=i.call(t)))return n;throw TypeError("Can't convert object to primitive value")}},function(t,e,i){var s=i(10),n=i(3),r=i(37),o=i(65),a=r("IE_PROTO"),h=Object.prototype;t.exports=o?Object.getPrototypeOf:function(t){return t=n(t),s(t,a)?t[a]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?h:null}},function(t,e,i){var s=i(7).f,n=i(10),r=i(5)("toStringTag");t.exports=function(t,e,i){t&&!n(t=i?t:t.prototype,r)&&s(t,r,{configurable:!0,value:e})}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){t.exports=!1},function(t,e){t.exports={}},function(t,e,i){var s=i(1),n=i(40),r="".split;t.exports=s((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==n(t)?r.call(t,""):Object(t)}:Object},function(t,e,i){var s=i(30),n=i(6),r=function(t){return"function"==typeof t?t:void 0};t.exports=function(t,e){return arguments.length<2?r(s[t])||r(n[t]):s[t]&&s[t][e]||n[t]&&n[t][e]}},function(t,e,i){var s=i(6);t.exports=s},function(t,e,i){var s=i(21),n=Math.max,r=Math.min;t.exports=function(t,e){var i=s(t);return i<0?n(i+e,0):r(i,e)}},function(t,e,i){var s=i(63),n=i(53);t.exports=Object.keys||function(t){return s(t,n)}},function(t,e){t.exports={}},function(t,e,i){var s=i(4),n=i(20),r=i(5)("species");t.exports=function(t,e){var i;return n(t)&&("function"!=typeof(i=t.constructor)||i!==Array&&!n(i.prototype)?s(i)&&null===(i=i[r])&&(i=void 0):i=void 0),new(void 0===i?Array:i)(0===e?0:e)}},function(t,e,i){var s=i(1),n=i(5),r=i(44),o=n("species");t.exports=function(t){return r>=51||!s((function(){var e=[];return(e.constructor={})[o]=function(){return{foo:1}},1!==e[t](Boolean).foo}))}},function(t,e,i){var s,n,r,o=i(96),a=i(6),h=i(4),c=i(16),l=i(10),u=i(48),d=i(37),p=i(27),f=a.WeakMap;if(o){var g=u.state||(u.state=new f),_=g.get,m=g.has,y=g.set;s=function(t,e){return e.facade=t,y.call(g,t,e),e},n=function(t){return _.call(g,t)||{}},r=function(t){return m.call(g,t)}}else{var w=d("state");p[w]=!0,s=function(t,e){return e.facade=t,c(t,w,e),e},n=function(t){return l(t,w)?t[w]:{}},r=function(t){return l(t,w)}}t.exports={set:s,get:n,has:r,enforce:function(t){return r(t)?n(t):s(t,{})},getterFor:function(t){return function(e){var i;if(!h(e)||(i=n(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return i}}}},function(t,e,i){var s=i(50),n=i(38),r=s("keys");t.exports=function(t){return r[t]||(r[t]=n(t))}},function(t,e){var i=0,s=Math.random();t.exports=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++i+s).toString(36)}},function(t,e,i){"use strict";var s={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,r=n&&!s.call({1:2},1);e.f=r?function(t){var e=n(this,t);return!!e&&e.enumerable}:s},function(t,e){var i={}.toString;t.exports=function(t){return i.call(t).slice(8,-1)}},function(t,e,i){var s=i(6),n=i(16),r=i(10),o=i(49),a=i(58),h=i(36),c=h.get,l=h.enforce,u=String(String).split("String");(t.exports=function(t,e,i,a){var h,c=!!a&&!!a.unsafe,d=!!a&&!!a.enumerable,p=!!a&&!!a.noTargetGet;"function"==typeof i&&("string"!=typeof e||r(i,"name")||n(i,"name",e),(h=l(i)).source||(h.source=u.join("string"==typeof e?e:""))),t!==s?(c?!p&&t[e]&&(d=!0):delete t[e],d?t[e]=i:n(t,e,i)):d?t[e]=i:o(e,i)})(Function.prototype,"toString",(function(){return"function"==typeof this&&c(this).source||a(this)}))},function(t,e,i){var s,n=i(12),r=i(67),o=i(53),a=i(27),h=i(101),c=i(60),l=i(37),u=l("IE_PROTO"),d=function(){},p=function(t){return"<script>"+t+"<\/script>"},f=function(){try{s=document.domain&&new ActiveXObject("htmlfile")}catch(t){}var t,e;f=s?function(t){t.write(p("")),t.close();var e=t.parentWindow.Object;return t=null,e}(s):((e=c("iframe")).style.display="none",h.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(p("document.F=Object")),t.close(),t.F);for(var i=o.length;i--;)delete f.prototype[o[i]];return f()};a[u]=!0,t.exports=Object.create||function(t,e){var i;return null!==t?(d.prototype=n(t),i=new d,d.prototype=null,i[u]=t):i=f(),void 0===e?i:r(i,e)}},function(t,e,i){var s=i(18);t.exports=function(t,e,i){if(s(t),void 0===e)return t;switch(i){case 0:return function(){return t.call(e)};case 1:return function(i){return t.call(e,i)};case 2:return function(i,s){return t.call(e,i,s)};case 3:return function(i,s,n){return t.call(e,i,s,n)}}return function(){return t.apply(e,arguments)}}},function(t,e,i){var s,n,r=i(6),o=i(110),a=r.process,h=a&&a.versions,c=h&&h.v8;c?n=(s=c.split("."))[0]+s[1]:o&&(!(s=o.match(/Edge\/(\d+)/))||s[1]>=74)&&(s=o.match(/Chrome\/(\d+)/))&&(n=s[1]),t.exports=n&&+n},function(t,e,i){var s=i(1);t.exports=!s((function(){return Object.isExtensible(Object.preventExtensions({}))}))},function(t,e,i){"use strict";var s=i(26),n=i(6),r=i(1);t.exports=s||!r((function(){var t=Math.random();__defineSetter__.call(null,t,(function(){})),delete n[t]}))},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t}},function(t,e,i){var s=i(6),n=i(49),r=s["__core-js_shared__"]||n("__core-js_shared__",{});t.exports=r},function(t,e,i){var s=i(6),n=i(16);t.exports=function(t,e){try{n(s,t,e)}catch(i){s[t]=e}return e}},function(t,e,i){var s=i(26),n=i(48);(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.8.0",mode:s?"pure":"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})},function(t,e,i){var s=i(63),n=i(53).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return s(t,n)}},function(t,e,i){var s=i(11),n=i(8),r=i(31),o=function(t){return function(e,i,o){var a,h=s(e),c=n(h.length),l=r(o,c);if(t&&i!=i){for(;c>l;)if((a=h[l++])!=a)return!0}else for(;c>l;l++)if((t||l in h)&&h[l]===i)return t||l||0;return!t&&-1}};t.exports={includes:o(!0),indexOf:o(!1)}},function(t,e){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,i){var s=i(1);t.exports=!!Object.getOwnPropertySymbols&&!s((function(){return!String(Symbol())}))},function(t,e,i){var s={};s[i(5)("toStringTag")]="z",t.exports="[object z]"===String(s)},function(t,e,i){var s=i(27),n=i(4),r=i(10),o=i(7).f,a=i(38),h=i(45),c=a("meta"),l=0,u=Object.isExtensible||function(){return!0},d=function(t){o(t,c,{value:{objectID:"O"+ ++l,weakData:{}}})},p=t.exports={REQUIRED:!1,fastKey:function(t,e){if(!n(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!r(t,c)){if(!u(t))return"F";if(!e)return"E";d(t)}return t[c].objectID},getWeakData:function(t,e){if(!r(t,c)){if(!u(t))return!0;if(!e)return!1;d(t)}return t[c].weakData},onFreeze:function(t){return h&&p.REQUIRED&&u(t)&&!r(t,c)&&d(t),t}};s[c]=!0},function(t,e,i){var s=i(48),n=Function.toString;"function"!=typeof s.inspectSource&&(s.inspectSource=function(t){return n.call(t)}),t.exports=s.inspectSource},function(t,e,i){var s=i(2),n=i(1),r=i(60);t.exports=!s&&!n((function(){return 7!=Object.defineProperty(r("div"),"a",{get:function(){return 7}}).a}))},function(t,e,i){var s=i(6),n=i(4),r=s.document,o=n(r)&&n(r.createElement);t.exports=function(t){return o?r.createElement(t):{}}},function(t,e,i){"use strict";var s=i(0),n=i(100),r=i(23),o=i(68),a=i(24),h=i(16),c=i(41),l=i(5),u=i(26),d=i(33),p=i(64),f=p.IteratorPrototype,g=p.BUGGY_SAFARI_ITERATORS,_=l("iterator"),m=function(){return this};t.exports=function(t,e,i,l,p,y,w){n(i,e,l);var v,b,x,A=function(t){if(t===p&&T)return T;if(!g&&t in E)return E[t];switch(t){case"keys":case"values":case"entries":return function(){return new i(this,t)}}return function(){return new i(this)}},P=e+" Iterator",S=!1,E=t.prototype,C=E[_]||E["@@iterator"]||p&&E[p],T=!g&&C||A(p),M="Array"==e&&E.entries||C;if(M&&(v=r(M.call(new t)),f!==Object.prototype&&v.next&&(u||r(v)===f||(o?o(v,f):"function"!=typeof v[_]&&h(v,_,m)),a(v,P,!0,!0),u&&(d[P]=m))),"values"==p&&C&&"values"!==C.name&&(S=!0,T=function(){return C.call(this)}),u&&!w||E[_]===T||h(E,_,T),d[e]=T,p)if(b={values:A("values"),keys:y?T:A("keys"),entries:A("entries")},w)for(x in b)!g&&!S&&x in E||c(E,x,b[x]);else s({target:e,proto:!0,forced:g||S},b);return b}},function(t,e,i){var s=i(29),n=i(51),r=i(54),o=i(12);t.exports=s("Reflect","ownKeys")||function(t){var e=n.f(o(t)),i=r.f;return i?e.concat(i(t)):e}},function(t,e,i){var s=i(10),n=i(11),r=i(52).indexOf,o=i(27);t.exports=function(t,e){var i,a=n(t),h=0,c=[];for(i in a)!s(o,i)&&s(a,i)&&c.push(i);for(;e.length>h;)s(a,i=e[h++])&&(~r(c,i)||c.push(i));return c}},function(t,e,i){"use strict";var s,n,r,o=i(23),a=i(16),h=i(10),c=i(5),l=i(26),u=c("iterator"),d=!1;[].keys&&("next"in(r=[].keys())?(n=o(o(r)))!==Object.prototype&&(s=n):d=!0),null==s&&(s={}),l||h(s,u)||a(s,u,(function(){return this})),t.exports={IteratorPrototype:s,BUGGY_SAFARI_ITERATORS:d}},function(t,e,i){var s=i(1);t.exports=!s((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},function(t,e,i){var s=i(55);t.exports=s&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(t,e,i){var s=i(2),n=i(7),r=i(12),o=i(32);t.exports=s?Object.defineProperties:function(t,e){r(t);for(var i,s=o(e),a=s.length,h=0;a>h;)n.f(t,i=s[h++],e[i]);return t}},function(t,e,i){var s=i(12),n=i(102);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,i={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(i,[]),e=i instanceof Array}catch(t){}return function(i,r){return s(i),n(r),e?t.call(i,r):i.__proto__=r,i}}():void 0)},function(t,e,i){var s=i(12);t.exports=function(t){var e=t.return;if(void 0!==e)return s(e.call(t)).value}},function(t,e,i){var s=i(5),n=i(33),r=s("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(n.Array===t||o[r]===t)}},function(t,e,i){var s=i(72),n=i(33),r=i(5)("iterator");t.exports=function(t){if(null!=t)return t[r]||t["@@iterator"]||n[s(t)]}},function(t,e,i){var s=i(56),n=i(40),r=i(5)("toStringTag"),o="Arguments"==n(function(){return arguments}());t.exports=s?n:function(t){var e,i,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),r))?i:o?n(e):"Object"==(s=n(e))&&"function"==typeof e.callee?"Arguments":s}},function(t,e,i){"use strict";var s=i(20),n=i(8),r=i(43),o=function(t,e,i,a,h,c,l,u){for(var d,p=h,f=0,g=!!l&&r(l,u,3);f<a;){if(f in i){if(d=g?g(i[f],f,e):i[f],c>0&&s(d))p=o(t,e,d,n(d.length),p,c-1)-1;else{if(p>=9007199254740991)throw TypeError("Exceed the acceptable array length");t[p]=d}p++}f++}return p};t.exports=o},function(t,e,i){var s=i(18),n=i(3),r=i(28),o=i(8),a=function(t){return function(e,i,a,h){s(i);var c=n(e),l=r(c),u=o(c.length),d=t?u-1:0,p=t?-1:1;if(a<2)for(;;){if(d in l){h=l[d],d+=p;break}if(d+=p,t?d<0:u<=d)throw TypeError("Reduce of empty array with no initial value")}for(;t?d>=0:u>d;d+=p)d in l&&(h=i(h,l[d],d,c));return h}};t.exports={left:a(!1),right:a(!0)}},function(t,e,i){var s=i(40),n=i(6);t.exports="process"==s(n.process)},function(t,e,i){var s=i(11),n=i(51).f,r={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return o&&"[object Window]"==r.call(t)?function(t){try{return n(t)}catch(t){return o.slice()}}(t):n(s(t))}},function(t,e,i){var s=i(5);e.f=s},function(t,e,i){var s=i(2),n=i(32),r=i(11),o=i(39).f,a=function(t){return function(e){for(var i,a=r(e),h=n(a),c=h.length,l=0,u=[];c>l;)i=h[l++],s&&!o.call(a,i)||u.push(t?[i,a[i]]:a[i]);return u}};t.exports={entries:a(!0),values:a(!1)}},function(t,e,i){"use strict";var s=i(80),n=i.n(s)()(!0);n.push([t.i,"/* Buttons styles start */\n\nbutton#excalibur-play {\n  display: inline-block;\n  position: relative;\n  z-index: 999;\n  border-radius: 6px;\n  border: none;\n  /*border: 3px solid;\n    border-color: white;\n    box-shadow: 0 0 10px #ccc;*/\n  padding: 1rem 1.5rem 1rem 4rem;\n  margin: 0;\n  text-decoration: none;\n  background: #00b233;\n  color: #ffffff;\n  font-family: sans-serif;\n  font-size: 2rem;\n  line-height: 1;\n  cursor: pointer;\n  text-align: center;\n  transition: background 250ms ease-in-out, transform 150ms ease;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\n  animation: excalibur-button-fadein 200ms;\n}\n\n/*\nbutton#excalibur-play {\n  display: none;\n}*/\n\nbutton#excalibur-play:after {\n  position: absolute;\n  content: '';\n  border: 8px solid;\n  border-color: transparent transparent transparent white;\n  left: 35px;\n  top: 24px;\n  width: 0;\n  height: 0;\n}\n\nbutton#excalibur-play:before {\n  position: absolute;\n  content: '';\n  border: 3px solid;\n  left: 19px;\n  top: 14px;\n  border-radius: 20px;\n  width: 30px;\n  height: 30px;\n}\n\nbutton#excalibur-play:hover,\nbutton#excalibur-play:focus {\n  background: #00982c;\n}\n\nbutton#excalibur-play:focus {\n  outline: 1px solid #fff;\n  outline-offset: -4px;\n}\n\nbutton#excalibur-play:active {\n  transform: scale(0.99);\n}\n\n@keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Firefox < 16 */\n@-moz-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Safari, Chrome and Opera > 12.1 */\n@-webkit-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Internet Explorer */\n@-ms-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Opera < 12.1 */\n@-o-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n","",{version:3,sources:["webpack://Loader.css"],names:[],mappings:"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB,8DAA8D;EAC9D,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF",sourcesContent:["/* Buttons styles start */\n\nbutton#excalibur-play {\n  display: inline-block;\n  position: relative;\n  z-index: 999;\n  border-radius: 6px;\n  border: none;\n  /*border: 3px solid;\n    border-color: white;\n    box-shadow: 0 0 10px #ccc;*/\n  padding: 1rem 1.5rem 1rem 4rem;\n  margin: 0;\n  text-decoration: none;\n  background: #00b233;\n  color: #ffffff;\n  font-family: sans-serif;\n  font-size: 2rem;\n  line-height: 1;\n  cursor: pointer;\n  text-align: center;\n  transition: background 250ms ease-in-out, transform 150ms ease;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\n  animation: excalibur-button-fadein 200ms;\n}\n\n/*\nbutton#excalibur-play {\n  display: none;\n}*/\n\nbutton#excalibur-play:after {\n  position: absolute;\n  content: '';\n  border: 8px solid;\n  border-color: transparent transparent transparent white;\n  left: 35px;\n  top: 24px;\n  width: 0;\n  height: 0;\n}\n\nbutton#excalibur-play:before {\n  position: absolute;\n  content: '';\n  border: 3px solid;\n  left: 19px;\n  top: 14px;\n  border-radius: 20px;\n  width: 30px;\n  height: 30px;\n}\n\nbutton#excalibur-play:hover,\nbutton#excalibur-play:focus {\n  background: #00982c;\n}\n\nbutton#excalibur-play:focus {\n  outline: 1px solid #fff;\n  outline-offset: -4px;\n}\n\nbutton#excalibur-play:active {\n  transform: scale(0.99);\n}\n\n@keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Firefox < 16 */\n@-moz-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Safari, Chrome and Opera > 12.1 */\n@-webkit-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Internet Explorer */\n@-ms-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Opera < 12.1 */\n@-o-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n"],sourceRoot:""}]),e.a=n},function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",s=t[3];if(!s)return i;if(e&&"function"==typeof btoa){var n=(o=s,a=btoa(unescape(encodeURIComponent(JSON.stringify(o)))),h="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(h," */")),r=s.sources.map((function(t){return"/*# sourceURL=".concat(s.sourceRoot||"").concat(t," */")}));return[i].concat(r).concat([n]).join("\n")}var o,a,h;return[i].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(i,"}"):i})).join("")},e.i=function(t,i,s){"string"==typeof t&&(t=[[null,t,""]]);var n={};if(s)for(var r=0;r<this.length;r++){var o=this[r][0];null!=o&&(n[o]=!0)}for(var a=0;a<t.length;a++){var h=[].concat(t[a]);s&&n[h[0]]||(i&&(h[2]?h[2]="".concat(i," and ").concat(h[2]):h[2]=i),e.push(h))}},e}},,,,,,,,,,,,,function(t,e,i){i(94),i(103),i(107),i(108),i(109),i(111),i(113),i(114),i(116),i(117),i(118),i(119),i(120),i(121),i(123),i(124),i(125),i(126),i(127),i(129),i(130),i(131),i(132),i(133),i(134),i(135),i(136),i(138),i(139),i(140);var s=i(30);t.exports=s.Array},function(t,e,i){"use strict";var s=i(95).charAt,n=i(36),r=i(61),o=n.set,a=n.getterFor("String Iterator");r(String,"String",(function(t){o(this,{type:"String Iterator",string:String(t),index:0})}),(function(){var t,e=a(this),i=e.string,n=e.index;return n>=i.length?{value:void 0,done:!0}:(t=s(i,n),e.index+=t.length,{value:t,done:!1})}))},function(t,e,i){var s=i(21),n=i(47),r=function(t){return function(e,i){var r,o,a=String(n(e)),h=s(i),c=a.length;return h<0||h>=c?t?"":void 0:(r=a.charCodeAt(h))<55296||r>56319||h+1===c||(o=a.charCodeAt(h+1))<56320||o>57343?t?a.charAt(h):r:t?a.slice(h,h+2):o-56320+(r-55296<<10)+65536}};t.exports={codeAt:r(!1),charAt:r(!0)}},function(t,e,i){var s=i(6),n=i(58),r=s.WeakMap;t.exports="function"==typeof r&&/native code/.test(n(r))},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){var s=i(10),n=i(62),r=i(17),o=i(7);t.exports=function(t,e){for(var i=n(e),a=o.f,h=r.f,c=0;c<i.length;c++){var l=i[c];s(t,l)||a(t,l,h(e,l))}}},function(t,e,i){var s=i(1),n=/#|\.prototype\./,r=function(t,e){var i=a[o(t)];return i==c||i!=h&&("function"==typeof e?s(e):!!e)},o=r.normalize=function(t){return String(t).replace(n,".").toLowerCase()},a=r.data={},h=r.NATIVE="N",c=r.POLYFILL="P";t.exports=r},function(t,e,i){"use strict";var s=i(64).IteratorPrototype,n=i(42),r=i(25),o=i(24),a=i(33),h=function(){return this};t.exports=function(t,e,i){var c=e+" Iterator";return t.prototype=n(s,{next:r(1,i)}),o(t,c,!1,!0),a[c]=h,t}},function(t,e,i){var s=i(29);t.exports=s("document","documentElement")},function(t,e,i){var s=i(4);t.exports=function(t){if(!s(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype");return t}},function(t,e,i){var s=i(0),n=i(104);s({target:"Array",stat:!0,forced:!i(106)((function(t){Array.from(t)}))},{from:n})},function(t,e,i){"use strict";var s=i(43),n=i(3),r=i(105),o=i(70),a=i(8),h=i(19),c=i(71);t.exports=function(t){var e,i,l,u,d,p,f=n(t),g="function"==typeof this?this:Array,_=arguments.length,m=_>1?arguments[1]:void 0,y=void 0!==m,w=c(f),v=0;if(y&&(m=s(m,_>2?arguments[2]:void 0,2)),null==w||g==Array&&o(w))for(i=new g(e=a(f.length));e>v;v++)p=y?m(f[v],v):f[v],h(i,v,p);else for(d=(u=w.call(f)).next,i=new g;!(l=d.call(u)).done;v++)p=y?r(u,m,[l.value,v],!0):l.value,h(i,v,p);return i.length=v,i}},function(t,e,i){var s=i(12),n=i(69);t.exports=function(t,e,i,r){try{return r?e(s(i)[0],i[1]):e(i)}catch(e){throw n(t),e}}},function(t,e,i){var s=i(5)("iterator"),n=!1;try{var r=0,o={next:function(){return{done:!!r++}},return:function(){n=!0}};o[s]=function(){return this},Array.from(o,(function(){throw 2}))}catch(t){}t.exports=function(t,e){if(!e&&!n)return!1;var i=!1;try{var r={};r[s]=function(){return{next:function(){return{done:i=!0}}}},t(r)}catch(t){}return i}},function(t,e,i){i(0)({target:"Array",stat:!0},{isArray:i(20)})},function(t,e,i){"use strict";var s=i(0),n=i(1),r=i(19);s({target:"Array",stat:!0,forced:n((function(){function t(){}return!(Array.of.call(t)instanceof t)}))},{of:function(){for(var t=0,e=arguments.length,i=new("function"==typeof this?this:Array)(e);e>t;)r(i,t,arguments[t++]);return i.length=e,i}})},function(t,e,i){"use strict";var s=i(0),n=i(1),r=i(20),o=i(4),a=i(3),h=i(8),c=i(19),l=i(34),u=i(35),d=i(5),p=i(44),f=d("isConcatSpreadable"),g=p>=51||!n((function(){var t=[];return t[f]=!1,t.concat()[0]!==t})),_=u("concat"),m=function(t){if(!o(t))return!1;var e=t[f];return void 0!==e?!!e:r(t)};s({target:"Array",proto:!0,forced:!g||!_},{concat:function(t){var e,i,s,n,r,o=a(this),u=l(o,0),d=0;for(e=-1,s=arguments.length;e<s;e++)if(r=-1===e?o:arguments[e],m(r)){if(d+(n=h(r.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(i=0;i<n;i++,d++)i in r&&c(u,d,r[i])}else{if(d>=9007199254740991)throw TypeError("Maximum allowed index exceeded");c(u,d++,r)}return u.length=d,u}})},function(t,e,i){var s=i(29);t.exports=s("navigator","userAgent")||""},function(t,e,i){var s=i(0),n=i(112),r=i(14);s({target:"Array",proto:!0},{copyWithin:n}),r("copyWithin")},function(t,e,i){"use strict";var s=i(3),n=i(31),r=i(8),o=Math.min;t.exports=[].copyWithin||function(t,e){var i=s(this),a=r(i.length),h=n(t,a),c=n(e,a),l=arguments.length>2?arguments[2]:void 0,u=o((void 0===l?a:n(l,a))-c,a-h),d=1;for(c<h&&h<c+u&&(d=-1,c+=u-1,h+=u-1);u-- >0;)c in i?i[h]=i[c]:delete i[h],h+=d,c+=d;return i}},function(t,e,i){"use strict";var s=i(0),n=i(15).every,r=i(13),o=i(9),a=r("every"),h=o("every");s({target:"Array",proto:!0,forced:!a||!h},{every:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,i){var s=i(0),n=i(115),r=i(14);s({target:"Array",proto:!0},{fill:n}),r("fill")},function(t,e,i){"use strict";var s=i(3),n=i(31),r=i(8);t.exports=function(t){for(var e=s(this),i=r(e.length),o=arguments.length,a=n(o>1?arguments[1]:void 0,i),h=o>2?arguments[2]:void 0,c=void 0===h?i:n(h,i);c>a;)e[a++]=t;return e}},function(t,e,i){"use strict";var s=i(0),n=i(15).filter,r=i(35),o=i(9),a=r("filter"),h=o("filter");s({target:"Array",proto:!0,forced:!a||!h},{filter:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,i){"use strict";var s=i(0),n=i(15).find,r=i(14),o=i(9),a=!0,h=o("find");"find"in[]&&Array(1).find((function(){a=!1})),s({target:"Array",proto:!0,forced:a||!h},{find:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),r("find")},function(t,e,i){"use strict";var s=i(0),n=i(15).findIndex,r=i(14),o=i(9),a=!0,h=o("findIndex");"findIndex"in[]&&Array(1).findIndex((function(){a=!1})),s({target:"Array",proto:!0,forced:a||!h},{findIndex:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),r("findIndex")},function(t,e,i){"use strict";var s=i(0),n=i(73),r=i(3),o=i(8),a=i(21),h=i(34);s({target:"Array",proto:!0},{flat:function(){var t=arguments.length?arguments[0]:void 0,e=r(this),i=o(e.length),s=h(e,0);return s.length=n(s,e,e,i,0,void 0===t?1:a(t)),s}})},function(t,e,i){"use strict";var s=i(0),n=i(73),r=i(3),o=i(8),a=i(18),h=i(34);s({target:"Array",proto:!0},{flatMap:function(t){var e,i=r(this),s=o(i.length);return a(t),(e=h(i,0)).length=n(e,i,i,s,0,1,t,arguments.length>1?arguments[1]:void 0),e}})},function(t,e,i){"use strict";var s=i(0),n=i(122);s({target:"Array",proto:!0,forced:[].forEach!=n},{forEach:n})},function(t,e,i){"use strict";var s=i(15).forEach,n=i(13),r=i(9),o=n("forEach"),a=r("forEach");t.exports=o&&a?[].forEach:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}},function(t,e,i){"use strict";var s=i(0),n=i(52).includes,r=i(14);s({target:"Array",proto:!0,forced:!i(9)("indexOf",{ACCESSORS:!0,1:0})},{includes:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),r("includes")},function(t,e,i){"use strict";var s=i(0),n=i(52).indexOf,r=i(13),o=i(9),a=[].indexOf,h=!!a&&1/[1].indexOf(1,-0)<0,c=r("indexOf"),l=o("indexOf",{ACCESSORS:!0,1:0});s({target:"Array",proto:!0,forced:h||!c||!l},{indexOf:function(t){return h?a.apply(this,arguments)||0:n(this,t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,i){"use strict";var s=i(11),n=i(14),r=i(33),o=i(36),a=i(61),h=o.set,c=o.getterFor("Array Iterator");t.exports=a(Array,"Array",(function(t,e){h(this,{type:"Array Iterator",target:s(t),index:0,kind:e})}),(function(){var t=c(this),e=t.target,i=t.kind,s=t.index++;return!e||s>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==i?{value:s,done:!1}:"values"==i?{value:e[s],done:!1}:{value:[s,e[s]],done:!1}}),"values"),r.Arguments=r.Array,n("keys"),n("values"),n("entries")},function(t,e,i){"use strict";var s=i(0),n=i(28),r=i(11),o=i(13),a=[].join,h=n!=Object,c=o("join",",");s({target:"Array",proto:!0,forced:h||!c},{join:function(t){return a.call(r(this),void 0===t?",":t)}})},function(t,e,i){var s=i(0),n=i(128);s({target:"Array",proto:!0,forced:n!==[].lastIndexOf},{lastIndexOf:n})},function(t,e,i){"use strict";var s=i(11),n=i(21),r=i(8),o=i(13),a=i(9),h=Math.min,c=[].lastIndexOf,l=!!c&&1/[1].lastIndexOf(1,-0)<0,u=o("lastIndexOf"),d=a("indexOf",{ACCESSORS:!0,1:0}),p=l||!u||!d;t.exports=p?function(t){if(l)return c.apply(this,arguments)||0;var e=s(this),i=r(e.length),o=i-1;for(arguments.length>1&&(o=h(o,n(arguments[1]))),o<0&&(o=i+o);o>=0;o--)if(o in e&&e[o]===t)return o||0;return-1}:c},function(t,e,i){"use strict";var s=i(0),n=i(15).map,r=i(35),o=i(9),a=r("map"),h=o("map");s({target:"Array",proto:!0,forced:!a||!h},{map:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,i){"use strict";var s=i(0),n=i(74).left,r=i(13),o=i(9),a=i(44),h=i(75),c=r("reduce"),l=o("reduce",{1:0});s({target:"Array",proto:!0,forced:!c||!l||!h&&a>79&&a<83},{reduce:function(t){return n(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}})},function(t,e,i){"use strict";var s=i(0),n=i(74).right,r=i(13),o=i(9),a=i(44),h=i(75),c=r("reduceRight"),l=o("reduce",{1:0});s({target:"Array",proto:!0,forced:!c||!l||!h&&a>79&&a<83},{reduceRight:function(t){return n(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}})},function(t,e,i){"use strict";var s=i(0),n=i(20),r=[].reverse,o=[1,2];s({target:"Array",proto:!0,forced:String(o)===String(o.reverse())},{reverse:function(){return n(this)&&(this.length=this.length),r.call(this)}})},function(t,e,i){"use strict";var s=i(0),n=i(4),r=i(20),o=i(31),a=i(8),h=i(11),c=i(19),l=i(5),u=i(35),d=i(9),p=u("slice"),f=d("slice",{ACCESSORS:!0,0:0,1:2}),g=l("species"),_=[].slice,m=Math.max;s({target:"Array",proto:!0,forced:!p||!f},{slice:function(t,e){var i,s,l,u=h(this),d=a(u.length),p=o(t,d),f=o(void 0===e?d:e,d);if(r(u)&&("function"!=typeof(i=u.constructor)||i!==Array&&!r(i.prototype)?n(i)&&null===(i=i[g])&&(i=void 0):i=void 0,i===Array||void 0===i))return _.call(u,p,f);for(s=new(void 0===i?Array:i)(m(f-p,0)),l=0;p<f;p++,l++)p in u&&c(s,l,u[p]);return s.length=l,s}})},function(t,e,i){"use strict";var s=i(0),n=i(15).some,r=i(13),o=i(9),a=r("some"),h=o("some");s({target:"Array",proto:!0,forced:!a||!h},{some:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,i){"use strict";var s=i(0),n=i(18),r=i(3),o=i(1),a=i(13),h=[],c=h.sort,l=o((function(){h.sort(void 0)})),u=o((function(){h.sort(null)})),d=a("sort");s({target:"Array",proto:!0,forced:l||!u||!d},{sort:function(t){return void 0===t?c.call(r(this)):c.call(r(this),n(t))}})},function(t,e,i){i(137)("Array")},function(t,e,i){"use strict";var s=i(29),n=i(7),r=i(5),o=i(2),a=r("species");t.exports=function(t){var e=s(t),i=n.f;o&&e&&!e[a]&&i(e,a,{configurable:!0,get:function(){return this}})}},function(t,e,i){"use strict";var s=i(0),n=i(31),r=i(21),o=i(8),a=i(3),h=i(34),c=i(19),l=i(35),u=i(9),d=l("splice"),p=u("splice",{ACCESSORS:!0,0:0,1:2}),f=Math.max,g=Math.min;s({target:"Array",proto:!0,forced:!d||!p},{splice:function(t,e){var i,s,l,u,d,p,_=a(this),m=o(_.length),y=n(t,m),w=arguments.length;if(0===w?i=s=0:1===w?(i=0,s=m-y):(i=w-2,s=g(f(r(e),0),m-y)),m+i-s>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(l=h(_,s),u=0;u<s;u++)(d=y+u)in _&&c(l,u,_[d]);if(l.length=s,i<s){for(u=y;u<m-s;u++)p=u+i,(d=u+s)in _?_[p]=_[d]:delete _[p];for(u=m;u>m-s+i;u--)delete _[u-1]}else if(i>s)for(u=m-s;u>y;u--)p=u+i-1,(d=u+s-1)in _?_[p]=_[d]:delete _[p];for(u=0;u<i;u++)_[u+y]=arguments[u+2];return _.length=m-s+i,l}})},function(t,e,i){i(14)("flat")},function(t,e,i){i(14)("flatMap")},function(t,e,i){i(142),i(144),i(146),i(147),i(148),i(149),i(150),i(151),i(153),i(154),i(155),i(156),i(157),i(159),i(160),i(161),i(162),i(163),i(164),i(165),i(166),i(167),i(169),i(170),i(171),i(172),i(173),i(174),i(175);var s=i(30);t.exports=s.Object},function(t,e,i){"use strict";var s=i(0),n=i(6),r=i(29),o=i(26),a=i(2),h=i(55),c=i(66),l=i(1),u=i(10),d=i(20),p=i(4),f=i(12),g=i(3),_=i(11),m=i(22),y=i(25),w=i(42),v=i(32),b=i(51),x=i(76),A=i(54),P=i(17),S=i(7),E=i(39),C=i(16),T=i(41),M=i(50),B=i(37),D=i(27),R=i(38),k=i(5),O=i(77),F=i(143),I=i(24),L=i(36),U=i(15).forEach,z=B("hidden"),N=k("toPrimitive"),W=L.set,H=L.getterFor("Symbol"),j=Object.prototype,q=n.Symbol,K=r("JSON","stringify"),V=P.f,G=S.f,X=x.f,Q=E.f,Z=M("symbols"),Y=M("op-symbols"),J=M("string-to-symbol-registry"),$=M("symbol-to-string-registry"),tt=M("wks"),et=n.QObject,it=!et||!et.prototype||!et.prototype.findChild,st=a&&l((function(){return 7!=w(G({},"a",{get:function(){return G(this,"a",{value:7}).a}})).a}))?function(t,e,i){var s=V(j,e);s&&delete j[e],G(t,e,i),s&&t!==j&&G(j,e,s)}:G,nt=function(t,e){var i=Z[t]=w(q.prototype);return W(i,{type:"Symbol",tag:t,description:e}),a||(i.description=e),i},rt=c?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof q},ot=function(t,e,i){t===j&&ot(Y,e,i),f(t);var s=m(e,!0);return f(i),u(Z,s)?(i.enumerable?(u(t,z)&&t[z][s]&&(t[z][s]=!1),i=w(i,{enumerable:y(0,!1)})):(u(t,z)||G(t,z,y(1,{})),t[z][s]=!0),st(t,s,i)):G(t,s,i)},at=function(t,e){f(t);var i=_(e),s=v(i).concat(ut(i));return U(s,(function(e){a&&!ht.call(i,e)||ot(t,e,i[e])})),t},ht=function(t){var e=m(t,!0),i=Q.call(this,e);return!(this===j&&u(Z,e)&&!u(Y,e))&&(!(i||!u(this,e)||!u(Z,e)||u(this,z)&&this[z][e])||i)},ct=function(t,e){var i=_(t),s=m(e,!0);if(i!==j||!u(Z,s)||u(Y,s)){var n=V(i,s);return!n||!u(Z,s)||u(i,z)&&i[z][s]||(n.enumerable=!0),n}},lt=function(t){var e=X(_(t)),i=[];return U(e,(function(t){u(Z,t)||u(D,t)||i.push(t)})),i},ut=function(t){var e=t===j,i=X(e?Y:_(t)),s=[];return U(i,(function(t){!u(Z,t)||e&&!u(j,t)||s.push(Z[t])})),s};(h||(T((q=function(){if(this instanceof q)throw TypeError("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,e=R(t),i=function(t){this===j&&i.call(Y,t),u(this,z)&&u(this[z],e)&&(this[z][e]=!1),st(this,e,y(1,t))};return a&&it&&st(j,e,{configurable:!0,set:i}),nt(e,t)}).prototype,"toString",(function(){return H(this).tag})),T(q,"withoutSetter",(function(t){return nt(R(t),t)})),E.f=ht,S.f=ot,P.f=ct,b.f=x.f=lt,A.f=ut,O.f=function(t){return nt(k(t),t)},a&&(G(q.prototype,"description",{configurable:!0,get:function(){return H(this).description}}),o||T(j,"propertyIsEnumerable",ht,{unsafe:!0}))),s({global:!0,wrap:!0,forced:!h,sham:!h},{Symbol:q}),U(v(tt),(function(t){F(t)})),s({target:"Symbol",stat:!0,forced:!h},{for:function(t){var e=String(t);if(u(J,e))return J[e];var i=q(e);return J[e]=i,$[i]=e,i},keyFor:function(t){if(!rt(t))throw TypeError(t+" is not a symbol");if(u($,t))return $[t]},useSetter:function(){it=!0},useSimple:function(){it=!1}}),s({target:"Object",stat:!0,forced:!h,sham:!a},{create:function(t,e){return void 0===e?w(t):at(w(t),e)},defineProperty:ot,defineProperties:at,getOwnPropertyDescriptor:ct}),s({target:"Object",stat:!0,forced:!h},{getOwnPropertyNames:lt,getOwnPropertySymbols:ut}),s({target:"Object",stat:!0,forced:l((function(){A.f(1)}))},{getOwnPropertySymbols:function(t){return A.f(g(t))}}),K)&&s({target:"JSON",stat:!0,forced:!h||l((function(){var t=q();return"[null]"!=K([t])||"{}"!=K({a:t})||"{}"!=K(Object(t))}))},{stringify:function(t,e,i){for(var s,n=[t],r=1;arguments.length>r;)n.push(arguments[r++]);if(s=e,(p(e)||void 0!==t)&&!rt(t))return d(e)||(e=function(t,e){if("function"==typeof s&&(e=s.call(this,t,e)),!rt(e))return e}),n[1]=e,K.apply(null,n)}});q.prototype[N]||C(q.prototype,N,q.prototype.valueOf),I(q,"Symbol"),D[z]=!0},function(t,e,i){var s=i(30),n=i(10),r=i(77),o=i(7).f;t.exports=function(t){var e=s.Symbol||(s.Symbol={});n(e,t)||o(e,t,{value:r.f(t)})}},function(t,e,i){var s=i(0),n=i(145);s({target:"Object",stat:!0,forced:Object.assign!==n},{assign:n})},function(t,e,i){"use strict";var s=i(2),n=i(1),r=i(32),o=i(54),a=i(39),h=i(3),c=i(28),l=Object.assign,u=Object.defineProperty;t.exports=!l||n((function(){if(s&&1!==l({b:1},l(u({},"a",{enumerable:!0,get:function(){u(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},i=Symbol();return t[i]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=l({},t)[i]||"abcdefghijklmnopqrst"!=r(l({},e)).join("")}))?function(t,e){for(var i=h(t),n=arguments.length,l=1,u=o.f,d=a.f;n>l;)for(var p,f=c(arguments[l++]),g=u?r(f).concat(u(f)):r(f),_=g.length,m=0;_>m;)p=g[m++],s&&!d.call(f,p)||(i[p]=f[p]);return i}:l},function(t,e,i){i(0)({target:"Object",stat:!0,sham:!i(2)},{create:i(42)})},function(t,e,i){var s=i(0),n=i(2);s({target:"Object",stat:!0,forced:!n,sham:!n},{defineProperty:i(7).f})},function(t,e,i){var s=i(0),n=i(2);s({target:"Object",stat:!0,forced:!n,sham:!n},{defineProperties:i(67)})},function(t,e,i){var s=i(0),n=i(78).entries;s({target:"Object",stat:!0},{entries:function(t){return n(t)}})},function(t,e,i){var s=i(0),n=i(45),r=i(1),o=i(4),a=i(57).onFreeze,h=Object.freeze;s({target:"Object",stat:!0,forced:r((function(){h(1)})),sham:!n},{freeze:function(t){return h&&o(t)?h(a(t)):t}})},function(t,e,i){var s=i(0),n=i(152),r=i(19);s({target:"Object",stat:!0},{fromEntries:function(t){var e={};return n(t,(function(t,i){r(e,t,i)}),{AS_ENTRIES:!0}),e}})},function(t,e,i){var s=i(12),n=i(70),r=i(8),o=i(43),a=i(71),h=i(69),c=function(t,e){this.stopped=t,this.result=e};t.exports=function(t,e,i){var l,u,d,p,f,g,_,m=i&&i.that,y=!(!i||!i.AS_ENTRIES),w=!(!i||!i.IS_ITERATOR),v=!(!i||!i.INTERRUPTED),b=o(e,m,1+y+v),x=function(t){return l&&h(l),new c(!0,t)},A=function(t){return y?(s(t),v?b(t[0],t[1],x):b(t[0],t[1])):v?b(t,x):b(t)};if(w)l=t;else{if("function"!=typeof(u=a(t)))throw TypeError("Target is not iterable");if(n(u)){for(d=0,p=r(t.length);p>d;d++)if((f=A(t[d]))&&f instanceof c)return f;return new c(!1)}l=u.call(t)}for(g=l.next;!(_=g.call(l)).done;){try{f=A(_.value)}catch(t){throw h(l),t}if("object"==typeof f&&f&&f instanceof c)return f}return new c(!1)}},function(t,e,i){var s=i(0),n=i(1),r=i(11),o=i(17).f,a=i(2),h=n((function(){o(1)}));s({target:"Object",stat:!0,forced:!a||h,sham:!a},{getOwnPropertyDescriptor:function(t,e){return o(r(t),e)}})},function(t,e,i){var s=i(0),n=i(2),r=i(62),o=i(11),a=i(17),h=i(19);s({target:"Object",stat:!0,sham:!n},{getOwnPropertyDescriptors:function(t){for(var e,i,s=o(t),n=a.f,c=r(s),l={},u=0;c.length>u;)void 0!==(i=n(s,e=c[u++]))&&h(l,e,i);return l}})},function(t,e,i){var s=i(0),n=i(1),r=i(76).f;s({target:"Object",stat:!0,forced:n((function(){return!Object.getOwnPropertyNames(1)}))},{getOwnPropertyNames:r})},function(t,e,i){var s=i(0),n=i(1),r=i(3),o=i(23),a=i(65);s({target:"Object",stat:!0,forced:n((function(){o(1)})),sham:!a},{getPrototypeOf:function(t){return o(r(t))}})},function(t,e,i){i(0)({target:"Object",stat:!0},{is:i(158)})},function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}},function(t,e,i){var s=i(0),n=i(1),r=i(4),o=Object.isExtensible;s({target:"Object",stat:!0,forced:n((function(){o(1)}))},{isExtensible:function(t){return!!r(t)&&(!o||o(t))}})},function(t,e,i){var s=i(0),n=i(1),r=i(4),o=Object.isFrozen;s({target:"Object",stat:!0,forced:n((function(){o(1)}))},{isFrozen:function(t){return!r(t)||!!o&&o(t)}})},function(t,e,i){var s=i(0),n=i(1),r=i(4),o=Object.isSealed;s({target:"Object",stat:!0,forced:n((function(){o(1)}))},{isSealed:function(t){return!r(t)||!!o&&o(t)}})},function(t,e,i){var s=i(0),n=i(3),r=i(32);s({target:"Object",stat:!0,forced:i(1)((function(){r(1)}))},{keys:function(t){return r(n(t))}})},function(t,e,i){var s=i(0),n=i(4),r=i(57).onFreeze,o=i(45),a=i(1),h=Object.preventExtensions;s({target:"Object",stat:!0,forced:a((function(){h(1)})),sham:!o},{preventExtensions:function(t){return h&&n(t)?h(r(t)):t}})},function(t,e,i){var s=i(0),n=i(4),r=i(57).onFreeze,o=i(45),a=i(1),h=Object.seal;s({target:"Object",stat:!0,forced:a((function(){h(1)})),sham:!o},{seal:function(t){return h&&n(t)?h(r(t)):t}})},function(t,e,i){i(0)({target:"Object",stat:!0},{setPrototypeOf:i(68)})},function(t,e,i){var s=i(0),n=i(78).values;s({target:"Object",stat:!0},{values:function(t){return n(t)}})},function(t,e,i){var s=i(56),n=i(41),r=i(168);s||n(Object.prototype,"toString",r,{unsafe:!0})},function(t,e,i){"use strict";var s=i(56),n=i(72);t.exports=s?{}.toString:function(){return"[object "+n(this)+"]"}},function(t,e,i){"use strict";var s=i(0),n=i(2),r=i(46),o=i(3),a=i(18),h=i(7);n&&s({target:"Object",proto:!0,forced:r},{__defineGetter__:function(t,e){h.f(o(this),t,{get:a(e),enumerable:!0,configurable:!0})}})},function(t,e,i){"use strict";var s=i(0),n=i(2),r=i(46),o=i(3),a=i(18),h=i(7);n&&s({target:"Object",proto:!0,forced:r},{__defineSetter__:function(t,e){h.f(o(this),t,{set:a(e),enumerable:!0,configurable:!0})}})},function(t,e,i){"use strict";var s=i(0),n=i(2),r=i(46),o=i(3),a=i(22),h=i(23),c=i(17).f;n&&s({target:"Object",proto:!0,forced:r},{__lookupGetter__:function(t){var e,i=o(this),s=a(t,!0);do{if(e=c(i,s))return e.get}while(i=h(i))}})},function(t,e,i){"use strict";var s=i(0),n=i(2),r=i(46),o=i(3),a=i(22),h=i(23),c=i(17).f;n&&s({target:"Object",proto:!0,forced:r},{__lookupSetter__:function(t){var e,i=o(this),s=a(t,!0);do{if(e=c(i,s))return e.set}while(i=h(i))}})},function(t,e,i){var s=i(6);i(24)(s.JSON,"JSON",!0)},function(t,e,i){i(24)(Math,"Math",!0)},function(t,e,i){var s=i(0),n=i(6),r=i(24);s({global:!0},{Reflect:{}}),r(n.Reflect,"Reflect",!0)},function(t,e,i){i(177),i(179),i(180);var s=i(30);t.exports=s.Function},function(t,e,i){i(0)({target:"Function",proto:!0},{bind:i(178)})},function(t,e,i){"use strict";var s=i(18),n=i(4),r=[].slice,o={},a=function(t,e,i){if(!(e in o)){for(var s=[],n=0;n<e;n++)s[n]="a["+n+"]";o[e]=Function("C,a","return new C("+s.join(",")+")")}return o[e](t,i)};t.exports=Function.bind||function(t){var e=s(this),i=r.call(arguments,1),o=function(){var s=i.concat(r.call(arguments));return this instanceof o?a(e,s.length,s):e.apply(t,s)};return n(e.prototype)&&(o.prototype=e.prototype),o}},function(t,e,i){var s=i(2),n=i(7).f,r=Function.prototype,o=r.toString,a=/^\s*function ([^ (]*)/;!s||"name"in r||n(r,"name",{configurable:!0,get:function(){try{return o.call(this).match(a)[1]}catch(t){return""}}})},function(t,e,i){"use strict";var s=i(4),n=i(7),r=i(23),o=i(5)("hasInstance"),a=Function.prototype;o in a||n.f(a,o,{value:function(t){if("function"!=typeof this||!s(t))return!1;if(!s(this.prototype))return t instanceof this;for(;t=r(t);)if(this.prototype===t)return!0;return!1}})},function(t,e,i){"use strict";i.r(e),i.d(e,"EX_VERSION",(function(){return Ln})),i.d(e,"Flags",(function(){return u})),i.d(e,"ScrollPreventionMode",(function(){return Ns})),i.d(e,"Engine",(function(){return Hs})),i.d(e,"DisplayMode",(function(){return Kt})),i.d(e,"Resolution",(function(){return Vt})),i.d(e,"Screen",(function(){return Gt})),i.d(e,"Actor",(function(){return ui})),i.d(e,"CollisionType",(function(){return et})),i.d(e,"Vector",(function(){return H})),i.d(e,"Ray",(function(){return j})),i.d(e,"Line",(function(){return q})),i.d(e,"Projection",(function(){return K})),i.d(e,"GlobalCoordinates",(function(){return V})),i.d(e,"vec",(function(){return G})),i.d(e,"StrategyContainer",(function(){return Mi})),i.d(e,"Axis",(function(){return Bi})),i.d(e,"LockCameraToActorStrategy",(function(){return Fi})),i.d(e,"LockCameraToActorAxisStrategy",(function(){return Ii})),i.d(e,"ElasticToActorStrategy",(function(){return Li})),i.d(e,"RadiusAroundActorStrategy",(function(){return Ui})),i.d(e,"LimitCameraBoundsStrategy",(function(){return zi})),i.d(e,"Camera",(function(){return Ni})),i.d(e,"Class",(function(){return ti})),i.d(e,"Configurable",(function(){return re})),i.d(e,"Debug",(function(){return _s})),i.d(e,"FrameStats",(function(){return ms})),i.d(e,"PhysicsStats",(function(){return ys})),i.d(e,"EventDispatcher",(function(){return Xt})),i.d(e,"MediaEvent",(function(){return qs})),i.d(e,"NativeSoundEvent",(function(){return Ks})),i.d(e,"NativeSoundProcessedEvent",(function(){return Vs})),i.d(e,"EventTypes",(function(){return tt})),i.d(e,"GameEvent",(function(){return nt})),i.d(e,"KillEvent",(function(){return rt})),i.d(e,"PreKillEvent",(function(){return ot})),i.d(e,"PostKillEvent",(function(){return at})),i.d(e,"GameStartEvent",(function(){return ht})),i.d(e,"GameStopEvent",(function(){return ct})),i.d(e,"PreDrawEvent",(function(){return lt})),i.d(e,"PostDrawEvent",(function(){return ut})),i.d(e,"PreDebugDrawEvent",(function(){return dt})),i.d(e,"PostDebugDrawEvent",(function(){return pt})),i.d(e,"PreUpdateEvent",(function(){return ft})),i.d(e,"PostUpdateEvent",(function(){return gt})),i.d(e,"PreFrameEvent",(function(){return _t})),i.d(e,"PostFrameEvent",(function(){return mt})),i.d(e,"GamepadConnectEvent",(function(){return yt})),i.d(e,"GamepadDisconnectEvent",(function(){return wt})),i.d(e,"GamepadButtonEvent",(function(){return vt})),i.d(e,"GamepadAxisEvent",(function(){return bt})),i.d(e,"SubscribeEvent",(function(){return xt})),i.d(e,"UnsubscribeEvent",(function(){return At})),i.d(e,"VisibleEvent",(function(){return Pt})),i.d(e,"HiddenEvent",(function(){return St})),i.d(e,"PreCollisionEvent",(function(){return Et})),i.d(e,"PostCollisionEvent",(function(){return Ct})),i.d(e,"CollisionStartEvent",(function(){return Tt})),i.d(e,"CollisionEndEvent",(function(){return Mt})),i.d(e,"InitializeEvent",(function(){return Bt})),i.d(e,"ActivateEvent",(function(){return Dt})),i.d(e,"DeactivateEvent",(function(){return Rt})),i.d(e,"ExitViewPortEvent",(function(){return kt})),i.d(e,"EnterViewPortEvent",(function(){return Ot})),i.d(e,"EnterTriggerEvent",(function(){return Ft})),i.d(e,"ExitTriggerEvent",(function(){return It})),i.d(e,"Label",(function(){return Hi})),i.d(e,"FontStyle",(function(){return Oi})),i.d(e,"FontUnit",(function(){return Di})),i.d(e,"TextAlign",(function(){return Ri})),i.d(e,"BaseAlign",(function(){return ki})),i.d(e,"Loader",(function(){return _i})),i.d(e,"Particle",(function(){return Qs})),i.d(e,"ParticleEmitter",(function(){return Ys})),i.d(e,"EmitterType",(function(){return Gs})),i.d(e,"CollisionResolutionStrategy",(function(){return Y})),i.d(e,"BroadphaseStrategy",(function(){return J})),i.d(e,"Integrator",(function(){return $})),i.d(e,"Physics",(function(){return st})),i.d(e,"Scene",(function(){return ps})),i.d(e,"TileMap",(function(){return Si})),i.d(e,"Cell",(function(){return Ti})),i.d(e,"TileSprite",(function(){return Ei})),i.d(e,"Timer",(function(){return vi})),i.d(e,"Trigger",(function(){return qi})),i.d(e,"ScreenElement",(function(){return wi})),i.d(e,"ActionContext",(function(){return Fe})),i.d(e,"RotationType",(function(){return ce})),i.d(e,"Actions",(function(){return r})),i.d(e,"Internal",(function(){return Js})),i.d(e,"Body",(function(){return Le})),i.d(e,"isCollider",(function(){return Qe})),i.d(e,"Collider",(function(){return Ze})),i.d(e,"BoundingBox",(function(){return qt})),i.d(e,"Circle",(function(){return Wt})),i.d(e,"CollisionContact",(function(){return Lt})),i.d(e,"CollisionJumpTable",(function(){return Ut})),i.d(e,"ClosestLine",(function(){return zt})),i.d(e,"ClosestLineJumpTable",(function(){return Nt})),i.d(e,"CollisionGroup",(function(){return Ge})),i.d(e,"CollisionGroupManager",(function(){return $s})),i.d(e,"TreeNode",(function(){return bi})),i.d(e,"DynamicTree",(function(){return xi})),i.d(e,"DynamicTreeCollisionBroadphase",(function(){return Ai})),i.d(e,"Edge",(function(){return Ht})),i.d(e,"Pair",(function(){return Xe})),i.d(e,"ConvexPolygon",(function(){return jt})),i.d(e,"Side",(function(){return p})),i.d(e,"Shape",(function(){return Ie})),i.d(e,"Animation",(function(){return pe})),i.d(e,"Color",(function(){return Q})),i.d(e,"Polygon",(function(){return tn})),i.d(e,"Sprite",(function(){return he})),i.d(e,"SpriteSheet",(function(){return sn})),i.d(e,"SpriteFont",(function(){return rn})),i.d(e,"CanvasDrawComponent",(function(){return oi})),i.d(e,"CanvasDrawingSystem",(function(){return Ji})),i.d(e,"Effects",(function(){return n})),i.d(e,"ExResponse",(function(){return on})),i.d(e,"has_initialize",(function(){return an})),i.d(e,"hasOnInitialize",(function(){return hn})),i.d(e,"has_preupdate",(function(){return cn})),i.d(e,"hasOnPreUpdate",(function(){return ln})),i.d(e,"has_postupdate",(function(){return un})),i.d(e,"hasOnPostUpdate",(function(){return dn})),i.d(e,"hasPreDraw",(function(){return pn})),i.d(e,"hasPostDraw",(function(){return fn})),i.d(e,"PerlinGenerator",(function(){return mn})),i.d(e,"PerlinDrawer2D",(function(){return yn})),i.d(e,"Random",(function(){return d})),i.d(e,"ColorBlindness",(function(){return rs})),i.d(e,"ColorBlindCorrector",(function(){return fs})),i.d(e,"Resource",(function(){return Qt})),i.d(e,"Sound",(function(){return xn})),i.d(e,"AudioContextFactory",(function(){return di})),i.d(e,"WebAudioInstance",(function(){return wn})),i.d(e,"Texture",(function(){return ue})),i.d(e,"Gif",(function(){return Pn})),i.d(e,"Stream",(function(){return Cn})),i.d(e,"ParseGif",(function(){return Tn})),i.d(e,"Component",(function(){return Ye})),i.d(e,"TagComponent",(function(){return Je})),i.d(e,"AddedComponent",(function(){return ei})),i.d(e,"isAddedComponent",(function(){return ii})),i.d(e,"RemovedComponent",(function(){return si})),i.d(e,"isRemovedComponent",(function(){return ni})),i.d(e,"Entity",(function(){return ri})),i.d(e,"EntityManager",(function(){return $i})),i.d(e,"Query",(function(){return es})),i.d(e,"QueryManager",(function(){return is})),i.d(e,"SystemType",(function(){return Vi})),i.d(e,"System",(function(){return Gi})),i.d(e,"AddedEntity",(function(){return Xi})),i.d(e,"isAddedSystemEntity",(function(){return Qi})),i.d(e,"RemovedEntity",(function(){return Zi})),i.d(e,"isRemoveSystemEntity",(function(){return Yi})),i.d(e,"SystemManager",(function(){return ss})),i.d(e,"World",(function(){return ns})),i.d(e,"CoordPlane",(function(){return Re})),i.d(e,"TransformComponent",(function(){return ai})),i.d(e,"Events",(function(){return s})),i.d(e,"Input",(function(){return a})),i.d(e,"Traits",(function(){return h})),i.d(e,"Util",(function(){return c})),i.d(e,"BrowserComponent",(function(){return Us})),i.d(e,"BrowserEvents",(function(){return zs})),i.d(e,"maxMessages",(function(){return L})),i.d(e,"resetObsoleteCounter",(function(){return z})),i.d(e,"obsolete",(function(){return W})),i.d(e,"Detector",(function(){return yi})),i.d(e,"CullingBox",(function(){return ze})),i.d(e,"EasingFunctions",(function(){return Oe})),i.d(e,"LogLevel",(function(){return k})),i.d(e,"Logger",(function(){return O})),i.d(e,"ConsoleAppender",(function(){return F})),i.d(e,"ScreenAppender",(function(){return I})),i.d(e,"SortedList",(function(){return Bn})),i.d(e,"BinaryTreeNode",(function(){return Dn})),i.d(e,"MockedElement",(function(){return Rn})),i.d(e,"PromiseState",(function(){return On})),i.d(e,"Promise",(function(){return In}));var s={};i.r(s),i.d(s,"EventTypes",(function(){return tt})),i.d(s,"GameEvent",(function(){return nt})),i.d(s,"KillEvent",(function(){return rt})),i.d(s,"PreKillEvent",(function(){return ot})),i.d(s,"PostKillEvent",(function(){return at})),i.d(s,"GameStartEvent",(function(){return ht})),i.d(s,"GameStopEvent",(function(){return ct})),i.d(s,"PreDrawEvent",(function(){return lt})),i.d(s,"PostDrawEvent",(function(){return ut})),i.d(s,"PreDebugDrawEvent",(function(){return dt})),i.d(s,"PostDebugDrawEvent",(function(){return pt})),i.d(s,"PreUpdateEvent",(function(){return ft})),i.d(s,"PostUpdateEvent",(function(){return gt})),i.d(s,"PreFrameEvent",(function(){return _t})),i.d(s,"PostFrameEvent",(function(){return mt})),i.d(s,"GamepadConnectEvent",(function(){return yt})),i.d(s,"GamepadDisconnectEvent",(function(){return wt})),i.d(s,"GamepadButtonEvent",(function(){return vt})),i.d(s,"GamepadAxisEvent",(function(){return bt})),i.d(s,"SubscribeEvent",(function(){return xt})),i.d(s,"UnsubscribeEvent",(function(){return At})),i.d(s,"VisibleEvent",(function(){return Pt})),i.d(s,"HiddenEvent",(function(){return St})),i.d(s,"PreCollisionEvent",(function(){return Et})),i.d(s,"PostCollisionEvent",(function(){return Ct})),i.d(s,"CollisionStartEvent",(function(){return Tt})),i.d(s,"CollisionEndEvent",(function(){return Mt})),i.d(s,"InitializeEvent",(function(){return Bt})),i.d(s,"ActivateEvent",(function(){return Dt})),i.d(s,"DeactivateEvent",(function(){return Rt})),i.d(s,"ExitViewPortEvent",(function(){return kt})),i.d(s,"EnterViewPortEvent",(function(){return Ot})),i.d(s,"EnterTriggerEvent",(function(){return Ft})),i.d(s,"ExitTriggerEvent",(function(){return It}));var n={};i.r(n),i.d(n,"Grayscale",(function(){return Zt})),i.d(n,"Invert",(function(){return Yt})),i.d(n,"Opacity",(function(){return Jt})),i.d(n,"Colorize",(function(){return $t})),i.d(n,"Lighten",(function(){return te})),i.d(n,"Darken",(function(){return ee})),i.d(n,"Saturate",(function(){return ie})),i.d(n,"Desaturate",(function(){return se})),i.d(n,"Fill",(function(){return ne}));var r={};i.r(r),i.d(r,"EaseTo",(function(){return ge})),i.d(r,"MoveTo",(function(){return _e})),i.d(r,"MoveBy",(function(){return me})),i.d(r,"Follow",(function(){return ye})),i.d(r,"Meet",(function(){return we})),i.d(r,"RotateTo",(function(){return ve})),i.d(r,"RotateBy",(function(){return be})),i.d(r,"ScaleTo",(function(){return xe})),i.d(r,"ScaleBy",(function(){return Ae})),i.d(r,"Delay",(function(){return Pe})),i.d(r,"Blink",(function(){return Se})),i.d(r,"Fade",(function(){return Ee})),i.d(r,"Die",(function(){return Ce})),i.d(r,"CallMethod",(function(){return Te})),i.d(r,"Repeat",(function(){return Me})),i.d(r,"RepeatForever",(function(){return Be})),i.d(r,"ActionQueue",(function(){return De}));var o={};i.r(o),i.d(o,"line",(function(){return He})),i.d(o,"point",(function(){return je})),i.d(o,"vector",(function(){return qe})),i.d(o,"roundRect",(function(){return Ke})),i.d(o,"circle",(function(){return Ve}));var a={};i.r(a),i.d(a,"Gamepads",(function(){return Os})),i.d(a,"Gamepad",(function(){return Fs})),i.d(a,"Buttons",(function(){return Is})),i.d(a,"Axes",(function(){return Ls})),i.d(a,"PointerType",(function(){return as})),i.d(a,"PointerScope",(function(){return hs})),i.d(a,"Pointer",(function(){return bs})),i.d(a,"Pointers",(function(){return ks})),i.d(a,"NativePointerButton",(function(){return cs})),i.d(a,"PointerButton",(function(){return ls})),i.d(a,"WheelDeltaMode",(function(){return us})),i.d(a,"PointerEvent",(function(){return xs})),i.d(a,"PointerEventFactory",(function(){return As})),i.d(a,"PointerDragEvent",(function(){return Ps})),i.d(a,"PointerUpEvent",(function(){return Ss})),i.d(a,"PointerDownEvent",(function(){return Es})),i.d(a,"PointerMoveEvent",(function(){return Cs})),i.d(a,"PointerEnterEvent",(function(){return Ts})),i.d(a,"PointerLeaveEvent",(function(){return Ms})),i.d(a,"PointerCancelEvent",(function(){return Bs})),i.d(a,"WheelEvent",(function(){return Ds})),i.d(a,"createPointerEventByName",(function(){return Rs})),i.d(a,"Keys",(function(){return os})),i.d(a,"KeyEvent",(function(){return ws})),i.d(a,"Keyboard",(function(){return vs}));var h={};i.r(h),i.d(h,"CapturePointer",(function(){return We})),i.d(h,"OffscreenCulling",(function(){return Ne})),i.d(h,"TileMapCollisionDetection",(function(){return Ue}));var c={};i.r(c),i.d(c,"TwoPI",(function(){return f})),i.d(c,"extend",(function(){return g})),i.d(c,"base64Encode",(function(){return _})),i.d(c,"nullish",(function(){return m})),i.d(c,"clamp",(function(){return y})),i.d(c,"randomInRange",(function(){return w})),i.d(c,"randomIntInRange",(function(){return v})),i.d(c,"canonicalizeAngle",(function(){return b})),i.d(c,"toDegrees",(function(){return x})),i.d(c,"toRadians",(function(){return A})),i.d(c,"getPosition",(function(){return P})),i.d(c,"addItemToArray",(function(){return S})),i.d(c,"removeItemFromArray",(function(){return E})),i.d(c,"contains",(function(){return C})),i.d(c,"getOppositeSide",(function(){return T})),i.d(c,"getSideFromDirection",(function(){return M})),i.d(c,"Collection",(function(){return B})),i.d(c,"fail",(function(){return D})),i.d(c,"delay",(function(){return R})),i.d(c,"DrawUtil",(function(){return o}));i(93),i(141),i(176);function l(){"undefined"==typeof window&&(window={audioContext:function(){}}),"undefined"==typeof window||window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setInterval(t,1e3/60)}),"undefined"==typeof window||window.cancelAnimationFrame||(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(){}),"undefined"==typeof window||window.AudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext),"undefined"==typeof window||window.devicePixelRatio||(window.devicePixelRatio=window.devicePixelRatio||1)}class u{static freeze(){u._FROZEN=!0}static _reset(){u._FROZEN=!1,u._FLAGS={}}static enable(t){if(this._FROZEN)throw Error("Feature flags can only be enabled before Engine constructor time");u._FLAGS[t]=!0}static disable(t){if(this._FROZEN)throw Error("Feature flags can only be disabled before Engine constructor time");u._FLAGS[t]=!1}static isEnabled(t){return!!u._FLAGS[t]}static show(){return Object.keys(u._FLAGS)}}u._FROZEN=!1,u._FLAGS={};class d{constructor(t){this.seed=t,this._lowerMask=2147483647,this._upperMask=2147483648,this._w=32,this._n=624,this._m=397,this._a=2567483615,this._u=11,this._s=7,this._b=2636928640,this._t=15,this._c=4022730752,this._l=18,this._f=1812433253,this._mt=new Array(this._n),this._mt[0]=(t||Date.now())>>>0;for(let t=1;t<this._n;t++){const e=this._mt[t-1]^this._mt[t-1]>>>this._w-2;this._mt[t]=(this._f*((4294901760&e)>>>16)<<16)+this._f*(65535&e)+t>>>0}this._index=this._n}_twist(){const t=[0,this._a];let e=0,i=0;for(;i<this._n-this._m;i++)e=this._mt[i]&this._upperMask|this._mt[i+1]&this._lowerMask,this._mt[i]=this._mt[i+this._m]^e>>>1^4294967295&t[1&e];for(;i<this._n-1;i++)e=this._mt[i]&this._upperMask|this._mt[i+1]&this._lowerMask,this._mt[i]=this._mt[i+(this._m-this._n)]^e>>>1^4294967295&t[1&e];e=this._mt[this._n-1]&this._upperMask|this._mt[0]&this._lowerMask,this._mt[this._n-1]=this._mt[this._m-1]^e>>>1^4294967295&t[1&e],this._index=0}nextInt(){this._index>=this._n&&this._twist();let t=this._mt[this._index++];return t^=t>>>this._u,t^=t<<this._s&this._b,t^=t<<this._t&this._c,t^=t>>>this._l,t>>>0}next(){return this.nextInt()*(1/4294967296)}floating(t,e){return(e-t)*this.next()+t}integer(t,e){return Math.floor((e-t+1)*this.next()+t)}bool(t=.5){return this.next()<=t}pickOne(t){return t[this.integer(0,t.length-1)]}pickSet(t,e,i=!1){return i?this._pickSetWithDuplicates(t,e):this._pickSetWithoutDuplicates(t,e)}_pickSetWithoutDuplicates(t,e){if(e>t.length||e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 < n <= length");if(e===t.length)return t;const i=new Array(e);let s=0;const n=t.slice(0);for(;s<e;){const t=this.integer(0,n.length-1);i[s++]=n[t],n.splice(t,1)}return i}_pickSetWithDuplicates(t,e){if(e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT");const i=new Array(e);for(let s=0;s<e;s++)i[s]=this.pickOne(t);return i}shuffle(t){const e=t.slice(0);let i=null;for(let t=0;t<e.length-2;t++){const s=this.integer(t,e.length-1);i=e[t],e[t]=e[s],e[s]=i}return e}range(t,e,i){const s=new Array(t);for(let n=0;n<t;n++)s[n]=this.integer(e,i);return s}d4(){return this.integer(1,4)}d6(){return this.integer(1,6)}d8(){return this.integer(1,8)}d10(){return this.integer(1,10)}d12(){return this.integer(1,12)}d20(){return this.integer(1,20)}}var p;!function(t){t.None="None",t.Top="Top",t.Bottom="Bottom",t.Left="Left",t.Right="Right"}(p||(p={}));const f=2*Math.PI;function g(){const t={};let e=!1,i=0;const s=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(e=arguments[0],i++);const n="function"==typeof Object.assign;let r=null;for(r=n?Object.assign:function(i){for(const s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e&&"[object Object]"===Object.prototype.toString.call(i[s])?t[s]=g(!0,t[s],i[s]):t[s]=i[s])};i<s;i++){const e=arguments[i];n?r(t,e):r(e)}return t}function _(t){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let i="",s=0;for(;s<t.length;){const n=255&t.charCodeAt(s++),r=255&t.charCodeAt(s++),o=255&t.charCodeAt(s++),a=n>>2,h=(3&n)<<4|r>>4;let c,l;isNaN(r)?c=l=64:(c=(15&r)<<2|o>>6,l=isNaN(o)?64:63&o),i+=e.charAt(a)+e.charAt(h)+e.charAt(c)+e.charAt(l)}return i}function m(t,e){return null!=t?t:e}function y(t,e,i){return Math.min(Math.max(e,t),i)}function w(t,e,i=new d){return i?i.floating(t,e):t+Math.random()*(e-t)}function v(t,e,i=new d){return i?i.integer(t,e):Math.round(w(t,e))}function b(t){let e=t;if(t>f)for(;e>f;)e-=f;if(t<0)for(;e<0;)e+=f;return e}function x(t){return 180/Math.PI*t}function A(t){return t/180*Math.PI}function P(t){let e=0,i=0;const s=t=>{e+=t.offsetLeft,t.offsetParent&&s(t.offsetParent)},n=t=>{i+=t.offsetTop,t.offsetParent&&n(t.offsetParent)};return s(t),n(t),new H(e,i)}function S(t,e){return-1===e.indexOf(t)&&(e.push(t),!0)}function E(t,e){let i=-1;return(i=e.indexOf(t))>-1&&(e.splice(i,1),!0)}function C(t,e){for(let i=0;i<t.length;i++)if(t[i]===e)return!0;return!1}function T(t){return t===p.Top?p.Bottom:t===p.Bottom?p.Top:t===p.Left?p.Right:t===p.Right?p.Left:p.None}function M(t){const e=[H.Left,H.Right,H.Up,H.Down],i=[p.Left,p.Right,p.Top,p.Bottom];let s=-Number.MAX_VALUE,n=-1;for(let i=0;i<e.length;i++)e[i].dot(t)>s&&(s=e[i].dot(t),n=i);return i[n]}class B{constructor(t=B.DefaultSize){this._internalArray=null,this._endPointer=0,this._internalArray=new Array(t)}_resize(){const t=2*this._internalArray.length,e=new Array(t),i=this.count();for(let t=0;t<i;t++)e[t]=this._internalArray[t];delete this._internalArray,this._internalArray=e}push(t){return this._endPointer===this._internalArray.length&&this._resize(),this._internalArray[this._endPointer++]=t}pop(){return this._endPointer=this._endPointer-1<0?0:this._endPointer-1,this._internalArray[this._endPointer]}count(){return this._endPointer}clear(){this._endPointer=0}internalSize(){return this._internalArray.length}elementAt(t){if(t>=this.count())throw new Error("Invalid index "+t);return this._internalArray[t]}insert(t,e){return t>=this.count()&&this._resize(),this._internalArray[t]=e}remove(t){const e=this.count();if(0===e)throw new Error("Invalid parameter "+t);const i=this._internalArray[t];for(let i=t;i<e;i++)this._internalArray[i]=this._internalArray[i+1];return this._endPointer--,i}removeElement(t){const e=this._internalArray.indexOf(t);this.remove(e)}toArray(){return this._internalArray.slice(0,this._endPointer)}forEach(t){let e=0;const i=this.count();for(;e<i;e++)t.call(this,this._internalArray[e],e)}map(t){const e=this.count();for(let i=0;i<e;i++)this._internalArray[i]=t.call(this,this._internalArray[i],i)}}function D(t){throw new Error(t)}function R(t){return new Promise(e=>{setTimeout(()=>{e()},t)})}var k;B.DefaultSize=200,function(t){t[t.Debug=0]="Debug",t[t.Info=1]="Info",t[t.Warn=2]="Warn",t[t.Error=3]="Error",t[t.Fatal=4]="Fatal"}(k||(k={}));class O{constructor(){if(this._appenders=[],this.defaultLevel=k.Info,O._INSTANCE)throw new Error("Logger is a singleton");return O._INSTANCE=this,O._INSTANCE.addAppender(new F),O._INSTANCE}static getInstance(){return null==O._INSTANCE&&(O._INSTANCE=new O),O._INSTANCE}addAppender(t){this._appenders.push(t)}clearAppenders(){this._appenders.length=0}_log(t,e){null==t&&(t=this.defaultLevel);const i=this._appenders.length;for(let s=0;s<i;s++)t>=this.defaultLevel&&this._appenders[s].log(t,e)}debug(...t){this._log(k.Debug,t)}info(...t){this._log(k.Info,t)}warn(...t){this._log(k.Warn,t)}error(...t){this._log(k.Error,t)}fatal(...t){this._log(k.Fatal,t)}}O._INSTANCE=null;class F{log(t,e){if(!console&&!console.log&&console.warn&&console.error)return;const i=[];i.unshift.apply(i,e),i.unshift("["+k[t]+"] : "),t<k.Warn?console.log.apply?console.log.apply(console,i):console.log(i.join(" ")):t<k.Error?console.warn.apply?console.warn.apply(console,i):console.warn(i.join(" ")):console.error.apply?console.error.apply(console,i):console.error(i.join(" "))}}class I{constructor(t,e){this._messages=[],this._canvas=document.createElement("canvas"),this._canvas.width=t||window.innerWidth,this._canvas.height=e||window.innerHeight,this._canvas.style.position="absolute",this._ctx=this._canvas.getContext("2d"),document.body.appendChild(this._canvas)}log(t,e){const i=e.join(",");this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._messages.unshift("["+k[t]+"] : "+i);let s=10,n=1;for(let t=0;t<this._messages.length;t++)this._ctx.fillStyle="rgba(255,255,255,"+n.toFixed(2)+")",this._ctx.fillText(this._messages[t],200,s),s+=10,n=n>0?n-.05:0}}const L=5,U={},z=()=>{for(const t in U)U[t]=0},N=(t,e)=>{const i=u.isEnabled("suppress-obsolete-message");U[t]<L&&!i&&(O.getInstance().warn(t),console.trace&&e.showStackTrace&&console.trace()),U[t]++};function W(t){return t=g({},{message:"This feature will be removed in future versions of Excalibur.",alternateMethod:null,showStackTrack:!1},t),function(e,i,s){if(s&&"function"!=typeof s.value&&"function"!=typeof s.get&&"function"!=typeof s.set)throw new SyntaxError("Only classes/functions/getters/setters can be marked as obsolete");const n=`${`${e.name||""}${e.name&&i?".":""}${i||""}`} is marked obsolete: ${t.message}`+(t.alternateMethod?` Use ${t.alternateMethod} instead`:"");U[n]||(U[n]=0);const r=s?Object.assign({},s):e;if(!s){class e extends r{constructor(...e){N(n,t),super(...e)}}return e}return s&&s.value?(r.value=function(){return N(n,t),s.value.apply(this,arguments)},r):(s&&s.get&&(r.get=function(){return N(n,t),s.get.apply(this,arguments)}),s&&s.set&&(r.set=function(){return N(n,t),s.set.apply(this,arguments)}),r)}}class H{constructor(t,e){this.x=t,this.y=e}static get Zero(){return new H(0,0)}static get One(){return new H(1,1)}static get Half(){return new H(.5,.5)}static get Up(){return new H(0,-1)}static get Down(){return new H(0,1)}static get Left(){return new H(-1,0)}static get Right(){return new H(1,0)}static fromAngle(t){return new H(Math.cos(t),Math.sin(t))}static isValid(t){return null!=t&&(!isNaN(t.x)&&!isNaN(t.y)&&(t.x!==1/0&&t.y!==1/0&&t.x!==-1/0&&t.y!==-1/0))}static distance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}setTo(t,e){this.x=t,this.y=e}equals(t,e=.001){return Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e}distance(t){return t||(t=H.Zero),Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}magnitude(){return this.distance()}get size(){return this.distance()}set size(t){const e=this.normalize().scale(t);this.x=e.x,this.y=e.y}normalize(){const t=this.distance();return t>0?new H(this.x/t,this.y/t):new H(0,1)}average(t){return this.add(t).scale(.5)}scale(t){return t instanceof H?new H(this.x*t.x,this.y*t.y):new H(this.x*t,this.y*t)}add(t){return new H(this.x+t.x,this.y+t.y)}sub(t){return new H(this.x-t.x,this.y-t.y)}addEqual(t){return this.x+=t.x,this.y+=t.y,this}subEqual(t){return this.x-=t.x,this.y-=t.y,this}scaleEqual(t){return this.x*=t,this.y*=t,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return t instanceof H?this.x*t.y-this.y*t.x:"number"==typeof t?new H(t*this.y,-t*this.x):void 0}perpendicular(){return new H(this.y,-this.x)}normal(){return this.perpendicular().normalize()}negate(){return this.scale(-1)}toAngle(){return Math.atan2(this.y,this.x)}rotate(t,e){e||(e=new H(0,0));const i=Math.sin(t),s=Math.cos(t),n=s*(this.x-e.x)-i*(this.y-e.y)+e.x,r=i*(this.x-e.x)+s*(this.y-e.y)+e.y;return new H(n,r)}clone(){return new H(this.x,this.y)}toString(){return`(${this.x}, ${this.y})`}}(function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);r>3&&o&&Object.defineProperty(e,i,o)})([W({message:"will be removed in favour of `.size` in version 0.25.0"})],H.prototype,"magnitude",null);class j{constructor(t,e){this.pos=t,this.dir=e.normalize()}intersect(t){const e=t.begin.sub(this.pos);if(0===this.dir.cross(t.getSlope())&&0!==e.cross(this.dir))return-1;const i=this.dir.cross(t.getSlope());if(0===i)return-1;const s=e.cross(t.getSlope())/i;if(s>=0){const n=e.cross(this.dir)/i/t.getLength();if(n>=0&&n<=1)return s}return-1}getPoint(t){return this.pos.add(this.dir.scale(t))}}class q{constructor(t,e){this.begin=t,this.end=e}get slope(){return(this.end.y-this.begin.y)/(this.end.x-this.begin.x)}get intercept(){return this.begin.y-this.slope*this.begin.x}normal(){return this.end.sub(this.begin).normal()}getSlope(){const t=this.begin,e=this.end,i=t.distance(e);return e.sub(t).scale(1/i)}getEdge(){const t=this.begin;return this.end.sub(t)}getLength(){const t=this.begin,e=this.end;return t.distance(e)}get midpoint(){return this.begin.add(this.end).scale(.5)}flip(){return new q(this.end,this.begin)}distanceToPoint(t){const e=t.x,i=t.y,s=this.getLength(),n=this.end.y-this.begin.y,r=this.end.x-this.begin.x;return Math.abs(n*e-r*i+this.end.x*this.begin.y-this.end.y*this.begin.x)/s}findVectorToPoint(t){const e=this.begin.sub(t),i=this.getSlope();return e.sub(i.scale(e.dot(i)))}findPoint(t=null,e=null){const i=this.slope,s=this.intercept;if(null!==t)return new H(t,i*t+s);if(null!==e)return new H((e-s)/i,e);throw new Error("You must provide an X or a Y value")}hasPoint(){let t,e=0;if("number"==typeof arguments[0]&&"number"==typeof arguments[1])t=new H(arguments[0],arguments[1]),e=arguments[2]||0;else{if(!(arguments[0]instanceof H))throw"Could not determine the arguments for Vector.hasPoint";t=arguments[0],e=arguments[1]||0}const i=t.x-this.begin.x,s=t.y-this.begin.y,n=this.end.x-this.begin.x,r=this.end.y-this.begin.y,o=i*r-s*n;return!(Math.abs(o)>e)&&(Math.abs(n)>=Math.abs(r)?n>0?this.begin.x<=t.x&&t.x<=this.end.x:this.end.x<=t.x&&t.x<=this.begin.x:r>0?this.begin.y<=t.y&&t.y<=this.end.y:this.end.y<=t.y&&t.y<=this.begin.y)}}class K{constructor(t,e){this.min=t,this.max=e}overlaps(t){return this.max>t.min&&t.max>this.min}getOverlap(t){return this.overlaps(t)?this.max>t.max?t.max-this.min:this.max-t.min:0}}class V{constructor(t,e,i){this.worldPos=t,this.pagePos=e,this.screenPos=i}static fromPagePosition(t,e,i){let s,n,r,o;3===arguments.length?(s=t,n=e,r=new H(s,n),o=i):(r=t,s=r.x,n=r.y,o=e);const a=s-P(o.canvas).x,h=n-P(o.canvas).y,c=new H(a,h),l=o.screenToWorldCoordinates(c);return new V(l,r,c)}}function G(t,e){return new H(t,e)}var X=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};class Q{constructor(t,e,i,s){this.r=t,this.g=e,this.b=i,this.a=null!=s?s:1}static fromRGB(t,e,i,s){return new Q(t,e,i,s)}static fromRGBString(t){let e=null;if(e=t.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)/i)){const t=parseInt(e[1],10),i=parseInt(e[2],10),s=parseInt(e[3],10);let n=1;return e[4]&&(n=parseFloat(e[4])),new Q(t,i,s,n)}throw new Error("Invalid rgb/a string: "+t)}static fromHex(t){let e=null;if(e=t.match(/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i)){const t=parseInt(e[1],16),i=parseInt(e[2],16),s=parseInt(e[3],16);let n=1;return e[4]&&(n=parseInt(e[4],16)/255),new Q(t,i,s,n)}throw new Error("Invalid hex string: "+t)}static fromHSL(t,e,i,s=1){return new Z(t,e,i,s).toRGBA()}lighten(t=.1){const e=Z.fromRGBA(this.r,this.g,this.b,this.a);return e.l+=(1-e.l)*t,e.toRGBA()}darken(t=.1){const e=Z.fromRGBA(this.r,this.g,this.b,this.a);return e.l-=e.l*t,e.toRGBA()}saturate(t=.1){const e=Z.fromRGBA(this.r,this.g,this.b,this.a);return e.s+=e.s*t,e.toRGBA()}desaturate(t=.1){const e=Z.fromRGBA(this.r,this.g,this.b,this.a);return e.s-=e.s*t,e.toRGBA()}multiply(t){const e=t.r/255*this.r/255*255,i=t.g/255*this.g/255*255,s=t.b/255*this.b/255*255,n=t.a*this.a;return new Q(e,i,s,n)}mulitiply(t){return this.multiply(t)}screen(t){const e=t.invert(),i=t.invert();return e.multiply(i).invert()}invert(){return new Q(255-this.r,255-this.g,255-this.b,1-this.a)}average(t){const e=(t.r+this.r)/2,i=(t.g+this.g)/2,s=(t.b+this.b)/2,n=(t.a+this.a)/2;return new Q(e,i,s,n)}toString(t="rgb"){switch(t){case"rgb":return this.toRGBA();case"hsl":return this.toHSLA();case"hex":return this.toHex();default:throw new Error("Invalid Color format")}}_componentToHex(t){const e=t.toString(16);return 1===e.length?"0"+e:e}toHex(){return"#"+this._componentToHex(this.r)+this._componentToHex(this.g)+this._componentToHex(this.b)}toRGBA(){const t=String(this.r.toFixed(0))+", "+String(this.g.toFixed(0))+", "+String(this.b.toFixed(0));return void 0!==this.a||null!==this.a?"rgba("+t+", "+String(this.a)+")":"rgb("+t+")"}toHSLA(){return Z.fromRGBA(this.r,this.g,this.b,this.a).toString()}fillStyle(){return this.toString()}clone(){return new Q(this.r,this.g,this.b,this.a)}static get Black(){return Q.fromHex("#000000")}static get White(){return Q.fromHex("#FFFFFF")}static get Gray(){return Q.fromHex("#808080")}static get LightGray(){return Q.fromHex("#D3D3D3")}static get DarkGray(){return Q.fromHex("#A9A9A9")}static get Yellow(){return Q.fromHex("#FFFF00")}static get Orange(){return Q.fromHex("#FFA500")}static get Red(){return Q.fromHex("#FF0000")}static get Vermilion(){return Q.fromHex("#FF5B31")}static get Vermillion(){return Q.Vermilion}static get Rose(){return Q.fromHex("#FF007F")}static get Magenta(){return Q.fromHex("#FF00FF")}static get Violet(){return Q.fromHex("#7F00FF")}static get Blue(){return Q.fromHex("#0000FF")}static get Azure(){return Q.fromHex("#007FFF")}static get Cyan(){return Q.fromHex("#00FFFF")}static get Viridian(){return Q.fromHex("#59978F")}static get Green(){return Q.fromHex("#00FF00")}static get Chartreuse(){return Q.fromHex("#7FFF00")}static get Transparent(){return Q.fromHex("#FFFFFF00")}}X([W({message:"Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0"})],Q.prototype,"mulitiply",null),X([W({message:"Alias for incorrect spelling used in older versions",alternateMethod:"Vermilion"})],Q,"Vermillion",null);class Z{constructor(t,e,i,s){this.h=t,this.s=e,this.l=i,this.a=s}static hue2rgb(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}static fromRGBA(t,e,i,s){t/=255,e/=255,i/=255;const n=Math.max(t,e,i),r=Math.min(t,e,i);let o,a;const h=(n+r)/2;if(n===r)o=a=0;else{const s=n-r;switch(a=h>.5?s/(2-n-r):s/(n+r),n){case t:o=(e-i)/s+(e<i?6:0);break;case e:o=(i-t)/s+2;break;case i:o=(t-e)/s+4}o/=6}return new Z(o,a,h,s)}toRGBA(){let t,e,i;if(0===this.s)t=e=i=this.l;else{const s=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,n=2*this.l-s;t=Z.hue2rgb(n,s,this.h+1/3),e=Z.hue2rgb(n,s,this.h),i=Z.hue2rgb(n,s,this.h-1/3)}return new Q(255*t,255*e,255*i,this.a)}toString(){return`hsla(${this.h.toFixed(0)}, ${this.s.toFixed(0)}, ${this.l.toFixed(0)}, ${this.a.toFixed(0)})`}}var Y,J,$,tt,et,it=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};!function(t){t[t.Box=0]="Box",t[t.RigidBody=1]="RigidBody"}(Y||(Y={})),function(t){t[t.Naive=0]="Naive",t[t.DynamicAABBTree=1]="DynamicAABBTree"}(J||(J={})),function(t){t[t.Euler=0]="Euler"}($||($={}));class st{static useBoxPhysics(){st.collisionResolutionStrategy=Y.Box}static useRigidBodyPhysics(){st.collisionResolutionStrategy=Y.RigidBody}static get dynamicTreeVelocityMultiplyer(){return st.dynamicTreeVelocityMultiplier}static set dynamicTreeVelocityMultiplyer(t){st.dynamicTreeVelocityMultiplier=t}}st.acc=new H(0,0),st.enabled=!0,st.collisionPasses=5,st.broadphaseStrategy=J.DynamicAABBTree,st.broadphaseDebug=!1,st.showCollisionNormals=!1,st.showMotionVectors=!1,st.showBounds=!1,st.showArea=!1,st.showContacts=!1,st.showNormals=!1,st.collisionResolutionStrategy=Y.Box,st.defaultMass=10,st.integrator=$.Euler,st.integrationSteps=1,st.allowRigidBodyRotation=!0,st.collisionShift=.001,st.dynamicTreeVelocityMultiplier=2,st.boundsPadding=5,st.surfaceEpsilon=.1,st.checkForFastBodies=!0,st.disableMinimumSpeedForFastBody=!1,it([W({message:"Alias for incorrect spelling used in older versions, will be removed in v0.25.0",alternateMethod:"dynamicTreeVelocityMultiplier"})],st,"dynamicTreeVelocityMultiplyer",null),function(t){t.Kill="kill",t.PreKill="prekill",t.PostKill="postkill",t.PreDraw="predraw",t.PostDraw="postdraw",t.PreDebugDraw="predebugdraw",t.PostDebugDraw="postdebugdraw",t.PreUpdate="preupdate",t.PostUpdate="postupdate",t.PreFrame="preframe",t.PostFrame="postframe",t.PreCollision="precollision",t.CollisionStart="collisionstart",t.CollisionEnd="collisionend",t.PostCollision="postcollision",t.Initialize="initialize",t.Activate="activate",t.Deactivate="deactivate",t.ExitViewport="exitviewport",t.EnterViewport="enterviewport",t.ExitTrigger="exit",t.EnterTrigger="enter",t.Connect="connect",t.Disconnect="disconnect",t.Button="button",t.Axis="axis",t.Subscribe="subscribe",t.Unsubscribe="unsubscribe",t.Visible="visible",t.Hidden="hidden",t.Start="start",t.Stop="stop",t.PointerUp="pointerup",t.PointerDown="pointerdown",t.PointerMove="pointermove",t.PointerEnter="pointerenter",t.PointerLeave="pointerleave",t.PointerCancel="pointercancel",t.PointerWheel="pointerwheel",t.Up="up",t.Down="down",t.Move="move",t.Enter="enter",t.Leave="leave",t.Cancel="cancel",t.Wheel="wheel",t.Press="press",t.Release="release",t.Hold="hold",t.PointerDragStart="pointerdragstart",t.PointerDragEnd="pointerdragend",t.PointerDragEnter="pointerdragenter",t.PointerDragLeave="pointerdragleave",t.PointerDragMove="pointerdragmove"}(tt||(tt={}));class nt{constructor(){this._bubbles=!0}get bubbles(){return this._bubbles}set bubbles(t){this._bubbles=t}stopPropagation(){this.bubbles=!1}}class rt extends nt{constructor(t){super(),this.target=t}}class ot extends nt{constructor(t){super(),this.target=t}}class at extends nt{constructor(t){super(),this.target=t}}class ht extends nt{constructor(t){super(),this.target=t}}class ct extends nt{constructor(t){super(),this.target=t}}class lt extends nt{constructor(t,e,i){super(),this.ctx=t,this.delta=e,this.target=i}}class ut extends nt{constructor(t,e,i){super(),this.ctx=t,this.delta=e,this.target=i}}class dt extends nt{constructor(t,e){super(),this.ctx=t,this.target=e}}class pt extends nt{constructor(t,e){super(),this.ctx=t,this.target=e}}class ft extends nt{constructor(t,e,i){super(),this.engine=t,this.delta=e,this.target=i}}class gt extends nt{constructor(t,e,i){super(),this.engine=t,this.delta=e,this.target=i}}class _t extends nt{constructor(t,e){super(),this.engine=t,this.prevStats=e,this.target=t}}class mt extends nt{constructor(t,e){super(),this.engine=t,this.stats=e,this.target=t}}class yt extends nt{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class wt extends nt{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class vt extends nt{constructor(t,e,i){super(),this.button=t,this.value=e,this.target=i}}class bt extends nt{constructor(t,e,i){super(),this.axis=t,this.value=e,this.target=i}}class xt extends nt{constructor(t,e){super(),this.topic=t,this.handler=e}}class At extends nt{constructor(t,e){super(),this.topic=t,this.handler=e}}class Pt extends nt{constructor(t){super(),this.target=t}}class St extends nt{constructor(t){super(),this.target=t}}class Et extends nt{constructor(t,e,i,s){super(),this.other=e,this.side=i,this.intersection=s,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class Ct extends nt{constructor(t,e,i,s){super(),this.other=e,this.side=i,this.intersection=s,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class Tt extends nt{constructor(t,e,i){super(),this.other=e,this.pair=i,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class Mt extends nt{constructor(t,e){super(),this.other=e,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class Bt extends nt{constructor(t,e){super(),this.engine=t,this.target=e}}class Dt extends nt{constructor(t,e){super(),this.oldScene=t,this.target=e}}class Rt extends nt{constructor(t,e){super(),this.newScene=t,this.target=e}}class kt extends nt{constructor(t){super(),this.target=t}}class Ot extends nt{constructor(t){super(),this.target=t}}class Ft extends nt{constructor(t,e){super(),this.target=t,this.actor=e}}class It extends nt{constructor(t,e){super(),this.target=t,this.actor=e}}!function(t){t.PreventCollision="PreventCollision",t.Passive="Passive",t.Active="Active",t.Fixed="Fixed"}(et||(et={}));class Lt{constructor(t,e,i,s,n){this.colliderA=t,this.colliderB=e,this.mtv=i,this.point=s,this.normal=n}resolve(t){if(t===Y.RigidBody)this._resolveRigidBodyCollision();else{if(t!==Y.Box)throw new Error("Unknown collision resolution strategy");this._resolveBoxCollision()}}_applyBoxImpulse(t,e,i){if(t.type===et.Active&&e.type!==et.Passive){t.type===et.Active&&e.type===et.Active&&(i=i.scale(.5)),t.body.pos.y+=i.y,t.body.pos.x+=i.x;const s=i.normalize();if(s.dot(t.body.vel)<0){const e=s.scale(s.dot(t.body.vel.negate()));t.body.vel=t.body.vel.add(e)}t.emit("postcollision",new Ct(t,e,M(i),i))}}_resolveBoxCollision(){const t=M(this.mtv),e=this.mtv.negate();this.colliderA.emit("precollision",new Et(this.colliderA,this.colliderB,t,e)),this.colliderB.emit("precollision",new Et(this.colliderB,this.colliderA,T(t),e.negate())),this._applyBoxImpulse(this.colliderA,this.colliderB,e),this._applyBoxImpulse(this.colliderB,this.colliderA,e.negate())}_resolveRigidBodyCollision(){const t=this.colliderA.body,e=this.colliderB.body,i=this.mtv;let s=this.normal;if(t===e)return;const n=M(this.mtv);if(this.colliderA.emit("precollision",new Et(this.colliderA,this.colliderB,n,this.mtv)),this.colliderB.emit("precollision",new Et(this.colliderB,this.colliderA,T(n),this.mtv.negate())),this.colliderA.type===et.Passive||this.colliderB.type===et.Passive)return;const r=this.colliderA.type===et.Fixed?0:1/this.colliderA.mass,o=this.colliderB.type===et.Fixed?0:1/this.colliderB.mass,a=this.colliderA.type===et.Fixed?0:1/this.colliderA.inertia,h=this.colliderB.type===et.Fixed?0:1/this.colliderB.inertia,c=Math.min(this.colliderA.bounciness,this.colliderB.bounciness),l=Math.min(this.colliderA.friction,this.colliderB.friction);s=s.normalize();const u=s.normal().normalize(),d=this.point.sub(this.colliderA.center),p=this.point.sub(this.colliderB.center),f=e.vel.add(p.cross(-e.rx)).sub(t.vel.sub(d.cross(t.rx))),g=f.dot(s),_=f.dot(u),m=d.dot(u),y=d.dot(s),w=p.dot(u),v=p.dot(s);if(g>0)return;const b=-(1+c)*g/(r+o+a*m*m+h*w*w);if(this.colliderA.type===et.Fixed?(e.vel=e.vel.add(s.scale(b*o)),st.allowRigidBodyRotation&&(e.rx-=b*h*-p.cross(s)),e.addMtv(i)):this.colliderB.type===et.Fixed?(t.vel=t.vel.sub(s.scale(b*r)),st.allowRigidBodyRotation&&(t.rx+=b*a*-d.cross(s)),t.addMtv(i.negate())):(e.vel=e.vel.add(s.scale(b*o)),t.vel=t.vel.sub(s.scale(b*r)),st.allowRigidBodyRotation&&(e.rx-=b*h*-p.cross(s),t.rx+=b*a*-d.cross(s)),e.addMtv(i.scale(.5)),t.addMtv(i.scale(-.5))),l&&_){const i=f.sub(s.scale(f.dot(s))).normalize(),n=f.dot(i)/(r+o+y*y*a+v*v*h);let c=new H(0,0);c=Math.abs(n)<=b*l?i.scale(n).negate():i.scale(-b*l),this.colliderA.type===et.Fixed?(e.vel=e.vel.add(c.scale(o)),st.allowRigidBodyRotation&&(e.rx+=c.dot(i)*h*p.cross(i))):this.colliderB.type===et.Fixed?(t.vel=t.vel.sub(c.scale(r)),st.allowRigidBodyRotation&&(t.rx-=c.dot(i)*a*d.cross(i))):(e.vel=e.vel.add(c.scale(o)),t.vel=t.vel.sub(c.scale(r)),st.allowRigidBodyRotation&&(e.rx+=c.dot(i)*h*p.cross(i),t.rx-=c.dot(i)*a*d.cross(i)))}this.colliderA.emit("postcollision",new Ct(this.colliderA,this.colliderB,n,this.mtv)),this.colliderB.emit("postcollision",new Ct(this.colliderB,this.colliderA,T(n),this.mtv.negate()))}}const Ut={CollideCircleCircle(t,e){const i=t.radius+e.radius,s=t.worldPos,n=e.worldPos;if(s.distance(n)>i)return null;const r=n.sub(s).normalize(),o=r.scale(i-n.distance(s)),a=t.getFurthestPoint(r);return new Lt(t.collider,e.collider,o,a,r)},CollideCirclePolygon(t,e){let i=t.testSeparatingAxisTheorem(e);if(!i)return null;const s=i.dot(e.center.sub(t.center));i=s<0?i.negate():i;const n=[],r=e.getFurthestPoint(i.negate()),o=t.getFurthestPoint(i);return t.contains(r)&&n.push(r),e.contains(o)&&n.push(o),0===n.length?null:new Lt(t.collider,e.collider,i,2===n.length?n[0].average(n[1]):n[0],i.normalize())},CollideCircleEdge(t,e){const i=t.center,s=e.end.sub(e.begin),n=s.dot(e.end.sub(i)),r=s.dot(i.sub(e.begin));if(r<=0){const s=e.begin.sub(i),n=s.dot(s);return n>t.radius*t.radius?null:new Lt(t.collider,e.collider,s.normalize().scale(t.radius-Math.sqrt(n)),e.begin,s.normalize())}if(n<=0){const s=e.end.sub(i),n=s.dot(s);return n>t.radius*t.radius?null:new Lt(t.collider,e.collider,s.normalize().scale(t.radius-Math.sqrt(n)),e.end,s.normalize())}const o=s.dot(s),a=e.begin.scale(n).add(e.end.scale(r)).scale(1/o),h=i.sub(a),c=h.dot(h);if(c>t.radius*t.radius)return null;let l=s.perpendicular();l.dot(i.sub(e.begin))<0&&(l.x=-l.x,l.y=-l.y),l=l.normalize();const u=l.scale(Math.abs(t.radius-Math.sqrt(c)));return new Lt(t.collider,e.collider,u.negate(),a,l.negate())},CollideEdgeEdge:()=>null,CollidePolygonEdge(t,e){let i=e.end.sub(e.begin).normal();if(t.contains(e.begin)){const{distance:i,face:s}=t.getClosestFace(e.begin);if(i)return new Lt(t.collider,e.collider,i.negate(),e.begin.add(i.negate()),s.normal().negate())}if(t.contains(e.end)){const{distance:i,face:s}=t.getClosestFace(e.end);if(i)return new Lt(t.collider,e.collider,i.negate(),e.end.add(i.negate()),s.normal().negate())}const s=t.center,n=e.center.sub(s).normalize(),r=new jt({collider:e.collider,points:[e.begin,e.end,e.end.add(n.scale(30)),e.begin.add(n.scale(30))]});let o=t.testSeparatingAxisTheorem(r);return o?(i=i.dot(n)<0?i.negate():i,o=o.dot(n)<0?o.negate():o,new Lt(t.collider,e.collider,o,t.getFurthestPoint(i),i)):null},CollidePolygonPolygon(t,e){let i=t.testSeparatingAxisTheorem(e);if(!i)return null;const s=i.dot(e.center.sub(t.center));i=s<0?i.negate():i;const n=[],r=t.getFurthestPoint(i),o=e.getFurthestPoint(i.negate());e.contains(r)&&n.push(r),t.contains(o)&&n.push(o),0===n.length&&n.push(o);const a=2===n.length?n[0].add(n[1]).scale(.5):n[0];return new Lt(t.collider,e.collider,i,a,i.normalize())}};function zt(t,e,i,s){const n=t.sub(i),r=e.dot(e),o=e.dot(s),a=s.dot(s),h=e.dot(n),c=s.dot(n),l=r*a-o*o;let u=l,d=l;if(0===l||l<=.01){const e=h/o;return new q(t,i.add(s.scale(e)))}let p=o*c-a*h,f=r*c-o*h;return p<0?(p=0,f=c,d=a):p>u&&(p=u,f=c+o,d=a),f<0?(f=0,-h<0?p=0:-h>r?p=u:(p=-h,u=r)):f>d&&(f=d,-h+o<0?p=0:-h+o>r?p=u:(p=-h+o,u=r)),p=Math.abs(p)<.001?0:p/u,f=Math.abs(f)<.001?0:f/d,new q(t.add(e.scale(p)),i.add(s.scale(f)))}const Nt={PolygonPolygonClosestLine(t,e){const i=e.worldPos,s=i.sub(t.worldPos),n=s.negate(),r=new j(t.worldPos,s),o=new j(i,n),a=t.rayCast(r).add(r.dir.scale(.1)),h=e.rayCast(o).add(o.dir.scale(.1)),c=t.getClosestFace(a),l=e.getClosestFace(h);return zt(c.face.begin,c.face.getEdge(),l.face.begin,l.face.getEdge())},PolygonEdgeClosestLine(t,e){const i=e.worldPos.sub(t.worldPos),s=new j(t.worldPos,i),n=t.rayCast(s).add(s.dir.scale(.1)),r=t.getClosestFace(n),o=r.face.begin,a=r.face.getEdge(),h=e.asLine();return zt(o,a,h.begin,h.getEdge())},PolygonCircleClosestLine(t,e){const i=e.worldPos,s=i.sub(t.worldPos),n=new j(t.worldPos,s.normalize()),r=t.rayCast(n).add(n.dir.scale(.1)),o=t.getClosestFace(r),a=o.face.begin,h=o.face.getEdge();let c=(h.x*(i.x-a.x)+h.y*(i.y-a.y))/(h.x*h.x+h.y*h.y);c>1?c=1:c<0&&(c=0);const l=Math.sqrt(Math.pow(a.x+h.x*c-i.x,2)+Math.pow(a.y+h.y*c-i.y,2))-e.radius,u=(a.x+h.x*c-i.x)*e.radius/(e.radius+l),d=(a.y+h.y*c-i.y)*e.radius/(e.radius+l);return new q(h.scale(c).add(a),new H(i.x+u,i.y+d))},CircleCircleClosestLine(t,e){const i=e.worldPos.sub(t.worldPos),s=t.worldPos.sub(e.worldPos),n=new j(t.worldPos,i),r=new j(e.worldPos,s),o=t.rayCast(n),a=e.rayCast(r);return new q(o,a)},CircleEdgeClosestLine(t,e){const i=t.worldPos,s=e.asLine(),n=s.begin,r=s.getEdge();let o=(r.x*(i.x-n.x)+r.y*(i.y-n.y))/(r.x*r.x+r.y*r.y);o>1?o=1:o<0&&(o=0);const a=Math.sqrt(Math.pow(n.x+r.x*o-i.x,2)+Math.pow(n.y+r.y*o-i.y,2))-t.radius,h=(n.x+r.x*o-i.x)*t.radius/(t.radius+a),c=(n.y+r.y*o-i.y)*t.radius/(t.radius+a);return new q(r.scale(o).add(n),new H(i.x+h,i.y+c))},EdgeEdgeClosestLine(t,e){const i=t.asLine(),s=i.begin,n=i.getEdge(),r=e.asLine();return zt(s,n,r.begin,r.getEdge())}};class Wt{constructor(t){this.offset=H.Zero,this.offset=t.offset||H.Zero,this.radius=t.radius||0,this.collider=t.collider||null}get worldPos(){return this.collider&&this.collider.body?this.collider.body.pos.add(this.offset):this.offset}clone(){return new Wt({offset:this.offset.clone(),radius:this.radius,collider:null})}get center(){return this.collider&&this.collider.body?this.offset.add(this.collider.body.pos):this.offset}contains(t){let e=this.offset;return this.collider&&this.collider.body&&(e=this.collider.body.pos),e.distance(t)<=this.radius}rayCast(t,e=1/0){const i=this.center,s=t.dir,n=t.pos,r=Math.sqrt(Math.pow(s.dot(n.sub(i)),2)-Math.pow(n.sub(i).distance(),2)+Math.pow(this.radius,2));if(r<0)return null;{let o=0;if(0===r)return o=-s.dot(n.sub(i)),o>0&&o<e?t.getPoint(o):null;{const o=-s.dot(n.sub(i))+r,a=-s.dot(n.sub(i))-r,h=[];o>=0&&h.push(o),a>=0&&h.push(a);const c=Math.min(...h);return c<=e?t.getPoint(c):null}}}getClosestLineBetween(t){if(t instanceof Wt)return Nt.CircleCircleClosestLine(this,t);if(t instanceof jt)return Nt.PolygonCircleClosestLine(t,this).flip();if(t instanceof Ht)return Nt.CircleEdgeClosestLine(this,t).flip();throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof Wt)return Ut.CollideCircleCircle(this,t);if(t instanceof jt)return Ut.CollideCirclePolygon(this,t);if(t instanceof Ht)return Ut.CollideCircleEdge(this,t);throw new Error(`Circle could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){return this.center.add(t.normalize().scale(this.radius))}get bounds(){let t=H.Zero;return this.collider&&this.collider.body&&(t=this.collider.body.pos),new qt(this.offset.x+t.x-this.radius,this.offset.y+t.y-this.radius,this.offset.x+t.x+this.radius,this.offset.y+t.y+this.radius)}get localBounds(){return new qt(this.offset.x-this.radius,this.offset.y-this.radius,this.offset.x+this.radius,this.offset.y+this.radius)}get axes(){return null}get inertia(){return(this.collider?this.collider.mass:st.defaultMass)*this.radius*this.radius/2}testSeparatingAxisTheorem(t){const e=t.axes,i=t.center,s=t.getFurthestPoint(this.offset.sub(i));e.push(this.offset.sub(s).normalize());let n=Number.MAX_VALUE,r=null,o=-1;for(let i=0;i<e.length;i++){const s=t.project(e[i]),a=this.project(e[i]),h=s.getOverlap(a);if(h<=0)return null;h<n&&(n=h,r=e[i],o=i)}return o<0?null:r.normalize().scale(n)}recalc(){}project(t){const e=[],i=this.center.dot(t);return e.push(i),e.push(i+this.radius),e.push(i-this.radius),new K(Math.min.apply(Math,e),Math.max.apply(Math,e))}draw(t,e=Q.Green,i=H.Zero){const s=i.add(this.offset);t.beginPath(),t.fillStyle=e.toString(),t.arc(s.x,s.y,this.radius,0,2*Math.PI),t.closePath(),t.fill()}debugDraw(t,e=Q.Green){const i=this.collider.body,s=i?i.pos.add(this.offset):this.offset,n=i?i.rotation:0;t.beginPath(),t.strokeStyle=e.toString(),t.arc(s.x,s.y,this.radius,0,2*Math.PI),t.closePath(),t.stroke(),t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(Math.cos(n)*this.radius+s.x,Math.sin(n)*this.radius+s.y),t.closePath(),t.stroke()}}class Ht{constructor(t){this.begin=t.begin||H.Zero,this.end=t.end||H.Zero,this.collider=t.collider||null,this.offset=this.center}clone(){return new Ht({begin:this.begin.clone(),end:this.end.clone(),collider:null})}get worldPos(){return this.collider&&this.collider.body?this.collider.body.pos.add(this.offset):this.offset}get center(){return this.begin.average(this.end).add(this._getBodyPos())}_getBodyPos(){let t=H.Zero;return this.collider&&this.collider.body&&(t=this.collider.body.pos),t}_getTransformedBegin(){const t=this.collider?this.collider.body:null,e=t?t.rotation:0;return this.begin.rotate(e).add(this._getBodyPos())}_getTransformedEnd(){const t=this.collider?this.collider.body:null,e=t?t.rotation:0;return this.end.rotate(e).add(this._getBodyPos())}getSlope(){const t=this._getTransformedBegin(),e=this._getTransformedEnd(),i=t.distance(e);return e.sub(t).scale(1/i)}getLength(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.distance(e)}contains(){return!1}rayCast(t,e=1/0){const i=this._getTransformedBegin().sub(t.pos);if(0===t.dir.cross(this.getSlope())&&0!==i.cross(t.dir))return null;const s=t.dir.cross(this.getSlope());if(0===s)return null;const n=i.cross(this.getSlope())/s;if(n>=0&&n<=e){const e=i.cross(t.dir)/s/this.getLength();if(e>=0&&e<=1)return t.getPoint(n)}return null}getClosestLineBetween(t){if(t instanceof Wt)return Nt.CircleEdgeClosestLine(t,this);if(t instanceof jt)return Nt.PolygonEdgeClosestLine(t,this).flip();if(t instanceof Ht)return Nt.EdgeEdgeClosestLine(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof Wt)return Ut.CollideCircleEdge(t,this);if(t instanceof jt)return Ut.CollidePolygonEdge(t,this);if(t instanceof Ht)return Ut.CollideEdgeEdge();throw new Error(`Edge could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){const e=this._getTransformedBegin(),i=this._getTransformedEnd();return t.dot(e)>0?e:i}_boundsFromBeginEnd(t,e){return new qt(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.max(t.x,e.x),Math.max(t.y,e.y))}get bounds(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return this._boundsFromBeginEnd(t,e)}get localBounds(){return this._boundsFromBeginEnd(this.begin,this.end)}asLine(){return new q(this._getTransformedBegin(),this._getTransformedEnd())}asLocalLine(){return new q(this.begin,this.end)}get axes(){const t=this._getTransformedEnd().sub(this._getTransformedBegin()).normal(),e=[];return e.push(t),e.push(t.negate()),e.push(t.normal()),e.push(t.normal().negate()),e}get inertia(){const t=this.collider?this.collider.mass:st.defaultMass,e=this.end.sub(this.begin).distance()/2;return t*e*e}recalc(){}project(t){const e=[],i=[this._getTransformedBegin(),this._getTransformedEnd()],s=i.length;for(let n=0;n<s;n++)e.push(i[n].dot(t));return new K(Math.min.apply(Math,e),Math.max.apply(Math,e))}draw(t,e=Q.Green,i=H.Zero){const s=this.begin.add(i),n=this.end.add(i);t.strokeStyle=e.toString(),t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(n.x,n.y),t.closePath(),t.stroke()}debugDraw(t,e=Q.Red){const i=this._getTransformedBegin(),s=this._getTransformedEnd();t.strokeStyle=e.toString(),t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(s.x,s.y),t.closePath(),t.stroke()}}class jt{constructor(t){this._transformedPoints=[],this._axes=[],this._sides=[],this.offset=t.offset||H.Zero;const e=!!t.clockwiseWinding;this.points=(e?t.points.reverse():t.points)||[],this.collider=this.collider=t.collider||null,this._calculateTransformation()}clone(){return new jt({offset:this.offset.clone(),points:this.points.map(t=>t.clone()),collider:null})}get worldPos(){return this.collider&&this.collider.body?this.collider.body.pos.add(this.offset):this.offset}get center(){const t=this.collider?this.collider.body:null;return t?t.pos.add(this.offset):this.offset}_calculateTransformation(){const t=this.collider?this.collider.body:null,e=t?t.pos.add(this.offset):this.offset,i=t?t.rotation:0,s=t?t.scale:H.One,n=this.points.length;this._transformedPoints.length=0;for(let t=0;t<n;t++)this._transformedPoints[t]=this.points[t].scale(s).rotate(i).add(e)}getTransformedPoints(){return this._transformedPoints.length&&(!this.collider||!this.collider.body||this.collider.body.oldPos.equals(this.collider.body.pos)&&this.collider.body.oldRotation===this.collider.body.rotation&&this.collider.body.oldScale===this.collider.body.scale)||this._calculateTransformation(),this._transformedPoints}getSides(){if(this._sides.length)return this._sides;const t=[],e=this.getTransformedPoints(),i=e.length;for(let s=0;s<i;s++)t.push(new q(e[s],e[(s-1+i)%i]));return this._sides=t,this._sides}recalc(){this._sides.length=0,this._axes.length=0,this._transformedPoints.length=0,this.getTransformedPoints(),this.getSides()}contains(t){const e=new j(t,new H(1,0));return this.getSides().reduce((function(t,i){return e.intersect(i)>=0?t+1:t}),0)%2!=0}getClosestLineBetween(t){if(t instanceof Wt)return Nt.PolygonCircleClosestLine(this,t);if(t instanceof jt)return Nt.PolygonPolygonClosestLine(this,t);if(t instanceof Ht)return Nt.PolygonEdgeClosestLine(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof Wt)return Ut.CollideCirclePolygon(t,this);if(t instanceof jt)return Ut.CollidePolygonPolygon(this,t);if(t instanceof Ht)return Ut.CollidePolygonEdge(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){const e=this.getTransformedPoints();let i=null,s=-Number.MAX_VALUE;for(let n=0;n<e.length;n++){const r=t.dot(e[n]);r>s&&(s=r,i=e[n])}return i}getClosestFace(t){const e=this.getSides();let i=Number.POSITIVE_INFINITY,s=-1,n=-1;for(let r=0;r<e.length;r++){const o=e[r].distanceToPoint(t);o<i&&(i=o,s=r,n=o)}return-1!==s?{distance:e[s].normal().scale(n),face:e[s]}:null}get bounds(){const t=this.getTransformedPoints();return qt.fromPoints(t)}get localBounds(){return qt.fromPoints(this.points)}get inertia(){const t=this.collider?this.collider.mass:st.defaultMass;let e=0,i=0;for(let t=0;t<this.points.length;t++){const s=(t+1)%this.points.length,n=this.points[s].cross(this.points[t]);e+=n*(this.points[t].dot(this.points[t])+this.points[t].dot(this.points[s])+this.points[s].dot(this.points[s])),i+=n}return t/6*(e/i)}rayCast(t,e=1/0){const i=this.getSides(),s=i.length;let n=Number.MAX_VALUE,r=-1;for(let o=0;o<s;o++){const s=t.intersect(i[o]);s>=0&&s<n&&s<=e&&(n=s,r=o)}return r>=0?t.getPoint(n):null}get axes(){if(this._axes.length)return this._axes;const t=[],e=this.getTransformedPoints(),i=e.length;for(let s=0;s<i;s++)t.push(e[s].sub(e[(s+1)%i]).normal());return this._axes=t,this._axes}testSeparatingAxisTheorem(t){const e=this,i=t,s=e.axes.concat(i.axes);let n=Number.MAX_VALUE,r=null,o=-1;for(let t=0;t<s.length;t++){const a=e.project(s[t]),h=i.project(s[t]),c=a.getOverlap(h);if(c<=0)return null;c<n&&(n=c,r=s[t],o=t)}return-1===o?null:r.normalize().scale(n)}project(t){const e=this.getTransformedPoints(),i=e.length;let s=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let r=0;r<i;r++){const i=e[r].dot(t);s=Math.min(s,i),n=Math.max(n,i)}return new K(s,n)}draw(t,e=Q.Green,i=H.Zero){const s=i.add(this.offset);t.beginPath(),t.fillStyle=e.toString(),t.moveTo(s.x,s.y);const n=this.points[0].sub(s);this.points.map(t=>t.sub(n)).forEach((function(e){t.lineTo(e.x,e.y)})),t.lineTo(s.x,s.y),t.closePath(),t.fill()}debugDraw(t,e=Q.Red){t.beginPath(),t.strokeStyle=e.toString();const i=this.getTransformedPoints()[0];t.moveTo(i.x,i.y),this.getTransformedPoints().forEach((function(e){t.lineTo(e.x,e.y)})),t.lineTo(i.x,i.y),t.closePath(),t.stroke()}}class qt{constructor(t=0,e=0,i=0,s=0){"object"==typeof t?(this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom):"number"==typeof t&&(this.left=t,this.top=e,this.right=i,this.bottom=s)}static getSideFromIntersection(t){return t&&t?Math.abs(t.x)>Math.abs(t.y)?t.x<0?p.Right:p.Left:t.y<0?p.Bottom:p.Top:p.None}static fromPoints(t){let e=1/0,i=1/0,s=-1/0,n=-1/0;for(let r=0;r<t.length;r++)t[r].x<e&&(e=t[r].x),t[r].x>s&&(s=t[r].x),t[r].y<i&&(i=t[r].y),t[r].y>n&&(n=t[r].y);return new qt(e,i,s,n)}static fromDimension(t,e,i=H.Half,s=H.Zero){return new qt(-t*i.x+s.x,-e*i.y+s.y,t-t*i.x+s.x,e-e*i.y+s.y)}get width(){return this.right-this.left}get height(){return this.bottom-this.top}get center(){return new H((this.left+this.right)/2,(this.top+this.bottom)/2)}translate(t){return new qt(this.left+t.x,this.top+t.y,this.right+t.x,this.bottom+t.y)}rotate(t,e=H.Zero){const i=this.getPoints().map(i=>i.rotate(t,e));return qt.fromPoints(i)}scale(t,e=H.Zero){const i=this.translate(e);return new qt(i.left*t.x,i.top*t.y,i.right*t.x,i.bottom*t.y)}getPerimeter(){return 2*(this.width+this.height)}getPoints(){const t=[];return t.push(new H(this.left,this.top)),t.push(new H(this.right,this.top)),t.push(new H(this.right,this.bottom)),t.push(new H(this.left,this.bottom)),t}toPolygon(t){let e=null;return t&&t.body&&t.body.collider&&(e=t.body.collider),new jt({collider:e,points:this.getPoints(),offset:H.Zero})}rayCast(t,e=1/0){let i=-1/0,s=1/0;const n=0===t.dir.x?Number.MAX_VALUE:1/t.dir.x,r=0===t.dir.y?Number.MAX_VALUE:1/t.dir.y,o=(this.left-t.pos.x)*n,a=(this.right-t.pos.x)*n;i=Math.min(o,a),s=Math.max(o,a);const h=(this.top-t.pos.y)*r,c=(this.bottom-t.pos.y)*r;return i=Math.max(i,Math.min(h,c)),s=Math.min(s,Math.max(h,c)),s>=Math.max(0,i)&&i<e}rayCastTime(t,e=1/0){let i=-1/0,s=1/0;const n=0===t.dir.x?Number.MAX_VALUE:1/t.dir.x,r=0===t.dir.y?Number.MAX_VALUE:1/t.dir.y,o=(this.left-t.pos.x)*n,a=(this.right-t.pos.x)*n;i=Math.min(o,a),s=Math.max(o,a);const h=(this.top-t.pos.y)*r,c=(this.bottom-t.pos.y)*r;return i=Math.max(i,Math.min(h,c)),s=Math.min(s,Math.max(h,c)),s>=Math.max(0,i)&&i<e?i:-1}contains(t){return t instanceof H?this.left<=t.x&&this.top<=t.y&&this.bottom>=t.y&&this.right>=t.x:t instanceof qt&&(this.left<t.left&&this.top<t.top&&t.bottom<this.bottom&&t.right<this.right)}combine(t){return new qt(Math.min(this.left,t.left),Math.min(this.top,t.top),Math.max(this.right,t.right),Math.max(this.bottom,t.bottom))}get dimensions(){return new H(this.width,this.height)}intersect(t){const e=this.combine(t);if(e.width<t.width+this.width&&e.height<t.height+this.height&&!e.dimensions.equals(t.dimensions)&&!e.dimensions.equals(this.dimensions)){let e=0;e=this.right>=t.left&&this.right<=t.right?t.left-this.right:t.right-this.left;let i=0;return i=this.top<=t.bottom&&this.top>=t.top?t.bottom-this.top:t.top-this.bottom,Math.abs(e)<Math.abs(i)?new H(e,0):new H(0,i)}if(e.dimensions.equals(t.dimensions)||e.dimensions.equals(this.dimensions)){let e=0;e=this.width-t.width>=0?this.right-t.right<=t.left-this.left?t.left-this.right:t.right-this.left:t.right-this.right<=this.left-t.left?this.left-t.right:this.right-t.left;let i=0;return i=this.height-t.height>=0?this.bottom-t.bottom<=t.top-this.top?t.top-this.bottom:t.bottom-this.top:t.bottom-this.bottom<=this.top-t.top?this.top-t.bottom:this.bottom-t.top,Math.abs(e)<Math.abs(i)?new H(e,0):new H(0,i)}return null}intersectWithSide(t){const e=this.intersect(t);return qt.getSideFromIntersection(e)}debugDraw(t,e=Q.Yellow){t.strokeStyle=e.toString(),t.strokeRect(this.left,this.top,this.width,this.height)}}var Kt;!function(t){t.FullScreen="FullScreen",t.Container="Container",t.Fixed="Fixed",t.Position="Position"}(Kt||(Kt={}));class Vt{static get SVGA(){return{width:800,height:600}}static get Standard(){return{width:1920,height:1080}}static get Atari2600(){return{width:160,height:192}}static get GameBoy(){return{width:160,height:144}}static get GameBoyAdvance(){return{width:240,height:160}}static get NintendoDS(){return{width:256,height:192}}static get NES(){return{width:256,height:224}}static get SNES(){return{width:256,height:244}}}class Gt{constructor(t){var e,i,s;this._antialiasing=!0,this._resolutionStack=[],this._viewportStack=[],this._pixelRatio=null,this._isFullScreen=!1,this._isDisposed=!1,this._logger=O.getInstance(),this._pixelRatioChangeHandler=()=>{this._logger.debug("Pixel Ratio Change",window.devicePixelRatio),this.applyResolutionAndViewport()},this._windowResizeHandler=()=>{const t=this.displayMode===Kt.Container?this.canvas.parentElement||document.body:window;this._logger.debug("View port resized"),this._setHeightByDisplayMode(t),this._logger.info("parent.clientHeight "+t.clientHeight),this.applyResolutionAndViewport()},this.viewport=t.viewport,this.resolution=null!==(e=t.resolution)&&void 0!==e?e:Object.assign({},this.viewport),this._displayMode=null!==(i=t.displayMode)&&void 0!==i?i:Kt.Fixed,this._canvas=t.canvas,this._ctx=t.context,this._antialiasing=null!==(s=t.antialiasing)&&void 0!==s?s:this._antialiasing,this._browser=t.browser,this._position=t.position,this._pixelRatio=t.pixelRatio,this._applyDisplayMode(),this._mediaQueryList=this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),this._mediaQueryList.addEventListener("change",this._pixelRatioChangeHandler)}dispose(){this._isDisposed||(this._isDisposed=!0,this._browser.window.off("resize",this._windowResizeHandler),this._mediaQueryList.removeEventListener("change",this._pixelRatioChangeHandler))}get pixelRatio(){if(this._pixelRatio)return this._pixelRatio;if(window.devicePixelRatio<1)return 1;return window.devicePixelRatio||1}get isHiDpi(){return 1!==this.pixelRatio}get displayMode(){return this._displayMode}get canvas(){return this._canvas}get resolution(){return this._resolution}set resolution(t){this._resolution=t}get viewport(){return this._viewport?this._viewport:this._resolution}set viewport(t){this._viewport=t}get scaledWidth(){return this._resolution.width*this.pixelRatio}get scaledHeight(){return this._resolution.height*this.pixelRatio}setCurrentCamera(t){this._camera=t}pushResolutionAndViewport(){this._resolutionStack.push(this.resolution),this._viewportStack.push(this.viewport),this.resolution=Object.assign({},this.resolution),this.viewport=Object.assign({},this.viewport)}popResolutionAndViewport(){this.resolution=this._resolutionStack.pop(),this.viewport=this._viewportStack.pop()}applyResolutionAndViewport(){this._canvas.width=this.scaledWidth,this._canvas.height=this.scaledHeight,this._antialiasing?this._canvas.style.imageRendering="auto":(this._canvas.style.imageRendering="pixelated",""===this._canvas.style.imageRendering&&(this._canvas.style.imageRendering="crisp-edges")),this._canvas.style.width=this.viewport.width+"px",this._canvas.style.height=this.viewport.height+"px",this._ctx.resetTransform(),this._ctx.scale(this.pixelRatio,this.pixelRatio),this._ctx.imageSmoothingEnabled=this._antialiasing}get antialiasing(){return this._antialiasing}set antialiasing(t){this._antialiasing=t,this._ctx.imageSmoothingEnabled=this._antialiasing}get isFullScreen(){return this._isFullScreen}goFullScreen(){return this._canvas.requestFullscreen().then(()=>{this._isFullScreen=!0})}exitFullScreen(){return document.exitFullscreen().then(()=>{this._isFullScreen=!1})}screenToWorldCoordinates(t){var e,i,s,n;let r=t.x,o=t.y;return r=r/this.viewport.width*this.drawWidth,o=o/this.viewport.height*this.drawHeight,r-=this.halfDrawWidth,o-=this.halfDrawHeight,r+=null!==(i=null===(e=this._camera)||void 0===e?void 0:e.x)&&void 0!==i?i:0,o+=null!==(n=null===(s=this._camera)||void 0===s?void 0:s.y)&&void 0!==n?n:0,new H(Math.floor(r),Math.floor(o))}worldToScreenCoordinates(t){var e,i,s,n;let r=t.x,o=t.y;return r-=null!==(i=null===(e=this._camera)||void 0===e?void 0:e.x)&&void 0!==i?i:0,o-=null!==(n=null===(s=this._camera)||void 0===s?void 0:s.y)&&void 0!==n?n:0,r+=this.halfDrawWidth,o+=this.halfDrawHeight,r=r*this.viewport.width/this.drawWidth,o=o*this.viewport.height/this.drawHeight,new H(Math.floor(r),Math.floor(o))}getWorldBounds(){const t=this.screenToWorldCoordinates(H.Zero).x,e=this.screenToWorldCoordinates(H.Zero).y,i=t+this.drawWidth,s=e+this.drawHeight;return new qt(t,e,i,s)}get canvasWidth(){return this.canvas.width}get halfCanvasWidth(){return this.canvas.width/2}get canvasHeight(){return this.canvas.height}get halfCanvasHeight(){return this.canvas.height/2}get drawWidth(){return this._camera?this.scaledWidth/this._camera.z/this.pixelRatio:this.scaledWidth/this.pixelRatio}get halfDrawWidth(){return this.drawWidth/2}get drawHeight(){return this._camera?this.scaledHeight/this._camera.z/this.pixelRatio:this.scaledHeight/this.pixelRatio}get halfDrawHeight(){return this.drawHeight/2}_applyDisplayMode(){if(this.displayMode===Kt.FullScreen||this.displayMode===Kt.Container){const t=this.displayMode===Kt.Container?this.canvas.parentElement||document.body:window;this._setHeightByDisplayMode(t),this._browser.window.on("resize",this._windowResizeHandler)}else this.displayMode===Kt.Position&&this._initializeDisplayModePosition(this._position)}_setHeightByDisplayMode(t){this.displayMode===Kt.Container&&(this.resolution={width:t.clientWidth,height:t.clientHeight},this.viewport=this.resolution),this.displayMode===Kt.FullScreen&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.resolution={width:t.innerWidth,height:t.innerHeight},this.viewport=this.resolution)}_initializeDisplayModePosition(t){if(!t)throw new Error("DisplayMode of Position was selected but no position option was given");if(this.canvas.style.display="block",this.canvas.style.position="absolute","string"==typeof t){const e=t.split(" ");switch(e[0]){case"top":this.canvas.style.top="0px";break;case"bottom":this.canvas.style.bottom="0px";break;case"middle":this.canvas.style.top="50%";const t=-this.halfDrawHeight;this.canvas.style.marginTop=t.toString();break;default:throw new Error("Invalid Position Given")}if(e[1])switch(e[1]){case"left":this.canvas.style.left="0px";break;case"right":this.canvas.style.right="0px";break;case"center":this.canvas.style.left="50%";const t=-this.halfDrawWidth;this.canvas.style.marginLeft=t.toString();break;default:throw new Error("Invalid Position Given")}}else t.top&&("number"==typeof t.top?this.canvas.style.top=t.top.toString()+"px":this.canvas.style.top=t.top),t.right&&("number"==typeof t.right?this.canvas.style.right=t.right.toString()+"px":this.canvas.style.right=t.right),t.bottom&&("number"==typeof t.bottom?this.canvas.style.bottom=t.bottom.toString()+"px":this.canvas.style.bottom=t.bottom),t.left&&("number"==typeof t.left?this.canvas.style.left=t.left.toString()+"px":this.canvas.style.left=t.left)}}class Xt{constructor(t){this._handlers={},this._wiredEventDispatchers=[],this._target=t}clear(){this._handlers={},this._wiredEventDispatchers=[]}emit(t,e){if(!t)return;t=t.toLowerCase();const i=this._target;e||(e=new nt);try{e.target=i}catch(t){}let s,n;if(this._handlers[t])for(s=0,n=this._handlers[t].length;s<n;s++)this._handlers[t][s].call(i,e);for(s=0,n=this._wiredEventDispatchers.length;s<n;s++)this._wiredEventDispatchers[s].emit(t,e)}on(t,e){t=t.toLowerCase(),this._handlers[t]||(this._handlers[t]=[]),this._handlers[t].push(e),"unsubscribe"!==t&&"subscribe"!==t&&this.emit("subscribe",new xt(t,e))}off(t,e){t=t.toLowerCase();const i=this._handlers[t];if(i)if(e){const s=i.indexOf(e);this._handlers[t].splice(s,1)}else this._handlers[t].length=0;"unsubscribe"!==t&&"subscribe"!==t&&this.emit("unsubscribe",new At(t,e))}once(t,e){this.on(t,i=>{const s=i||new nt;try{s.target=s.target||this._target}catch(t){}this.off(t,e),e.call(s.target,s)})}wire(t){t._wiredEventDispatchers.push(this)}unwire(t){const e=t._wiredEventDispatchers.indexOf(this);e>-1&&t._wiredEventDispatchers.splice(e,1)}}class Qt{constructor(t,e,i=!0){this.path=t,this.responseType=e,this.bustCache=i,this.data=null,this.logger=O.getInstance(),this.events=new Xt(this)}isLoaded(){return null!==this.data}_cacheBust(t){return/\?\w*=\w*/.test(t)?t+="&__="+Date.now():t+="?__="+Date.now(),t}load(){return new Promise((t,e)=>{if(null!==this.data)return this.logger.debug("Already have data for resource",this.path),this.events.emit("complete",this.data),void t(this.data);const i=new XMLHttpRequest;i.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),i.responseType=this.responseType,i.addEventListener("loadstart",t=>this.events.emit("loadstart",t)),i.addEventListener("progress",t=>this.events.emit("progress",t)),i.addEventListener("error",t=>this.events.emit("error",t)),i.addEventListener("load",t=>this.events.emit("load",t)),i.addEventListener("load",()=>{if(0!==i.status&&200!==i.status)return this.logger.error("Failed to load resource ",this.path," server responded with error code",i.status),this.events.emit("error",i.response),void e(i.response);this.data=i.response,this.events.emit("complete",this.data),this.logger.debug("Completed loading resource",this.path),t(this.data)}),i.send()})}}class Zt{updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data,r=(n[s+0]+n[s+1]+n[s+2])/3;n[s+0]=r,n[s+1]=r,n[s+2]=r}}class Yt{updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data;n[s+0]=255-n[s+0],n[s+1]=255-n[s+1],n[s+2]=255-n[s+2]}}class Jt{constructor(t){this.opacity=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data;0!==n[s+3]&&(n[s+3]=Math.round(this.opacity*n[s+3]))}}class $t{constructor(t){this.color=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data;0!==n[s+3]&&(n[s+0]=(n[s+0]+this.color.r)/2,n[s+1]=(n[s+1]+this.color.g)/2,n[s+2]=(n[s+2]+this.color.b)/2)}}class te{constructor(t=.1){this.factor=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data,r=Q.fromRGB(n[s+0],n[s+1],n[s+2],n[s+3]).lighten(this.factor);n[s+0]=r.r,n[s+1]=r.g,n[s+2]=r.b,n[s+3]=r.a}}class ee{constructor(t=.1){this.factor=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data,r=Q.fromRGB(n[s+0],n[s+1],n[s+2],n[s+3]).darken(this.factor);n[s+0]=r.r,n[s+1]=r.g,n[s+2]=r.b,n[s+3]=r.a}}class ie{constructor(t=.1){this.factor=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data,r=Q.fromRGB(n[s+0],n[s+1],n[s+2],n[s+3]).saturate(this.factor);n[s+0]=r.r,n[s+1]=r.g,n[s+2]=r.b,n[s+3]=r.a}}class se{constructor(t=.1){this.factor=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data,r=Q.fromRGB(n[s+0],n[s+1],n[s+2],n[s+3]).desaturate(this.factor);n[s+0]=r.r,n[s+1]=r.g,n[s+2]=r.b,n[s+3]=r.a}}class ne{constructor(t){this.color=t}updatePixel(t,e,i){const s=4*(t+e*i.width),n=i.data;0!==n[s+3]&&(n[s+0]=this.color.r,n[s+1]=this.color.g,n[s+2]=this.color.b)}}function re(t){return class extends t{assign(t){for(const e in t)"function"!=typeof this[e]&&(this[e]=t[e])}constructor(...t){super(...t),1!==t.filter((function(t){return void 0!==t})).length||!t[0]||"object"!=typeof t[0]||t[0]instanceof Array||this.assign(t[0])}}}var oe=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{h(s.next(t))}catch(t){r(t)}}function a(t){try{h(s.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((s=s.apply(t,e||[])).next())}))};class ae{constructor(t,e,i,s,n){this.x=0,this.y=0,this.rotation=0,this.anchor=new H(0,0),this.offset=H.Zero,this.scale=H.One,this.logger=O.getInstance(),this.flipVertical=!1,this.flipHorizontal=!1,this.effects=[],this.width=0,this.height=0,this._spriteCanvas=null,this._spriteCtx=null,this._pixelData=null,this._pixelsLoaded=!1,this._dirtyEffect=!0,this._opacity=1;let r=t;if(t&&!(t instanceof ue)&&(e=0|t.x,i=0|t.y,s=0|t.width,n=0|t.height,r=t.image,!r)){throw new Error("An image texture is required to construct a sprite")}this.x=e||0,this.y=i||0,this._texture=r,this._spriteCanvas=document.createElement("canvas"),this._spriteCanvas.width=s,this._spriteCanvas.height=n,this._spriteCtx=this._spriteCanvas.getContext("2d"),this._initPixelsFromTexture(),this.width=s,this.height=n}get drawWidth(){return this.width*this.scale.x}get drawHeight(){return this.height*this.scale.y}_initPixelsFromTexture(){return oe(this,void 0,void 0,(function*(){try{const t=yield this._texture.loaded;this.width=this.width||t.naturalWidth,this.height=this.height||t.naturalHeight,this._spriteCanvas.width=this._spriteCanvas.width||t.naturalWidth,this._spriteCanvas.height=this._spriteCanvas.height||t.naturalHeight,this._loadPixels(),this._dirtyEffect=!0}catch(t){this.logger.error("Error loading texture ",this._texture.path,t)}}))}_loadPixels(){if(this._texture.isLoaded()&&!this._pixelsLoaded){const t=this._texture.image.naturalWidth||0,e=this._texture.image.naturalHeight||0;if(this.width>t&&this.logger.warn(`The sprite width ${this.width} exceeds the width \n                              ${t} of the backing texture ${this._texture.path}`),this.width<=0||t<=0)throw new Error(`The width of a sprite cannot be 0 or negative, sprite width: ${this.width}, original width: ${t}`);if(this.height>e&&this.logger.warn(`The sprite height ${this.height} exceeds the height \n                              ${e} of the backing texture ${this._texture.path}`),this.height<=0||e<=0)throw new Error(`The height of a sprite cannot be 0 or negative, sprite height: ${this.height}, original height: ${e}`);this._flushTexture(),this._pixelsLoaded=!0}}_flushTexture(){const t=this._texture.image.naturalWidth||0,e=this._texture.image.naturalHeight||0;this._spriteCtx.clearRect(0,0,this.width,this.height),this._spriteCtx.drawImage(this._texture.image,y(this.x,0,t),y(this.y,0,e),y(this.width,0,t),y(this.height,0,e),0,0,this.width,this.height)}opacity(t){this._opacity=t}grayscale(){this.addEffect(new Zt)}invert(){this.addEffect(new Yt)}fill(t){this.addEffect(new ne(t))}colorize(t){this.addEffect(new $t(t))}lighten(t=.1){this.addEffect(new te(t))}darken(t=.1){this.addEffect(new ee(t))}saturate(t=.1){this.addEffect(new ie(t))}desaturate(t=.1){this.addEffect(new se(t))}addEffect(t){this.effects.push(t),this._texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0}removeEffect(t){let e=-1;e="number"==typeof t?t:this.effects.indexOf(t),e<0||e>=this.effects.length||(this.effects.splice(e,1),this._texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0)}_applyEffects(){if(this._flushTexture(),this.effects.length>0){this._pixelData=this._spriteCtx.getImageData(0,0,this.width,this.height);const t=this.effects.length;for(let e=0;e<t;e++)for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)this.effects[e].updatePixel(i,t,this._pixelData);this._spriteCtx.clearRect(0,0,this.width,this.height),this._spriteCtx.putImageData(this._pixelData,0,0)}this._dirtyEffect=!1}clearEffects(){this.effects.length=0,this._applyEffects()}reset(){}debugDraw(t,e,i){t.save(),t.translate(e,i),t.rotate(this.rotation);const s=this.drawWidth*this.anchor.x,n=this.drawHeight*this.anchor.y;t.strokeStyle=Q.Black.toString(),t.strokeRect(-s,-n,this.drawWidth,this.drawHeight),t.restore()}draw(t,e,i){t instanceof CanvasRenderingContext2D?this._drawWithOptions({ctx:t,x:e,y:i}):this._drawWithOptions(t)}_drawWithOptions(t){var e,i,s,n,r,o,a,h;const{ctx:c,x:l,y:u,rotation:d,drawWidth:p,drawHeight:f,anchor:g,offset:_,opacity:m,flipHorizontal:y,flipVertical:w}=Object.assign(Object.assign({},t),{rotation:null!==(e=t.rotation)&&void 0!==e?e:this.rotation,drawWidth:null!==(i=t.drawWidth)&&void 0!==i?i:this.drawWidth,drawHeight:null!==(s=t.drawHeight)&&void 0!==s?s:this.drawHeight,flipHorizontal:null!==(n=t.flipHorizontal)&&void 0!==n?n:this.flipHorizontal,flipVertical:null!==(r=t.flipVertical)&&void 0!==r?r:this.flipVertical,anchor:null!==(o=t.anchor)&&void 0!==o?o:this.anchor,offset:null!==(a=t.offset)&&void 0!==a?a:this.offset,opacity:null!==(h=t.opacity)&&void 0!==h?h:this._opacity});this._dirtyEffect&&this._applyEffects(),c.save();const v=p*g.x+_.x,b=f*g.y+_.y;c.translate(l,u),c.rotate(d),y&&(c.translate(p,0),c.scale(-1,1)),w&&(c.translate(0,f),c.scale(1,-1));const x=c.globalAlpha;c.globalAlpha=null!=m?m:1,c.drawImage(this._spriteCanvas,0,0,this.width,this.height,-v,-b,p,f),c.globalAlpha=x,c.restore()}clone(){const t=new he(this._texture,this.x,this.y,this.width,this.height);t.scale=this.scale.clone(),t.rotation=this.rotation,t.flipHorizontal=this.flipHorizontal,t.flipVertical=this.flipVertical;const e=this.effects.length;for(let i=0;i<e;i++)t.addEffect(this.effects[i]);return t}}class he extends(re(ae)){constructor(t,e,i,s,n){super(t,e,i,s,n)}}var ce,le=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{h(s.next(t))}catch(t){r(t)}}function a(t){try{h(s.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((s=s.apply(t,e||[])).next())}))};class ue{constructor(t,e=!0){this.path=t,this.bustCache=e,this._sprite=null,this.loaded=new Promise(t=>{this._loadedResolve=t}),this._resource=new Qt(t,"blob",e),this._sprite=new he(this,0,0,0,0)}get image(){return this.data}isLoaded(){return!!this.data}load(){return le(this,void 0,void 0,(function*(){try{let t;if(this.path.includes("data:image/"))t=this.path;else{const e=yield this._resource.load();t=URL.createObjectURL(e)}const e=new Image;e.src=t,yield e.decode(),this.data=e,this.width=this._sprite.width=e.naturalWidth,this.height=this._sprite.height=e.naturalHeight,this._sprite=new he(this,0,0,this.width,this.height)}catch(t){yield Promise.reject("Error loading texture")}return this._loadedResolve(this.data),this.data}))}asSprite(){return this._sprite}}class de{constructor(t,e,i,s){this.sprites=[],this.currentFrame=0,this._timeLeftInFrame=0,this._idempotencyToken=-1,this.anchor=H.Zero,this.rotation=0,this.scale=H.One,this.loop=!0,this.freezeFrame=-1,this.flipVertical=!1,this.flipHorizontal=!1,this.drawWidth=0,this.drawHeight=0,this.width=0,this.height=0,this._opacity=1;let n=t;if(t&&!(t instanceof Hs)){const r=t;n=r.engine,e=r.sprites,i=r.speed,s=r.loop}this.sprites=e,this.speed=i,this._engine=n,this._timeLeftInFrame=this.speed,null!=s&&(this.loop=s),e&&e[0]&&(this.drawHeight=e[0]?e[0].drawHeight:0,this.drawWidth=e[0]?e[0].drawWidth:0,this.width=e[0]?e[0].width:0,this.height=e[0]?e[0].height:0,this.freezeFrame=e.length-1)}opacity(t){this._opacity=t}grayscale(){this.addEffect(new Zt)}invert(){this.addEffect(new Yt)}fill(t){this.addEffect(new ne(t))}colorize(t){this.addEffect(new $t(t))}lighten(t=.1){this.addEffect(new te(t))}darken(t=.1){this.addEffect(new ee(t))}saturate(t=.1){this.addEffect(new ie(t))}desaturate(t=.1){this.addEffect(new se(t))}addEffect(t){for(const e in this.sprites)this.sprites[e].addEffect(t)}removeEffect(t){for(const e in this.sprites)this.sprites[e].removeEffect(t)}clearEffects(){for(const t in this.sprites)this.sprites[t].clearEffects()}_setAnchor(t){for(const e in this.sprites)this.sprites[e].anchor.setTo(t.x,t.y)}_setRotation(t){for(const e in this.sprites)this.sprites[e].rotation=t}_setScale(t){for(const e in this.sprites)this.sprites[e].scale=t}reset(){this.currentFrame=0}isDone(){return!this.loop&&this.currentFrame>=this.sprites.length}tick(t,e){if(this._idempotencyToken===e)return;this._idempotencyToken=e,this._timeLeftInFrame-=t,this._timeLeftInFrame<=0&&(this.currentFrame=this.loop?(this.currentFrame+1)%this.sprites.length:this.currentFrame+1,this._timeLeftInFrame=this.speed),this._updateValues();const i=this.sprites[this.currentFrame];i&&(this.width=i.width,this.height=i.height,this.drawWidth=i.drawWidth,this.drawHeight=i.drawHeight)}_updateValues(){this._setAnchor(this.anchor),this._setRotation(this.rotation),this._setScale(this.scale)}skip(t){this.currentFrame=(this.currentFrame+t)%this.sprites.length}draw(t,e,i){t instanceof CanvasRenderingContext2D?this._drawWithOptions({ctx:t,x:e,y:i}):this._drawWithOptions(t)}_drawWithOptions(t){var e,i,s,n,r,o,a;const h=Object.assign(Object.assign({},t),{rotation:null!==(e=t.rotation)&&void 0!==e?e:this.rotation,drawWidth:null!==(i=t.drawWidth)&&void 0!==i?i:this.drawWidth,drawHeight:null!==(s=t.drawHeight)&&void 0!==s?s:this.drawHeight,flipHorizontal:null!==(n=t.flipHorizontal)&&void 0!==n?n:this.flipHorizontal,flipVertical:null!==(r=t.flipVertical)&&void 0!==r?r:this.flipVertical,anchor:null!==(o=t.anchor)&&void 0!==o?o:this.anchor,opacity:null!==(a=t.opacity)&&void 0!==a?a:this._opacity});let c;this._updateValues(),this.currentFrame<this.sprites.length&&(c=this.sprites[this.currentFrame],c.draw(h)),-1!==this.freezeFrame&&this.currentFrame>=this.sprites.length&&(c=this.sprites[y(this.freezeFrame,0,this.sprites.length-1)],c.draw(h)),c&&(this.drawWidth=c.drawWidth,this.drawHeight=c.drawHeight)}play(t,e){this.reset(),this._engine.playAnimation(this,t,e)}}class pe extends(re(de)){constructor(t,e,i,s){super(t,e,i,s)}}!function(t){t[t.ShortestPath=0]="ShortestPath",t[t.LongestPath=1]="LongestPath",t[t.Clockwise=2]="Clockwise",t[t.CounterClockwise=3]="CounterClockwise"}(ce||(ce={}));var fe=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};class ge{constructor(t,e,i,s,n){this.actor=t,this.easingFcn=n,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=new H(0,0),this._lerpEnd=new H(0,0),this._initialized=!1,this._stopped=!1,this._distance=0,this._lerpDuration=s,this._lerpEnd=new H(e,i)}_initialize(){this._lerpStart=new H(this.actor.pos.x,this.actor.pos.y),this._currentLerpTime=0,this._distance=this._lerpStart.distance(this._lerpEnd)}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let e=this.actor.pos.x,i=this.actor.pos.y;this._currentLerpTime<this._lerpDuration?(e=this._lerpEnd.x<this._lerpStart.x?this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),i=this._lerpEnd.y<this._lerpStart.y?this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this.actor.vel.x=(e-this.actor.pos.x)/(t/1e3),this.actor.vel.y=(i-this.actor.pos.y)/(t/1e3)):(this.actor.pos.x=this._lerpEnd.x,this.actor.pos.y=this._lerpEnd.y,this.actor.vel=H.Zero)}isComplete(t){return this._stopped||new H(t.pos.x,t.pos.y).distance(this._lerpStart)>=this._distance}reset(){this._initialized=!1}stop(){this.actor.vel.y=0,this.actor.vel.x=0,this._stopped=!0}}class _e{constructor(t,e,i,s){this._started=!1,this._stopped=!1,this._actor=t,this._end=new H(e,i),this._speed=s}update(t){this._started||(this._started=!0,this._start=new H(this._actor.pos.x,this._actor.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());const e=this._dir.scale(this._speed);this._actor.vel.x=e.x,this._actor.vel.y=e.y,this.isComplete(this._actor)&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)}isComplete(t){return this._stopped||new H(t.pos.x,t.pos.y).distance(this._start)>=this._distance}stop(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0}reset(){this._started=!1}}class me{constructor(t,e,i,s){if(this._started=!1,this._stopped=!1,this._actor=t,this._speed=s,this._offset=new H(e,i),s<=0)throw O.getInstance().error("Attempted to moveBy with speed less than or equal to zero : "+s),new Error("Speed must be greater than 0 pixels per second")}update(t){this._started||(this._started=!0,this._start=new H(this._actor.pos.x,this._actor.pos.y),this._end=this._start.add(this._offset),this._distance=this._offset.size,this._dir=this._end.sub(this._start).normalize()),this._actor.vel=this._dir.scale(this._speed),this.isComplete(this._actor)&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)}isComplete(t){return this._stopped||t.pos.distance(this._start)>=this._distance}stop(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0}reset(){this._started=!1}}class ye{constructor(t,e,i){this._started=!1,this._stopped=!1,this._actor=t,this._actorToFollow=e,this._current=new H(this._actor.pos.x,this._actor.pos.y),this._end=new H(e.pos.x,e.pos.y),this._maximumDistance=void 0!==i?i:this._current.distance(this._end),this._speed=0}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._actorToFollow.vel.x,2)+Math.pow(this._actorToFollow.vel.y,2));if(0!==e&&(this._speed=e),this._current.x=this._actor.pos.x,this._current.y=this._actor.pos.y,this._end.x=this._actorToFollow.pos.x,this._end.y=this._actorToFollow.pos.y,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){const t=this._dir.scale(this._speed);this._actor.vel.x=t.x,this._actor.vel.y=t.y}else this._actor.vel.x=0,this._actor.vel.y=0;this.isComplete()&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)}stop(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0}isComplete(){return this._stopped}reset(){this._started=!1}}class we{constructor(t,e,i){this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._actor=t,this._actorToMeet=e,this._current=new H(this._actor.pos.x,this._actor.pos.y),this._end=new H(e.pos.x,e.pos.y),this._speed=i||0,void 0!==i&&(this._speedWasSpecified=!0)}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._actorToMeet.vel.x,2)+Math.pow(this._actorToMeet.vel.y,2));0===e||this._speedWasSpecified||(this._speed=e),this._current.x=this._actor.pos.x,this._current.y=this._actor.pos.y,this._end.x=this._actorToMeet.pos.x,this._end.y=this._actorToMeet.pos.y,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();const i=this._dir.scale(this._speed);this._actor.vel.x=i.x,this._actor.vel.y=i.y,this.isComplete()&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)}isComplete(){return this._stopped||this._distanceBetween<=1}stop(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0}reset(){this._started=!1}}class ve{constructor(t,e,i,s){this._started=!1,this._stopped=!1,this._actor=t,this._end=e,this._speed=i,this._rotationType=s||ce.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._actor.rotation;const t=Math.abs(this._end-this._start),e=f-t;switch(t>e?(this._shortDistance=e,this._longDistance=t):(this._shortDistance=t,this._longDistance=e),this._shortestPathIsPositive=(this._start-this._end+f)%f>=Math.PI,this._rotationType){case ce.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case ce.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case ce.Clockwise:this._direction=1,this._shortestPathIsPositive?this._distance=this._shortDistance:this._distance=this._longDistance;break;case ce.CounterClockwise:this._direction=-1,this._shortestPathIsPositive?this._distance=this._longDistance:this._distance=this._shortDistance}}this._actor.rx=this._direction*this._speed,this.isComplete()&&(this._actor.rotation=this._end,this._actor.rx=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._actor.rotation-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._actor.rx=0,this._stopped=!0}reset(){this._started=!1}}class be{constructor(t,e,i,s){this._started=!1,this._stopped=!1,this._actor=t,this._speed=i,this._offset=e,this._rotationType=s||ce.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._actor.rotation,this._end=this._start+this._offset;const t=Math.abs(this._end-this._start),e=f-t;switch(t>e?(this._shortDistance=e,this._longDistance=t):(this._shortDistance=t,this._longDistance=e),this._shortestPathIsPositive=(this._start-this._end+f)%f>=Math.PI,this._rotationType){case ce.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case ce.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case ce.Clockwise:this._direction=1,this._shortDistance>=0?this._distance=this._shortDistance:this._distance=this._longDistance;break;case ce.CounterClockwise:this._direction=-1,this._shortDistance<=0?this._distance=this._shortDistance:this._distance=this._longDistance}}this._actor.rx=this._direction*this._speed,this.isComplete()&&(this._actor.rotation=this._end,this._actor.rx=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._actor.rotation-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._actor.rx=0,this._stopped=!0}reset(){this._started=!1}}let xe=class{constructor(t,e,i,s,n){this._started=!1,this._stopped=!1,this._actor=t,this._endX=e,this._endY=i,this._speedX=s,this._speedY=n}update(t){if(this._started||(this._started=!0,this._startX=this._actor.scale.x,this._startY=this._actor.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._actor.scale.x-this._startX)>=this._distanceX)this._actor.sx=0;else{const t=this._endY<this._startY?-1:1;this._actor.sx=this._speedX*t}if(Math.abs(this._actor.scale.y-this._startY)>=this._distanceY)this._actor.sy=0;else{const t=this._endY<this._startY?-1:1;this._actor.sy=this._speedY*t}this.isComplete()&&(this._actor.scale.x=this._endX,this._actor.scale.y=this._endY,this._actor.sx=0,this._actor.sy=0)}isComplete(){return this._stopped||Math.abs(this._actor.scale.y-this._startX)>=this._distanceX&&Math.abs(this._actor.scale.y-this._startY)>=this._distanceY}stop(){this._actor.sx=0,this._actor.sy=0,this._stopped=!0}reset(){this._started=!1}};xe=fe([W({message:"ex.Action.ScaleTo will be removed in v0.25.0",alternateMethod:"Set width and hight directly"})],xe);let Ae=class{constructor(t,e,i,s){this._started=!1,this._stopped=!1,this._actor=t,this._offset=new H(e,i),this._speedX=this._speedY=s}update(t){this._started||(this._started=!0,this._startScale=this._actor.scale.clone(),this._endScale=this._startScale.add(this._offset),this._distanceX=Math.abs(this._endScale.x-this._startScale.x),this._distanceY=Math.abs(this._endScale.y-this._startScale.y),this._directionX=this._endScale.x<this._startScale.x?-1:1,this._directionY=this._endScale.y<this._startScale.y?-1:1),this._actor.sx=this._speedX*this._directionX,this._actor.sy=this._speedY*this._directionY,this.isComplete()&&(this._actor.scale=this._endScale,this._actor.sx=0,this._actor.sy=0)}isComplete(){return this._stopped||Math.abs(this._actor.scale.x-this._startScale.x)>=this._distanceX&&Math.abs(this._actor.scale.y-this._startScale.y)>=this._distanceY}stop(){this._actor.sx=0,this._actor.sy=0,this._stopped=!0}reset(){this._started=!1}};Ae=fe([W({message:"ex.Action.ScaleBy will be removed in v0.25.0",alternateMethod:"Set width and hight directly"})],Ae);class Pe{constructor(t,e){this._elapsedTime=0,this._started=!1,this._stopped=!1,this._actor=t,this._delay=e}update(t){this._started||(this._started=!0),this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._elapsedTime+=t}isComplete(){return this._stopped||this._elapsedTime>=this._delay}stop(){this._stopped=!0}reset(){this._elapsedTime=0,this._started=!1}}class Se{constructor(t,e,i,s=1){this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._actor=t,this._timeVisible=e,this._timeNotVisible=i,this._duration=(e+i)*s}update(t){this._started||(this._started=!0),this._elapsedTime+=t,this._totalTime+=t,this._actor.visible&&this._elapsedTime>=this._timeVisible&&(this._actor.visible=!1,this._elapsedTime=0),!this._actor.visible&&this._elapsedTime>=this._timeNotVisible&&(this._actor.visible=!0,this._elapsedTime=0),this.isComplete()&&(this._actor.visible=!0)}isComplete(){return this._stopped||this._totalTime>=this._duration}stop(){this._actor.visible=!0,this._stopped=!0}reset(){this._started=!1,this._elapsedTime=0,this._totalTime=0}}class Ee{constructor(t,e,i){this._multiplier=1,this._started=!1,this._stopped=!1,this._actor=t,this._endOpacity=e,this._speed=i}update(t){this._started||(this._started=!0,this._endOpacity<this._actor.opacity?this._multiplier=-1:this._multiplier=1),this._speed>0&&(this._actor.opacity+=this._multiplier*(Math.abs(this._actor.opacity-this._endOpacity)*t)/this._speed),this._speed-=t,this.isComplete()&&(this._actor.opacity=this._endOpacity),O.getInstance().debug("[Action fade] Actor opacity:",this._actor.opacity)}isComplete(){return this._stopped||Math.abs(this._actor.opacity-this._endOpacity)<.05}stop(){this._stopped=!0}reset(){this._started=!1}}class Ce{constructor(t){this._stopped=!1,this._actor=t}update(t){this._actor.actionQueue.clearActions(),this._actor.kill(),this._stopped=!0}isComplete(){return this._stopped}stop(){}reset(){}}class Te{constructor(t,e){this._method=null,this._actor=null,this._hasBeenCalled=!1,this._actor=t,this._method=e}update(t){this._method.call(this._actor),this._hasBeenCalled=!0}isComplete(){return this._hasBeenCalled}reset(){this._hasBeenCalled=!1}stop(){this._hasBeenCalled=!0}}class Me{constructor(t,e,i){this._stopped=!1,this._actor=t,this._actionQueue=new De(t),this._repeat=e,this._originalRepeat=e;const s=i.length;for(let t=0;t<s;t++)i[t].reset(),this._actionQueue.add(i[t])}update(t){this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._actionQueue.hasNext()||(this._actionQueue.reset(),this._repeat--),this._actionQueue.update(t)}isComplete(){return this._stopped||this._repeat<=0}stop(){this._stopped=!0}reset(){this._repeat=this._originalRepeat}}class Be{constructor(t,e){this._stopped=!1,this._actor=t,this._actionQueue=new De(t);const i=e.length;for(let t=0;t<i;t++)e[t].reset(),this._actionQueue.add(e[t])}update(t){this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._stopped||(this._actionQueue.hasNext()||this._actionQueue.reset(),this._actionQueue.update(t))}isComplete(){return this._stopped}stop(){this._stopped=!0,this._actionQueue.clearActions()}reset(){}}class De{constructor(t){this._actions=[],this._completedActions=[],this._actor=t}add(t){this._actions.push(t)}remove(t){const e=this._actions.indexOf(t);this._actions.splice(e,1)}clearActions(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()}getActions(){return this._actions.concat(this._completedActions)}hasNext(){return this._actions.length>0}reset(){this._actions=this.getActions();const t=this._actions.length;for(let e=0;e<t;e++)this._actions[e].reset();this._completedActions=[]}update(t){this._actions.length>0&&(this._currentAction=this._actions[0],this._currentAction.update(t),this._currentAction.isComplete(this._actor)&&this._completedActions.push(this._actions.shift()))}}var Re,ke=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};class Oe{static CreateReversibleEasingFunction(t){return(e,i,s,n)=>s<i?i-(t(e,s,i,n)-s):t(e,i,s,n)}static CreateReversableEasingFunction(t){return Oe.CreateReversibleEasingFunction(t)}static CreateVectorEasingFunction(t){return(e,i,s,n)=>new H(t(e,i.x,s.x,n),t(e,i.y,s.y,n))}}Oe.Linear=Oe.CreateReversibleEasingFunction((t,e,i,s)=>(i-=e)*t/s+e),Oe.EaseInQuad=Oe.CreateReversibleEasingFunction((t,e,i,s)=>(i-=e)*(t/=s)*t+e),Oe.EaseOutQuad=Oe.CreateReversibleEasingFunction((t,e,i,s)=>-(i-=e)*(t/=s)*(t-2)+e),Oe.EaseInOutQuad=Oe.CreateReversibleEasingFunction((t,e,i,s)=>(i-=e,(t/=s/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e)),Oe.EaseInCubic=Oe.CreateReversibleEasingFunction((t,e,i,s)=>(i-=e)*(t/=s)*t*t+e),Oe.EaseOutCubic=Oe.CreateReversibleEasingFunction((t,e,i,s)=>(t/=s,(i-=e)*(--t*t*t+1)+e)),Oe.EaseInOutCubic=Oe.CreateReversibleEasingFunction((t,e,i,s)=>(i-=e,(t/=s/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e)),ke([W({message:"Alias for incorrect spelling used in older versions, will be removed in v0.25.0",alternateMethod:"CreateReversibleEasingFunction"})],Oe,"CreateReversableEasingFunction",null);class Fe{constructor(){this._actors=[],this._queues=[],null!==arguments&&(this._actors=Array.prototype.slice.call(arguments,0),this._queues=this._actors.map(t=>t.actionQueue))}clearActions(){const t=this._queues.length;for(let e=0;e<t;e++)this._queues[e].clearActions()}addActorToContext(t){this._actors.push(t),this._queues.push(t.actionQueue)}removeActorFromContext(t){const e=this._actors.indexOf(t);e>-1&&(this._actors.splice(e,1),this._queues.splice(e,1))}easeTo(t,e,i,s=Oe.Linear){const n=this._queues.length;for(let r=0;r<n;r++)this._queues[r].add(new ge(this._actors[r],t,e,i,s));return this}moveTo(t,e,i){const s=this._queues.length;for(let n=0;n<s;n++)this._queues[n].add(new _e(this._actors[n],t,e,i));return this}moveBy(t,e,i){const s=this._queues.length;for(let n=0;n<s;n++)this._queues[n].add(new me(this._actors[n],t,e,i));return this}rotateTo(t,e,i){const s=this._queues.length;for(let n=0;n<s;n++)this._queues[n].add(new ve(this._actors[n],t,e,i));return this}rotateBy(t,e,i){const s=this._queues.length;for(let n=0;n<s;n++)this._queues[n].add(new be(this._actors[n],t,e,i));return this}scaleTo(t,e,i,s){const n=this._queues.length;for(let r=0;r<n;r++)this._queues[r].add(new xe(this._actors[r],t,e,i,s));return this}scaleBy(t,e,i){const s=this._queues.length;for(let n=0;n<s;n++)this._queues[n].add(new Ae(this._actors[n],t,e,i));return this}blink(t,e,i=1){const s=this._queues.length;for(let n=0;n<s;n++)this._queues[n].add(new Se(this._actors[n],t,e,i));return this}fade(t,e){const i=this._queues.length;for(let s=0;s<i;s++)this._queues[s].add(new Ee(this._actors[s],t,e));return this}delay(t){const e=this._queues.length;for(let i=0;i<e;i++)this._queues[i].add(new Pe(this._actors[i],t));return this}die(){const t=this._queues.length;for(let e=0;e<t;e++)this._queues[e].add(new Ce(this._actors[e]));return this}callMethod(t){const e=this._queues.length;for(let i=0;i<e;i++)this._queues[i].add(new Te(this._actors[i],t));return this}repeat(t){if(!t)return this.repeatForever(),this;const e=this._queues.length;for(let i=0;i<e;i++)this._queues[i].add(new Me(this._actors[i],t,this._actors[i].actionQueue.getActions()));return this}repeatForever(){const t=this._queues.length;for(let e=0;e<t;e++)this._queues[e].add(new Be(this._actors[e],this._actors[e].actionQueue.getActions()));return this}follow(t,e){const i=this._queues.length;for(let s=0;s<i;s++)void 0===e?this._queues[s].add(new ye(this._actors[s],t)):this._queues[s].add(new ye(this._actors[s],t,e));return this}meet(t,e){const i=this._queues.length;for(let s=0;s<i;s++)void 0===e?this._queues[s].add(new we(this._actors[s],t)):this._queues[s].add(new we(this._actors[s],t,e));return this}asPromise(){const t=this._queues.map((t,e)=>new Promise(i=>{t.add(new Te(this._actors[e],()=>{i()}))}));return Promise.all(t)}}class Ie{static Box(t,e,i=H.Half,s=H.Zero){return new jt({points:new qt(-t*i.x,-e*i.y,t-t*i.x,e-e*i.y).getPoints(),offset:s})}static Polygon(t,e=!1,i=H.Zero){return new jt({points:t,offset:i,clockwiseWinding:e})}static Circle(t,e=H.Zero){return new Wt({radius:t,offset:e})}static Edge(t,e){return new Ht({begin:t,end:e})}}class Le{constructor({actor:t,collider:e}){if(this.oldPos=new H(0,0),this.vel=new H(0,0),this.oldVel=new H(0,0),this.acc=new H(0,0),this.oldAcc=H.Zero,this.torque=0,this.motion=10,this.oldRotation=0,this.scale=H.One,this.oldScale=H.One,this.sx=0,this.sy=0,this.rx=0,this._geometryDirty=!1,this._totalMtv=H.Zero,!t&&!e)throw new Error("An actor or collider are required to create a body");this.actor=t,this.collider=!e&&t?this.useBoxCollider(t.width,t.height,t.anchor):e}get id(){return this.actor?this.actor.id:-1}clone(){return new Le({actor:null,collider:this.collider.clone()})}get active(){return!!this.actor&&!this.actor.isKilled()}get center(){return this.pos}set collider(t){t&&(this._collider=t,this._collider.body=this,this._wireColliderEventsToActor())}get collider(){return this._collider}get transform(){return this.actor.components.transform}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}addMtv(t){this._totalMtv.addEqual(t)}applyMtv(){this.pos.addEqual(this._totalMtv),this._totalMtv.setTo(0,0)}markCollisionShapeDirty(){this._geometryDirty=!0}get isColliderShapeDirty(){return this._geometryDirty}captureOldTransform(){this.oldVel.setTo(this.vel.x,this.vel.y),this.oldPos.setTo(this.pos.x,this.pos.y),this.oldAcc.setTo(this.acc.x,this.acc.y),this.oldScale.setTo(this.scale.x,this.scale.y),this.oldRotation=this.rotation}integrate(t){const e=t/1e3,i=this.acc.clone();this.collider.type===et.Active&&i.addEqual(st.acc),this.vel.addEqual(i.scale(e)),this.pos.addEqual(this.vel.scale(e)).addEqual(i.scale(.5*e*e)),this.rx+=this.torque*(1/this.collider.inertia)*e,this.rotation+=this.rx*e,this.scale.x+=this.sx*t/1e3,this.scale.y+=this.sy*t/1e3,this.scale.equals(this.oldScale)||(this._geometryDirty=!0),this.collider.update(),this._geometryDirty=!1}useBoxCollider(t,e,i=H.Half,s=H.Zero){return null==t&&(t=this.actor?this.actor.width:0),null==e&&(e=this.actor?this.actor.height:0),this.collider.shape=Ie.Box(t,e,i,s),this.collider}usePolygonCollider(t,e=H.Zero){return this.collider.shape=Ie.Polygon(t,!1,e),this.collider}useCircleCollider(t,e=H.Zero){return this.collider.shape=Ie.Circle(t,e),this.collider}useEdgeCollider(t,e){return this.collider.shape=Ie.Edge(t,e),this.collider}_wireColliderEventsToActor(){this.collider.clear(),this.collider.on("precollision",t=>{this.actor&&this.actor.emit("precollision",new Et(t.target.body.actor,t.other.body.actor,t.side,t.intersection))}),this.collider.on("postcollision",t=>{this.actor&&this.actor.emit("postcollision",new Ct(t.target.body.actor,t.other.body.actor,t.side,t.intersection))}),this.collider.on("collisionstart",t=>{this.actor&&this.actor.emit("collisionstart",new Tt(t.target.body.actor,t.other.body.actor,t.pair))}),this.collider.on("collisionend",t=>{this.actor&&this.actor.emit("collisionend",new Mt(t.target.body.actor,t.other.body.actor))})}}class Ue{update(t,e){const i=t.eventDispatcher;if(t.body.collider.type!==et.PreventCollision&&e.currentScene&&e.currentScene.tileMaps)for(let s=0;s<e.currentScene.tileMaps.length;s++){const n=e.currentScene.tileMaps[s];let r,o=p.None,a=2;for(;(r=n.collides(t))&&!(a--<0);)o=qt.getSideFromIntersection(r),i.emit("precollision",new Et(t,null,o,r)),t.body.collider.type===et.Active&&(t.pos.y+=r.y,t.pos.x+=r.x,i.emit("postcollision",new Ct(t,null,o,r)))}}}class ze{constructor(){this._topLeft=new H(0,0),this._topRight=new H(0,0),this._bottomLeft=new H(0,0),this._bottomRight=new H(0,0)}isSpriteOffScreen(t,e){const i=t.currentDrawing.drawWidth,s=t.currentDrawing.drawHeight,n=t.rotation,r=t.center,o=t.getWorldPos();this._topLeft.x=o.x-i/2,this._topLeft.y=o.y-s/2,this._topLeft=this._topLeft.rotate(n,r),this._topRight.x=o.x+i/2,this._topRight.y=o.y-s/2,this._topRight=this._topRight.rotate(n,r),this._bottomLeft.x=o.x-i/2,this._bottomLeft.y=o.y+s/2,this._bottomLeft=this._bottomLeft.rotate(n,r),this._bottomRight.x=o.x+i/2,this._bottomRight.y=o.y+s/2,this._bottomRight=this._bottomRight.rotate(n,r);const a=e.worldToScreenCoordinates(this._topLeft),h=e.worldToScreenCoordinates(this._topRight),c=e.worldToScreenCoordinates(this._bottomLeft),l=e.worldToScreenCoordinates(this._bottomRight);this._xCoords=[],this._yCoords=[],this._xCoords.push(a.x,h.x,c.x,l.x),this._yCoords.push(a.y,h.y,c.y,l.y),this._xMin=Math.min.apply(null,this._xCoords),this._yMin=Math.min.apply(null,this._yCoords),this._xMax=Math.max.apply(null,this._xCoords),this._yMax=Math.max.apply(null,this._yCoords);const u=e.screenToWorldCoordinates(new H(this._xMin,this._yMin)),d=e.screenToWorldCoordinates(new H(this._xMax,this._yMax));this._xMinWorld=u.x,this._yMinWorld=u.y,this._xMaxWorld=d.x,this._yMaxWorld=d.y;const p=[new H(this._xMin,this._yMin),new H(this._xMax,this._yMin),new H(this._xMin,this._yMax),new H(this._xMax,this._yMax)];if(p[0].x<0&&p[1].x>e.canvas.clientWidth&&(p[0].y>0||p[2].y<e.canvas.clientHeight))return!1;if(p[0].y<0&&p[2].y>e.canvas.clientHeight&&(p[1].x>0||p[0].x<e.canvas.clientWidth))return!1;for(let t=0;t<p.length;t++)if(p[t].x>0&&p[t].y>0&&p[t].x<e.canvas.clientWidth&&p[t].y<e.canvas.clientHeight)return!1;return!0}debugDraw(t){t.beginPath(),t.strokeStyle=Q.White.toString(),t.rect(this._xMinWorld,this._yMinWorld,this._xMaxWorld-this._xMinWorld,this._yMaxWorld-this._yMinWorld),t.stroke(),t.fillStyle=Q.Red.toString(),t.beginPath(),t.arc(this._topLeft.x,this._topLeft.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=Q.Green.toString(),t.beginPath(),t.arc(this._topRight.x,this._topRight.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=Q.Blue.toString(),t.beginPath(),t.arc(this._bottomLeft.x,this._bottomLeft.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=Q.Magenta.toString(),t.beginPath(),t.arc(this._bottomRight.x,this._bottomRight.y,5,0,2*Math.PI),t.closePath(),t.fill()}}class Ne{constructor(){this.cullingBox=new ze}update(t,e){const i=t.eventDispatcher;let s=!0;null!=t.currentDrawing&&(s=this.cullingBox.isSpriteOffScreen(t,e));let n=!1;e&&e.currentScene&&e.currentScene.camera&&e.currentScene.camera.viewport&&!t.parent&&(n=!e.currentScene.camera.viewport.intersect(t.body.collider.bounds)),t.isOffScreen?n&&s||(i.emit("enterviewport",new Ot(t)),t.isOffScreen=!1):n&&s&&(i.emit("exitviewport",new kt(t)),t.isOffScreen=!0)}}class We{update(t,e){t.enableCapturePointer&&(t.isKilled()||e.input.pointers.checkAndUpdateActorUnderPointer(t))}}function He(t,e=Q.Red,i,s,n,r,o=1,a="butt"){t.beginPath(),t.lineWidth=o,t.lineCap=a,t.strokeStyle=e.toString(),t.moveTo(i,s),t.lineTo(n,r),t.closePath(),t.stroke()}function je(t,e=Q.Red,i){t.beginPath(),t.strokeStyle=e.toString(),t.arc(i.x,i.y,5,0,2*Math.PI),t.closePath(),t.stroke()}function qe(t,e,i,s,n=1){const r=e?e.toString():"blue",o=s.scale(n);t.beginPath(),t.strokeStyle=r,t.moveTo(i.x,i.y),t.lineTo(i.x+o.x,i.y+o.y),t.closePath(),t.stroke()}function Ke(t,e,i,s,n,r=5,o=Q.White,a=null){let h;if("number"==typeof r)h={tl:r,tr:r,br:r,bl:r};else{const t={tl:0,tr:0,br:0,bl:0};for(const e in t)if(t.hasOwnProperty(e)){const i=e;h[i]=r[i]||t[i]}}t.beginPath(),t.moveTo(e+h.tl,i),t.lineTo(e+s-h.tr,i),t.quadraticCurveTo(e+s,i,e+s,i+h.tr),t.lineTo(e+s,i+n-h.br),t.quadraticCurveTo(e+s,i+n,e+s-h.br,i+n),t.lineTo(e+h.bl,i+n),t.quadraticCurveTo(e,i+n,e,i+n-h.bl),t.lineTo(e,i+h.tl),t.quadraticCurveTo(e,i,e+h.tl,i),t.closePath(),a&&(t.fillStyle=a.toString(),t.fill()),o&&(t.strokeStyle=o.toString(),t.stroke())}function Ve(t,e,i,s,n=Q.White,r=null){t.beginPath(),t.arc(e,i,s,0,2*Math.PI),t.closePath(),r&&(t.fillStyle=r.toString(),t.fill()),n&&(t.strokeStyle=n.toString(),t.stroke())}class Ge{constructor(t,e,i){this._name=t,this._category=e,this._mask=i}get name(){return this._name}get category(){return this._category}get mask(){return this._mask}canCollide(t){return 0!=(this.category&t.mask)&&0!=(t.category&this.mask)}}Ge.All=new Ge("Collide with all groups",-1,-1);class Xe{constructor(t,e){this.colliderA=t,this.colliderB=e,this.id=null,this.collision=null,this.id=Xe.calculatePairHash(t,e)}static canCollide(t,e){return!!t.group.canCollide(e.group)&&((t.type!==et.Fixed||e.type!==et.Fixed)&&(e.type!==et.PreventCollision&&t.type!==et.PreventCollision&&!(!t.active||!e.active)))}get canCollide(){const t=this.colliderA,e=this.colliderB;return Xe.canCollide(t,e)}collide(){this.collision=this.colliderA.collide(this.colliderB)}resolve(t){this.collision&&this.collision.resolve(t)}static calculatePairHash(t,e){return t.id<e.id?`#${t.id}+${e.id}`:`#${e.id}+${t.id}`}debugDraw(t){this.collision&&(st.showContacts&&je(t,Q.Red,this.collision.point),st.showCollisionNormals&&qe(t,Q.Cyan,this.collision.point,this.collision.normal,30))}}function Qe(t){return t instanceof Ze}class Ze{constructor({body:t,type:e,group:i,shape:s,offset:n,useShapeInertia:r=!0}){this._events=new Xt(this),this.type=et.PreventCollision,this.group=Ge.All,this.mass=1,this.inertia=1e3,this.friction=.99,this.bounciness=.2,t&&t.collider&&!s?this._shape=t.collider.shape:(this._shape=s,this.body=t),this.useShapeInertia=r,this._shape.collider=this,this.type=e||this.type,this.group=i||this.group,this.offset=n||H.Zero}clone(){return new Ze({body:null,type:this.type,shape:this._shape.clone(),group:this.group,offset:this.offset})}get id(){return this.body?this.body.id:-1}get shape(){return this._shape}set shape(t){this._shape=t,this._shape.collider=this,this.useShapeInertia&&(this.inertia=isNaN(this._shape.inertia)?this.inertia:this._shape.inertia)}get center(){return this.bounds.center}get active(){return this.body.active}collide(t){return this.shape.collide(t.shape)}getClosestLineBetween(t){return this.shape.getClosestLineBetween(t.shape)}get offset(){return this.shape.offset.clone()}set offset(t){this.shape.offset=t.clone()}touching(t){const e=new Xe(this,t);return e.collide(),!!e.collision}get bounds(){return this.shape?this.shape.bounds:this.body?(new qt).translate(this.body.pos):new qt}get localBounds(){return this.shape?this.shape.localBounds:new qt}update(){this.shape&&this.shape.recalc()}emit(t,e){this._events.emit(t,e)}on(t,e){this._events.on(t,e)}off(t,e){this._events.off(t,e)}once(t,e){this._events.once(t,e)}clear(){this._events.clear()}debugDraw(t){st.showMotionVectors&&(qe(t,Q.Yellow,this.body.pos,this.body.acc.add(st.acc)),qe(t,Q.Red,this.body.pos,this.body.vel),je(t,Q.Red,this.body.pos)),st.showBounds&&this.bounds.debugDraw(t,Q.Yellow),st.showArea&&this.shape.debugDraw(t,Q.Green)}}class Ye{constructor(){this.owner=null}clone(){const t=new this.constructor;for(const i in this)if(this.hasOwnProperty(i)){const s=this[i];(null==(e=s)?void 0:e.clone)&&"owner"!==i&&"clone"!==i?t[i]=s.clone():t[i]=s}var e;return t}}class Je extends Ye{constructor(t,e){super(),this.type=t,this.value=e}}class $e{constructor(){this.observers=[]}register(t){this.observers.push(t)}unregister(t){const e=this.observers.indexOf(t);-1!==e&&this.observers.splice(e,1)}notifyAll(t){this.observers.forEach(e=>e.notify(t))}}class ti{constructor(){this.eventDispatcher=new Xt(this)}on(t,e){this.eventDispatcher.on(t,e)}off(t,e){this.eventDispatcher.off(t,e)}emit(t,e){this.eventDispatcher.emit(t,e)}once(t,e){this.eventDispatcher.once(t,e)}}class ei{constructor(t){this.data=t,this.type="Component Added"}}function ii(t){return!!t&&"Component Added"===t.type}class si{constructor(t){this.data=t,this.type="Component Removed"}}function ni(t){return!!t&&"Component Removed"===t.type}class ri extends ti{constructor(){super(...arguments),this.id=ri._ID++,this.active=!0,this._tagsMemo=[],this._typesMemo=[],this._componentsToRemove=[],this._handleChanges={defineProperty:(t,e,i)=>(t[e]=i.value,this._rebuildMemos(),this.changes.notifyAll(new ei({component:i.value,entity:this})),!0),deleteProperty:(t,e)=>e in t&&(this.changes.notifyAll(new si({component:t[e],entity:this})),delete t[e],this._rebuildMemos(),!0)},this.components=new Proxy({},this._handleChanges),this.changes=new $e,this._isInitialized=!1}kill(){this.active=!1}isKilled(){return!this.active}get tags(){return this._tagsMemo}hasTag(t){return this.tags.includes(t)}get types(){return this._typesMemo}_rebuildMemos(){this._tagsMemo=Object.values(this.components).filter(t=>t instanceof Je).map(t=>t.type),this._typesMemo=Object.keys(this.components)}clone(){const t=new ri;for(const e of this.types)t.addComponent(this.components[e].clone());return t}addComponent(t,e=!1){if(t instanceof ri)for(const i in t.components)this.addComponent(t.components[i].clone(),e);else{if(this.components[t.type]&&!e)return this;if(this.components[t.type]&&e&&this.removeComponent(t),t.dependencies&&t.dependencies.length)for(const e of t.dependencies)this.addComponent(new e);t.owner=this,this.components[t.type]=t,t.onAdd&&t.onAdd(this)}return this}removeComponent(t,e=!1){return e?"string"==typeof t?this._removeComponentByType(t):t instanceof Ye&&this._removeComponentByType(t.type):this._componentsToRemove.push(t),this}_removeComponentByType(t){this.components[t]&&(this.components[t].owner=null,this.components[t].onRemove&&this.components[t].onRemove(this),delete this.components[t])}processComponentRemoval(){for(const t of this._componentsToRemove){const e="string"==typeof t?t:t.type;this._removeComponentByType(e)}this._componentsToRemove.length=0}has(t){return!!this.components[t]}get isInitialized(){return this._isInitialized}_initialize(t){this.isInitialized||(this.onInitialize(t),super.emit("initialize",new Bt(t,this)),this._isInitialized=!0)}_preupdate(t,e){this.emit("preupdate",new ft(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new gt(t,e,this)),this.onPostUpdate(t,e)}onInitialize(t){}onPreUpdate(t,e){}onPostUpdate(t,e){}}ri._ID=0;class oi extends Ye{constructor(t){var e;super(),this.draw=t,this.type="canvas",this.draw=null!==(e=this.draw)&&void 0!==e?e:()=>{}}}!function(t){t.World="world",t.Screen="screen"}(Re||(Re={}));class ai extends Ye{constructor(){super(...arguments),this.type="transform",this.coordPlane=Re.World,this.pos=H.Zero,this.z=0,this.rotation=0,this.scale=H.One}}var hi=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};function ci(t){return t instanceof ui}class li extends ri{constructor(t,e,i,s,n){super(),this._height=0,this._width=0,this.isOffScreen=!1,this.visible=!0,this.opacity=1,this.previousOpacity=1,this.logger=O.getInstance(),this.scene=null,this.parent=null,this.children=[],this.frames={},this.currentDrawing=null,this._draggable=!1,this._dragging=!1,this._pointerDragStartHandler=()=>{this._dragging=!0},this._pointerDragEndHandler=()=>{this._dragging=!1},this._pointerDragMoveHandler=t=>{this._dragging&&(this.pos=t.pointer.lastWorldPos)},this._pointerDragLeaveHandler=t=>{this._dragging&&(this.pos=t.pointer.lastWorldPos)},this.traits=[],this.enableCapturePointer=!1,this.capturePointer={captureMoveEvents:!1,captureDragEvents:!1},this._isKilled=!1,this._capturePointerEvents=["pointerup","pointerdown","pointermove","pointerenter","pointerleave","pointerdragstart","pointerdragend","pointerdragmove","pointerdragenter","pointerdragleave"],this._captureMoveEvents=["pointermove","pointerenter","pointerleave","pointerdragmove","pointerdragenter","pointerdragleave"],this._captureDragEvents=["pointerdragstart","pointerdragend","pointerdragmove","pointerdragenter","pointerdragleave"],this._initDefaults(),this.addComponent(new ai),this.addComponent(new oi((t,e)=>this.draw(t,e)));let r=!0,o=et.Passive;if(t&&"object"==typeof t){const n=t;n.pos?(t=n.pos?n.pos.x:0,e=n.pos?n.pos.y:0):(t=n.x||0,e=n.y||0),i=n.width,s=n.height,n.body&&(r=!1,this.body=n.body),n.anchor&&(this.anchor=n.anchor),n.collisionType&&(o=n.collisionType)}this._width=i||0,this._height=s||0,r&&(this.body=new Le({collider:new Ze({type:o,shape:Ie.Box(this._width,this._height,this.anchor)})})),this.pos.x=t||0,this.pos.y=e||0,n&&(this.color=n,this.opacity=n.a),this.traits.push(new Ue),this.traits.push(new Ne),this.traits.push(new We),this.actionQueue=new De(this),this.actions=new Fe(this)}get body(){return this._body}set body(t){this._body=t,this._body.actor=this}get pos(){return this.body.pos}set pos(t){this.body.pos.setTo(t.x,t.y)}get oldPos(){return this.body.oldPos}set oldPos(t){this.body.oldPos.setTo(t.x,t.y)}get vel(){return this.body.vel}set vel(t){this.body.vel.setTo(t.x,t.y)}get oldVel(){return this.body.oldVel}set oldVel(t){this.body.oldVel.setTo(t.x,t.y)}get acc(){return this.body.acc}set acc(t){this.body.acc.setTo(t.x,t.y)}set oldAcc(t){this.body.oldAcc.setTo(t.x,t.y)}get oldAcc(){return this.body.oldAcc}get rotation(){return this.body.rotation}set rotation(t){this.body.rotation=t}get rx(){return this.body.rx}set rx(t){this.body.rx=t}get scale(){return this.body.scale}set scale(t){this.body.scale=t}get oldScale(){return this.body.oldScale}set oldScale(t){this.body.oldScale=t}get sx(){return this.body.sx}set sx(t){this.body.sx=t}get sy(){return this.body.sy}set sy(t){this.body.sy=t}get draggable(){return this._draggable}set draggable(t){t&&(t&&!this._draggable?(this.on("pointerdragstart",this._pointerDragStartHandler),this.on("pointerdragend",this._pointerDragEndHandler),this.on("pointerdragmove",this._pointerDragMoveHandler),this.on("pointerdragleave",this._pointerDragLeaveHandler)):!t&&this._draggable&&(this.off("pointerdragstart",this._pointerDragStartHandler),this.off("pointerdragend",this._pointerDragEndHandler),this.off("pointerdragmove",this._pointerDragMoveHandler),this.off("pointerdragleave",this._pointerDragLeaveHandler)),this._draggable=t)}get color(){return this._color}set color(t){this._color=t.clone()}onInitialize(t){}_initialize(t){super._initialize(t);for(const e of this.children)e._initialize(t)}_initDefaults(){this.anchor=ui.defaults.anchor.clone()}_checkForPointerOptIn(t){if(t){const e=t.toLowerCase();-1!==this._capturePointerEvents.indexOf(e)&&(this.enableCapturePointer=!0,-1!==this._captureMoveEvents.indexOf(e)&&(this.capturePointer.captureMoveEvents=!0),-1!==this._captureDragEvents.indexOf(e)&&(this.capturePointer.captureDragEvents=!0))}}on(t,e){this._checkForPointerOptIn(t),super.on(t,e)}once(t,e){this._checkForPointerOptIn(t),super.once(t,e)}off(t,e){super.off(t,e)}_prekill(t){super.emit("prekill",new ot(this)),this.onPreKill(t)}onPreKill(t){}_postkill(t){super.emit("postkill",new at(this)),this.onPostKill(t)}onPostKill(t){}kill(){this.scene?(this._prekill(this.scene),this.emit("kill",new rt(this)),this._isKilled=!0,this.scene.remove(this),this._postkill(this.scene)):this.logger.warn("Cannot kill actor, it was never added to the Scene")}unkill(){this._isKilled=!1}isKilled(){return this._isKilled}add(t){t.body.collider.type=et.PreventCollision,S(t,this.children)&&(t.parent=this,this.scene&&this.scene.world.add(t))}remove(t){E(t,this.children)&&(t.parent=null)}setDrawing(t){t=t.toString(),this.currentDrawing!==this.frames[t]&&(null!=this.frames[t]?(this.frames[t].reset(),this.currentDrawing=this.frames[t]):O.getInstance().error(`the specified drawing key ${t} does not exist`)),this.currentDrawing&&this.currentDrawing instanceof pe&&this.currentDrawing.tick(0)}addDrawing(){2===arguments.length?(this.frames[arguments[0]]=arguments[1],this.currentDrawing||(this.currentDrawing=arguments[1])):(arguments[0]instanceof he&&this.addDrawing("default",arguments[0]),arguments[0]instanceof ue&&this.addDrawing("default",arguments[0].asSprite()))}get z(){return this.getZIndex()}set z(t){this.setZIndex(t)}getZIndex(){return this.components.transform.z}setZIndex(t){this.components.transform.z=t}get center(){return new H(this.pos.x+this.width/2-this.anchor.x*this.width,this.pos.y+this.height/2-this.anchor.y*this.height)}get width(){return this._width*this.getGlobalScale().x}set width(t){this._width=t/this.scale.x,this.body.collider.shape=Ie.Box(this._width,this._height,this.anchor),this.body.markCollisionShapeDirty()}get height(){return this._height*this.getGlobalScale().y}set height(t){this._height=t/this.scale.y,this.body.collider.shape=Ie.Box(this._width,this._height,this.anchor),this.body.markCollisionShapeDirty()}getWorldRotation(){return this.parent?this.rotation+this.parent.getWorldRotation():this.rotation}getWorldPos(){if(!this.parent)return this.pos.clone();const t=[];let e=this;for(t.push(this);e.parent;)e=e.parent,t.push(e);const i=t.reduceRight((t,e)=>e.parent?t+e.pos.x*e.getGlobalScale().x:t+e.pos.x,0),s=t.reduceRight((t,e)=>e.parent?t+e.pos.y*e.getGlobalScale().y:t+e.pos.y,0),n=e.getWorldPos(),r=this.getWorldRotation();return new H(i,s).rotate(r,n)}getGlobalScale(){if(!this.parent)return new H(this.scale.x,this.scale.y);const t=this.parent.getGlobalScale();return new H(this.scale.x*t.x,this.scale.y*t.y)}contains(t,e,i=!1){const s=this.getWorldPos().sub(this.pos),n=this.body.collider.bounds.translate(s).contains(new H(t,e));return i?n||this.children.some(i=>i.contains(t,e,!0)):n}within(t,e){return this.body.collider.shape.getClosestLineBetween(t.body.collider.shape).getLength()<=e}update(t,e){this._initialize(t),this._preupdate(t,e);const i=this.currentDrawing;i&&i instanceof pe&&i.tick(e,t.stats.currFrame.id),this.actionQueue.update(e),this.color&&(this.color.a=this.opacity),0===this.opacity&&(this.visible=!1),this.body.captureOldTransform(),this.body.integrate(e);for(const i of this.traits)i.update(this,t,e);for(let i=0;i<this.children.length;i++)this.children[i].update(t,e);this._postupdate(t,e)}onPreUpdate(t,e){}onPostUpdate(t,e){}_preupdate(t,e){this.emit("preupdate",new ft(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new ft(t,e,this)),this.onPostUpdate(t,e)}draw(t,e){if(t.save(),t.translate(-this._width*this.anchor.x,-this._height*this.anchor.y),this._predraw(t,e),this.currentDrawing){const e=this.currentDrawing,i=(this._width-e.width*e.scale.x)*this.anchor.x,s=(this._height-e.height*e.scale.y)*this.anchor.y;this.currentDrawing.draw({ctx:t,x:i,y:s,opacity:this.opacity})}else this.color&&this.body&&this.body.collider&&this.body.collider.shape&&this.body.collider.shape.draw(t,this.color,new H(0,0));t.restore(),this._postdraw(t,e)}onPreDraw(t,e){}onPostDraw(t,e){}_predraw(t,e){this.emit("predraw",new lt(t,e,this)),this.onPreDraw(t,e)}_postdraw(t,e){this.emit("postdraw",new lt(t,e,this)),this.onPostDraw(t,e)}debugDraw(t){this.emit("predebugdraw",new dt(t,this)),this.body.collider.debugDraw(t);const e=this.body.collider.localBounds.translate(this.getWorldPos());e.debugDraw(t),t.fillText("id: "+this.id,e.left+3,e.top+10),t.fillStyle=Q.Yellow.toString(),t.beginPath(),t.arc(this.getWorldPos().x,this.getWorldPos().y,3,0,2*Math.PI),t.closePath(),t.fill();for(let e=0;e<this.traits.length;e++)this.traits[e]instanceof Ne&&this.traits[e].cullingBox.debugDraw(t);t.strokeStyle=Q.Yellow.toString(),t.beginPath();const i=Math.min(this.width,this.height);t.arc(this.getWorldPos().x,this.getWorldPos().y,i,0,2*Math.PI),t.closePath(),t.stroke();const s={"0 Pi":0,"Pi/2":Math.PI/2,Pi:Math.PI,"3/2 Pi":3*Math.PI/2},n=t.font;for(const e in s)t.fillStyle=Q.Yellow.toString(),t.font="14px",t.textAlign="center",t.fillText(e,this.getWorldPos().x+Math.cos(s[e])*(i+10),this.getWorldPos().y+Math.sin(s[e])*(i+10));t.font=n;for(let e=0;e<this.children.length;e++)this.children[e].debugDraw(t);this.emit("postdebugdraw",new pt(t,this))}getAncestors(){const t=[this];let e,i=this;for(;e=i.parent;)i=e,t.push(i);return t.reverse()}}li.defaults={anchor:H.Half},hi([W({message:"ex.Actor.sx will be removed in v0.25.0",alternateMethod:"Set width and height directly in constructor"})],li.prototype,"sx",null),hi([W({message:"ex.Actor.sy will be removed in v0.25.0",alternateMethod:"Set width and height directly in constructor"})],li.prototype,"sy",null);class ui extends(re(li)){constructor(t,e,i,s,n){super(t,e,i,s,n)}}class di{static create(){return this._INSTANCE||(window.AudioContext||window.webkitAudioContext)&&(this._INSTANCE=new window.AudioContext),this._INSTANCE}}di._INSTANCE=null;class pi{static unlock(){return new Promise((t,e)=>{if(pi._UNLOCKED||!di.create())return t(!0);const i=setTimeout(()=>{O.getInstance().warn("Excalibur was unable to unlock the audio context, audio probably will not play in this browser."),t()},200),s=di.create();s.resume().then(()=>{const e=s.createBuffer(1,1,22050),n=s.createBufferSource();let r=!1;n.buffer=e,n.connect(s.destination),n.onended=()=>r=!0,n.start(0),setTimeout(()=>{!function(t){return!!t.playbackState}(n)?(s.currentTime>0||r)&&(pi._UNLOCKED=!0):n.playbackState!==n.PLAYING_STATE&&n.playbackState!==n.FINISHED_STATE||(pi._UNLOCKED=!0)},0),clearTimeout(i),t()},()=>{e()})})}static isUnlocked(){return this._UNLOCKED}}pi._UNLOCKED=!1;var fi=i(79),gi=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{h(s.next(t))}catch(t){r(t)}}function a(t){try{h(s.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((s=s.apply(t,e||[])).next())}))};class _i extends ti{constructor(t){super(),this._resourceList=[],this._index=0,this._playButtonShown=!1,this._resourceCount=0,this._numLoaded=0,this._progressCounts={},this._totalCounts={},this.logo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdQAAAB2CAYAAABxhGI9AAAACXBIWXMAAAsSAAALEgHS3X78AAAKnUlEQVR42u3dP2wjSx0H8N8hJIonIRmJjsq0SBR+BQ1dcqKhe0lD77SvSwpKkJKGPulpktfRIMUdEqKIqV57rpAokM4dbSiyq7ONPTP7x39ifz7SFbnEnp3xer47O7uzH15fXwMA6OYHmgAABCoACFQAEKgAgEAFAIEKAAIVAAQqACBQAUCgAoBABQCBCgAIVAAQqAAgUAFAoAIAAhUABCoACFQAEKgAgECFLbmOiNeFf2PbAyz68Pr6qhUgbRwR92v+/zwiJrYHMEKFMmcN///UtgcQqFBk1PD/97U9Qx8VCFSgu4EmAIEKAAIVAAQqACBQ4Z25jojP8eX+0WtNAgIVaOY+Im5j+eKh24h41jQgUIEyZ7F5NaPU7wCBCiwYd/w9cOB+qAlgJ3KLLow0EV198803RWvJfvfddx+0lhEqHKu5JgAjVCBvlhmFzjQRXUekHz9+TP79y8uLRjNChXfvoePvAYEKxNtj1e42/O5JoIJABcrdRMRVLM+X3kTEpaaB988cKuzWg9EobTWdMx0Oly8uN4dqhAoARqgnaN3arHfqu7OyH8ItKLVB/P+CEfMTHyGPY3npx1m8zWGDEeoBfUk/xdti57dr/r1Wv2+6EPow3tZ5rRdS72s1neuF97xvWd+XTH0/V+UMttDWqbI/r2nrxfp+jv2uSjSO7S+OXy/A/3lN+9xX5T5HxEUPZZ0tfB71+w57eJ/HFu+z+jkv1u92YX9fbI/HhX3JA9rp5MPr66tWaG9UfUGbrHIzi7cLUyYFf/tpTady03EEeL8mUJ6i7MKYNvWNqr4Pe2jradXO60LrvPAz2PQ5RPX684ah8dxD+2zantnCgVipSVV+m/tgB9W2DDq2Sx/vM95wcHhZhWVJm8yrv58cSgfTdc70+++/X/r522+/tUKSEepBqo+om4ZLPerMjUwuNnQCtx1GWJtee1FwdD5uWd86xLs8UaVt2aNEO1/saZ/Z5rYMW4zq6v34rGV9Bg3q2eZ9SkeNm9qwyUh30OPIHYFKx5FG03C7znSOqYBq+qW/zpQ3anH037TNHluG6f0WPsPhHvab4QFty7ogOeuxDYcNy2/zu2214WNYWxmBurNO8bGn97pNBOO8xy/9uCorZZ4I2r4C7aJgO7ZV9iE49Dm6NvOWx+pWE9CUq3zbdTp9doz38TbXtzqH9RT5CyWe422OaZoZGeZCabrhPQY9HjwsjpTvCg4YtlE2+Ta/j2bzn8fqrDqgm+6yUHOmAvWUjAtGhbNYvsBknDnqH1Qhc7VmxHgeb/NbudA5j/UXlYwif2p6luhAc9teu1npiHKnDs8if6tCm7JLX3NKpgttXe9ruc9mHMd7a83iwdxF5vt8tutARaCeklRnNK9C8WnNF7geJQ4T4XG3JhSnVdilQrG+yOnrlVHfsEGYzhNBn7Lu6tS7+HJafJQ4EMiNlNqWXZ9WPvVgnVYHG5M1ByDXkT6leX2EgTqJtyt45yv7S2qO3sEZjZhDLXeR+YKdJ0Zdk8QocvH9N732KrNtq+FZ/zzIHABcJrYpd+Xv14lOd5ap76SgrduW/VTQ1qcQpqnbgu4ifZvUMNpd9XuoZmvCtPaQ2Y/BCHVLgbrJTeRPDdVf6pfMKDU2fOkHmVFFfXr3MsouLsnNvV5kRoe5+s431PeuoKPqWnaurY/ZPBEeqwceN4l96iwO6H7Mjq4y7VGPVNe10VaZMzVCPVWpI/Z6FZbcv5fMqGCU+dLfFGzj58jP8+bCdJCo7yzKTwdOF0bu9Ug7V4c+yz7FJfYeGoysUss0HssIdVZwYLDujMqlESoCdTtGsZtbHnJBeNdDSJSs0jTKdMJN1HNX54Wv7bvsU9NkVJVa13dX+/wuArV0X/l5RHyo/lnfF4G6p6DrS0kHdtXhy35TGErDPYZUn2WfWqDOo/lVqdMD2O/hKJhD7S/odukymq9s02QN4EEPR/zbaOumZc+r15zK1Zqznl9jsfiemTM1QmV3HUuTkedlg9HIQzRbUD93dfC+2tpj2fIHEH2+RqCCQH13gZq7hWXTNpVu19OB1fc9nQ0AKOKUb5lU0P1kDyOneoWk0lOZ9cIP0x7qu8+2BhCoR2wYu1+e7DmaXzBSsu5vaX1ne2zrpmUPTmxf7PM1Dm4y/vC7ny7Nif7+z/9ZmtM0Z3panPLtPmra9f16bcK0Dpbnwk43Vd/RHtu6zfNQTy1QBy3aqG2g9nVmxml+BOoJyT3NpWmn9xhfFnu4bvDa+44BXhqqfdf3uUF9+yz77AT31Yue2mjecYQ62NLfgkA9ghHqLNEhNem4H1c6vdyDxhf/bpz5m4coW/c39wi6VH2bPtHlcaV9cvXts+zxCe6rTeqc2ndL7uGd93QwM9bFcAzMoZZ7SgTBbWx+asui61h/iq1+RmjqdbnQXQ3T1DNQ63V/U9ucqm/pMzPb1rePsk/1iTOjgvatR4W3Lc8ULB78pELyrnAfeTcj1NU509/86mfJ33/8+Mf00a05UyPUEw7UVCeWG/WNEiExyHRMt5ltW30izUPk18ytt7lNfc8i//DvtvXto+ySA5BjljsLUF8lPkqMPEtW1JomDsiGBZ9Byb4NAvUITSN9GuwsIj6t6UTOqk7jJREkmzqli8xIs96udSO20sX0H1vW92IL9e1a9rgqVyf91gbPsTy9UD9n9lOkT8k+RfkFR5PMNqxOcdSf32PBvg3vilO+zdxE+okx9Wm0ph36XYsRZCpMF993GOk5qvqB3Dct6jvssb67KvuUNJ3frw92bhr8/STSF0JdRPMLpUCgnsgo9S76PZ246ZFk1wWvK5m3vVoYvW1Sz7nN91jfXbQ1ZQc7TW6HeaoOalypG/8/p/rP1aNAc6ZHzSnfdqPUPhdy2PQw6Nz9gSVhuhiqueUHR3uu7y7K3rdDX4u46ZrPbUa0IFBZ0seKQ3XQTRt2vm3W/a2DbNKys++rvm3ep6+y1x2UdP3bWU9lzra47U1GmlctX/sQ23t+aOlByLTh/4NAPaCRxtcdO5HLSJ/6vNtCwGx67VPmPbvWd1q9frKHtp4kAqRJ2HR9j762JfX3bZ//elPtj13PPDx1+D5tqk/Xi6NO8SHz7MmH19dXrdBNfVFP6T2PT1UHNit87/t4m5+aRH+nQBdvqyhZDKJLfZs8h7XPsqdV2ZOV+tanKB8aln0dyxdAXbV4j4gvt4oMOrbP6vbU73NW7TMlbdTnPrWpfqXfh9HKZ9vke7KuTeZRNtXRSe6+1FV//ce/ln5eXfsXgcqXzr6+9261M3moOoa7E6nvTZTfy7iNsmfb7kjfgXGsvxe0vihsEts9HTquPpt1q1vtahu2TqAiUAEEKj0zhwoARqgAu/OnX/442WH+9xc/Wvr58re/Tr7f41/+ZsRqhAoACFQAEKgAcHjMoQJskJsz/eqrr5Z+vvr7v5fmQFevAl5lztQIFQAQqAAgUAHgIJlDBdhgdQ41N2eKESoAIFABQKACwFEwhwoARqgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAEKgAgUAFAoAKAQAUAgQoACFQAEKgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAQqAAgUAFAoAKAQAUAlvwPcFDns1DsH4sAAAAASUVORK5CYII=",this.logoWidth=468,this.logoHeight=118,this.loadingBarColor=Q.White,this.backgroundColor="#176BAA",this.suppressPlayButton=!1,this._playButtonStyles=fi.a.toString(),this.playButtonText="Play game",this.startButtonFactory=()=>{const t=document.createElement("button");return t.id="excalibur-play",t.textContent=this.playButtonText,t.style.display="none",t},t&&this.addResources(t)}get _image(){return this._imageElement||(this._imageElement=new Image,this._imageElement.src=this.logo),this._imageElement}get playButtonRootElement(){return this._playButtonRootElement}get playButtonElement(){return this._playButtonElement}get _playButton(){return this._playButtonRootElement||(this._playButtonRootElement=document.createElement("div"),this._playButtonRootElement.id="excalibur-play-root",this._playButtonRootElement.style.position="absolute",document.body.appendChild(this._playButtonRootElement)),this._styleBlock||(this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._playButtonStyles,document.head.appendChild(this._styleBlock)),this._playButtonElement||(this._playButtonElement=this.startButtonFactory(),this._playButtonRootElement.appendChild(this._playButtonElement)),this._playButtonElement}wireEngine(t){this._engine=t}addResource(t){const e=this._index++;this._resourceList.push(t),this._progressCounts[e]=0,this._totalCounts[e]=1,this._resourceCount++}addResources(t){let e=0;const i=t.length;for(;e<i;e++)this.addResource(t[e])}isLoaded(){return this._numLoaded===this._resourceCount}showPlayButton(){if(this.suppressPlayButton)return Promise.resolve();return this._playButtonShown=!0,this._playButton.style.display="block",new Promise(t=>{this._playButton.addEventListener("click",()=>t()),this._playButton.addEventListener("touchend",()=>t()),this._playButton.addEventListener("pointerup",()=>t())})}hidePlayButton(){this._playButtonShown=!1,this._playButton.style.display="none"}dispose(){this._playButtonRootElement.parentElement&&(this._playButtonRootElement.removeChild(this._playButtonElement),document.body.removeChild(this._playButtonRootElement),document.head.removeChild(this._styleBlock),this._playButtonRootElement=null,this._playButtonElement=null,this._styleBlock=null)}update(t,e){}load(){return gi(this,void 0,void 0,(function*(){return yield Promise.all(this._resourceList.map(t=>t.load().finally(()=>{this._numLoaded++}))),yield R(200),yield this.showPlayButton(),yield pi.unlock(),this.hidePlayButton(),this.data=this._resourceList}))}markResourceComplete(){this._numLoaded++}get progress(){return this._resourceCount>0?y(this._numLoaded,0,this._resourceCount)/this._resourceCount:1}draw(t){const e=this._engine.canvasHeight/this._engine.pixelRatio,i=this._engine.canvasWidth/this._engine.pixelRatio;if(this._playButtonRootElement){const s=t.canvas.offsetLeft,n=t.canvas.offsetTop,r=this._playButton.clientWidth,o=this._playButton.clientHeight;this.playButtonPosition?(this._playButtonRootElement.style.left=`${this.playButtonPosition.x}px`,this._playButtonRootElement.style.top=`${this.playButtonPosition.y}px`):(this._playButtonRootElement.style.left=`${s+i/2-r/2}px`,this._playButtonRootElement.style.top=`${n+e/2-o/2+100}px`)}t.fillStyle=this.backgroundColor,t.fillRect(0,0,i,e);let s=e/2;const n=Math.min(this.logoWidth,.75*i);let r=i/2-n/2;this.logoPosition&&(r=this.logoPosition.x,s=this.logoPosition.y);const o=Math.floor(n*(this.logoHeight/this.logoWidth)),a=this._engine.getAntialiasing();if(this._engine.setAntialiasing(!0),this.logoPosition?t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,r,s,n,o):t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,r,s-o-20,n,o),!this.suppressPlayButton&&this._playButtonShown)return void this._engine.setAntialiasing(a);let h=r,c=s;this.loadingBarPosition&&(h=this.loadingBarPosition.x,c=this.loadingBarPosition.y),t.lineWidth=2,Ke(t,h,c,n,20,10,this.loadingBarColor);const l=n*this.progress-10;Ke(t,h+5,c+5,l>10?l:10,10,5,null,this.loadingBarColor),this._engine.setAntialiasing(a)}}const mi={webgl:"WebGL",webaudio:"WebAudio",gamepadapi:"Gamepad API"};class yi{constructor(){this._features=null,this.failedTests=[],this._criticalTests={canvasSupport:function(){const t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},arrayBufferSupport:function(){const t=new XMLHttpRequest;t.open("GET","/");try{t.responseType="arraybuffer"}catch(t){return!1}return"arraybuffer"===t.responseType},dataUrlSupport:function(){return 0===document.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")},objectUrlSupport:function(){return"URL"in window&&"revokeObjectURL"in URL&&"createObjectURL"in URL},rgbaSupport:function(){const t=document.createElement("a").style;return t.cssText="background-color:rgba(150,255,150,.5)",(""+t.backgroundColor).indexOf("rgba")>-1}},this._warningTest={webAudioSupport:function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext)},webglSupport:function(){const t=document.createElement("canvas");return!(!t.getContext||!t.getContext("webgl"))}},this._features=this._loadBrowserFeatures()}getBrowserFeatures(){return null===this._features&&(this._features=this._loadBrowserFeatures()),this._features}logBrowserFeatures(){let t="%cSUPPORTED BROWSER FEATURES\n==========================%c\n";const e=["font-weight: bold; color: navy","font-weight: normal; color: inherit"],i=this.getBrowserFeatures();for(const s of Object.keys(mi))i[s]?(t+="(%câ%c)",e.push("font-weight: bold; color: green"),e.push("font-weight: normal; color: inherit")):(t+="(%câ%c)",e.push("font-weight: bold; color: red"),e.push("font-weight: normal; color: inherit")),t+=" "+mi[s]+"\n";e.unshift(t),console.log.apply(console,e)}_loadBrowserFeatures(){return{canvas:(()=>this._criticalTests.canvasSupport())(),arraybuffer:(()=>this._criticalTests.arrayBufferSupport())(),dataurl:(()=>this._criticalTests.dataUrlSupport())(),objecturl:(()=>this._criticalTests.objectUrlSupport())(),rgba:(()=>this._criticalTests.rgbaSupport())(),webaudio:(()=>this._warningTest.webAudioSupport())(),webgl:(()=>this._warningTest.webglSupport())(),gamepadapi:!!navigator.getGamepads}}test(){let t=!1;for(const e in this._criticalTests)this._criticalTests[e].call(this)||(this.failedTests.push(e),O.getInstance().error("Critical browser feature missing, Excalibur requires:",e),t=!0);if(t)return!1;for(const t in this._warningTest)this._warningTest[t]()||O.getInstance().warn("Warning browser feature missing, Excalibur will have reduced performance:",t);return!0}}class wi extends ui{constructor(t,e,i,s){"object"!=typeof t?super(t,e,i,s):super(t),this.components.transform.coordPlane=Re.Screen,this.traits=[],this.traits.push(new We),this.anchor.setTo(0,0),this.body.collider.type=et.PreventCollision,this.body.collider.shape=Ie.Box(this.width,this.height,this.anchor),this.enableCapturePointer=!0}_initialize(t){this._engine=t,super._initialize(t)}contains(t,e,i=!0){if(i)return super.contains(t,e);const s=this._engine.worldToScreenCoordinates(new H(t,e));return super.contains(s.x,s.y)}}class vi{constructor(t,e,i,s){if(this.id=0,this.interval=10,this.repeats=!1,this.maxNumberOfRepeats=-1,this._elapsedTime=0,this._totalTimeAlive=0,this._paused=!1,this._numberOfTicks=0,this.complete=!1,this.scene=null,"function"!=typeof t){const n=t;t=n.fcn,e=n.interval,i=n.repeats,s=n.numberOfRepeats}if(s&&s>=0&&(this.maxNumberOfRepeats=s,!i))throw new Error("repeats must be set to true if numberOfRepeats is set");this.id=vi.id++,this.interval=e||this.interval,this.repeats=i||this.repeats,this._callbacks=[],t&&this.on(t)}on(t){this._callbacks.push(t)}off(t){const e=this._callbacks.indexOf(t);this._callbacks.splice(e,1)}update(t){this._paused||(this._totalTimeAlive+=t,this._elapsedTime+=t,this.maxNumberOfRepeats>-1&&this._numberOfTicks>=this.maxNumberOfRepeats&&(this.complete=!0),!this.complete&&this._elapsedTime>=this.interval&&(this._callbacks.forEach(t=>{t.call(this)}),this._numberOfTicks++,this.repeats?this._elapsedTime=0:this.complete=!0))}reset(t,e){if(t&&t>=0&&(this.interval=t),this.maxNumberOfRepeats&&this.maxNumberOfRepeats>=0&&(this.maxNumberOfRepeats=e,!this.repeats))throw new Error("repeats must be set to true if numberOfRepeats is set");this.complete=!1,this._elapsedTime=0,this._numberOfTicks=0}get timesRepeated(){return this._numberOfTicks}getTimeRunning(){return this._totalTimeAlive}pause(){this._paused=!0}unpause(){this._paused=!1}cancel(){this.scene&&this.scene.cancelTimer(this)}}vi.id=0;class bi{constructor(t){this.parent=t,this.parent=t||null,this.body=null,this.bounds=new qt,this.left=null,this.right=null,this.height=0}isLeaf(){return!this.left&&!this.right}}class xi{constructor(t=new qt(-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)){this.worldBounds=t,this.root=null,this.nodes={}}_insert(t){if(null===this.root)return this.root=t,void(this.root.parent=null);const e=t.bounds;let i=this.root;for(;!i.isLeaf();){const t=i.left,s=i.right,n=i.bounds.getPerimeter(),r=i.bounds.combine(e).getPerimeter(),o=2*r,a=2*(r-n);let h=0;const c=e.combine(t.bounds);let l,u;t.isLeaf()?h=c.getPerimeter()+a:(u=t.bounds.getPerimeter(),l=c.getPerimeter(),h=l-u+a);let d=0;const p=e.combine(s.bounds);if(s.isLeaf()?d=p.getPerimeter()+a:(u=s.bounds.getPerimeter(),l=p.getPerimeter(),d=l-u+a),o<h&&o<d)break;i=h<d?t:s}const s=i.parent,n=new bi(s);n.bounds=e.combine(i.bounds),n.height=i.height+1,null!==s?(s.left===i?s.left=n:s.right=n,n.left=i,n.right=t,i.parent=n,t.parent=n):(n.left=i,n.right=t,i.parent=n,t.parent=n,this.root=n);let r=t.parent;for(;r;){if(r=this._balance(r),!r.left)throw new Error("Parent of current leaf cannot have a null left child"+r);if(!r.right)throw new Error("Parent of current leaf cannot have a null right child"+r);r.height=1+Math.max(r.left.height,r.right.height),r.bounds=r.left.bounds.combine(r.right.bounds),r=r.parent}}_remove(t){if(t===this.root)return void(this.root=null);const e=t.parent,i=e.parent;let s;if(s=e.left===t?e.right:e.left,i){i.left===e?i.left=s:i.right=s,s.parent=i;let t=i;for(;t;)t=this._balance(t),t.bounds=t.left.bounds.combine(t.right.bounds),t.height=1+Math.max(t.left.height,t.right.height),t=t.parent}else this.root=s,s.parent=null}trackBody(t){const e=new bi;e.body=t,e.bounds=t.collider.bounds,e.bounds.left-=2,e.bounds.top-=2,e.bounds.right+=2,e.bounds.bottom+=2,this.nodes[t.id]=e,this._insert(e)}updateBody(t){const e=this.nodes[t.id];if(!e)return!1;const i=t.collider.bounds;if(!this.worldBounds.contains(i))return O.getInstance().warn("Collider with id "+t.id+" is outside the world bounds and will no longer be tracked for physics"),this.untrackBody(t),!1;if(e.bounds.contains(i))return!1;this._remove(e),i.left-=st.boundsPadding,i.top-=st.boundsPadding,i.right+=st.boundsPadding,i.bottom+=st.boundsPadding;const s=t.vel.x*st.dynamicTreeVelocityMultiplier,n=t.vel.y*st.dynamicTreeVelocityMultiplier;return s<0?i.left+=s:i.right+=s,n<0?i.top+=n:i.bottom+=n,e.bounds=i,this._insert(e),!0}untrackBody(t){const e=this.nodes[t.collider.id];e&&(this._remove(e),this.nodes[t.collider.id]=null,delete this.nodes[t.collider.id])}_balance(t){if(null===t)throw new Error("Cannot balance at null node");if(t.isLeaf()||t.height<2)return t;const e=t.left,i=t.right,s=t,n=e,r=i,o=e.left,a=e.right,h=i.left,c=i.right,l=r.height-n.height;if(l>1)return r.left=s,r.parent=s.parent,s.parent=r,r.parent?r.parent.left===s?r.parent.left=r:r.parent.right=r:this.root=r,h.height>c.height?(r.right=h,s.right=c,c.parent=s,s.bounds=n.bounds.combine(c.bounds),r.bounds=s.bounds.combine(h.bounds),s.height=1+Math.max(n.height,c.height),r.height=1+Math.max(s.height,h.height)):(r.right=c,s.right=h,h.parent=s,s.bounds=n.bounds.combine(h.bounds),r.bounds=s.bounds.combine(c.bounds),s.height=1+Math.max(n.height,h.height),r.height=1+Math.max(s.height,c.height)),r;if(l<-1){if(n.left=s,n.parent=s.parent,s.parent=n,n.parent)if(n.parent.left===s)n.parent.left=n;else{if(n.parent.right!==s)throw"Error rotating Dynamic Tree";n.parent.right=n}else this.root=n;return o.height>a.height?(n.right=o,s.left=a,a.parent=s,s.bounds=r.bounds.combine(a.bounds),n.bounds=s.bounds.combine(o.bounds),s.height=1+Math.max(r.height,a.height),n.height=1+Math.max(s.height,o.height)):(n.right=a,s.left=o,o.parent=s,s.bounds=r.bounds.combine(o.bounds),n.bounds=s.bounds.combine(a.bounds),s.height=1+Math.max(r.height,o.height),n.height=1+Math.max(s.height,a.height)),n}return t}getHeight(){return null===this.root?0:this.root.height}query(t,e){const i=t.collider.bounds,s=n=>{if(n&&n.bounds.intersect(i)){if(!n.isLeaf()||n.body===t)return s(n.left)||s(n.right);if(e.call(t,n.body))return!0}return!1};s(this.root)}rayCastQuery(t,e=1/0,i){const s=n=>{if(n&&n.bounds.rayCast(t,e)){if(!n.isLeaf())return s(n.left)||s(n.right);if(i.call(t,n.body))return!0}return!1};s(this.root)}getNodes(){const t=e=>e?[e].concat(t(e.left),t(e.right)):[];return t(this.root)}debugDraw(t){const e=i=>{i&&(i.isLeaf()?(t.lineWidth=1,t.strokeStyle="green"):(t.lineWidth=1,t.strokeStyle="white"),i.bounds.debugDraw(t),i.left&&e(i.left),i.right&&e(i.right))};e(this.root)}}class Ai{constructor(){this._dynamicCollisionTree=new xi,this._collisionHash={},this._collisionPairCache=[],this._lastFramePairs=[],this._lastFramePairsHash={}}track(t){t?this._dynamicCollisionTree.trackBody(t):O.getInstance().warn("Cannot track null physics body")}untrack(t){t?this._dynamicCollisionTree.untrackBody(t):O.getInstance().warn("Cannot untrack a null physics body")}_shouldGenerateCollisionPair(t,e){const i=Xe.calculatePairHash(t,e);return!this._collisionHash[i]&&Xe.canCollide(t,e)}broadphase(t,e,i){const s=e/1e3,n=t.map(t=>t.collider).filter(t=>t.active&&t.type!==et.PreventCollision);let r;this._collisionPairCache=[],this._collisionHash={};for(let t=0,e=n.length;t<e;t++)r=n[t],this._dynamicCollisionTree.query(r.body,t=>{if(this._shouldGenerateCollisionPair(r,t.collider)){const e=new Xe(r,t.collider);this._collisionHash[e.id]=!0,this._collisionPairCache.push(e)}return!1});if(i&&(i.physics.pairs=this._collisionPairCache.length),st.checkForFastBodies)for(const t of n){if(t.type!==et.Active)continue;const e=t.body.vel.size*s+.5*t.body.acc.size*s*s,n=Math.min(t.bounds.height,t.bounds.width);if(st.disableMinimumSpeedForFastBody||e>n/2){i&&i.physics.fastBodies++;const s=t.body.pos.sub(t.body.oldPos),n=t.shape.center,r=t.shape.getFurthestPoint(t.body.vel),o=r.sub(s),a=new j(o,t.body.vel);let h;a.pos=a.pos.add(a.dir.scale(-2*st.surfaceEpsilon));let c=new H(1/0,1/0);if(this._dynamicCollisionTree.rayCastQuery(a,e+2*st.surfaceEpsilon,i=>{if(t.body!==i&&i.collider.shape&&Xe.canCollide(t,i.collider)){const t=i.collider.shape.rayCast(a,e+10*st.surfaceEpsilon);if(t){const e=t.sub(o);e.size<c.size&&(c=e,h=i)}}return!1}),h&&H.isValid(c)){const e=new Xe(t,h.collider);this._collisionHash[e.id]||(this._collisionHash[e.id]=!0,this._collisionPairCache.push(e));const s=n.sub(r);t.body.pos=o.add(s).add(c).add(a.dir.scale(2*st.surfaceEpsilon)),t.shape.recalc(),i&&i.physics.fastBodyCollisions++}}}return this._collisionPairCache}narrowphase(t,e){for(let i=0;i<t.length;i++)t[i].collide(),e&&t[i].collision&&(e.physics.collisions++,e.physics.collidersHash[t[i].id]=t[i]);return t.filter(t=>t.collision)}resolve(t,e,i){for(const s of t)s.resolve(i),s.collision&&(s.colliderA.body.applyMtv(),s.colliderB.body.applyMtv(),s.colliderA.body.integrate(e*st.collisionShift),s.colliderB.body.integrate(e*st.collisionShift));return t.filter(t=>t.canCollide)}runCollisionStartEnd(t){const e={};for(const i of t)if(e[i.id]=i,!this._lastFramePairsHash[i.id]){const t=i.colliderA,e=i.colliderB;t.emit("collisionstart",new Tt(t,e,i)),e.emit("collisionstart",new Tt(e,t,i))}for(const t of this._lastFramePairs)if(!e[t.id]){const e=t.colliderA,i=t.colliderB;e.emit("collisionend",new Mt(e,i)),i.emit("collisionend",new Mt(i,e))}this._lastFramePairs=t,this._lastFramePairsHash=e}update(t){let e=0;const i=t.length;for(let s=0;s<i;s++)this._dynamicCollisionTree.updateBody(t[s])&&e++;return e}debugDraw(t){if(st.broadphaseDebug&&this._dynamicCollisionTree.debugDraw(t),st.showContacts||st.showCollisionNormals)for(const e of this._collisionPairCache)e.debugDraw(t)}}class Pi extends ri{constructor(t,e,i,s,n,r){if(super(),this._collidingX=-1,this._collidingY=-1,this._onScreenXStart=0,this._onScreenXEnd=9999,this._onScreenYStart=0,this._onScreenYEnd=9999,this._spriteSheets={},this.logger=O.getInstance(),this.data=[],this.z=0,this.visible=!0,this.isOffscreen=!1,this.rotation=0,this.scale=H.One,t&&"object"==typeof t){const o=t;t=o.x,e=o.y,i=o.cellWidth,s=o.cellHeight,n=o.rows,r=o.cols}this.x=t,this.y=e,this.cellWidth=i,this.cellHeight=s,this.rows=n,this.cols=r,this.data=new Array(n*r);for(let o=0;o<r;o++)for(let a=0;a<n;a++)(()=>{const n=new Ti(o*i+t,a*s+e,i,s,o+a*r);this.data[o+a*r]=n})();this.addComponent(new ai),this.addComponent(new oi((t,e)=>this.draw(t,e)))}get pos(){return G(this.x,this.y)}set pos(t){this.x=t.x,this.y=t.y}on(t,e){super.on(t,e)}registerSpriteSheet(t,e){this._spriteSheets[t]=e}collides(t){const e=t.pos.x+t.width,i=t.pos.y+t.height,s=t.body.collider.bounds,n=[];if(t.width<=0||t.height<=0)return null;for(let r=s.left;r<=e;r+=Math.min(t.width/2,this.cellWidth/2))for(let e=s.top;e<=i;e+=Math.min(t.height/2,this.cellHeight/2)){const i=this.getCellByPoint(r,e);if(i&&i.solid){const e=s.intersect(i.bounds),r=t.center.sub(i.center);e&&e.dot(r)>0&&n.push(e)}}return 0===n.length?null:n.reduce((t,e)=>{let i=t.x,s=t.y;return Math.abs(t.x)<Math.abs(e.x)&&(i=e.x),Math.abs(t.y)<Math.abs(e.y)&&(s=e.y),new H(i,s)})}getCellByIndex(t){return this.data[t]}getCell(t,e){return t<0||e<0||t>=this.cols||e>=this.rows?null:this.data[t+e*this.cols]}getCellByPoint(t,e){t=Math.floor((t-this.x)/this.cellWidth),e=Math.floor((e-this.y)/this.cellHeight);const i=this.getCell(t,e);return t>=0&&e>=0&&t<this.cols&&e<this.rows&&i?i:null}onPreUpdate(t,e){}onPostUpdate(t,e){}update(t,e){this.onPreUpdate(t,e),this.emit("preupdate",new ft(t,e,this));const i=t.screenToWorldCoordinates(new H(0,0)),s=t.screenToWorldCoordinates(new H(t.canvas.clientWidth,t.canvas.clientHeight));this._onScreenXStart=Math.max(Math.floor((i.x-this.x)/this.cellWidth)-2,0),this._onScreenYStart=Math.max(Math.floor((i.y-this.y)/this.cellHeight)-2,0),this._onScreenXEnd=Math.max(Math.floor((s.x-this.x)/this.cellWidth)+2,0),this._onScreenYEnd=Math.max(Math.floor((s.y-this.y)/this.cellHeight)+2,0),this.onPostUpdate(t,e),this.emit("postupdate",new gt(t,e,this))}draw(t,e){this.emit("predraw",new lt(t,e,this));let i=this._onScreenXStart;const s=Math.min(this._onScreenXEnd,this.cols);let n=this._onScreenYStart;const r=Math.min(this._onScreenYEnd,this.rows);let o,a,h;for(;i<s;i++){for(;n<r;n++)for(o=this.getCell(i,n).sprites.filter(t=>t.spriteId>-1),a=0,h=o.length;a<h;a++){const e=this._spriteSheets[o[a].spriteSheetKey];if(e){const s=e.getSprite(o[a].spriteId);s?s.draw(t,i*this.cellWidth,n*this.cellHeight):this.logger.warn("Sprite does not exist for id",o[a].spriteId,"in sprite sheet",o[a].spriteSheetKey,s,e)}else this.logger.warn("Sprite sheet",o[a].spriteSheetKey,"does not exist",e)}n=this._onScreenYStart}this.emit("postdraw",new ut(t,e,this))}debugDraw(t){const e=this.cols*this.cellWidth,i=this.rows*this.cellHeight;t.save(),t.strokeStyle=Q.Red.toString();for(let e=0;e<this.cols+1;e++)t.beginPath(),t.moveTo(this.x+e*this.cellWidth,this.y),t.lineTo(this.x+e*this.cellWidth,this.y+i),t.stroke();for(let i=0;i<this.rows+1;i++)t.beginPath(),t.moveTo(this.x,this.y+i*this.cellHeight),t.lineTo(this.x+e,this.y+i*this.cellHeight),t.stroke();const s=Q.Red;s.a=.3,this.data.filter((function(t){return t.solid})).forEach((function(e){t.fillStyle=s.toString(),t.fillRect(e.x,e.y,e.width,e.height)})),this._collidingY>-1&&this._collidingX>-1&&(t.fillStyle=Q.Cyan.toString(),t.fillRect(this.x+this._collidingX*this.cellWidth,this.y+this._collidingY*this.cellHeight,this.cellWidth,this.cellHeight)),t.restore()}}class Si extends(re(Pi)){constructor(t,e,i,s,n,r){super(t,e,i,s,n,r)}}class Ei{constructor(t,e){this.spriteSheetKey=t,this.spriteId=e}}class Ci{constructor(t,e,i,s,n,r=!1,o=[]){if(this.solid=!1,this.sprites=[],t&&"object"==typeof t){const a=t;t=a.x,e=a.y,i=a.width,s=a.height,n=a.index,r=a.solid,o=a.sprites}this.x=t,this.y=e,this.width=i,this.height=s,this.index=n,this.solid=r,this.sprites=o,this._bounds=new qt(this.x,this.y,this.x+this.width,this.y+this.height)}get bounds(){return this._bounds}get center(){return new H(this.x+this.width/2,this.y+this.height/2)}pushSprite(t){this.sprites.push(t)}removeSprite(t){let e=-1;(e=this.sprites.indexOf(t))>-1&&this.sprites.splice(e,1)}clearSprites(){this.sprites.length=0}}class Ti extends(re(Ci)){constructor(t,e,i,s,n,r,o){super(t,e,i,s,n,r,o)}}class Mi{constructor(t){this.camera=t}lockToActor(t){this.camera.addStrategy(new Fi(t))}lockToActorAxis(t,e){this.camera.addStrategy(new Ii(t,e))}elasticToActor(t,e,i){this.camera.addStrategy(new Li(t,e,i))}radiusAroundActor(t,e){this.camera.addStrategy(new Ui(t,e))}limitCameraBounds(t){this.camera.addStrategy(new zi(t))}}var Bi,Di,Ri,ki,Oi;!function(t){t[t.X=0]="X",t[t.Y=1]="Y"}(Bi||(Bi={}));class Fi{constructor(t){this.target=t,this.action=(t,e,i,s)=>t.center}}class Ii{constructor(t,e){this.target=t,this.axis=e,this.action=(t,e,i,s)=>{const n=t.center,r=e.getFocus();return this.axis===Bi.X?new H(n.x,r.y):new H(r.x,n.y)}}}class Li{constructor(t,e,i){this.target=t,this.cameraElasticity=e,this.cameraFriction=i,this.action=(t,e,i,s)=>{const n=t.center;let r=e.getFocus(),o=e.vel.clone();const a=n.sub(r).scale(this.cameraElasticity);o=o.add(a);const h=o.scale(-1).scale(this.cameraFriction);return o=o.add(h),r=r.add(o),r}}}class Ui{constructor(t,e){this.target=t,this.radius=e,this.action=(t,e,i,s)=>{const n=t.center,r=e.getFocus(),o=n.sub(r),a=o.size;if(a>=this.radius){const t=a-this.radius;return r.add(o.normalize().scale(t))}return r}}}class zi{constructor(t){this.target=t,this.boundSizeChecked=!1,this.action=(t,e,i,s)=>{const n=e.getFocus();return this.boundSizeChecked||((t.bottom-t.top<i.drawHeight||t.right-t.left<i.drawWidth)&&O.getInstance().warn("Camera bounds should not be smaller than the engine viewport"),this.boundSizeChecked=!0),n.x<t.left+i.halfDrawWidth?n.x=t.left+i.halfDrawWidth:n.x>t.right-i.halfDrawWidth&&(n.x=t.right-i.halfDrawWidth),n.y<t.top+i.halfDrawHeight?n.y=t.top+i.halfDrawHeight:n.y>t.bottom-i.halfDrawHeight&&(n.y=t.bottom-i.halfDrawHeight),n}}}class Ni extends ti{constructor(){super(...arguments),this._cameraStrategies=[],this.strategy=new Mi(this),this.z=1,this.dz=0,this.az=0,this.rotation=0,this.rx=0,this.pos=H.Zero,this.vel=H.Zero,this.acc=H.Zero,this._cameraMoving=!1,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=null,this._lerpEnd=null,this._isShaking=!1,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._elapsedShakeTime=0,this._xShake=0,this._yShake=0,this._isZooming=!1,this._zoomStart=1,this._zoomEnd=1,this._currentZoomTime=0,this._zoomDuration=0,this._zoomEasing=Oe.EaseInOutCubic,this._easing=Oe.EaseInOutCubic,this._isInitialized=!1}get angularVelocity(){return this.rx}set angularVelocity(t){this.rx=t}get x(){return this.pos.x}set x(t){this._follow||this._cameraMoving||(this.pos.x=t)}get y(){return this.pos.y}set y(t){this._follow||this._cameraMoving||(this.pos.y=t)}get dx(){return this.vel.x}set dx(t){this.vel.x=t}get dy(){return this.vel.y}set dy(t){this.vel.y=t}get ax(){return this.acc.x}set ax(t){this.acc.x=t}get ay(){return this.acc.y}set ay(t){this.acc.y=t}getFocus(){return this.pos}move(t,e,i=Oe.EaseInOutCubic){if("function"!=typeof i)throw"Please specify an EasingFunction";return this._follow?Promise.reject(t):(this._lerpPromise&&this._lerpResolve&&this._lerpResolve(t),this._lerpPromise=new Promise(t=>{this._lerpResolve=t}),this._lerpStart=this.getFocus().clone(),this._lerpDuration=e,this._lerpEnd=t,this._currentLerpTime=0,this._cameraMoving=!0,this._easing=i,this._lerpPromise)}shake(t,e,i){this._isShaking=!0,this._shakeMagnitudeX=t,this._shakeMagnitudeY=e,this._shakeDuration=i}zoom(t,e=0,i=Oe.EaseInOutCubic){return this._zoomPromise=new Promise(t=>{this._zoomResolve=t}),e?(this._isZooming=!0,this._zoomEasing=i,this._currentZoomTime=0,this._zoomDuration=e,this._zoomStart=this.z,this._zoomEnd=t,this._zoomPromise):(this._isZooming=!1,this.z=t,Promise.resolve(!0))}getZoom(){return this.z}get viewport(){if(this._engine){const t=this._engine.halfDrawWidth,e=this._engine.halfDrawHeight;return new qt(this.x-t,this.y-e,this.x+t,this.y+e)}return new qt(0,0,0,0)}addStrategy(t){this._cameraStrategies.push(t)}removeStrategy(t){E(t,this._cameraStrategies)}clearAllStrategies(){this._cameraStrategies.length=0}_preupdate(t,e){this.emit("preupdate",new ft(t,e,this)),this.onPreUpdate(t,e)}onPreUpdate(t,e){}_postupdate(t,e){this.emit("postupdate",new gt(t,e,this)),this.onPostUpdate(t,e)}onPostUpdate(t,e){}get isInitialized(){return this._isInitialized}_initialize(t){this.isInitialized||(this.onInitialize(t),super.emit("initialize",new Bt(t,this)),this._isInitialized=!0,this._engine=t)}onInitialize(t){}on(t,e){super.on(t,e)}off(t,e){super.off(t,e)}once(t,e){super.once(t,e)}update(t,e){if(this._initialize(t),this._preupdate(t,e),this.pos=this.pos.add(this.vel.scale(e/1e3)),this.z+=this.dz*e/1e3,this.vel=this.vel.add(this.acc.scale(e/1e3)),this.dz+=this.az*e/1e3,this.rotation+=this.angularVelocity*e/1e3,this._isZooming)if(this._currentZoomTime<this._zoomDuration){const t=(0,this._zoomEasing)(this._currentZoomTime,this._zoomStart,this._zoomEnd,this._zoomDuration);this.z=t,this._currentZoomTime+=e}else this._isZooming=!1,this.z=this._zoomEnd,this._currentZoomTime=0,this._zoomResolve(!0);if(this._cameraMoving)if(this._currentLerpTime<this._lerpDuration){const t=Oe.CreateVectorEasingFunction(this._easing)(this._currentLerpTime,this._lerpStart,this._lerpEnd,this._lerpDuration);this.pos=t,this._currentLerpTime+=e}else{this.pos=this._lerpEnd;const t=this._lerpEnd.clone();this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1,this._lerpResolve(t)}this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._xShake=0,this._yShake=0):(this._elapsedShakeTime+=e,this._xShake=1+(Math.random()*this._shakeMagnitudeX|0),this._yShake=1+(Math.random()*this._shakeMagnitudeY|0));for(const i of this._cameraStrategies)this.pos=i.action.call(i,i.target,this,t,e);this._postupdate(t,e)}draw(t){const e=this.getFocus(),i=t.canvas.width,s=t.canvas.height,n=this._engine?this._engine.pixelRatio:window.devicePixelRatio,r=this.getZoom(),o=i/r/n,a=s/r/n;t.scale(r,r),t.translate(-e.x+o/2+this._xShake,-e.y+a/2+this._yShake)}debugDraw(t){const e=this.getFocus();t.fillStyle="red",t.strokeStyle="white",t.lineWidth=3,t.beginPath(),t.arc(e.x,e.y,15,0,2*Math.PI),t.closePath(),t.stroke(),t.beginPath(),t.arc(e.x,e.y,5,0,2*Math.PI),t.closePath(),t.stroke(),t.beginPath(),t.setLineDash([5,15]),t.lineWidth=5,t.strokeStyle="white",t.strokeRect(this.viewport.left,this.viewport.top,this.viewport.width,this.viewport.height),t.closePath()}_isDoneShaking(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration}}!function(t){t[t.Em=0]="Em",t[t.Rem=1]="Rem",t[t.Px=2]="Px",t[t.Pt=3]="Pt",t[t.Percent=4]="Percent"}(Di||(Di={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Start=3]="Start",t[t.End=4]="End"}(Ri||(Ri={})),function(t){t[t.Top=0]="Top",t[t.Hanging=1]="Hanging",t[t.Middle=2]="Middle",t[t.Alphabetic=3]="Alphabetic",t[t.Ideographic=4]="Ideographic",t[t.Bottom=5]="Bottom"}(ki||(ki={})),function(t){t[t.Normal=0]="Normal",t[t.Italic=1]="Italic",t[t.Oblique=2]="Oblique"}(Oi||(Oi={}));class Wi extends ui{constructor(t,e,i,s,n){super(t&&"object"==typeof t?t:{pos:new H(e,i)}),this.bold=!1,this.fontSize=10,this.fontStyle=Oi.Normal,this.fontUnit=Di.Px,this.textAlign=Ri.Left,this.baseAlign=ki.Bottom,this.letterSpacing=0,this.caseInsensitive=!0;let r="";t&&"object"==typeof t?(s=t.fontFamily,n=t.spriteFont,r=t.text):r=t,this.text=r||"",this.color=Q.Black,this.spriteFont=n,this.body.collider.type=et.PreventCollision,this.fontFamily=s||"sans-serif",this._textShadowOn=!1,this._shadowOffsetX=0,this._shadowOffsetY=0}getTextWidth(t){const e=t.font;t.font=this._fontString;const i=t.measureText(this.text).width;return t.font=e,i}_lookupFontUnit(t){switch(t){case Di.Em:return"em";case Di.Rem:return"rem";case Di.Pt:return"pt";case Di.Px:return"px";case Di.Percent:return"%";default:return"px"}}_lookupTextAlign(t){switch(t){case Ri.Left:return"left";case Ri.Right:return"right";case Ri.Center:return"center";case Ri.End:return"end";case Ri.Start:default:return"start"}}_lookupBaseAlign(t){switch(t){case ki.Alphabetic:return"alphabetic";case ki.Bottom:return"bottom";case ki.Hanging:return"hanging";case ki.Ideographic:return"ideographic";case ki.Middle:return"middle";case ki.Top:return"top";default:return"alphabetic"}}_lookupFontStyle(t){const e=this.bold?" bold":"";switch(t){case Oi.Italic:return"italic"+e;case Oi.Normal:return"normal"+e;case Oi.Oblique:return"oblique"+e;default:return"normal"+e}}setTextShadow(t,e,i){this.spriteFont.setTextShadow(t,e,i)}useTextShadow(t){this.spriteFont.useTextShadow(t)}clearTextShadow(){this._textShadowOn=!1,this._shadowOffsetX=0,this._shadowOffsetY=0}update(t,e){super.update(t,e)}draw(t,e){t.save(),this._textShadowOn&&(t.save(),t.translate(this._shadowOffsetX,this._shadowOffsetY),this._fontDraw(t),t.restore()),this._fontDraw(t),super.draw(t,e),t.restore()}_fontDraw(t){if(this.spriteFont)this.spriteFont.draw(t,this.text,0,0,{color:this.color.clone(),baseAlign:this.baseAlign,textAlign:this.textAlign,fontSize:this.fontSize,letterSpacing:this.letterSpacing,opacity:this.opacity});else{const e=t.textAlign,i=t.textBaseline;t.textAlign=this._lookupTextAlign(this.textAlign),t.textBaseline=this._lookupBaseAlign(this.baseAlign),this.color&&(this.color.a=this.opacity),t.fillStyle=this.color.toString(),t.font=this._fontString,this.maxWidth?t.fillText(this.text,0,0,this.maxWidth):t.fillText(this.text,0,0),t.textAlign=e,t.textBaseline=i}}get _fontString(){return`${this._lookupFontStyle(this.fontStyle)} ${this.fontSize}${this._lookupFontUnit(this.fontUnit)} ${this.fontFamily}`}debugDraw(t){super.debugDraw(t)}}class Hi extends(re(Wi)){constructor(t,e,i,s,n){super(t,e,i,s,n)}}const ji={pos:H.Zero,width:10,height:10,visible:!1,action:()=>{},filter:()=>!0,repeat:-1};class qi extends ui{constructor(t){super(t.pos.x,t.pos.y,t.width,t.height),this.action=()=>{},this.filter=()=>!0,this.repeat=-1,t=g({},ji,t),this.filter=t.filter||this.filter,this.repeat=t.repeat||this.repeat,this.action=t.action||this.action,t.target&&(this.target=t.target),this.visible=t.visible,this.body.collider.type=et.Passive,this.eventDispatcher=new Xt(this),this.actionQueue=new De(this),this.on("collisionstart",t=>{ci(t.other)&&this.filter(t.other)&&(this.emit("enter",new Ft(this,t.other)),this._dispatchAction(),0===this.repeat&&this.kill())}),this.on("collisionend",t=>{ci(t.other)&&this.filter(t.other)&&this.emit("exit",new It(this,t.other))})}set target(t){this._target=t,this.filter=e=>e===t}get target(){return this._target}_initialize(t){super._initialize(t)}_dispatchAction(){this.action.call(this),this.repeat--}debugDraw(t){super.debugDraw(t),t.save(),t.translate(this.pos.x,this.pos.y);const e=this.body.collider.bounds,i=this.getWorldPos();e.left=e.left-i.x,e.right=e.right-i.x,e.top=e.top-i.y,e.bottom=e.bottom-i.y,t.fillStyle=Q.Violet.toString(),t.strokeStyle=Q.Violet.toString(),t.fillText("Trigger",10,10),e.debugDraw(t),t.restore()}}function Ki(t){return t instanceof wi}var Vi;!function(t){t.Update="update",t.Draw="draw"}(Vi||(Vi={}));class Gi{constructor(){this.priority=0}notify(t){}}class Xi{constructor(t){this.data=t,this.type="Entity Added"}}function Qi(t){return!!t&&"Entity Added"===t.type}class Zi{constructor(t){this.data=t,this.type="Entity Removed"}}function Yi(t){return!!t&&"Entity Removed"===t.type}class Ji extends Gi{constructor(){super(...arguments),this.types=["transform","canvas"],this.systemType=Vi.Draw,this.priority=-1}initialize(t){this._ctx=t.engine.ctx,this._engine=t.engine,this._camera=t.camera}sort(t,e){return t.components.transform.z-e.components.transform.z}update(t,e){let i,s;this._clearScreen();const n=t.length;for(let r=0;r<n;r++)t[r].visible&&!t[r].isOffScreen&&(i=t[r].components.transform,s=t[r].components.canvas,this._ctx.save(),this._pushCameraTransform(i),this._ctx.save(),this._applyTransform(t[r]),s.draw(this._ctx,e),this._ctx.restore(),this._popCameraTransform(i),this._ctx.restore()),this._engine.isDebug&&(this._ctx.save(),this._pushCameraTransform(i),this._ctx.strokeStyle="yellow",t[r].debugDraw(this._ctx),this._popCameraTransform(i),this._ctx.restore());this._engine.isDebug&&(this._ctx.save(),this._camera.draw(this._ctx),this._camera.debugDraw(this._ctx),this._ctx.restore())}_applyTransform(t){let e=t.parent;for(;e;)this._ctx.translate(e.pos.x,e.pos.y),this._ctx.rotate(e.rotation),this._ctx.scale(e.scale.x,e.scale.y),e=e.parent;this._ctx.translate(t.pos.x,t.pos.y),this._ctx.rotate(t.rotation),this._ctx.scale(t.scale.x,t.scale.y)}_clearScreen(){this._ctx.clearRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this._ctx.fillStyle=this._engine.backgroundColor.toString(),this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}_pushCameraTransform(t){t.coordPlane===Re.World&&(this._ctx.save(),this._camera&&this._camera.draw(this._ctx))}_popCameraTransform(t){t.coordPlane===Re.World&&this._ctx.restore()}}class $i{constructor(t){this._world=t,this.entities=[],this._entityIndex={}}notify(t){ii(t)&&this._world.queryManager.addEntity(t.data.entity),ni(t)&&this._world.queryManager.removeComponent(t.data.entity,t.data.component)}addEntity(t){t&&(this._entityIndex[t.id]=t,this.entities.push(t),this._world.queryManager.addEntity(t),t.changes.register(this))}removeEntity(t){let e=0;e=t instanceof ri?t.id:t;const i=this._entityIndex[e];delete this._entityIndex[e],i&&(c.removeItemFromArray(i,this.entities),this._world.queryManager.removeEntity(i),i.changes.unregister(this))}processComponentRemovals(){for(const t of this.entities)t.processComponentRemoval()}getById(t){return this._entityIndex[t]}clear(){for(const t of this.entities)this.removeEntity(t)}}const ts=t=>[...t].sort((t,e)=>t.localeCompare(e)).join("+");class es extends $e{constructor(t){super(),this.types=t,this._entities=[]}get key(){return this._key?this._key:this._key=ts(this.types)}getEntities(t){return t&&this._entities.sort(t),this._entities}addEntity(t){!c.contains(this._entities,t)&&this.matches(t)&&(this._entities.push(t),this.notifyAll(new Xi(t)))}removeEntity(t){c.removeItemFromArray(t,this._entities)&&this.notifyAll(new Zi(t))}clear(){this._entities.length=0;for(const t of this.observers)this.unregister(t)}matches(t){let e=[];e=t instanceof ri?t.types:t;let i=!0;for(const t of this.types)if(i=i&&e.indexOf(t)>-1,!i)return!1;return i}}class is{constructor(t){this._world=t,this._queries={}}_addQuery(t){this._queries[ts(t.types)]=t;for(const e of this._world.entityManager.entities)t.addEntity(e)}maybeRemoveQuery(t){0===t.observers.length&&(t.clear(),delete this._queries[ts(t.types)])}addEntity(t){for(const e in this._queries)this._queries[e]&&this._queries[e].addEntity(t)}removeComponent(t,e){for(const i in this._queries)this._queries[i].matches(t.types.concat([e.type]))&&this._queries[i].removeEntity(t)}removeEntity(t){for(const e in this._queries)this._queries[e].removeEntity(t)}createQuery(t){const e=this.getQuery(t);if(e)return e;const i=new es(t);return this._addQuery(i),i}getQuery(t){const e=ts(t);return this._queries[e]?this._queries[e]:null}}class ss{constructor(t){this._world=t,this.systems=[]}addSystem(t){if(!t.types||0===t.types.length)throw new Error("Attempted to add a System without any types");const e=this._world.queryManager.createQuery(t.types);this.systems.push(t),this.systems.sort((t,e)=>t.priority-e.priority),e.register(t),t.initialize&&t.initialize(this._world.context)}removeSystem(t){c.removeItemFromArray(t,this.systems);const e=this._world.queryManager.getQuery(t.types);e&&(e.unregister(t),this._world.queryManager.maybeRemoveQuery(e))}updateSystems(t,e,i){const s=this.systems.filter(e=>e.systemType===t);for(const t of s)t.preupdate&&t.preupdate(e,i);for(const t of s){const e=this._world.queryManager.getQuery(t.types).getEntities(t.sort);t.update(e,i)}for(const t of s)t.postupdate&&t.postupdate(e,i)}clear(){for(const t of this.systems)this.removeSystem(t)}}class ns{constructor(t){this.context=t,this.queryManager=new is(this),this.entityManager=new $i(this),this.systemManager=new ss(this)}update(t,e){this.systemManager.updateSystems(t,this.context,e),this.entityManager.processComponentRemovals()}add(t){t instanceof ri&&this.entityManager.addEntity(t),t instanceof Gi&&this.systemManager.addSystem(t)}remove(t){t instanceof ri&&this.entityManager.removeEntity(t),t instanceof Gi&&this.systemManager.removeSystem(t)}clearEntities(){this.entityManager.clear()}clearSystems(){this.systemManager.clear()}}var rs,os,as,hs,cs,ls,us,ds=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};class ps extends ti{constructor(t){super(),this.actors=[],this.world=new ns(this),this._bodies=[],this.triggers=[],this.tileMaps=[],this._isInitialized=!1,this._broadphase=new Ai,this._killQueue=[],this._triggerKillQueue=[],this._timers=[],this._cancelQueue=[],this._logger=O.getInstance(),this.camera=new Ni,t&&(this.engine=t,this.camera.x=this.engine.halfDrawWidth,this.camera.y=this.engine.halfDrawHeight)}get screenElements(){return this.actors.filter(t=>t instanceof wi)}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}onInitialize(t){}onActivate(t,e){}onDeactivate(t,e){}onPreUpdate(t,e){}onPostUpdate(t,e){}onPreDraw(t,e){}onPostDraw(t,e){}_initializeChildren(){for(const t of this.actors)t._initialize(this.engine)}get isInitialized(){return this._isInitialized}_initialize(t){this.isInitialized||(this.engine=t,this.camera&&(this.camera.x=t.halfDrawWidth,this.camera.y=t.halfDrawHeight),this.world.add(new Ji),this.onInitialize.call(this,t),this._initializeChildren(),this._logger.debug("Scene.onInitialize",this,t),this.eventDispatcher.emit("initialize",new Bt(t,this)),this._isInitialized=!0)}_activate(t,e){this._logger.debug("Scene.onActivate",this),this.onActivate(t,e)}_deactivate(t,e){this._logger.debug("Scene.onDeactivate",this),this.onDeactivate(t,e)}_preupdate(t,e){this.emit("preupdate",new ft(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new gt(t,e,this)),this.onPostUpdate(t,e)}_predraw(t,e){this.emit("predraw",new lt(t,e,this)),this.onPreDraw(t,e)}_postdraw(t,e){this.emit("postdraw",new ut(t,e,this)),this.onPostDraw(t,e)}update(t,e){let i,s;for(this._preupdate(t,e),this.world.update(Vi.Update,e),this.camera&&this.camera.update(t,e),i=0,s=this._cancelQueue.length;i<s;i++)this.removeTimer(this._cancelQueue[i]);this._cancelQueue.length=0;for(const t of this._timers)t.update(e);for(i=0,s=this.tileMaps.length;i<s;i++)this.tileMaps[i].update(t,e);for(i=0,s=this.actors.length;i<s;i++)this.actors[i].update(t,e),this._bodies[i]=this.actors[i].body;for(i=0,s=this.triggers.length;i<s;i++)this.triggers[i].update(t,e);if(this._collectActorStats(t),t.input.pointers.dispatchPointerEvents(),this._broadphase&&st.enabled){const i=Date.now();this._broadphase.update(this._bodies,e);let s=this._broadphase.broadphase(this._bodies,e,t.stats.currFrame);const n=Date.now(),r=Date.now();let o=st.collisionPasses;const a=e/o;for(;o>0;)s=this._broadphase.narrowphase(s,t.stats.currFrame),s=this._broadphase.resolve(s,a,st.collisionResolutionStrategy),this._broadphase.runCollisionStartEnd(s),o--;const h=Date.now();t.stats.currFrame.physics.broadphase=n-i,t.stats.currFrame.physics.narrowphase=h-r}t.stats.currFrame.actors.killed=this._killQueue.length+this._triggerKillQueue.length,this._processKillQueue(this._killQueue,this.actors),this._processKillQueue(this._triggerKillQueue,this.triggers),this._postupdate(t,e)}_processKillQueue(t,e){let i;for(const s of t)s.isKilled()&&(i=e.indexOf(s),i>-1&&(e.splice(i,1),this.world.remove(s),s.children.forEach(t=>this.world.remove(t))));t.length=0}draw(t,e){this._predraw(t,e),this.world.update(Vi.Draw,e),this._postdraw(t,e)}debugDraw(t){this.emit("predebugdraw",new dt(t,this)),this._broadphase.debugDraw(t,20),this.emit("postdebugdraw",new pt(t,this))}contains(t){return this.actors.indexOf(t)>-1}add(t){t instanceof ui&&t.unkill(),t instanceof ui?C(this.actors,t)||(this._broadphase.track(t.body),t.scene=this,t instanceof qi?this.triggers.push(t):this.actors.push(t),this.world.add(t),t.children.forEach(t=>this.world.add(t))):t instanceof vi?C(this._timers,t)||this.addTimer(t):t instanceof Si&&(C(this.tileMaps,t)||this.addTileMap(t))}remove(t){if(t instanceof ui){if(!C(this.actors,t))return;this._broadphase.untrack(t.body),t instanceof qi?this._triggerKillQueue.push(t):(t.isKilled()||t.kill(),this._killQueue.push(t)),t.parent=null}t instanceof vi&&this.removeTimer(t),t instanceof Si&&this.removeTileMap(t)}addScreenElement(t){this.add(t)}removeScreenElement(t){this.remove(t)}addTileMap(t){this.tileMaps.push(t),this.world.add(t)}removeTileMap(t){const e=this.tileMaps.indexOf(t);e>-1&&(this.tileMaps.splice(e,1),this.world.remove(t))}addTimer(t){return this._timers.push(t),t.scene=this,t}removeTimer(t){const e=this._timers.indexOf(t);return-1!==e&&this._timers.splice(e,1),t}cancelTimer(t){return this._cancelQueue.push(t),t}isTimerActive(t){return this._timers.indexOf(t)>-1&&!t.complete}isCurrentScene(){return!!this.engine&&this.engine.currentScene===this}_collectActorStats(t){for(const e of this.screenElements)t.stats.currFrame.actors.ui++;for(const e of this.actors){t.stats.currFrame.actors.alive++;for(const i of e.children)Ki(i)?t.stats.currFrame.actors.ui++:t.stats.currFrame.actors.alive++}}}ds([W({message:"Will be removed in excalibur v0.26.0",alternateMethod:"ScreenElements now are normal actors with a Transform Coordinate Plane of Screen"})],ps.prototype,"screenElements",null),ds([W({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Scene.add"})],ps.prototype,"addScreenElement",null),ds([W({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Scene.remove"})],ps.prototype,"removeScreenElement",null),ds([W({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Scene.add"})],ps.prototype,"addTileMap",null),ds([W({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Scene.remove"})],ps.prototype,"removeTileMap",null),function(t){t[t.Protanope=0]="Protanope",t[t.Deuteranope=1]="Deuteranope",t[t.Tritanope=2]="Tritanope"}(rs||(rs={}));class fs{constructor(t,e=!1,i=rs.Protanope){this.engine=t,this.simulate=e,this.colorMode=i,this._vertexShader="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}",this._fragmentShader="precision mediump float;uniform sampler2D u_image;varying vec2 v_texCoord;void main() {vec4 o =  texture2D(u_image, v_texCoord);float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);//MODE CODE//vec4 error;error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);error.a = 1.0;vec4 diff = o - error;vec4 correction;correction.r = 0.0;correction.g =  (diff.r * 0.7) + (diff.g * 1.0);correction.b =  (diff.r * 0.7) + (diff.b * 1.0);correction = o + correction;correction.a = o.a;//SIMULATE//}",this._internalCanvas=document.createElement("canvas"),this._internalCanvas.width=t.drawWidth,this._internalCanvas.height=t.drawHeight,this._gl=this._internalCanvas.getContext("webgl",{preserveDrawingBuffer:!0}),this._program=this._gl.createProgram();const s=this._getShader("Fragment",this._getFragmentShaderByMode(i)),n=this._getShader("Vertex",this._vertexShader);this._gl.attachShader(this._program,n),this._gl.attachShader(this._program,s),this._gl.linkProgram(this._program),this._gl.getProgramParameter(this._program,this._gl.LINK_STATUS)||O.getInstance().error("Unable to link shader program!"),this._gl.useProgram(this._program)}_getFragmentShaderByMode(t){let e="";return t===rs.Protanope?e="float l = 0.0 * L + 2.02344 * M + -2.52581 * S;float m = 0.0 * L + 1.0 * M + 0.0 * S;float s = 0.0 * L + 0.0 * M + 1.0 * S;":t===rs.Deuteranope?e="float l = 1.0 * L + 0.0 * M + 0.0 * S;float m = 0.494207 * L + 0.0 * M + 1.24827 * S;float s = 0.0 * L + 0.0 * M + 1.0 * S;":t===rs.Tritanope&&(e="float l = 1.0 * L + 0.0 * M + 0.0 * S;float m = 0.0 * L + 1.0 * M + 0.0 * S;float s = -0.395913 * L + 0.801109 * M + 0.0 * S;"),this.simulate?this._fragmentShader=this._fragmentShader.replace("//SIMULATE//","gl_FragColor = error.rgba;"):this._fragmentShader=this._fragmentShader.replace("//SIMULATE//","gl_FragColor = correction.rgba;"),this._fragmentShader.replace("//MODE CODE//",e)}_setRectangle(t,e,i,s){const n=t,r=t+i,o=e,a=e+s;this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array([n,o,r,o,n,a,n,a,r,o,r,a]),this._gl.STATIC_DRAW)}_getShader(t,e){let i;return"Fragment"===t?i=this._gl.createShader(this._gl.FRAGMENT_SHADER):"Vertex"===t?i=this._gl.createShader(this._gl.VERTEX_SHADER):O.getInstance().error("Error unknown shader type",t),this._gl.shaderSource(i,e),this._gl.compileShader(i),this._gl.getShaderParameter(i,this._gl.COMPILE_STATUS)?i:(O.getInstance().error("Unable to compile shader!",this._gl.getShaderInfoLog(i)),null)}process(t,e){const i=this._gl.getAttribLocation(this._program,"a_position"),s=this._gl.getAttribLocation(this._program,"a_texCoord"),n=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,n),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),this._gl.STATIC_DRAW),this._gl.enableVertexAttribArray(s),this._gl.vertexAttribPointer(s,2,this._gl.FLOAT,!1,0,0);const r=this._gl.createTexture();this._gl.bindTexture(this._gl.TEXTURE_2D,r),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,1),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t);const o=this._gl.getUniformLocation(this._program,"u_resolution");this._gl.uniform2f(o,this._internalCanvas.width,this._internalCanvas.height);const a=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,a),this._gl.enableVertexAttribArray(i),this._gl.vertexAttribPointer(i,2,this._gl.FLOAT,!1,0,0),this._setRectangle(0,0,t.width,t.height),this._gl.drawArrays(this._gl.TRIANGLES,0,6);const h=new Uint8Array(t.width*t.height*4);this._gl.readPixels(0,0,t.width,t.height,this._gl.RGBA,this._gl.UNSIGNED_BYTE,h),t.data.set(h),e.putImageData(t,0,0)}}class gs{constructor(t){this._engine=t}correct(t){this._engine.postProcessors.push(new fs(this._engine,!1,t))}simulate(t){this._engine.postProcessors.push(new fs(this._engine,!0,t))}}class _s{constructor(t){this.stats={currFrame:new ms,prevFrame:new ms},this._engine=t,this.colorBlindMode=new gs(this._engine)}}class ms{constructor(){this._id=0,this._delta=0,this._fps=0,this._actorStats={alive:0,killed:0,ui:0,get remaining(){return this.alive-this.killed},get total(){return this.remaining+this.ui}},this._durationStats={update:0,draw:0,get total(){return this.update+this.draw}},this._physicsStats=new ys}reset(t){t?(this.id=t.id,this.delta=t.delta,this.fps=t.fps,this.actors.alive=t.actors.alive,this.actors.killed=t.actors.killed,this.actors.ui=t.actors.ui,this.duration.update=t.duration.update,this.duration.draw=t.duration.draw,this._physicsStats.reset(t.physics)):(this.id=this.delta=this.fps=0,this.actors.alive=this.actors.killed=this.actors.ui=0,this.duration.update=this.duration.draw=0,this._physicsStats.reset())}clone(){const t=new ms;return t.reset(this),t}get id(){return this._id}set id(t){this._id=t}get delta(){return this._delta}set delta(t){this._delta=t}get fps(){return this._fps}set fps(t){this._fps=t}get actors(){return this._actorStats}get duration(){return this._durationStats}get physics(){return this._physicsStats}}class ys{constructor(){this._pairs=0,this._collisions=0,this._collidersHash={},this._fastBodies=0,this._fastBodyCollisions=0,this._broadphase=0,this._narrowphase=0}reset(t){t?(this.pairs=t.pairs,this.collisions=t.collisions,this.collidersHash=t.collidersHash,this.fastBodies=t.fastBodies,this.fastBodyCollisions=t.fastBodyCollisions,this.broadphase=t.broadphase,this.narrowphase=t.narrowphase):(this.pairs=this.collisions=this.fastBodies=0,this.fastBodyCollisions=this.broadphase=this.narrowphase=0,this.collidersHash={})}clone(){const t=new ys;return t.reset(this),t}get pairs(){return this._pairs}set pairs(t){this._pairs=t}get collisions(){return this._collisions}set collisions(t){this._collisions=t}get collidersHash(){return this._collidersHash}set collidersHash(t){this._collidersHash=t}get fastBodies(){return this._fastBodies}set fastBodies(t){this._fastBodies=t}get fastBodyCollisions(){return this._fastBodyCollisions}set fastBodyCollisions(t){this._fastBodyCollisions=t}get broadphase(){return this._broadphase}set broadphase(t){this._broadphase=t}get narrowphase(){return this._narrowphase}set narrowphase(t){this._narrowphase=t}}!function(t){t.Num0="Numpad0",t.Num1="Numpad1",t.Num2="Numpad2",t.Num3="Numpad3",t.Num4="Numpad4",t.Num5="Numpad5",t.Num6="Numpad6",t.Num7="Numpad7",t.Num8="Numpad8",t.Num9="Numpad9",t.NumAdd="NumpadAdd",t.NumSubtract="NumpadSubtract",t.NumMultiply="NumpadMultiply",t.NumDivide="NumpadDivide",t.NumDecimal="NumpadDecimal",t.Numpad0="Numpad0",t.Numpad1="Numpad1",t.Numpad2="Numpad2",t.Numpad3="Numpad3",t.Numpad4="Numpad4",t.Numpad5="Numpad5",t.Numpad6="Numpad6",t.Numpad7="Numpad7",t.Numpad8="Numpad8",t.Numpad9="Numpad9",t.NumpadAdd="NumpadAdd",t.NumpadSubtract="NumpadSubtract",t.NumpadMultiply="NumpadMultiply",t.NumpadDivide="NumpadDivide",t.NumpadDecimal="NumpadDecimal",t.NumLock="NumLock",t.ShiftLeft="ShiftLeft",t.ShiftRight="ShiftRight",t.AltLeft="AltLeft",t.AltRight="AltRight",t.Key0="Digit0",t.Key1="Digit1",t.Key2="Digit2",t.Key3="Digit3",t.Key4="Digit4",t.Key5="Digit5",t.Key6="Digit6",t.Key7="Digit7",t.Key8="Digit8",t.Key9="Digit9",t.Digit0="Digit0",t.Digit1="Digit1",t.Digit2="Digit2",t.Digit3="Digit3",t.Digit4="Digit4",t.Digit5="Digit5",t.Digit6="Digit6",t.Digit7="Digit7",t.Digit8="Digit8",t.Digit9="Digit9",t.A="KeyA",t.B="KeyB",t.C="KeyC",t.D="KeyD",t.E="KeyE",t.F="KeyF",t.G="KeyG",t.H="KeyH",t.I="KeyI",t.J="KeyJ",t.K="KeyK",t.L="KeyL",t.M="KeyM",t.N="KeyN",t.O="KeyO",t.P="KeyP",t.Q="KeyQ",t.R="KeyR",t.S="KeyS",t.T="KeyT",t.U="KeyU",t.V="KeyV",t.W="KeyW",t.X="KeyX",t.Y="KeyY",t.Z="KeyZ",t.KeyA="KeyA",t.KeyB="KeyB",t.KeyC="KeyC",t.KeyD="KeyD",t.KeyE="KeyE",t.KeyF="KeyF",t.KeyG="KeyG",t.KeyH="KeyH",t.KeyI="KeyI",t.KeyJ="KeyJ",t.KeyK="KeyK",t.KeyL="KeyL",t.KeyM="KeyM",t.KeyN="KeyN",t.KeyO="KeyO",t.KeyP="KeyP",t.KeyQ="KeyQ",t.KeyR="KeyR",t.KeyS="KeyS",t.KeyT="KeyT",t.KeyU="KeyU",t.KeyV="KeyV",t.KeyW="KeyW",t.KeyX="KeyX",t.KeyY="KeyY",t.KeyZ="KeyZ",t.Semicolon="Semicolon",t.Quote="Quote",t.Comma="Comma",t.Minus="Minus",t.Period="Period",t.Slash="Slash",t.Equal="Equal",t.BracketLeft="BracketLeft",t.Backslash="Backslash",t.BracketRight="BracketRight",t.Backquote="Backquote",t.Up="ArrowUp",t.Down="ArrowDown",t.Left="ArrowLeft",t.Right="ArrowRight",t.ArrowUp="ArrowUp",t.ArrowDown="ArrowDown",t.ArrowLeft="ArrowLeft",t.ArrowRight="ArrowRight",t.Space="Space",t.Esc="Escape",t.Escape="Escape"}(os||(os={}));class ws extends nt{constructor(t){super(),this.key=t}}class vs extends ti{constructor(){super(),this._keys=[],this._keysUp=[],this._keysDown=[]}on(t,e){super.on(t,e)}init(t){if(!t)try{const e=()=>{};window.top.addEventListener("blur",e),window.top.removeEventListener("blur",e),t=window.top}catch(e){t=window,O.getInstance().warn("Failed to bind to keyboard events to top frame. If you are trying to embed Excalibur in a cross-origin iframe, keyboard events will not fire.")}t.addEventListener("blur",()=>{this._keys.length=0}),t.addEventListener("keyup",t=>{const e=t.code,i=this._keys.indexOf(e);this._keys.splice(i,1),this._keysUp.push(e);const s=new ws(e);this.eventDispatcher.emit("up",s),this.eventDispatcher.emit("release",s)}),t.addEventListener("keydown",t=>{const e=t.code;if(-1===this._keys.indexOf(e)){this._keys.push(e),this._keysDown.push(e);const t=new ws(e);this.eventDispatcher.emit("down",t),this.eventDispatcher.emit("press",t)}})}update(){this._keysDown.length=0,this._keysUp.length=0;for(let t=0;t<this._keys.length;t++)this.eventDispatcher.emit("hold",new ws(this._keys[t]))}getKeys(){return this._keys}wasPressed(t){return this._keysDown.indexOf(t)>-1}isHeld(t){return this._keys.indexOf(t)>-1}wasReleased(t){return this._keysUp.indexOf(t)>-1}}!function(t){t.Touch="Touch",t.Mouse="Mouse",t.Pen="Pen",t.Unknown="Unknown"}(as||(as={})),function(t){t.Canvas="Canvas",t.Document="Document"}(hs||(hs={}));class bs extends ti{constructor(){super(),this.id=bs._MAX_ID++,this._isDown=!1,this._wasDown=!1,this._actorsUnderPointer={length:0},this._actors=[],this._actorsLastFrame=[],this._actorsNoLongerUnderPointer=[],this.lastPagePos=null,this.lastScreenPos=null,this.lastWorldPos=null,this.dragTarget=null,this.on("move",this._onPointerMove),this.on("down",this._onPointerDown),this.on("up",this._onPointerUp)}get isDragging(){return this._isDown}get isDragStart(){return!this._wasDown&&this._isDown}get isDragEnd(){return this._wasDown&&!this._isDown}get hasActorsUnderPointer(){return!!this._actorsUnderPointer.length}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}update(){this._wasDown&&!this._isDown?this._wasDown=!1:!this._wasDown&&this._isDown&&(this._wasDown=!0),this._actorsLastFrame=[...this._actors],this._actorsNoLongerUnderPointer=[]}addActorUnderPointer(t){this.isActorAliveUnderPointer(t)||(this._actorsUnderPointer[t.id]=t,this._actorsUnderPointer.length+=1,this._actors.push(t)),this._actors.sort((t,e)=>t.z===e.z?t.id-e.id:t.z-e.z)}removeActorUnderPointer(t){this.isActorAliveUnderPointer(t)&&(delete this._actorsUnderPointer[t.id],this._actorsUnderPointer.length-=1,E(t,this._actors),this._actorsNoLongerUnderPointer.push(t))}getActorsUnderPointer(){return this._actors}getActorsUnderPointerLastFrame(){return this._actorsLastFrame}getActorsForEvents(){return this._actors.concat(this._actorsLastFrame).filter((t,e,i)=>i.indexOf(t)===e)}checkActorUnderPointer(t){return!!this.lastWorldPos&&t.contains(this.lastWorldPos.x,this.lastWorldPos.y,!Ki(t))}wasActorUnderPointer(t){return this._actorsLastFrame.indexOf(t)>-1}isActorAliveUnderPointer(t){return!(t.isKilled()||!t.scene||!this._actorsUnderPointer.hasOwnProperty(t.id.toString()))}_onPointerMove(t){this.lastPagePos=new H(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new H(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new H(t.worldPos.x,t.worldPos.y)}_onPointerDown(t){this.lastPagePos=new H(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new H(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new H(t.worldPos.x,t.worldPos.y),this._isDown=!0}_onPointerUp(t){this._isDown=!1,this.dragTarget=null}}bs._MAX_ID=0,function(t){t[t.NoButton=-1]="NoButton",t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Unknown=3]="Unknown"}(cs||(cs={})),function(t){t.Left="Left",t.Middle="Middle",t.Right="Right",t.Unknown="Unknown",t.NoButton="NoButton"}(ls||(ls={})),function(t){t.Pixel="Pixel",t.Line="Line",t.Page="Page"}(us||(us={}));class xs extends nt{constructor(t,e,i,s,n,r){super(),this.coordinates=t,this.pointer=e,this.index=i,this.pointerType=s,this.button=n,this.ev=r}get name(){return this._name}get worldPos(){return this.coordinates.worldPos.clone()}get pagePos(){return this.coordinates.pagePos.clone()}get screenPos(){return this.coordinates.screenPos.clone()}get pos(){return this.coordinates.worldPos.clone()}propagate(t){this.doAction(t),this.bubbles&&t.parent&&this.propagate(t.parent)}doAction(t){t&&(this._onActionStart(t),t.emit(this._name,this),this._onActionEnd(t))}_onActionStart(t){}_onActionEnd(t){}}class As{constructor(t){this._pointerEventType=t}create(t,e,i,s,n,r){return new this._pointerEventType(t,e,i,s,n,r)}}class Ps extends xs{}class Ss extends xs{constructor(){super(...arguments),this._name="pointerup"}_onActionEnd(t){this.pointer.isDragEnd&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragend",this)}}class Es extends xs{constructor(){super(...arguments),this._name="pointerdown"}_onActionEnd(t){this.pointer.isDragStart&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragstart",this)}}class Cs extends xs{constructor(){super(...arguments),this._name="pointermove"}propagate(t){this.pointer.isActorAliveUnderPointer(t)&&(this.doAction(t),this.bubbles&&t.parent&&this.propagate(t.parent))}_onActionStart(t){t.capturePointer.captureMoveEvents&&this.pointer.isDragging&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragmove",this)}}class Ts extends xs{constructor(){super(...arguments),this._name="pointerenter"}_onActionStart(t){t.capturePointer.captureMoveEvents}_onActionEnd(t){this.pointer.isDragging&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragenter",this)}}class Ms extends xs{constructor(){super(...arguments),this._name="pointerleave"}_onActionStart(t){t.capturePointer.captureMoveEvents}_onActionEnd(t){this.pointer.isDragging&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragleave",this)}}class Bs extends xs{constructor(){super(...arguments),this._name="pointercancel"}}class Ds extends nt{constructor(t,e,i,s,n,r,o,a,h,c,l,u){super(),this.x=t,this.y=e,this.pageX=i,this.pageY=s,this.screenX=n,this.screenY=r,this.index=o,this.deltaX=a,this.deltaY=h,this.deltaZ=c,this.deltaMode=l,this.ev=u}}function Rs(t,e,i,s,n,r,o){let a;switch(t){case"up":a=new As(Ss);break;case"down":a=new As(Es);break;case"move":a=new As(Cs);break;case"cancel":a=new As(Bs);break;case"enter":a=new As(Ts);break;case"leave":a=new As(Ms)}return a.create(e,i,s,n,r,o)}class ks extends ti{constructor(t){super(),this._pointerDown=[],this._pointerUp=[],this._pointerMove=[],this._pointerCancel=[],this._wheel=[],this._pointers=[],this._activePointers=[],this._engine=t,this._pointers.push(new bs),this._activePointers=[-1],this.primary=this._pointers[0]}on(t,e){super.on(t,e)}init(t){(t=t||this._engine.canvas).addEventListener("touchstart",this._handleTouchEvent("down",this._pointerDown)),t.addEventListener("touchend",this._handleTouchEvent("up",this._pointerUp)),t.addEventListener("touchmove",this._handleTouchEvent("move",this._pointerMove)),t.addEventListener("touchcancel",this._handleTouchEvent("cancel",this._pointerCancel)),window.PointerEvent?(this._engine.canvas.style.touchAction="none",t.addEventListener("pointerdown",this._handlePointerEvent("down",this._pointerDown)),t.addEventListener("pointerup",this._handlePointerEvent("up",this._pointerUp)),t.addEventListener("pointermove",this._handlePointerEvent("move",this._pointerMove)),t.addEventListener("pointercancel",this._handlePointerEvent("cancel",this._pointerCancel))):window.MSPointerEvent?(this._engine.canvas.style.msTouchAction="none",t.addEventListener("MSPointerDown",this._handlePointerEvent("down",this._pointerDown)),t.addEventListener("MSPointerUp",this._handlePointerEvent("up",this._pointerUp)),t.addEventListener("MSPointerMove",this._handlePointerEvent("move",this._pointerMove)),t.addEventListener("MSPointerCancel",this._handlePointerEvent("cancel",this._pointerCancel))):(t.addEventListener("mousedown",this._handleMouseEvent("down",this._pointerDown)),t.addEventListener("mouseup",this._handleMouseEvent("up",this._pointerUp)),t.addEventListener("mousemove",this._handleMouseEvent("move",this._pointerMove)));const e={passive:!(this._engine.pageScrollPreventionMode===Ns.All||this._engine.pageScrollPreventionMode===Ns.Canvas)};"onwheel"in document.createElement("div")?t.addEventListener("wheel",this._handleWheelEvent("wheel",this._wheel),e):void 0!==document.onmousewheel?t.addEventListener("mousewheel",this._handleWheelEvent("wheel",this._wheel),e):t.addEventListener("MozMousePixelScroll",this._handleWheelEvent("wheel",this._wheel),e)}triggerEvent(t,e,i=cs.Left,s="mouse",n=0){let r,o=0,a=0;e instanceof V?(o=e.pagePos.x,a=e.pagePos.y,r=e):(o=e.x,a=e.y,r=new V(e.clone(),e.clone(),e.clone()));const h={pageX:o,pageY:a,pointerId:n,pointerType:s,button:i,preventDefault:()=>{}};switch(t){case"move":this._handlePointerEvent(t,this._pointerMove,r)(h);break;case"down":this._handlePointerEvent(t,this._pointerDown,r)(h);break;case"up":this._handlePointerEvent(t,this._pointerUp,r)(h);break;case"cancel":this._handlePointerEvent(t,this._pointerCancel,r)(h)}for(const t of this._engine.currentScene.actors){const e=t.traits.filter(t=>t instanceof We)[0];e&&e.update(t,this._engine,1)}this.dispatchPointerEvents(),this.update()}update(){this._pointerUp.length=0,this._pointerDown.length=0,this._pointerMove.length=0,this._pointerCancel.length=0,this._wheel.length=0;for(let t=0;t<this._pointers.length;t++)this._pointers[t].update()}at(t){if(t>=this._pointers.length)for(let e=this._pointers.length-1,i=t;e<i;e++)this._pointers.push(new bs),this._activePointers.push(-1);return this._pointers[t]}count(){return this._pointers.length}checkAndUpdateActorUnderPointer(t){for(const e of this._pointers)e.checkActorUnderPointer(t)?e.addActorUnderPointer(t):e.removeActorUnderPointer(t)}_dispatchWithBubble(t){for(const e of t)for(const t of e.pointer.getActorsForEvents())if(e.propagate(t),!e.bubbles)break}_dispatchPointerLeaveEvents(){const t={},e=[];for(const i of this._pointerMove)for(const s of i.pointer.getActorsForEvents())if(!t[i.pointer.id+"+"+s.id]&&i.pointer.wasActorUnderPointer(s)&&!i.pointer.isActorAliveUnderPointer(s)){t[i.pointer.id+"+"+s.id]=i;const n=Rs("leave",new V(i.worldPos,i.pagePos,i.screenPos),i.pointer,i.index,i.pointerType,i.button,i.ev);n.propagate(s),e.push(n)}return e}_dispatchPointerEnterEvents(){const t={},e=[];for(const i of this._pointerMove)for(const s of i.pointer.getActorsForEvents())if(!t[i.pointer.id]&&!i.pointer.wasActorUnderPointer(s)&&i.pointer.isActorAliveUnderPointer(s)){t[i.pointer.id]=i;const n=Rs("enter",new V(i.worldPos,i.pagePos,i.screenPos),i.pointer,i.index,i.pointerType,i.button,i.ev);n.propagate(s),e.push(n),i.pointer.isDragging&&(i.pointer.dragTarget=s)}return e}dispatchPointerEvents(){this._dispatchWithBubble(this._pointerDown),this._dispatchWithBubble(this._pointerUp),this._dispatchWithBubble(this._pointerMove),this._dispatchPointerLeaveEvents(),this._dispatchPointerEnterEvents(),this._dispatchWithBubble(this._pointerCancel);for(const t of this._wheel)for(const e of this._pointers[t.index].getActorsUnderPointer())if(this._propagateWheelPointerEvent(e,t),!t.bubbles)break}_propagateWheelPointerEvent(t,e){t.emit("pointerwheel",e),e.bubbles&&t.parent&&this._propagateWheelPointerEvent(t.parent,e)}_handleMouseEvent(t,e){return i=>{i.preventDefault();const s=this.at(0),n=V.fromPagePosition(i.pageX,i.pageY,this._engine),r=Rs(t,n,s,0,as.Mouse,this._nativeButtonToPointerButton(i.button),i);e.push(r),s.eventDispatcher.emit(t,r)}}_handleTouchEvent(t,e){return i=>{i.preventDefault();for(let s=0,n=i.changedTouches.length;s<n;s++){const n=this._pointers.length>1?this._getPointerIndex(i.changedTouches[s].identifier):0;if(-1===n)continue;const r=this.at(n),o=V.fromPagePosition(i.changedTouches[s].pageX,i.changedTouches[s].pageY,this._engine),a=Rs(t,o,r,n,as.Touch,ls.Unknown,i);e.push(a),r.eventDispatcher.emit(t,a),this._pointers.length>1&&("up"===t?this._activePointers[n]=-1:"down"===t&&(this._activePointers[n]=i.changedTouches[s].identifier))}}}_handlePointerEvent(t,e,i){return s=>{s.preventDefault();const n=this._pointers.length>1?this._getPointerIndex(s.pointerId):0;if(-1===n)return;const r=this.at(n),o=i||V.fromPagePosition(s.pageX,s.pageY,this._engine),a=Rs(t,o,r,n,this._stringToPointerType(s.pointerType),this._nativeButtonToPointerButton(s.button),s);e.push(a),r.eventDispatcher.emit(t,a),this._pointers.length>1&&("up"===t?this._activePointers[n]=-1:"down"===t&&(this._activePointers[n]=s.pointerId))}}_handleWheelEvent(t,e){return i=>{(this._engine.pageScrollPreventionMode===Ns.All||this._engine.pageScrollPreventionMode===Ns.Canvas&&i.target===this._engine.canvas)&&i.preventDefault();const s=i.pageX-P(this._engine.canvas).x,n=i.pageY-P(this._engine.canvas).y,r=this._engine.screenToWorldCoordinates(new H(s,n)),o=i.deltaX||-.025*i.wheelDeltaX||0,a=i.deltaY||-.025*i.wheelDeltaY||-.025*i.wheelDelta||i.detail||0,h=i.deltaZ||0;let c=us.Pixel;i.deltaMode&&(1===i.deltaMode?c=us.Line:2===i.deltaMode&&(c=us.Page));const l=new Ds(r.x,r.y,i.pageX,i.pageY,s,n,0,o,a,h,c,i);e.push(l),this.at(0).eventDispatcher.emit(t,l)}}_getPointerIndex(t){let e;if((e=this._activePointers.indexOf(t))>-1)return e;for(let t=0;t<this._activePointers.length;t++)if(-1===this._activePointers[t])return t;return-1}_nativeButtonToPointerButton(t){switch(t){case cs.NoButton:return ls.NoButton;case cs.Left:return ls.Left;case cs.Middle:return ls.Middle;case cs.Right:return ls.Right;case cs.Unknown:return ls.Unknown;default:return D(t)}}_stringToPointerType(t){switch(t){case"touch":return as.Touch;case"mouse":return as.Mouse;case"pen":return as.Pen;default:return as.Unknown}}}class Os extends ti{constructor(){super(),this.enabled=!1,this.supported=!!navigator.getGamepads,this._gamePadTimeStamps=[0,0,0,0],this._oldPads=[],this._pads=[],this._initSuccess=!1,this._navigator=navigator,this._minimumConfiguration=null}init(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))}setMinimumGamepadConfiguration(t){this._enableAndUpdate(),this._minimumConfiguration=t}_enableAndUpdate(){this.enabled||(this.enabled=!0,this.update())}_isGamepadValid(t){if(!this._minimumConfiguration)return!0;if(!t)return!1;const e=t.axes.filter(t=>void 0!==typeof t).length,i=t.buttons.filter(t=>void 0!==typeof t).length;return e>=this._minimumConfiguration.axis&&i>=this._minimumConfiguration.buttons&&t.connected}on(t,e){this._enableAndUpdate(),super.on(t,e)}off(t,e){this._enableAndUpdate(),super.off(t,e)}update(){if(!this.enabled||!this.supported)return;this.init();const t=this._navigator.getGamepads();for(let e=0;e<t.length;e++){if(!t[e]){const t=this.at(e);t.connected&&this.eventDispatcher.emit("disconnect",new wt(e,t)),t.connected=!1;continue}if(!this.at(e).connected&&this._isGamepadValid(t[e])&&this.eventDispatcher.emit("connect",new yt(e,this.at(e))),this.at(e).connected=!0,t[e].timestamp&&t[e].timestamp===this._gamePadTimeStamps[e])continue;let i,s,n,r,o;for(i in this._gamePadTimeStamps[e]=t[e].timestamp,this.at(e).navigatorGamepad=t[e],Is)s=Is[i],"number"==typeof s&&t[e].buttons[s]&&(o=t[e].buttons[s].value,o!==this._oldPads[e].getButton(s)&&(t[e].buttons[s].pressed?(this.at(e).updateButton(s,o),this.at(e).eventDispatcher.emit("button",new vt(s,o,this.at(e)))):this.at(e).updateButton(s,0)));for(n in Ls)r=Ls[n],"number"==typeof r&&(o=t[e].axes[r],o!==this._oldPads[e].getAxes(r)&&(this.at(e).updateAxes(r,o),this.at(e).eventDispatcher.emit("axis",new bt(r,o,this.at(e)))));this._oldPads[e]=this._clonePad(t[e])}}at(t){if(this._enableAndUpdate(),t>=this._pads.length)for(let e=this._pads.length-1,i=t;e<i;e++)this._pads.push(new Fs),this._oldPads.push(new Fs);return this._pads[t]}getValidGamepads(){this._enableAndUpdate();const t=[];for(let e=0;e<this._pads.length;e++)this._isGamepadValid(this.at(e).navigatorGamepad)&&this.at(e).connected&&t.push(this.at(e));return t}count(){return this._pads.filter(t=>t.connected).length}_clonePads(t){const e=[];for(let i=0,s=t.length;i<s;i++)e.push(this._clonePad(t[i]));return e}_clonePad(t){let e,i;const s=new Fs;if(!t)return s;for(e=0,i=t.buttons.length;e<i;e++)t.buttons[e]&&s.updateButton(e,t.buttons[e].value);for(e=0,i=t.axes.length;e<i;e++)s.updateAxes(e,t.axes[e]);return s}}Os.MinAxisMoveThreshold=.05;class Fs extends ti{constructor(){super(),this.connected=!1,this._buttons=new Array(16),this._axes=new Array(4);for(let t=0;t<this._buttons.length;t++)this._buttons[t]=0;for(let t=0;t<this._axes.length;t++)this._axes[t]=0}isButtonPressed(t,e=1){return this._buttons[t]>=e}getButton(t){return this._buttons[t]}getAxes(t){const e=this._axes[t];return Math.abs(e)<Os.MinAxisMoveThreshold?0:e}updateButton(t,e){this._buttons[t]=e}updateAxes(t,e){this._axes[t]=e}}var Is,Ls;!function(t){t[t.Face1=0]="Face1",t[t.Face2=1]="Face2",t[t.Face3=2]="Face3",t[t.Face4=3]="Face4",t[t.LeftBumper=4]="LeftBumper",t[t.RightBumper=5]="RightBumper",t[t.LeftTrigger=6]="LeftTrigger",t[t.RightTrigger=7]="RightTrigger",t[t.Select=8]="Select",t[t.Start=9]="Start",t[t.LeftStick=10]="LeftStick",t[t.RightStick=11]="RightStick",t[t.DpadUp=12]="DpadUp",t[t.DpadDown=13]="DpadDown",t[t.DpadLeft=14]="DpadLeft",t[t.DpadRight=15]="DpadRight"}(Is||(Is={})),function(t){t[t.LeftStickX=0]="LeftStickX",t[t.LeftStickY=1]="LeftStickY",t[t.RightStickX=2]="RightStickX",t[t.RightStickY=3]="RightStickY"}(Ls||(Ls={}));class Us{constructor(t){this.nativeComponent=t,this._paused=!1,this._nativeHandlers={}}on(t,e){this._nativeHandlers[t]&&this.off(t,this._nativeHandlers[t]),this._nativeHandlers[t]=this._decorate(e),this.nativeComponent.addEventListener(t,this._nativeHandlers[t])}off(t,e){e||(e=this._nativeHandlers[t]),this.nativeComponent.removeEventListener(t,e),this._nativeHandlers[t]=null}_decorate(t){return e=>{this._paused||t(e)}}pause(){this._paused=!0}resume(){this._paused=!1}clear(){for(const t in this._nativeHandlers)this.off(t)}}class zs{constructor(t,e){this._windowGlobal=t,this._documentGlobal=e,this._windowComponent=new Us(this._windowGlobal),this._documentComponent=new Us(this._documentGlobal)}get window(){return this._windowComponent}get document(){return this._documentComponent}pause(){this.window.pause(),this.document.pause()}resume(){this.window.resume(),this.document.resume()}clear(){this.window.clear(),this.document.clear()}}var Ns,Ws=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};l(),function(t){t[t.None=0]="None",t[t.Canvas=1]="Canvas",t[t.All=2]="All"}(Ns||(Ns={}));class Hs extends ti{constructor(t){var e,i,s;super(),this._hasStarted=!1,this.postProcessors=[],this.scenes={},this._animations=[],this._suppressPlayButton=!1,this.pauseAudioWhenHidden=!0,this._isDebug=!1,this.debugColor=new Q(255,255,255),this.enableCanvasTransparency=!0,this.onFatalException=t=>{O.getInstance().fatal(t)},this._timescale=1,this._isLoading=!1,this._isInitialized=!1,t=Object.assign(Object.assign({},Hs._DEFAULT_ENGINE_OPTIONS),t),u.freeze(),this.browser=new zs(window,document);const n=new yi;if(!t.suppressMinimumBrowserFeatureDetection&&!(this._compatible=n.test())){const e=document.createElement("div");if(e.innerText="Sorry, your browser does not support all the features needed for Excalibur",document.body.appendChild(e),n.failedTests.forEach((function(t){const e=document.createElement("div");e.innerText="Browser feature missing "+t,document.body.appendChild(e)})),t.canvasElementId){const e=document.getElementById(t.canvasElementId);e&&e.parentElement.removeChild(e)}return}this._compatible=!0,console.log&&!t.suppressConsoleBootMessage&&(console.log(`%cPowered by Excalibur.js (v${Ln})`,"background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;"),console.log("\n      /| ________________\nO|===|* >________________>\n      \\|"),console.log("Visit","http://excaliburjs.com","for more information")),t.suppressPlayButton&&(this._suppressPlayButton=!0),this._logger=O.getInstance(),this._logger.defaultLevel===k.Debug&&n.logBrowserFeatures(),this._logger.debug("Building engine..."),this.canvasElementId=t.canvasElementId,t.canvasElementId?(this._logger.debug("Using Canvas element specified: "+t.canvasElementId),this.canvas=document.getElementById(t.canvasElementId)):t.canvasElement?(this._logger.debug("Using Canvas element specified:",t.canvasElement),this.canvas=t.canvasElement):(this._logger.debug("Using generated canvas element"),this.canvas=document.createElement("canvas"));let r=null!==(e=t.displayMode)&&void 0!==e?e:Kt.Fixed;t.width&&t.height||t.viewport?(void 0===t.displayMode&&(r=Kt.Fixed),this._logger.debug("Engine viewport is size "+t.width+" x "+t.height)):t.displayMode||(this._logger.debug("Engine viewport is fullscreen"),r=Kt.FullScreen),this.ctx=this.canvas.getContext("2d",{alpha:this.enableCanvasTransparency}),this.screen=new Gt({canvas:this.canvas,context:this.ctx,antialiasing:null===(i=t.antialiasing)||void 0===i||i,browser:this.browser,viewport:null!==(s=t.viewport)&&void 0!==s?s:{width:t.width,height:t.height},resolution:t.resolution,displayMode:r,position:t.position,pixelRatio:t.suppressHiDPIScaling?1:null}),this.screen.applyResolutionAndViewport(),t.backgroundColor&&(this.backgroundColor=t.backgroundColor.clone()),this.enableCanvasTransparency=t.enableCanvasTransparency,this._loader=new _i,this.debug=new _s(this),this._initialize(t),this.rootScene=this.currentScene=new ps(this),this.addScene("root",this.rootScene),this.goToScene("root")}get canvasWidth(){return this.screen.canvasWidth}get halfCanvasWidth(){return this.screen.halfCanvasWidth}get canvasHeight(){return this.screen.canvasHeight}get halfCanvasHeight(){return this.screen.halfCanvasHeight}get drawWidth(){return this.screen.drawWidth}get halfDrawWidth(){return this.screen.halfDrawWidth}get drawHeight(){return this.screen.drawHeight}get halfDrawHeight(){return this.screen.halfDrawHeight}get isHiDpi(){return this.screen.isHiDpi}get stats(){return this.debug.stats}get isFullscreen(){return this.screen.isFullScreen}get displayMode(){return this.screen.displayMode}get pixelRatio(){return this.screen.pixelRatio}get isDebug(){return this._isDebug}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}getWorldBounds(){return this.screen.getWorldBounds()}get timescale(){return this._timescale}set timescale(t){t<=0?O.getInstance().error("Cannot set engine.timescale to a value of 0 or less than 0."):this._timescale=t}playAnimation(t,e,i){this._animations.push(new js(t,e,i))}addTileMap(t){this.currentScene.addTileMap(t)}removeTileMap(t){this.currentScene.removeTileMap(t)}addTimer(t){return this.currentScene.addTimer(t)}removeTimer(t){return this.currentScene.removeTimer(t)}addScene(t,e){this.scenes[t]&&this._logger.warn("Scene",t,"already exists overwriting"),this.scenes[t]=e}removeScene(t){if(t instanceof ps)for(const e in this.scenes)this.scenes.hasOwnProperty(e)&&this.scenes[e]===t&&delete this.scenes[e];"string"==typeof t&&delete this.scenes[t]}add(t){2===arguments.length&&this.addScene(arguments[0],arguments[1]),this.currentScene.add(t)}remove(t){t instanceof ui&&this.currentScene.remove(t),t instanceof ps&&this.removeScene(t),"string"==typeof t&&this.removeScene(t)}goToScene(t){if(this.scenes[t]){const e=this.currentScene,i=this.scenes[t];this._logger.debug("Going to scene:",t),this.currentScene.isInitialized&&(this.currentScene._deactivate.call(this.currentScene,[e,i]),this.currentScene.eventDispatcher.emit("deactivate",new Rt(i,this.currentScene))),this.currentScene=i,this.screen.setCurrentCamera(i.camera),this.currentScene._initialize(this),this.currentScene._activate.call(this.currentScene,[e,i]),this.currentScene.eventDispatcher.emit("activate",new Dt(e,this.currentScene))}else this._logger.error("Scene",t,"does not exist!")}screenToWorldCoordinates(t){return this.screen.screenToWorldCoordinates(t)}worldToScreenCoordinates(t){return this.screen.worldToScreenCoordinates(t)}_initialize(t){let e,i;this.pageScrollPreventionMode=t.scrollPreventionMode,this.input={keyboard:new vs,pointers:new ks(this),gamepads:new Os},this.input.keyboard.init(),this.input.pointers.init(t&&t.pointerScope===hs.Document?document:this.canvas),this.input.gamepads.init(),void 0!==document.hidden?(e="hidden",i="visibilitychange"):"msHidden"in document?(e="msHidden",i="msvisibilitychange"):"webkitHidden"in document&&(e="webkitHidden",i="webkitvisibilitychange"),this.browser.document.on(i,()=>{document[e]?(this.eventDispatcher.emit("hidden",new St(this)),this._logger.debug("Window hidden")):(this.eventDispatcher.emit("visible",new Pt(this)),this._logger.debug("Window visible"))}),this.canvasElementId||t.canvasElement||document.body.appendChild(this.canvas)}onInitialize(t){}setAntialiasing(t){this.screen.antialiasing=t}getAntialiasing(){return this.screen.antialiasing}get isInitialized(){return this._isInitialized}_overrideInitialize(t){this.isInitialized||(this.onInitialize(t),super.emit("initialize",new Bt(t,this)),this._isInitialized=!0)}_update(t){if(this._isLoading)return this._loader.update(this,t),this.input.keyboard.update(),this.input.pointers.update(),void this.input.gamepads.update();this._overrideInitialize(this),this._preupdate(t),this.currentScene.update(this,t),this._animations=this._animations.filter((function(t){return!t.animation.isDone()})),this.input.keyboard.update(),this.input.pointers.update(),this.input.gamepads.update(),this._postupdate(t)}_preupdate(t){this.emit("preupdate",new ft(this,t,this)),this.onPreUpdate(this,t)}onPreUpdate(t,e){}_postupdate(t){this.emit("postupdate",new gt(this,t,this)),this.onPostUpdate(this,t)}onPostUpdate(t,e){}_draw(t){const e=this.ctx;if(this._predraw(e,t),this._isLoading)return void this._loader.draw(e);e.clearRect(0,0,this.canvasWidth,this.canvasHeight),e.fillStyle=this.backgroundColor.toString(),e.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.currentScene.draw(this.ctx,t);let i=0;const s=this._animations.length;for(;i<s;i++)this._animations[i].animation.draw(e,this._animations[i].x,this._animations[i].y);if(this.isDebug){this.ctx.font="Consolas",this.ctx.fillStyle=this.debugColor.toString();const t=this.input.keyboard.getKeys();for(let e=0;e<t.length;e++)this.ctx.fillText(t[e].toString()+" : "+(os[t[e]]?os[t[e]]:"Not Mapped"),100,10*e+10);this.ctx.fillText("FPS:"+this.stats.currFrame.fps.toFixed(2).toString(),10,10)}for(let t=0;t<this.postProcessors.length;t++)this.postProcessors[t].process(this.ctx.getImageData(0,0,this.canvasWidth,this.canvasHeight),this.ctx);this._postdraw(e,t)}_predraw(t,e){this.emit("predraw",new lt(t,e,this)),this.onPreDraw(t,e)}onPreDraw(t,e){}_postdraw(t,e){this.emit("postdraw",new ut(t,e,this)),this.onPostDraw(t,e)}onPostDraw(t,e){}showDebug(t){this._isDebug=t}toggleDebug(){return this._isDebug=!this._isDebug,this._isDebug}start(t){if(!this._compatible)return Promise.reject("Excalibur is incompatible with your browser");let e;return this.screen.pushResolutionAndViewport(),this.screen.resolution=this.screen.viewport,this.screen.applyResolutionAndViewport(),t?(this._loader=t,this._loader.suppressPlayButton=this._suppressPlayButton||this._loader.suppressPlayButton,this._loader.wireEngine(this),e=this.load(this._loader)):e=Promise.resolve(),e.then(()=>{this.screen.popResolutionAndViewport(),this.screen.applyResolutionAndViewport(),this.emit("start",new ht(this))}),this._hasStarted||(this._hasStarted=!0,this._logger.debug("Starting game..."),this.browser.resume(),Hs.createMainLoop(this,window.requestAnimationFrame,Date.now)(),this._logger.debug("Game started")),e}static createMainLoop(t,e,i){let s=i();return function n(){if(t._hasStarted)try{t._requestId=e(n),t.emit("preframe",new _t(t,t.stats.prevFrame));const r=i();let o=Math.floor(r-s)||1;o>200&&(o=1);const a=o*t.timescale,h=t.stats.prevFrame.id+1;t.stats.currFrame.reset(),t.stats.currFrame.id=h,t.stats.currFrame.delta=a,t.stats.currFrame.fps=1/(a/1e3);const c=i();t._update(a);const l=i();t._draw(a);const u=i();t.stats.currFrame.duration.update=l-c,t.stats.currFrame.duration.draw=u-l,s=r,t.emit("postframe",new mt(t,t.stats.currFrame)),t.stats.prevFrame.reset(t.stats.currFrame)}catch(e){window.cancelAnimationFrame(t._requestId),t.stop(),t.onFatalException(e)}}}stop(){this._hasStarted&&(this.emit("stop",new ct(this)),this.browser.pause(),this._hasStarted=!1,this._logger.debug("Game stopped"))}isPaused(){return!this._hasStarted}screenshot(){const t=new Image,e=this.canvas.toDataURL("image/png");return t.src=e,t}load(t){return new Promise(e=>{this._isLoading=!0,t.load().then(()=>{this._suppressPlayButton?setTimeout(()=>{this._isLoading=!1,e()},500):(this._isLoading=!1,e())})})}}Hs._DEFAULT_ENGINE_OPTIONS={width:0,height:0,enableCanvasTransparency:!0,canvasElementId:"",canvasElement:void 0,pointerScope:hs.Document,suppressConsoleBootMessage:null,suppressMinimumBrowserFeatureDetection:null,suppressHiDPIScaling:null,suppressPlayButton:null,scrollPreventionMode:Ns.Canvas,backgroundColor:Q.fromHex("#2185d0")},Ws([W({message:"Will be removed in excalibur v0.26.0"})],Hs.prototype,"playAnimation",null);let js=class{constructor(t,e,i){this.animation=t,this.x=e,this.y=i}};js=Ws([W({message:"Will be removed in excalibur v0.26.0"})],js);class qs extends nt{constructor(t,e="MediaEvent"){super(),this.target=t,this._name=e}set bubbles(t){}get bubbles(){return!1}get _path(){return null}set _path(t){}stopPropagation(){}action(){}propagate(){}layPath(t){}}class Ks extends qs{constructor(t,e){super(t,"NativeSoundEvent"),this.track=e}}class Vs extends qs{constructor(t,e){super(t,"NativeSoundProcessedEvent"),this._processedData=e,this.data=this._processedData}}var Gs;!function(t){t[t.Circle=0]="Circle",t[t.Rectangle=1]="Rectangle"}(Gs||(Gs={}));class Xs{constructor(t,e,i,s,n,r,o,a,h,c){this.position=new H(0,0),this.velocity=new H(0,0),this.acceleration=new H(0,0),this.particleRotationalVelocity=0,this.currentRotation=0,this.focus=null,this.focusAccel=0,this.opacity=1,this.beginColor=Q.White,this.endColor=Q.White,this.life=300,this.fadeFlag=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=Q.White,this.emitter=null,this.particleSize=5,this.particleSprite=null,this.sizeRate=0,this.elapsedMultiplier=0;let l=t;if(l&&!(t instanceof Ys)){const u=t;l=u.emitter,e=u.life,i=u.opacity,n=u.endColor,s=u.beginColor,r=u.position,o=u.velocity,a=u.acceleration,h=u.startSize,c=u.endSize}this.emitter=l,this.life=e||this.life,this.opacity=i||this.opacity,this.endColor=n||this.endColor.clone(),this.beginColor=s||this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.position=r||this.position,this.velocity=o||this.velocity,this.acceleration=a||this.acceleration,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.opacity/this.life,this.startSize=h||0,this.endSize=c||0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.particleSize=this.startSize)}kill(){this.emitter.removeParticle(this)}update(t){if(this.life=this.life-t,this.elapsedMultiplier=this.elapsedMultiplier+t,this.life<0&&this.kill(),this.fadeFlag&&(this.opacity=y(this._aRate*this.life,1e-4,1)),this.startSize>0&&this.endSize>0&&(this.particleSize=y(this.sizeRate*t+this.particleSize,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=y(this._currentColor.r+this._rRate*t,0,255),this._currentColor.g=y(this._currentColor.g+this._gRate*t,0,255),this._currentColor.b=y(this._currentColor.b+this._bRate*t,0,255),this._currentColor.a=y(this.opacity,1e-4,1),this.focus){const e=this.focus.sub(this.position).normalize().scale(this.focusAccel).scale(t/1e3);this.velocity=this.velocity.add(e)}else this.velocity=this.velocity.add(this.acceleration.scale(t/1e3));this.position=this.position.add(this.velocity.scale(t/1e3)),this.particleRotationalVelocity&&(this.currentRotation=(this.currentRotation+this.particleRotationalVelocity*t/1e3)%(2*Math.PI))}draw(t){if(this.particleSprite)return this.particleSprite.rotation=this.currentRotation,this.particleSprite.scale.setTo(this.particleSize,this.particleSize),void this.particleSprite.draw(t,this.position.x,this.position.y);this._currentColor.a=y(this.opacity,1e-4,1),t.fillStyle=this._currentColor.toString(),t.beginPath(),t.arc(this.position.x,this.position.y,this.particleSize,0,2*Math.PI),t.fill(),t.closePath()}}class Qs extends(re(Xs)){constructor(t,e,i,s,n,r,o,a,h,c){super(t,e,i,s,n,r,o,a,h,c)}}class Zs extends ui{constructor(t,e,i,s){super("number"==typeof t?{pos:new H(t,e),width:i,height:s}:t),this.numParticles=0,this.isEmitting=!0,this.particles=null,this.deadParticles=null,this.minVel=0,this.maxVel=0,this.acceleration=new H(0,0),this.minAngle=0,this.maxAngle=0,this.emitRate=1,this.particleLife=2e3,this.opacity=1,this.fadeFlag=!1,this.focus=null,this.focusAccel=1,this.startSize=null,this.endSize=null,this.minSize=5,this.maxSize=5,this.beginColor=Q.White,this.endColor=Q.White,this.particleSprite=null,this.emitterType=Gs.Rectangle,this.radius=0,this.particleRotationalVelocity=0,this.randomRotation=!1,this._particlesToEmit=0,this.body.collider.type=et.PreventCollision,this.particles=new B,this.deadParticles=new B,this.random=new d;for(let t=0;t<this.traits.length;t++)this.traits[t]instanceof Ne&&this.traits.splice(t,1)}removeParticle(t){this.deadParticles.push(t)}emitParticles(t){for(let e=0;e<t;e++)this.particles.push(this._createParticle())}clearParticles(){this.particles.clear()}_createParticle(){let t=0,e=0;const i=w(this.minAngle,this.maxAngle,this.random),s=w(this.minVel,this.maxVel,this.random),n=this.startSize||w(this.minSize,this.maxSize,this.random),r=s*Math.cos(i),o=s*Math.sin(i);if(this.emitterType===Gs.Rectangle)t=w(0,this.width,this.random),e=w(0,this.height,this.random);else if(this.emitterType===Gs.Circle){const s=w(0,this.radius,this.random);t=s*Math.cos(i),e=s*Math.sin(i)}const a=new Qs(this,this.particleLife,this.opacity,this.beginColor,this.endColor,new H(t,e),new H(r,o),this.acceleration,this.startSize,this.endSize);return a.fadeFlag=this.fadeFlag,a.particleSize=n,this.particleSprite&&(a.particleSprite=this.particleSprite),a.particleRotationalVelocity=this.particleRotationalVelocity,this.randomRotation&&(a.currentRotation=w(0,2*Math.PI,this.random)),this.focus&&(a.focus=this.focus.add(new H(this.pos.x,this.pos.y)),a.focusAccel=this.focusAccel),a}update(t,e){super.update(t,e),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(e/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit))),this.particles.forEach(t=>t.update(e)),this.deadParticles.forEach(t=>this.particles.removeElement(t)),this.deadParticles.clear()}draw(t){this.particles.forEach(e=>e.draw(t))}debugDraw(t){super.debugDraw(t),t.fillStyle=Q.Black.toString(),t.fillText("Particles: "+this.particles.count(),this.pos.x,this.pos.y+20),this.focus&&(t.fillRect(this.focus.x+this.pos.x,this.focus.y+this.pos.y,3,3),He(t,Q.Yellow,this.focus.x+this.pos.x,this.focus.y+this.pos.y,this.center.x,this.center.y),t.fillText("Focus",this.focus.x+this.pos.x,this.focus.y+this.pos.y))}}class Ys extends(re(Zs)){constructor(t,e,i,s){super(t,e,i,s)}}const Js={Actions:r};class $s{static create(t,e){if(this._CURRENT_GROUP>this._MAX_GROUPS)throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);if(this._GROUPS.get(t))throw new Error(`Collision group ${t} already exists`);const i=new Ge(t,this._CURRENT_BIT,void 0!==e?e:~this._CURRENT_BIT);return this._CURRENT_BIT=this._CURRENT_BIT<<1|0,this._CURRENT_GROUP++,this._GROUPS.set(t,i),i}static get groups(){return Array.from(this._GROUPS.values())}static groupByName(t){return this._GROUPS.get(t)}static reset(){this._GROUPS=new Map,this._CURRENT_BIT=this._STARTING_BIT,this._CURRENT_GROUP=1}}$s._STARTING_BIT=1,$s._MAX_GROUPS=32,$s._CURRENT_GROUP=1,$s._CURRENT_BIT=$s._STARTING_BIT,$s._GROUPS=new Map;class tn{constructor(t){this.lineWidth=5,this.filled=!1,this._points=[],this.anchor=H.Zero,this.offset=H.Zero,this.rotation=0,this.scale=H.One,this.opacity=1,this._points=t;const e=this._points.reduce((t,e)=>Math.min(t,e.x),0),i=this._points.reduce((t,e)=>Math.max(t,e.x),0);this.drawWidth=i-e;const s=this._points.reduce((t,e)=>Math.min(t,e.y),0),n=this._points.reduce((t,e)=>Math.max(t,e.y),0);this.drawHeight=n-s,this.height=this.drawHeight,this.width=this.drawWidth}addEffect(){}removeEffect(){}clearEffects(){}reset(){}draw(t,e,i){t instanceof CanvasRenderingContext2D?this._drawWithOptions({ctx:t,x:e,y:i}):this._drawWithOptions(t)}_drawWithOptions(t){var e,i,s,n,r,o,a,h;const{ctx:c,x:l,y:u,rotation:d,drawWidth:p,drawHeight:f,anchor:g,offset:_,opacity:m,flipHorizontal:y,flipVertical:w}=Object.assign(Object.assign({},t),{rotation:null!==(e=t.rotation)&&void 0!==e?e:this.rotation,drawWidth:null!==(i=t.drawWidth)&&void 0!==i?i:this.drawWidth,drawHeight:null!==(s=t.drawHeight)&&void 0!==s?s:this.drawHeight,flipHorizontal:null!==(n=t.flipHorizontal)&&void 0!==n?n:this.flipHorizontal,flipVertical:null!==(r=t.flipVertical)&&void 0!==r?r:this.flipVertical,anchor:null!==(o=t.anchor)&&void 0!==o?o:this.anchor,offset:null!==(a=t.offset)&&void 0!==a?a:this.offset,opacity:null!==(h=t.opacity)&&void 0!==h?h:this.opacity}),v=p*g.x+_.x+l,b=f*g.y+_.y+u;c.save(),c.translate(v,b),c.scale(this.scale.x,this.scale.y),c.rotate(d),c.beginPath(),c.lineWidth=this.lineWidth;const x=this._points[0];c.moveTo(x.x,x.y);let A=0;const P=this._points.length;for(;A<P;A++)c.lineTo(this._points[A].x,this._points[A].y);c.lineTo(x.x,x.y),c.closePath(),this.filled&&(c.fillStyle=this.fillColor.toString(),c.fill()),c.strokeStyle=this.lineColor.toString(),y&&(c.translate(p,0),c.scale(-1,1)),w&&(c.translate(0,f),c.scale(1,-1));const S=c.globalAlpha;c.globalAlpha=null!=m?m:1,c.stroke(),c.globalAlpha=S,c.restore()}}class en{constructor(t,e,i,s,n,r){this.sprites=[],this.image=null,this.columns=0,this.rows=0,this.spWidth=0,this.spHeight=0,this.spacing=0;let o=!1;if(t instanceof Array?this.sprites=t:(!t||t instanceof ue?(this.image=t,this.columns=e,this.rows=i,this.spWidth=s,this.spHeight=n,this.spacing=r||0):(this.columns=t.columns,this.rows=t.rows,this.spWidth=t.spWidth,this.spHeight=t.spHeight,this.image=t.image,this.spacing=t.spacing||0),this.sprites=new Array(this.columns*this.rows),o=!0),this.image instanceof ue){let t=!1,e=!1;if(this.image.isLoaded()){if(t=this.spWidth*this.columns>this.image.image.naturalWidth,e=this.spHeight*this.rows>this.image.image.naturalHeight,t)throw new RangeError("SpriteSheet specified is wider, "+`${this.columns} cols x ${this.spWidth} pixels > ${this.image.image.naturalWidth} `+"pixels than image width");if(e)throw new RangeError("SpriteSheet specified is taller, "+`${this.rows} rows x ${this.spHeight} pixels > ${this.image.image.naturalHeight} `+"pixels than image height")}}if(o)for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.sprites[e+t*this.columns]=new he(this.image,e*this.spWidth+this.spacing*e+this.spacing,t*this.spHeight+this.spacing*t+this.spacing,this.spWidth,this.spHeight)}getAnimationByIndices(t,e,i){let s=e.map(t=>this.sprites[t]);return s=s.map((function(t){return t.clone()})),new pe(t,s,i)}getAnimationBetween(t,e,i,s){let n=this.sprites.slice(e,i);return n=n.map((function(t){return t.clone()})),new pe(t,n,s)}getAnimationForAll(t,e){const i=this.sprites.map((function(t){return t.clone()}));return new pe(t,i,e)}getSprite(t){if(t>=0&&t<this.sprites.length)return this.sprites[t];throw new Error("Invalid index: "+t)}getAnimationByCoords(t,e,i){let s=0,n=0;const r=new Array(e.length);for(let t=0;t<e.length;t++){const i=e[t];i.image=i.image||this.image,s=Math.max(s,i.drawWidth),n=Math.max(n,i.drawHeight),r[t]=new he(i)}const o=new pe(t,r,i);return o.drawWidth=s,o.drawHeight=n,o}}class sn extends(re(en)){constructor(t,e,i,s,n,r){super(t,e,i,s,n,r)}}class nn extends sn{constructor(t,e,i,s,n,r,o,a){super(t instanceof ue?{image:t,spWidth:r,spHeight:o,rows:n,columns:s,spacing:a||0}:t),this._currentColor=Q.Black,this._currentOpacity=1,this._sprites={},this._textShadowOn=!1,this._textShadowDirty=!0,this._textShadowColor=Q.Black,this._textShadowSprites={},this._shadowOffsetX=5,this._shadowOffsetY=5,!t||t instanceof ue||(e=t.alphabet,i=t.caseInsensitive),this._alphabet=e,this._caseInsensitive=i,this._sprites=this.getTextSprites()}getTextSprites(){const t={};for(let e=0;e<this._alphabet.length;e++){let i=this._alphabet[e];this._caseInsensitive&&(i=i.toLowerCase()),t[i]=this.sprites[e].clone()}return t}setTextShadow(t,e,i){this._textShadowOn=!0,this._shadowOffsetX=t,this._shadowOffsetY=e,this._textShadowColor=i.clone(),this._textShadowDirty=!0;for(const t in this._sprites)this._textShadowSprites[t]=this._sprites[t].clone()}useTextShadow(t){this._textShadowOn=t,t&&this.setTextShadow(5,5,this._textShadowColor)}draw(t,e,i,s,n){if(n=this._parseOptions(n),this._currentColor.toString()!==n.color.toString()||this._currentOpacity!==n.opacity){this._currentOpacity=n.opacity,this._currentColor=n.color;for(const t in this._sprites)this._sprites[t].clearEffects(),this._sprites[t].fill(n.color),this._sprites[t].opacity(n.opacity)}if(this._textShadowOn&&this._textShadowDirty&&this._textShadowColor){for(const t in this._textShadowSprites)this._textShadowSprites[t].clearEffects(),this._textShadowSprites[t].addEffect(new ne(this._textShadowColor.clone()));this._textShadowDirty=!1}const r=this.sprites[0],o=r.drawHeight,a=n.fontSize/o,h=e.length*r.drawWidth*a+e.length*n.letterSpacing;let c=i;n.textAlign===Ri.Left||n.textAlign===Ri.Start?c=i:n.textAlign===Ri.Right||n.textAlign===Ri.End?c=i-h:n.textAlign===Ri.Center&&(c=i-h/2);let l=s-o*a;n.baseAlign===ki.Top||n.baseAlign===ki.Hanging?l=s:n.baseAlign===ki.Ideographic||n.baseAlign===ki.Bottom||n.baseAlign===ki.Alphabetic?l=s-o*a:n.baseAlign===ki.Middle&&(l=s-o*a/2);for(let i=0;i<e.length;i++){let s=e[i];this._caseInsensitive&&(s=s.toLowerCase());try{this._textShadowOn&&(this._textShadowSprites[s].scale.x=a,this._textShadowSprites[s].scale.y=a,this._textShadowSprites[s].draw(t,c+this._shadowOffsetX,l+this._shadowOffsetY));const e=this._sprites[s];e.scale.x=a,e.scale.y=a,e.draw(t,c,l),c+=e.drawWidth+n.letterSpacing}catch(t){O.getInstance().error(`SpriteFont Error drawing char ${s}`)}}}_parseOptions(t){return{fontSize:t.fontSize||10,letterSpacing:t.letterSpacing||0,color:t.color||Q.Black,textAlign:void 0===typeof t.textAlign?Ri.Left:t.textAlign,baseAlign:void 0===typeof t.baseAlign?ki.Bottom:t.baseAlign,maxWidth:t.maxWidth||-1,opacity:t.opacity||0}}}class rn extends(re(nn)){constructor(t,e,i,s,n,r,o,a){super(t,e,i,s,n,r,o,a)}}class on{}function an(t){return!!t._initialize}function hn(t){return!!t.onInitialize}function cn(t){return!!t._preupdate}function ln(t){return!!t.onPreUpdate}function un(t){return!!t.onPostUpdate}function dn(t){return!!t.onPostUpdate}function pn(t){return!!t.onPreDraw}function fn(t){return!!t.onPostDraw}function gn(t,e,i){return e+t*(i-e)}function _n(t){return t*t*t*(t*(6*t-15)+10)}on.type={any:"",blob:"blob",json:"json",text:"text",document:"document",arraybuffer:"arraybuffer"};class mn{constructor(t){this._perm=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this._p=new Uint8Array(512),this._defaultPerlinOptions={octaves:1,frequency:1,amplitude:1,persistance:.5},t=g({},this._defaultPerlinOptions,t),this.persistance=t.persistance,this.amplitude=t.amplitude,this.frequency=t.frequency,this.octaves=t.octaves,t.seed?this._random=new d(t.seed):this._random=new d,this._perm=this._random.shuffle(this._perm);for(let t=0;t<512;t++)this._p[t]=255&this._perm[t%256]}noise(){let t=this.amplitude,e=this.frequency,i=0,s=0;for(let n=0;n<this.octaves;n++){switch(arguments.length){case 1:i+=this._noise1d(arguments[0]*e)*t;break;case 2:i+=this._noise2d(arguments[0]*e,arguments[1]*e)*t;break;case 3:i+=this._noise3d(arguments[0]*e,arguments[1]*e,arguments[2]*e)*t;break;default:throw new Error("Invalid arguments for perlin noise")}s+=t,t*=this.persistance,e*=2}return i/s}sequence(t,e){e||(e=1/t);const i=new Array(t);for(let s=0;s<t;s++)i[s]=this.noise(s*e);return i}grid(t,e,i){i||(i=1/Math.min(t,e));const s=new Array(t*e);for(let n=0;n<e;n++)for(let e=0;e<t;e++)s[e+n*t]=this.noise(e*i,n*i);return s}_gradient3d(t,e,i,s){const n=15&t,r=n<8?e:i,o=n<4?i:12===n||14===n?e:s;return(0==(1&n)?r:-r)+(0==(2&n)?o:-o)}_gradient2d(t,e,i){const s=0==(1&t)?e:i;return 0==(2&t)?-s:s}_gradient1d(t,e){return 0==(1&t)?-e:e}_noise1d(t){const e=255&Math.floor(t);return(gn(_n(t-=Math.floor(t)),this._gradient1d(this._p[e],t),this._gradient1d(this._p[e+1],t-1))+1)/2}_noise2d(t,e){const i=255&Math.floor(t),s=255&Math.floor(e);t-=Math.floor(t),e-=Math.floor(e);const n=_n(t),r=_n(e),o=this._p[i]+s,a=this._p[i+1]+s;return(gn(r,gn(n,this._gradient2d(this._p[o],t,e),this._gradient2d(this._p[a],t-1,e)),gn(n,this._gradient2d(this._p[o+1],t,e-1),this._gradient2d(this._p[a+1],t-1,e-1)))+1)/2}_noise3d(t,e,i){const s=255&Math.floor(t),n=255&Math.floor(e),r=255&Math.floor(i);t-=Math.floor(t),e-=Math.floor(e),i-=Math.floor(i);const o=_n(t),a=_n(e),h=_n(i),c=this._p[s]+n,l=this._p[s+1]+n,u=this._p[c]+r,d=this._p[l]+r,p=this._p[c+1]+r,f=this._p[l+1]+r;return(gn(h,gn(a,gn(o,this._gradient3d(this._p[u],t,e,i),this._gradient3d(this._p[d],t-1,e,i)),gn(o,this._gradient3d(this._p[p],t,e-1,i),this._gradient3d(this._p[f],t-1,e-1,i))),gn(a,gn(o,this._gradient3d(this._p[u+1],t,e,i-1),this._gradient3d(this._p[d+1],t-1,e,i-1)),gn(o,this._gradient3d(this._p[p+1],t,e-1,i-1),this._gradient3d(this._p[f+1],t-1,e-1,i-1))))+1)/2}}class yn{constructor(t,e){this.generator=t,this.colorFcn=e,e||(this.colorFcn=t=>t<125?Q.Black:Q.White)}image(t,e){const i=document.createElement("img"),s=document.createElement("canvas");s.width=t,s.height=e;const n=s.getContext("2d");return this.draw(n,0,0,t,e),i.src=s.toDataURL(),i}draw(t,e,i,s,n){const r=this.generator.grid(s,n),o=t.getImageData(e,i,s,n);for(let t=0;t<n;t++)for(let e=0;e<s;e++){const i=r[e+s*t],n=255&Math.floor(255*i),a=4*(e+t*o.width),h=this.colorFcn(n);o.data[a]=h.r,o.data[a+1]=h.g,o.data[a+2]=h.b,o.data[a+3]=Math.floor(255*h.a)}t.putImageData(o,e,i)}}class wn{constructor(t){this._src=t,this._volume=1,this._duration=void 0,this._loop=!1,this._isPlaying=!1,this._isPaused=!1,this._audioContext=di.create(),this._volumeNode=this._audioContext.createGain(),this._currentOffset=0,this._createNewBufferSource()}set loop(t){this._loop=t,this._instance&&(this._instance.loop=t,this._wireUpOnEnded())}get loop(){return this._loop}set volume(t){t=y(t,0,1),this._volume=t,this._isPlaying&&this._volumeNode.gain.setTargetAtTime?this._volumeNode.gain.setTargetAtTime(t,this._audioContext.currentTime,.1):this._volumeNode.gain.value=t}get volume(){return this._volume}set duration(t){this._duration=t}get duration(){return this._duration}get _playbackRate(){return this._instance?1/(this._instance.playbackRate.value||1):null}isPlaying(){return this._isPlaying}play(t=(()=>{})){return this._isPaused&&(this._resumePlayBack(),t()),this._isPlaying||(this._startPlayBack(),t()),this._playingPromise}pause(){this._isPlaying&&(this._isPaused=!0,this._isPlaying=!1,this._instance.stop(0),this._setPauseOffset())}stop(){this._isPlaying&&(this._isPlaying=!1,this._isPaused=!1,this._currentOffset=0,this._instance.stop(0),this._instance.onended||this._handleOnEnded())}_startPlayBack(){this._isPlaying=!0,this._isPaused=!1,this._playingPromise=new Promise(t=>{this._playingResolve=t}),this._instance||this._createNewBufferSource(),this._rememberStartTime(),this._volumeNode.connect(this._audioContext.destination),this._instance.start(0,0),this._currentOffset=0,this._wireUpOnEnded()}_resumePlayBack(){if(!this._isPaused)return;this._isPaused=!1,this._isPlaying=!0,this._instance.onended=null,this._createNewBufferSource();const t=this._playbackRate*this._src.duration,e=this._currentOffset%t;this._rememberStartTime(-1e3*e),this._instance.start(0,e),this._wireUpOnEnded()}_wireUpOnEnded(){this.loop||(this._instance.onended=()=>this._handleOnEnded())}_handleOnEnded(){this._isPaused||(this._isPlaying=!1,this._playingResolve(!0))}_rememberStartTime(t){this._startTime=(new Date).getTime()+(0|t)}_setPauseOffset(){this._currentOffset=((new Date).getTime()-this._startTime)*this._playbackRate/1e3}_createNewBufferSource(){this._instance=this._audioContext.createBufferSource(),this._instance.buffer=this._src,this._instance.loop=this.loop,this._instance.playbackRate.setValueAtTime(1,0),this._instance.connect(this._volumeNode)}}function vn(t){try{const e=new Audio,i=/.*\.([A-Za-z0-9]+)$/,s=t.match(i)[1];return!!e.canPlayType("audio/"+s)}catch(t){return O.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",t),!1}}var bn=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{h(s.next(t))}catch(t){r(t)}}function a(t){try{h(s.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((s=s.apply(t,e||[])).next())}))};class xn extends ti{constructor(...t){super(),this.logger=O.getInstance(),this._loop=!1,this._volume=1,this._duration=void 0,this._isStopped=!1,this._isPaused=!1,this._tracks=[],this._wasPlayingOnHidden=!1,this._audioContext=di.create(),this._resource=new Qt("",on.type.arraybuffer);for(const e of t)if(vn(e)){this.path=e;break}this.path||(this.logger.warn("This browser does not support any of the audio files specified:",t.join(", ")),this.logger.warn("Attempting to use",t[0]),this.path=t[0])}set loop(t){this._loop=t;for(const t of this._tracks)t.loop=this._loop;this.logger.debug("Set loop for all instances of sound",this.path,"to",this._loop)}get loop(){return this._loop}set volume(t){this._volume=t;for(const t of this._tracks)t.volume=this._volume;this.emit("volumechange",new Ks(this)),this.logger.debug("Set loop for all instances of sound",this.path,"to",this._volume)}get volume(){return this._volume}get duration(){return this._duration}get instances(){return this._tracks}get path(){return this._resource.path}set path(t){this._resource.path=t}isLoaded(){return!!this.data}load(){return bn(this,void 0,void 0,(function*(){if(this.data)return this.data;const t=yield this._resource.load(),e=yield this.decodeAudio(t.slice(0));return this._duration="object"==typeof e?e.duration:void 0,this.emit("processed",new Vs(this,e)),this.data=e}))}decodeAudio(t){return bn(this,void 0,void 0,(function*(){try{return yield this._audioContext.decodeAudioData(t.slice(0))}catch(t){return this.logger.error("Unable to decode  this browser may not fully support this format, or the file may be corrupt, if this is an mp3 try removing id3 tags and album art from the file."),yield Promise.reject()}}))}wireEngine(t){t&&(this._engine=t,this._engine.on("hidden",()=>{t.pauseAudioWhenHidden&&this.isPlaying()&&(this._wasPlayingOnHidden=!0,this.pause())}),this._engine.on("visible",()=>{t.pauseAudioWhenHidden&&this._wasPlayingOnHidden&&(this.play(),this._wasPlayingOnHidden=!1)}),this._engine.on("start",()=>{this._isStopped=!1}),this._engine.on("stop",()=>{this.stop(),this._isStopped=!0}))}instanceCount(){return this._tracks.length}isPlaying(){return this._tracks.some(t=>t.isPlaying())}play(t){return this.isLoaded()?this._isStopped?(this.logger.warn("Cannot start playing. Engine is in a stopped state."),Promise.resolve(!1)):(this.volume=t||this.volume,this._isPaused?this._resumePlayback():this._startPlayback()):(this.logger.warn("Cannot start playing. Resource",this.path,"is not loaded yet"),Promise.resolve(!0))}pause(){if(this.isPlaying()){for(const t of this._tracks)t.pause();this._isPaused=!0,this.emit("pause",new Ks(this)),this.logger.debug("Paused all instances of sound",this.path)}}stop(){for(const t of this._tracks)t.stop();this.emit("stop",new Ks(this)),this._isPaused=!1,this._tracks.length=0,this.logger.debug("Stopped all instances of sound",this.path)}getTrackId(t){return this._tracks.indexOf(t)}_resumePlayback(){return bn(this,void 0,void 0,(function*(){if(this._isPaused){const t=[];for(const e of this._tracks)t.push(e.play());this._isPaused=!1,this.emit("resume",new Ks(this)),this.logger.debug("Resuming paused instances for sound",this.path,this._tracks),yield Promise.all(t)}return!0}))}_startPlayback(){return bn(this,void 0,void 0,(function*(){const t=yield this._getTrackInstance(this.data),e=yield t.play(()=>{this.emit("playbackstart",new Ks(this,t)),this.logger.debug("Playing new instance for sound",this.path)});return this.emit("playbackend",new Ks(this,t)),this._tracks.splice(this.getTrackId(t),1),e}))}_getTrackInstance(t){const e=new wn(t);return e.loop=this.loop,e.volume=this.volume,e.duration=this.duration,this._tracks.push(e),e}}var An=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{h(s.next(t))}catch(t){r(t)}}function a(t){try{h(s.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((s=s.apply(t,e||[])).next())}))};class Pn{constructor(t,e=Q.Magenta,i=!0){this.path=t,this.color=e,this.bustCache=i,this._stream=null,this._gif=null,this._textures=[],this._animation=null,this._transparentColor=null,this._resource=new Qt(t,"arraybuffer",i),this._transparentColor=e}load(){return An(this,void 0,void 0,(function*(){const t=yield this._resource.load();this._stream=new Cn(t),this._gif=new Tn(this._stream,this._transparentColor);const e=this._gif.images.map(t=>new ue(t.src,!1));return yield Promise.all(e.map(t=>t.load())),this.data=this._textures=e}))}isLoaded(){return!!this.data}asSprite(t=0){return this._textures[t].asSprite()}asSpriteSheet(){const t=this._textures.map(t=>t.asSprite());return new sn(t)}asAnimation(t,e){const i=this.asSpriteSheet();return this._animation=i.getAnimationForAll(t,e),this._animation}get readCheckBytes(){return this._gif.checkBytes}}const Sn=t=>t.reduce((function(t,e){return 2*t+e}),0),En=t=>{const e=[];for(let i=7;i>=0;i--)e.push(!!(t&1<<i));return e};class Cn{constructor(t){if(this.data=null,this.len=0,this.position=0,this.readByte=()=>{if(this.position>=this.data.byteLength)throw new Error("Attempted to read past end of stream.");return this.data[this.position++]},this.readBytes=t=>{const e=[];for(let i=0;i<t;i++)e.push(this.readByte());return e},this.read=t=>{let e="";for(let i=0;i<t;i++)e+=String.fromCharCode(this.readByte());return e},this.readUnsigned=()=>{const t=this.readBytes(2);return(t[1]<<8)+t[0]},this.data=new Uint8Array(t),this.len=this.data.byteLength,0===this.len)throw new Error("No data loaded from file")}}class Tn{constructor(t,e=Q.Magenta){this._st=null,this._handler={},this._transparentColor=null,this.frames=[],this.images=[],this.globalColorTable=[],this.checkBytes=[],this.parseColorTable=t=>{const e=[];for(let i=0;i<t;i++){const t="#"+this._st.readBytes(3).map(t=>{const e=t.toString(16);return 1===e.length?"0"+e:e}).join("");e.push(t)}return e},this.readSubBlocks=()=>{let t,e;e="";do{t=this._st.readByte(),e+=this._st.read(t)}while(0!==t);return e},this.parseHeader=()=>{const t={sig:null,ver:null,width:null,height:null,colorRes:null,globalColorTableSize:null,gctFlag:null,sorted:null,globalColorTable:[],bgColor:null,pixelAspectRatio:null};if(t.sig=this._st.read(3),t.ver=this._st.read(3),"GIF"!==t.sig)throw new Error("Not a GIF file.");t.width=this._st.readUnsigned(),t.height=this._st.readUnsigned();const e=En(this._st.readByte());t.gctFlag=e.shift(),t.colorRes=Sn(e.splice(0,3)),t.sorted=e.shift(),t.globalColorTableSize=Sn(e.splice(0,3)),t.bgColor=this._st.readByte(),t.pixelAspectRatio=this._st.readByte(),t.gctFlag&&(t.globalColorTable=this.parseColorTable(1<<t.globalColorTableSize+1),this.globalColorTable=t.globalColorTable),this._handler.hdr&&this._handler.hdr(t)&&this.checkBytes.push(this._handler.hdr)},this.parseExt=t=>{const e=t=>{this.checkBytes.push(this._st.readByte());const e=En(this._st.readByte());t.reserved=e.splice(0,3),t.disposalMethod=Sn(e.splice(0,3)),t.userInput=e.shift(),t.transparencyGiven=e.shift(),t.delayTime=this._st.readUnsigned(),t.transparencyIndex=this._st.readByte(),t.terminator=this._st.readByte(),this._handler.gce&&this._handler.gce(t)&&this.checkBytes.push(this._handler.gce)},i=t=>{t.comment=this.readSubBlocks(),this._handler.com&&this._handler.com(t)&&this.checkBytes.push(this._handler.com)},s=t=>{this.checkBytes.push(this._st.readByte()),t.ptHeader=this._st.readBytes(12),t.ptData=this.readSubBlocks(),this._handler.pte&&this._handler.pte(t)&&this.checkBytes.push(this._handler.pte)},n=t=>{const e=t=>{this.checkBytes.push(this._st.readByte()),t.unknown=this._st.readByte(),t.iterations=this._st.readUnsigned(),t.terminator=this._st.readByte(),this._handler.app&&this._handler.app.NETSCAPE&&this._handler.app.NETSCAPE(t)&&this.checkBytes.push(this._handler.app)},i=t=>{t.appData=this.readSubBlocks(),this._handler.app&&this._handler.app[t.identifier]&&this._handler.app[t.identifier](t)&&this.checkBytes.push(this._handler.app[t.identifier])};switch(this.checkBytes.push(this._st.readByte()),t.identifier=this._st.read(8),t.authCode=this._st.read(3),t.identifier){case"NETSCAPE":e(t);break;default:i(t)}},r=t=>{t.data=this.readSubBlocks(),this._handler.unknown&&this._handler.unknown(t)&&this.checkBytes.push(this._handler.unknown)};switch(t.label=this._st.readByte(),t.label){case 249:t.extType="gce",e(t);break;case 254:t.extType="com",i(t);break;case 1:t.extType="pte",s(t);break;case 255:t.extType="app",n(t);break;default:t.extType="unknown",r(t)}},this.parseImg=t=>{t.leftPos=this._st.readUnsigned(),t.topPos=this._st.readUnsigned(),t.width=this._st.readUnsigned(),t.height=this._st.readUnsigned();const e=En(this._st.readByte());t.lctFlag=e.shift(),t.interlaced=e.shift(),t.sorted=e.shift(),t.reserved=e.splice(0,2),t.lctSize=Sn(e.splice(0,3)),t.lctFlag&&(t.lct=this.parseColorTable(1<<t.lctSize+1)),t.lzwMinCodeSize=this._st.readByte();const i=this.readSubBlocks();t.pixels=function(t,e){let i=0;const s=function(t){let s=0;for(let n=0;n<t;n++)e.charCodeAt(i>>3)&1<<(7&i)&&(s|=1<<n),i++;return s},n=[],r=1<<t,o=r+1;let a=t+1,h=[];const c=function(){h=[],a=t+1;for(let t=0;t<r;t++)h[t]=[t];h[r]=[],h[o]=null};let l,u;for(;;)if(u=l,l=s(a),l!==r){if(l===o)break;if(l<h.length)u!==r&&h.push(h[u].concat(h[l][0]));else{if(l!==h.length)throw new Error("Invalid LZW code.");h.push(h[u].concat(h[u][0]))}n.push.apply(n,h[l]),h.length===1<<a&&a<12&&a++}else c();return n}(t.lzwMinCodeSize,i),t.interlaced&&(t.pixels=((t,e)=>{const i=new Array(t.length),s=t.length/e,n=(s,n)=>{const r=t.slice(n*e,(n+1)*e);i.splice.apply(i,[s*e,e].concat(r))},r=[0,4,2,1],o=[8,8,4,2];let a=0;for(let t=0;t<4;t++)for(let e=r[t];e<s;e+=o[t])n(e,a),a++;return i})(t.pixels,t.width)),this.frames.push(t),this.arrayToImage(t),this._handler.img&&this._handler.img(t)&&this.checkBytes.push(this._handler)},this.parseBlock=()=>{const t={sentinel:this._st.readByte(),type:""};switch(String.fromCharCode(t.sentinel)){case"!":t.type="ext",this.parseExt(t);break;case",":t.type="img",this.parseImg(t);break;case";":t.type="eof",this._handler.eof&&this._handler.eof(t)&&this.checkBytes.push(this._handler.eof);break;default:throw new Error("Unknown block: 0x"+t.sentinel.toString(16))}"eof"!==t.type&&this.parseBlock()},this.arrayToImage=t=>{let e=0;const i=document.createElement("canvas");i.id=e.toString(),i.width=t.width,i.height=t.height,e++;const s=i.getContext("2d");let n=0,r=0;for(let e=0;e<t.pixels.length;e++)r%t.width==0&&(n++,r=0),this.globalColorTable[t.pixels[e]]===this._transparentColor.toHex()?s.fillStyle="rgba(0, 0, 0, 0)":s.fillStyle=this.globalColorTable[t.pixels[e]],s.fillRect(r,n,1,1),r++;const o=new Image;o.src=i.toDataURL(),this.images.push(o)},this._st=t,this._handler={},this._transparentColor=e,this.parseHeader(),this.parseBlock()}}var Mn=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};let Bn=class{constructor(t){this._getComparable=t}find(t){return this._find(this._root,t)}_find(t,e){return null!=t&&(this._getComparable(e)===t.getKey()?t.getData().indexOf(e)>-1:this._getComparable(e)<t.getKey()?this._find(t.getLeft(),e):this._find(t.getRight(),e))}get(t){return this._get(this._root,t)}_get(t,e){return null==t?[]:e===t.getKey()?t.getData():e<t.getKey()?this._get(t.getLeft(),e):this._get(t.getRight(),e)}add(t){return null==this._root?(this._root=new Dn(this._getComparable(t),[t],null,null),!0):this._insert(this._root,t)}_insert(t,e){return null!=t&&(this._getComparable(e)===t.getKey()?!(t.getData().indexOf(e)>-1)&&(t.getData().push(e),!0):this._getComparable(e)<t.getKey()?null==t.getLeft()?(t.setLeft(new Dn(this._getComparable(e),[e],null,null)),!0):this._insert(t.getLeft(),e):null==t.getRight()?(t.setRight(new Dn(this._getComparable(e),[e],null,null)),!0):this._insert(t.getRight(),e))}removeByComparable(t){this._root=this._remove(this._root,t)}_remove(t,e){if(null==t)return null;if(this._getComparable(e)!==t.getKey())return this._getComparable(e)<t.getKey()?(t.setLeft(this._remove(t.getLeft(),e)),t):(t.setRight(this._remove(t.getRight(),e)),t);{const i=t.getData().indexOf(e);if(i>-1){if(t.getData().splice(i,1),0===t.getData().length){if(null==t.getLeft()&&null==t.getRight())return null;if(null==t.getLeft())return t.getRight();if(null==t.getRight())return t.getLeft();const e=this._findMinNode(t.getRight());return t.setKey(e.getKey()),t.setData(e.getData()),t.setRight(this._cleanup(t.getRight(),e)),t}return t}}return null}_cleanup(t,e){const i=e.getKey();if(null==t)return null;if(i===t.getKey()){if(null==t.getLeft()&&null==t.getRight())return null;if(null==t.getLeft())return t.getRight();if(null==t.getRight())return t.getLeft();const e=this._findMinNode(t.getRight());return t.setKey(e.getKey()),t.setData(e.getData()),t.setRight(this._cleanup(t.getRight(),e)),t}return e.getKey()<t.getKey()?(t.setLeft(this._cleanup(t.getLeft(),e)),t):(t.setRight(this._cleanup(t.getRight(),e)),t)}_findMinNode(t){let e=t;for(;null!=e.getLeft();)e=e.getLeft();return e}list(){const t=new Array;return this._list(this._root,t),t}_list(t,e){null!=t&&(this._list(t.getLeft(),e),t.getData().forEach(t=>{e.push(t)}),this._list(t.getRight(),e))}};Bn=Mn([W({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use built in JS array.sort"})],Bn);let Dn=class{constructor(t,e,i,s){this._key=t,this._data=e,this._left=i,this._right=s}getKey(){return this._key}setKey(t){this._key=t}getData(){return this._data}setData(t){this._data=t}getLeft(){return this._left}setLeft(t){this._left=t}getRight(){return this._right}setRight(t){this._right=t}};Dn=Mn([W({message:"Will be removed in excalibur v0.26.0"})],Dn);class Rn{constructor(t){this._key=0,this._key=t}getTheKey(){return this._key}setKey(t){this._key=t}}var kn,On,Fn=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};!function(t){t[t.Resolved=0]="Resolved",t[t.Rejected=1]="Rejected",t[t.Pending=2]="Pending"}(On||(On={}));let In=kn=class{constructor(){this._state=On.Pending,this._successCallbacks=[],this._rejectCallback=()=>{}}static resolve(t){return(new kn).resolve(t)}static reject(t){return(new kn).reject(t)}static join(){let t=[];if(arguments.length>0&&!Array.isArray(arguments[0]))for(let e=0;e<arguments.length;e++)t[e-0]=arguments[e];else 1===arguments.length&&Array.isArray(arguments[0])&&(t=arguments[0]);const e=new kn;if(!t||!t.length)return e.resolve();const i=t.length;let s=0,n=0;const r=[];return t.forEach(t=>{t.then(()=>{s+=1,s===i?e.resolve():s+n+r.length===i&&e.reject(r)},()=>{n+=1,s+n+r.length===i&&e.reject(r)}).error(t=>{r.push(t),r.length+s+n===i&&e.reject(r)})}),e}then(t,e){if(t&&(this._successCallbacks.push(t),this.state()===On.Resolved))try{t.call(this,this._value)}catch(t){this._handleError(t)}if(e&&(this._rejectCallback=e,this.state()===On.Rejected))try{e.call(this,this._value)}catch(t){this._handleError(t)}return this}error(t){return t&&(this._errorCallback=t),this}resolve(t){if(this._state!==On.Pending)throw new Error("Cannot resolve a promise that is not in a pending state!");this._value=t;try{this._state=On.Resolved,this._successCallbacks.forEach(t=>{t.call(this,this._value)})}catch(t){this._handleError(t)}return this}reject(t){if(this._state!==On.Pending)throw new Error("Cannot reject a promise that is not in a pending state!");this._value=t;try{this._state=On.Rejected,this._rejectCallback.call(this,this._value)}catch(t){this._handleError(t)}return this}state(){return this._state}_handleError(t){if(!this._errorCallback)throw t;this._errorCallback.call(this,t)}};In=kn=Fn([W({message:"ex.Promises are being replaced by native browser promises in v0.26.0",alternateMethod:"Use browser native promises"})],In);const Ln="0.25.0-alpha.7657+d37f728";l()}])}));
//# sourceMappingURL=excalibur.min.js.map