{"version":3,"sources":["webpack://ex/webpack/universalModuleDefinition","webpack://ex/webpack/bootstrap","webpack://ex/./Loader.logo.png","webpack://ex/./Loader.css?aa59","webpack://ex/./Loader.css","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/css-loader/lib/css-base.js","webpack://ex/./Promises.ts","webpack://ex/./Polyfill.ts","webpack://ex/./Collision/Side.ts","webpack://ex/./Math/Random.ts","webpack://ex/./Util/Util.ts","webpack://ex/./Algebra.ts","webpack://ex/./Events.ts","webpack://ex/./Physics.ts","webpack://ex/./EventDispatcher.ts","webpack://ex/./Class.ts","webpack://ex/./Drawing/Color.ts","webpack://ex/./Collision/CollisionType.ts","webpack://ex/./Collision/CollisionContact.ts","webpack://ex/./Util/Log.ts","webpack://ex/./Collision/CollisionJumpTable.ts","webpack://ex/./Collision/Circle.ts","webpack://ex/./Collision/Edge.ts","webpack://ex/./Collision/ConvexPolygon.ts","webpack://ex/./Util/Decorators.ts","webpack://ex/./Collision/BoundingBox.ts","webpack://ex/./Resources/Resource.ts","webpack://ex/./Drawing/SpriteEffects.ts","webpack://ex/./Configurable.ts","webpack://ex/./Actions/RotationType.ts","webpack://ex/./Drawing/Sprite.ts","webpack://ex/./Resources/Texture.ts","webpack://ex/./Actions/Action.ts","webpack://ex/./Util/EasingFunctions.ts","webpack://ex/./Actions/ActionContext.ts","webpack://ex/./Collision/Shape.ts","webpack://ex/./Collision/Body.ts","webpack://ex/./Traits/TileMapCollisionDetection.ts","webpack://ex/./Util/CullingBox.ts","webpack://ex/./Traits/OffscreenCulling.ts","webpack://ex/./Traits/CapturePointer.ts","webpack://ex/./Util/DrawUtil.ts","webpack://ex/./Collision/CollisionGroup.ts","webpack://ex/./Collision/Pair.ts","webpack://ex/./Collision/Collider.ts","webpack://ex/./Actor.ts","webpack://ex/./UIActor.ts","webpack://ex/./Timer.ts","webpack://ex/./TileMap.ts","webpack://ex/./Resources/Sound/AudioContext.ts","webpack://ex/./Util/WebAudio.ts","webpack://ex/./Camera.ts","webpack://ex/./Loader.ts","webpack://ex/./Util/Detector.ts","webpack://ex/./Collision/DynamicTree.ts","webpack://ex/./Collision/DynamicTreeCollisionBroadphase.ts","webpack://ex/./Util/SortedList.ts","webpack://ex/./Group.ts","webpack://ex/./Label.ts","webpack://ex/./Trigger.ts","webpack://ex/./Util/Actors.ts","webpack://ex/./Input/Keyboard.ts","webpack://ex/./Scene.ts","webpack://ex/./Debug.ts","webpack://ex/./Input/Pointer.ts","webpack://ex/./Input/Gamepad.ts","webpack://ex/./Engine.ts","webpack://ex/./Particles.ts","webpack://ex/./Events/MediaEvents.ts","webpack://ex/./Actions/Index.ts","webpack://ex/./Collision/CollisionGroupManager.ts","webpack://ex/./Drawing/Animation.ts","webpack://ex/./Drawing/Polygon.ts","webpack://ex/./Drawing/SpriteSheet.ts","webpack://ex/./Interfaces/AudioImplementation.ts","webpack://ex/./Math/PerlinNoise.ts","webpack://ex/./PostProcessing/ColorBlindCorrector.ts","webpack://ex/./Resources/Sound/AudioInstance.ts","webpack://ex/./Util/Sound.ts","webpack://ex/./Resources/Sound/Sound.ts","webpack://ex/./Resources/Gif.ts","webpack://ex/./index.ts"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","result","toString","push","useSourceMap","list","this","map","item","content","cssMapping","btoa","sourceMapping","sourceMap","unescape","encodeURIComponent","JSON","stringify","sourceURLs","sources","source","sourceRoot","concat","join","cssWithMappingToString","mediaQuery","alreadyImportedModules","length","id","PromiseState","polyfill","audioContext","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","callback","setInterval","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","AudioContext","webkitAudioContext","mozAudioContext","msAudioContext","oAudioContext","devicePixelRatio","Array","forEach","thisArg","T","k","TypeError","O","len","arguments","kValue","some","fun","Function","oThis","aArgs","slice","fToBind","fNOP","fBound","apply","Side","Promise","_state","Pending","_successCallbacks","_rejectCallback","resolve","reject","promises","isArray","_i","joinedPromise","total","successes","rejects","errors","then","error","e","successCallback","rejectCallback","state","Resolved","_value","_handleError","Rejected","errorCallback","_errorCallback","_this","Error","cb","Random","seed","_lowerMask","_upperMask","_w","_n","_m","_a","_u","_s","_b","_t","_c","_l","_f","_mt","Date","now","_index","_twist","mag01","y","nextInt","next","floating","min","max","integer","Math","floor","bool","likelihood","pickOne","array","pickSet","numPicks","allowDuplicates","_pickSetWithDuplicates","_pickSetWithoutDuplicates","currentPick","tempArray","index","splice","shuffle","swap","randomIndex","range","d4","d6","d8","d10","d12","d20","TwoPI","PI","extend","extended","deep","assignExists","assign","merge","obj","prop","base64Encode","inputStr","b64","outputStr","byte1","charCodeAt","byte2","byte3","enc1","enc2","enc3","enc4","isNaN","charAt","clamp","val","randomInRange","random","randomIntInRange","round","canonicalizeAngle","angle","tmpAngle","toDegrees","radians","toRadians","degrees","getPosition","el","oLeft","oTop","calcOffsetLeft","parent","offsetLeft","offsetParent","calcOffsetTop","offsetTop","Vector","addItemToArray","indexOf","removeItemFromArray","contains","getOppositeSide","side","Top","Bottom","Left","Right","None","getSideFromVector","direction","getSideFromDirection","directions","Up","Down","directionEnum","Number","MAX_VALUE","maxIndex","dot","Collection","initialSize","DefaultSize","_internalArray","_endPointer","_resize","newSize","newArray","count","element","pop","clear","internalSize","elementAt","insert","remove","removed","removeElement","toArray","func","fail","message","EventTypes","x","fromAngle","cos","sin","isValid","vec","Infinity","distance","vec1","vec2","sqrt","pow","setTo","equals","vector","tolerance","abs","v","Zero","magnitude","normalize","average","add","scale","sizeOrScale","sub","addEqual","subEqual","scaleEqual","size","cross","perpendicular","normal","negate","toAngle","atan2","rotate","anchor","sinAngle","cosAngle","clone","Ray","pos","dir","intersect","line","numerator","begin","getSlope","divisor","u","getLength","getPoint","time","Line","end","slope","distanceToPoint","point","x0","y0","dy","dx","findPoint","b","intercept","hasPoint","currPoint","threshold","dxc","dyc","dx1","dy1","Projection","overlaps","projection","getOverlap","Algebra_GlobalCoordinates","GlobalCoordinates","worldPos","pagePos","screenPos","fromPagePosition","xOrPos","yOrEngine","engineOrUndefined","pageX","pageY","engine","screenX","canvas","screenY","screenToWorldCoordinates","CollisionResolutionStrategy","BroadphaseStrategy","Integrator","GameEvent","bubbles","_path","_name","stopPropagation","action","actor","eventPath","_onActionStart","eventDispatcher","emit","_onActionEnd","propagate","layPath","actorPath","getAncestors","_actor","KillEvent","_super","target","__extends","PreKillEvent","PostKillEvent","GameStartEvent","GameStopEvent","PreDrawEvent","ctx","delta","PostDrawEvent","PreDebugDrawEvent","PostDebugDrawEvent","PreUpdateEvent","PostUpdateEvent","PreFrameEvent","prevStats","PostFrameEvent","stats","GamepadConnectEvent","gamepad","GamepadDisconnectEvent","GamepadButtonEvent","button","GamepadAxisEvent","axis","SubscribeEvent","topic","handler","UnsubscribeEvent","VisibleEvent","HiddenEvent","PreCollisionEvent","other","intersection","PostCollisionEvent","CollisionStartEvent","pair","CollisionEndEvent","InitializeEvent","ActivateEvent","oldScene","DeactivateEvent","newScene","ExitViewPortEvent","EnterViewPortEvent","EnterTriggerEvent","ExitTriggerEvent","EventDispatcher_EventDispatcher","EventDispatcher","_handlers","_wiredEventDispatchers","_target","eventName","event","toLowerCase","on","off","eventHandlers","once","ev","wire","unwire","Class_Class","Class","eventObject","methods","child","constructor","Super","Color","g","a","fromRGB","fromHex","hex","match","parseInt","fromHSL","h","HSLColor","toRGBA","lighten","factor","temp","fromRGBA","darken","saturate","desaturate","mulitiply","color","screen","color1","invert","color2","format","toHSLA","toHex","_componentToHex","String","toFixed","undefined","fillStyle","hue2rgb","q","CollisionType","Physics_Physics","Physics","useBoxPhysics","collisionResolutionStrategy","Box","useRigidBodyPhysics","RigidBody","acc","enabled","collisionPasses","broadphaseStrategy","DynamicAABBTree","broadphaseDebug","showCollisionNormals","showMotionVectors","showBounds","showArea","showContacts","showNormals","defaultMass","integrator","Euler","integrationSteps","allowRigidBodyRotation","collisionShift","dynamicTreeVelocityMultiplyer","boundsPadding","surfaceEpsilon","checkForFastBodies","disableMinimumSpeedForFastBody","LogLevel","CollisionContact_CollisionContact","CollisionContact","colliderA","colliderB","mtv","strategy","_resolveRigidBodyCollision","_resolveBoxCollision","_applyBoxImpulse","type","Active","Passive","body","mtvDir","vel","velAdj","bodyA","bodyB","invMassA","Fixed","mass","invMassB","invMoiA","inertia","invMoiB","coefRestitution","bounciness","coefFriction","friction","tangent","ra","center","rb","rv","rx","rvNormal","rvTangent","raTangent","raNormal","rbTangent","rbNormal","impulse","addMtv","jt","frictionImpulse","CollisionJumpTable","CollideCircleCircle","circleA","circleB","radius","circleAPos","circleBPos","axisOfCollision","mvt","pointOfCollision","getFurthestPoint","collider","CollideCirclePolygon","circle","polygon","minAxis","testSeparatingAxisTheorem","samedir","verts","point1","point2","CollideCircleEdge","edge","cc","da","dda","db","ddb","den","pointOnEdge","dd","CollideEdgeEdge","CollidePolygonEdge","edgeNormal","getClosestFace","face","pc","linePoly","ConvexPolygon_ConvexPolygon","points","CollidePolygonPolygon","polyA","polyB","sameDir","pointA","pointB","contact","Circle_Circle","Circle","options","offset","rayCast","ray","orig","discriminant","toi","toi1","toi2","mintoi","collide","shape","Edge_Edge","bodyPos","BoundingBox_BoundingBox","axes","closestPointOnPoly","minOverlap","minIndex","proj1","project","proj2","overlap","recalc","scalars","dotProduct","draw","Green","newPos","beginPath","arc","closePath","fill","debugDraw","rotation","strokeStyle","stroke","moveTo","lineTo","CircleArea","Circle_extends","Edge","_getBodyPos","_getTransformedBegin","_getTransformedEnd","transformedBegin","transformedEnd","_boundsFromBeginEnd","Red","EdgeArea","Edge_extends","ConvexPolygon","_transformedPoints","_axes","_sides","winding","clockwiseWinding","reverse","_calculateTransformation","One","getTransformedPoints","oldPos","oldRotation","oldScale","getSides","lines","testRay","reduce","accum","pts","furthestPoint","maxDistance","sides","POSITIVE_INFINITY","faceIndex","dist","fromPoints","denominator","iplusone","crossTerm","minContactTime","contactIndex","contactTime","poly2","scalar","firstPoint","PolygonArea","ConvexPolygon_extends","Logger","_appenders","defaultLevel","Info","_instance","addAppender","ConsoleAppender","getInstance","appender","clearAppenders","_log","level","args","log","debug","Debug","info","warn","Warn","fatal","Fatal","console","consoleArgs","unshift","ScreenAppender","width","height","_messages","_canvas","document","createElement","innerWidth","innerHeight","style","position","_ctx","getContext","appendChild","clearRect","opacity","fillText","obsolete","alternateMethod","descriptor","set","SyntaxError","method","__assign","trace","BoundingBox","left","top","right","bottom","getSideFromIntersection","minX","minY","maxX","maxY","fromDimension","Half","getWidth","getHeight","getCenter","translate","getPoints","shifted","getPerimeter","results","toPolygon","farClipDistance","tmin","tmax","xinv","yinv","tx1","tx2","ty1","ty2","rayCastTime","combine","totalBoundingBox","dimensions","overlapX","overlapY","intersectWithSide","bb","collides","boundingBox","Yellow","strokeRect","__decorate","Resource_Resource","Resource","path","responseType","bustCache","data","logger","arrayBuffer","onprogress","oncomplete","onerror","Resource_extends","isLoaded","wireEngine","_engine","_cacheBust","uri","test","_start","load","complete","request","XMLHttpRequest","open","onloadstart","onload","status","response","processData","send","getData","getArrayData","setData","URL","createObjectURL","Grayscale","updatePixel","imageData","firstPixel","pixel","avg","Invert","Opacity","Colorize","SpriteEffects_Lighten","Lighten","SpriteEffects_Darken","Darken","SpriteEffects_Saturate","Saturate","SpriteEffects_Desaturate","Desaturate","Fill","Configurable","base","class_1","filter","Configurable_extends","props","RotationType","Sprite","imageOrConfig","Sprite_extends","SpriteImpl","flipVertical","flipHorizontal","effects","_spriteCanvas","_spriteCtx","_pixelData","_pixelsLoaded","_dirtyEffect","image","Texture_Texture","_texture","loaded","naturalWidth","naturalHeight","_loadPixels","drawImage","addEffect","grayscale","colorize","effect","_applyEffects","removeEffect","param","indexToRemove","getImageData","putImageData","clearEffects","reset","save","xpoint","drawWidth","ypoint","drawHeight","Black","restore","Texture","_isLoaded","_sprite","Texture_extends","Image","addEventListener","src","asSprite","Action_EaseTo","EaseTo","duration","easingFcn","_currentLerpTime","_lerpDuration","_lerpStart","_lerpEnd","_initialized","_stopped","_distance","_initialize","update","newX","newY","isComplete","stop","Action_MoveTo","MoveTo","destx","desty","speed","_started","_end","_speed","_delta","_dir","Action_MoveBy","MoveBy","offsetX","offsetY","_offset","Action_Follow","Follow","actorToFollow","followDistance","_actorToFollow","_current","_maximumDistance","_distanceBetween","actorToFollowSpeed","Action_Meet","Meet","actorToMeet","_speedWasSpecified","_actorToMeet","actorToMeetSpeed","Action_RotateTo","RotateTo","angleRadians","rotationType","_rotationType","ShortestPath","distance1","distance2","_shortDistance","_longDistance","_shortestPathIsPositive","_direction","LongestPath","Clockwise","CounterClockwise","distanceTravelled","Action_RotateBy","RotateBy","angleRadiansOffset","ScaleTo","scaleX","scaleY","speedX","speedY","_endX","_endY","_speedX","_speedY","_startX","_startY","_distanceX","_distanceY","sx","directionX","sy","directionY","Action_ScaleBy","ScaleBy","scaleOffsetX","scaleOffsetY","_startScale","_endScale","_directionX","_directionY","Delay","delay","_elapsedTime","_delay","Blink","timeVisible","timeNotVisible","numBlinks","_timeVisible","_timeNotVisible","_totalTime","_duration","visible","Action_Fade","Fade","endOpacity","_multiplier","_endOpacity","Die","actionQueue","clearActions","kill","CallMethod","_method","_hasBeenCalled","Repeat","repeat","actions","_actionQueue","ActionQueue","_repeat","_originalRepeat","hasNext","RepeatForever","_actions","_completedActions","_currentAction","getActions","shift","EasingFunctions_EasingFunctions","EasingFunctions","CreateReversableEasingFunction","easing","start","CreateVectorEasingFunction","Linear","currentTime","startValue","endValue","EaseInQuad","EaseOutQuad","EaseInOutQuad","EaseInCubic","EaseOutCubic","EaseInOutCubic","ActionContext_ActionContext","ActionContext","_actors","_queues","addActorToContext","removeActorFromContext","easeTo","moveBy","xOffset","yOffset","rotateTo","rotateBy","scaleTo","sizeX","sizeY","scaleBy","sizeOffsetX","sizeOffsetY","blink","fade","die","callMethod","times","repeatForever","follow","meet","asPromise","Shape_Shape","Shape","Polygon","Body_Body","Body","oldVel","oldAcc","torque","motion","_geometryDirty","_totalMtv","useBoxCollider","isKilled","_collider","_wireColliderEventsToActor","applyMtv","markCollisionShapeDirty","captureOldTransform","integrate","seconds","totalAcc","useBoxCollision","usePolygonCollider","usePolygonCollision","useCircleCollider","useCircleCollision","useEdgeCollider","useEdgeCollision","evt","Body_decorate","TileMapCollisionDetection_TileMapCollisionDetection","TileMapCollisionDetection","PreventCollision","currentScene","tileMaps","j","intersectMap","CullingBox_CullingBox","CullingBox","_topLeft","_topRight","_bottomLeft","_bottomRight","isSpriteOffScreen","drawingWidth","currentDrawing","drawingHeight","getWorldPos","topLeftScreen","worldToScreenCoordinates","topRightScreen","bottomLeftScreen","bottomRightScreen","_xCoords","_yCoords","_xMin","_yMin","_xMax","_yMax","minWorld","maxWorld","_xMinWorld","_yMinWorld","_xMaxWorld","_yMaxWorld","boundingPoints","clientWidth","clientHeight","White","rect","Blue","Magenta","OffscreenCulling_OffscreenCulling","OffscreenCulling","cullingBox","events","actorBoundsOffscreen","camera","viewport","bounds","isOffScreen","CapturePointer","enableCapturePointer","input","pointers","revisePointerEventsPaths","x1","y1","x2","y2","thickness","cap","lineWidth","lineCap","DrawUtil_point","origin","roundRect","br","tl","tr","bl","defaultRadius","quadraticCurveTo","DrawUtil_circle","CollisionGroup","category","mask","_category","_mask","canCollide","All","Pair_Pair","Pair","collision","calculatePairHash","group","active","actorA","actorB","Cyan","isCollider","Collider_Collider","Collider","useShapeInertia","_events","_shape","touching","localBounds","isActor","Actor","xOrConfig","Actor_extends","ActorImpl","maxId","_height","_width","previousOpacity","scene","children","collisionGroups","_collisionHandlers","_isInitialized","frames","_effectsDirty","traits","capturePointer","captureMoveEvents","captureDragEvents","_zIndex","_isKilled","_opacityFx","_capturePointerEvents","_captureMoveEvents","_captureDragEvents","shouldInitializeBody","config","_initDefaults","_body","area","theX","theY","thePos","theVel","theAcc","theAngle","angularVelocity","theTorque","theMass","theMoi","theFriction","theRestitution","scalePerSecondX","scalePerSecondY","_color","onInitialize","isInitialized","defaults","_checkForPointerOptIn","normalized","_prekill","_scene","onPreKill","_postkill","onPostKill","unkill","setDrawing","addDrawing","getZIndex","newZ","setZIndex","newIndex","cleanupDrawTree","updateDrawTree","addCollisionGroup","removeCollisionGroup","getGlobalScale","setWidth","setHeight","getLeft","getBounds","getRight","getTop","getBottom","getWorldRotation","parents","reduceRight","px","py","parentScale","rotated","_getCalculatedAnchor","getRelativeBounds","getGeometry","getRelativeGeometry","recurse","childShift","containment","getSideFromIntersect","collidesWithSide","separationVector","otherBounds","onCollidesWith","getCollisionHandlers","removeCollidesWith","within","_reapplyEffects","drawing","_preupdate","_postupdate","onPreUpdate","onPostUpdate","_predraw","_postdraw","onPreDraw","onPostDraw","ticks","0 Pi","Pi/2","Pi","3/2 Pi","oldFont","font","tick","textAlign","currentActor","Actor_decorate","UIActor_UIActor","UIActor","UIActor_extends","useWorld","coords","Timer","fcn","interval","repeats","numberOfRepeats","maxNumberOfRepeats","_totalTimeAlive","_paused","_numberOfTicks","newInterval","newNumberOfRepeats","getTimeRunning","pause","unpause","cancel","cancelTimer","TileMap","cellWidth","cellHeight","rows","cols","TileMap_extends","TileMapImpl","_collidingX","_collidingY","_onScreenXStart","_onScreenXEnd","_onScreenYStart","_onScreenYEnd","_spriteSheets","cd","Cell","registerSpriteSheet","spriteSheet","actorBounds","cell","getCellByPoint","solid","getCellByIndex","getCell","worldCoordsUpperLeft","worldCoordsLowerRight","cs","csi","cslen","xEnd","yEnd","sprites","spriteId","ss","spriteSheetKey","sprite","getSprite","fillRect","TileSprite","CellImpl","_bounds","pushSprite","tileSprite","removeSprite","clearSprites","TileMap_decorate","AudioContextFactory","_INSTANCE","Axis","WebAudio_WebAudio","WebAudio","unlock","promise","_unlocked","unlockTimeoutTimer","setTimeout","resume","buffer","createBuffer","createBufferSource","ended","connect","destination","onended","noteOn","playbackState","isLegacyWebAudioSource","PLAYING_STATE","FINISHED_STATE","clearTimeout","isUnlocked","Loader_Loader","Loader","loadables","_resourceList","_playButtonShown","_resourceCount","_numLoaded","_progressCounts","_totalCounts","logo","Loader_logo_default","logoWidth","logoHeight","backgroundColor","suppressPlayButton","_playButtonStyles","Loader_default","playButtonText","startButtonFactory","buttonElement","textContent","display","addResources","Loader_extends","_imageElement","_playButtonRootElement","_styleBlock","head","_playButtonElement","addResource","loadable","showPlayButton","_playButton","promise_1","hidePlayButton","me","progressArray","progressChunks","progressResult","loadNext","canvasHeight","pixelRatio","canvasWidth","top_1","buttonWidth","buttonHeight","imageHeight","oldAntialias","getAntialiasing","setAntialiasing","_image","progressWidth","margin","REPORTED_FEATURES","webgl","webaudio","gamepadapi","Detector_Detector","Detector","_features","failedTests","_criticalTests","canvasSupport","elem","arrayBufferSupport","xhr","dataUrlSupport","toDataURL","objectUrlSupport","rgbaSupport","cssText","_warningTest","webAudioSupport","webglSupport","_loadBrowserFeatures","getBrowserFeatures","logBrowserFeatures","msg","supported","keys","feature","arraybuffer","dataurl","objecturl","rgba","navigator","getGamepads","failedCritical","warning","DynamicTree_TreeNode","TreeNode","isLeaf","DynamicTree_DynamicTree","DynamicTree","worldBounds","nodes","_insert","leaf","leafAABB","currentRoot","combinedArea","cost","inheritanceCost","leftCost","leftCombined","oldArea","rightCost","rightCombined","oldParent","newParent","currentNode","_balance","_remove","sibling","grandParent","trackBody","node","updateBody","untrackBody","multdx","multdy","f","balance","query","helper","rayCastQuery","getNodes","DynamicTreeCollisionBroadphase_DynamicTreeCollisionBroadphase","DynamicTreeCollisionBroadphase","_dynamicCollisionTree","_collisionHash","_collisionPairCache","_lastFramePairs","_lastFramePairsHash","track","untrack","_shouldGenerateCollisionPair","hash","broadphase","targets","potentialColliders","physics","pairs","collider_1","updateDistance","minDimension","fastBodies","minBody_1","updateVec","centerPoint","origin_1","ray_1","minTranslate_1","this_1","hitPoint","fastBodyCollisions","potentialColliders_1","narrowphase","collisions","collidersHash","pairs_1","runCollisionStartEnd","currentFrameHash","pairs_2","actor1","actor2","updated","SortedList","getComparable","_getComparable","find","_find","_root","getKey","_get","BinaryTreeNode","setLeft","setRight","removeByComparable","elementIndex","_findMinNode","setKey","_cleanup","comparable","current","_list","treeNode","_key","_data","_left","_right","MockedElement","getTheKey","Group_Group","Group","_logger","_members","groups","Group_extends","actorOrActors","getMembers","move","members","getRandomMember","prev","curr","Group_decorate","StrategyContainer","lockToActor","addStrategy","LockCameraToActorStrategy","lockToActorAxis","Camera_LockCameraToActorAxisStrategy","elasticToActor","cameraElasticity","cameraFriction","Camera_ElasticToActorStrategy","radiusAroundActor","RadiusAroundActorStrategy","FontUnit","TextAlign","BaseAlign","FontStyle","_cam","_eng","cam","currentFocus","getFocus","X","focus","cameraVel","stretch","Camera_Camera","Camera","_cameraStrategies","z","dz","ax","ay","az","_x","_y","_cameraMoving","_isShaking","_shakeMagnitudeX","_shakeMagnitudeY","_shakeDuration","_elapsedShakeTime","_xShake","_yShake","_isZooming","_zoomStart","_zoomEnd","_currentZoomTime","_zoomDuration","_zoomEasing","_easing","Camera_extends","_follow","easingFn","_lerpPromise","shake","magnitudeX","magnitudeY","zoom","_zoomPromise","getZoom","halfWidth","halfDrawWidth","halfHeight","halfDrawHeight","cameraStrategy","removeStrategy","clearAllStrategies","newZoom","zoomEasing","lerpPoint","moveEasing","_isDoneShaking","newCanvasWidth","newCanvasHeight","setLineDash","Label","textOrConfig","fontFamily","spriteFont","Label_extends","LabelImpl","bold","fontSize","fontStyle","Normal","fontUnit","Px","baseAlign","letterSpacing","caseInsensitive","text","_textShadowOn","_shadowOffsetX","_shadowOffsetY","getTextWidth","_fontString","measureText","_lookupFontUnit","Em","Rem","Pt","Percent","_lookupTextAlign","Center","End","Start","_lookupBaseAlign","Alphabetic","Hanging","Ideographic","Middle","_lookupFontStyle","boldstring","Italic","Oblique","setTextShadow","shadowColor","useTextShadow","clearTextShadow","_fontDraw","oldAlign","oldTextBaseline","textBaseline","maxWidth","triggerDefaults","Trigger_Trigger","Trigger","opts","_dispatchAction","Trigger_extends","wp","Violet","isUIActor","Keys","Scene_Scene","Scene","actors","_bodies","triggers","_groups","uiActors","_sortedDrawingTree","_broadphase","_killQueue","_triggerKillQueue","_timers","_cancelQueue","Scene_extends","onActivate","_oldScene","_newScene","onDeactivate","_initializeChildren","_activate","_deactivate","removeTimer","_collectActorStats","beforeBroadphase","currFrame","afterBroadphase","beforeNarrowphase","iter","collisionDelta","afterNarrowphase","killed","_processKillQueue","killQueue","collection","actorIndex","killQueue_1","sortedChildren","isDebug","entity","addUIActor","_addChild","addTimer","addTileMap","removeUIActor","_removeChild","removeTileMap","tileMap","timer","isTimerActive","createGroup","getGroup","removeGroup","isActorInDrawTree","isCurrentScene","ui","alive","_d","_e","Scene_decorate","FrameStats","prevFrame","_id","_fps","_actorStats","remaining","_durationStats","_physicsStats","PhysicsStats","otherStats","fps","fs","_pairs","_collisions","_collidersHash","_fastBodies","_fastBodyCollisions","_narrowphase","ps","colliders","PointerType","NativePointerButton","PointerButton","WheelDeltaMode","PointerScope","KeyEvent","Keyboard_extends","Keyboard","_keys","_keysUp","_keysDown","init","global","code","_normalizeKeyCode","keyCode","keyEvent","getKeys","wasPressed","isHeld","wasReleased","Semicolon","PointerEvent","coordinates","pointer","pointerType","Pointer_extends","isActorUnderPointer","PointerEventFactory","_pointerEventType","PointerDragEvent","PointerUpEvent","isDragEnd","PointerDownEvent","isDragStart","PointerMoveEvent","hasActorsUnderPointer","getActorsUnderPointer","_onActorLeave","isDragging","dragTarget","hasActorUnderPointerInList","_onActorEnter","pe","createPointerEventByName","addActorUnderPointer","removeActorUnderPointer","PointerEnterEvent","PointerLeaveEvent","PointerCancelEvent","WheelEvent","deltaX","deltaY","deltaZ","deltaMode","Buttons","Axes","Pointer_Pointers","Pointers","_pointerDown","_pointerUp","_pointerMove","_pointerCancel","_wheel","_pointers","_activePointers","Pointer_Pointer","primary","_handleTouchEvent","touchAction","_handlePointerEvent","MSPointerEvent","msTouchAction","_handleMouseEvent","_handleWheelEvent","onmousewheel","at","_propagatePointerEvent","_propagateWheelEvent","_revisePointerEventPath","_validateWheelEventPath","wheelEvent","isNotUIActor","_propagateWheelPointerEvent","eventArr","preventDefault","Mouse","_nativeButtonToPointerButton","changedTouches","_getPointerIndex","identifier","Touch","Unknown","pointerId","_stringToPointerType","pageScrollPreventionMode","ScrollPreventionMode","Canvas","transformedPoint","wheelDeltaX","wheelDeltaY","wheelDelta","detail","Pixel","Page","we","idx","NoButton","Pen","Pointer","_isDown","_wasDown","_actorsUnderPointer","lastPagePos","lastScreenPos","lastWorldPos","_onPointerMove","_onPointerDown","_onPointerUp","Gamepad_Gamepads","Gamepads","_gamePadTimeStamps","_oldPads","_pads","_initSuccess","_navigator","_minimumConfiguration","Gamepad_extends","_clonePads","setMinimumGamepadConfiguration","_enableAndUpdate","_isGamepadValid","pad","axesLength","buttonLength","buttons","connected","gamepads","timestamp","navigatorGamepad","bi","ai","getButton","pressed","updateButton","getAxes","updateAxes","_clonePad","Gamepad","getValidGamepads","pads","arr","clonedPad","MinAxisMoveThreshold","_buttons","isButtonPressed","buttonIndex","axesIndex","DisplayMode","EmitterType","Engine_Engine","Engine","_hasStarted","postProcessors","scenes","_animations","isFullscreen","displayMode","FullScreen","_suppressHiDPIScaling","_suppressPlayButton","pauseAudioWhenHidden","debugColor","enableCanvasTransparency","onFatalException","_isSmoothingEnabled","_timescale","_isLoading","_DefaultEngineOptions","detector","suppressMinimumBrowserFeatureDetection","_compatible","innerText","testMessage","canvasElementId","getElementById","parentElement","removeChild","suppressConsoleBootMessage","EX_VERSION","_loader","rootScene","addScene","goToScene","Engine_extends","getWorldBounds","playAnimation","animation","AnimationNode","removeScene","focus_1","focus_2","_setHeightByDisplayMode","Container","overflow","hidden","visibilityChange","parent_1","Position","_intializeDisplayModePosition","keyboard","pointerScope","Document","scrollPreventionMode","alpha","suppressHiDPIScaling","_initializeHiDpi","specifiedPosition","split","marginTop","marginLeft","isHiDpi","oldWidth","oldHeight","isSmooth","imageSmoothingEnabled","smoothing","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled","_overrideInitialize","_update","isDone","_draw","process","loader","loadingComplete","createMainLoop","game","raf","nowFn","lastTime","mainloop","_requestId","elapsed","timescale","frameId","beforeUpdate","afterUpdate","afterDraw","isPaused","screenshot","raw","MediaEvent","MediaEvents_extends","_val","NativeSoundEvent","Particle","emitterOrConfig","life","beginColor","endColor","velocity","acceleration","startSize","endSize","Particles_extends","ParticleImpl","particleRotationalVelocity","currentRotation","focusAccel","fadeFlag","_rRate","_gRate","_bRate","_aRate","_currentColor","emitter","particleSize","particleSprite","sizeRate","elapsedMultiplier","ParticleEmitter","removeParticle","accel","ParticleEmitterImpl","numParticles","isEmitting","particles","deadParticles","minVel","maxVel","minAngle","maxAngle","emitRate","particleLife","minSize","maxSize","emitterType","Rectangle","randomRotation","_particlesToEmit","particle","emitParticles","particleCount","_createParticle","clearParticles","ranX","ranY","Internal","Actions","Action_namespaceObject","CollisionGroupManager_CollisionGroupManager","CollisionGroupManager","_currentGroup","_MAX_GROUPS","_currentBit","from","values","groupByName","Map","_STARTING_BIT","Animation","engineOrConfig","images","loop","Animation_extends","AnimationImpl","currentFrame","_oldTime","freezeFrame","_setAnchor","_setRotation","_setScale","_updateValues","skip","currSprite","play","Polygon_Polygon","filled","_points","fillColor","lineColor","SpriteSheet","imageOrConfigOrSprites","columns","spWidth","spHeight","spacing","SpriteSheet_extends","SpriteSheetImpl","loadFromImage","isWidthError_1","isHeightError_1","RangeError","getAnimationByIndices","indices","getAnimationBetween","beginIndex","endIndex","getAnimationForAll","getAnimationByCoords","spriteCoordinates","maxHeight","coord","anim","SpriteFont","alphabet","SpriteFontImpl","_currentOpacity","_sprites","_textShadowDirty","_textShadowColor","_textShadowSprites","_alphabet","_caseInsensitive","getTextSprites","lookup","char","character","_parseOptions","characterShadow","currX","currY","charSprite","ExResponse","any","blob","json","_lerp","_fade","ColorBlindness","PerlinNoise_PerlinGenerator","PerlinGenerator","_perm","_p","Uint8Array","_defaultPerlinOptions","octaves","frequency","amplitude","persistance","_random","noise","amp","freq","maxValue","_noise1d","_noise2d","_noise3d","sequence","step","grid","_gradient3d","_gradient2d","_gradient1d","intX","intY","fadeX","fadeY","intZ","fadeZ","aa","ba","ab","PerlinNoise_PerlinDrawer2D","PerlinDrawer2D","generator","colorFcn","ColorBlindCorrector_ColorBlindCorrector","ColorBlindCorrector","simulate","colorMode","Protanope","_vertexShader","_fragmentShader","_internalCanvas","_gl","preserveDrawingBuffer","_program","createProgram","fragmentShader","_getShader","_getFragmentShaderByMode","vertextShader","attachShader","linkProgram","getProgramParameter","LINK_STATUS","useProgram","Deuteranope","Tritanope","replace","_setRectangle","bufferData","ARRAY_BUFFER","Float32Array","STATIC_DRAW","program","shader","createShader","FRAGMENT_SHADER","VERTEX_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","out","positionLocation","getAttribLocation","texCoordLocation","texCoordBuffer","bindBuffer","enableVertexAttribArray","vertexAttribPointer","FLOAT","texture","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","pixelStorei","UNPACK_FLIP_Y_WEBGL","texImage2D","RGBA","UNSIGNED_BYTE","resolutionLocation","getUniformLocation","uniform2f","positionBuffer","drawArrays","TRIANGLES","pixelData","readPixels","AudioInstanceFactory","AudioInstance_AudioTagInstance","AudioBuffer","AudioInstance_WebAudioInstance","AudioInstance_AudioInstance","AudioInstance","_src","_volume","_loop","_isPlaying","_isPaused","_wireUpOnEnded","isPlaying","_resumePlayBack","_startPlayBack","_playingPromise","_handleOnEnded","AudioTagInstance","Audio","AudioInstance_extends","volume","WebAudioInstance","_audioContext","_volumeNode","createGain","_currentOffset","_createNewBufferSource","gain","setTargetAtTime","playbackRate","_setPauseOffset","_rememberStartTime","_playbackRate","restartTime","amend","_startTime","getTime","setValueAtTime","canPlayFile","file","canPlayType","Sound_Sound","Sound","paths","_tracks","_wasPlayingOnHidden","_processedData","_detectResponseType","paths_1","Sound_extends","instanceCount","_resumePlayback","_startPlayback","ArrayBuffer","_processArrayBufferData","_processBlobData","processedData","_setProcessedData","getTrackId","resumed","newTrack","_createNewTrack","playPromise","resolved","decodeAudioData","aiPromise","_getTrackInstance","Gif_Gif","Gif","_stream","_gif","_animation","_transparentColor","Gif_extends","Stream","Gif_ParseGif","imageIndex","asSpriteSheet","spriteArray","asAnimation","checkBytes","bitsToNum","byteToBitArr","bite","dataArray","readByte","byteLength","readBytes","bytes","read","fromCharCode","readUnsigned","lzwDecode","minCodeSize","last","readCode","output","clearCode","eoiCode","codeSize","dict","stream","_st","_handler","globalColorTable","parseColorTable","entries","ct","readSubBlocks","parseHeader","hdr","sig","ver","colorRes","globalColorTableSize","gctFlag","sorted","bgColor","pixelAspectRatio","bits","parseExt","block","label","extType","reserved","disposalMethod","userInput","transparencyGiven","delayTime","transparencyIndex","terminator","gce","parseGCExt","comment","com","parseComExt","ptHeader","ptData","pte","parsePTExt","authCode","unknown","iterations","app","NETSCAPE","parseNetscapeExt","appData","parseUnknownAppExt","parseAppExt","parseUnknownExt","parseImg","img","leftPos","topPos","lctFlag","interlaced","lctSize","lct","lzwMinCodeSize","lzwData","pixels","newPixels","cpRow","toRow","fromRow","fromPixels","offsets","steps","pass","deinterlace","arrayToImage","parseBlock","sentinel","eof","frame","context","__webpack_exports__","SpriteEffects_namespaceObject","Events_namespaceObject","Input_Index_namespaceObject","Traits_Index_namespaceObject","Util_Index_namespaceObject","Deprecated"],"mappings":"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,EAAQqkC,eAAiB,EACxCltC,MAAO6I,EAAQ7I,OAASpB,GAAMsb,MAC9B0a,eAAwCj0B,WAAtBkI,EAAQ+rB,UAA0B2T,GAAUx3C,KAAO8X,EAAQ+rB,UAC7EqY,eAAwCtsC,WAAtBkI,EAAQokC,UAA0BzE,GAAU13C,OAAS+X,EAAQokC,UAC/EoC,SAAUxmC,EAAQwmC,WAAa,EAC/Bz+B,QAAS/H,EAAQ+H,SAAW,IAGlCm7C,EA/LA,CAAoCzB,MCzNpC0C,GAAA,oBAAAA,KASA,OARgBA,EAAAxpD,KAA8B,CAC1CypD,IAAK,GACLC,KAAM,OACNC,KAAM,OACN/f,KAAM,OACNl9B,SAAU,WACV0vB,YAAa,eAEjBotB,EATA,GCLA,SAASI,GAAM32D,EAAcqI,EAAW1H,GACtC,OAAO0H,EAAIrI,GAAQW,EAAI0H,GAGzB,SAASuuD,GAAMjqE,GACb,OAAOA,EAAIA,EAAIA,GAAKA,GAAS,EAAJA,EAAQ,IAAM,IAqCzC,IC1CYkqE,GD0CZC,GAAA,WAqSE,SAAAC,EAAY3kD,GApSJtkB,KAAAkpE,MAAkB,CACxB,IACA,IACA,IACA,GACA,GACA,GACA,IACA,GACA,IACA,GACA,GACA,GACA,IACA,IACA,EACA,IACA,IACA,GACA,IACA,GACA,GACA,IACA,EACA,GACA,GACA,IACA,GACA,GACA,GACA,IACA,EACA,IACA,IACA,IACA,IACA,GACA,EACA,GACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,GACA,GACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,IACA,GACA,IACA,GACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,EACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,EACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,EACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,GACA,IACA,GACA,GACA,GACA,GACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,EACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,EACA,IACA,GACA,GACA,IACA,GACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,EACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,KAEMlpE,KAAAmpE,GAAiB,IAAIC,WAAW,KAGhCppE,KAAAqpE,sBAAuC,CAC7CC,QAAS,EACTC,UAAW,EACXC,UAAW,EACXC,YAAa,IA4BbnlD,EAAUpb,EAAY,GAAIlJ,KAAKqpE,sBAAuB/kD,GAEtDtkB,KAAKypE,YAAcnlD,EAAQmlD,YAC3BzpE,KAAKwpE,UAAYllD,EAAQklD,UACzBxpE,KAAKupE,UAAYjlD,EAAQilD,UACzBvpE,KAAKspE,QAAUhlD,EAAQglD,QAEnBhlD,EAAQ1e,KACV5F,KAAK0pE,QAAU,IAAI/jE,EAAO2e,EAAQ1e,MAElC5F,KAAK0pE,QAAU,IAAI/jE,EAGrB3F,KAAKkpE,MAAQlpE,KAAK0pE,QAAQphE,QAAQtI,KAAKkpE,OAEvC,IAAK,IAAIvrE,EAAI,EAAGA,EAAI,IAAKA,IACvBqC,KAAKmpE,GAAGxrE,GAA2B,IAAtBqC,KAAKkpE,MAAMvr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","file":"excalibur.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ex\"] = factory();\n\telse\n\t\troot[\"ex\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n","module.exports = \"data:image/png;base64,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\"","\n        var result = require(\"!!../../node_modules/css-loader/index.js!./Loader.css\");\n\n        if (typeof result === \"string\") {\n            module.exports = result;\n        } else {\n            module.exports = result.toString();\n        }\n    ","exports = module.exports = require(\"../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"/* Buttons styles start */\\n\\nbutton#excalibur-play {\\n  display: inline-block;\\n  position: relative;\\n  z-index: 999;\\n  border-radius: 6px;\\n  border: none;\\n  /*border: 3px solid;\\n    border-color: white;\\n    box-shadow: 0 0 10px #ccc;*/\\n  padding: 1rem 1.5rem 1rem 4rem;\\n  margin: 0;\\n  text-decoration: none;\\n  background: #00b233;\\n  color: #ffffff;\\n  font-family: sans-serif;\\n  font-size: 2rem;\\n  line-height: 1;\\n  cursor: pointer;\\n  text-align: center;\\n  transition: background 250ms ease-in-out, transform 150ms ease;\\n  -webkit-appearance: none;\\n  -moz-appearance: none;\\n\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\n  animation: excalibur-button-fadein 200ms;\\n}\\n\\n/*\\nbutton#excalibur-play {\\n  display: none;\\n}*/\\n\\nbutton#excalibur-play:after {\\n  position: absolute;\\n  content: '';\\n  border: 8px solid;\\n  border-color: transparent transparent transparent white;\\n  left: 35px;\\n  top: 24px;\\n  width: 0;\\n  height: 0;\\n}\\n\\nbutton#excalibur-play:before {\\n  position: absolute;\\n  content: '';\\n  border: 3px solid;\\n  left: 19px;\\n  top: 14px;\\n  border-radius: 20px;\\n  width: 30px;\\n  height: 30px;\\n}\\n\\nbutton#excalibur-play:hover,\\nbutton#excalibur-play:focus {\\n  background: #00982c;\\n}\\n\\nbutton#excalibur-play:focus {\\n  outline: 1px solid #fff;\\n  outline-offset: -4px;\\n}\\n\\nbutton#excalibur-play:active {\\n  transform: scale(0.99);\\n}\\n\\n@keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Firefox < 16 */\\n@-moz-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Safari, Chrome and Opera > 12.1 */\\n@-webkit-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Internet Explorer */\\n@-ms-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Opera < 12.1 */\\n@-o-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\", \"\"]);\n\n// exports\n","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\nmodule.exports = function(useSourceMap) {\n\tvar list = [];\n\n\t// return the list of modules as css string\n\tlist.toString = function toString() {\n\t\treturn this.map(function (item) {\n\t\t\tvar content = cssWithMappingToString(item, useSourceMap);\n\t\t\tif(item[2]) {\n\t\t\t\treturn \"@media \" + item[2] + \"{\" + content + \"}\";\n\t\t\t} else {\n\t\t\t\treturn content;\n\t\t\t}\n\t\t}).join(\"\");\n\t};\n\n\t// import a list of modules into the list\n\tlist.i = function(modules, mediaQuery) {\n\t\tif(typeof modules === \"string\")\n\t\t\tmodules = [[null, modules, \"\"]];\n\t\tvar alreadyImportedModules = {};\n\t\tfor(var i = 0; i < this.length; i++) {\n\t\t\tvar id = this[i][0];\n\t\t\tif(typeof id === \"number\")\n\t\t\t\talreadyImportedModules[id] = true;\n\t\t}\n\t\tfor(i = 0; i < modules.length; i++) {\n\t\t\tvar item = modules[i];\n\t\t\t// skip already imported module\n\t\t\t// this implementation is not 100% perfect for weird media query combinations\n\t\t\t//  when a module is imported multiple times with different media queries.\n\t\t\t//  I hope this will never occur (Hey this way we have smaller bundles)\n\t\t\tif(typeof item[0] !== \"number\" || !alreadyImportedModules[item[0]]) {\n\t\t\t\tif(mediaQuery && !item[2]) {\n\t\t\t\t\titem[2] = mediaQuery;\n\t\t\t\t} else if(mediaQuery) {\n\t\t\t\t\titem[2] = \"(\" + item[2] + \") and (\" + mediaQuery + \")\";\n\t\t\t\t}\n\t\t\t\tlist.push(item);\n\t\t\t}\n\t\t}\n\t};\n\treturn list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n\tvar content = item[1] || '';\n\tvar cssMapping = item[3];\n\tif (!cssMapping) {\n\t\treturn content;\n\t}\n\n\tif (useSourceMap && typeof btoa === 'function') {\n\t\tvar sourceMapping = toComment(cssMapping);\n\t\tvar sourceURLs = cssMapping.sources.map(function (source) {\n\t\t\treturn '/*# sourceURL=' + cssMapping.sourceRoot + source + ' */'\n\t\t});\n\n\t\treturn [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n\t}\n\n\treturn [content].join('\\n');\n}\n\n// Adapted from convert-source-map (MIT)\nfunction toComment(sourceMap) {\n\t// eslint-disable-next-line no-undef\n\tvar base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n\tvar data = 'sourceMappingURL=data:application/json;charset=utf-8;base64,' + base64;\n\n\treturn '/*# ' + data + ' */';\n}\n","// Promises/A+ Spec http://promises-aplus.github.io/promises-spec/\n\n/**\n * Valid states for a promise to be in\n */\nexport enum PromiseState {\n  Resolved,\n  Rejected,\n  Pending\n}\n\nexport interface PromiseLike<T> {\n  then(successCallback?: (value?: T) => any, rejectCallback?: (value?: T) => any): PromiseLike<T>;\n  error(rejectCallback?: (value?: any) => any): PromiseLike<T>;\n\n  //Cannot define static methods on interfaces\n  //wrap<T>(value?: T): IPromise<T>;\n\n  resolve(value?: T): PromiseLike<T>;\n  reject(value?: any): PromiseLike<T>;\n\n  state(): PromiseState;\n}\n\n/**\n * Promises are used to do asynchronous work and they are useful for\n * creating a chain of actions. In Excalibur they are used for loading,\n * sounds, animation, actions, and more.\n *\n * [[include:Promises.md]]\n */\nexport class Promise<T> implements PromiseLike<T> {\n  private _state: PromiseState = PromiseState.Pending;\n  private _value: T;\n  private _successCallbacks: { (value?: T): any }[] = [];\n  private _rejectCallback: (value?: any) => any = () => {\n    return;\n  };\n  private _errorCallback: (value?: any) => any;\n\n  /**\n   * Create and resolve a Promise with an optional value\n   * @param value  An optional value to wrap in a resolved promise\n   */\n  public static resolve<T>(value?: T): Promise<T> {\n    const promise = new Promise<T>().resolve(value);\n\n    return promise;\n  }\n\n  /**\n   * Create and reject a Promise with an optional value\n   * @param value  An optional value to wrap in a rejected promise\n   */\n  public static reject<T>(value?: T): Promise<T> {\n    const promise = new Promise<T>().reject(value);\n\n    return promise;\n  }\n\n  /**\n   * Returns a new promise that resolves when all the promises passed to it resolve, or rejects\n   * when at least 1 promise rejects.\n   */\n  public static join<T>(promises: Promise<T>[]): Promise<T>;\n\n  /**\n   * Returns a new promise that resolves when all the promises passed to it resolve, or rejects\n   * when at least 1 promise rejects.\n   */\n  public static join<T>(...promises: Promise<T>[]): Promise<T>;\n\n  public static join<T>() {\n    let promises: Promise<T>[] = [];\n\n    if (arguments.length > 0 && !Array.isArray(arguments[0])) {\n      for (let _i = 0; _i < arguments.length; _i++) {\n        promises[_i - 0] = arguments[_i];\n      }\n    } else if (arguments.length === 1 && Array.isArray(arguments[0])) {\n      promises = arguments[0];\n    }\n\n    const joinedPromise = new Promise<T>();\n    if (!promises || !promises.length) {\n      return joinedPromise.resolve();\n    }\n\n    const total = promises.length;\n    let successes = 0;\n    let rejects = 0;\n    const errors: any = [];\n\n    promises.forEach((p) => {\n      p.then(\n        () => {\n          successes += 1;\n          if (successes === total) {\n            joinedPromise.resolve();\n          } else if (successes + rejects + errors.length === total) {\n            joinedPromise.reject(errors);\n          }\n        },\n        () => {\n          rejects += 1;\n          if (successes + rejects + errors.length === total) {\n            joinedPromise.reject(errors);\n          }\n        }\n      ).error((e) => {\n        errors.push(e);\n        if (errors.length + successes + rejects === total) {\n          joinedPromise.reject(errors);\n        }\n      });\n    });\n\n    return joinedPromise;\n  }\n\n  /**\n   * Chain success and reject callbacks after the promise is resolved\n   * @param successCallback  Call on resolution of promise\n   * @param rejectCallback   Call on rejection of promise\n   */\n  public then(successCallback?: (value?: T) => any, rejectCallback?: (value?: any) => any) {\n    if (successCallback) {\n      this._successCallbacks.push(successCallback);\n\n      // If the promise is already resovled call immediately\n      if (this.state() === PromiseState.Resolved) {\n        try {\n          successCallback.call(this, this._value);\n        } catch (e) {\n          this._handleError(e);\n        }\n      }\n    }\n    if (rejectCallback) {\n      this._rejectCallback = rejectCallback;\n\n      // If the promise is already rejected call immediately\n      if (this.state() === PromiseState.Rejected) {\n        try {\n          rejectCallback.call(this, this._value);\n        } catch (e) {\n          this._handleError(e);\n        }\n      }\n    }\n\n    return this;\n  }\n\n  /**\n   * Add an error callback to the promise\n   * @param errorCallback  Call if there was an error in a callback\n   */\n  public error(errorCallback?: (value?: any) => any) {\n    if (errorCallback) {\n      this._errorCallback = errorCallback;\n    }\n    return this;\n  }\n\n  /**\n   * Resolve the promise and pass an option value to the success callbacks\n   * @param value  Value to pass to the success callbacks\n   */\n  public resolve(value?: T): Promise<T> {\n    if (this._state === PromiseState.Pending) {\n      this._value = value;\n      try {\n        this._state = PromiseState.Resolved;\n        this._successCallbacks.forEach((cb) => {\n          cb.call(this, this._value);\n        });\n      } catch (e) {\n        this._handleError(e);\n      }\n    } else {\n      throw new Error('Cannot resolve a promise that is not in a pending state!');\n    }\n    return this;\n  }\n\n  /**\n   * Reject the promise and pass an option value to the reject callbacks\n   * @param value  Value to pass to the reject callbacks\n   */\n  public reject(value?: any) {\n    if (this._state === PromiseState.Pending) {\n      this._value = value;\n      try {\n        this._state = PromiseState.Rejected;\n        this._rejectCallback.call(this, this._value);\n      } catch (e) {\n        this._handleError(e);\n      }\n    } else {\n      throw new Error('Cannot reject a promise that is not in a pending state!');\n    }\n    return this;\n  }\n\n  /**\n   * Inspect the current state of a promise\n   */\n  public state(): PromiseState {\n    return this._state;\n  }\n\n  private _handleError(e: any) {\n    if (this._errorCallback) {\n      this._errorCallback.call(this, e);\n    } else {\n      // rethrow error\n      throw e;\n    }\n  }\n}\n","export function polyfill() {\n  /* istanbul ignore next */\n  if (typeof window === 'undefined') {\n    window = <any>{\n      audioContext: function() {\n        return;\n      }\n    };\n  }\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !window.requestAnimationFrame) {\n    (<any>window).requestAnimationFrame =\n      (<any>window).webkitRequestAnimationFrame ||\n      (<any>window).mozRequestAnimationFrame ||\n      function(callback: Function) {\n        window.setInterval(callback, 1000 / 60);\n      };\n  }\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !window.cancelAnimationFrame) {\n    (<any>window).cancelAnimationFrame =\n      (<any>window).webkitCancelAnimationFrame ||\n      (<any>window).mozCancelAnimationFrame ||\n      function() {\n        return;\n      };\n  }\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !(<any>window).AudioContext) {\n    (<any>window).AudioContext =\n      (<any>window).AudioContext ||\n      (<any>window).webkitAudioContext ||\n      (<any>window).mozAudioContext ||\n      (<any>window).msAudioContext ||\n      (<any>window).oAudioContext;\n  }\n\n  if (typeof window !== 'undefined' && !(<any>window).devicePixelRatio) {\n    (<any>window).devicePixelRatio = window.devicePixelRatio || 1;\n  }\n\n  // Polyfill from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach\n  // Production steps of ECMA-262, Edition 5, 15.4.4.18\n  // Reference: http://es5.github.io/#x15.4.4.18\n  /* istanbul ignore next */\n  if (!Array.prototype.forEach) {\n    Array.prototype.forEach = function(this: Array<any>, callback, thisArg) {\n      let T, k;\n\n      if (this == null) {\n        throw new TypeError('this is null or not defined');\n      }\n\n      // 1. Let O be the result of calling ToObject passing the |this| value as the argument.\n      const O = Object(this);\n\n      // 2. Let lenValue be the result of calling the Get internal method of O with the argument \"length\".\n      // 3. Let len be ToUint32(lenValue).\n      const len = O.length >>> 0;\n\n      // 4. If IsCallable(callback) is false, throw a TypeError exception.\n      // See: http://es5.github.com/#x9.11\n      if (typeof callback !== 'function') {\n        throw new TypeError(callback + ' is not a function');\n      }\n\n      // 5. If thisArg was supplied, let T be thisArg; else let T be undefined.\n      if (arguments.length > 1) {\n        T = thisArg;\n      }\n\n      // 6. Let k be 0\n      k = 0;\n\n      // 7. Repeat, while k < len\n      while (k < len) {\n        let kValue;\n\n        // a. Let Pk be ToString(k).\n        //   This is implicit for LHS operands of the in operator\n        // b. Let kPresent be the result of calling the HasProperty internal method of O with argument Pk.\n        //   This step can be combined with c\n        // c. If kPresent is true, then\n        if (k in O) {\n          // i. Let kValue be the result of calling the Get internal method of O with argument Pk.\n          kValue = O[k];\n\n          // ii. Call the Call internal method of callback with T as the this value and\n          // argument list containing kValue, k, and O.\n          callback.call(T, kValue, k, O);\n        }\n        // d. Increase k by 1.\n        k++;\n      }\n      // 8. return undefined\n    };\n  }\n\n  // Polyfill from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/some\n  /* istanbul ignore next */\n  if (!Array.prototype.some) {\n    Array.prototype.some = function(this: Array<any>, fun /*, thisArg */) {\n      'use strict';\n\n      if (this === void 0 || this === null) {\n        throw new TypeError();\n      }\n\n      const t = Object(this);\n      const len = t.length >>> 0;\n      if (typeof fun !== 'function') {\n        throw new TypeError();\n      }\n\n      const thisArg = arguments.length >= 2 ? arguments[1] : void 0;\n      for (let i = 0; i < len; i++) {\n        if (i in t && fun.call(thisArg, t[i], i, t)) {\n          return true;\n        }\n      }\n\n      return false;\n    };\n  }\n\n  // Polyfill from  https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind#Polyfill\n  /* istanbul ignore next */\n  if (!Function.prototype.bind) {\n    Function.prototype.bind = function(oThis) {\n      if (typeof this !== 'function') {\n        // closest thing possible to the ECMAScript 5\n        // internal IsCallable function\n        throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable');\n      }\n\n      const aArgs = Array.prototype.slice.call(arguments, 1),\n        fToBind = this,\n        fNOP: any = function() {\n          return;\n        },\n        fBound = function(this: Function) {\n          return fToBind.apply(this instanceof fNOP && oThis ? this : oThis, aArgs.concat(Array.prototype.slice.call(arguments)));\n        };\n\n      fNOP.prototype = this.prototype;\n      fBound.prototype = new fNOP();\n\n      return fBound;\n    };\n  }\n}\n","/**\n * An enum that describes the sides of an Actor for collision\n */\nexport enum Side {\n  None = 'None',\n  Top = 'Top',\n  Bottom = 'Bottom',\n  Left = 'Left',\n  Right = 'Right'\n}\n","/**\n * Pseudo-Random Utility\n *\n * A pseudo-random utility to add seeded random support for help in\n * generating things like terrain or reproducible randomness. Uses the\n * [Mersenne Twister](https://en.wikipedia.org/wiki/Mersenne_Twister) algorithm.\n *\n * [[include:Random.md]]\n */\n\n/**\n * 32-bit mask\n */\nconst BITMASK32: number = 0xffffffff;\n\n/**\n * Pseudo-random number generator following the Mersenne_Twister algorithm. Given a seed this generator will produce the same sequence\n * of numbers each time it is called.\n * See https://en.wikipedia.org/wiki/Mersenne_Twister for more details.\n * Uses the MT19937-32 (2002) implementation documented here http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/MT2002/emt19937ar.html\n *\n * Api inspired by http://chancejs.com/# https://github.com/chancejs/chancejs\n */\nexport class Random {\n  // Separation point of one one word, the number of bits in the lower bitmask 0 <= r <= w-1\n  private _lowerMask: number = 0x7fffffff; // 31 bits same as _r\n  private _upperMask: number = 0x80000000; // 34 high bits\n\n  // Word size, 64 bits\n  private _w: number = 32;\n\n  // Degree of recurrance\n  private _n: number = 624;\n\n  // Middle word, an offset used in the recurrance defining the series x, 1<=m<n\n  private _m: number = 397;\n  // coefficients of teh rational normal form twist matrix\n  private _a: number = 0x9908b0df;\n\n  // tempering bit shifts and masks\n  private _u: number = 11;\n  private _s: number = 7;\n  private _b: number = 0x9d2c5680;\n  private _t: number = 15;\n  private _c: number = 0xefc60000;\n  private _l: number = 18;\n  private _f: number = 1812433253;\n\n  private _mt: number[];\n\n  private _index: number;\n\n  /**\n   * If no seed is specified, the Date.now() is used\n   */\n  constructor(public seed?: number) {\n    this._mt = new Array<number>(this._n);\n    // need to mask to support higher bit machines\n    this._mt[0] = (seed || Date.now()) >>> 0;\n\n    for (let i = 1; i < this._n; i++) {\n      const s = this._mt[i - 1] ^ (this._mt[i - 1] >>> (this._w - 2));\n      // numbers are bigger than the JS max safe int, add in 16-bit chunks to prevent IEEE rounding errors on high bits\n      this._mt[i] = (((this._f * ((s & 0xffff0000) >>> 16)) << 16) + this._f * (s & 0xffff) + i) >>> 0;\n    }\n    this._index = this._n;\n  }\n\n  /**\n   * Apply the twist\n   */\n  private _twist(): void {\n    const mag01 = [0x0, this._a];\n    let y = 0,\n      i = 0;\n    for (; i < this._n - this._m; i++) {\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\n      this._mt[i] = this._mt[i + this._m] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n    }\n    for (; i < this._n - 1; i++) {\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\n      this._mt[i] = this._mt[i + (this._m - this._n)] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n    }\n    y = (this._mt[this._n - 1] & this._upperMask) | (this._mt[0] & this._lowerMask);\n    this._mt[this._n - 1] = this._mt[this._m - 1] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n\n    this._index = 0;\n  }\n\n  /**\n   * Return next 32 bit integer number in sequence\n   */\n  public nextInt(): number {\n    if (this._index >= this._n) {\n      this._twist();\n    }\n\n    let y = this._mt[this._index++];\n\n    y ^= y >>> this._u;\n    y ^= (y << this._s) & this._b;\n    y ^= (y << this._t) & this._c;\n    y ^= y >>> this._l;\n\n    return y >>> 0;\n  }\n\n  /**\n   * Return a random floating point number between [0, 1)\n   */\n  public next(): number {\n    return this.nextInt() * (1.0 / 4294967296.0); // divided by 2^32\n  }\n\n  /**\n   * Return a random floating point in range [min, max) min is included, max is not included\n   */\n  public floating(min: number, max: number): number {\n    return (max - min) * this.next() + min;\n  }\n\n  /**\n   * Return a random integer in range [min, max] min is included, max is included.\n   * Implemented with rejection sampling, see https://medium.com/@betable/tifu-by-using-math-random-f1c308c4fd9d#.i13tdiu5a\n   */\n  public integer(min: number, max: number): number {\n    return Math.floor((max - min + 1) * this.next() + min);\n  }\n\n  /**\n   * Returns true or false randomly with 50/50 odds by default.\n   * By default the likelihood of returning a true is .5 (50%).\n   * @param likelihood takes values between [0, 1]\n   */\n  public bool(likelihood: number = 0.5): boolean {\n    return this.next() <= likelihood;\n  }\n\n  /**\n   * Returns one element from an array at random\n   */\n  public pickOne<T>(array: Array<T>): T {\n    return array[this.integer(0, array.length - 1)];\n  }\n\n  /**\n   * Returns a new array random picking elements from the original\n   * @param array Original array to pick from\n   * @param numPicks can be any positive number\n   * @param allowDuplicates indicates whether the returned set is allowed duplicates (it does not mean there will always be duplicates\n   * just that it is possible)\n   */\n  public pickSet<T>(array: Array<T>, numPicks: number, allowDuplicates: boolean = false): Array<T> {\n    if (allowDuplicates) {\n      return this._pickSetWithDuplicates(array, numPicks);\n    } else {\n      return this._pickSetWithoutDuplicates(array, numPicks);\n    }\n  }\n\n  /**\n   * Returns a new array randomly picking elements in the original (not reused)\n   * @param numPicks must be less than or equal to the number of elements in the array.\n   */\n  private _pickSetWithoutDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\n    if (numPicks > array.length || numPicks < 0) {\n      throw new Error('Invalid number of elements to pick, must pick a value 0 < n <= length');\n    }\n    if (numPicks === array.length) {\n      return array;\n    }\n\n    const result: Array<T> = new Array<T>(numPicks);\n    let currentPick = 0;\n    const tempArray = array.slice(0);\n    while (currentPick < numPicks) {\n      const index = this.integer(0, tempArray.length - 1);\n      result[currentPick++] = tempArray[index];\n      tempArray.splice(index, 1);\n    }\n\n    return result;\n  }\n\n  /**\n   * Returns a new array random picking elements from the original allowing duplicates\n   * @param numPicks can be any positive number\n   */\n  private _pickSetWithDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\n    // Typescript numbers are all floating point, so do we add check for int? (or floor the input?)\n    if (numPicks < 0) {\n      throw new Error('Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT');\n    }\n    const result = new Array<T>(numPicks);\n    for (let i = 0; i < numPicks; i++) {\n      result[i] = this.pickOne(array);\n    }\n    return result;\n  }\n\n  /**\n   * Returns a new array that has its elements shuffled. Using the Fisher/Yates method\n   * https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\n   */\n  public shuffle<T>(array: Array<T>): Array<T> {\n    const tempArray = array.slice(0);\n    let swap: T = null;\n    for (let i = 0; i < tempArray.length - 2; i++) {\n      const randomIndex = this.integer(i, tempArray.length - 1);\n      swap = tempArray[i];\n      tempArray[i] = tempArray[randomIndex];\n      tempArray[randomIndex] = swap;\n    }\n\n    return tempArray;\n  }\n\n  /**\n   * Generate a list of random integer numbers\n   * @param length the length of the final array\n   * @param min the minimum integer number to generate inclusive\n   * @param max the maximum integer number to generate inclusive\n   */\n  public range(length: number, min: number, max: number): Array<number> {\n    const result: Array<number> = new Array(length);\n    for (let i = 0; i < length; i++) {\n      result[i] = this.integer(min, max);\n    }\n    return result;\n  }\n\n  /**\n   * Returns the result of a d4 dice roll\n   */\n  public d4() {\n    return this.integer(1, 4);\n  }\n\n  /**\n   * Returns the result of a d6 dice roll\n   */\n  public d6() {\n    return this.integer(1, 6);\n  }\n\n  /**\n   * Returns the result of a d8 dice roll\n   */\n  public d8() {\n    return this.integer(1, 8);\n  }\n\n  /**\n   * Returns the result of a d10 dice roll\n   */\n  public d10() {\n    return this.integer(1, 10);\n  }\n\n  /**\n   * Returns the result of a d12 dice roll\n   */\n  public d12() {\n    return this.integer(1, 12);\n  }\n\n  /**\n   * Returns the result of a d20 dice roll\n   */\n  public d20() {\n    return this.integer(1, 20);\n  }\n}\n","import { Vector } from '../Algebra';\nimport { Random } from '../Math/Random';\nimport { Side } from '../Collision/Side';\n\n/**\n * Two PI constant\n */\nexport const TwoPI: number = Math.PI * 2;\n\n/**\n * Merges one or more objects into a single target object\n *\n * @param deep Whether or not to do a deep clone\n * @param target The target object to attach properties on\n * @param objects The objects whose properties to merge\n * @returns Merged object with properties from other objects\n */\nexport function extend(deep: boolean, target: any, ...objects: any[]): any;\n\n/**\n * Merges one or more objects into a single target object\n *\n * @param target The target object to attach properties on\n * @param object2 The second object whose properties to merge\n * @returns Merged object with properties from other objects\n */\nexport function extend<T1, T2>(target: T1, object2: T2): T1 & T2;\n\n/**\n * Merges one or more objects into a single target object\n *\n * @param target The target object to attach properties on\n * @param object2 The second object whose properties to merge\n * @param object3 The third object whose properties to merge\n * @returns Merged object with properties from other objects\n */\nexport function extend<T1, T2, T3>(target: T1, object2: T2, object3: T3): T1 & T2 & T3;\n\n/**\n * Merges one or more objects into a single target object\n *\n * @param target The target object to attach properties on\n * @param objects The objects whose properties to merge\n * @returns Merged object with properties from other objects\n */\nexport function extend(target: any, ...objects: any[]): any;\n\n/**\n * Merges one or more objects into a single target object\n *\n * @returns Merged object with properties from other objects\n * @credit https://gomakethings.com/vanilla-javascript-version-of-jquery-extend/\n */\nexport function extend() {\n  const extended: { [key: string]: any } = {};\n  let deep = false;\n  let i = 0;\n  const length = arguments.length;\n\n  // Check if a deep merge\n  if (Object.prototype.toString.call(arguments[0]) === '[object Boolean]') {\n    deep = arguments[0];\n    i++;\n  }\n\n  // Merge the object into the extended object\n  const assignExists = typeof (<any>Object).assign === 'function';\n  let merge = null;\n  if (!assignExists) {\n    merge = function(obj: any) {\n      for (const prop in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, prop)) {\n          // If deep merge and property is an object, merge properties\n          if (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') {\n            extended[prop] = extend(true, extended[prop], obj[prop]);\n          } else {\n            extended[prop] = obj[prop];\n          }\n        }\n      }\n    };\n  } else {\n    merge = (<any>Object).assign;\n  }\n\n  // Loop through each object and conduct a merge\n  for (; i < length; i++) {\n    const obj = arguments[i];\n    if (!assignExists) {\n      merge(obj);\n    } else {\n      merge(extended, obj);\n    }\n  }\n\n  return extended;\n}\n\nexport function base64Encode(inputStr: string) {\n  const b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n  let outputStr = '';\n  let i = 0;\n\n  while (i < inputStr.length) {\n    //all three \"& 0xff\" added below are there to fix a known bug\n    //with bytes returned by xhr.responseText\n    const byte1 = inputStr.charCodeAt(i++) & 0xff;\n    const byte2 = inputStr.charCodeAt(i++) & 0xff;\n    const byte3 = inputStr.charCodeAt(i++) & 0xff;\n\n    const enc1 = byte1 >> 2;\n    const enc2 = ((byte1 & 3) << 4) | (byte2 >> 4);\n\n    let enc3, enc4;\n    if (isNaN(byte2)) {\n      enc3 = enc4 = 64;\n    } else {\n      enc3 = ((byte2 & 15) << 2) | (byte3 >> 6);\n      if (isNaN(byte3)) {\n        enc4 = 64;\n      } else {\n        enc4 = byte3 & 63;\n      }\n    }\n\n    outputStr += b64.charAt(enc1) + b64.charAt(enc2) + b64.charAt(enc3) + b64.charAt(enc4);\n  }\n\n  return outputStr;\n}\n\n/**\n * Clamps a value between a min and max inclusive\n */\nexport function clamp(val: number, min: number, max: number) {\n  return Math.min(Math.max(min, val), max);\n}\n\nexport function randomInRange(min: number, max: number, random: Random = new Random()): number {\n  return random ? random.floating(min, max) : min + Math.random() * (max - min);\n}\n\nexport function randomIntInRange(min: number, max: number, random: Random = new Random()): number {\n  return random ? random.integer(min, max) : Math.round(randomInRange(min, max));\n}\n\nexport function canonicalizeAngle(angle: number): number {\n  let tmpAngle = angle;\n  if (angle > TwoPI) {\n    while (tmpAngle > TwoPI) {\n      tmpAngle -= TwoPI;\n    }\n  }\n\n  if (angle < 0) {\n    while (tmpAngle < 0) {\n      tmpAngle += TwoPI;\n    }\n  }\n  return tmpAngle;\n}\n\nexport function toDegrees(radians: number): number {\n  return (180 / Math.PI) * radians;\n}\n\nexport function toRadians(degrees: number): number {\n  return (degrees / 180) * Math.PI;\n}\n\nexport function getPosition(el: HTMLElement): Vector {\n  let oLeft: number = 0,\n    oTop: number = 0;\n\n  const calcOffsetLeft = (parent: HTMLElement) => {\n    oLeft += parent.offsetLeft;\n\n    if (parent.offsetParent) {\n      calcOffsetLeft(<HTMLElement>parent.offsetParent);\n    }\n  };\n  const calcOffsetTop = (parent: HTMLElement) => {\n    oTop += parent.offsetTop;\n    if (parent.offsetParent) {\n      calcOffsetTop(<HTMLElement>parent.offsetParent);\n    }\n  };\n\n  calcOffsetLeft(el);\n  calcOffsetTop(el);\n\n  return new Vector(oLeft, oTop);\n}\n\nexport function addItemToArray<T>(item: T, array: T[]): boolean {\n  if (array.indexOf(item) === -1) {\n    array.push(item);\n    return true;\n  }\n  return false;\n}\n\nexport function removeItemFromArray<T>(item: T, array: T[]): boolean {\n  let index = -1;\n  if ((index = array.indexOf(item)) > -1) {\n    array.splice(index, 1);\n    return true;\n  }\n\n  return false;\n}\n\nexport function contains(array: Array<any>, obj: any): boolean {\n  for (let i = 0; i < array.length; i++) {\n    if (array[i] === obj) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function getOppositeSide(side: Side) {\n  if (side === Side.Top) {\n    return Side.Bottom;\n  }\n  if (side === Side.Bottom) {\n    return Side.Top;\n  }\n  if (side === Side.Left) {\n    return Side.Right;\n  }\n  if (side === Side.Right) {\n    return Side.Left;\n  }\n\n  return Side.None;\n}\n\n/**\n * @obsolete use Util.getSideFromDirection\n */\nexport function getSideFromVector(direction: Vector) {\n  return getSideFromDirection(direction);\n}\n\n/**\n * Returns the side in the direction of the vector supplied\n * @param direction Vector to check\n */\nexport function getSideFromDirection(direction: Vector) {\n  const directions = [Vector.Left, Vector.Right, Vector.Up, Vector.Down];\n  const directionEnum = [Side.Left, Side.Right, Side.Top, Side.Bottom];\n\n  let max = -Number.MAX_VALUE;\n  let maxIndex = -1;\n  for (let i = 0; i < directions.length; i++) {\n    if (directions[i].dot(direction) > max) {\n      max = directions[i].dot(direction);\n      maxIndex = i;\n    }\n  }\n  return directionEnum[maxIndex];\n}\n\n/**\n * Excalibur's dynamically resizing collection\n */\nexport class Collection<T> {\n  /**\n   * Default collection size\n   */\n  public static DefaultSize = 200;\n  private _internalArray: T[] = null;\n  private _endPointer: number = 0;\n\n  /**\n   * @param initialSize  Initial size of the internal backing array\n   */\n  constructor(initialSize: number = Collection.DefaultSize) {\n    this._internalArray = new Array<T>(initialSize);\n  }\n\n  private _resize() {\n    const newSize = this._internalArray.length * 2;\n    const newArray = new Array<T>(newSize);\n    const count = this.count();\n    for (let i = 0; i < count; i++) {\n      newArray[i] = this._internalArray[i];\n    }\n\n    delete this._internalArray;\n    this._internalArray = newArray;\n  }\n\n  /**\n   * Push elements to the end of the collection\n   */\n  public push(element: T): T {\n    if (this._endPointer === this._internalArray.length) {\n      this._resize();\n    }\n    return (this._internalArray[this._endPointer++] = element);\n  }\n\n  /**\n   * Removes elements from the end of the collection\n   */\n  public pop(): T {\n    this._endPointer = this._endPointer - 1 < 0 ? 0 : this._endPointer - 1;\n    return this._internalArray[this._endPointer];\n  }\n\n  /**\n   * Returns the count of the collection\n   */\n  public count(): number {\n    return this._endPointer;\n  }\n\n  /**\n   * Empties the collection\n   */\n  public clear() {\n    this._endPointer = 0;\n  }\n\n  /**\n   * Returns the size of the internal backing array\n   */\n  public internalSize(): number {\n    return this._internalArray.length;\n  }\n\n  /**\n   * Returns an element at a specific index\n   * @param index  Index of element to retrieve\n   */\n  public elementAt(index: number): T {\n    if (index >= this.count()) {\n      //Logger.getInstance().error('Invalid parameter: ' + index);\n      throw new Error('Invalid index ' + index);\n    }\n    return this._internalArray[index];\n  }\n\n  /**\n   * Inserts an element at a specific index\n   * @param index  Index to insert the element\n   * @param value  Element to insert\n   */\n  public insert(index: number, value: T): T {\n    if (index >= this.count()) {\n      this._resize();\n    }\n    return (this._internalArray[index] = value);\n  }\n\n  /**\n   * Removes an element at a specific index\n   * @param index  Index of element to remove\n   */\n  public remove(index: number): T {\n    const count = this.count();\n    if (count === 0) {\n      //Logger.getInstance().error('Invalid parameter: ' + index);\n      throw new Error('Invalid parameter ' + index);\n    }\n    // O(n) Shift\n    const removed = this._internalArray[index];\n    for (let i = index; i < count; i++) {\n      this._internalArray[i] = this._internalArray[i + 1];\n    }\n    this._endPointer--;\n    return removed;\n  }\n\n  /**\n   * Removes an element by reference\n   * @param element  Element to retrieve\n   */\n  public removeElement(element: T) {\n    const index = this._internalArray.indexOf(element);\n    this.remove(index);\n  }\n\n  /**\n   * Returns a array representing the collection\n   */\n  public toArray(): T[] {\n    return this._internalArray.slice(0, this._endPointer);\n  }\n\n  /**\n   * Iterate over every element in the collection\n   * @param func  Callback to call for each element passing a reference to the element and its index, returned values are ignored\n   */\n  public forEach(func: (element: T, index: number) => any) {\n    let i = 0;\n    const count = this.count();\n    for (i; i < count; i++) {\n      func.call(this, this._internalArray[i], i);\n    }\n  }\n\n  /**\n   * Mutate every element in the collection\n   * @param func  Callback to call for each element passing a reference to the element and its index, any values returned mutate\n   * the collection\n   */\n  public map(func: (element: T, index: number) => any) {\n    const count = this.count();\n    for (let i = 0; i < count; i++) {\n      this._internalArray[i] = func.call(this, this._internalArray[i], i);\n    }\n  }\n}\n\n/**\n * Used for exhaustive checks at compile time\n */\nexport function fail(message: never): never {\n  throw new Error(message);\n}\n","import { Engine } from './Engine';\nimport * as Util from './Util/Util';\nimport { Clonable } from './Interfaces/Clonable';\n\n/**\n * A 2D vector on a plane.\n */\nexport class Vector implements Clonable<Vector> {\n  /**\n   * A (0, 0) vector\n   */\n  public static get Zero() {\n    return new Vector(0, 0);\n  }\n\n  /**\n   * A (1, 1) vector\n   */\n  public static get One() {\n    return new Vector(1, 1);\n  }\n\n  /**\n   * A (0.5, 0.5) vector\n   */\n  public static get Half() {\n    return new Vector(0.5, 0.5);\n  }\n\n  /**\n   * A unit vector pointing up (0, -1)\n   */\n  public static get Up() {\n    return new Vector(0, -1);\n  }\n\n  /**\n   * A unit vector pointing down (0, 1)\n   */\n  public static get Down() {\n    return new Vector(0, 1);\n  }\n\n  /**\n   * A unit vector pointing left (-1, 0)\n   */\n  public static get Left() {\n    return new Vector(-1, 0);\n  }\n  /**\n   * A unit vector pointing right (1, 0)\n   */\n  public static get Right() {\n    return new Vector(1, 0);\n  }\n\n  /**\n   * Returns a vector of unit length in the direction of the specified angle in Radians.\n   * @param angle The angle to generate the vector\n   */\n  public static fromAngle(angle: number) {\n    return new Vector(Math.cos(angle), Math.sin(angle));\n  }\n\n  /**\n   * Checks if vector is not null, undefined, or if any of its components are NaN or Infinity.\n   */\n  public static isValid(vec: Vector) {\n    if (vec === null || vec === undefined) {\n      return false;\n    }\n    if (isNaN(vec.x) || isNaN(vec.y)) {\n      return false;\n    }\n\n    if (vec.x === Infinity || vec.y === Infinity || vec.x === -Infinity || vec.y === -Infinity) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Calculates distance between two Vectors\n   * @param vec1\n   * @param vec2\n   */\n  public static distance(vec1: Vector, vec2: Vector) {\n    return Math.sqrt(Math.pow(vec1.x - vec2.x, 2) + Math.pow(vec1.y - vec2.y, 2));\n  }\n\n  /**\n   * @param x  X component of the Vector\n   * @param y  Y component of the Vector\n   */\n  constructor(public x: number, public y: number) {}\n\n  /**\n   * Sets the x and y components at once\n   */\n  public setTo(x: number, y: number) {\n    this.x = x;\n    this.y = y;\n  }\n\n  /**\n   * Compares this point against another and tests for equality\n   * @param point  The other point to compare to\n   */\n  public equals(vector: Vector, tolerance: number = 0.001): boolean {\n    return Math.abs(this.x - vector.x) <= tolerance && Math.abs(this.y - vector.y) <= tolerance;\n  }\n\n  /**\n   * The distance to another vector. If no other Vector is specified, this will return the [[magnitude]].\n   * @param v  The other vector. Leave blank to use origin vector.\n   */\n  public distance(v?: Vector): number {\n    if (!v) {\n      v = Vector.Zero;\n    }\n    return Math.sqrt(Math.pow(this.x - v.x, 2) + Math.pow(this.y - v.y, 2));\n  }\n\n  /**\n   * The magnitude (size) of the Vector\n   */\n  public magnitude(): number {\n    return this.distance();\n  }\n\n  /**\n   * Normalizes a vector to have a magnitude of 1.\n   */\n  public normalize(): Vector {\n    const d = this.distance();\n    if (d > 0) {\n      return new Vector(this.x / d, this.y / d);\n    } else {\n      return new Vector(0, 1);\n    }\n  }\n\n  /**\n   * Returns the average (midpoint) between the current point and the specified\n   */\n  public average(vec: Vector): Vector {\n    return this.add(vec).scale(0.5);\n  }\n\n  /**\n   * Scales a vector's by a factor of size\n   * @param size  The factor to scale the magnitude by\n   */\n  public scale(scale: Vector): Vector;\n  public scale(size: number): Vector;\n  public scale(sizeOrScale: number | Vector): Vector {\n    if (sizeOrScale instanceof Vector) {\n      return new Vector(this.x * sizeOrScale.x, this.y * sizeOrScale.y);\n    } else {\n      return new Vector(this.x * sizeOrScale, this.y * sizeOrScale);\n    }\n  }\n\n  /**\n   * Adds one vector to another\n   * @param v The vector to add\n   */\n  public add(v: Vector): Vector {\n    return new Vector(this.x + v.x, this.y + v.y);\n  }\n\n  /**\n   * Subtracts a vector from another, if you subract vector `B.sub(A)` the resulting vector points from A -> B\n   * @param v The vector to subtract\n   */\n  public sub(v: Vector): Vector {\n    return new Vector(this.x - v.x, this.y - v.y);\n  }\n\n  /**\n   * Adds one vector to this one modifying the original\n   * @param v The vector to add\n   */\n  public addEqual(v: Vector): Vector {\n    this.x += v.x;\n    this.y += v.y;\n    return this;\n  }\n\n  /**\n   * Subtracts a vector from this one modifying the original\n   * @parallel v The vector to subtract\n   */\n  public subEqual(v: Vector): Vector {\n    this.x -= v.x;\n    this.y -= v.y;\n    return this;\n  }\n\n  /**\n   * Scales this vector by a factor of size and modifies the original\n   */\n  public scaleEqual(size: number): Vector {\n    this.x *= size;\n    this.y *= size;\n    return this;\n  }\n\n  /**\n   * Performs a dot product with another vector\n   * @param v  The vector to dot\n   */\n  public dot(v: Vector): number {\n    return this.x * v.x + this.y * v.y;\n  }\n\n  /**\n   * Performs a 2D cross product with scalar. 2D cross products with a scalar return a vector.\n   * @param v  The scalar to cross\n   */\n  public cross(v: number): Vector;\n  /**\n   * Performs a 2D cross product with another vector. 2D cross products return a scalar value not a vector.\n   * @param v  The vector to cross\n   */\n  public cross(v: Vector): number;\n  public cross(v: any): any {\n    if (v instanceof Vector) {\n      return this.x * v.y - this.y * v.x;\n    } else if (typeof v === 'number') {\n      return new Vector(v * this.y, -v * this.x);\n    }\n  }\n\n  /**\n   * Returns the perpendicular vector to this one\n   */\n  public perpendicular(): Vector {\n    return new Vector(this.y, -this.x);\n  }\n\n  /**\n   * Returns the normal vector to this one, same as the perpendicular of length 1\n   */\n  public normal(): Vector {\n    return this.perpendicular().normalize();\n  }\n\n  /**\n   * Negate the current vector\n   */\n  public negate(): Vector {\n    return this.scale(-1);\n  }\n\n  /**\n   * Returns the angle of this vector.\n   */\n  public toAngle(): number {\n    return Math.atan2(this.y, this.x);\n  }\n\n  /**\n   * Rotates the current vector around a point by a certain number of\n   * degrees in radians\n   */\n  public rotate(angle: number, anchor?: Vector): Vector {\n    if (!anchor) {\n      anchor = new Vector(0, 0);\n    }\n    const sinAngle = Math.sin(angle);\n    const cosAngle = Math.cos(angle);\n    const x = cosAngle * (this.x - anchor.x) - sinAngle * (this.y - anchor.y) + anchor.x;\n    const y = sinAngle * (this.x - anchor.x) + cosAngle * (this.y - anchor.y) + anchor.y;\n    return new Vector(x, y);\n  }\n\n  /**\n   * Creates new vector that has the same values as the previous.\n   */\n  public clone(): Vector {\n    return new Vector(this.x, this.y);\n  }\n\n  /**\n   * Returns a string repesentation of the vector.\n   */\n  public toString(): string {\n    return `(${this.x}, ${this.y})`;\n  }\n}\n\n/**\n * A 2D ray that can be cast into the scene to do collision detection\n */\nexport class Ray {\n  public pos: Vector;\n  public dir: Vector;\n\n  /**\n   * @param pos The starting position for the ray\n   * @param dir The vector indicating the direction of the ray\n   */\n  constructor(pos: Vector, dir: Vector) {\n    this.pos = pos;\n    this.dir = dir.normalize();\n  }\n\n  /**\n   * Tests a whether this ray intersects with a line segment. Returns a number greater than or equal to 0 on success.\n   * This number indicates the mathematical intersection time.\n   * @param line  The line to test\n   */\n  public intersect(line: Line): number {\n    const numerator = line.begin.sub(this.pos);\n\n    // Test is line and ray are parallel and non intersecting\n    if (this.dir.cross(line.getSlope()) === 0 && numerator.cross(this.dir) !== 0) {\n      return -1;\n    }\n\n    // Lines are parallel\n    const divisor = this.dir.cross(line.getSlope());\n    if (divisor === 0) {\n      return -1;\n    }\n\n    const t = numerator.cross(line.getSlope()) / divisor;\n\n    if (t >= 0) {\n      const u = numerator.cross(this.dir) / divisor / line.getLength();\n      if (u >= 0 && u <= 1) {\n        return t;\n      }\n    }\n    return -1;\n  }\n\n  /**\n   * Returns the point of intersection given the intersection time\n   */\n  public getPoint(time: number): Vector {\n    return this.pos.add(this.dir.scale(time));\n  }\n}\n\n/**\n * A 2D line segment\n */\nexport class Line {\n  /**\n   * @param begin  The starting point of the line segment\n   * @param end  The ending point of the line segment\n   */\n  constructor(public begin: Vector, public end: Vector) {}\n\n  /**\n   * Gets the raw slope (m) of the line. Will return (+/-)Infinity for vertical lines.\n   */\n  public get slope() {\n    return (this.end.y - this.begin.y) / (this.end.x - this.begin.x);\n  }\n\n  /**\n   * Gets the Y-intercept (b) of the line. Will return (+/-)Infinity if there is no intercept.\n   */\n  public get intercept() {\n    return this.begin.y - this.slope * this.begin.x;\n  }\n\n  /**\n   * Gets the normal of the line\n   */\n  public normal(): Vector {\n    return this.end.sub(this.begin).normal();\n  }\n\n  /**\n   * Returns the slope of the line in the form of a vector\n   */\n  public getSlope(): Vector {\n    const begin = this.begin;\n    const end = this.end;\n    const distance = begin.distance(end);\n    return end.sub(begin).scale(1 / distance);\n  }\n\n  /**\n   * Returns the length of the line segment in pixels\n   */\n  public getLength(): number {\n    const begin = this.begin;\n    const end = this.end;\n    const distance = begin.distance(end);\n    return distance;\n  }\n\n  /**\n   * Find the perpendicular distance from the line to a point\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\n   * @param point\n   */\n  public distanceToPoint(point: Vector) {\n    const x0 = point.x;\n    const y0 = point.y;\n\n    const l = this.getLength();\n\n    const dy = this.end.y - this.begin.y;\n    const dx = this.end.x - this.begin.x;\n    const distance = Math.abs(dy * x0 - dx * y0 + this.end.x * this.begin.y - this.end.y * this.begin.x) / l;\n    return distance;\n  }\n\n  /**\n   * Finds a point on the line given only an X or a Y value. Given an X value, the function returns\n   * a new point with the calculated Y value and vice-versa.\n   *\n   * @param x The known X value of the target point\n   * @param y The known Y value of the target point\n   * @returns A new point with the other calculated axis value\n   */\n  public findPoint(x: number = null, y: number = null): Vector {\n    const m = this.slope;\n    const b = this.intercept;\n\n    if (x !== null) {\n      return new Vector(x, m * x + b);\n    } else if (y !== null) {\n      return new Vector((y - b) / m, y);\n    } else {\n      throw new Error('You must provide an X or a Y value');\n    }\n  }\n\n  /**\n   * Whether or not the given point lies on this line. This method is precise by default\n   * meaning the point must lie exactly on the line. Adjust threshold to\n   * loosen the strictness of the check for floating-point calculations.\n   */\n  public hasPoint(x: number, y: number, threshold?: number): boolean;\n\n  /**\n   * Whether or not the given point lies on this line. This method is precise by default\n   * meaning the point must lie exactly on the line. Adjust threshold to\n   * loosen the strictness of the check for floating-point calculations.\n   */\n  public hasPoint(v: Vector, threshold?: number): boolean;\n\n  /**\n   * @see http://stackoverflow.com/a/11908158/109458\n   */\n  public hasPoint(): boolean {\n    let currPoint: Vector;\n    let threshold = 0;\n\n    if (typeof arguments[0] === 'number' && typeof arguments[1] === 'number') {\n      currPoint = new Vector(arguments[0], arguments[1]);\n      threshold = arguments[2] || 0;\n    } else if (arguments[0] instanceof Vector) {\n      currPoint = arguments[0];\n      threshold = arguments[1] || 0;\n    } else {\n      throw 'Could not determine the arguments for Vector.hasPoint';\n    }\n\n    const dxc = currPoint.x - this.begin.x;\n    const dyc = currPoint.y - this.begin.y;\n\n    const dx1 = this.end.x - this.begin.x;\n    const dy1 = this.end.y - this.begin.y;\n\n    const cross = dxc * dy1 - dyc * dx1;\n\n    // check whether point lines on the line\n    if (Math.abs(cross) > threshold) {\n      return false;\n    }\n\n    // check whether point lies in-between start and end\n    if (Math.abs(dx1) >= Math.abs(dy1)) {\n      return dx1 > 0 ? this.begin.x <= currPoint.x && currPoint.x <= this.end.x : this.end.x <= currPoint.x && currPoint.x <= this.begin.x;\n    } else {\n      return dy1 > 0 ? this.begin.y <= currPoint.y && currPoint.y <= this.end.y : this.end.y <= currPoint.y && currPoint.y <= this.begin.y;\n    }\n  }\n}\n\n/**\n * A 1 dimensional projection on an axis, used to test overlaps\n */\nexport class Projection {\n  constructor(public min: number, public max: number) {}\n  public overlaps(projection: Projection): boolean {\n    return this.max > projection.min && projection.max > this.min;\n  }\n\n  public getOverlap(projection: Projection): number {\n    if (this.overlaps(projection)) {\n      if (this.max > projection.max) {\n        return projection.max - this.min;\n      } else {\n        return this.max - projection.min;\n      }\n    }\n    return 0;\n  }\n}\n\nexport class GlobalCoordinates {\n  public static fromPagePosition(x: number, y: number, engine: Engine): GlobalCoordinates;\n  public static fromPagePosition(pos: Vector, engine: Engine): GlobalCoordinates;\n  public static fromPagePosition(xOrPos: number | Vector, yOrEngine: number | Engine, engineOrUndefined?: Engine): GlobalCoordinates {\n    let pageX: number;\n    let pageY: number;\n    let pagePos: Vector;\n    let engine: Engine;\n\n    if (arguments.length === 3) {\n      pageX = <number>xOrPos;\n      pageY = <number>yOrEngine;\n      pagePos = new Vector(pageX, pageY);\n      engine = engineOrUndefined;\n    } else {\n      pagePos = <Vector>xOrPos;\n      pageX = pagePos.x;\n      pageY = pagePos.y;\n      engine = <Engine>yOrEngine;\n    }\n\n    const screenX: number = pageX - Util.getPosition(engine.canvas).x;\n    const screenY: number = pageY - Util.getPosition(engine.canvas).y;\n    const screenPos = new Vector(screenX, screenY);\n    const worldPos = engine.screenToWorldCoordinates(screenPos);\n\n    return new GlobalCoordinates(worldPos, pagePos, screenPos);\n  }\n\n  constructor(public worldPos: Vector, public pagePos: Vector, public screenPos: Vector) {}\n}\n","import { Scene } from './Scene';\nimport { Vector } from './Algebra';\nimport { Actor } from './Actor';\nimport { Trigger } from './Trigger';\nimport { FrameStats } from './Debug';\nimport { Engine } from './Engine';\nimport { TileMap } from './TileMap';\nimport { Side } from './Collision/Side';\nimport * as Input from './Input/Index';\nimport { Pair, Camera } from './index';\nimport { Collider } from './Collision/Collider';\n\nexport enum EventTypes {\n  Kill = 'kill',\n  PreKill = 'prekill',\n  PostKill = 'postkill',\n\n  PreDraw = 'predraw',\n  PostDraw = 'postdraw',\n\n  PreDebugDraw = 'predebugdraw',\n  PostDebugDraw = 'postdebugdraw',\n\n  PreUpdate = 'preupdate',\n  PostUpdate = 'postupdate',\n\n  PreFrame = 'preframe',\n  PostFrame = 'postframe',\n\n  PreCollision = 'precollision',\n  CollisionStart = 'collisionstart',\n  CollisionEnd = 'collisionend',\n  PostCollision = 'postcollision',\n\n  Initialize = 'initialize',\n  Activate = 'activate',\n  Deactivate = 'deactivate',\n\n  ExitViewport = 'exitviewport',\n  EnterViewport = 'enterviewport',\n\n  ExitTrigger = 'exit',\n  EnterTrigger = 'enter',\n\n  Connect = 'connect',\n  Disconnect = 'disconnect',\n  Button = 'button',\n  Axis = 'axis',\n\n  Subscribe = 'subscribe',\n  Unsubscribe = 'unsubscribe',\n\n  Visible = 'visible',\n  Hidden = 'hidden',\n  Start = 'start',\n  Stop = 'stop',\n\n  PointerUp = 'pointerup',\n  PointerDown = 'pointerdown',\n  PointerMove = 'pointermove',\n  PointerEnter = 'pointerenter',\n  PointerLeave = 'pointerleave',\n  PointerCancel = 'pointercancel',\n  PointerWheel = 'pointerwheel',\n\n  Up = 'up',\n  Down = 'down',\n  Move = 'move',\n  Enter = 'enter',\n  Leave = 'leave',\n  Cancel = 'cancel',\n  Wheel = 'wheel',\n\n  Press = 'press',\n  Release = 'release',\n  Hold = 'hold',\n\n  PointerDragStart = 'pointerdragstart',\n  PointerDragEnd = 'pointerdragend',\n  PointerDragEnter = 'pointerdragenter',\n  PointerDragLeave = 'pointerdragleave',\n  PointerDragMove = 'pointerdragmove'\n}\n\n/* istanbul ignore next */\n/* compiler only: these are internal to lib */\nexport type kill = 'kill';\nexport type prekill = 'prekill';\nexport type postkill = 'postkill';\n\nexport type predraw = 'predraw';\nexport type postdraw = 'postdraw';\n\nexport type predebugdraw = 'predebugdraw';\nexport type postdebugdraw = 'postdebugdraw';\n\nexport type preupdate = 'preupdate';\nexport type postupdate = 'postupdate';\n\nexport type preframe = 'preframe';\nexport type postframe = 'postframe';\n\nexport type precollision = 'precollision';\nexport type collisionstart = 'collisionstart';\nexport type collisionend = 'collisionend';\nexport type postcollision = 'postcollision';\n\nexport type initialize = 'initialize';\nexport type activate = 'activate';\nexport type deactivate = 'deactivate';\n\nexport type exitviewport = 'exitviewport';\nexport type enterviewport = 'enterviewport';\n\nexport type exittrigger = 'exit';\nexport type entertrigger = 'enter';\n\nexport type connect = 'connect';\nexport type disconnect = 'disconnect';\nexport type button = 'button';\nexport type axis = 'axis';\n\nexport type subscribe = 'subscribe';\nexport type unsubscribe = 'unsubscribe';\n\nexport type visible = 'visible';\nexport type hidden = 'hidden';\nexport type start = 'start';\nexport type stop = 'stop';\n\nexport type pointerup = 'pointerup';\nexport type pointerdown = 'pointerdown';\nexport type pointermove = 'pointermove';\nexport type pointerenter = 'pointerenter';\nexport type pointerleave = 'pointerleave';\nexport type pointercancel = 'pointercancel';\nexport type pointerwheel = 'pointerwheel';\n\nexport type up = 'up';\nexport type down = 'down';\nexport type move = 'move';\nexport type enter = 'enter';\nexport type leave = 'leave';\nexport type cancel = 'cancel';\nexport type wheel = 'wheel';\n\nexport type press = 'press';\nexport type release = 'release';\nexport type hold = 'hold';\n\nexport type pointerdragstart = 'pointerdragstart';\nexport type pointerdragend = 'pointerdragend';\nexport type pointerdragenter = 'pointerdragenter';\nexport type pointerdragleave = 'pointerdragleave';\nexport type pointerdragmove = 'pointerdragmove';\n\n/**\n * Base event type in Excalibur that all other event types derive from. Not all event types are thrown on all Excalibur game objects,\n * some events are unique to a type, others are not.\n *\n */\nexport class GameEvent<T, U = T> {\n  /**\n   * Target object for this event.\n   */\n  public target: T;\n\n  /**\n   * Other target object for this event\n   */\n  public other: U | null;\n\n  /**\n   * determines, if event bubbles to the target's ancestors\n   */\n  public bubbles: boolean = true;\n  /**\n   * Holds the whole path from the Root to the event target\n   */\n  protected _path: Actor[] = [];\n  protected _name: string = '';\n\n  /**\n   * Returns Event path from root to active actor.\n   */\n  get eventPath(): Actor[] {\n    return this._path;\n  }\n  /**\n   * Returns name of the event\n   */\n  get name(): string {\n    return this._name;\n  }\n\n  /**\n   * Prevents event from bubbling\n   */\n  public stopPropagation() {\n    this.bubbles = false;\n  }\n  /**\n   * Action, that calls when event happens\n   */\n  public action(): void {\n    const actor = this.eventPath.pop();\n\n    if (actor) {\n      this._onActionStart(actor);\n      actor.eventDispatcher.emit(this._name, this);\n      this._onActionEnd(actor);\n    }\n  }\n  /**\n   * Propagate event further through event path\n   */\n  public propagate(): void {\n    if (!this.eventPath.length) {\n      return;\n    }\n\n    this.action();\n\n    if (this.bubbles) {\n      this.propagate();\n    }\n  }\n\n  public layPath(actor: Actor): void {\n    const actorPath = actor.getAncestors();\n    this._path = actorPath.length > this._path.length ? actorPath : this._path;\n  }\n\n  protected _onActionStart(_actor?: Actor) {\n    // to be rewritten\n  }\n\n  protected _onActionEnd(_actor?: Actor) {\n    // to be rewritten\n  }\n}\n\n/**\n * The 'kill' event is emitted on actors when it is killed. The target is the actor that was killed.\n */\nexport class KillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'prekill' event is emitted directly before an actor is killed.\n */\nexport class PreKillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'postkill' event is emitted directly after the actor is killed.\n */\nexport class PostKillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'start' event is emitted on engine when has started and is ready for interaction.\n */\nexport class GameStartEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * The 'stop' event is emitted on engine when has been stopped and will no longer take input, update or draw.\n */\nexport class GameStopEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * The 'predraw' event is emitted on actors, scenes, and engine before drawing starts. Actors' predraw happens inside their graphics\n * transform so that all drawing takes place with the actor as the origin.\n *\n */\nexport class PreDrawEvent extends GameEvent<Actor | Scene | Engine | TileMap> {\n  constructor(public ctx: CanvasRenderingContext2D, public delta: number, public target: Actor | Scene | Engine | TileMap) {\n    super();\n  }\n}\n\n/**\n * The 'postdraw' event is emitted on actors, scenes, and engine after drawing finishes. Actors' postdraw happens inside their graphics\n * transform so that all drawing takes place with the actor as the origin.\n *\n */\nexport class PostDrawEvent extends GameEvent<Actor | Scene | Engine | TileMap> {\n  constructor(public ctx: CanvasRenderingContext2D, public delta: number, public target: Actor | Scene | Engine | TileMap) {\n    super();\n  }\n}\n\n/**\n * The 'predebugdraw' event is emitted on actors, scenes, and engine before debug drawing starts.\n */\nexport class PreDebugDrawEvent extends GameEvent<Actor | Scene | Engine> {\n  constructor(public ctx: CanvasRenderingContext2D, public target: Actor | Scene | Engine) {\n    super();\n  }\n}\n\n/**\n * The 'postdebugdraw' event is emitted on actors, scenes, and engine after debug drawing starts.\n */\nexport class PostDebugDrawEvent extends GameEvent<Actor | Scene | Engine> {\n  constructor(public ctx: CanvasRenderingContext2D, public target: Actor | Scene | Engine) {\n    super();\n  }\n}\n\n/**\n * The 'preupdate' event is emitted on actors, scenes, camera, and engine before the update starts.\n */\nexport class PreUpdateEvent extends GameEvent<Actor | Scene | Engine | TileMap | Camera> {\n  constructor(public engine: Engine, public delta: number, public target: Actor | Scene | Engine | TileMap | Camera) {\n    super();\n  }\n}\n\n/**\n * The 'postupdate' event is emitted on actors, scenes, camera, and engine after the update ends.\n */\nexport class PostUpdateEvent extends GameEvent<Actor | Scene | Engine | TileMap | Camera> {\n  constructor(public engine: Engine, public delta: number, public target: Actor | Scene | Engine | TileMap | Camera) {\n    super();\n  }\n}\n\n/**\n * The 'preframe' event is emitted on the engine, before the frame begins.\n */\nexport class PreFrameEvent extends GameEvent<Engine> {\n  constructor(public engine: Engine, public prevStats: FrameStats) {\n    super();\n    this.target = engine;\n  }\n}\n\n/**\n * The 'postframe' event is emitted on the engine, after a frame ends.\n */\nexport class PostFrameEvent extends GameEvent<Engine> {\n  constructor(public engine: Engine, public stats: FrameStats) {\n    super();\n    this.target = engine;\n  }\n}\n\n/**\n * Event received when a gamepad is connected to Excalibur. [[Gamepads]] receives this event.\n */\nexport class GamepadConnectEvent extends GameEvent<Input.Gamepad> {\n  constructor(public index: number, public gamepad: Input.Gamepad) {\n    super();\n    this.target = gamepad;\n  }\n}\n\n/**\n * Event received when a gamepad is disconnected from Excalibur. [[Gamepads]] receives this event.\n */\nexport class GamepadDisconnectEvent extends GameEvent<Input.Gamepad> {\n  constructor(public index: number, public gamepad: Input.Gamepad) {\n    super();\n    this.target = gamepad;\n  }\n}\n\n/**\n * Gamepad button event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\n */\nexport class GamepadButtonEvent extends GameEvent<Input.Gamepad> {\n  /**\n   * @param button  The Gamepad button\n   * @param value   A numeric value between 0 and 1\n   */\n  constructor(public button: Input.Buttons, public value: number, public target: Input.Gamepad) {\n    super();\n  }\n}\n\n/**\n * Gamepad axis event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\n */\nexport class GamepadAxisEvent extends GameEvent<Input.Gamepad> {\n  /**\n   * @param axis  The Gamepad axis\n   * @param value A numeric value between -1 and 1\n   */\n  constructor(public axis: Input.Axes, public value: number, public target: Input.Gamepad) {\n    super();\n  }\n}\n\n/**\n * Subscribe event thrown when handlers for events other than subscribe are added. Meta event that is received by\n * [[EventDispatcher|event dispatchers]].\n */\nexport class SubscribeEvent<T> extends GameEvent<T> {\n  constructor(public topic: string, public handler: (event: GameEvent<T>) => void) {\n    super();\n  }\n}\n\n/**\n * Unsubscribe event thrown when handlers for events other than unsubscribe are removed. Meta event that is received by\n * [[EventDispatcher|event dispatchers]].\n */\nexport class UnsubscribeEvent<T> extends GameEvent<T> {\n  constructor(public topic: string, public handler: (event: GameEvent<T>) => void) {\n    super();\n  }\n}\n\n/**\n * Event received by the [[Engine]] when the browser window is visible on a screen.\n */\nexport class VisibleEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * Event received by the [[Engine]] when the browser window is hidden from all screens.\n */\nexport class HiddenEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor|actor]] when a collision will occur this frame if it resolves\n */\nexport class PreCollisionEvent<T extends Collider | Actor = Actor> extends GameEvent<T> {\n  /**\n   * @param actor         The actor the event was thrown on\n   * @param other         The actor that will collided with the current actor\n   * @param side          The side that will be collided with the current actor\n   * @param intersection  Intersection vector\n   */\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown on an [[Actor|actor]] when a collision has been resolved (body reacted) this frame\n */\nexport class PostCollisionEvent<T extends Collider | Actor = Actor> extends GameEvent<T> {\n  /**\n   * @param actor         The actor the event was thrown on\n   * @param other         The actor that did collide with the current actor\n   * @param side          The side that did collide with the current actor\n   * @param intersection  Intersection vector\n   */\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown the first time an [[Actor|actor]] collides with another, after an actor is in contact normal collision events are fired.\n */\nexport class CollisionStartEvent<T extends Collider | Actor = Actor> extends GameEvent<T> {\n  /**\n   *\n   * @param actor\n   * @param other\n   * @param pair\n   */\n  constructor(actor: T, public other: T, public pair: Pair) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown when the [[Actor|actor]] is no longer colliding with another\n */\nexport class CollisionEndEvent<T extends Collider | Actor = Actor> extends GameEvent<T> {\n  /**\n   *\n   */\n  constructor(actor: T, public other: T) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] and a [[Scene]] only once before the first update call\n */\nexport class InitializeEvent extends GameEvent<Actor | Scene | Engine | Camera> {\n  /**\n   * @param engine  The reference to the current engine\n   */\n  constructor(public engine: Engine, public target: Actor | Scene | Engine | Camera) {\n    super();\n  }\n}\n\n/**\n * Event thrown on a [[Scene]] on activation\n */\nexport class ActivateEvent extends GameEvent<Scene> {\n  /**\n   * @param oldScene  The reference to the old scene\n   */\n  constructor(public oldScene: Scene, public target: Scene) {\n    super();\n  }\n}\n\n/**\n * Event thrown on a [[Scene]] on deactivation\n */\nexport class DeactivateEvent extends GameEvent<Scene> {\n  /**\n   * @param newScene  The reference to the new scene\n   */\n  constructor(public newScene: Scene, public target: Scene) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] when it completely leaves the screen.\n */\nexport class ExitViewPortEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] when it completely leaves the screen.\n */\nexport class EnterViewPortEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\nexport class EnterTriggerEvent extends GameEvent<Actor> {\n  constructor(public target: Trigger, public actor: Actor) {\n    super();\n  }\n}\n\nexport class ExitTriggerEvent extends GameEvent<Actor> {\n  constructor(public target: Trigger, public actor: Actor) {\n    super();\n  }\n}\n","import { Vector } from './Algebra';\n\n/**\n * Possible collision resolution strategies\n *\n * The default is [[CollisionResolutionStrategy.Box]] which performs simple axis aligned arcade style physics.\n *\n * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.RigidBody]] which allows for complicated\n * simulated physical interactions.\n */\nexport enum CollisionResolutionStrategy {\n  Box,\n  RigidBody\n}\n\n/**\n * Possible broadphase collision pair identification strategies\n *\n * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\n * potential collision pairs which is O(nlog(n)) faster. The other possible strategy is the [[BroadphaseStrategy.Naive]] strategy\n * which loops over every object for every object in the scene to identify collision pairs which is O(n^2) slower.\n */\nexport enum BroadphaseStrategy {\n  Naive,\n  DynamicAABBTree\n}\n\n/**\n * Possible numerical integrators for position and velocity\n */\nexport enum Integrator {\n  Euler\n}\n\n/**\n * The [[Physics]] object is the global configuration object for all Excalibur physics.\n *\n * [[include:Physics.md]]\n */\n/* istanbul ignore next */\nexport class Physics {\n  /**\n   * Global acceleration that is applied to all vanilla actors that have a [[CollisionType.Active|active]] collision type.\n   * Global acceleration won't effect [[Label|labels]], [[UIActor|ui actors]], or [[Trigger|triggers]] in Excalibur.\n   *\n   * This is a great way to globally simulate effects like gravity.\n   */\n  public static acc = new Vector(0, 0);\n\n  /**\n   * Globally switches all Excalibur physics behavior on or off.\n   */\n  public static enabled = true;\n\n  /**\n   * Gets or sets the number of collision passes for Excalibur to perform on physics bodies.\n   *\n   * Reducing collision passes may cause things not to collide as expected in your game, but may increase performance.\n   *\n   * More passes can improve the visual quality of collisions when many objects are on the screen. This can reduce jitter, improve the\n   * collision resolution of fast move objects, or the stability of large numbers of objects stacked together.\n   *\n   * Fewer passes will improve the performance of the game at the cost of collision quality, more passes will improve quality at the\n   * cost of performance.\n   *\n   * The default is set to 5 passes which is a good start.\n   */\n  public static collisionPasses = 5;\n\n  /**\n   * Gets or sets the broadphase pair identification strategy.\n   *\n   * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\n   * potential collision pairs which is O(nlog(n)) faster. The other possible strategy is the [[BroadphaseStrategy.Naive]] strategy\n   * which loops over every object for every object in the scene to identify collision pairs which is O(n^2) slower.\n   */\n  public static broadphaseStrategy: BroadphaseStrategy = BroadphaseStrategy.DynamicAABBTree;\n\n  /**\n   * Globally switches the debug information for the broadphase strategy\n   */\n  public static broadphaseDebug: boolean = false;\n  /**\n   * Show the normals as a result of collision on the screen.\n   */\n  public static showCollisionNormals: boolean = false;\n  /**\n   * Show the position, velocity, and acceleration as graphical vectors.\n   */\n  public static showMotionVectors: boolean = false;\n  /**\n   * Show the axis-aligned bounding boxes of the collision bodies on the screen.\n   */\n  public static showBounds: boolean = false;\n  /**\n   * Show the bounding collision area shapes\n   */\n  public static showArea: boolean = false;\n  /**\n   * Show points of collision interpreted by excalibur as a result of collision.\n   */\n  public static showContacts: boolean = false;\n  /**\n   * Show the surface normals of the collision areas.\n   */\n  public static showNormals: boolean = false;\n  /**\n   * Gets or sets the global collision resolution strategy (narrowphase).\n   *\n   * The default is [[CollisionResolutionStrategy.Box]] which performs simple axis aligned arcade style physics.\n   *\n   * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.RigidBody]] which allows for complicated\n   * simulated physical interactions.\n   */\n  public static collisionResolutionStrategy: CollisionResolutionStrategy = CollisionResolutionStrategy.Box;\n  /**\n   * The default mass to use if none is specified\n   */\n  public static defaultMass: number = 10;\n  /**\n   * Gets or sets the position and velocity positional integrator, currently only Euler is supported.\n   */\n  public static integrator: Integrator = Integrator.Euler;\n  /**\n   * Number of steps to use in integration. A higher number improves the positional accuracy over time. This can be useful to increase\n   * if you have fast moving objects in your simulation or you have a large number of objects and need to increase stability.\n   */\n  public static integrationSteps = 1;\n  /**\n   * Gets or sets whether rotation is allowed in a RigidBody collision resolution\n   */\n  public static allowRigidBodyRotation = true;\n\n  /**\n   * Configures Excalibur to use box physics. Box physics which performs simple axis aligned arcade style physics.\n   */\n  public static useBoxPhysics(): void {\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.Box;\n  }\n\n  /**\n   * Configures Excalibur to use rigid body physics. Rigid body physics allows for complicated\n   * simulated physical interactions.\n   */\n  public static useRigidBodyPhysics(): void {\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.RigidBody;\n  }\n\n  /**\n   * Small value to help collision passes settle themselves after the narrowphase.\n   */\n  public static collisionShift = 0.001;\n\n  /**\n   * Factor to add to the RigidBody BoundingBox, bounding box (dimensions += vel * dynamicTreeVelocityMultiplyer);\n   */\n  public static dynamicTreeVelocityMultiplyer = 2;\n\n  /**\n   * Pad RigidBody BoundingBox by a constant amount\n   */\n  public static boundsPadding = 5;\n\n  /**\n   * Surface epsilon is used to help deal with surface penatration\n   */\n  public static surfaceEpsilon = 0.1;\n\n  /**\n   * Enable fast moving body checking, this enables checking for collision pairs via raycast for fast moving objects to prevent\n   * bodies from tunneling through one another.\n   */\n  public static checkForFastBodies = true;\n\n  /**\n   * Disable minimum fast moving body raycast, by default if ex.Physics.checkForFastBodies = true Excalibur will only check if the\n   * body is moving at least half of its minimum diminension in an update. If ex.Physics.disableMinimumSpeedForFastBody is set to true,\n   * Excalibur will always perform the fast body raycast regardless of speed.\n   */\n  public static disableMinimumSpeedForFastBody = false;\n}\n","import { GameEvent, SubscribeEvent, UnsubscribeEvent } from './Events';\nimport { Eventable } from './Interfaces/Evented';\n\n/**\n * Excalibur's internal event dispatcher implementation.\n * Callbacks are fired immediately after an event is published.\n * Typically you will use [[Class.eventDispatcher]] since most classes in\n * Excalibur inherit from [[Class]]. You will rarely create an `EventDispatcher`\n * yourself.\n *\n * [[include:Events.md]]\n */\nexport class EventDispatcher<T = any> implements Eventable {\n  private _handlers: { [key: string]: { (event: GameEvent<T>): void }[] } = {};\n  private _wiredEventDispatchers: Eventable[] = [];\n\n  private _target: T;\n\n  /**\n   * @param target  The object that will be the recipient of events from this event dispatcher\n   */\n  constructor(target: T) {\n    this._target = target;\n  }\n\n  /**\n   * Clears any existing handlers or wired event dispatchers on this event dispatcher\n   */\n  public clear() {\n    this._handlers = {};\n    this._wiredEventDispatchers = [];\n  }\n\n  /**\n   * Emits an event for target\n   * @param eventName  The name of the event to publish\n   * @param event      Optionally pass an event data object to the handler\n   */\n  public emit(eventName: string, event: GameEvent<T>) {\n    if (!eventName) {\n      // key not mapped\n      return;\n    }\n    eventName = eventName.toLowerCase();\n    const target = this._target;\n    if (!event) {\n      event = new GameEvent();\n    }\n    event.target = target;\n\n    let i: number, len: number;\n\n    if (this._handlers[eventName]) {\n      i = 0;\n      len = this._handlers[eventName].length;\n\n      for (i; i < len; i++) {\n        this._handlers[eventName][i].call(target, event);\n      }\n    }\n\n    i = 0;\n    len = this._wiredEventDispatchers.length;\n\n    for (i; i < len; i++) {\n      this._wiredEventDispatchers[i].emit(eventName, event);\n    }\n  }\n\n  /**\n   * Subscribe an event handler to a particular event name, multiple handlers per event name are allowed.\n   * @param eventName  The name of the event to subscribe to\n   * @param handler    The handler callback to fire on this event\n   */\n  public on(eventName: string, handler: (event: GameEvent<T>) => void) {\n    eventName = eventName.toLowerCase();\n    if (!this._handlers[eventName]) {\n      this._handlers[eventName] = [];\n    }\n    this._handlers[eventName].push(handler);\n\n    // meta event handlers\n    if (eventName !== 'unsubscribe' && eventName !== 'subscribe') {\n      this.emit('subscribe', new SubscribeEvent(eventName, handler));\n    }\n  }\n\n  /**\n   * Unsubscribe an event handler(s) from an event. If a specific handler\n   * is specified for an event, only that handler will be unsubscribed.\n   * Otherwise all handlers will be unsubscribed for that event.\n   *\n   * @param eventName  The name of the event to unsubscribe\n   * @param handler    Optionally the specific handler to unsubscribe\n   *\n   */\n  public off(eventName: string, handler?: (event: GameEvent<T>) => void) {\n    eventName = eventName.toLowerCase();\n    const eventHandlers = this._handlers[eventName];\n\n    if (eventHandlers) {\n      // if no explicit handler is give with the event name clear all handlers\n      if (!handler) {\n        this._handlers[eventName].length = 0;\n      } else {\n        const index = eventHandlers.indexOf(handler);\n        this._handlers[eventName].splice(index, 1);\n      }\n    }\n    // meta event handlers\n    if (eventName !== 'unsubscribe' && eventName !== 'subscribe') {\n      this.emit('unsubscribe', new UnsubscribeEvent(eventName, handler));\n    }\n  }\n\n  /**\n   * Once listens to an event one time, then unsubscribes from that event\n   *\n   * @param eventName The name of the event to subscribe to once\n   * @param handler   The handler of the event that will be auto unsubscribed\n   */\n  public once(eventName: string, handler: (event: GameEvent<T>) => void) {\n    const metaHandler = (event: GameEvent<T>) => {\n      const ev = event || new GameEvent();\n      ev.target = ev.target || this._target;\n\n      this.off(eventName, handler);\n      handler.call(ev.target, ev);\n    };\n\n    this.on(eventName, metaHandler);\n  }\n\n  /**\n   * Wires this event dispatcher to also recieve events from another\n   */\n  public wire(eventDispatcher: EventDispatcher): void {\n    eventDispatcher._wiredEventDispatchers.push(this);\n  }\n\n  /**\n   * Unwires this event dispatcher from another\n   */\n  public unwire(eventDispatcher: EventDispatcher): void {\n    const index = eventDispatcher._wiredEventDispatchers.indexOf(this);\n    if (index > -1) {\n      eventDispatcher._wiredEventDispatchers.splice(index, 1);\n    }\n  }\n}\n","import { GameEvent } from './Events';\nimport { EventDispatcher } from './EventDispatcher';\nimport { Eventable } from './Interfaces/Evented';\n\n/**\n * Excalibur base class that provides basic functionality such as [[EventDispatcher]]\n * and extending abilities for vanilla Javascript projects\n */\nexport class Class implements Eventable {\n  /**\n   * Direct access to the game object event dispatcher.\n   */\n  public eventDispatcher: EventDispatcher;\n\n  constructor() {\n    this.eventDispatcher = new EventDispatcher(this);\n  }\n\n  /**\n   * Alias for `addEventListener`. You can listen for a variety of\n   * events off of the engine; see the events section below for a complete list.\n   * @param eventName  Name of the event to listen for\n   * @param handler    Event handler for the thrown event\n   */\n  public on(eventName: string, handler: (event: GameEvent<any>) => void) {\n    this.eventDispatcher.on(eventName, handler);\n  }\n\n  /**\n   * Alias for `removeEventListener`. If only the eventName is specified\n   * it will remove all handlers registered for that specific event. If the eventName\n   * and the handler instance are specified only that handler will be removed.\n   *\n   * @param eventName  Name of the event to listen for\n   * @param handler    Event handler for the thrown event\n   */\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void) {\n    this.eventDispatcher.off(eventName, handler);\n  }\n\n  /**\n   * Emits a new event\n   * @param eventName   Name of the event to emit\n   * @param eventObject Data associated with this event\n   */\n  public emit(eventName: string, eventObject: GameEvent<any>) {\n    this.eventDispatcher.emit(eventName, eventObject);\n  }\n\n  /**\n   * Once listens to an event one time, then unsubscribes from that event\n   *\n   * @param eventName The name of the event to subscribe to once\n   * @param handler   The handler of the event that will be auto unsubscribed\n   */\n  public once(eventName: string, handler: (event: GameEvent<any>) => void) {\n    this.eventDispatcher.once(eventName, handler);\n  }\n\n  /**\n   * You may wish to extend native Excalibur functionality in vanilla Javascript.\n   * Any method on a class inheriting [[Class]] may be extended to support\n   * additional functionality. In the example below we create a new type called `MyActor`.\n   *\n   *\n   * ```js\n   * var MyActor = Actor.extend({\n   *\n   *    constructor: function() {\n   *       this.newprop = 'something';\n   *       Actor.apply(this, arguments);\n   *    },\n   *\n   *    update: function(engine, delta) {\n   *       // Implement custom update\n   *       // Call super constructor update\n   *       Actor.prototype.update.call(this, engine, delta);\n   *\n   *       console.log(\"Something cool!\");\n   *    }\n   * });\n   *\n   * var myActor = new MyActor(100, 100, 100, 100, Color.Azure);\n   * ```\n   *\n   * In TypeScript, you only need to use the `extends` syntax, you do not need\n   * to use this method of extension.\n   *\n   * @param methods A JSON object contain any methods/properties you want to extend\n   */\n  public static extend(methods: any): any {\n    const parent: any = this;\n    let child: any;\n\n    if (methods && methods.hasOwnProperty('constructor')) {\n      child = methods.constructor;\n    } else {\n      child = function(this: any) {\n        return parent.apply(this, arguments);\n      };\n    }\n\n    // Using constructor allows JS to lazily instantiate super classes\n    const Super: any = function(this: any) {\n      this.constructor = child;\n    };\n    Super.prototype = parent.prototype;\n    child.prototype = new Super();\n\n    if (methods) {\n      for (const prop in methods) {\n        if (methods.hasOwnProperty(prop)) {\n          child.prototype[prop] = methods[prop];\n        }\n      }\n    }\n\n    // Make subclasses extendable\n    child.extend = Class.extend;\n\n    return child;\n  }\n}\n","/**\n * Provides standard colors (e.g. [[Color.Black]])\n * but you can also create custom colors using RGB, HSL, or Hex. Also provides\n * useful color operations like [[Color.lighten]], [[Color.darken]], and more.\n *\n * [[include:Colors.md]]\n */\nexport class Color {\n  /**\n   * Red channel\n   */\n  public r: number;\n  /**\n   * Green channel\n   */\n  public g: number;\n  /**\n   * Blue channel\n   */\n  public b: number;\n  /**\n   * Alpha channel (between 0 and 1)\n   */\n  public a: number;\n\n  /**\n   * Hue\n   */\n  public h: number;\n  /**\n   * Saturation\n   */\n  public s: number;\n  /**\n   * Lightness\n   */\n  public l: number;\n\n  /**\n   * Creates a new instance of Color from an r, g, b, a\n   *\n   * @param r  The red component of color (0-255)\n   * @param g  The green component of color (0-255)\n   * @param b  The blue component of color (0-255)\n   * @param a  The alpha component of color (0-1.0)\n   */\n  constructor(r: number, g: number, b: number, a?: number) {\n    this.r = r;\n    this.g = g;\n    this.b = b;\n    this.a = a != null ? a : 1;\n  }\n\n  /**\n   * Creates a new instance of Color from an r, g, b, a\n   *\n   * @param r  The red component of color (0-255)\n   * @param g  The green component of color (0-255)\n   * @param b  The blue component of color (0-255)\n   * @param a  The alpha component of color (0-1.0)\n   */\n  public static fromRGB(r: number, g: number, b: number, a?: number): Color {\n    return new Color(r, g, b, a);\n  }\n\n  /**\n   * Creates a new inscance of Color from a hex string\n   *\n   * @param hex  CSS color string of the form #ffffff, the alpha component is optional\n   */\n  public static fromHex(hex: string): Color {\n    const hexRegEx: RegExp = /^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;\n    let match = null;\n    if ((match = hex.match(hexRegEx))) {\n      const r = parseInt(match[1], 16);\n      const g = parseInt(match[2], 16);\n      const b = parseInt(match[3], 16);\n      let a = 1;\n      if (match[4]) {\n        a = parseInt(match[4], 16) / 255;\n      }\n      return new Color(r, g, b, a);\n    } else {\n      throw new Error('Invalid hex string: ' + hex);\n    }\n  }\n\n  /**\n   * Creats a new instance of Color from hsla values\n   *\n   * @param h  Hue is represented [0-1]\n   * @param s  Saturation is represented [0-1]\n   * @param l  Luminance is represented [0-1]\n   * @param a  Alpha is represented [0-1]\n   */\n  public static fromHSL(h: number, s: number, l: number, a: number = 1.0): Color {\n    const temp = new HSLColor(h, s, l, a);\n    return temp.toRGBA();\n  }\n\n  /**\n   * Lightens the current color by a specified amount\n   *\n   * @param factor  The amount to lighten by [0-1]\n   */\n  public lighten(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.l += (1 - temp.l) * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Darkens the current color by a specified amount\n   *\n   * @param factor  The amount to darken by [0-1]\n   */\n  public darken(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.l -= temp.l * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Saturates the current color by a specified amount\n   *\n   * @param factor  The amount to saturate by [0-1]\n   */\n  public saturate(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.s += temp.s * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Desaturates the current color by a specified amount\n   *\n   * @param factor  The amount to desaturate by [0-1]\n   */\n  public desaturate(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.s -= temp.s * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Multiplies a color by another, results in a darker color\n   *\n   * @param color  The other color\n   */\n  public mulitiply(color: Color): Color {\n    const newR = (((color.r / 255) * this.r) / 255) * 255;\n    const newG = (((color.g / 255) * this.g) / 255) * 255;\n    const newB = (((color.b / 255) * this.b) / 255) * 255;\n    const newA = color.a * this.a;\n    return new Color(newR, newG, newB, newA);\n  }\n\n  /**\n   * Screens a color by another, results in a lighter color\n   *\n   * @param color  The other color\n   */\n  public screen(color: Color): Color {\n    const color1 = color.invert();\n    const color2 = color.invert();\n    return color1.mulitiply(color2).invert();\n  }\n\n  /**\n   * Inverts the current color\n   */\n  public invert(): Color {\n    return new Color(255 - this.r, 255 - this.g, 255 - this.b, 1.0 - this.a);\n  }\n\n  /**\n   * Averages the current color with another\n   *\n   * @param color  The other color\n   */\n  public average(color: Color): Color {\n    const newR = (color.r + this.r) / 2;\n    const newG = (color.g + this.g) / 2;\n    const newB = (color.b + this.b) / 2;\n    const newA = (color.a + this.a) / 2;\n    return new Color(newR, newG, newB, newA);\n  }\n\n  /**\n   * Returns a CSS string representation of a color.\n   *\n   * @param format Color representation, accepts: rgb, hsl, or hex\n   */\n  public toString(format: 'rgb' | 'hsl' | 'hex' = 'rgb') {\n    switch (format) {\n      case 'rgb':\n        return this.toRGBA();\n      case 'hsl':\n        return this.toHSLA();\n      case 'hex':\n        return this.toHex();\n      default:\n        throw new Error('Invalid Color format');\n    }\n  }\n\n  /**\n   * Returns Hex Value of a color component\n   * @param c color component\n   * @see https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb\n   */\n  private _componentToHex(c: number) {\n    const hex = c.toString(16);\n    return hex.length === 1 ? '0' + hex : hex;\n  }\n\n  /**\n   * Return Hex representation of a color.\n   */\n  public toHex() {\n    return '#' + this._componentToHex(this.r) + this._componentToHex(this.g) + this._componentToHex(this.b);\n  }\n\n  /**\n   * Return RGBA representation of a color.\n   */\n  public toRGBA() {\n    const result = String(this.r.toFixed(0)) + ', ' + String(this.g.toFixed(0)) + ', ' + String(this.b.toFixed(0));\n    if (this.a !== undefined || this.a !== null) {\n      return 'rgba(' + result + ', ' + String(this.a) + ')';\n    }\n    return 'rgb(' + result + ')';\n  }\n\n  /**\n   * Return HSLA representation of a color.\n   */\n  public toHSLA() {\n    return HSLColor.fromRGBA(this.r, this.g, this.b, this.a).toString();\n  }\n\n  /**\n   * Returns a CSS string representation of a color.\n   */\n  public fillStyle() {\n    return this.toString();\n  }\n\n  /**\n   * Returns a clone of the current color.\n   */\n  public clone(): Color {\n    return new Color(this.r, this.g, this.b, this.a);\n  }\n\n  /**\n   * Black (#000000)\n   */\n  public static get Black(): Color {\n    return Color.fromHex('#000000');\n  }\n\n  /**\n   * White (#FFFFFF)\n   */\n  public static get White(): Color {\n    return Color.fromHex('#FFFFFF');\n  }\n\n  /**\n   * Gray (#808080)\n   */\n  public static get Gray(): Color {\n    return Color.fromHex('#808080');\n  }\n\n  /**\n   * Light gray (#D3D3D3)\n   */\n  public static get LightGray(): Color {\n    return Color.fromHex('#D3D3D3');\n  }\n\n  /**\n   * Dark gray (#A9A9A9)\n   */\n  public static get DarkGray(): Color {\n    return Color.fromHex('#A9A9A9');\n  }\n\n  /**\n   * Yellow (#FFFF00)\n   */\n  public static get Yellow(): Color {\n    return Color.fromHex('#FFFF00');\n  }\n\n  /**\n   * Orange (#FFA500)\n   */\n  public static get Orange(): Color {\n    return Color.fromHex('#FFA500');\n  }\n\n  /**\n   * Red (#FF0000)\n   */\n  public static get Red(): Color {\n    return Color.fromHex('#FF0000');\n  }\n\n  /**\n   * Vermillion (#FF5B31)\n   */\n  public static get Vermillion(): Color {\n    return Color.fromHex('#FF5B31');\n  }\n\n  /**\n   * Rose (#FF007F)\n   */\n  public static get Rose(): Color {\n    return Color.fromHex('#FF007F');\n  }\n\n  /**\n   * Magenta (#FF00FF)\n   */\n  public static get Magenta(): Color {\n    return Color.fromHex('#FF00FF');\n  }\n\n  /**\n   * Violet (#7F00FF)\n   */\n  public static get Violet(): Color {\n    return Color.fromHex('#7F00FF');\n  }\n\n  /**\n   * Blue (#0000FF)\n   */\n  public static get Blue(): Color {\n    return Color.fromHex('#0000FF');\n  }\n\n  /**\n   * Azure (#007FFF)\n   */\n  public static get Azure(): Color {\n    return Color.fromHex('#007FFF');\n  }\n\n  /**\n   * Cyan (#00FFFF)\n   */\n  public static get Cyan(): Color {\n    return Color.fromHex('#00FFFF');\n  }\n\n  /**\n   * Viridian (#59978F)\n   */\n  public static get Viridian(): Color {\n    return Color.fromHex('#59978F');\n  }\n\n  /**\n   * Green (#00FF00)\n   */\n  public static get Green(): Color {\n    return Color.fromHex('#00FF00');\n  }\n\n  /**\n   * Chartreuse (#7FFF00)\n   */\n  public static get Chartreuse(): Color {\n    return Color.fromHex('#7FFF00');\n  }\n\n  /**\n   * Transparent (#FFFFFF00)\n   */\n  public static get Transparent(): Color {\n    return Color.fromHex('#FFFFFF00');\n  }\n}\n\n/**\n * Internal HSL Color representation\n *\n * http://en.wikipedia.org/wiki/HSL_and_HSV\n * http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c\n */\nclass HSLColor {\n  constructor(public h: number, public s: number, public l: number, public a: number) {}\n\n  public static hue2rgb(p: number, q: number, t: number): number {\n    if (t < 0) {\n      t += 1;\n    }\n    if (t > 1) {\n      t -= 1;\n    }\n    if (t < 1 / 6) {\n      return p + (q - p) * 6 * t;\n    }\n    if (t < 1 / 2) {\n      return q;\n    }\n    if (t < 2 / 3) {\n      return p + (q - p) * (2 / 3 - t) * 6;\n    }\n    return p;\n  }\n\n  public static fromRGBA(r: number, g: number, b: number, a: number): HSLColor {\n    r /= 255;\n    g /= 255;\n    b /= 255;\n    const max = Math.max(r, g, b),\n      min = Math.min(r, g, b);\n    let h, s;\n    const l = (max + min) / 2;\n\n    if (max === min) {\n      h = s = 0; // achromatic\n    } else {\n      const d = max - min;\n      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n      switch (max) {\n        case r:\n          h = (g - b) / d + (g < b ? 6 : 0);\n          break;\n        case g:\n          h = (b - r) / d + 2;\n          break;\n        case b:\n          h = (r - g) / d + 4;\n          break;\n      }\n      h /= 6;\n    }\n\n    return new HSLColor(h, s, l, a);\n  }\n\n  public toRGBA(): Color {\n    let r: number, g: number, b: number;\n\n    if (this.s === 0) {\n      r = g = b = this.l; // achromatic\n    } else {\n      const q = this.l < 0.5 ? this.l * (1 + this.s) : this.l + this.s - this.l * this.s;\n      const p = 2 * this.l - q;\n      r = HSLColor.hue2rgb(p, q, this.h + 1 / 3);\n      g = HSLColor.hue2rgb(p, q, this.h);\n      b = HSLColor.hue2rgb(p, q, this.h - 1 / 3);\n    }\n\n    return new Color(r * 255, g * 255, b * 255, this.a);\n  }\n\n  public toString(): string {\n    const h = this.h.toFixed(0),\n      s = this.s.toFixed(0),\n      l = this.l.toFixed(0),\n      a = this.a.toFixed(0);\n    return `hsla(${h}, ${s}, ${l}, ${a})`;\n  }\n}\n","/**\n * An enum that describes the types of collisions actors can participate in\n */\nexport enum CollisionType {\n  /**\n   * Actors with the `PreventCollision` setting do not participate in any\n   * collisions and do not raise collision events.\n   */\n  PreventCollision = 'PreventCollision',\n  /**\n   * Actors with the `Passive` setting only raise collision events, but are not\n   * influenced or moved by other actors and do not influence or move other actors.\n   */\n  Passive = 'Passive',\n  /**\n   * Actors with the `Active` setting raise collision events and participate\n   * in collisions with other actors and will be push or moved by actors sharing\n   * the `Active` or `Fixed` setting.\n   */\n  Active = 'Active',\n  /**\n   * Actors with the `Fixed` setting raise collision events and participate in\n   * collisions with other actors. Actors with the `Fixed` setting will not be\n   * pushed or moved by other actors sharing the `Fixed`. Think of Fixed\n   * actors as \"immovable/onstoppable\" objects. If two `Fixed` actors meet they will\n   * not be pushed or moved by each other, they will not interact except to throw\n   * collision events.\n   */\n  Fixed = 'Fixed'\n}\n","import { Body } from './Body';\nimport { Vector } from '../Algebra';\nimport { Physics, CollisionResolutionStrategy } from '../Physics';\nimport { PostCollisionEvent, PreCollisionEvent } from '../Events';\nimport * as Util from '../Util/Util';\nimport { CollisionType } from './CollisionType';\nimport { Collider } from './Collider';\n\n/**\n * Collision contacts are used internally by Excalibur to resolve collision between colliders. This\n * Pair prevents collisions from being evaluated more than one time\n */\nexport class CollisionContact {\n  /**\n   * The id of this collision contact\n   */\n  id: string;\n  /**\n   * The first collider in the collision\n   */\n  colliderA: Collider;\n  /**\n   * The second collider in the collision\n   */\n  colliderB: Collider;\n  /**\n   * The minimum translation vector to resolve penetration, pointing away from colliderA\n   */\n  mtv: Vector;\n  /**\n   * The point of collision shared between colliderA and colliderB\n   */\n  point: Vector;\n  /**\n   * The collision normal, pointing away from colliderA\n   */\n  normal: Vector;\n\n  constructor(colliderA: Collider, colliderB: Collider, mtv: Vector, point: Vector, normal: Vector) {\n    this.colliderA = colliderA;\n    this.colliderB = colliderB;\n    this.mtv = mtv;\n    this.point = point;\n    this.normal = normal;\n  }\n\n  resolve(strategy: CollisionResolutionStrategy) {\n    if (strategy === CollisionResolutionStrategy.RigidBody) {\n      this._resolveRigidBodyCollision();\n    } else if (strategy === CollisionResolutionStrategy.Box) {\n      this._resolveBoxCollision();\n    } else {\n      throw new Error('Unknown collision resolution strategy');\n    }\n  }\n\n  private _applyBoxImpulse(colliderA: Collider, colliderB: Collider, mtv: Vector) {\n    if (colliderA.type === CollisionType.Active && colliderB.type !== CollisionType.Passive) {\n      // Resolve overlaps\n      if (colliderA.type === CollisionType.Active && colliderB.type === CollisionType.Active) {\n        // split overlaps if both are Active\n        mtv = mtv.scale(0.5);\n      }\n      // Apply mtv\n      colliderA.body.pos.y += mtv.y;\n      colliderA.body.pos.x += mtv.x;\n\n      const mtvDir = mtv.normalize();\n\n      // only adjust if velocity is opposite\n      if (mtvDir.dot(colliderA.body.vel) < 0) {\n        // Cancel out velocity in direction of mtv\n        const velAdj = mtvDir.scale(mtvDir.dot(colliderA.body.vel.negate()));\n\n        colliderA.body.vel = colliderA.body.vel.add(velAdj);\n      }\n\n      colliderA.emit('postcollision', new PostCollisionEvent(colliderA, colliderB, Util.getSideFromDirection(mtv), mtv));\n    }\n  }\n\n  private _resolveBoxCollision() {\n    const side = Util.getSideFromDirection(this.mtv);\n    const mtv = this.mtv.negate();\n    // Publish collision events on both participants\n    this.colliderA.emit('precollision', new PreCollisionEvent(this.colliderA, this.colliderB, side, mtv));\n    this.colliderB.emit('precollision', new PreCollisionEvent(this.colliderB, this.colliderA, Util.getOppositeSide(side), mtv.negate()));\n\n    this._applyBoxImpulse(this.colliderA, this.colliderB, mtv);\n    this._applyBoxImpulse(this.colliderB, this.colliderA, mtv.negate());\n  }\n\n  private _resolveRigidBodyCollision() {\n    // perform collison on bounding areas\n    const bodyA: Body = this.colliderA.body;\n    const bodyB: Body = this.colliderB.body;\n    const mtv = this.mtv; // normal pointing away from colliderA\n    let normal = this.normal; // normal pointing away from colliderA\n    if (bodyA === bodyB) {\n      // sanity check for existing pairs\n      return;\n    }\n\n    // Publish collision events on both participants\n    const side = Util.getSideFromDirection(this.mtv);\n    this.colliderA.emit('precollision', new PreCollisionEvent(this.colliderA, this.colliderB, side, this.mtv));\n    this.colliderB.emit(\n      'precollision',\n      new PreCollisionEvent(this.colliderB, this.colliderA, Util.getOppositeSide(side), this.mtv.negate())\n    );\n\n    // If any of the participants are passive then short circuit\n    if (this.colliderA.type === CollisionType.Passive || this.colliderB.type === CollisionType.Passive) {\n      return;\n    }\n\n    const invMassA = this.colliderA.type === CollisionType.Fixed ? 0 : 1 / this.colliderA.mass;\n    const invMassB = this.colliderB.type === CollisionType.Fixed ? 0 : 1 / this.colliderB.mass;\n\n    const invMoiA = this.colliderA.type === CollisionType.Fixed ? 0 : 1 / this.colliderA.inertia;\n    const invMoiB = this.colliderB.type === CollisionType.Fixed ? 0 : 1 / this.colliderB.inertia;\n\n    // average restitution more relistic\n    const coefRestitution = Math.min(this.colliderA.bounciness, this.colliderB.bounciness);\n\n    const coefFriction = Math.min(this.colliderA.friction, this.colliderB.friction);\n\n    normal = normal.normalize();\n    const tangent = normal.normal().normalize();\n\n    const ra = this.point.sub(this.colliderA.center); // point relative to colliderA position\n    const rb = this.point.sub(this.colliderB.center); /// point relative to colliderB\n\n    // Relative velocity in linear terms\n    // Angular to linear velocity formula -> omega = v/r\n    const rv = bodyB.vel.add(rb.cross(-bodyB.rx)).sub(bodyA.vel.sub(ra.cross(bodyA.rx)));\n    const rvNormal = rv.dot(normal);\n    const rvTangent = rv.dot(tangent);\n\n    const raTangent = ra.dot(tangent);\n    const raNormal = ra.dot(normal);\n\n    const rbTangent = rb.dot(tangent);\n    const rbNormal = rb.dot(normal);\n\n    // If objects are moving away ignore\n    if (rvNormal > 0) {\n      return;\n    }\n\n    // Collision impulse formula from Chris Hecker\n    // https://en.wikipedia.org/wiki/Collision_response\n    const impulse =\n      -((1 + coefRestitution) * rvNormal) / (invMassA + invMassB + invMoiA * raTangent * raTangent + invMoiB * rbTangent * rbTangent);\n\n    if (this.colliderA.type === CollisionType.Fixed) {\n      bodyB.vel = bodyB.vel.add(normal.scale(impulse * invMassB));\n      if (Physics.allowRigidBodyRotation) {\n        bodyB.rx -= impulse * invMoiB * -rb.cross(normal);\n      }\n      bodyB.addMtv(mtv);\n    } else if (this.colliderB.type === CollisionType.Fixed) {\n      bodyA.vel = bodyA.vel.sub(normal.scale(impulse * invMassA));\n      if (Physics.allowRigidBodyRotation) {\n        bodyA.rx += impulse * invMoiA * -ra.cross(normal);\n      }\n      bodyA.addMtv(mtv.negate());\n    } else {\n      bodyB.vel = bodyB.vel.add(normal.scale(impulse * invMassB));\n      bodyA.vel = bodyA.vel.sub(normal.scale(impulse * invMassA));\n\n      if (Physics.allowRigidBodyRotation) {\n        bodyB.rx -= impulse * invMoiB * -rb.cross(normal);\n        bodyA.rx += impulse * invMoiA * -ra.cross(normal);\n      }\n\n      // Split the mtv in half for the two bodies, potentially we could do something smarter here\n      bodyB.addMtv(mtv.scale(0.5));\n      bodyA.addMtv(mtv.scale(-0.5));\n    }\n\n    // Friction portion of impulse\n    if (coefFriction && rvTangent) {\n      // Columb model of friction, formula for impulse due to friction from\n      // https://en.wikipedia.org/wiki/Collision_response\n\n      // tangent force exerted by body on another in contact\n      const t = rv.sub(normal.scale(rv.dot(normal))).normalize();\n\n      // impulse in the direction of tangent force\n      const jt = rv.dot(t) / (invMassA + invMassB + raNormal * raNormal * invMoiA + rbNormal * rbNormal * invMoiB);\n\n      let frictionImpulse = new Vector(0, 0);\n      if (Math.abs(jt) <= impulse * coefFriction) {\n        frictionImpulse = t.scale(jt).negate();\n      } else {\n        frictionImpulse = t.scale(-impulse * coefFriction);\n      }\n\n      if (this.colliderA.type === CollisionType.Fixed) {\n        // apply frictional impulse\n        bodyB.vel = bodyB.vel.add(frictionImpulse.scale(invMassB));\n        if (Physics.allowRigidBodyRotation) {\n          bodyB.rx += frictionImpulse.dot(t) * invMoiB * rb.cross(t);\n        }\n      } else if (this.colliderB.type === CollisionType.Fixed) {\n        // apply frictional impulse\n        bodyA.vel = bodyA.vel.sub(frictionImpulse.scale(invMassA));\n        if (Physics.allowRigidBodyRotation) {\n          bodyA.rx -= frictionImpulse.dot(t) * invMoiA * ra.cross(t);\n        }\n      } else {\n        // apply frictional impulse\n        bodyB.vel = bodyB.vel.add(frictionImpulse.scale(invMassB));\n        bodyA.vel = bodyA.vel.sub(frictionImpulse.scale(invMassA));\n\n        // apply frictional impulse\n        if (Physics.allowRigidBodyRotation) {\n          bodyB.rx += frictionImpulse.dot(t) * invMoiB * rb.cross(t);\n          bodyA.rx -= frictionImpulse.dot(t) * invMoiA * ra.cross(t);\n        }\n      }\n    }\n\n    this.colliderA.emit('postcollision', new PostCollisionEvent(this.colliderA, this.colliderB, side, this.mtv));\n    this.colliderB.emit(\n      'postcollision',\n      new PostCollisionEvent(this.colliderB, this.colliderA, Util.getOppositeSide(side), this.mtv.negate())\n    );\n  }\n}\n","/**\n * Logging level that Excalibur will tag\n */\nexport enum LogLevel {\n  Debug,\n  Info,\n  Warn,\n  Error,\n  Fatal\n}\n\n/**\n * Static singleton that represents the logging facility for Excalibur.\n * Excalibur comes built-in with a [[ConsoleAppender]] and [[ScreenAppender]].\n * Derive from [[IAppender]] to create your own logging appenders.\n *\n * [[include:Logger.md]]\n */\nexport class Logger {\n  private static _instance: Logger = null;\n  private _appenders: Appender[] = [];\n\n  constructor() {\n    if (Logger._instance) {\n      throw new Error('Logger is a singleton');\n    }\n    Logger._instance = this;\n    // Default console appender\n    Logger._instance.addAppender(new ConsoleAppender());\n    return Logger._instance;\n  }\n\n  /**\n   * Gets or sets the default logging level. Excalibur will only log\n   * messages if equal to or above this level. Default: [[LogLevel.Info]]\n   */\n  public defaultLevel: LogLevel = LogLevel.Info;\n\n  /**\n   * Gets the current static instance of Logger\n   */\n  public static getInstance(): Logger {\n    if (Logger._instance == null) {\n      Logger._instance = new Logger();\n    }\n    return Logger._instance;\n  }\n\n  /**\n   * Adds a new [[IAppender]] to the list of appenders to write to\n   */\n  public addAppender(appender: Appender): void {\n    this._appenders.push(appender);\n  }\n\n  /**\n   * Clears all appenders from the logger\n   */\n  public clearAppenders(): void {\n    this._appenders.length = 0;\n  }\n\n  /**\n   * Logs a message at a given LogLevel\n   * @param level  The LogLevel`to log the message at\n   * @param args   An array of arguments to write to an appender\n   */\n  private _log(level: LogLevel, args: any[]): void {\n    if (level == null) {\n      level = this.defaultLevel;\n    }\n\n    const len = this._appenders.length;\n\n    for (let i = 0; i < len; i++) {\n      if (level >= this.defaultLevel) {\n        this._appenders[i].log(level, args);\n      }\n    }\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Debug]] level\n   * @param args  Accepts any number of arguments\n   */\n  public debug(...args: any[]): void {\n    this._log(LogLevel.Debug, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Info]] level\n   * @param args  Accepts any number of arguments\n   */\n  public info(...args: any[]): void {\n    this._log(LogLevel.Info, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Warn]] level\n   * @param args  Accepts any number of arguments\n   */\n  public warn(...args: any[]): void {\n    this._log(LogLevel.Warn, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Error]] level\n   * @param args  Accepts any number of arguments\n   */\n  public error(...args: any[]): void {\n    this._log(LogLevel.Error, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Fatal]] level\n   * @param args  Accepts any number of arguments\n   */\n  public fatal(...args: any[]): void {\n    this._log(LogLevel.Fatal, args);\n  }\n}\n\n/**\n * Contract for any log appender (such as console/screen)\n */\nexport interface Appender {\n  /**\n   * Logs a message at the given [[LogLevel]]\n   * @param level  Level to log at\n   * @param args   Arguments to log\n   */\n  log(level: LogLevel, args: any[]): void;\n}\n\n/**\n * Console appender for browsers (i.e. `console.log`)\n */\nexport class ConsoleAppender implements Appender {\n  /**\n   * Logs a message at the given [[LogLevel]]\n   * @param level  Level to log at\n   * @param args   Arguments to log\n   */\n  public log(level: LogLevel, args: any[]): void {\n    // Check for console support\n    if (!console && !console.log && console.warn && console.error) {\n      // todo maybe do something better than nothing\n      return;\n    }\n\n    // Create a new console args array\n    const consoleArgs: any[] = [];\n    consoleArgs.unshift.apply(consoleArgs, args);\n    consoleArgs.unshift('[' + LogLevel[level] + '] : ');\n\n    if (level < LogLevel.Warn) {\n      // Call .log for Debug/Info\n      if (console.log.apply) {\n        // this is required on some older browsers that don't support apply on console.log :(\n        console.log.apply(console, consoleArgs);\n      } else {\n        console.log(consoleArgs.join(' '));\n      }\n    } else if (level < LogLevel.Error) {\n      // Call .warn for Warn\n      if (console.warn.apply) {\n        console.warn.apply(console, consoleArgs);\n      } else {\n        console.warn(consoleArgs.join(' '));\n      }\n    } else {\n      // Call .error for Error/Fatal\n      if (console.error.apply) {\n        console.error.apply(console, consoleArgs);\n      } else {\n        console.error(consoleArgs.join(' '));\n      }\n    }\n  }\n}\n\n/**\n * On-screen (canvas) appender\n */\nexport class ScreenAppender implements Appender {\n  // @todo Clean this up\n\n  private _messages: string[] = [];\n  private _canvas: HTMLCanvasElement;\n  private _ctx: CanvasRenderingContext2D;\n\n  /**\n   * @param width   Width of the screen appender in pixels\n   * @param height  Height of the screen appender in pixels\n   */\n  constructor(width?: number, height?: number) {\n    this._canvas = <HTMLCanvasElement>document.createElement('canvas');\n    this._canvas.width = width || window.innerWidth;\n    this._canvas.height = height || window.innerHeight;\n    this._canvas.style.position = 'absolute';\n    this._ctx = <CanvasRenderingContext2D>this._canvas.getContext('2d');\n    document.body.appendChild(this._canvas);\n  }\n\n  /**\n   * Logs a message at the given [[LogLevel]]\n   * @param level  Level to log at\n   * @param args   Arguments to log\n   */\n  public log(level: LogLevel, args: any[]): void {\n    const message = args.join(',');\n\n    this._ctx.clearRect(0, 0, this._canvas.width, this._canvas.height);\n\n    this._messages.unshift('[' + LogLevel[level] + '] : ' + message);\n\n    let pos = 10;\n    let opacity = 1.0;\n    for (let i = 0; i < this._messages.length; i++) {\n      this._ctx.fillStyle = 'rgba(255,255,255,' + opacity.toFixed(2) + ')';\n      this._ctx.fillText(this._messages[i], 200, pos);\n      pos += 10;\n      opacity = opacity > 0 ? opacity - 0.05 : 0;\n    }\n  }\n}\n","import { Circle } from './Circle';\nimport { CollisionContact } from './CollisionContact';\nimport { ConvexPolygon } from './ConvexPolygon';\nimport { Edge } from './Edge';\n\nimport { Vector } from '../Algebra';\n\nexport let CollisionJumpTable = {\n  CollideCircleCircle(circleA: Circle, circleB: Circle): CollisionContact {\n    const radius = circleA.radius + circleB.radius;\n    const circleAPos = circleA.worldPos;\n    const circleBPos = circleB.worldPos;\n    if (circleAPos.distance(circleBPos) > radius) {\n      return null;\n    }\n\n    const axisOfCollision = circleBPos.sub(circleAPos).normalize();\n    const mvt = axisOfCollision.scale(radius - circleBPos.distance(circleAPos));\n\n    const pointOfCollision = circleA.getFurthestPoint(axisOfCollision);\n\n    return new CollisionContact(circleA.collider, circleB.collider, mvt, pointOfCollision, axisOfCollision);\n  },\n\n  CollideCirclePolygon(circle: Circle, polygon: ConvexPolygon): CollisionContact {\n    let minAxis = circle.testSeparatingAxisTheorem(polygon);\n    if (!minAxis) {\n      return null;\n    }\n\n    // make sure that the minAxis is pointing away from circle\n    const samedir = minAxis.dot(polygon.center.sub(circle.center));\n    minAxis = samedir < 0 ? minAxis.negate() : minAxis;\n\n    const verts: Vector[] = [];\n\n    const point1 = polygon.getFurthestPoint(minAxis.negate());\n    const point2 = circle.getFurthestPoint(minAxis); //.add(cc);\n    if (circle.contains(point1)) {\n      verts.push(point1);\n    }\n    if (polygon.contains(point2)) {\n      verts.push(point2);\n    }\n    if (verts.length === 0) {\n      return null;\n    }\n\n    return new CollisionContact(\n      circle.collider,\n      polygon.collider,\n      minAxis,\n      verts.length === 2 ? verts[0].average(verts[1]) : verts[0],\n      minAxis.normalize()\n    );\n  },\n\n  CollideCircleEdge(circle: Circle, edge: Edge): CollisionContact {\n    // center of the circle\n    const cc = circle.center;\n    // vector in the direction of the edge\n    const e = edge.end.sub(edge.begin);\n\n    // amount of overlap with the circle's center along the edge direction\n    const u = e.dot(edge.end.sub(cc));\n    const v = e.dot(cc.sub(edge.begin));\n\n    // Potential region A collision (circle is on the left side of the edge, before the beginning)\n    if (v <= 0) {\n      const da = edge.begin.sub(cc);\n      const dda = da.dot(da); // quick and dirty way of calc'n distance in r^2 terms saves some sqrts\n      // save some sqrts\n      if (dda > circle.radius * circle.radius) {\n        return null; // no collision\n      }\n      return new CollisionContact(\n        circle.collider,\n        edge.collider,\n        da.normalize().scale(circle.radius - Math.sqrt(dda)),\n        edge.begin,\n        da.normalize()\n      );\n    }\n\n    // Potential region B collision (circle is on the right side of the edge, after the end)\n    if (u <= 0) {\n      const db = edge.end.sub(cc);\n      const ddb = db.dot(db);\n      if (ddb > circle.radius * circle.radius) {\n        return null;\n      }\n      return new CollisionContact(\n        circle.collider,\n        edge.collider,\n        db.normalize().scale(circle.radius - Math.sqrt(ddb)),\n        edge.end,\n        db.normalize()\n      );\n    }\n\n    // Otherwise potential region AB collision (circle is in the middle of the edge between the beginning and end)\n    const den = e.dot(e);\n    const pointOnEdge = edge.begin\n      .scale(u)\n      .add(edge.end.scale(v))\n      .scale(1 / den);\n    const d = cc.sub(pointOnEdge);\n\n    const dd = d.dot(d);\n    if (dd > circle.radius * circle.radius) {\n      return null; // no collision\n    }\n\n    let n = e.perpendicular();\n    // flip correct direction\n    if (n.dot(cc.sub(edge.begin)) < 0) {\n      n.x = -n.x;\n      n.y = -n.y;\n    }\n\n    n = n.normalize();\n\n    const mvt = n.scale(Math.abs(circle.radius - Math.sqrt(dd)));\n    return new CollisionContact(circle.collider, edge.collider, mvt.negate(), pointOnEdge, n.negate());\n  },\n\n  CollideEdgeEdge(): CollisionContact {\n    // Edge-edge collision doesn't make sense\n    return null;\n  },\n\n  CollidePolygonEdge(polygon: ConvexPolygon, edge: Edge): CollisionContact {\n    // 3 cases:\n    // (1) Polygon lands on the full face\n    // (2) Polygon lands on the right point\n    // (3) Polygon lands on the left point\n\n    const e = edge.end.sub(edge.begin);\n    let edgeNormal = e.normal();\n\n    if (polygon.contains(edge.begin)) {\n      const { distance: mtv, face } = polygon.getClosestFace(edge.begin);\n      if (mtv) {\n        return new CollisionContact(polygon.collider, edge.collider, mtv.negate(), edge.begin.add(mtv.negate()), face.normal().negate());\n      }\n    }\n\n    if (polygon.contains(edge.end)) {\n      const { distance: mtv, face } = polygon.getClosestFace(edge.end);\n      if (mtv) {\n        return new CollisionContact(polygon.collider, edge.collider, mtv.negate(), edge.end.add(mtv.negate()), face.normal().negate());\n      }\n    }\n\n    const pc = polygon.center;\n    const ec = edge.center;\n    const dir = ec.sub(pc).normalize();\n\n    // build a temporary polygon from the edge to use SAT\n    const linePoly = new ConvexPolygon({\n      collider: edge.collider,\n      points: [edge.begin, edge.end, edge.end.add(dir.scale(30)), edge.begin.add(dir.scale(30))]\n    });\n\n    let minAxis = polygon.testSeparatingAxisTheorem(linePoly);\n\n    // no minAxis, no overlap, no collision\n    if (!minAxis) {\n      return null;\n    }\n\n    // flip the normal and axis to always have positive collisions\n    edgeNormal = edgeNormal.dot(dir) < 0 ? edgeNormal.negate() : edgeNormal;\n    minAxis = minAxis.dot(dir) < 0 ? minAxis.negate() : minAxis;\n\n    return new CollisionContact(polygon.collider, edge.collider, minAxis, polygon.getFurthestPoint(edgeNormal), edgeNormal);\n  },\n\n  CollidePolygonPolygon(polyA: ConvexPolygon, polyB: ConvexPolygon): CollisionContact {\n    // do a SAT test to find a min axis if it exists\n    let minAxis = polyA.testSeparatingAxisTheorem(polyB);\n\n    // no overlap, no collision return null\n    if (!minAxis) {\n      return null;\n    }\n\n    // make sure that minAxis is pointing from A -> B\n    const sameDir = minAxis.dot(polyB.center.sub(polyA.center));\n    minAxis = sameDir < 0 ? minAxis.negate() : minAxis;\n\n    // find rough point of collision\n    // todo this could be better\n    const verts: Vector[] = [];\n    const pointA = polyA.getFurthestPoint(minAxis);\n    const pointB = polyB.getFurthestPoint(minAxis.negate());\n\n    if (polyB.contains(pointA)) {\n      verts.push(pointA);\n    }\n\n    if (polyA.contains(pointB)) {\n      verts.push(pointB);\n    }\n    // no candidates, pick something\n    if (verts.length === 0) {\n      verts.push(pointB);\n    }\n\n    const contact = verts.length === 2 ? verts[0].add(verts[1]).scale(0.5) : verts[0];\n\n    return new CollisionContact(polyA.collider, polyB.collider, minAxis, contact, minAxis.normalize());\n  }\n};\n","import { BoundingBox } from './BoundingBox';\nimport { CollisionJumpTable } from './CollisionJumpTable';\nimport { CollisionContact } from './CollisionContact';\nimport { CollisionShape } from './CollisionShape';\nimport { ConvexPolygon } from './ConvexPolygon';\nimport { Edge } from './Edge';\n\nimport { Vector, Ray, Projection } from '../Algebra';\nimport { Physics } from '../Physics';\nimport { Color } from '../Drawing/Color';\nimport { Collider } from './Collider';\n\n// @obsolete Remove in v0.24.0\nimport { Body } from './Body';\n// ===========================\n\nexport interface CircleOptions {\n  /**\n   * Optional pixel offset to shift the circle relative to the collider, by default (0, 0).\n   */\n  offset?: Vector;\n  /**\n   * Required radius of the circle\n   */\n  radius: number;\n  /**\n   * Optional collider to associate with this shape\n   */\n  collider?: Collider;\n\n  // @obsolete Will be removed in v0.24.0 please use [[collider]] to set and retrieve body information\n  body?: Body;\n}\n\n/**\n * This is a circle collision shape for the excalibur rigid body physics simulation\n *\n * Example:\n * [[include:CircleShape.md]]\n */\nexport class Circle implements CollisionShape {\n  /**\n   * Position of the circle relative to the collider, by default (0, 0) meaning the shape is positioned on top of the collider.\n   */\n  public offset: Vector = Vector.Zero;\n\n  public get worldPos(): Vector {\n    if (this.collider && this.collider.body) {\n      return this.collider.body.pos.add(this.offset);\n    }\n    return this.offset;\n  }\n\n  /**\n   * This is the radius of the circle\n   */\n  public radius: number;\n\n  /**\n   * Reference to the actor associated with this collision shape\n   * @obsolete Will be removed in v0.24.0 please use [[collider]] to retrieve body information\n   */\n  public body: Body;\n\n  /**\n   * The collider associated for this shape, if any.\n   */\n  public collider?: Collider;\n\n  constructor(options: CircleOptions) {\n    this.offset = options.offset || Vector.Zero;\n    this.radius = options.radius || 0;\n    this.collider = options.collider || null;\n\n    // @obsolete Remove next release in v0.24.0, code exists for backwards compat\n    if (options.body) {\n      this.collider = options.body.collider;\n      this.body = this.collider.body;\n    }\n    // ==================================\n  }\n\n  /**\n   * Returns a clone of this shape, not associated with any collider\n   */\n  public clone(): Circle {\n    return new Circle({\n      offset: this.offset.clone(),\n      radius: this.radius,\n      collider: null,\n      body: null\n    });\n  }\n\n  /**\n   * Get the center of the collision shape in world coordinates\n   */\n  public get center(): Vector {\n    if (this.collider && this.collider.body) {\n      return this.offset.add(this.collider.body.pos);\n    }\n    return this.offset;\n  }\n\n  /**\n   * Tests if a point is contained in this collision shape\n   */\n  public contains(point: Vector): boolean {\n    let pos = this.offset;\n    if (this.collider && this.collider.body) {\n      pos = this.collider.body.pos;\n    }\n    const distance = pos.distance(point);\n    if (distance <= this.radius) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Casts a ray at the Circl shape and returns the nearest point of collision\n   * @param ray\n   */\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\n    //https://en.wikipedia.org/wiki/Line%E2%80%93sphere_intersection\n    const c = this.center;\n    const dir = ray.dir;\n    const orig = ray.pos;\n\n    const discriminant = Math.sqrt(Math.pow(dir.dot(orig.sub(c)), 2) - Math.pow(orig.sub(c).distance(), 2) + Math.pow(this.radius, 2));\n\n    if (discriminant < 0) {\n      // no intersection\n      return null;\n    } else {\n      let toi = 0;\n      if (discriminant === 0) {\n        toi = -dir.dot(orig.sub(c));\n        if (toi > 0 && toi < max) {\n          return ray.getPoint(toi);\n        }\n        return null;\n      } else {\n        const toi1 = -dir.dot(orig.sub(c)) + discriminant;\n        const toi2 = -dir.dot(orig.sub(c)) - discriminant;\n\n        const mintoi = Math.min(toi1, toi2);\n        if (mintoi <= max) {\n          return ray.getPoint(mintoi);\n        }\n        return null;\n      }\n    }\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public collide(shape: CollisionShape): CollisionContact {\n    if (shape instanceof Circle) {\n      return CollisionJumpTable.CollideCircleCircle(this, shape);\n    } else if (shape instanceof ConvexPolygon) {\n      return CollisionJumpTable.CollideCirclePolygon(this, shape);\n    } else if (shape instanceof Edge) {\n      return CollisionJumpTable.CollideCircleEdge(this, shape);\n    } else {\n      throw new Error(`Circle could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * Find the point on the shape furthest in the direction specified\n   */\n  public getFurthestPoint(direction: Vector): Vector {\n    return this.center.add(direction.normalize().scale(this.radius));\n  }\n\n  /**\n   * Get the axis aligned bounding box for the circle shape in world coordinates\n   */\n  public get bounds(): BoundingBox {\n    let bodyPos = Vector.Zero;\n    if (this.collider && this.collider.body) {\n      bodyPos = this.collider.body.pos;\n    }\n    return new BoundingBox(\n      this.offset.x + bodyPos.x - this.radius,\n      this.offset.y + bodyPos.y - this.radius,\n      this.offset.x + bodyPos.x + this.radius,\n      this.offset.y + bodyPos.y + this.radius\n    );\n  }\n\n  /**\n   * Get the axis aligned bounding box for the circle shape in local coordinates\n   */\n  public get localBounds(): BoundingBox {\n    return new BoundingBox(\n      this.offset.x - this.radius,\n      this.offset.y - this.radius,\n      this.offset.x + this.radius,\n      this.offset.y + this.radius\n    );\n  }\n\n  /**\n   * Get axis not implemented on circles, since there are infinite axis in a circle\n   */\n  public get axes(): Vector[] {\n    return null;\n  }\n\n  /**\n   * Returns the moment of inertia of a circle given it's mass\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n   */\n  public get inertia(): number {\n    const mass = this.collider ? this.collider.mass : Physics.defaultMass;\n    return (mass * this.radius * this.radius) / 2;\n  }\n\n  /**\n   * Tests the separating axis theorem for circles against polygons\n   */\n  public testSeparatingAxisTheorem(polygon: ConvexPolygon): Vector {\n    const axes = polygon.axes;\n    const pc = polygon.center;\n    // Special SAT with circles\n    const closestPointOnPoly = polygon.getFurthestPoint(this.offset.sub(pc));\n    axes.push(this.offset.sub(closestPointOnPoly).normalize());\n\n    let minOverlap = Number.MAX_VALUE;\n    let minAxis = null;\n    let minIndex = -1;\n    for (let i = 0; i < axes.length; i++) {\n      const proj1 = polygon.project(axes[i]);\n      const proj2 = this.project(axes[i]);\n      const overlap = proj1.getOverlap(proj2);\n      if (overlap <= 0) {\n        return null;\n      } else {\n        if (overlap < minOverlap) {\n          minOverlap = overlap;\n          minAxis = axes[i];\n          minIndex = i;\n        }\n      }\n    }\n    if (minIndex < 0) {\n      return null;\n    }\n    return minAxis.normalize().scale(minOverlap);\n  }\n\n  /* istanbul ignore next */\n  public recalc(): void {\n    // circles don't cache\n  }\n\n  /**\n   * Project the circle along a specified axis\n   */\n  public project(axis: Vector): Projection {\n    const scalars = [];\n    const point = this.center;\n    const dotProduct = point.dot(axis);\n    scalars.push(dotProduct);\n    scalars.push(dotProduct + this.radius);\n    scalars.push(dotProduct - this.radius);\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\n    const newPos = pos.add(this.offset);\n    ctx.beginPath();\n    ctx.fillStyle = color.toString();\n    ctx.arc(newPos.x, newPos.y, this.radius, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Green) {\n    const body = this.collider.body;\n    const pos = body ? body.pos.add(this.offset) : this.offset;\n    const rotation = body ? body.rotation : 0;\n\n    ctx.beginPath();\n    ctx.strokeStyle = color.toString();\n    ctx.arc(pos.x, pos.y, this.radius, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.stroke();\n    ctx.beginPath();\n    ctx.moveTo(pos.x, pos.y);\n    ctx.lineTo(Math.cos(rotation) * this.radius + pos.x, Math.sin(rotation) * this.radius + pos.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n}\n\n/**\n * @obsolete Use [[CircleOptions]], CircleAreaOptions will be removed in v0.24.0\n */\nexport interface CircleAreaOptions extends CircleOptions {}\n\n/**\n * @obsolete Use [[Circle]], CircleArea will be removed in v0.24.0\n */\nexport class CircleArea extends Circle {}\n","import { Body } from './Body';\nimport { BoundingBox } from './BoundingBox';\nimport { CollisionContact } from './CollisionContact';\nimport { CollisionJumpTable } from './CollisionJumpTable';\nimport { CollisionShape } from './CollisionShape';\nimport { Circle } from './Circle';\nimport { ConvexPolygon } from './ConvexPolygon';\n\nimport { Vector, Ray, Projection } from '../Algebra';\nimport { Physics } from '../Physics';\nimport { Color } from '../Drawing/Color';\nimport { Collider } from './Collider';\n\nexport interface EdgeOptions {\n  /**\n   * The beginning of the edge defined in local coordinates to the collider\n   */\n  begin: Vector;\n  /**\n   * The ending of the edge defined in local coordinates to the collider\n   */\n  end: Vector;\n  /**\n   * Optionally the collider associated with this edge\n   */\n  collider?: Collider;\n\n  // @obsolete Will be removed in v0.24.0 please use [[collider]] to set and retrieve body information\n  body?: Body;\n}\n\n/**\n * Edge is a single line collision shape to create collisions with a single line.\n *\n * Example:\n * [[include:EdgeShape.md]]\n */\nexport class Edge implements CollisionShape {\n  body: Body;\n  collider?: Collider;\n  offset: Vector;\n  begin: Vector;\n  end: Vector;\n\n  constructor(options: EdgeOptions) {\n    this.begin = options.begin || Vector.Zero;\n    this.end = options.end || Vector.Zero;\n    this.collider = options.collider || null;\n    this.offset = this.center;\n\n    // @obsolete Remove next release in v0.24.0, code exists for backwards compat\n    if (options.body) {\n      this.collider = options.body.collider;\n      this.body = this.collider.body;\n    }\n    // ==================================\n  }\n\n  /**\n   * Returns a clone of this Edge, not associated with any collider\n   */\n  public clone(): Edge {\n    return new Edge({\n      begin: this.begin.clone(),\n      end: this.end.clone(),\n      collider: null,\n      body: null\n    });\n  }\n\n  public get worldPos(): Vector {\n    if (this.collider && this.collider.body) {\n      return this.collider.body.pos.add(this.offset);\n    }\n    return this.offset;\n  }\n\n  /**\n   * Get the center of the collision area in world coordinates\n   */\n  public get center(): Vector {\n    const pos = this.begin.average(this.end).add(this._getBodyPos());\n    return pos;\n  }\n\n  private _getBodyPos(): Vector {\n    let bodyPos = Vector.Zero;\n    if (this.collider && this.collider.body) {\n      bodyPos = this.collider.body.pos;\n    }\n    return bodyPos;\n  }\n\n  private _getTransformedBegin(): Vector {\n    const body = this.collider ? this.collider.body : null;\n    const angle = body ? body.rotation : 0;\n    return this.begin.rotate(angle).add(this._getBodyPos());\n  }\n\n  private _getTransformedEnd(): Vector {\n    const body = this.collider ? this.collider.body : null;\n    const angle = body ? body.rotation : 0;\n    return this.end.rotate(angle).add(this._getBodyPos());\n  }\n\n  /**\n   * Returns the slope of the line in the form of a vector\n   */\n  public getSlope(): Vector {\n    const begin = this._getTransformedBegin();\n    const end = this._getTransformedEnd();\n    const distance = begin.distance(end);\n    return end.sub(begin).scale(1 / distance);\n  }\n\n  /**\n   * Returns the length of the line segment in pixels\n   */\n  public getLength(): number {\n    const begin = this._getTransformedBegin();\n    const end = this._getTransformedEnd();\n    const distance = begin.distance(end);\n    return distance;\n  }\n\n  /**\n   * Tests if a point is contained in this collision area\n   */\n  public contains(): boolean {\n    return false;\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\n    const numerator = this._getTransformedBegin().sub(ray.pos);\n\n    // Test is line and ray are parallel and non intersecting\n    if (ray.dir.cross(this.getSlope()) === 0 && numerator.cross(ray.dir) !== 0) {\n      return null;\n    }\n\n    // Lines are parallel\n    const divisor = ray.dir.cross(this.getSlope());\n    if (divisor === 0) {\n      return null;\n    }\n\n    const t = numerator.cross(this.getSlope()) / divisor;\n\n    if (t >= 0 && t <= max) {\n      const u = numerator.cross(ray.dir) / divisor / this.getLength();\n      if (u >= 0 && u <= 1) {\n        return ray.getPoint(t);\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public collide(shape: CollisionShape): CollisionContact {\n    if (shape instanceof Circle) {\n      return CollisionJumpTable.CollideCircleEdge(shape, this);\n    } else if (shape instanceof ConvexPolygon) {\n      return CollisionJumpTable.CollidePolygonEdge(shape, this);\n    } else if (shape instanceof Edge) {\n      return CollisionJumpTable.CollideEdgeEdge();\n    } else {\n      throw new Error(`Edge could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * Find the point on the shape furthest in the direction specified\n   */\n  public getFurthestPoint(direction: Vector): Vector {\n    const transformedBegin = this._getTransformedBegin();\n    const transformedEnd = this._getTransformedEnd();\n    if (direction.dot(transformedBegin) > 0) {\n      return transformedBegin;\n    } else {\n      return transformedEnd;\n    }\n  }\n\n  private _boundsFromBeginEnd(begin: Vector, end: Vector) {\n    return new BoundingBox(Math.min(begin.x, end.x), Math.min(begin.y, end.y), Math.max(begin.x, end.x), Math.max(begin.y, end.y));\n  }\n\n  /**\n   * Get the axis aligned bounding box for the edge shape in world space\n   */\n  public get bounds(): BoundingBox {\n    const transformedBegin = this._getTransformedBegin();\n    const transformedEnd = this._getTransformedEnd();\n    return this._boundsFromBeginEnd(transformedBegin, transformedEnd);\n  }\n\n  public get localBounds(): BoundingBox {\n    return this._boundsFromBeginEnd(this.begin, this.end);\n  }\n\n  /**\n   * Get the axis associated with the edge\n   */\n  public get axes(): Vector[] {\n    const e = this._getTransformedEnd().sub(this._getTransformedBegin());\n    const edgeNormal = e.normal();\n\n    const axes = [];\n    axes.push(edgeNormal);\n    axes.push(edgeNormal.negate());\n    axes.push(edgeNormal.normal());\n    axes.push(edgeNormal.normal().negate());\n    return axes;\n  }\n\n  /**\n   * Get the moment of inertia for an edge\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n   */\n  public get inertia(): number {\n    const mass = this.collider ? this.collider.mass : Physics.defaultMass;\n    const length = this.end.sub(this.begin).distance() / 2;\n    return mass * length * length;\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public recalc(): void {\n    // edges don't have any cached data\n  }\n\n  /**\n   * Project the edge along a specified axis\n   */\n  public project(axis: Vector): Projection {\n    const scalars = [];\n\n    const points = [this._getTransformedBegin(), this._getTransformedEnd()];\n    const len = points.length;\n    for (let i = 0; i < len; i++) {\n      scalars.push(points[i].dot(axis));\n    }\n\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\n    const begin = this.begin.add(pos);\n    const end = this.end.add(pos);\n    ctx.strokeStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(begin.x, begin.y);\n    ctx.lineTo(end.x, end.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Red) {\n    ctx.strokeStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(this.begin.x, this.begin.y);\n    ctx.lineTo(this.end.x, this.end.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n}\n\n/**\n * @obsolete Use [[EdgeOptions]], EdgeAreaOptions will be removed in v0.24.0\n */\nexport interface EdgeAreaOptions extends EdgeOptions {}\n\n/**\n * @obsolete Use [[Edge]], EdgeArea will be removed in v0.24.0\n */\nexport class EdgeArea extends Edge {}\n","import { Color } from '../Drawing/Color';\nimport { Physics } from '../Physics';\nimport { BoundingBox } from './BoundingBox';\nimport { Edge } from './Edge';\nimport { CollisionJumpTable } from './CollisionJumpTable';\nimport { Circle } from './Circle';\nimport { CollisionContact } from './CollisionContact';\nimport { CollisionShape } from './CollisionShape';\nimport { Body } from './Body';\nimport { Vector, Line, Ray, Projection } from '../Algebra';\nimport { Collider } from './Collider';\n\nexport interface ConvexPolygonOptions {\n  /**\n   * Pixel offset relative to a collider's position\n   */\n\n  offset?: Vector;\n  /**\n   * Points in the polygon in order around the perimeter in local coordinates\n   */\n  points: Vector[];\n  /**\n   * Whether points are specified in clockwise or counter clockwise order, default counter-clockwise\n   */\n  clockwiseWinding?: boolean;\n  /**\n   * Collider to associate optionally with this shape\n   */\n  collider?: Collider;\n  /**\n   * @obsolete Will be removed in v0.24.0 please use [[collider]] to set and retrieve body information\n   */\n\n  body?: Body;\n}\n\n/**\n * Polygon collision shape for detecting collisions\n *\n * Example:\n * [[include:BoxAndPolygonShape.md]]\n */\nexport class ConvexPolygon implements CollisionShape {\n  public offset: Vector;\n  public points: Vector[];\n\n  /**\n   * @obsolete Will be removed in v0.24.0 please use [[collider]] to set and retrieve body information\n   */\n  public body: Body;\n\n  /**\n   * Collider associated with this shape\n   */\n  public collider?: Collider;\n\n  private _transformedPoints: Vector[] = [];\n  private _axes: Vector[] = [];\n  private _sides: Line[] = [];\n\n  constructor(options: ConvexPolygonOptions) {\n    this.offset = options.offset || Vector.Zero;\n    const winding = !!options.clockwiseWinding;\n    this.points = (winding ? options.points.reverse() : options.points) || [];\n    this.collider = this.collider = options.collider || null;\n\n    // @obsolete Remove next release in v0.24.0, code exists for backwards compat\n    if (options.body) {\n      this.collider = options.body.collider;\n      this.body = this.collider.body;\n    }\n    // ==================================\n\n    // calculate initial transformation\n    this._calculateTransformation();\n  }\n\n  /**\n   * Returns a clone of this ConvexPolygon, not associated with any collider\n   */\n  public clone(): ConvexPolygon {\n    return new ConvexPolygon({\n      offset: this.offset.clone(),\n      points: this.points.map((p) => p.clone()),\n      collider: null,\n      body: null\n    });\n  }\n\n  public get worldPos(): Vector {\n    if (this.collider && this.collider.body) {\n      return this.collider.body.pos.add(this.offset);\n    }\n    return this.offset;\n  }\n\n  /**\n   * Get the center of the collision shape in world coordinates\n   */\n  public get center(): Vector {\n    const body = this.collider ? this.collider.body : null;\n    if (body) {\n      return body.pos.add(this.offset);\n    }\n    return this.offset;\n  }\n\n  /**\n   * Calculates the underlying transformation from the body relative space to world space\n   */\n  private _calculateTransformation() {\n    const body = this.collider ? this.collider.body : null;\n    const pos = body ? body.pos.add(this.offset) : this.offset;\n    const angle = body ? body.rotation : 0;\n    const scale = body ? body.scale : Vector.One;\n\n    const len = this.points.length;\n    this._transformedPoints.length = 0; // clear out old transform\n    for (let i = 0; i < len; i++) {\n      this._transformedPoints[i] = this.points[i]\n        .scale(scale)\n        .rotate(angle)\n        .add(pos);\n    }\n  }\n\n  /**\n   * Gets the points that make up the polygon in world space, from actor relative space (if specified)\n   */\n  public getTransformedPoints(): Vector[] {\n    // only recalculate geometry if, hasn't been calculated\n    if (\n      !this._transformedPoints.length ||\n      // or the position or rotation has changed in world space\n      (this.collider &&\n        this.collider.body &&\n        (!this.collider.body.oldPos.equals(this.collider.body.pos) ||\n          this.collider.body.oldRotation !== this.collider.body.rotation ||\n          this.collider.body.oldScale !== this.collider.body.scale))\n    ) {\n      this._calculateTransformation();\n    }\n    return this._transformedPoints;\n  }\n\n  /**\n   * Gets the sides of the polygon in world space\n   */\n  public getSides(): Line[] {\n    if (this._sides.length) {\n      return this._sides;\n    }\n    const lines = [];\n    const points = this.getTransformedPoints();\n    const len = points.length;\n    for (let i = 0; i < len; i++) {\n      lines.push(new Line(points[i], points[(i - 1 + len) % len]));\n    }\n    this._sides = lines;\n    return this._sides;\n  }\n\n  public recalc(): void {\n    this._sides.length = 0;\n    this._axes.length = 0;\n    this._transformedPoints.length = 0;\n    this.getTransformedPoints();\n    this.getSides();\n  }\n\n  /**\n   * Tests if a point is contained in this collision shape in world space\n   */\n  public contains(point: Vector): boolean {\n    // Always cast to the right, as long as we cast in a consitent fixed direction we\n    // will be fine\n    const testRay = new Ray(point, new Vector(1, 0));\n    const intersectCount = this.getSides().reduce(function(accum, side) {\n      if (testRay.intersect(side) >= 0) {\n        return accum + 1;\n      }\n      return accum;\n    }, 0);\n\n    if (intersectCount % 2 === 0) {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * Returns a collision contact if the 2 collision shapes collide, otherwise collide will\n   * return null.\n   * @param shape\n   */\n  public collide(shape: CollisionShape): CollisionContact {\n    if (shape instanceof Circle) {\n      return CollisionJumpTable.CollideCirclePolygon(shape, this);\n    } else if (shape instanceof ConvexPolygon) {\n      return CollisionJumpTable.CollidePolygonPolygon(this, shape);\n    } else if (shape instanceof Edge) {\n      return CollisionJumpTable.CollidePolygonEdge(this, shape);\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * Find the point on the shape furthest in the direction specified\n   */\n  public getFurthestPoint(direction: Vector): Vector {\n    const pts = this.getTransformedPoints();\n    let furthestPoint = null;\n    let maxDistance = -Number.MAX_VALUE;\n    for (let i = 0; i < pts.length; i++) {\n      const distance = direction.dot(pts[i]);\n      if (distance > maxDistance) {\n        maxDistance = distance;\n        furthestPoint = pts[i];\n      }\n    }\n    return furthestPoint;\n  }\n\n  /**\n   * Finds the closes face to the point using perpendicular distance\n   * @param point point to test against polygon\n   */\n  public getClosestFace(point: Vector): { distance: Vector; face: Line } {\n    const sides = this.getSides();\n    let min = Number.POSITIVE_INFINITY;\n    let faceIndex = -1;\n    let distance = -1;\n    for (let i = 0; i < sides.length; i++) {\n      const dist = sides[i].distanceToPoint(point);\n      if (dist < min) {\n        min = dist;\n        faceIndex = i;\n        distance = dist;\n      }\n    }\n\n    if (faceIndex !== -1) {\n      return {\n        distance: sides[faceIndex].normal().scale(distance),\n        face: sides[faceIndex]\n      };\n    }\n\n    return null;\n  }\n\n  /**\n   * Get the axis aligned bounding box for the polygon shape in world coordinates\n   */\n  public get bounds(): BoundingBox {\n    const points = this.getTransformedPoints();\n\n    return BoundingBox.fromPoints(points);\n  }\n\n  /**\n   * Get the axis aligned bounding box for the polygon shape in local coordinates\n   */\n  public get localBounds(): BoundingBox {\n    return BoundingBox.fromPoints(this.points);\n  }\n\n  /**\n   * Get the moment of inertia for an arbitrary polygon\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n   */\n  public get inertia(): number {\n    const mass = this.collider ? this.collider.mass : Physics.defaultMass;\n    let numerator = 0;\n    let denominator = 0;\n    for (let i = 0; i < this.points.length; i++) {\n      const iplusone = (i + 1) % this.points.length;\n      const crossTerm = this.points[iplusone].cross(this.points[i]);\n      numerator +=\n        crossTerm *\n        (this.points[i].dot(this.points[i]) + this.points[i].dot(this.points[iplusone]) + this.points[iplusone].dot(this.points[iplusone]));\n      denominator += crossTerm;\n    }\n    return (mass / 6) * (numerator / denominator);\n  }\n\n  /**\n   * Casts a ray into the polygon and returns a vector representing the point of contact (in world space) or null if no collision.\n   */\n  public rayCast(ray: Ray, max: number = Infinity) {\n    // find the minimum contact time greater than 0\n    // contact times less than 0 are behind the ray and we don't want those\n    const sides = this.getSides();\n    const len = sides.length;\n    let minContactTime = Number.MAX_VALUE;\n    let contactIndex = -1;\n    for (let i = 0; i < len; i++) {\n      const contactTime = ray.intersect(sides[i]);\n      if (contactTime >= 0 && contactTime < minContactTime && contactTime <= max) {\n        minContactTime = contactTime;\n        contactIndex = i;\n      }\n    }\n\n    // contact was found\n    if (contactIndex >= 0) {\n      return ray.getPoint(minContactTime);\n    }\n\n    // no contact found\n    return null;\n  }\n\n  /**\n   * Get the axis associated with the convex polygon\n   */\n  public get axes(): Vector[] {\n    if (this._axes.length) {\n      return this._axes;\n    }\n\n    const axes = [];\n    const points = this.getTransformedPoints();\n    const len = points.length;\n    for (let i = 0; i < len; i++) {\n      axes.push(points[i].sub(points[(i + 1) % len]).normal());\n    }\n    this._axes = axes;\n    return this._axes;\n  }\n\n  /**\n   * Perform Separating Axis test against another polygon, returns null if no overlap in polys\n   * Reference http://www.dyn4j.org/2010/01/sat/\n   */\n  public testSeparatingAxisTheorem(other: ConvexPolygon): Vector {\n    const poly1 = this;\n    const poly2 = other;\n    const axes = poly1.axes.concat(poly2.axes);\n\n    let minOverlap = Number.MAX_VALUE;\n    let minAxis = null;\n    let minIndex = -1;\n    for (let i = 0; i < axes.length; i++) {\n      const proj1 = poly1.project(axes[i]);\n      const proj2 = poly2.project(axes[i]);\n      const overlap = proj1.getOverlap(proj2);\n      if (overlap <= 0) {\n        return null;\n      } else {\n        if (overlap < minOverlap) {\n          minOverlap = overlap;\n          minAxis = axes[i];\n          minIndex = i;\n        }\n      }\n    }\n\n    // Sanity check\n    if (minIndex === -1) {\n      return null;\n    }\n\n    return minAxis.normalize().scale(minOverlap);\n  }\n\n  /**\n   * Project the edges of the polygon along a specified axis\n   */\n  public project(axis: Vector): Projection {\n    const points = this.getTransformedPoints();\n    const len = points.length;\n    let min = Number.MAX_VALUE;\n    let max = -Number.MAX_VALUE;\n    for (let i = 0; i < len; i++) {\n      const scalar = points[i].dot(axis);\n      min = Math.min(min, scalar);\n      max = Math.max(max, scalar);\n    }\n\n    return new Projection(min, max);\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\n    ctx.beginPath();\n    ctx.fillStyle = color.toString();\n    const newPos = pos.add(this.offset);\n    // Iterate through the supplied points and construct a 'polygon'\n    const firstPoint = this.points[0].add(newPos);\n    ctx.moveTo(firstPoint.x, firstPoint.y);\n    this.points.map((p) => p.add(newPos)).forEach(function(point) {\n      ctx.lineTo(point.x, point.y);\n    });\n    ctx.lineTo(firstPoint.x, firstPoint.y);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Red) {\n    ctx.beginPath();\n    ctx.strokeStyle = color.toString();\n    // Iterate through the supplied points and construct a 'polygon'\n    const firstPoint = this.getTransformedPoints()[0];\n    ctx.moveTo(firstPoint.x, firstPoint.y);\n    this.getTransformedPoints().forEach(function(point) {\n      ctx.lineTo(point.x, point.y);\n    });\n    ctx.lineTo(firstPoint.x, firstPoint.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n}\n\n/**\n * @obsolete Use [[ConvexPolygonOptions]], PolygonAreaOptions will be removed in v0.24.0\n */\nexport interface PolygonAreaOptions extends ConvexPolygonOptions {}\nexport class PolygonArea extends ConvexPolygon {}\n","import { Logger } from './Log';\nimport * as Util from './Util';\n\n/**\n * Obsolete decorator options\n */\nexport interface ObsoleteOptions {\n  // Optionally specify a custom message\n  message?: string;\n  // Optionally indicate that an alternate method to the obsolete one exists\n  alternateMethod?: string;\n}\n\n/**\n * Obsolete decorator for marking Excalibur methods obsolete, you can optionally specify a custom message and/or alternate replacement\n * method do the deprecated one. Inspired by https://github.com/jayphelps/core-decorators.js\n */\nexport function obsolete(options?: ObsoleteOptions): any {\n  options = Util.extend({}, { message: 'This feature will be removed in future versions of Excalibur.', alternateMethod: null }, options);\n\n  return function(target: any, property: string, descriptor: PropertyDescriptor): any {\n    if (\n      descriptor &&\n      !(typeof descriptor.value === 'function' || typeof descriptor.get === 'function' || typeof descriptor.set === 'function')\n    ) {\n      throw new SyntaxError('Only classes/functions/getters/setters can be marked as obsolete');\n    }\n    const methodSignature = `${target.name || ''}${target.name && property ? '.' : ''}${property ? property : ''}`;\n\n    const message =\n      `${methodSignature} is marked obsolete: ${options.message}` +\n      (options.alternateMethod ? ` Use ${options.alternateMethod} instead` : '');\n\n    // If descriptor is null it is a class\n    const method = descriptor ? { ...descriptor } : target;\n    if (!descriptor) {\n      const constructor = function() {\n        const args = Array.prototype.slice.call(arguments);\n        Logger.getInstance().warn(message);\n        // tslint:disable-next-line: no-console\n        if (console.trace) {\n          // tslint:disable-next-line: no-console\n          console.trace();\n        }\n        return new method(...args);\n      };\n      constructor.prototype = method.prototype;\n      return constructor;\n    }\n\n    if (descriptor && descriptor.value) {\n      method.value = function(this: any) {\n        Logger.getInstance().warn(message);\n        // tslint:disable-next-line: no-console\n        if (console.trace) {\n          // tslint:disable-next-line: no-console\n          console.trace();\n        }\n        return descriptor.value.apply(this, arguments);\n      };\n      return method;\n    }\n\n    if (descriptor && descriptor.get) {\n      method.get = function(this: any) {\n        Logger.getInstance().warn(message);\n        // tslint:disable-next-line: no-console\n        if (console.trace) {\n          // tslint:disable-next-line: no-console\n          console.trace();\n        }\n        return descriptor.get.apply(this, arguments);\n      };\n    }\n\n    if (descriptor && descriptor.set) {\n      method.set = function(this: any) {\n        Logger.getInstance().warn(message);\n        return descriptor.set.apply(this, arguments);\n      };\n    }\n    return method;\n  };\n}\n","import { ConvexPolygon } from './ConvexPolygon';\n\nimport { Actor } from '../Actor';\nimport { Vector, Ray } from '../Algebra';\nimport { Color } from '../Drawing/Color';\nimport { obsolete } from '../Util/Decorators';\nimport { Side } from './Side';\n\n/**\n * Axis Aligned collision primitive for Excalibur.\n */\nexport class BoundingBox {\n  /**\n   * @param left    x coordinate of the left edge\n   * @param top     y coordinate of the top edge\n   * @param right   x coordinate of the right edge\n   * @param bottom  y coordinate of the bottom edge\n   */\n  constructor(public left: number = 0, public top: number = 0, public right: number = 0, public bottom: number = 0) {}\n\n  /**\n   * Given bounding box A & B, returns the side relative to A when intersection is performed.\n   * @param intersection Intersection vector between 2 bounding boxes\n   */\n  public static getSideFromIntersection(intersection: Vector): Side {\n    if (!intersection) {\n      return Side.None;\n    }\n    if (intersection) {\n      if (Math.abs(intersection.x) > Math.abs(intersection.y)) {\n        if (intersection.x < 0) {\n          return Side.Right;\n        }\n        return Side.Left;\n      } else {\n        if (intersection.y < 0) {\n          return Side.Bottom;\n        }\n        return Side.Top;\n      }\n    }\n    return Side.None;\n  }\n\n  public static fromPoints(points: Vector[]): BoundingBox {\n    let minX = Infinity;\n    let minY = Infinity;\n    let maxX = -Infinity;\n    let maxY = -Infinity;\n    for (let i = 0; i < points.length; i++) {\n      if (points[i].x < minX) {\n        minX = points[i].x;\n      }\n      if (points[i].x > maxX) {\n        maxX = points[i].x;\n      }\n      if (points[i].y < minY) {\n        minY = points[i].y;\n      }\n      if (points[i].y > maxY) {\n        maxY = points[i].y;\n      }\n    }\n    return new BoundingBox(minX, minY, maxX, maxY);\n  }\n\n  public static fromDimension(width: number, height: number, anchor: Vector = Vector.Half, pos: Vector = Vector.Zero) {\n    return new BoundingBox(\n      -width * anchor.x + pos.x,\n      -height * anchor.y + pos.y,\n      width - width * anchor.x + pos.x,\n      height - height * anchor.y + pos.y\n    );\n  }\n\n  /**\n   * Returns the calculated width of the bounding box\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'BoundingBox.width' })\n  public getWidth() {\n    return this.width;\n  }\n\n  /**\n   * Returns the calculated width of the bounding box\n   */\n  public get width() {\n    return this.right - this.left;\n  }\n\n  /**\n   * Returns the calculated height of the bounding box\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'BoundingBox.height' })\n  public getHeight() {\n    return this.height;\n  }\n\n  /**\n   * Returns the calculated height of the bounding box\n   */\n  public get height() {\n    return this.bottom - this.top;\n  }\n\n  /**\n   * Returns the center of the bounding box\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'BoundingBox.center' })\n  public getCenter(): Vector {\n    return new Vector((this.left + this.right) / 2, (this.top + this.bottom) / 2);\n  }\n\n  /**\n   * Returns the center of the bounding box\n   */\n  public get center(): Vector {\n    return new Vector((this.left + this.right) / 2, (this.top + this.bottom) / 2);\n  }\n\n  public translate(pos: Vector): BoundingBox {\n    return new BoundingBox(this.left + pos.x, this.top + pos.y, this.right + pos.x, this.bottom + pos.y);\n  }\n\n  /**\n   * Rotates a bounding box by and angle and around a point, if no point is specified (0, 0) is used by default. The resulting bounding\n   * box is also axis-align. This is useful when a new axis-aligned bounding box is needed for rotated geometry.\n   */\n  public rotate(angle: number, point: Vector = Vector.Zero): BoundingBox {\n    const points = this.getPoints().map((p) => p.rotate(angle, point));\n    return BoundingBox.fromPoints(points);\n  }\n\n  public scale(scale: Vector, point: Vector = Vector.Zero): BoundingBox {\n    const shifted = this.translate(point);\n    return new BoundingBox(shifted.left * scale.x, shifted.top * scale.y, shifted.right * scale.x, shifted.bottom * scale.y);\n  }\n\n  /**\n   * Returns the perimeter of the bounding box\n   */\n  public getPerimeter(): number {\n    const wx = this.width;\n    const wy = this.height;\n    return 2 * (wx + wy);\n  }\n\n  public getPoints(): Vector[] {\n    const results = [];\n    results.push(new Vector(this.left, this.top));\n    results.push(new Vector(this.right, this.top));\n    results.push(new Vector(this.right, this.bottom));\n    results.push(new Vector(this.left, this.bottom));\n    return results;\n  }\n\n  /**\n   * Creates a Polygon collision area from the points of the bounding box\n   */\n  public toPolygon(actor?: Actor): ConvexPolygon {\n    return new ConvexPolygon({\n      body: actor ? actor.body : null,\n      points: this.getPoints(),\n      offset: Vector.Zero\n    });\n  }\n\n  /**\n   * Determines whether a ray intersects with a bounding box\n   */\n  public rayCast(ray: Ray, farClipDistance = Infinity): boolean {\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\n    let tmin = -Infinity;\n    let tmax = +Infinity;\n\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\n\n    const tx1 = (this.left - ray.pos.x) * xinv;\n    const tx2 = (this.right - ray.pos.x) * xinv;\n    tmin = Math.min(tx1, tx2);\n    tmax = Math.max(tx1, tx2);\n\n    const ty1 = (this.top - ray.pos.y) * yinv;\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\n\n    return tmax >= Math.max(0, tmin) && tmin < farClipDistance;\n  }\n\n  public rayCastTime(ray: Ray, farClipDistance = Infinity): number {\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\n    let tmin = -Infinity;\n    let tmax = +Infinity;\n\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\n\n    const tx1 = (this.left - ray.pos.x) * xinv;\n    const tx2 = (this.right - ray.pos.x) * xinv;\n    tmin = Math.min(tx1, tx2);\n    tmax = Math.max(tx1, tx2);\n\n    const ty1 = (this.top - ray.pos.y) * yinv;\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\n\n    if (tmax >= Math.max(0, tmin) && tmin < farClipDistance) {\n      return tmin;\n    }\n    return -1;\n  }\n\n  /**\n   * Tests whether a point is contained within the bounding box\n   * @param p  The point to test\n   */\n  public contains(p: Vector): boolean;\n\n  /**\n   * Tests whether another bounding box is totally contained in this one\n   * @param bb  The bounding box to test\n   */\n  public contains(bb: BoundingBox): boolean;\n  public contains(val: any): boolean {\n    if (val instanceof Vector) {\n      return this.left <= val.x && this.top <= val.y && this.bottom >= val.y && this.right >= val.x;\n    } else if (val instanceof BoundingBox) {\n      if (this.left < val.left && this.top < val.top && val.bottom < this.bottom && val.right < this.right) {\n        return true;\n      }\n      return false;\n    }\n    return false;\n  }\n\n  /**\n   * Combines this bounding box and another together returning a new bounding box\n   * @param other  The bounding box to combine\n   */\n  public combine(other: BoundingBox): BoundingBox {\n    const compositeBB = new BoundingBox(\n      Math.min(this.left, other.left),\n      Math.min(this.top, other.top),\n      Math.max(this.right, other.right),\n      Math.max(this.bottom, other.bottom)\n    );\n    return compositeBB;\n  }\n\n  public get dimensions(): Vector {\n    return new Vector(this.width, this.height);\n  }\n\n  /**\n   * Test wether this bounding box intersects with another returning\n   * the intersection vector that can be used to resolve the collision. If there\n   * is no intersection null is returned.\n   *\n   * @param other  Other [[BoundingBox]] to test intersection with\n   * @returns A Vector in the direction of the current BoundingBox, this <- other\n   */\n  public intersect(other: BoundingBox): Vector {\n    const totalBoundingBox = this.combine(other);\n\n    // If the total bounding box is less than or equal the sum of the 2 bounds then there is collision\n    if (\n      totalBoundingBox.width < other.width + this.width &&\n      totalBoundingBox.height < other.height + this.height &&\n      !totalBoundingBox.dimensions.equals(other.dimensions) &&\n      !totalBoundingBox.dimensions.equals(this.dimensions)\n    ) {\n      // collision\n      let overlapX = 0;\n      // right edge is between the other's left and right edge\n      /**\n       *     +-this-+\n       *     |      |\n       *     |    +-other-+\n       *     +----|-+     |\n       *          |       |\n       *          +-------+\n       *         <---\n       *          ^ overlap\n       */\n      if (this.right >= other.left && this.right <= other.right) {\n        overlapX = other.left - this.right;\n        // right edge is past the other's right edge\n        /**\n         *     +-other-+\n         *     |       |\n         *     |    +-this-+\n         *     +----|--+   |\n         *          |      |\n         *          +------+\n         *          --->\n         *          ^ overlap\n         */\n      } else {\n        overlapX = other.right - this.left;\n      }\n\n      let overlapY = 0;\n      // top edge is between the other's top and bottom edge\n      /**\n       *     +-other-+\n       *     |       |\n       *     |    +-this-+   | <- overlap\n       *     +----|--+   |   |\n       *          |      |  \\ /\n       *          +------+   '\n       */\n      if (this.top <= other.bottom && this.top >= other.top) {\n        overlapY = other.bottom - this.top;\n        // top edge is above the other top edge\n        /**\n         *     +-this-+         .\n         *     |      |        / \\\n         *     |    +-other-+   | <- overlap\n         *     +----|-+     |   |\n         *          |       |\n         *          +-------+\n         */\n      } else {\n        overlapY = other.top - this.bottom;\n      }\n\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\n        return new Vector(overlapX, 0);\n      } else {\n        return new Vector(0, overlapY);\n      }\n      // Case of total containment of one bounding box by another\n    } else if (totalBoundingBox.dimensions.equals(other.dimensions) || totalBoundingBox.dimensions.equals(this.dimensions)) {\n      let overlapX = 0;\n      // this is wider than the other\n      if (this.width - other.width >= 0) {\n        // This right edge is closest to the others right edge\n        if (this.right - other.right <= other.left - this.left) {\n          overlapX = other.left - this.right;\n          // This left edge is closest to the others left edge\n        } else {\n          overlapX = other.right - this.left;\n        }\n        // other is wider than this\n      } else {\n        // This right edge is closest to the others right edge\n        if (other.right - this.right <= this.left - other.left) {\n          overlapX = this.left - other.right;\n          // This left edge is closest to the others left edge\n        } else {\n          overlapX = this.right - other.left;\n        }\n      }\n\n      let overlapY = 0;\n      // this is taller than other\n      if (this.height - other.height >= 0) {\n        // The bottom edge is closest to the others bottom edge\n        if (this.bottom - other.bottom <= other.top - this.top) {\n          overlapY = other.top - this.bottom;\n        } else {\n          overlapY = other.bottom - this.top;\n        }\n        // other is taller than this\n      } else {\n        // The bottom edge is closest to the others bottom edge\n        if (other.bottom - this.bottom <= this.top - other.top) {\n          overlapY = this.top - other.bottom;\n        } else {\n          overlapY = this.bottom - other.top;\n        }\n      }\n\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\n        return new Vector(overlapX, 0);\n      } else {\n        return new Vector(0, overlapY);\n      }\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Test whether the bounding box has intersected with another bounding box, returns the side of the current bb that intersected.\n   * @param bb The other actor to test\n   */\n  public intersectWithSide(bb: BoundingBox): Side {\n    const intersect = this.intersect(bb);\n    return BoundingBox.getSideFromIntersection(intersect);\n  }\n\n  /**\n   * Test wether this bounding box collides with another returning,\n   * the intersection vector that can be used to resolve the collision. If there\n   * is no collision null is returned.\n   *\n   * @returns A Vector in the direction of the current BoundingBox\n   * @param boundingBox  Other collidable to test\n   * @obsolete BoundingBox.collides will be removed in v0.24.0, use BoundingBox.intersect\n   */\n  @obsolete({ message: 'BoundingBox.collides will be removed in v0.24.0', alternateMethod: 'BoundingBox.intersect' })\n  public collides(boundingBox: BoundingBox): Vector {\n    return this.intersect(boundingBox);\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Yellow) {\n    ctx.strokeStyle = color.toString();\n    ctx.strokeRect(this.left, this.top, this.width, this.height);\n  }\n}\n","import { Loadable } from '../Interfaces/Loadable';\nimport { Class } from '../Class';\nimport { Engine } from '../Engine';\nimport { Promise } from '../Promises';\nimport { Logger } from '../Util/Log';\n\n/**\n * The [[Resource]] type allows games built in Excalibur to load generic resources.\n * For any type of remote resource it is recommended to use [[Resource]] for preloading.\n *\n * [[include:Resources.md]]\n */\nexport class Resource<T> extends Class implements Loadable {\n  public data: T = null;\n  public logger: Logger = Logger.getInstance();\n  public arrayBuffer: ArrayBuffer = null;\n\n  /**\n   * @param path          Path to the remote resource\n   * @param responseType  The type to expect as a response: \"\" | \"arraybuffer\" | \"blob\" | \"document\" | \"json\" | \"text\";\n   * @param bustCache     Whether or not to cache-bust requests\n   */\n  constructor(\n    public path: string,\n    public responseType: '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text',\n    public bustCache: boolean = true\n  ) {\n    super();\n  }\n\n  /**\n   * Returns true if the Resource is completely loaded and is ready\n   * to be drawn.\n   */\n  public isLoaded(): boolean {\n    return this.data !== null;\n  }\n\n  public wireEngine(_engine: Engine) {\n    // override me\n  }\n\n  private _cacheBust(uri: string): string {\n    const query: RegExp = /\\?\\w*=\\w*/;\n    if (query.test(uri)) {\n      uri += '&__=' + Date.now();\n    } else {\n      uri += '?__=' + Date.now();\n    }\n    return uri;\n  }\n\n  private _start() {\n    this.logger.debug('Started loading resource ' + this.path);\n  }\n\n  /**\n   * Begin loading the resource and returns a promise to be resolved on completion\n   */\n  public load(): Promise<T> {\n    const complete = new Promise<T>();\n\n    // Exit early if we already have data\n    if (this.data !== null) {\n      this.logger.debug('Already have data for resource', this.path);\n      complete.resolve(this.data);\n      this.oncomplete();\n      return complete;\n    }\n\n    const request = new XMLHttpRequest();\n    request.open('GET', this.bustCache ? this._cacheBust(this.path) : this.path, true);\n    request.responseType = this.responseType;\n    request.onloadstart = () => {\n      this._start();\n    };\n    request.onprogress = this.onprogress;\n    request.onerror = this.onerror;\n    request.onload = () => {\n      // XHR on file:// success status is 0, such as with PhantomJS\n      if (request.status !== 0 && request.status !== 200) {\n        this.logger.error('Failed to load resource ', this.path, ' server responded with error code', request.status);\n        this.onerror(request.response);\n        complete.resolve(request.response);\n        return;\n      }\n\n      this.data = this.processData(request.response);\n\n      this.oncomplete();\n      this.logger.debug('Completed loading resource', this.path);\n      complete.resolve(this.data);\n    };\n    request.send();\n    return complete;\n  }\n\n  /**\n   * Returns the loaded data once the resource is loaded\n   */\n  public getData(): any {\n    return this.data;\n  }\n\n  public getArrayData(): any {\n    return this.arrayBuffer;\n  }\n\n  /**\n   * Sets the data for this resource directly\n   */\n  public setData(data: any) {\n    this.data = this.processData(data);\n  }\n\n  /**\n   * This method is meant to be overriden to handle any additional\n   * processing. Such as decoding downloaded audio bits.\n   */\n  public processData(data: T): any {\n    // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseType\n    // Blob requires an object url\n    if (this.responseType === 'blob') {\n      return URL.createObjectURL(data);\n    }\n    return data;\n  }\n\n  public onprogress: (e: any) => void = () => {\n    return;\n  };\n\n  public oncomplete: () => void = () => {\n    return;\n  };\n\n  public onerror: (e: any) => void = () => {\n    return;\n  };\n}\n","/**\n * These effects can be applied to any bitmap image but are mainly used\n * for [[Sprite]] effects or [[Animation]] effects.\n *\n * [[include:SpriteEffects.md]]\n */\n\n/**\n * @typedoc\n */\n\nimport { Color } from './Color';\n\n/**\n * The interface that all sprite effects must implement\n */\nexport interface SpriteEffect {\n  /**\n   * Should update individual pixels values\n   * @param x          The pixel's x coordinate\n   * @param y          The pixel's y coordinate\n   * @param imageData  The sprite's raw pixel data\n   */\n  updatePixel(x: number, y: number, imageData: ImageData): void;\n}\n\n/**\n * Applies the \"Grayscale\" effect to a sprite, removing color information.\n */\nexport class Grayscale implements SpriteEffect {\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const avg = (pixel[firstPixel + 0] + pixel[firstPixel + 1] + pixel[firstPixel + 2]) / 3;\n    pixel[firstPixel + 0] = avg;\n    pixel[firstPixel + 1] = avg;\n    pixel[firstPixel + 2] = avg;\n  }\n}\n\n/**\n * Applies the \"Invert\" effect to a sprite, inverting the pixel colors.\n */\nexport class Invert implements SpriteEffect {\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    pixel[firstPixel + 0] = 255 - pixel[firstPixel + 0];\n    pixel[firstPixel + 1] = 255 - pixel[firstPixel + 1];\n    pixel[firstPixel + 2] = 255 - pixel[firstPixel + 2];\n  }\n}\n\n/**\n * Applies the \"Opacity\" effect to a sprite, setting the alpha of all pixels to a given value.\n */\nexport class Opacity implements SpriteEffect {\n  /**\n   * @param opacity  The new opacity of the sprite from 0-1.0\n   */\n  constructor(public opacity: number) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    if (pixel[firstPixel + 3] !== 0) {\n      pixel[firstPixel + 3] = Math.round(this.opacity * pixel[firstPixel + 3]);\n    }\n  }\n}\n\n/**\n * Applies the \"Colorize\" effect to a sprite, changing the color channels of all the pixels to an\n * average of the original color and the provided color\n */\nexport class Colorize implements SpriteEffect {\n  /**\n   * @param color  The color to apply to the sprite\n   */\n  constructor(public color: Color) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    if (pixel[firstPixel + 3] !== 0) {\n      pixel[firstPixel + 0] = (pixel[firstPixel + 0] + this.color.r) / 2;\n      pixel[firstPixel + 1] = (pixel[firstPixel + 1] + this.color.g) / 2;\n      pixel[firstPixel + 2] = (pixel[firstPixel + 2] + this.color.b) / 2;\n    }\n  }\n}\n\n/**\n * Applies the \"Lighten\" effect to a sprite, changes the lightness of the color according to HSL\n */\nexport class Lighten implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).lighten(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Darken\" effect to a sprite, changes the darkness of the color according to HSL\n */\nexport class Darken implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).darken(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Saturate\" effect to a sprite, saturates the color according to HSL\n */\nexport class Saturate implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).saturate(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Desaturate\" effect to a sprite, desaturates the color according to HSL\n */\nexport class Desaturate implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).desaturate(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Fill\" effect to a sprite, changing the color channels of all non-transparent pixels to match\n * a given color\n */\nexport class Fill implements SpriteEffect {\n  /**\n   * @param color  The color to apply to the sprite\n   */\n  constructor(public color: Color) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    if (pixel[firstPixel + 3] !== 0) {\n      pixel[firstPixel + 0] = this.color.r;\n      pixel[firstPixel + 1] = this.color.g;\n      pixel[firstPixel + 2] = this.color.b;\n    }\n  }\n}\n","export type Constructor<T> = {\n  new (...args: any[]): T;\n};\nexport function Configurable<T extends Constructor<{}>>(base: T): T {\n  return class extends base {\n    public assign(props: Partial<T>) {\n      //set the value of every property that was passed in,\n      //if the constructor previously set this value, it will be overridden here\n      for (const k in props) {\n        if (typeof (<any>this)[k] !== 'function') {\n          (<any>this)[k] = (<any>props)[k];\n        }\n      }\n    }\n\n    constructor(...args: any[]) {\n      super(...args);\n      //get the number of arguments that aren't undefined. TS passes a value to all parameters\n      //of whatever ctor is the implementation, so args.length doesn't work here.\n      const size = args.filter(function(value) {\n        return value !== undefined;\n      }).length;\n      if (size === 1 && args[0] && typeof args[0] === 'object' && !(args[0] instanceof Array)) {\n        this.assign(args[0]);\n      }\n    }\n  };\n}\n","/**\n * An enum that describes the strategies that rotation actions can use\n */\nexport enum RotationType {\n  /**\n   * Rotation via `ShortestPath` will use the smallest angle\n   * between the starting and ending points. This strategy is the default behavior.\n   */\n  ShortestPath = 0,\n  /**\n   * Rotation via `LongestPath` will use the largest angle\n   * between the starting and ending points.\n   */\n  LongestPath = 1,\n  /**\n   * Rotation via `Clockwise` will travel in a clockwise direction,\n   * regardless of the starting and ending points.\n   */\n  Clockwise = 2,\n  /**\n   * Rotation via `CounterClockwise` will travel in a counterclockwise direction,\n   * regardless of the starting and ending points.\n   */\n  CounterClockwise = 3\n}\n","import * as Effects from './SpriteEffects';\nimport { Color } from './Color';\n\nimport { Drawable } from '../Interfaces/Drawable';\nimport { Texture } from '../Resources/Texture';\nimport { Vector } from '../Algebra';\nimport { Logger } from '../Util/Log';\nimport { clamp } from '../Util/Util';\nimport { Configurable } from '../Configurable';\n\n/**\n * @hidden\n */\nexport class SpriteImpl implements Drawable {\n  private _texture: Texture;\n\n  public x: number = 0;\n  public y: number = 0;\n\n  public get drawWidth(): number {\n    return this.width * this.scale.x;\n  }\n\n  public get drawHeight(): number {\n    return this.height * this.scale.y;\n  }\n\n  public rotation: number = 0.0;\n  public anchor: Vector = new Vector(0.0, 0.0);\n  public scale: Vector = new Vector(1, 1);\n\n  public logger: Logger = Logger.getInstance();\n\n  /**\n   * Draws the sprite flipped vertically\n   */\n  public flipVertical: boolean = false;\n\n  /**\n   * Draws the sprite flipped horizontally\n   */\n  public flipHorizontal: boolean = false;\n\n  public effects: Effects.SpriteEffect[] = [];\n\n  public width: number = 0;\n  public height: number = 0;\n\n  private _spriteCanvas: HTMLCanvasElement = null;\n  private _spriteCtx: CanvasRenderingContext2D = null;\n  private _pixelData: ImageData = null;\n  private _pixelsLoaded: boolean = false;\n  private _dirtyEffect: boolean = false;\n\n  /**\n   * @param image   The backing image texture to build the Sprite\n   * @param x      The x position of the sprite\n   * @param y      The y position of the sprite\n   * @param width  The width of the sprite in pixels\n   * @param height The height of the sprite in pixels\n   */\n  constructor(imageOrConfig: Texture | SpriteArgs, x: number, y: number, width: number, height: number) {\n    let image = imageOrConfig;\n    if (imageOrConfig && !(imageOrConfig instanceof Texture)) {\n      x = imageOrConfig.x | 0;\n      y = imageOrConfig.y | 0;\n      width = imageOrConfig.width | 0;\n      height = imageOrConfig.height | 0;\n      image = imageOrConfig.image;\n      if (!image) {\n        const message = 'An image texture is required to contsruct a sprite';\n        throw new Error(message);\n      }\n    }\n\n    this.x = x || 0;\n    this.y = y || 0;\n\n    this._texture = <Texture>image;\n    this._spriteCanvas = document.createElement('canvas');\n    this._spriteCanvas.width = width;\n    this._spriteCanvas.height = height;\n    this._spriteCtx = <CanvasRenderingContext2D>this._spriteCanvas.getContext('2d');\n    this._texture.loaded\n      .then(() => {\n        this.width = this.width || this._texture.image.naturalWidth;\n        this.height = this.height || this._texture.image.naturalHeight;\n        this._spriteCanvas.width = this._spriteCanvas.width || this._texture.image.naturalWidth;\n        this._spriteCanvas.height = this._spriteCanvas.height || this._texture.image.naturalHeight;\n        this._loadPixels();\n        this._dirtyEffect = true;\n      })\n      .error((e) => {\n        this.logger.error('Error loading texture ', this._texture.path, e);\n      });\n\n    this.width = width;\n    this.height = height;\n  }\n\n  private _loadPixels() {\n    if (this._texture.isLoaded() && !this._pixelsLoaded) {\n      const naturalWidth = this._texture.image.naturalWidth || 0;\n      const naturalHeight = this._texture.image.naturalHeight || 0;\n\n      if (this.width > naturalWidth) {\n        this.logger.warn(`The sprite width ${this.width} exceeds the width \n                              ${naturalWidth} of the backing texture ${this._texture.path}`);\n      }\n\n      if (this.width <= 0 || naturalWidth <= 0) {\n        throw new Error(`The width of a sprite cannot be 0 or negative, sprite width: ${this.width}, original width: ${naturalWidth}`);\n      }\n\n      if (this.height > naturalHeight) {\n        this.logger.warn(`The sprite height ${this.height} exceeds the height \n                              ${naturalHeight} of the backing texture ${this._texture.path}`);\n      }\n\n      if (this.height <= 0 || naturalHeight <= 0) {\n        throw new Error(`The height of a sprite cannot be 0 or negative, sprite height: ${this.height}, original height: ${naturalHeight}`);\n      }\n\n      this._spriteCtx.drawImage(\n        this._texture.image,\n        clamp(this.x, 0, naturalWidth),\n        clamp(this.y, 0, naturalHeight),\n        clamp(this.width, 0, naturalWidth),\n        clamp(this.height, 0, naturalHeight),\n        0,\n        0,\n        this.width,\n        this.height\n      );\n\n      this._pixelsLoaded = true;\n    }\n  }\n\n  /**\n   * Applies the [[Opacity]] effect to a sprite, setting the alpha of all pixels to a given value\n   */\n  public opacity(value: number) {\n    this.addEffect(new Effects.Opacity(value));\n  }\n\n  /**\n   * Applies the [[Grayscale]] effect to a sprite, removing color information.\n   */\n  public grayscale() {\n    this.addEffect(new Effects.Grayscale());\n  }\n\n  /**\n   * Applies the [[Invert]] effect to a sprite, inverting the pixel colors.\n   */\n  public invert() {\n    this.addEffect(new Effects.Invert());\n  }\n\n  /**\n   * Applies the [[Fill]] effect to a sprite, changing the color channels of all non-transparent pixels to match a given color\n   */\n  public fill(color: Color) {\n    this.addEffect(new Effects.Fill(color));\n  }\n\n  /**\n   * Applies the [[Colorize]] effect to a sprite, changing the color channels of all pixels to be the average of the original color\n   * and the provided color.\n   */\n  public colorize(color: Color) {\n    this.addEffect(new Effects.Colorize(color));\n  }\n\n  /**\n   * Applies the [[Lighten]] effect to a sprite, changes the lightness of the color according to HSL\n   */\n  public lighten(factor: number = 0.1) {\n    this.addEffect(new Effects.Lighten(factor));\n  }\n\n  /**\n   * Applies the [[Darken]] effect to a sprite, changes the darkness of the color according to HSL\n   */\n  public darken(factor: number = 0.1) {\n    this.addEffect(new Effects.Darken(factor));\n  }\n\n  /**\n   * Applies the [[Saturate]] effect to a sprite, saturates the color according to HSL\n   */\n  public saturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Saturate(factor));\n  }\n\n  /**\n   * Applies the [[Desaturate]] effect to a sprite, desaturates the color according to HSL\n   */\n  public desaturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Desaturate(factor));\n  }\n\n  /**\n   * Adds a new [[ISpriteEffect]] to this drawing.\n   * @param effect  Effect to add to the this drawing\n   */\n  public addEffect(effect: Effects.SpriteEffect) {\n    this.effects.push(effect);\n    // We must check if the texture and the backing sprite pixels are loaded as well before\n    // an effect can be applied\n    if (!this._texture.isLoaded() || !this._pixelsLoaded) {\n      this._dirtyEffect = true;\n    } else {\n      this._applyEffects();\n    }\n  }\n\n  /**\n   * Removes a [[ISpriteEffect]] from this sprite.\n   * @param effect  Effect to remove from this sprite\n   */\n  public removeEffect(effect: Effects.SpriteEffect): void;\n\n  /**\n   * Removes an effect given the index from this sprite.\n   * @param index  Index of the effect to remove from this sprite\n   */\n  public removeEffect(index: number): void;\n  public removeEffect(param: any) {\n    let indexToRemove = -1;\n    if (typeof param === 'number') {\n      indexToRemove = param;\n    } else {\n      indexToRemove = this.effects.indexOf(param);\n    }\n\n    // bounds check\n    if (indexToRemove < 0 || indexToRemove >= this.effects.length) {\n      return;\n    }\n\n    this.effects.splice(indexToRemove, 1);\n\n    // We must check if the texture and the backing sprite pixels are loaded as well before\n    // an effect can be applied\n    if (!this._texture.isLoaded() || !this._pixelsLoaded) {\n      this._dirtyEffect = true;\n    } else {\n      this._applyEffects();\n    }\n  }\n\n  private _applyEffects() {\n    const naturalWidth = this._texture.image.naturalWidth || 0;\n    const naturalHeight = this._texture.image.naturalHeight || 0;\n\n    this._spriteCtx.clearRect(0, 0, this.width, this.height);\n    this._spriteCtx.drawImage(\n      this._texture.image,\n      clamp(this.x, 0, naturalWidth),\n      clamp(this.y, 0, naturalHeight),\n      clamp(this.width, 0, naturalWidth),\n      clamp(this.height, 0, naturalHeight),\n      0,\n      0,\n      this.width,\n      this.height\n    );\n    this._pixelData = this._spriteCtx.getImageData(0, 0, this.width, this.height);\n\n    const len = this.effects.length;\n    for (let i = 0; i < len; i++) {\n      for (let y = 0; y < this.height; y++) {\n        for (let x = 0; x < this.width; x++) {\n          this.effects[i].updatePixel(x, y, this._pixelData);\n        }\n      }\n    }\n    this._spriteCtx.clearRect(0, 0, this.width, this.height);\n    this._spriteCtx.putImageData(this._pixelData, 0, 0);\n\n    this._dirtyEffect = false;\n  }\n\n  /**\n   * Clears all effects from the drawing and return it to its original state.\n   */\n  public clearEffects() {\n    this.effects.length = 0;\n    this._applyEffects();\n  }\n\n  /**\n   * Resets the internal state of the drawing (if any)\n   */\n  public reset() {\n    // do nothing\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D, x: number, y: number) {\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate(this.rotation);\n    const xpoint = this.drawWidth * this.anchor.x;\n    const ypoint = this.drawHeight * this.anchor.y;\n\n    ctx.strokeStyle = Color.Black.toString();\n    ctx.strokeRect(-xpoint, -ypoint, this.drawWidth, this.drawHeight);\n    ctx.restore();\n  }\n\n  /**\n   * Draws the sprite appropriately to the 2D rendering context, at an x and y coordinate.\n   * @param ctx  The 2D rendering context\n   * @param x    The x coordinate of where to draw\n   * @param y    The y coordinate of where to draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number) {\n    if (this._dirtyEffect) {\n      this._applyEffects();\n    }\n\n    // calculating current dimensions\n    ctx.save();\n    const xpoint = this.drawWidth * this.anchor.x;\n    const ypoint = this.drawHeight * this.anchor.y;\n    ctx.translate(x, y);\n    ctx.rotate(this.rotation);\n\n    // todo cache flipped sprites\n    if (this.flipHorizontal) {\n      ctx.translate(this.drawWidth, 0);\n      ctx.scale(-1, 1);\n    }\n\n    if (this.flipVertical) {\n      ctx.translate(0, this.drawHeight);\n      ctx.scale(1, -1);\n    }\n\n    ctx.drawImage(this._spriteCanvas, 0, 0, this.width, this.height, -xpoint, -ypoint, this.drawWidth, this.drawHeight);\n\n    ctx.restore();\n  }\n\n  /**\n   * Produces a copy of the current sprite\n   */\n  public clone(): SpriteImpl {\n    const result = new Sprite(this._texture, this.x, this.y, this.width, this.height);\n    result.scale = this.scale.clone();\n    result.rotation = this.rotation;\n    result.flipHorizontal = this.flipHorizontal;\n    result.flipVertical = this.flipVertical;\n\n    const len = this.effects.length;\n    for (let i = 0; i < len; i++) {\n      result.addEffect(this.effects[i]);\n    }\n    return result;\n  }\n}\n\n/**\n * [[include:Constructors.md]]\n */\nexport interface SpriteArgs extends Partial<SpriteImpl> {\n  image?: Texture;\n  x?: number;\n  width?: number;\n  height?: number;\n  rotation?: number;\n  anchor?: Vector;\n  scale?: Vector;\n  flipVertical?: boolean;\n  flipHorizontal?: boolean;\n}\n\n/**\n * A [[Sprite]] is one of the main drawing primitives. It is responsible for drawing\n * images or parts of images from a [[Texture]] resource to the screen.\n *\n * [[include:Sprites.md]]\n */\nexport class Sprite extends Configurable(SpriteImpl) {\n  constructor(config: SpriteArgs);\n  constructor(image: Texture, x: number, y: number, width: number, height: number);\n  constructor(imageOrConfig: Texture | SpriteArgs, x?: number, y?: number, width?: number, height?: number) {\n    super(imageOrConfig, x, y, width, height);\n  }\n}\n","import { Resource } from './Resource';\nimport { Promise } from '../Promises';\nimport { Sprite } from '../Drawing/Sprite';\n/**\n * The [[Texture]] object allows games built in Excalibur to load image resources.\n * [[Texture]] is an [[ILoadable]] which means it can be passed to a [[Loader]]\n * to pre-load before starting a level or game.\n *\n * [[include:Textures.md]]\n */\nexport class Texture extends Resource<HTMLImageElement> {\n  /**\n   * The width of the texture in pixels\n   */\n  public width: number;\n\n  /**\n   * The height of the texture in pixels\n   */\n  public height: number;\n\n  /**\n   * A [[Promise]] that resolves when the Texture is loaded.\n   */\n  public loaded: Promise<any> = new Promise<any>();\n\n  private _isLoaded: boolean = false;\n  private _sprite: Sprite = null;\n\n  /**\n   * Populated once loading is complete\n   */\n  public image: HTMLImageElement;\n\n  /**\n   * @param path       Path to the image resource\n   * @param bustCache  Optionally load texture with cache busting\n   */\n  constructor(public path: string, public bustCache = true) {\n    super(path, 'blob', bustCache);\n    this._sprite = new Sprite(this, 0, 0, 0, 0);\n  }\n\n  /**\n   * Returns true if the Texture is completely loaded and is ready\n   * to be drawn.\n   */\n  public isLoaded(): boolean {\n    return this._isLoaded;\n  }\n\n  /**\n   * Begins loading the texture and returns a promise to be resolved on completion\n   */\n  public load(): Promise<HTMLImageElement> {\n    const complete = new Promise<HTMLImageElement>();\n    if (this.path.indexOf('data:image/') > -1) {\n      this.image = new Image();\n      this.image.addEventListener('load', () => {\n        this.width = this._sprite.width = this.image.naturalWidth;\n        this.height = this._sprite.height = this.image.naturalHeight;\n        this._sprite = new Sprite(this, 0, 0, this.width, this.height);\n        this.loaded.resolve(this.image);\n        complete.resolve(this.image);\n      });\n      this.image.src = this.path;\n    } else {\n      const loaded = super.load();\n      loaded.then(\n        () => {\n          this.image = new Image();\n          this.image.addEventListener('load', () => {\n            this._isLoaded = true;\n            this.width = this._sprite.width = this.image.naturalWidth;\n            this.height = this._sprite.height = this.image.naturalHeight;\n            this.loaded.resolve(this.image);\n            complete.resolve(this.image);\n          });\n          this.image.src = super.getData();\n        },\n        () => {\n          complete.reject('Error loading texture.');\n        }\n      );\n    }\n    return complete;\n  }\n\n  public asSprite(): Sprite {\n    return this._sprite;\n  }\n}\n","import { RotationType } from './RotationType';\n\nimport { Actor } from '../Actor';\nimport { Vector } from '../Algebra';\nimport { Logger } from '../Util/Log';\nimport * as Util from '../Util/Util';\n\n/**\n * Used for implementing actions for the [[ActionContext|Action API]].\n */\nexport interface Action {\n  update(delta: number): void;\n  isComplete(actor: Actor): boolean;\n  reset(): void;\n  stop(): void;\n}\n\nexport class EaseTo implements Action {\n  private _currentLerpTime: number = 0;\n  private _lerpDuration: number = 1 * 1000; // 1 second\n  private _lerpStart: Vector = new Vector(0, 0);\n  private _lerpEnd: Vector = new Vector(0, 0);\n  private _initialized: boolean = false;\n  private _stopped: boolean = false;\n  private _distance: number = 0;\n  constructor(\n    public actor: Actor,\n    x: number,\n    y: number,\n    duration: number,\n    public easingFcn: (currentTime: number, startValue: number, endValue: number, duration: number) => number\n  ) {\n    this._lerpDuration = duration;\n    this._lerpEnd = new Vector(x, y);\n  }\n  private _initialize() {\n    this._lerpStart = new Vector(this.actor.pos.x, this.actor.pos.y);\n    this._currentLerpTime = 0;\n    this._distance = this._lerpStart.distance(this._lerpEnd);\n  }\n\n  public update(delta: number): void {\n    if (!this._initialized) {\n      this._initialize();\n      this._initialized = true;\n    }\n\n    let newX = this.actor.pos.x;\n    let newY = this.actor.pos.y;\n    if (this._currentLerpTime < this._lerpDuration) {\n      if (this._lerpEnd.x < this._lerpStart.x) {\n        newX =\n          this._lerpStart.x -\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.x, this._lerpStart.x, this._lerpDuration) - this._lerpEnd.x);\n      } else {\n        newX = this.easingFcn(this._currentLerpTime, this._lerpStart.x, this._lerpEnd.x, this._lerpDuration);\n      }\n\n      if (this._lerpEnd.y < this._lerpStart.y) {\n        newY =\n          this._lerpStart.y -\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.y, this._lerpStart.y, this._lerpDuration) - this._lerpEnd.y);\n      } else {\n        newY = this.easingFcn(this._currentLerpTime, this._lerpStart.y, this._lerpEnd.y, this._lerpDuration);\n      }\n      this.actor.pos.x = newX;\n      this.actor.pos.y = newY;\n\n      this._currentLerpTime += delta;\n    } else {\n      this.actor.pos.x = this._lerpEnd.x;\n      this.actor.pos.y = this._lerpEnd.y;\n      //this._lerpStart = null;\n      //this._lerpEnd = null;\n      //this._currentLerpTime = 0;\n    }\n  }\n  public isComplete(actor: Actor): boolean {\n    return this._stopped || new Vector(actor.pos.x, actor.pos.y).distance(this._lerpStart) >= this._distance;\n  }\n\n  public reset(): void {\n    this._initialized = false;\n  }\n  public stop(): void {\n    this._stopped = true;\n  }\n}\n\nexport class MoveTo implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _start: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _distance: number;\n  private _started = false;\n  private _stopped = false;\n  constructor(actor: Actor, destx: number, desty: number, speed: number) {\n    this._actor = actor;\n    this._end = new Vector(destx, desty);\n    this._speed = speed;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._start = new Vector(this._actor.pos.x, this._actor.pos.y);\n      this._distance = this._start.distance(this._end);\n      this._dir = this._end.sub(this._start).normalize();\n    }\n    const m = this._dir.scale(this._speed);\n    this._actor.vel.x = m.x;\n    this._actor.vel.y = m.y;\n\n    if (this.isComplete(this._actor)) {\n      this._actor.pos.x = this._end.x;\n      this._actor.pos.y = this._end.y;\n      this._actor.vel.y = 0;\n      this._actor.vel.x = 0;\n    }\n  }\n\n  public isComplete(actor: Actor): boolean {\n    return this._stopped || new Vector(actor.pos.x, actor.pos.y).distance(this._start) >= this._distance;\n  }\n\n  public stop(): void {\n    this._actor.vel.y = 0;\n    this._actor.vel.x = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class MoveBy implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _distance: number;\n  private _speed: number;\n\n  private _start: Vector;\n  private _offset: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _started = false;\n  private _stopped = false;\n\n  constructor(actor: Actor, offsetX: number, offsetY: number, speed: number) {\n    this._actor = actor;\n    this._speed = speed;\n    this._offset = new Vector(offsetX, offsetY);\n    if (speed <= 0) {\n      Logger.getInstance().error('Attempted to moveBy with speed less than or equal to zero : ' + speed);\n      throw new Error('Speed must be greater than 0 pixels per second');\n    }\n  }\n\n  public update(_delta: number) {\n    if (!this._started) {\n      this._started = true;\n      this._start = new Vector(this._actor.pos.x, this._actor.pos.y);\n      this._end = this._start.add(this._offset);\n      this._distance = this._offset.magnitude();\n      this._dir = this._end.sub(this._start).normalize();\n    }\n\n    this._actor.vel = this._dir.scale(this._speed);\n\n    if (this.isComplete(this._actor)) {\n      this._actor.pos.x = this._end.x;\n      this._actor.pos.y = this._end.y;\n      this._actor.vel.y = 0;\n      this._actor.vel.x = 0;\n    }\n  }\n\n  public isComplete(actor: Actor): boolean {\n    return this._stopped || actor.pos.distance(this._start) >= this._distance;\n  }\n\n  public stop(): void {\n    this._actor.vel.y = 0;\n    this._actor.vel.x = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class Follow implements Action {\n  private _actor: Actor;\n  private _actorToFollow: Actor;\n  public x: number;\n  public y: number;\n  private _current: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _maximumDistance: number;\n  private _distanceBetween: number;\n  private _started = false;\n  private _stopped = false;\n\n  constructor(actor: Actor, actorToFollow: Actor, followDistance?: number) {\n    this._actor = actor;\n    this._actorToFollow = actorToFollow;\n    this._current = new Vector(this._actor.pos.x, this._actor.pos.y);\n    this._end = new Vector(actorToFollow.pos.x, actorToFollow.pos.y);\n    this._maximumDistance = followDistance !== undefined ? followDistance : this._current.distance(this._end);\n    this._speed = 0;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._distanceBetween = this._current.distance(this._end);\n      this._dir = this._end.sub(this._current).normalize();\n    }\n\n    const actorToFollowSpeed = Math.sqrt(Math.pow(this._actorToFollow.vel.x, 2) + Math.pow(this._actorToFollow.vel.y, 2));\n    if (actorToFollowSpeed !== 0) {\n      this._speed = actorToFollowSpeed;\n    }\n    this._current.x = this._actor.pos.x;\n    this._current.y = this._actor.pos.y;\n\n    this._end.x = this._actorToFollow.pos.x;\n    this._end.y = this._actorToFollow.pos.y;\n    this._distanceBetween = this._current.distance(this._end);\n    this._dir = this._end.sub(this._current).normalize();\n\n    if (this._distanceBetween >= this._maximumDistance) {\n      const m = this._dir.scale(this._speed);\n      this._actor.vel.x = m.x;\n      this._actor.vel.y = m.y;\n    } else {\n      this._actor.vel.x = 0;\n      this._actor.vel.y = 0;\n    }\n\n    if (this.isComplete()) {\n      this._actor.pos.x = this._end.x;\n      this._actor.pos.y = this._end.y;\n      this._actor.vel.y = 0;\n      this._actor.vel.x = 0;\n    }\n  }\n\n  public stop(): void {\n    this._actor.vel.y = 0;\n    this._actor.vel.x = 0;\n    this._stopped = true;\n  }\n\n  public isComplete(): boolean {\n    // the actor following should never stop unless specified to do so\n    return this._stopped;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class Meet implements Action {\n  private _actor: Actor;\n  private _actorToMeet: Actor;\n  public x: number;\n  public y: number;\n  private _current: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _distanceBetween: number;\n  private _started = false;\n  private _stopped = false;\n  private _speedWasSpecified = false;\n\n  constructor(actor: Actor, actorToMeet: Actor, speed?: number) {\n    this._actor = actor;\n    this._actorToMeet = actorToMeet;\n    this._current = new Vector(this._actor.pos.x, this._actor.pos.y);\n    this._end = new Vector(actorToMeet.pos.x, actorToMeet.pos.y);\n    this._speed = speed || 0;\n\n    if (speed !== undefined) {\n      this._speedWasSpecified = true;\n    }\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._distanceBetween = this._current.distance(this._end);\n      this._dir = this._end.sub(this._current).normalize();\n    }\n\n    const actorToMeetSpeed = Math.sqrt(Math.pow(this._actorToMeet.vel.x, 2) + Math.pow(this._actorToMeet.vel.y, 2));\n    if (actorToMeetSpeed !== 0 && !this._speedWasSpecified) {\n      this._speed = actorToMeetSpeed;\n    }\n    this._current.x = this._actor.pos.x;\n    this._current.y = this._actor.pos.y;\n\n    this._end.x = this._actorToMeet.pos.x;\n    this._end.y = this._actorToMeet.pos.y;\n    this._distanceBetween = this._current.distance(this._end);\n    this._dir = this._end.sub(this._current).normalize();\n\n    const m = this._dir.scale(this._speed);\n    this._actor.vel.x = m.x;\n    this._actor.vel.y = m.y;\n\n    if (this.isComplete()) {\n      this._actor.pos.x = this._end.x;\n      this._actor.pos.y = this._end.y;\n      this._actor.vel.y = 0;\n      this._actor.vel.x = 0;\n    }\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || this._distanceBetween <= 1;\n  }\n\n  public stop(): void {\n    this._actor.vel.y = 0;\n    this._actor.vel.x = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class RotateTo implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _start: number;\n  private _end: number;\n  private _speed: number;\n  private _rotationType: RotationType;\n  private _direction: number;\n  private _distance: number;\n  private _shortDistance: number;\n  private _longDistance: number;\n  private _shortestPathIsPositive: boolean;\n  private _started = false;\n  private _stopped = false;\n  constructor(actor: Actor, angleRadians: number, speed: number, rotationType?: RotationType) {\n    this._actor = actor;\n    this._end = angleRadians;\n    this._speed = speed;\n    this._rotationType = rotationType || RotationType.ShortestPath;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._start = this._actor.rotation;\n      const distance1 = Math.abs(this._end - this._start);\n      const distance2 = Util.TwoPI - distance1;\n      if (distance1 > distance2) {\n        this._shortDistance = distance2;\n        this._longDistance = distance1;\n      } else {\n        this._shortDistance = distance1;\n        this._longDistance = distance2;\n      }\n\n      this._shortestPathIsPositive = (this._start - this._end + Util.TwoPI) % Util.TwoPI >= Math.PI;\n\n      switch (this._rotationType) {\n        case RotationType.ShortestPath:\n          this._distance = this._shortDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = 1;\n          } else {\n            this._direction = -1;\n          }\n          break;\n        case RotationType.LongestPath:\n          this._distance = this._longDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = -1;\n          } else {\n            this._direction = 1;\n          }\n          break;\n        case RotationType.Clockwise:\n          this._direction = 1;\n          if (this._shortestPathIsPositive) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n        case RotationType.CounterClockwise:\n          this._direction = -1;\n          if (!this._shortestPathIsPositive) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n      }\n    }\n\n    this._actor.rx = this._direction * this._speed;\n\n    if (this.isComplete()) {\n      this._actor.rotation = this._end;\n      this._actor.rx = 0;\n      this._stopped = true;\n    }\n  }\n\n  public isComplete(): boolean {\n    const distanceTravelled = Math.abs(this._actor.rotation - this._start);\n    return this._stopped || distanceTravelled >= Math.abs(this._distance);\n  }\n\n  public stop(): void {\n    this._actor.rx = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class RotateBy implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _start: number;\n  private _end: number;\n  private _speed: number;\n  private _offset: number;\n\n  private _rotationType: RotationType;\n  private _direction: number;\n  private _distance: number;\n  private _shortDistance: number;\n  private _longDistance: number;\n  private _shortestPathIsPositive: boolean;\n  private _started = false;\n  private _stopped = false;\n  constructor(actor: Actor, angleRadiansOffset: number, speed: number, rotationType?: RotationType) {\n    this._actor = actor;\n    this._speed = speed;\n    this._offset = angleRadiansOffset;\n    this._rotationType = rotationType || RotationType.ShortestPath;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._start = this._actor.rotation;\n      this._end = this._start + this._offset;\n\n      const distance1 = Math.abs(this._end - this._start);\n      const distance2 = Util.TwoPI - distance1;\n      if (distance1 > distance2) {\n        this._shortDistance = distance2;\n        this._longDistance = distance1;\n      } else {\n        this._shortDistance = distance1;\n        this._longDistance = distance2;\n      }\n\n      this._shortestPathIsPositive = (this._start - this._end + Util.TwoPI) % Util.TwoPI >= Math.PI;\n\n      switch (this._rotationType) {\n        case RotationType.ShortestPath:\n          this._distance = this._shortDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = 1;\n          } else {\n            this._direction = -1;\n          }\n          break;\n        case RotationType.LongestPath:\n          this._distance = this._longDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = -1;\n          } else {\n            this._direction = 1;\n          }\n          break;\n        case RotationType.Clockwise:\n          this._direction = 1;\n          if (this._shortDistance >= 0) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n        case RotationType.CounterClockwise:\n          this._direction = -1;\n          if (this._shortDistance <= 0) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n      }\n    }\n\n    this._actor.rx = this._direction * this._speed;\n\n    if (this.isComplete()) {\n      this._actor.rotation = this._end;\n      this._actor.rx = 0;\n      this._stopped = true;\n    }\n  }\n\n  public isComplete(): boolean {\n    const distanceTravelled = Math.abs(this._actor.rotation - this._start);\n    return this._stopped || distanceTravelled >= Math.abs(this._distance);\n  }\n\n  public stop(): void {\n    this._actor.rx = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class ScaleTo implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _startX: number;\n  private _startY: number;\n  private _endX: number;\n  private _endY: number;\n  private _speedX: number;\n  private _speedY: number;\n  private _distanceX: number;\n  private _distanceY: number;\n  private _started = false;\n  private _stopped = false;\n  constructor(actor: Actor, scaleX: number, scaleY: number, speedX: number, speedY: number) {\n    this._actor = actor;\n    this._endX = scaleX;\n    this._endY = scaleY;\n    this._speedX = speedX;\n    this._speedY = speedY;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._startX = this._actor.scale.x;\n      this._startY = this._actor.scale.y;\n      this._distanceX = Math.abs(this._endX - this._startX);\n      this._distanceY = Math.abs(this._endY - this._startY);\n    }\n\n    if (!(Math.abs(this._actor.scale.x - this._startX) >= this._distanceX)) {\n      const directionX = this._endY < this._startY ? -1 : 1;\n      this._actor.sx = this._speedX * directionX;\n    } else {\n      this._actor.sx = 0;\n    }\n\n    if (!(Math.abs(this._actor.scale.y - this._startY) >= this._distanceY)) {\n      const directionY = this._endY < this._startY ? -1 : 1;\n      this._actor.sy = this._speedY * directionY;\n    } else {\n      this._actor.sy = 0;\n    }\n\n    if (this.isComplete()) {\n      this._actor.scale.x = this._endX;\n      this._actor.scale.y = this._endY;\n      this._actor.sx = 0;\n      this._actor.sy = 0;\n    }\n  }\n\n  public isComplete(): boolean {\n    return (\n      this._stopped ||\n      (Math.abs(this._actor.scale.y - this._startX) >= this._distanceX && Math.abs(this._actor.scale.y - this._startY) >= this._distanceY)\n    );\n  }\n\n  public stop(): void {\n    this._actor.sx = 0;\n    this._actor.sy = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class ScaleBy implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _startScale: Vector;\n  private _endScale: Vector;\n  private _offset: Vector;\n  private _distanceX: number;\n  private _distanceY: number;\n  private _directionX: number;\n  private _directionY: number;\n  private _started = false;\n  private _stopped = false;\n  private _speedX: number;\n  private _speedY: number;\n  constructor(actor: Actor, scaleOffsetX: number, scaleOffsetY: number, speed: number) {\n    this._actor = actor;\n    this._offset = new Vector(scaleOffsetX, scaleOffsetY);\n    this._speedX = this._speedY = speed;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._startScale = this._actor.scale.clone();\n      this._endScale = this._startScale.add(this._offset);\n      this._distanceX = Math.abs(this._endScale.x - this._startScale.x);\n      this._distanceY = Math.abs(this._endScale.y - this._startScale.y);\n      this._directionX = this._endScale.x < this._startScale.x ? -1 : 1;\n      this._directionY = this._endScale.y < this._startScale.y ? -1 : 1;\n    }\n\n    this._actor.sx = this._speedX * this._directionX;\n    this._actor.sy = this._speedY * this._directionY;\n\n    if (this.isComplete()) {\n      this._actor.scale = this._endScale;\n      this._actor.sx = 0;\n      this._actor.sy = 0;\n    }\n  }\n\n  public isComplete(): boolean {\n    return (\n      this._stopped ||\n      (Math.abs(this._actor.scale.x - this._startScale.x) >= this._distanceX &&\n        Math.abs(this._actor.scale.y - this._startScale.y) >= this._distanceY)\n    );\n  }\n\n  public stop(): void {\n    this._actor.sx = 0;\n    this._actor.sy = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class Delay implements Action {\n  public x: number;\n  public y: number;\n  private _actor: Actor;\n  private _elapsedTime: number = 0;\n  private _delay: number;\n  private _started: boolean = false;\n  private _stopped = false;\n  constructor(actor: Actor, delay: number) {\n    this._actor = actor;\n    this._delay = delay;\n  }\n\n  public update(delta: number): void {\n    if (!this._started) {\n      this._started = true;\n    }\n\n    this.x = this._actor.pos.x;\n    this.y = this._actor.pos.y;\n\n    this._elapsedTime += delta;\n  }\n\n  isComplete(): boolean {\n    return this._stopped || this._elapsedTime >= this._delay;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n  }\n\n  reset(): void {\n    this._elapsedTime = 0;\n    this._started = false;\n  }\n}\n\nexport class Blink implements Action {\n  private _timeVisible: number = 0;\n  private _timeNotVisible: number = 0;\n  private _elapsedTime: number = 0;\n  private _totalTime: number = 0;\n  private _actor: Actor;\n  private _duration: number;\n  private _stopped: boolean = false;\n  private _started: boolean = false;\n  constructor(actor: Actor, timeVisible: number, timeNotVisible: number, numBlinks: number = 1) {\n    this._actor = actor;\n    this._timeVisible = timeVisible;\n    this._timeNotVisible = timeNotVisible;\n    this._duration = (timeVisible + timeNotVisible) * numBlinks;\n  }\n\n  public update(delta: number): void {\n    if (!this._started) {\n      this._started = true;\n    }\n\n    this._elapsedTime += delta;\n    this._totalTime += delta;\n    if (this._actor.visible && this._elapsedTime >= this._timeVisible) {\n      this._actor.visible = false;\n      this._elapsedTime = 0;\n    }\n\n    if (!this._actor.visible && this._elapsedTime >= this._timeNotVisible) {\n      this._actor.visible = true;\n      this._elapsedTime = 0;\n    }\n\n    if (this.isComplete()) {\n      this._actor.visible = true;\n    }\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || this._totalTime >= this._duration;\n  }\n\n  public stop(): void {\n    this._actor.visible = true;\n    this._stopped = true;\n  }\n\n  public reset() {\n    this._started = false;\n    this._elapsedTime = 0;\n    this._totalTime = 0;\n  }\n}\n\nexport class Fade implements Action {\n  public x: number;\n  public y: number;\n\n  private _actor: Actor;\n  private _endOpacity: number;\n  private _speed: number;\n  private _multiplier: number = 1;\n  private _started = false;\n  private _stopped = false;\n\n  constructor(actor: Actor, endOpacity: number, speed: number) {\n    this._actor = actor;\n    this._endOpacity = endOpacity;\n    this._speed = speed;\n  }\n\n  public update(delta: number): void {\n    if (!this._started) {\n      this._started = true;\n\n      // determine direction when we start\n      if (this._endOpacity < this._actor.opacity) {\n        this._multiplier = -1;\n      } else {\n        this._multiplier = 1;\n      }\n    }\n\n    if (this._speed > 0) {\n      this._actor.opacity += (this._multiplier * (Math.abs(this._actor.opacity - this._endOpacity) * delta)) / this._speed;\n    }\n\n    this._speed -= delta;\n\n    if (this.isComplete()) {\n      this._actor.opacity = this._endOpacity;\n    }\n\n    Logger.getInstance().debug('[Action fade] Actor opacity:', this._actor.opacity);\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || Math.abs(this._actor.opacity - this._endOpacity) < 0.05;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class Die implements Action {\n  public x: number;\n  public y: number;\n\n  private _actor: Actor;\n  private _stopped = false;\n\n  constructor(actor: Actor) {\n    this._actor = actor;\n  }\n\n  public update(_delta: number): void {\n    this._actor.actionQueue.clearActions();\n    this._actor.kill();\n    this._stopped = true;\n  }\n\n  public isComplete(): boolean {\n    return this._stopped;\n  }\n\n  public stop(): void {\n    return;\n  }\n\n  public reset(): void {\n    return;\n  }\n}\n\nexport class CallMethod implements Action {\n  public x: number;\n  public y: number;\n  private _method: () => any = null;\n  private _actor: Actor = null;\n  private _hasBeenCalled: boolean = false;\n  constructor(actor: Actor, method: () => any) {\n    this._actor = actor;\n    this._method = method;\n  }\n\n  public update(_delta: number) {\n    this._method.call(this._actor);\n    this._hasBeenCalled = true;\n  }\n  public isComplete() {\n    return this._hasBeenCalled;\n  }\n  public reset() {\n    this._hasBeenCalled = false;\n  }\n  public stop() {\n    this._hasBeenCalled = true;\n  }\n}\n\nexport class Repeat implements Action {\n  public x: number;\n  public y: number;\n  private _actor: Actor;\n  private _actionQueue: ActionQueue;\n  private _repeat: number;\n  private _originalRepeat: number;\n  private _stopped: boolean = false;\n  constructor(actor: Actor, repeat: number, actions: Action[]) {\n    this._actor = actor;\n    this._actionQueue = new ActionQueue(actor);\n    this._repeat = repeat;\n    this._originalRepeat = repeat;\n\n    const len = actions.length;\n    for (let i = 0; i < len; i++) {\n      actions[i].reset();\n      this._actionQueue.add(actions[i]);\n    }\n  }\n\n  public update(delta: number): void {\n    this.x = this._actor.pos.x;\n    this.y = this._actor.pos.y;\n    if (!this._actionQueue.hasNext()) {\n      this._actionQueue.reset();\n      this._repeat--;\n    }\n    this._actionQueue.update(delta);\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || this._repeat <= 0;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._repeat = this._originalRepeat;\n  }\n}\n\nexport class RepeatForever implements Action {\n  public x: number;\n  public y: number;\n  private _actor: Actor;\n  private _actionQueue: ActionQueue;\n  private _stopped: boolean = false;\n  constructor(actor: Actor, actions: Action[]) {\n    this._actor = actor;\n    this._actionQueue = new ActionQueue(actor);\n\n    const len = actions.length;\n    for (let i = 0; i < len; i++) {\n      actions[i].reset();\n      this._actionQueue.add(actions[i]);\n    }\n  }\n\n  public update(delta: number): void {\n    this.x = this._actor.pos.x;\n    this.y = this._actor.pos.y;\n    if (this._stopped) {\n      return;\n    }\n\n    if (!this._actionQueue.hasNext()) {\n      this._actionQueue.reset();\n    }\n\n    this._actionQueue.update(delta);\n  }\n\n  public isComplete(): boolean {\n    return this._stopped;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n    this._actionQueue.clearActions();\n  }\n\n  public reset(): void {\n    return;\n  }\n}\n\n/**\n * Action Queues\n *\n * Action queues are part of the [[ActionContext|Action API]] and\n * store the list of actions to be executed for an [[Actor]].\n *\n * Actors implement [[Actor.actions]] which can be manipulated by\n * advanced users to adjust the actions currently being executed in the\n * queue.\n */\nexport class ActionQueue {\n  private _actor: Actor;\n  private _actions: Action[] = [];\n  private _currentAction: Action;\n  private _completedActions: Action[] = [];\n  constructor(actor: Actor) {\n    this._actor = actor;\n  }\n\n  public add(action: Action) {\n    this._actions.push(action);\n  }\n\n  public remove(action: Action) {\n    const index = this._actions.indexOf(action);\n    this._actions.splice(index, 1);\n  }\n\n  public clearActions(): void {\n    this._actions.length = 0;\n    this._completedActions.length = 0;\n    if (this._currentAction) {\n      this._currentAction.stop();\n    }\n  }\n\n  public getActions(): Action[] {\n    return this._actions.concat(this._completedActions);\n  }\n\n  public hasNext(): boolean {\n    return this._actions.length > 0;\n  }\n\n  public reset(): void {\n    this._actions = this.getActions();\n\n    const len = this._actions.length;\n    for (let i = 0; i < len; i++) {\n      this._actions[i].reset();\n    }\n    this._completedActions = [];\n  }\n\n  public update(delta: number) {\n    if (this._actions.length > 0) {\n      this._currentAction = this._actions[0];\n      this._currentAction.update(delta);\n\n      if (this._currentAction.isComplete(this._actor)) {\n        this._completedActions.push(this._actions.shift());\n      }\n    }\n  }\n}\n","import { Vector } from '../Algebra';\n\n/**\n * A definition of an EasingFunction. See [[EasingFunctions]].\n */\n// tslint:disable-next-line\nexport interface EasingFunction {\n  (currentTime: number, startValue: number, endValue: number, duration: number): number;\n}\n\n/**\n * Standard easing functions for motion in Excalibur, defined on a domain of [0, duration] and a range from [+startValue,+endValue]\n * Given a time, the function will return a value from positive startValue to positive endValue.\n *\n * ```js\n * function Linear (t) {\n *    return t * t;\n * }\n *\n * // accelerating from zero velocity\n * function EaseInQuad (t) {\n *    return t * t;\n * }\n *\n * // decelerating to zero velocity\n * function EaseOutQuad (t) {\n *    return t * (2 - t);\n * }\n *\n * // acceleration until halfway, then deceleration\n * function EaseInOutQuad (t) {\n *    return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n * }\n *\n * // accelerating from zero velocity\n * function EaseInCubic (t) {\n *    return t * t * t;\n * }\n *\n * // decelerating to zero velocity\n * function EaseOutCubic (t) {\n *    return (--t) * t * t + 1;\n * }\n *\n * // acceleration until halfway, then deceleration\n * function EaseInOutCubic (t) {\n *    return t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n * }\n * ```\n */\nexport class EasingFunctions {\n  public static CreateReversableEasingFunction(easing: EasingFunction) {\n    return (time: number, start: number, end: number, duration: number) => {\n      if (end < start) {\n        return start - (easing(time, end, start, duration) - end);\n      } else {\n        return easing(time, start, end, duration);\n      }\n    };\n  }\n\n  public static CreateVectorEasingFunction(easing: EasingFunction) {\n    return (time: number, start: Vector, end: Vector, duration: number) => {\n      return new Vector(easing(time, start.x, end.x, duration), easing(time, start.y, end.y, duration));\n    };\n  }\n\n  public static Linear: EasingFunction = EasingFunctions.CreateReversableEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      return (endValue * currentTime) / duration + startValue;\n    }\n  );\n\n  public static EaseInQuad = EasingFunctions.CreateReversableEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n\n      return endValue * currentTime * currentTime + startValue;\n    }\n  );\n\n  public static EaseOutQuad: EasingFunction = EasingFunctions.CreateReversableEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      return -endValue * currentTime * (currentTime - 2) + startValue;\n    }\n  );\n\n  public static EaseInOutQuad: EasingFunction = EasingFunctions.CreateReversableEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration / 2;\n\n      if (currentTime < 1) {\n        return (endValue / 2) * currentTime * currentTime + startValue;\n      }\n      currentTime--;\n\n      return (-endValue / 2) * (currentTime * (currentTime - 2) - 1) + startValue;\n    }\n  );\n\n  public static EaseInCubic: EasingFunction = EasingFunctions.CreateReversableEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      return endValue * currentTime * currentTime * currentTime + startValue;\n    }\n  );\n\n  public static EaseOutCubic: EasingFunction = EasingFunctions.CreateReversableEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      currentTime--;\n      return endValue * (currentTime * currentTime * currentTime + 1) + startValue;\n    }\n  );\n\n  public static EaseInOutCubic: EasingFunction = EasingFunctions.CreateReversableEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration / 2;\n      if (currentTime < 1) {\n        return (endValue / 2) * currentTime * currentTime * currentTime + startValue;\n      }\n      currentTime -= 2;\n      return (endValue / 2) * (currentTime * currentTime * currentTime + 2) + startValue;\n    }\n  );\n}\n","import * as Actions from './Action';\nimport { RotationType } from './RotationType';\n\nimport { Actor } from '../Actor';\nimport { Promise } from '../Promises';\nimport { EasingFunction, EasingFunctions } from '../Util/EasingFunctions';\n\n/**\n * The fluent Action API allows you to perform \"actions\" on\n * [[Actor|Actors]] such as following, moving, rotating, and\n * more. You can implement your own actions by implementing\n * the [[IAction]] interface.\n *\n * [[include:Actions.md]]\n */\nexport class ActionContext {\n  private _actors: Actor[] = [];\n  private _queues: Actions.ActionQueue[] = [];\n\n  constructor();\n  constructor(actor: Actor);\n  constructor(actors: Actor[]);\n  constructor() {\n    if (arguments !== null) {\n      this._actors = Array.prototype.slice.call(arguments, 0);\n      this._queues = this._actors.map((a) => {\n        return a.actionQueue;\n      });\n    }\n  }\n\n  /**\n   * Clears all queued actions from the Actor\n   */\n  public clearActions(): void {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].clearActions();\n    }\n  }\n\n  public addActorToContext(actor: Actor) {\n    this._actors.push(actor);\n    // if we run into problems replace the line below with:\n    this._queues.push(actor.actionQueue);\n  }\n\n  public removeActorFromContext(actor: Actor) {\n    const index = this._actors.indexOf(actor);\n    if (index > -1) {\n      this._actors.splice(index, 1);\n      this._queues.splice(index, 1);\n    }\n  }\n\n  /**\n   * This method will move an actor to the specified `x` and `y` position over the\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param x         The x location to move the actor to\n   * @param y         The y location to move the actor to\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position\n   */\n  public easeTo(x: number, y: number, duration: number, easingFcn: EasingFunction = EasingFunctions.Linear) {\n    const len = this._queues.length;\n\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.EaseTo(this._actors[i], x, y, duration, easingFcn));\n    }\n\n    return this;\n  }\n\n  /**\n   * This method will move an actor to the specified x and y position at the\n   * speed specified (in pixels per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param x      The x location to move the actor to\n   * @param y      The y location to move the actor to\n   * @param speed  The speed in pixels per second to move\n   */\n  public moveTo(x: number, y: number, speed: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.MoveTo(this._actors[i], x, y, speed));\n    }\n\n    return this;\n  }\n\n  /**\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param xOffset     The x offset to apply to this actor\n   * @param yOffset     The y location to move the actor to\n   * @param speed  The speed in pixels per second the actor should move\n   */\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.MoveBy(this._actors[i], xOffset, yOffset, speed));\n    }\n    return this;\n  }\n\n  /**\n   * This method will rotate an actor to the specified angle at the speed\n   * specified (in radians per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param angleRadians  The angle to rotate to in radians\n   * @param speed         The angular velocity of the rotation specified in radians per second\n   * @param rotationType  The [[RotationType]] to use for this rotation\n   */\n  public rotateTo(angleRadians: number, speed: number, rotationType?: RotationType): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.RotateTo(this._actors[i], angleRadians, speed, rotationType));\n    }\n    return this;\n  }\n\n  /**\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\n   * in radians/sec and return back the actor. This method is part\n   * of the actor 'Action' fluent API allowing action chaining.\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\n   * @param speed          The speed in radians/sec the actor should rotate at\n   * @param rotationType  The [[RotationType]] to use for this rotation, default is shortest path\n   */\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.RotateBy(this._actors[i], angleRadiansOffset, speed, rotationType));\n    }\n    return this;\n  }\n\n  /**\n   * This method will scale an actor to the specified size at the speed\n   * specified (in magnitude increase per second) and return back the\n   * actor. This method is part of the actor 'Action' fluent API allowing\n   * action chaining.\n   * @param sizeX   The scaling factor to apply on X axis\n   * @param sizeY   The scaling factor to apply on Y axis\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\n   */\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.ScaleTo(this._actors[i], sizeX, sizeY, speedX, speedY));\n    }\n    return this;\n  }\n\n  /**\n   * This method will scale an actor by an amount relative to the current scale at a certin speed in scale units/sec\n   * and return back the actor. This method is part of the\n   * actor 'Action' fluent API allowing action chaining.\n   * @param sizeOffsetX   The scaling factor to apply on X axis\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\n   * @param speed    The speed to scale at in scale units/sec\n   */\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.ScaleBy(this._actors[i], sizeOffsetX, sizeOffsetY, speed));\n    }\n    return this;\n  }\n\n  /**\n   * This method will cause an actor to blink (become visible and not\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\n   * the actor should be visible per blink, and the amount of time not visible.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\n   * @param numBlinks       The number of times to blink\n   */\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks: number = 1): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.Blink(this._actors[i], timeVisible, timeNotVisible, numBlinks));\n    }\n    return this;\n  }\n\n  /**\n   * This method will cause an actor's opacity to change from its current value\n   * to the provided value by a specified time (in milliseconds). This method is\n   * part of the actor 'Action' fluent API allowing action chaining.\n   * @param opacity  The ending opacity\n   * @param time     The time it should take to fade the actor (in milliseconds)\n   */\n  public fade(opacity: number, time: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.Fade(this._actors[i], opacity, time));\n    }\n    return this;\n  }\n\n  /**\n   * This method will delay the next action from executing for a certain\n   * amount of time (in milliseconds). This method is part of the actor\n   * 'Action' fluent API allowing action chaining.\n   * @param time  The amount of time to delay the next action in the queue from executing in milliseconds\n   */\n  public delay(time: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.Delay(this._actors[i], time));\n    }\n    return this;\n  }\n\n  /**\n   * This method will add an action to the queue that will remove the actor from the\n   * scene once it has completed its previous actions. Any actions on the\n   * action queue after this action will not be executed.\n   */\n  public die(): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.Die(this._actors[i]));\n    }\n    return this;\n  }\n\n  /**\n   * This method allows you to call an arbitrary method as the next action in the\n   * action queue. This is useful if you want to execute code in after a specific\n   * action, i.e An actor arrives at a destination after traversing a path\n   */\n  public callMethod(method: () => any): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.CallMethod(this._actors[i], method));\n    }\n    return this;\n  }\n\n  /**\n   * This method will cause the actor to repeat all of the previously\n   * called actions a certain number of times. If the number of repeats\n   * is not specified it will repeat forever. This method is part of\n   * the actor 'Action' fluent API allowing action chaining\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\n   * will repeat forever\n   */\n  public repeat(times?: number): ActionContext {\n    if (!times) {\n      this.repeatForever();\n      return this;\n    }\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.Repeat(this._actors[i], times, this._actors[i].actionQueue.getActions()));\n    }\n\n    return this;\n  }\n\n  /**\n   * This method will cause the actor to repeat all of the previously\n   * called actions forever. This method is part of the actor 'Action'\n   * fluent API allowing action chaining.\n   */\n  public repeatForever(): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.RepeatForever(this._actors[i], this._actors[i].actionQueue.getActions()));\n    }\n    return this;\n  }\n\n  /**\n   * This method will cause the actor to follow another at a specified distance\n   * @param actor           The actor to follow\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\n   */\n  public follow(actor: Actor, followDistance?: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      if (followDistance === undefined) {\n        this._queues[i].add(new Actions.Follow(this._actors[i], actor));\n      } else {\n        this._queues[i].add(new Actions.Follow(this._actors[i], actor, followDistance));\n      }\n    }\n    return this;\n  }\n\n  /**\n   * This method will cause the actor to move towards another until they\n   * collide \"meet\" at a specified speed.\n   * @param actor  The actor to meet\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\n   */\n  public meet(actor: Actor, speed?: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      if (speed === undefined) {\n        this._queues[i].add(new Actions.Meet(this._actors[i], actor));\n      } else {\n        this._queues[i].add(new Actions.Meet(this._actors[i], actor, speed));\n      }\n    }\n    return this;\n  }\n\n  /**\n   * Returns a promise that resolves when the current action queue up to now\n   * is finished.\n   */\n  public asPromise<T>(): Promise<T> {\n    const promises = this._queues.map((q, i) => {\n      const temp = new Promise<T>();\n      q.add(\n        new Actions.CallMethod(this._actors[i], () => {\n          temp.resolve();\n        })\n      );\n      return temp;\n    });\n    return Promise.join.apply(this, promises);\n  }\n}\n","import { ConvexPolygon } from './ConvexPolygon';\nimport { Circle } from './Circle';\nimport { Edge } from './Edge';\nimport { BoundingBox } from './BoundingBox';\nimport { Vector } from '../Algebra';\n\n/**\n * Excalibur shape helper for defining collision shapes quickly\n */\nexport class Shape {\n  /**\n   * Creates a box collision shape, under the hood defines a [[ConvexPolygon]] collision shape\n   * @param width Width of the box\n   * @param height Height of the box\n   * @param anchor Anchor of the box (default (.5, .5)) which positions the box relative to the center of the collider's position\n   * @param offset Optional offset relative to the collider in local coordinates\n   */\n  static Box(width: number, height: number, anchor: Vector = Vector.Half, offset: Vector = Vector.Zero): ConvexPolygon {\n    return new ConvexPolygon({\n      points: new BoundingBox(-width * anchor.x, -height * anchor.y, width - width * anchor.x, height - height * anchor.y).getPoints(),\n      offset: offset\n    });\n  }\n\n  /**\n   * Creates a new [[arbitrary polygon|ConvexPolygon]] collision shape\n   * @param points Points specified in counter clockwise\n   * @param clockwiseWinding Optionally changed the winding of points, by default false meaning counter-clockwise winding.\n   * @param offset Optional offset relative to the collider in local coordinates\n   */\n  static Polygon(points: Vector[], clockwiseWinding: boolean = false, offset: Vector = Vector.Zero): ConvexPolygon {\n    return new ConvexPolygon({\n      points: points,\n      offset: offset,\n      clockwiseWinding: clockwiseWinding\n    });\n  }\n\n  /**\n   * Creates a new [[circle|Circle]] collision shape\n   * @param radius Radius of the circle shape\n   * @param offset Optional offset relative to the collider in local coordinates\n   */\n  static Circle(radius: number, offset: Vector = Vector.Zero): Circle {\n    return new Circle({\n      radius: radius,\n      offset: offset\n    });\n  }\n\n  /**\n   * Creates a new [[edge|Edge]] collision shape\n   * @param begin Beginning of the edge in local coordinates to the collider\n   * @param end Ending of the edge in local coordinates to the collider\n   */\n  static Edge(begin: Vector, end: Vector): Edge {\n    return new Edge({\n      begin: begin,\n      end: end\n    });\n  }\n}\n","import { Vector } from '../Algebra';\nimport { Actor } from '../Actor';\nimport { Collider } from './Collider';\nimport { CollisionType } from './CollisionType';\nimport { Physics } from '../Physics';\nimport { obsolete } from '../Util/Decorators';\nimport { PreCollisionEvent, PostCollisionEvent, CollisionStartEvent, CollisionEndEvent } from '../Events';\nimport { Clonable } from '../Interfaces/Clonable';\nimport { Shape } from './Shape';\n\nexport interface BodyOptions {\n  /**\n   * Optionally the actory associated with this body\n   */\n  actor?: Actor;\n  /**\n   * An optional collider to use in this body, if none is specified a default Box collider will be created.\n   */\n  collider?: Collider;\n}\n\n/**\n * Body describes all the physical properties pos, vel, acc, rotation, angular velocity\n */\nexport class Body implements Clonable<Body> {\n  private _collider: Collider;\n  public actor: Actor;\n  /**\n   * Constructs a new physics body associated with an actor\n   */\n  constructor({ actor, collider }: BodyOptions) {\n    if (!actor && !collider) {\n      throw new Error('An actor or collider are required to create a body');\n    }\n\n    this.actor = actor;\n    if (!collider && actor) {\n      this.collider = this.useBoxCollider(actor.width, actor.height, actor.anchor);\n    } else {\n      this.collider = collider;\n    }\n  }\n\n  public get id() {\n    return this.actor ? this.actor.id : -1;\n  }\n\n  /**\n   * Returns a clone of this body, not associated with any actor\n   */\n  public clone() {\n    return new Body({\n      actor: null,\n      collider: this.collider.clone()\n    });\n  }\n\n  public get active() {\n    return this.actor ? !this.actor.isKilled() : false;\n  }\n\n  public get center() {\n    return this.pos;\n  }\n\n  // TODO allow multiple colliders for a single body\n  public set collider(collider: Collider) {\n    if (collider) {\n      this._collider = collider;\n      this._collider.body = this;\n      this._wireColliderEventsToActor();\n    }\n  }\n\n  public get collider(): Collider {\n    return this._collider;\n  }\n\n  /**\n   * The (x, y) position of the actor this will be in the middle of the actor if the\n   * [[Actor.anchor]] is set to (0.5, 0.5) which is default.\n   * If you want the (x, y) position to be the top left of the actor specify an anchor of (0, 0).\n   */\n  public pos: Vector = new Vector(0, 0);\n\n  /**\n   * The position of the actor last frame (x, y) in pixels\n   */\n  public oldPos: Vector = new Vector(0, 0);\n\n  /**\n   * The current velocity vector (vx, vy) of the actor in pixels/second\n   */\n  public vel: Vector = new Vector(0, 0);\n\n  /**\n   * The velocity of the actor last frame (vx, vy) in pixels/second\n   */\n  public oldVel: Vector = new Vector(0, 0);\n\n  /**\n   * The curret acceleration vector (ax, ay) of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may\n   * be useful to simulate a gravitational effect.\n   */\n  public acc: Vector = new Vector(0, 0);\n\n  /**\n   * Gets/sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\n   */\n  public oldAcc: Vector = Vector.Zero;\n\n  /**\n   * The current torque applied to the actor\n   */\n  public torque: number = 0;\n\n  /**\n   * The current \"motion\" of the actor, used to calculated sleep in the physics simulation\n   */\n  public motion: number = 10;\n\n  /**\n   * Gets/sets the rotation of the body from the last frame.\n   */\n  public oldRotation: number = 0; // radians\n\n  /**\n   * The rotation of the actor in radians\n   */\n  public rotation: number = 0; // radians\n\n  /**\n   * The scale vector of the actor\n   */\n  public scale: Vector = Vector.One;\n\n  /**\n   * The scale of the actor last frame\n   */\n  public oldScale: Vector = Vector.One;\n\n  /**\n   * The x scalar velocity of the actor in scale/second\n   */\n  public sx: number = 0; //scale/sec\n  /**\n   * The y scalar velocity of the actor in scale/second\n   */\n  public sy: number = 0; //scale/sec\n\n  /**\n   * The rotational velocity of the actor in radians/second\n   */\n  public rx: number = 0; //radians/sec\n\n  private _geometryDirty = false;\n\n  private _totalMtv: Vector = Vector.Zero;\n\n  /**\n   * Add minimum translation vectors accumulated during the current frame to resolve collisions.\n   */\n  public addMtv(mtv: Vector) {\n    this._totalMtv.addEqual(mtv);\n  }\n\n  /**\n   * Applies the accumulated translation vectors to the actors position\n   */\n  public applyMtv(): void {\n    this.pos.addEqual(this._totalMtv);\n    this._totalMtv.setTo(0, 0);\n  }\n\n  /**\n   * Flags the shape dirty and must be recalculated in world space\n   */\n  public markCollisionShapeDirty() {\n    this._geometryDirty = true;\n  }\n\n  public get isColliderShapeDirty(): boolean {\n    return this._geometryDirty;\n  }\n\n  /**\n   * Sets the old versions of pos, vel, acc, and scale.\n   */\n  public captureOldTransform() {\n    // Capture old values before integration step updates them\n    this.oldVel.setTo(this.vel.x, this.vel.y);\n    this.oldPos.setTo(this.pos.x, this.pos.y);\n    this.oldAcc.setTo(this.acc.x, this.acc.y);\n    this.oldScale.setTo(this.scale.x, this.scale.y);\n    this.oldRotation = this.rotation;\n  }\n\n  /**\n   * Perform euler integration at the specified time step\n   */\n  public integrate(delta: number) {\n    // Update placements based on linear algebra\n    const seconds = delta / 1000;\n\n    const totalAcc = this.acc.clone();\n    // Only active vanilla actors are affected by global acceleration\n    if (this.collider.type === CollisionType.Active) {\n      totalAcc.addEqual(Physics.acc);\n    }\n\n    this.vel.addEqual(totalAcc.scale(seconds));\n    this.pos.addEqual(this.vel.scale(seconds)).addEqual(totalAcc.scale(0.5 * seconds * seconds));\n\n    this.rx += this.torque * (1.0 / this.collider.inertia) * seconds;\n    this.rotation += this.rx * seconds;\n\n    this.scale.x += (this.sx * delta) / 1000;\n    this.scale.y += (this.sy * delta) / 1000;\n\n    if (!this.scale.equals(this.oldScale)) {\n      // change in scale effects the geometry\n      this._geometryDirty = true;\n    }\n\n    // Update colliders\n    this.collider.update();\n    this._geometryDirty = false;\n  }\n\n  /**\n   * Sets up a box geometry based on the current bounds of the associated actor of this physics body.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  public useBoxCollider(width: number, height: number, anchor: Vector = Vector.Half, center: Vector = Vector.Zero): Collider {\n    this.collider.shape = Shape.Box(width, height, anchor, center);\n    return this.collider;\n  }\n\n  /**\n   * @obsolete Body.useBoxCollision will be removed in v0.24.0 use [[Body.useBoxCollider]]\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'Body.useBoxCollider' })\n  public useBoxCollision(center: Vector = Vector.Zero) {\n    this.useBoxCollider(this.actor.width, this.actor.height, this.actor.anchor, center);\n  }\n\n  /**\n   * Sets up a [[ConvexPolygon|convex polygon]] collision geometry based on a list of of points relative\n   *  to the anchor of the associated actor\n   * of this physics body.\n   *\n   * Only [convex polygon](https://en.wikipedia.org/wiki/Convex_polygon) definitions are supported.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  public usePolygonCollider(points: Vector[], center: Vector = Vector.Zero): Collider {\n    this.collider.shape = Shape.Polygon(points, false, center);\n    return this.collider;\n  }\n\n  /**\n   * @obsolete Body.usePolygonCollision will be removed in v0.24.0 use [[Body.usePolygonCollider]]\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'Body.usePolygonCollider' })\n  public usePolygonCollision(points: Vector[], center: Vector = Vector.Zero) {\n    this.usePolygonCollider(points, center);\n  }\n\n  /**\n   * Sets up a [[Circle|circle collision geometry]] with a specified radius in pixels.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  public useCircleCollider(radius: number, center: Vector = Vector.Zero): Collider {\n    this.collider.shape = Shape.Circle(radius, center);\n    return this.collider;\n  }\n\n  /**\n   * @obsolete Body.useCircleCollision will be removed in v0.24.0, use [[Body.useCircleCollider]]\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'Body.useCircleCollider' })\n  public useCircleCollision(radius?: number, center: Vector = Vector.Zero) {\n    this.useCircleCollider(radius, center);\n  }\n\n  /**\n   * Sets up an [[Edge|edge collision geometry]] with a start point and an end point relative to the anchor of the associated actor\n   * of this physics body.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  public useEdgeCollider(begin: Vector, end: Vector): Collider {\n    this.collider.shape = Shape.Edge(begin, end);\n    return this.collider;\n  }\n\n  /**\n   * @obsolete Body.useEdgeCollision will be removed in v0.24.0, use [[Body.useEdgeCollider]]\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'Body.useEdgeCollider' })\n  public useEdgeCollision(begin: Vector, end: Vector) {\n    this.useEdgeCollider(begin, end);\n  }\n\n  // TODO remove this, eventually events will stay local to the thing they are around\n  private _wireColliderEventsToActor() {\n    this.collider.clear();\n    this.collider.on('precollision', (evt: PreCollisionEvent<Collider>) => {\n      if (this.actor) {\n        this.actor.emit('precollision', new PreCollisionEvent(evt.target.body.actor, evt.other.body.actor, evt.side, evt.intersection));\n      }\n    });\n    this.collider.on('postcollision', (evt: PostCollisionEvent<Collider>) => {\n      if (this.actor) {\n        this.actor.emit('postcollision', new PostCollisionEvent(evt.target.body.actor, evt.other.body.actor, evt.side, evt.intersection));\n      }\n    });\n    this.collider.on('collisionstart', (evt: CollisionStartEvent<Collider>) => {\n      if (this.actor) {\n        this.actor.emit('collisionstart', new CollisionStartEvent(evt.target.body.actor, evt.other.body.actor, evt.pair));\n      }\n    });\n    this.collider.on('collisionend', (evt: CollisionEndEvent<Collider>) => {\n      if (this.actor) {\n        this.actor.emit('collisionend', new CollisionEndEvent(evt.target.body.actor, evt.other.body.actor));\n      }\n    });\n  }\n}\n","import { Trait } from '../Interfaces/Trait';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { Vector } from '../Algebra';\nimport { Side } from '../Collision/Side';\nimport { PreCollisionEvent, PostCollisionEvent } from '../Events';\nimport { CollisionType } from '../Collision/CollisionType';\nimport { BoundingBox } from '../Collision/Index';\n\nexport class TileMapCollisionDetection implements Trait {\n  public update(actor: Actor, engine: Engine) {\n    const eventDispatcher = actor.eventDispatcher;\n    if (actor.body.collider.type !== CollisionType.PreventCollision && engine.currentScene && engine.currentScene.tileMaps) {\n      for (let j = 0; j < engine.currentScene.tileMaps.length; j++) {\n        const map = engine.currentScene.tileMaps[j];\n        let intersectMap: Vector;\n        let side = Side.None;\n        let max = 2;\n        while ((intersectMap = map.collides(actor))) {\n          if (max-- < 0) {\n            break;\n          }\n          side = BoundingBox.getSideFromIntersection(intersectMap);\n          eventDispatcher.emit('precollision', new PreCollisionEvent(actor, null, side, intersectMap));\n          if (actor.body.collider.type === CollisionType.Active) {\n            actor.pos.y += intersectMap.y;\n            actor.pos.x += intersectMap.x;\n            eventDispatcher.emit('postcollision', new PostCollisionEvent(actor, null, side, intersectMap));\n          }\n        }\n      }\n    }\n  }\n}\n","import { Vector } from '../Algebra';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { Color } from '../Drawing/Color';\n\nexport class CullingBox {\n  private _topLeft: Vector = new Vector(0, 0);\n  private _topRight: Vector = new Vector(0, 0);\n  private _bottomLeft: Vector = new Vector(0, 0);\n  private _bottomRight: Vector = new Vector(0, 0);\n\n  private _xCoords: Array<number>;\n  private _yCoords: Array<number>;\n  private _xMin: number;\n  private _yMin: number;\n  private _xMax: number;\n  private _yMax: number;\n\n  private _xMinWorld: number;\n  private _yMinWorld: number;\n  private _xMaxWorld: number;\n  private _yMaxWorld: number;\n\n  public isSpriteOffScreen(actor: Actor, engine: Engine): boolean {\n    const drawingWidth = actor.currentDrawing.drawWidth;\n    const drawingHeight = actor.currentDrawing.drawHeight;\n    const rotation = actor.rotation;\n    const anchor = actor.center;\n    const worldPos = actor.getWorldPos();\n\n    this._topLeft.x = worldPos.x - drawingWidth / 2;\n    this._topLeft.y = worldPos.y - drawingHeight / 2;\n    this._topLeft = this._topLeft.rotate(rotation, anchor);\n\n    this._topRight.x = worldPos.x + drawingWidth / 2;\n    this._topRight.y = worldPos.y - drawingHeight / 2;\n    this._topRight = this._topRight.rotate(rotation, anchor);\n\n    this._bottomLeft.x = worldPos.x - drawingWidth / 2;\n    this._bottomLeft.y = worldPos.y + drawingHeight / 2;\n    this._bottomLeft = this._bottomLeft.rotate(rotation, anchor);\n\n    this._bottomRight.x = worldPos.x + drawingWidth / 2;\n    this._bottomRight.y = worldPos.y + drawingHeight / 2;\n    this._bottomRight = this._bottomRight.rotate(rotation, anchor);\n\n    ///\n\n    const topLeftScreen = engine.worldToScreenCoordinates(this._topLeft);\n    const topRightScreen = engine.worldToScreenCoordinates(this._topRight);\n    const bottomLeftScreen = engine.worldToScreenCoordinates(this._bottomLeft);\n    const bottomRightScreen = engine.worldToScreenCoordinates(this._bottomRight);\n    this._xCoords = [];\n    this._yCoords = [];\n\n    this._xCoords.push(topLeftScreen.x, topRightScreen.x, bottomLeftScreen.x, bottomRightScreen.x);\n    this._yCoords.push(topLeftScreen.y, topRightScreen.y, bottomLeftScreen.y, bottomRightScreen.y);\n\n    this._xMin = Math.min.apply(null, this._xCoords);\n    this._yMin = Math.min.apply(null, this._yCoords);\n    this._xMax = Math.max.apply(null, this._xCoords);\n    this._yMax = Math.max.apply(null, this._yCoords);\n\n    const minWorld = engine.screenToWorldCoordinates(new Vector(this._xMin, this._yMin));\n    const maxWorld = engine.screenToWorldCoordinates(new Vector(this._xMax, this._yMax));\n    this._xMinWorld = minWorld.x;\n    this._yMinWorld = minWorld.y;\n    this._xMaxWorld = maxWorld.x;\n    this._yMaxWorld = maxWorld.y;\n\n    const boundingPoints = [\n      new Vector(this._xMin, this._yMin), // topleft\n      new Vector(this._xMax, this._yMin), // topright\n      new Vector(this._xMin, this._yMax), // bottomleft\n      new Vector(this._xMax, this._yMax)\n    ]; // bottomright\n\n    // sprite can be wider than canvas screen (and still visible within canvas)\n    // top or bottom of sprite must be within canvas\n    if (\n      boundingPoints[0].x < 0 &&\n      boundingPoints[1].x > engine.canvas.clientWidth &&\n      (boundingPoints[0].y > 0 || boundingPoints[2].y < engine.canvas.clientHeight)\n    ) {\n      return false;\n    }\n\n    // sprite can be taller than canvas screen (and still visible within canvas)\n    // left or right of sprite must be within canvas\n    if (\n      boundingPoints[0].y < 0 &&\n      boundingPoints[2].y > engine.canvas.clientHeight &&\n      (boundingPoints[1].x > 0 || boundingPoints[0].x < engine.canvas.clientWidth)\n    ) {\n      return false;\n    }\n\n    // otherwise if any corner is visible, we're not offscreen\n    for (let i = 0; i < boundingPoints.length; i++) {\n      if (\n        boundingPoints[i].x > 0 &&\n        boundingPoints[i].y > 0 &&\n        boundingPoints[i].x < engine.canvas.clientWidth &&\n        boundingPoints[i].y < engine.canvas.clientHeight\n      ) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    // bounding rectangle\n    ctx.beginPath();\n    ctx.strokeStyle = Color.White.toString();\n    ctx.rect(this._xMinWorld, this._yMinWorld, this._xMaxWorld - this._xMinWorld, this._yMaxWorld - this._yMinWorld);\n    ctx.stroke();\n\n    ctx.fillStyle = Color.Red.toString();\n    ctx.beginPath();\n    ctx.arc(this._topLeft.x, this._topLeft.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Green.toString();\n    ctx.beginPath();\n    ctx.arc(this._topRight.x, this._topRight.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Blue.toString();\n    ctx.beginPath();\n    ctx.arc(this._bottomLeft.x, this._bottomLeft.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Magenta.toString();\n    ctx.beginPath();\n    ctx.arc(this._bottomRight.x, this._bottomRight.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n  }\n}\n","import { CullingBox } from './../Util/CullingBox';\nimport { Trait } from '../Interfaces/Trait';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { ExitViewPortEvent, EnterViewPortEvent } from '../Events';\n\nexport class OffscreenCulling implements Trait {\n  public cullingBox: CullingBox = new CullingBox();\n\n  public update(actor: Actor, engine: Engine) {\n    const events = actor.eventDispatcher;\n\n    let isSpriteOffScreen = true;\n    if (actor.currentDrawing != null) {\n      isSpriteOffScreen = this.cullingBox.isSpriteOffScreen(actor, engine);\n    }\n\n    let actorBoundsOffscreen = false;\n    if (engine && engine.currentScene && engine.currentScene.camera && engine.currentScene.camera.viewport) {\n      actorBoundsOffscreen = !engine.currentScene.camera.viewport.intersect(actor.body.collider.bounds);\n    }\n\n    if (!actor.isOffScreen) {\n      if (actorBoundsOffscreen && isSpriteOffScreen) {\n        events.emit('exitviewport', new ExitViewPortEvent(actor));\n        actor.isOffScreen = true;\n      }\n    } else {\n      if (!actorBoundsOffscreen || !isSpriteOffScreen) {\n        events.emit('enterviewport', new EnterViewPortEvent(actor));\n        actor.isOffScreen = false;\n      }\n    }\n  }\n}\n","import { Trait } from '../Interfaces/Trait';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\n\nexport interface CapturePointerConfig {\n  /**\n   * Capture PointerMove events (may be expensive!)\n   */\n  captureMoveEvents: boolean;\n\n  /**\n   * Capture PointerDrag events (may be expensive!)\n   */\n  captureDragEvents: boolean;\n}\n\n/**\n * Revises pointer events path accordingly to the actor\n */\nexport class CapturePointer implements Trait {\n  public update(actor: Actor, engine: Engine) {\n    if (!actor.enableCapturePointer) {\n      return;\n    }\n    if (actor.isKilled()) {\n      return;\n    }\n\n    engine.input.pointers.revisePointerEventsPaths(actor);\n  }\n}\n","import { Color } from '../Drawing/Color';\nimport { Vector } from '../Algebra';\n\n/**\n * A canvas linecap style. \"butt\" is the default flush style, \"round\" is a semi-circle cap with a radius half the width of\n * the line, and \"square\" is a rectangle that is an equal width and half height cap.\n */\nexport type LineCapStyle = 'butt' | 'round' | 'square';\n\n/**\n * Draw a line on canvas context\n *\n * @param ctx The canvas context\n * @param color The color of the line\n * @param x1 The start x coordinate\n * @param y1 The start y coordinate\n * @param x2 The ending x coordinate\n * @param y2 The ending y coordinate\n * @param thickness The line thickness\n * @param cap The [[LineCapStyle]] (butt, round, or square)\n */\n/* istanbul ignore next */\nexport function line(\n  ctx: CanvasRenderingContext2D,\n  color: Color = Color.Red,\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number,\n  thickness: number = 1,\n  cap: LineCapStyle = 'butt'\n) {\n  ctx.beginPath();\n  ctx.lineWidth = thickness;\n  ctx.lineCap = cap;\n  ctx.strokeStyle = color.toString();\n  ctx.moveTo(x1, y1);\n  ctx.lineTo(x2, y2);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/**\n * Draw the vector as a point onto the canvas.\n */\n/* istanbul ignore next */\nexport function point(ctx: CanvasRenderingContext2D, color: Color = Color.Red, point: Vector): void {\n  ctx.beginPath();\n  ctx.strokeStyle = color.toString();\n  ctx.arc(point.x, point.y, 5, 0, Math.PI * 2);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/**\n * Draw the vector as a line onto the canvas starting a origin point.\n */\n/* istanbul ignore next */\nexport function vector(ctx: CanvasRenderingContext2D, color: Color, origin: Vector, vector: Vector, scale: number = 1.0): void {\n  const c = color ? color.toString() : 'blue';\n  const v = vector.scale(scale);\n  ctx.beginPath();\n  ctx.strokeStyle = c;\n  ctx.moveTo(origin.x, origin.y);\n  ctx.lineTo(origin.x + v.x, origin.y + v.y);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/**\n * Represents border radius values\n */\nexport interface BorderRadius {\n  /**\n   * Top-left\n   */\n  tl: number;\n  /**\n   * Top-right\n   */\n  tr: number;\n  /**\n   * Bottom-right\n   */\n  br: number;\n  /**\n   * Bottom-left\n   */\n  bl: number;\n}\n\n/**\n * Draw a round rectangle on a canvas context\n *\n * @param ctx The canvas context\n * @param x The top-left x coordinate\n * @param y The top-left y coordinate\n * @param width The width of the rectangle\n * @param height The height of the rectangle\n * @param radius The border radius of the rectangle\n * @param fill The [[Color]] to fill rectangle with\n * @param stroke The [[Color]] to stroke rectangle with\n */\nexport function roundRect(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  radius: number | BorderRadius = 5,\n  stroke: Color = Color.White,\n  fill: Color = null\n) {\n  let br: BorderRadius;\n\n  if (typeof radius === 'number') {\n    br = { tl: radius, tr: radius, br: radius, bl: radius };\n  } else {\n    const defaultRadius: BorderRadius = { tl: 0, tr: 0, br: 0, bl: 0 };\n\n    for (const prop in defaultRadius) {\n      if (defaultRadius.hasOwnProperty(prop)) {\n        const side = <keyof BorderRadius>prop;\n        br[side] = radius[side] || defaultRadius[side];\n      }\n    }\n  }\n\n  ctx.beginPath();\n  ctx.moveTo(x + br.tl, y);\n  ctx.lineTo(x + width - br.tr, y);\n  ctx.quadraticCurveTo(x + width, y, x + width, y + br.tr);\n  ctx.lineTo(x + width, y + height - br.br);\n  ctx.quadraticCurveTo(x + width, y + height, x + width - br.br, y + height);\n  ctx.lineTo(x + br.bl, y + height);\n  ctx.quadraticCurveTo(x, y + height, x, y + height - br.bl);\n  ctx.lineTo(x, y + br.tl);\n  ctx.quadraticCurveTo(x, y, x + br.tl, y);\n  ctx.closePath();\n\n  if (fill) {\n    ctx.fillStyle = fill.toString();\n    ctx.fill();\n  }\n\n  if (stroke) {\n    ctx.strokeStyle = stroke.toString();\n    ctx.stroke();\n  }\n}\n\nexport function circle(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  radius: number,\n  stroke: Color = Color.White,\n  fill: Color = null\n) {\n  ctx.beginPath();\n  ctx.arc(x, y, radius, 0, Math.PI * 2);\n  ctx.closePath();\n\n  if (fill) {\n    ctx.fillStyle = fill.toString();\n    ctx.fill();\n  }\n\n  if (stroke) {\n    ctx.strokeStyle = stroke.toString();\n    ctx.stroke();\n  }\n}\n","/**\n * CollisionGroups indicate like members that do not collide with each other. Use [[CollisionGroupManager]] to create [[CollisionGroup]]s\n *\n * For example:\n *\n * Players have collision group \"player\"\n *\n * ![Player Collision Group](/assets/images/docs/CollisionGroupsPlayer.png)\n *\n * Enemies have collision group \"enemy\"\n *\n * ![Enemy Collision Group](/assets/images/docs/CollisionGroupsEnemy.png)\n *\n * Blocks have collision group \"ground\"\n *\n * ![Ground collision group](/assets/images/docs/CollisionGroupsGround.png)\n *\n * Players don't collide with each other, but enemies and blocks. Likewise, enemies don't collide with each other but collide\n * with players and blocks.\n *\n * This is done with bitmasking, see the following pseudo-code\n *\n * PlayerGroup = `0b001`\n * PlayerGroupMask = `0b110`\n *\n * EnemyGroup = `0b010`\n * EnemyGroupMask = `0b101`\n *\n * BlockGroup = `0b100`\n * BlockGroupMask = `0b011`\n *\n * Should Players collide? No because the bitwise mask evaluates to 0\n * `(player1.group & player2.mask) === 0`\n * `(0b001 & 0b110) === 0`\n *\n * Should Players and Enemies collide? Yes because the bitwise mask is non-zero\n * `(player1.group & enemy1.mask) === 1`\n * `(0b001 & 0b101) === 1`\n *\n * Should Players and Blocks collide? Yes because the bitwise mask is non-zero\n * `(player1.group & blocks1.mask) === 1`\n * `(0b001 & 0b011) === 1`\n */\nexport class CollisionGroup {\n  /**\n   * The `All` [[CollisionGroup]] is a special group that collides with all other groups including itself,\n   * it is the default collision group on colliders.\n   */\n  public static All = new CollisionGroup('Collide with all groups', -1, -1);\n\n  private _name: string;\n  private _category: number;\n  private _mask: number;\n\n  /**\n   * **STOP!!** It is preferred that [[CollisionGroupManager.create]] is used to create collision groups\n   *  unless you know how to construct the proper bitmasks. See https://github.com/excaliburjs/Excalibur/issues/1091 for more info.\n   * @param name Name of the collision group\n   * @param category 32 bit category for the group, should be a unique power of 2. For example `0b001` or `0b010`\n   * @param mask 32 bit mask of category, or `~category` generally. For a category of `0b001`, the mask would be `0b110`\n   */\n  constructor(name: string, category: number, mask: number) {\n    this._name = name;\n    this._category = category;\n    this._mask = mask;\n  }\n\n  /**\n   * Get the name of the collision group\n   */\n  public get name() {\n    return this._name;\n  }\n\n  /**\n   * Get the category of the collision group, a 32 bit number which should be a unique power of 2\n   */\n  public get category() {\n    return this._category;\n  }\n\n  /**\n   * Get the mask for this collision group\n   */\n  public get mask() {\n    return this._mask;\n  }\n\n  /**\n   * Evaluates whether 2 collision groups can collide\n   * @param other  CollisionGroup\n   */\n  public canCollide(other: CollisionGroup): boolean {\n    return (this.category & other.mask) !== 0 && (other.category & this.mask) !== 0;\n  }\n}\n","import { Physics } from './../Physics';\nimport { Color } from './../Drawing/Color';\nimport { CollisionContact } from './CollisionContact';\nimport { CollisionResolutionStrategy } from '../Physics';\nimport * as DrawUtil from '../Util/DrawUtil';\nimport { CollisionType } from './CollisionType';\nimport { Collider } from './Collider';\n\n/**\n * Models a potential collision between 2 bodies\n */\nexport class Pair {\n  public id: string = null;\n  public collision: CollisionContact = null;\n\n  constructor(public colliderA: Collider, public colliderB: Collider) {\n    this.id = Pair.calculatePairHash(colliderA, colliderB);\n  }\n\n  public static canCollide(colliderA: Collider, colliderB: Collider) {\n    // If both are in the same collision group short circuit\n    if (!colliderA.group.canCollide(colliderB.group)) {\n      return false;\n    }\n\n    // if both are fixed short circuit\n    if (colliderA.type === CollisionType.Fixed && colliderB.type === CollisionType.Fixed) {\n      return false;\n    }\n\n    // if the either is prevent collision short circuit\n    if (colliderB.type === CollisionType.PreventCollision || colliderA.type === CollisionType.PreventCollision) {\n      return false;\n    }\n\n    // if either is dead short circuit\n    if (!colliderA.active || !colliderB.active) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Returns whether or not it is possible for the pairs to collide\n   */\n  public get canCollide(): boolean {\n    const actorA = this.colliderA;\n    const actorB = this.colliderB;\n    return Pair.canCollide(actorA, actorB);\n  }\n\n  /**\n   * Runs the collison intersection logic on the members of this pair\n   */\n  public collide() {\n    this.collision = this.colliderA.collide(this.colliderB);\n  }\n\n  /**\n   * Resovles the collision body position and velocity if a collision occured\n   */\n  public resolve(strategy: CollisionResolutionStrategy) {\n    if (this.collision) {\n      this.collision.resolve(strategy);\n    }\n  }\n\n  /**\n   * Calculates the unique pair hash id for this collision pair\n   */\n  public static calculatePairHash(colliderA: Collider, colliderB: Collider): string {\n    if (colliderA.id < colliderB.id) {\n      return `#${colliderA.id}+${colliderB.id}`;\n    } else {\n      return `#${colliderB.id}+${colliderA.id}`;\n    }\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    if (this.collision) {\n      if (Physics.showContacts) {\n        DrawUtil.point(ctx, Color.Red, this.collision.point);\n      }\n      if (Physics.showCollisionNormals) {\n        DrawUtil.vector(ctx, Color.Cyan, this.collision.point, this.collision.normal, 30);\n      }\n    }\n  }\n}\n","import { Color } from '../Drawing/Color';\nimport * as DrawUtil from '../Util/DrawUtil';\nimport { Eventable } from '../Interfaces/Index';\nimport { GameEvent } from '../Events';\nimport { Actor } from '../Actor';\nimport { Body } from './Body';\nimport { CollisionShape } from './CollisionShape';\nimport { Vector } from '../Algebra';\nimport { Physics } from '../Physics';\nimport { BoundingBox } from './BoundingBox';\nimport { CollisionType } from './CollisionType';\nimport { CollisionGroup } from './CollisionGroup';\nimport { CollisionContact } from './CollisionContact';\nimport { EventDispatcher } from '../EventDispatcher';\nimport { Pair } from './Pair';\nimport { Clonable } from '../Interfaces/Clonable';\n\n/**\n * Type guard function to determine whether something is a Collider\n */\nexport function isCollider(x: Actor | Collider): x is Collider {\n  return x instanceof Collider;\n}\n\nexport interface ColliderOptions {\n  /**\n   * Optional [[shape|Shape]] to use with this collider, the shape defines the collidable region along with the [[bounding box|BoundingBox]]\n   */\n  shape?: CollisionShape;\n  /**\n   * Optional body to associate with this collider\n   */\n  body?: Body;\n  /**\n   * Optional pixel offset from the position of the body\n   */\n  offset?: Vector;\n  /**\n   * Optional collision group on this collider\n   */\n  group?: CollisionGroup;\n  /**\n   * Optional [[collision type|CollisionType]], if not specified the default is [[CollisionType.PreventCollision]]\n   */\n  type?: CollisionType;\n  /**\n   * Optional local bounds if other bounds are required instead of the bounding box from the shape. This overrides shape bounds.\n   */\n  localBounds?: BoundingBox;\n  /**\n   * Optional flag to indicate moment of inertia from the shape should be used, by default it is true.\n   */\n  useShapeInertia?: boolean;\n}\n\n/**\n * Collider describes material properties like shape,\n * bounds, friction of the physics object. Only **one** collider can be associated with a body at a time\n */\n\nexport class Collider implements Eventable, Clonable<Collider> {\n  private _shape: CollisionShape;\n  public useShapeInertia: boolean;\n  private _events: EventDispatcher<Collider> = new EventDispatcher<Collider>(this);\n\n  constructor({ body, type, group, shape, offset, useShapeInertia = true }: ColliderOptions) {\n    // If shape is not supplied see if the body has an existing collider with a shape\n    if (body && body.collider && !shape) {\n      this._shape = body.collider.shape;\n    } else {\n      this._shape = shape;\n      this.body = body;\n    }\n    this.useShapeInertia = useShapeInertia;\n    this._shape.collider = this;\n    this.type = type || this.type;\n    this.group = group || this.group;\n    this.offset = offset || Vector.Zero;\n  }\n\n  /**\n   * Returns a clone of the current collider, not associated with any body\n   */\n  public clone() {\n    return new Collider({\n      body: null,\n      type: this.type,\n      shape: this._shape.clone(),\n      group: this.group,\n      offset: this.offset\n    });\n  }\n\n  /**\n   * Get the unique id of the collider\n   */\n  public get id(): number {\n    return this.body ? this.body.id : -1;\n  }\n\n  /**\n   * Gets or sets the current collision type of this collider. By\n   * default it is ([[CollisionType.PreventCollision]]).\n   */\n  public type: CollisionType = CollisionType.PreventCollision;\n\n  /**\n   * Gets or sets the current [[CollisionGroup|collision group]] for the collider, colliders with like collision groups do not collide.\n   * By default, the collider will collide with [[CollisionGroup|all groups]].\n   */\n  public group: CollisionGroup = CollisionGroup.All;\n\n  /*\n   * Get the shape of the collider as a [[CollisionShape]]\n   */\n  public get shape(): CollisionShape {\n    return this._shape;\n  }\n\n  /**\n   * Set the shape of the collider as a [[CollisionShape]], if useShapeInertia is set the collider will use inertia from the shape.\n   */\n  public set shape(shape: CollisionShape) {\n    this._shape = shape;\n    this._shape.collider = this;\n    if (this.useShapeInertia) {\n      this.inertia = isNaN(this._shape.inertia) ? this.inertia : this._shape.inertia;\n    }\n  }\n\n  /**\n   * Return a reference to the body associated with this collider\n   */\n  public body: Body;\n\n  /**\n   * The center of the collider in world space\n   */\n  public get center(): Vector {\n    return this.bounds.center;\n  }\n\n  /**\n   * Is this collider active, if false it wont collide\n   */\n  public get active(): boolean {\n    return this.body.active;\n  }\n\n  /**\n   * Collide 2 colliders and product a collision contact if there is a collision, null if none\n   *\n   * Collision vector is in the direction of the other collider. Away from this collider, this -> other.\n   * @param other\n   */\n  public collide(other: Collider): CollisionContact | null {\n    return this.shape.collide(other.shape);\n  }\n\n  /**\n   * Gets the current pixel offset of the collider\n   */\n  public get offset() {\n    return this.shape.offset.clone();\n  }\n\n  /**\n   * Sets the pixel offset of the collider\n   */\n  public set offset(offset: Vector) {\n    this.shape.offset = offset.clone();\n  }\n\n  /**\n   * The current mass of the actor, mass can be thought of as the resistance to acceleration.\n   */\n  public mass: number = 1.0;\n\n  /**\n   * The current moment of inertia, moment of inertia can be thought of as the resistance to rotation.\n   */\n  public inertia: number = 1000;\n\n  /**\n   * The coefficient of friction on this actor\n   */\n  public friction: number = 0.99;\n\n  /**\n   * The also known as coefficient of restitution of this actor, represents the amount of energy preserved after collision or the\n   * bounciness. If 1, it is 100% bouncy, 0 it completely absorbs.\n   */\n  public bounciness: number = 0.2;\n\n  /**\n   * Returns a boolean indicating whether this body collided with\n   * or was in stationary contact with\n   * the body of the other [[Collider]]\n   */\n  public touching(other: Collider): boolean {\n    const pair = new Pair(this, other);\n    pair.collide();\n\n    if (pair.collision) {\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Returns the collider's [[BoundingBox]] calculated for this instant in world space.\n   * If there is no shape, a point bounding box is returned\n   */\n  public get bounds(): BoundingBox {\n    if (this.shape) {\n      return this.shape.bounds;\n    }\n\n    if (this.body) {\n      return new BoundingBox().translate(this.body.pos);\n    }\n    return new BoundingBox();\n  }\n\n  /**\n   * Returns the collider's [[BoundingBox]] relative to the body's position.\n   * If there is no shape, a point boudning box is returned\n   */\n  public get localBounds(): BoundingBox {\n    if (this.shape) {\n      return this.shape.localBounds;\n    }\n    return new BoundingBox();\n  }\n\n  /**\n   * Updates the collision shapes geometry and internal caches if needed\n   */\n  public update() {\n    if (this.shape) {\n      this.shape.recalc();\n    }\n  }\n\n  emit(eventName: string, event: GameEvent<Collider>): void {\n    this._events.emit(eventName, event);\n  }\n  on(eventName: string, handler: (event: GameEvent<Collider>) => void): void {\n    this._events.on(eventName, handler);\n  }\n  off(eventName: string, handler?: (event: GameEvent<Collider>) => void): void {\n    this._events.off(eventName, handler);\n  }\n  once(eventName: string, handler: (event: GameEvent<Collider>) => void): void {\n    this._events.once(eventName, handler);\n  }\n\n  clear() {\n    this._events.clear();\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    // Draw motion vectors\n    if (Physics.showMotionVectors) {\n      DrawUtil.vector(ctx, Color.Yellow, this.body.pos, this.body.acc.add(Physics.acc));\n      DrawUtil.vector(ctx, Color.Red, this.body.pos, this.body.vel);\n      DrawUtil.point(ctx, Color.Red, this.body.pos);\n    }\n\n    if (Physics.showBounds) {\n      this.bounds.debugDraw(ctx, Color.Yellow);\n    }\n\n    if (Physics.showArea) {\n      this.shape.debugDraw(ctx, Color.Green);\n    }\n  }\n}\n","import { Class } from './Class';\nimport { BoundingBox } from './Collision/BoundingBox';\nimport { Texture } from './Resources/Texture';\nimport {\n  InitializeEvent,\n  KillEvent,\n  PreUpdateEvent,\n  PostUpdateEvent,\n  PreDrawEvent,\n  PostDrawEvent,\n  PreDebugDrawEvent,\n  PostDebugDrawEvent,\n  PostCollisionEvent,\n  PreCollisionEvent,\n  CollisionStartEvent,\n  CollisionEndEvent,\n  PostKillEvent,\n  PreKillEvent,\n  GameEvent,\n  ExitTriggerEvent,\n  EnterTriggerEvent,\n  EnterViewPortEvent,\n  ExitViewPortEvent\n} from './Events';\nimport { PointerEvent, WheelEvent, PointerDragEvent, PointerEventName } from './Input/Pointer';\nimport { Engine } from './Engine';\nimport { Color } from './Drawing/Color';\nimport { Sprite } from './Drawing/Sprite';\nimport { Trait } from './Interfaces/Trait';\nimport { Drawable } from './Interfaces/Drawable';\nimport { CanInitialize, CanUpdate, CanDraw, CanBeKilled } from './Interfaces/LifecycleEvents';\nimport { Scene } from './Scene';\nimport { Logger } from './Util/Log';\nimport { ActionContext } from './Actions/ActionContext';\nimport { ActionQueue } from './Actions/Action';\nimport { Vector } from './Algebra';\nimport { CollisionShape } from './Collision/CollisionShape';\nimport { Body } from './Collision/Body';\nimport { Side } from './Collision/Side';\nimport { Eventable } from './Interfaces/Evented';\nimport { Actionable } from './Actions/Actionable';\nimport { Configurable } from './Configurable';\nimport * as Traits from './Traits/Index';\nimport * as Effects from './Drawing/SpriteEffects';\nimport * as Util from './Util/Util';\nimport * as Events from './Events';\nimport { PointerEvents } from './Interfaces/PointerEvents';\nimport { CollisionType } from './Collision/CollisionType';\nimport { obsolete } from './Util/Decorators';\nimport { Collider } from './Collision/Collider';\nimport { Shape } from './Collision/Shape';\n\nexport function isActor(x: any): x is Actor {\n  return x instanceof Actor;\n}\n\n/**\n * [[include:Constructors.md]]\n */\nexport interface ActorArgs extends Partial<ActorImpl> {\n  width?: number;\n  height?: number;\n  pos?: Vector;\n  vel?: Vector;\n  acc?: Vector;\n  rotation?: number;\n  rx?: number;\n  z?: number;\n  color?: Color;\n  visible?: boolean;\n  body?: Body;\n}\n\nexport interface ActorDefaults {\n  anchor: Vector;\n}\n\n/**\n * @hidden\n */\n\nexport class ActorImpl extends Class implements Actionable, Eventable, PointerEvents, CanInitialize, CanUpdate, CanDraw, CanBeKilled {\n  // #region Properties\n\n  /**\n   * Indicates the next id to be set\n   */\n  public static defaults: ActorDefaults = {\n    anchor: Vector.Half\n  };\n  /**\n   * Indicates the next id to be set\n   */\n  public static maxId = 0;\n  /**\n   * The unique identifier for the actor\n   */\n  public id: number = ActorImpl.maxId++;\n\n  /**\n   * The physics body the is associated with this actor. The body is the container for all physical properties, like position, velocity,\n   * acceleration, mass, inertia, etc.\n   */\n  public get body(): Body {\n    return this._body;\n  }\n\n  public set body(body: Body) {\n    this._body = body;\n    this._body.actor = this;\n  }\n\n  private _body: Body;\n\n  /**\n   * Gets the collision geometry shape to use for collision possible options are [Circle|circles], [ConvexPolygon|polygons], and\n   * [Edge|edges].\n   * @obsolete Use Actor.body.collider.shape, collisionArea will be removed in v0.24.0\n   */\n  @obsolete({ message: 'Actor.collisionArea will be removed in v0.24.0', alternateMethod: 'Actor.body.collider.shape' })\n  public get collisionArea(): CollisionShape {\n    return this.body.collider.shape;\n  }\n\n  /**\n   * Gets the collision geometry shape to use for collision possible options are [Circle|circles], [ConvexPolygon|polygons], and\n   * [Edge|edges].\n   * @obsolete use Actor.body.collider.shape, collisionArea will be removed in v0.24.0\n   */\n  public set collisionArea(area: CollisionShape) {\n    this.body.collider.shape = area;\n  }\n\n  /**\n   * Gets the x position of the actor relative to it's parent (if any)\n   * @obsolete ex.Actor.x will be removed in v0.24.0, use ex.Actor.pos.x\n   */\n  @obsolete({ message: 'ex.Actor.x will be removed in v0.24.0', alternateMethod: 'ex.Actor.pos.x, or ex.Actor.body.pos.x' })\n  public get x(): number {\n    return this.body.pos.x;\n  }\n\n  /**\n   * Sets the x position of the actor relative to it's parent (if any)\n   * @obsolete ex.Actor.x will be removed in v0.24.0, use ex.Actor.pos.x\n   */\n  public set x(theX: number) {\n    this.body.pos.x = theX;\n  }\n\n  /**\n   * Gets the y position of the actor relative to it's parent (if any)\n   * @obsolete ex.Actor.y will be removed in v0.24.0, use ex.Actor.pos.y\n   */\n  @obsolete({ message: 'ex.Actor.y will be removed in v0.24.0', alternateMethod: 'ex.Actor.pos.y, or ex.Actor.body.pos.y' })\n  public get y(): number {\n    return this.body.pos.y;\n  }\n\n  /**\n   * Sets the y position of the actor relative to it's parent (if any)\n   * @obsolete ex.Actor.y will be removed in v0.24.0, use ex.Actor.pos.y\n   */\n  public set y(theY: number) {\n    this.body.pos.y = theY;\n  }\n\n  /**\n   * Gets the position vector of the actor in pixels\n   */\n  public get pos(): Vector {\n    return this.body.pos;\n  }\n\n  /**\n   * Sets the position vector of the actor in pixels\n   */\n  public set pos(thePos: Vector) {\n    this.body.pos.setTo(thePos.x, thePos.y);\n  }\n\n  /**\n   * Gets the position vector of the actor from the last frame\n   */\n  public get oldPos(): Vector {\n    return this.body.oldPos;\n  }\n\n  /**\n   * Sets the position vector of the actor in the last frame\n   */\n  public set oldPos(thePos: Vector) {\n    this.body.oldPos.setTo(thePos.x, thePos.y);\n  }\n\n  /**\n   * Gets the velocity vector of the actor in pixels/sec\n   */\n  public get vel(): Vector {\n    return this.body.vel;\n  }\n\n  /**\n   * Sets the velocity vector of the actor in pixels/sec\n   */\n  public set vel(theVel: Vector) {\n    this.body.vel.setTo(theVel.x, theVel.y);\n  }\n\n  /**\n   * Gets the velocity vector of the actor from the last frame\n   */\n  public get oldVel(): Vector {\n    return this.body.oldVel;\n  }\n\n  /**\n   * Sets the velocity vector of the actor from the last frame\n   */\n  public set oldVel(theVel: Vector) {\n    this.body.oldVel.setTo(theVel.x, theVel.y);\n  }\n\n  /**\n   * Gets the acceleration vector of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may be\n   * useful to simulate a gravitational effect.\n   */\n  public get acc(): Vector {\n    return this.body.acc;\n  }\n\n  /**\n   * Sets the acceleration vector of teh actor in pixels/second/second\n   */\n  public set acc(theAcc: Vector) {\n    this.body.acc.setTo(theAcc.x, theAcc.y);\n  }\n\n  /**\n   * Sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\n   */\n  public set oldAcc(theAcc: Vector) {\n    this.body.oldAcc.setTo(theAcc.x, theAcc.y);\n  }\n\n  /**\n   * Gets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\n   */\n  public get oldAcc(): Vector {\n    return this.body.oldAcc;\n  }\n\n  /**\n   * Gets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\n   */\n  public get rotation(): number {\n    return this.body.rotation;\n  }\n\n  /**\n   * Sets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\n   */\n  public set rotation(theAngle: number) {\n    this.body.rotation = theAngle;\n  }\n\n  /**\n   * Gets the rotational velocity of the actor in radians/second\n   */\n  public get rx(): number {\n    return this.body.rx;\n  }\n\n  /**\n   * Sets the rotational velocity of the actor in radians/sec\n   */\n  public set rx(angularVelocity: number) {\n    this.body.rx = angularVelocity;\n  }\n\n  /**\n   * Gets the current torque applied to the actor. Torque can be thought of as rotational force\n   * @obsolete ex.Actor.torque will be removed in v0.24.0, use ex.Actor.body.torque\n   */\n  @obsolete({ message: 'ex.Actor.torque will be removed in v0.24.0', alternateMethod: 'ex.Actor.body.torque' })\n  public get torque() {\n    return this.body.torque;\n  }\n\n  /**\n   * Sets the current torque applied to the actor. Torque can be thought of as rotational force\n   * @obsolete ex.Actor.torque will be removed in v0.24.0, use ex.Actor.body.torque\n   */\n  public set torque(theTorque: number) {\n    this.body.torque = theTorque;\n  }\n\n  /**\n   * Get the current mass of the actor, mass can be thought of as the resistance to acceleration.\n   * @obsolete ex.Actor.mass will be removed in v0.24.0, use ex.Actor.body.collider.mass\n   */\n  @obsolete({ message: 'ex.Actor.mass will be removed in v0.24.0', alternateMethod: 'ex.Actor.body.collider.mass' })\n  public get mass() {\n    return this.body.collider.mass;\n  }\n\n  /**\n   * Sets the mass of the actor, mass can be thought of as the resistance to acceleration.\n   * @obsolete ex.Actor.mass will be removed in v0.24.0, use ex.Actor.body.collider.mass\n   */\n  public set mass(theMass: number) {\n    this.body.collider.mass = theMass;\n  }\n\n  /**\n   * Gets the current moment of inertia, moi can be thought of as the resistance to rotation.\n   * @obsolete ex.Actor.moi will be removed in v0.24.0, use ex.Actor.body.collider.inertia\n   */\n  @obsolete({ message: 'ex.Actor.moi will be removed in v0.24.0', alternateMethod: 'ex.Actor.body.collider.inertia' })\n  public get moi() {\n    return this.body.collider.inertia;\n  }\n\n  /**\n   * Sets the current moment of inertia, moi can be thought of as the resistance to rotation.\n   * @obsolete ex.Actor.moi will be removed in v0.24.0, use ex.Actor.body.collider.inertia\n   */\n  public set moi(theMoi: number) {\n    this.body.collider.inertia = theMoi;\n  }\n\n  /**\n   * Gets the coefficient of friction on this actor, this can be thought of as how sticky or slippery an object is.\n   * @obsolete ex.Actor.friction will be removed in v0.24.0, use ex.Actor.body.collider.friction\n   */\n  @obsolete({ message: 'ex.Actor.friction will be removed in v0.24.0', alternateMethod: 'ex.Actor.body.collider.friction' })\n  public get friction() {\n    return this.body.collider.friction;\n  }\n\n  /**\n   * Sets the coefficient of friction of this actor, this can ve thought of as how stick or slippery an object is.\n   */\n  public set friction(theFriction: number) {\n    this.body.collider.friction = theFriction;\n  }\n\n  /**\n   * Gets the coefficient of restitution of this actor, represents the amount of energy preserved after collision. Think of this\n   * as bounciness.\n   * @obsolete ex.Actor.restitution will be removed in v0.24.0, use ex.Actor.body.collider.restitution\n   */\n  @obsolete({ message: 'ex.Actor.restitution will be removed in v0.24.0', alternateMethod: 'ex.Actor.body.collider.bounciness' })\n  public get restitution() {\n    return this.body.collider.bounciness;\n  }\n\n  /**\n   * Sets the coefficient of restitution of this actor, represents the amount of energy preserved after collision. Think of this\n   * as bounciness.\n   * @obsolete ex.Actor.restitution will be removed in v0.24.0, use ex.Actor.body.collider.restitution\n   */\n  public set restitution(theRestitution: number) {\n    this.body.collider.bounciness = theRestitution;\n  }\n\n  /**\n   * The anchor to apply all actor related transformations like rotation,\n   * translation, and scaling. By default the anchor is in the center of\n   * the actor. By default it is set to the center of the actor (.5, .5)\n   *\n   * An anchor of (.5, .5) will ensure that drawings are centered.\n   *\n   * Use `anchor.setTo` to set the anchor to a different point using\n   * values between 0 and 1. For example, anchoring to the top-left would be\n   * `Actor.anchor.setTo(0, 0)` and top-right would be `Actor.anchor.setTo(0, 1)`.\n   */\n  public anchor: Vector;\n\n  private _height: number = 0;\n  private _width: number = 0;\n\n  /**\n   * Gets the scale vector of the actor\n   */\n  public get scale(): Vector {\n    return this.body.scale;\n  }\n\n  /**\n   * Sets the scale vector of the actor for\n   */\n  public set scale(scale: Vector) {\n    this.body.scale = scale;\n  }\n\n  /**\n   * Gets the old scale of the actor last frame\n   */\n  public get oldScale(): Vector {\n    return this.body.oldScale;\n  }\n\n  /**\n   * Sets the the old scale of the acotr last frame\n   */\n  public set oldScale(scale: Vector) {\n    this.body.oldScale = scale;\n  }\n\n  /**\n   * Gets the x scalar velocity of the actor in scale/second\n   */\n  public get sx(): number {\n    return this.body.sx;\n  }\n\n  /**\n   * Sets the x scalar velocity of the actor in scale/second\n   */\n  public set sx(scalePerSecondX: number) {\n    this.body.sx = scalePerSecondX;\n  }\n\n  /**\n   * Gets the y scalar velocity of the actor in scale/second\n   */\n  public get sy(): number {\n    return this.body.sy;\n  }\n\n  /**\n   * Sets the y scale velocity of the actor in scale/second\n   */\n  public set sy(scalePerSecondY: number) {\n    this.body.sy = scalePerSecondY;\n  }\n\n  /**\n   * Indicates whether the actor is physically in the viewport\n   */\n  public isOffScreen: boolean = false;\n  /**\n   * The visibility of an actor\n   */\n  public visible: boolean = true;\n  /**\n   * The opacity of an actor. Passing in a color in the [[constructor]] will use the\n   * color's opacity.\n   */\n  public opacity: number = 1;\n  public previousOpacity: number = 1;\n\n  /**\n   * Direct access to the actor's [[ActionQueue]]. Useful if you are building custom actions.\n   */\n  public actionQueue: ActionQueue;\n\n  /**\n   * [[ActionContext|Action context]] of the actor. Useful for scripting actor behavior.\n   */\n  public actions: ActionContext;\n\n  /**\n   * Convenience reference to the global logger\n   */\n  public logger: Logger = Logger.getInstance();\n\n  /**\n   * The scene that the actor is in\n   */\n  public scene: Scene = null;\n\n  /**\n   * The parent of this actor\n   */\n  public parent: Actor = null;\n\n  /**\n   * The children of this actor\n   */\n  public children: Actor[] = [];\n\n  /**\n   * Gets or sets the current collision type of this actor. By\n   * default it is ([[CollisionType.PreventCollision]]).\n   * @obsolete ex.Actor.collisionType will be removed in v0.24.0, use ex.Actor.body.collider.type\n   */\n  @obsolete({ message: 'ex.Actor.collisionType will be removed in v0.24.0', alternateMethod: 'ex.Actor.body.collider.type' })\n  public get collisionType(): CollisionType {\n    return this.body.collider.type;\n  }\n\n  /**\n   * Gets or sets the current collision type of this actor. By\n   * default it is ([[CollisionType.PreventCollision]]).\n   *  @obsolete ex.Actor.collisionType will be removed in v0.24.0, use ex.Actor.body.collider.type\n   */\n  public set collisionType(type: CollisionType) {\n    this.body.collider.type = type;\n  }\n\n  /**\n   * @obsolete Legacy collision groups will be removed in v0.24.0, use [[Actor.body.collider.collisionGroup]]\n   */\n  public collisionGroups: string[] = [];\n\n  private _collisionHandlers: { [key: string]: { (actor: Actor): void }[] } = {};\n  private _isInitialized: boolean = false;\n  public frames: { [key: string]: Drawable } = {};\n  private _effectsDirty: boolean = false;\n\n  /**\n   * Access to the current drawing for the actor, this can be\n   * an [[Animation]], [[Sprite]], or [[Polygon]].\n   * Set drawings with [[setDrawing]].\n   */\n  public currentDrawing: Drawable = null;\n\n  /**\n   * Modify the current actor update pipeline.\n   */\n  public traits: Trait[] = [];\n\n  /**\n   * Sets the color of the actor. A rectangle of this color will be\n   * drawn if no [[IDrawable]] is specified as the actors drawing.\n   *\n   * The default is `null` which prevents a rectangle from being drawn.\n   */\n  public get color(): Color {\n    return this._color;\n  }\n  public set color(v: Color) {\n    this._color = v.clone();\n  }\n  private _color: Color;\n\n  /**\n   * Whether or not to enable the [[CapturePointer]] trait that propagates\n   * pointer events to this actor\n   */\n  public enableCapturePointer: boolean = false;\n\n  /**\n   * Configuration for [[CapturePointer]] trait\n   */\n  public capturePointer: Traits.CapturePointerConfig = {\n    captureMoveEvents: false,\n    captureDragEvents: false\n  };\n\n  private _zIndex: number = 0;\n  private _isKilled: boolean = false;\n  private _opacityFx = new Effects.Opacity(this.opacity);\n\n  // #endregion\n\n  /**\n   * @param x       The starting x coordinate of the actor\n   * @param y       The starting y coordinate of the actor\n   * @param width   The starting width of the actor\n   * @param height  The starting height of the actor\n   * @param color   The starting color of the actor. Leave null to draw a transparent actor. The opacity of the color will be used as the\n   * initial [[opacity]].\n   */\n  constructor(xOrConfig?: number | ActorArgs, y?: number, width?: number, height?: number, color?: Color) {\n    super();\n\n    let shouldInitializeBody = true;\n    if (xOrConfig && typeof xOrConfig === 'object') {\n      const config = xOrConfig;\n      xOrConfig = config.pos ? config.pos.x : config.x;\n      y = config.pos ? config.pos.y : config.y;\n      width = config.width;\n      height = config.height;\n\n      if (config.body) {\n        shouldInitializeBody = false;\n        this.body = config.body;\n      }\n    }\n\n    // initialize default options\n    this._initDefaults();\n\n    // Body and collider bounds are still determined by actor width/height\n    this._width = width || 0;\n    this._height = height || 0;\n\n    // Initialize default collider to be a box\n    if (shouldInitializeBody) {\n      this.body = new Body({\n        collider: new Collider({\n          type: CollisionType.Passive,\n          shape: Shape.Box(this._width, this._height, this.anchor)\n        })\n      });\n    }\n\n    // Position uses body to store values must be initialized after body\n    this.pos.x = <number>xOrConfig || 0;\n    this.pos.y = y || 0;\n\n    if (color) {\n      this.color = color;\n      // set default opacity of an actor to the color\n      this.opacity = color.a;\n    }\n\n    // Build default pipeline\n    this.traits.push(new Traits.TileMapCollisionDetection());\n    this.traits.push(new Traits.OffscreenCulling());\n    this.traits.push(new Traits.CapturePointer());\n\n    // Build the action queue\n    this.actionQueue = new ActionQueue(this);\n    this.actions = new ActionContext(this);\n  }\n\n  /**\n   * `onInitialize` is called before the first update of the actor. This method is meant to be\n   * overridden. This is where initialization of child actors should take place.\n   *\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\n   */\n  public onInitialize(_engine: Engine): void {\n    // Override me\n  }\n\n  /**\n   * Gets whether the actor is Initialized\n   */\n  public get isInitialized(): boolean {\n    return this._isInitialized;\n  }\n\n  /**\n   * Initializes this actor and all it's child actors, meant to be called by the Scene before first update not by users of Excalibur.\n   *\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\n   *\n   * @internal\n   */\n  public _initialize(engine: Engine) {\n    if (!this.isInitialized) {\n      this.onInitialize(engine);\n      super.emit('initialize', new InitializeEvent(engine, this));\n      this._isInitialized = true;\n    }\n    for (const child of this.children) {\n      child._initialize(engine);\n    }\n  }\n\n  private _initDefaults() {\n    this.anchor = Actor.defaults.anchor.clone();\n  }\n\n  // #region Events\n\n  private _capturePointerEvents: PointerEventName[] = [\n    'pointerup',\n    'pointerdown',\n    'pointermove',\n    'pointerenter',\n    'pointerleave',\n    'pointerdragstart',\n    'pointerdragend',\n    'pointerdragmove',\n    'pointerdragenter',\n    'pointerdragleave'\n  ];\n\n  private _captureMoveEvents: PointerEventName[] = [\n    'pointermove',\n    'pointerenter',\n    'pointerleave',\n    'pointerdragmove',\n    'pointerdragenter',\n    'pointerdragleave'\n  ];\n\n  private _captureDragEvents: PointerEventName[] = [\n    'pointerdragstart',\n    'pointerdragend',\n    'pointerdragmove',\n    'pointerdragenter',\n    'pointerdragleave'\n  ];\n\n  private _checkForPointerOptIn(eventName: string) {\n    if (eventName) {\n      const normalized = <PointerEventName>eventName.toLowerCase();\n\n      if (this._capturePointerEvents.indexOf(normalized) !== -1) {\n        this.enableCapturePointer = true;\n\n        if (this._captureMoveEvents.indexOf(normalized) !== -1) {\n          this.capturePointer.captureMoveEvents = true;\n        }\n\n        if (this._captureDragEvents.indexOf(normalized) !== -1) {\n          this.capturePointer.captureDragEvents = true;\n        }\n      }\n    }\n  }\n\n  public on(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\n  public on(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\n  /**\n   * The **collisionstart** event is fired when a [[Body|physics body]], usually attached to an actor,\n   *  first starts colliding with another [[Body|body]], and will not fire again while in contact until\n   *  the the pair separates and collides again.\n   * Use cases for the **collisionstart** event may be detecting when an actor has touched a surface\n   * (like landing) or if a item has been touched and needs to be picked up.\n   */\n  public on(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\n  /**\n   * The **collisionend** event is fired when two [[Body|physics bodies]] are no longer in contact.\n   * This event will not fire again until another collision and separation.\n   *\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\n   * (like jumping) or has left an area.\n   */\n  public on(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\n  /**\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\n   * bodies are intersecting.\n   *\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\n   * richochet of the ball depending on which side of the paddle you hit.\n   */\n  public on(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\n  /**\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\n   * type collision pairs.\n   *\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\n   * tweak the default resolution.\n   */\n  public on(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\n  public on(eventName: Events.kill, handler: (event: KillEvent) => void): void;\n  public on(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\n  public on(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent) => void): void;\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent) => void): void;\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public on(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\n  public on(eventName: Events.pointerdragstart, handler: (event: PointerDragEvent) => void): void;\n  public on(eventName: Events.pointerdragend, handler: (event: PointerDragEvent) => void): void;\n  public on(eventName: Events.pointerdragenter, handler: (event: PointerDragEvent) => void): void;\n  public on(eventName: Events.pointerdragleave, handler: (event: PointerDragEvent) => void): void;\n  public on(eventName: Events.pointerdragmove, handler: (event: PointerDragEvent) => void): void;\n  public on(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\n  public on(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    this._checkForPointerOptIn(eventName);\n    super.on(eventName, handler);\n  }\n\n  public once(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\n  public once(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\n  /**\n   * The **collisionstart** event is fired when a [[Body|physics body]], usually attached to an actor,\n   *  first starts colliding with another [[Body|body]], and will not fire again while in contact until\n   *  the the pair separates and collides again.\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\n   * (like landing) or if a item has been touched and needs to be picked up.\n   */\n  public once(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\n  /**\n   * The **collisionend** event is fired when two [[Body|physics bodies]] are no longer in contact.\n   * This event will not fire again until another collision and separation.\n   *\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\n   * (like jumping) or has left an area.\n   */\n  public once(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\n  /**\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\n   * bodies are intersecting.\n   *\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\n   * richochet of the ball depending on which side of the paddle you hit.\n   */\n  public once(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\n  /**\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\n   * type collision pairs.\n   *\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\n   * tweak the default resolution.\n   */\n  public once(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\n  public once(eventName: Events.kill, handler: (event: KillEvent) => void): void;\n  public once(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\n  public once(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent) => void): void;\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent) => void): void;\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent) => void): void;\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public once(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\n  public once(eventName: Events.pointerdragstart, handler: (event: PointerDragEvent) => void): void;\n  public once(eventName: Events.pointerdragend, handler: (event: PointerDragEvent) => void): void;\n  public once(eventName: Events.pointerdragenter, handler: (event: PointerDragEvent) => void): void;\n  public once(eventName: Events.pointerdragleave, handler: (event: PointerDragEvent) => void): void;\n  public once(eventName: Events.pointerdragmove, handler: (event: PointerDragEvent) => void): void;\n  public once(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\n  public once(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    this._checkForPointerOptIn(eventName);\n    super.once(eventName, handler);\n  }\n\n  public off(eventName: Events.exittrigger, handler?: (event: ExitTriggerEvent) => void): void;\n  public off(eventName: Events.entertrigger, handler?: (event: EnterTriggerEvent) => void): void;\n  /**\n   * The **collisionstart** event is fired when a [[Body|physics body]], usually attached to an actor,\n   *  first starts colliding with another [[Body|body]], and will not fire again while in contact until\n   *  the the pair separates and collides again.\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\n   * (like landing) or if a item has been touched and needs to be picked up.\n   */\n  public off(eventName: Events.collisionstart, handler?: (event: CollisionStartEvent) => void): void;\n  /**\n   * The **collisionend** event is fired when two [[Body|physics bodies]] are no longer in contact.\n   * This event will not fire again until another collision and separation.\n   *\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\n   * (like jumping) or has left an area.\n   */\n  public off(eventName: Events.collisionend, handler?: (event: CollisionEndEvent) => void): void;\n  /**\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\n   * bodies are intersecting.\n   *\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\n   * richochet of the ball depending on which side of the paddle you hit.\n   */\n  public off(eventName: Events.precollision, handler?: (event: PreCollisionEvent) => void): void;\n  /**\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\n   * type collision pairs.\n   *\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\n   * tweak the default resolution.\n   */\n  public off(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\n  public off(eventName: Events.pointerup, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerdown, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerenter, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerleave, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointermove, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointercancel, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerwheel, handler?: (event: WheelEvent) => void): void;\n  public off(eventName: Events.pointerdragstart, handler?: (event: PointerDragEvent) => void): void;\n  public off(eventName: Events.pointerdragend, handler?: (event: PointerDragEvent) => void): void;\n  public off(eventName: Events.pointerdragenter, handler?: (event: PointerDragEvent) => void): void;\n  public off(eventName: Events.pointerdragleave, handler?: (event: PointerDragEvent) => void): void;\n  public off(eventName: Events.pointerdragmove, handler?: (event: PointerDragEvent) => void): void;\n  public off(eventName: Events.prekill, handler?: (event: PreKillEvent) => void): void;\n  public off(eventName: Events.postkill, handler?: (event: PostKillEvent) => void): void;\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent) => void): void;\n  public off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent) => void): void;\n  public off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent) => void): void;\n  public off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\n  public off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\n  public off(eventName: Events.enterviewport, handler?: (event: EnterViewPortEvent) => void): void;\n  public off(eventName: Events.exitviewport, handler?: (event: ExitViewPortEvent) => void): void;\n  public off(eventName: string, handler?: (event: GameEvent<Actor>) => void): void;\n  public off(eventName: string, handler?: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  // #endregion\n\n  /**\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\n   *\n   * Internal _prekill handler for [[onPreKill]] lifecycle event\n   * @internal\n   */\n  public _prekill(_scene: Scene) {\n    super.emit('prekill', new PreKillEvent(this));\n    this.onPreKill(_scene);\n  }\n\n  /**\n   * Safe to override onPreKill lifecycle event handler. Synonymous with `.on('prekill', (evt) =>{...})`\n   *\n   * `onPreKill` is called directly before an actor is killed and removed from its current [[Scene]].\n   */\n  public onPreKill(_scene: Scene) {\n    // Override me\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\n   *\n   * Internal _prekill handler for [[onPostKill]] lifecycle event\n   * @internal\n   */\n  public _postkill(_scene: Scene) {\n    super.emit('postkill', new PostKillEvent(this));\n    this.onPostKill(_scene);\n  }\n\n  /**\n   * Safe to override onPostKill lifecycle event handler. Synonymous with `.on('postkill', (evt) => {...})`\n   *\n   * `onPostKill` is called directly after an actor is killed and remove from its current [[Scene]].\n   */\n  public onPostKill(_scene: Scene) {\n    // Override me\n  }\n\n  /**\n   * If the current actor is a member of the scene, this will remove\n   * it from the scene graph. It will no longer be drawn or updated.\n   */\n  public kill() {\n    if (this.scene) {\n      this._prekill(this.scene);\n      this.emit('kill', new KillEvent(this));\n      this._isKilled = true;\n      this.scene.remove(this);\n      this._postkill(this.scene);\n    } else {\n      this.logger.warn('Cannot kill actor, it was never added to the Scene');\n    }\n  }\n\n  /**\n   * If the current actor is killed, it will now not be killed.\n   */\n  public unkill() {\n    this._isKilled = false;\n  }\n\n  /**\n   * Indicates wether the actor has been killed.\n   */\n  public isKilled(): boolean {\n    return this._isKilled;\n  }\n\n  /**\n   * Adds a child actor to this actor. All movement of the child actor will be\n   * relative to the parent actor. Meaning if the parent moves the child will\n   * move with it.\n   * @param actor The child actor to add\n   */\n  public add(actor: Actor) {\n    actor.body.collider.type = CollisionType.PreventCollision;\n    if (Util.addItemToArray(actor, this.children)) {\n      actor.parent = this;\n    }\n  }\n  /**\n   * Removes a child actor from this actor.\n   * @param actor The child actor to remove\n   */\n  public remove(actor: Actor) {\n    if (Util.removeItemFromArray(actor, this.children)) {\n      actor.parent = null;\n    }\n  }\n  /**\n   * Sets the current drawing of the actor to the drawing corresponding to\n   * the key.\n   * @param key The key of the drawing\n   */\n  public setDrawing(key: string): void;\n  /**\n   * Sets the current drawing of the actor to the drawing corresponding to\n   * an `enum` key (e.g. `Animations.Left`)\n   * @param key The `enum` key of the drawing\n   */\n  public setDrawing(key: number): void;\n  public setDrawing(key: any): void {\n    key = key.toString();\n    if (this.currentDrawing !== this.frames[<string>key]) {\n      if (this.frames[key] != null) {\n        this.frames[key].reset();\n        this.currentDrawing = this.frames[key];\n      } else {\n        Logger.getInstance().error(`the specified drawing key ${key} does not exist`);\n      }\n    }\n  }\n\n  /**\n   * Adds a whole texture as the \"default\" drawing. Set a drawing using [[setDrawing]].\n   */\n  public addDrawing(texture: Texture): void;\n  /**\n   * Adds a whole sprite as the \"default\" drawing. Set a drawing using [[setDrawing]].\n   */\n  public addDrawing(sprite: Sprite): void;\n  /**\n   * Adds a drawing to the list of available drawings for an actor. Set a drawing using [[setDrawing]].\n   * @param key     The key to associate with a drawing for this actor\n   * @param drawing This can be an [[Animation]], [[Sprite]], or [[Polygon]].\n   */\n  public addDrawing(key: any, drawing: Drawable): void;\n  public addDrawing(): void {\n    if (arguments.length === 2) {\n      this.frames[<string>arguments[0]] = arguments[1];\n      if (!this.currentDrawing) {\n        this.currentDrawing = arguments[1];\n      }\n      this._effectsDirty = true;\n    } else {\n      if (arguments[0] instanceof Sprite) {\n        this.addDrawing('default', arguments[0]);\n      }\n      if (arguments[0] instanceof Texture) {\n        this.addDrawing('default', arguments[0].asSprite());\n      }\n    }\n  }\n\n  public get z(): number {\n    return this.getZIndex();\n  }\n\n  public set z(newZ: number) {\n    this.setZIndex(newZ);\n  }\n\n  /**\n   * Gets the z-index of an actor. The z-index determines the relative order an actor is drawn in.\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\n   */\n  public getZIndex(): number {\n    return this._zIndex;\n  }\n\n  /**\n   * Sets the z-index of an actor and updates it in the drawing list for the scene.\n   * The z-index determines the relative order an actor is drawn in.\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\n   * @param newIndex new z-index to assign\n   */\n  public setZIndex(newIndex: number) {\n    this.scene.cleanupDrawTree(this);\n    this._zIndex = newIndex;\n    this.scene.updateDrawTree(this);\n  }\n\n  /**\n   * Adds an actor to a collision group. Actors with no named collision groups are\n   * considered to be in every collision group.\n   *\n   * Once in a collision group(s) actors will only collide with other actors in\n   * that group.\n   *\n   * @param name The name of the collision group\n   * @obsolete Use [[Actor.body.collider.collisionGroup]], legacy collisionGroups will be removed in v0.24.0\n   */\n  @obsolete({ message: 'Legacy collision groups will be removed in v0.24.0', alternateMethod: 'Actor.body.collider.collisionGroup' })\n  public addCollisionGroup(name: string) {\n    this.collisionGroups.push(name);\n  }\n  /**\n   * Removes an actor from a collision group.\n   * @param name The name of the collision group\n   * @obsolete Use [[Actor.body.collider.collisionGroup]], legacy collisionGroups will be removed in v0.24.0\n   */\n  @obsolete({ message: 'Legacy collision groups will be removed in v0.24.0', alternateMethod: 'Actor.body.collider.collisionGroup' })\n  public removeCollisionGroup(name: string) {\n    const index = this.collisionGroups.indexOf(name);\n    if (index !== -1) {\n      this.collisionGroups.splice(index, 1);\n    }\n  }\n\n  /**\n   * Get the center point of an actor\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'Actor.center' })\n  public getCenter(): Vector {\n    return new Vector(this.pos.x + this.width / 2 - this.anchor.x * this.width, this.pos.y + this.height / 2 - this.anchor.y * this.height);\n  }\n\n  /**\n   * Get the center point of an actor\n   */\n  public get center(): Vector {\n    return new Vector(this.pos.x + this.width / 2 - this.anchor.x * this.width, this.pos.y + this.height / 2 - this.anchor.y * this.height);\n  }\n\n  public get width() {\n    return this._width * this.getGlobalScale().x;\n  }\n\n  public set width(width: number) {\n    this._width = width / this.scale.x;\n    this.body.collider.shape = Shape.Box(this._width, this._height, this.anchor);\n    this.body.markCollisionShapeDirty();\n  }\n\n  /**\n   * Gets the calculated width of an actor, factoring in scale\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'Actor.width' })\n  public getWidth() {\n    return this.width;\n  }\n  /**\n   * Sets the width of an actor, factoring in the current scale\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'Actor.width' })\n  public setWidth(width: number) {\n    this.width = width;\n  }\n\n  public get height() {\n    return this._height * this.getGlobalScale().y;\n  }\n\n  public set height(height: number) {\n    this._height = height / this.scale.y;\n    this.body.collider.shape = Shape.Box(this._width, this._height, this.anchor);\n    this.body.markCollisionShapeDirty();\n  }\n\n  /**\n   * Gets the calculated height of an actor, factoring in scale\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'Actor.height' })\n  public getHeight() {\n    return this.height;\n  }\n  /**\n   * Sets the height of an actor, factoring in the current scale\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'Actor.height' })\n  public setHeight(height: number) {\n    this.height = height;\n  }\n\n  /**\n   * Gets the left edge of the actor\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'Actor.body.collider.bounds.left' })\n  public getLeft() {\n    return this.getBounds().left;\n  }\n\n  /**\n   * Gets the right edge of the actor\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'Actor.body.collider.bounds.right' })\n  public getRight() {\n    return this.getBounds().right;\n  }\n\n  /**\n   * Gets the top edge of the actor\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'Actor.body.collider.bounds.top' })\n  public getTop() {\n    return this.getBounds().top;\n  }\n\n  /**\n   * Gets the bottom edge of the actor\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'Actor.body.collider.bounds.bottom' })\n  public getBottom() {\n    return this.getBounds().bottom;\n  }\n\n  /**\n   * Gets this actor's rotation taking into account any parent relationships\n   *\n   * @returns Rotation angle in radians\n   */\n  public getWorldRotation(): number {\n    if (!this.parent) {\n      return this.rotation;\n    }\n\n    return this.rotation + this.parent.getWorldRotation();\n  }\n\n  /**\n   * Gets an actor's world position taking into account parent relationships, scaling, rotation, and translation\n   *\n   * @returns Position in world coordinates\n   */\n  public getWorldPos(): Vector {\n    if (!this.parent) {\n      return this.pos.clone();\n    }\n\n    // collect parents\n    const parents: Actor[] = [];\n    let root: Actor = this;\n\n    parents.push(this);\n\n    // find parents\n    while (root.parent) {\n      root = root.parent;\n      parents.push(root);\n    }\n\n    // calculate position\n    const x = parents.reduceRight((px, p) => {\n      if (p.parent) {\n        return px + p.pos.x * p.getGlobalScale().x;\n      }\n      return px + p.pos.x;\n    }, 0);\n\n    const y = parents.reduceRight((py, p) => {\n      if (p.parent) {\n        return py + p.pos.y * p.getGlobalScale().y;\n      }\n      return py + p.pos.y;\n    }, 0);\n\n    // rotate around root anchor\n    const ra = root.getWorldPos(); // 10, 10\n    const r = this.getWorldRotation();\n\n    return new Vector(x, y).rotate(r, ra);\n  }\n\n  /**\n   * Gets the global scale of the Actor\n   */\n  public getGlobalScale(): Vector {\n    if (!this.parent) {\n      return new Vector(this.scale.x, this.scale.y);\n    }\n\n    const parentScale = this.parent.getGlobalScale();\n    return new Vector(this.scale.x * parentScale.x, this.scale.y * parentScale.y);\n  }\n\n  // #region Collision\n\n  /**\n   * Returns the actor's [[BoundingBox]] calculated for this instant in world space.\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'Actor.body.collider.bounds' })\n  public getBounds(rotated: boolean = true): BoundingBox {\n    // todo cache bounding box\n    const anchor = this._getCalculatedAnchor();\n    const pos = this.getWorldPos();\n\n    const bb = new BoundingBox(pos.x - anchor.x, pos.y - anchor.y, pos.x + this.width - anchor.x, pos.y + this.height - anchor.y);\n\n    return rotated ? bb.rotate(this.rotation, pos) : bb;\n  }\n\n  /**\n   * Returns the actor's [[BoundingBox]] relative to the actor's position.\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'Actor.body.collider.localBounds' })\n  public getRelativeBounds(rotated: boolean = true): BoundingBox {\n    // todo cache bounding box\n    const anchor = this._getCalculatedAnchor();\n    const bb = new BoundingBox(-anchor.x, -anchor.y, this.width - anchor.x, this.height - anchor.y);\n\n    return rotated ? bb.rotate(this.rotation) : bb;\n  }\n\n  /**\n   * Returns the actors unrotated geometry in world coordinates\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'Actor.body.collider.bounds.getPoints()' })\n  public getGeometry(): Vector[] {\n    return this.getBounds(false).getPoints();\n  }\n\n  /**\n   * Return the actor's unrotated geometry relative to the actor's position\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'Actor.body.collider.localBounds.getPoints()' })\n  public getRelativeGeometry(): Vector[] {\n    return this.getRelativeBounds(false).getPoints();\n  }\n\n  /**\n   * Tests whether the x/y specified are contained in the actor\n   * @param x  X coordinate to test (in world coordinates)\n   * @param y  Y coordinate to test (in world coordinates)\n   * @param recurse checks whether the x/y are contained in any child actors (if they exist).\n   */\n  public contains(x: number, y: number, recurse: boolean = false): boolean {\n    // These shenanigans are to handle child actor containment,\n    // the only time getWorldPos and pos are different is a child actor\n    const childShift = this.getWorldPos().sub(this.pos);\n    const containment = this.body.collider.bounds.translate(childShift).contains(new Vector(x, y));\n\n    if (recurse) {\n      return (\n        containment ||\n        this.children.some((child: Actor) => {\n          return child.contains(x, y, true);\n        })\n      );\n    }\n\n    return containment;\n  }\n\n  /**\n   * Returns the side of the collision based on the intersection\n   * @param intersect The displacement vector returned by a collision\n   * @obsolete Actor.getSideFromIntersect will be removed in v0.24.0, use [[BoundingBox.sideFromIntersection]]\n   */\n  @obsolete({ message: 'Actor.getSideFromIntersect will be removed in v0.24.0', alternateMethod: 'BoundingBox.sideFromIntersection' })\n  public getSideFromIntersect(intersect: Vector) {\n    if (intersect) {\n      if (Math.abs(intersect.x) > Math.abs(intersect.y)) {\n        if (intersect.x < 0) {\n          return Side.Right;\n        }\n        return Side.Left;\n      } else {\n        if (intersect.y < 0) {\n          return Side.Bottom;\n        }\n        return Side.Top;\n      }\n    }\n    return Side.None;\n  }\n  /**\n   * Test whether the actor has collided with another actor, returns the side of the current actor that collided.\n   * @param actor The other actor to test\n   * @obsolete Actor.collidesWithSide will be removed in v0.24.0, use [[Actor.bounds.intersectWithSide]]\n   */\n  @obsolete({ message: 'Actor.collidesWithSide will be removed in v0.24.0', alternateMethod: 'Actor.bounds.intersectWithSide' })\n  public collidesWithSide(actor: Actor): Side {\n    const separationVector = this.collides(actor);\n    if (!separationVector) {\n      return Side.None;\n    }\n    if (Math.abs(separationVector.x) > Math.abs(separationVector.y)) {\n      if (this.pos.x < actor.pos.x) {\n        return Side.Right;\n      } else {\n        return Side.Left;\n      }\n    } else {\n      if (this.pos.y < actor.pos.y) {\n        return Side.Bottom;\n      } else {\n        return Side.Top;\n      }\n    }\n  }\n  /**\n   * Test whether the actor has collided with another actor, returns the intersection vector on collision. Returns\n   * `null` when there is no collision;\n   * @param actor The other actor to test\n   * @obsolete Actor.collides will be removed in v0.24.0, use [[Actor.bounds.interesect]] to get boudings intersection,\n   * or [[Actor.body.collider.collide]] to collide with another collider\n   */\n  @obsolete({ message: 'Actor.collides will be removed  in v0.24.0', alternateMethod: 'Actor.bounds.intersect or Actor.' })\n  public collides(actor: Actor): Vector {\n    const bounds = this.body.collider.bounds;\n    const otherBounds = actor.body.collider.bounds;\n    const intersect = bounds.intersect(otherBounds);\n    return intersect;\n  }\n\n  /**\n   * Register a handler to fire when this actor collides with another in a specified group\n   * @param group The group name to listen for\n   * @param func The callback to fire on collision with another actor from the group. The callback is passed the other actor.\n   */\n  @obsolete({ message: 'Actor.onCollidesWIth will be removed  in v0.24.0', alternateMethod: 'Actor.collider.canCollide' })\n  public onCollidesWith(group: string, func: (actor: Actor) => void) {\n    if (!this._collisionHandlers[group]) {\n      this._collisionHandlers[group] = [];\n    }\n    this._collisionHandlers[group].push(func);\n  }\n  @obsolete({ message: 'Actor.getCollisionHandlers will be removed  in v0.24.0' })\n  public getCollisionHandlers(): { [key: string]: { (actor: Actor): void }[] } {\n    return this._collisionHandlers;\n  }\n  /**\n   * Removes all collision handlers for this group on this actor\n   * @param group Group to remove all handlers for on this actor.\n   */\n  @obsolete({ message: 'Actor.getCollisionHandlers will be removed  in v0.24.0' })\n  public removeCollidesWith(group: string) {\n    this._collisionHandlers[group] = [];\n  }\n  /**\n   * Returns true if the two actors are less than or equal to the distance specified from each other\n   * @param actor     Actor to test\n   * @param distance  Distance in pixels to test\n   */\n  public within(actor: Actor, distance: number): boolean {\n    return Math.sqrt(Math.pow(this.pos.x - actor.pos.x, 2) + Math.pow(this.pos.y - actor.pos.y, 2)) <= distance;\n  }\n\n  // #endregion\n\n  private _getCalculatedAnchor(): Vector {\n    return new Vector(this.width * this.anchor.x, this.height * this.anchor.y);\n  }\n\n  protected _reapplyEffects(drawing: Drawable) {\n    drawing.removeEffect(this._opacityFx);\n    drawing.addEffect(this._opacityFx);\n  }\n\n  // #region Update\n\n  /**\n   * Called by the Engine, updates the state of the actor\n   * @param engine The reference to the current game engine\n   * @param delta  The time elapsed since the last update in milliseconds\n   */\n  public update(engine: Engine, delta: number) {\n    this._initialize(engine);\n    this._preupdate(engine, delta);\n\n    // Update action queue\n    this.actionQueue.update(delta);\n\n    // Update color only opacity\n    if (this.color) {\n      this.color.a = this.opacity;\n    }\n\n    // calculate changing opacity\n    if (this.previousOpacity !== this.opacity) {\n      this.previousOpacity = this.opacity;\n      this._opacityFx.opacity = this.opacity;\n      this._effectsDirty = true;\n    }\n\n    // capture old transform\n    this.body.captureOldTransform();\n\n    // Run Euler integration\n    this.body.integrate(delta);\n\n    // Update actor pipeline (movement, collision detection, event propagation, offscreen culling)\n    for (const trait of this.traits) {\n      trait.update(this, engine, delta);\n    }\n\n    // Update child actors\n    for (let i = 0; i < this.children.length; i++) {\n      this.children[i].update(engine, delta);\n    }\n\n    this._postupdate(engine, delta);\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before an actor is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after an actor is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPreUpdate(engine, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(engine: Engine, delta: number): void {\n    this.emit('postupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPostUpdate(engine, delta);\n  }\n\n  // endregion\n\n  // #region Drawing\n  /**\n   * Called by the Engine, draws the actor to the screen\n   * @param ctx   The rendering context\n   * @param delta The time since the last draw in milliseconds\n   */\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\n    ctx.save();\n    ctx.translate(this.pos.x, this.pos.y);\n    ctx.rotate(this.rotation);\n    ctx.scale(this.scale.x, this.scale.y);\n\n    // translate canvas by anchor offset\n    ctx.save();\n    ctx.translate(-(this._width * this.anchor.x), -(this._height * this.anchor.y));\n\n    this._predraw(ctx, delta);\n\n    if (this.currentDrawing) {\n      const drawing = this.currentDrawing;\n      // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\n      const offsetX = (this._width - drawing.width * drawing.scale.x) * this.anchor.x;\n      const offsetY = (this._height - drawing.height * drawing.scale.y) * this.anchor.y;\n\n      if (this._effectsDirty) {\n        this._reapplyEffects(this.currentDrawing);\n        this._effectsDirty = false;\n      }\n\n      this.currentDrawing.draw(ctx, offsetX, offsetY);\n    } else {\n      if (this.color && this.body && this.body.collider && this.body.collider.shape) {\n        this.body.collider.shape.draw(ctx, this.color, new Vector(this.width * this.anchor.x, this.height * this.anchor.y));\n      }\n    }\n    ctx.restore();\n\n    // Draw child actors\n    for (let i = 0; i < this.children.length; i++) {\n      if (this.children[i].visible) {\n        this.children[i].draw(ctx, delta);\n      }\n    }\n\n    this._postdraw(ctx, delta);\n    ctx.restore();\n  }\n\n  /**\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('predraw', (evt) =>{...})`\n   *\n   * `onPreDraw` is called directly before an actor is drawn, but after local transforms are made.\n   */\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('postdraw', (evt) =>{...})`\n   *\n   * `onPostDraw` is called directly after an actor is drawn, and before local transforms are removed.\n   */\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\n   *\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\n   * @internal\n   */\n  public _predraw(ctx: CanvasRenderingContext2D, delta: number): void {\n    this.emit('predraw', new PreDrawEvent(ctx, delta, this));\n    this.onPreDraw(ctx, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\n   *\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\n   * @internal\n   */\n  public _postdraw(ctx: CanvasRenderingContext2D, delta: number): void {\n    this.emit('postdraw', new PreDrawEvent(ctx, delta, this));\n    this.onPostDraw(ctx, delta);\n  }\n\n  /**\n   * Called by the Engine, draws the actors debugging to the screen\n   * @param ctx The rendering context\n   */\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    this.emit('predebugdraw', new PreDebugDrawEvent(ctx, this));\n\n    this.body.collider.debugDraw(ctx);\n\n    // Draw actor bounding box\n    const bb = this.body.collider.bounds;\n    bb.debugDraw(ctx);\n\n    // Draw actor Id\n    ctx.fillText('id: ' + this.id, bb.left + 3, bb.top + 10);\n\n    // Draw actor anchor Vector\n    ctx.fillStyle = Color.Yellow.toString();\n    ctx.beginPath();\n    ctx.arc(this.getWorldPos().x, this.getWorldPos().y, 3, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    // Culling Box debug draw\n    for (let j = 0; j < this.traits.length; j++) {\n      if (this.traits[j] instanceof Traits.OffscreenCulling) {\n        (<Traits.OffscreenCulling>this.traits[j]).cullingBox.debugDraw(ctx);\n      }\n    }\n\n    // Unit Circle debug draw\n    ctx.strokeStyle = Color.Yellow.toString();\n    ctx.beginPath();\n    const radius = Math.min(this.width, this.height);\n    ctx.arc(this.getWorldPos().x, this.getWorldPos().y, radius, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.stroke();\n    const ticks: { [key: string]: number } = {\n      '0 Pi': 0,\n      'Pi/2': Math.PI / 2,\n      Pi: Math.PI,\n      '3/2 Pi': (3 * Math.PI) / 2\n    };\n\n    const oldFont = ctx.font;\n    for (const tick in ticks) {\n      ctx.fillStyle = Color.Yellow.toString();\n      ctx.font = '14px';\n      ctx.textAlign = 'center';\n      ctx.fillText(\n        tick,\n        this.getWorldPos().x + Math.cos(ticks[tick]) * (radius + 10),\n        this.getWorldPos().y + Math.sin(ticks[tick]) * (radius + 10)\n      );\n    }\n\n    ctx.font = oldFont;\n\n    // Draw child actors\n    for (let i = 0; i < this.children.length; i++) {\n      this.children[i].debugDraw(ctx);\n    }\n\n    this.emit('postdebugdraw', new PostDebugDrawEvent(ctx, this));\n  }\n\n  /**\n   * Returns the full array of ancestors\n   */\n  public getAncestors(): Actor[] {\n    const path: Actor[] = [this];\n    let currentActor: Actor = this;\n    let parent: Actor;\n\n    while ((parent = currentActor.parent)) {\n      currentActor = parent;\n      path.push(currentActor);\n    }\n\n    return path.reverse();\n  }\n  // #endregion\n}\n\n/**\n * The most important primitive in Excalibur is an `Actor`. Anything that\n * can move on the screen, collide with another `Actor`, respond to events,\n * or interact with the current scene, must be an actor. An `Actor` **must**\n * be part of a [[Scene]] for it to be drawn to the screen.\n *\n * [[include:Actors.md]]\n *\n *\n * [[include:Constructors.md]]\n *\n */\nexport class Actor extends Configurable(ActorImpl) {\n  constructor();\n  constructor(config?: ActorArgs);\n  constructor(x?: number, y?: number, width?: number, height?: number, color?: Color);\n  constructor(xOrConfig?: number | ActorArgs, y?: number, width?: number, height?: number, color?: Color) {\n    super(xOrConfig, y, width, height, color);\n  }\n}\n","import { Vector } from './Algebra';\nimport { Engine } from './Engine';\nimport { Actor, ActorArgs } from './Actor';\nimport * as Traits from './Traits/Index';\nimport { CollisionType } from './Collision/CollisionType';\nimport { Shape } from './Collision/Shape';\n\n/**\n * Helper [[Actor]] primitive for drawing UI's, optimized for UI drawing. Does\n * not participate in collisions. Drawn on top of all other actors.\n */\nexport class UIActor extends Actor {\n  protected _engine: Engine;\n\n  constructor();\n  constructor(xOrConfig?: number, y?: number, width?: number, height?: number);\n  constructor(config?: ActorArgs);\n  /**\n   * @param x       The starting x coordinate of the actor\n   * @param y       The starting y coordinate of the actor\n   * @param width   The starting width of the actor\n   * @param height  The starting height of the actor\n   */\n  constructor(xOrConfig?: number | ActorArgs, y?: number, width?: number, height?: number) {\n    if (typeof xOrConfig !== 'object') {\n      super(<number>xOrConfig, y, width, height);\n    } else {\n      super(<ActorArgs>xOrConfig);\n    }\n    this.traits = [];\n    this.traits.push(new Traits.CapturePointer());\n    this.anchor.setTo(0, 0);\n    this.body.collider.type = CollisionType.PreventCollision;\n    this.body.collider.shape = Shape.Box(this.width, this.height, this.anchor);\n    this.enableCapturePointer = true;\n  }\n\n  public _initialize(engine: Engine) {\n    this._engine = engine;\n    super._initialize(engine);\n  }\n\n  public contains(x: number, y: number, useWorld: boolean = true) {\n    if (useWorld) {\n      return super.contains(x, y);\n    }\n\n    const coords = this._engine.worldToScreenCoordinates(new Vector(x, y));\n    return super.contains(coords.x, coords.y);\n  }\n}\n","import { Scene } from './Scene';\n\n/**\n * The Excalibur timer hooks into the internal timer and fires callbacks,\n * after a certain interval, optionally repeating.\n */\nexport class Timer {\n  public static id: number = 0;\n  public id: number = 0;\n  public interval: number = 10;\n  public fcn: () => void = () => {\n    return;\n  };\n  public repeats: boolean = false;\n  public maxNumberOfRepeats: number = -1;\n  private _elapsedTime: number = 0;\n  private _totalTimeAlive: number = 0;\n  private _paused: boolean = false;\n  private _numberOfTicks: number = 0;\n  public complete: boolean = false;\n  public scene: Scene = null;\n\n  /**\n   * @param fcn        The callback to be fired after the interval is complete.\n   * @param interval   Interval length\n   * @param repeats    Indicates whether this call back should be fired only once, or repeat after every interval as completed.\n   * @param numberOfRepeats Specifies a maximum number of times that this timer will execute.\n   */\n  constructor(fcn: () => void, interval: number, repeats?: boolean, numberOfRepeats?: number) {\n    if (!!numberOfRepeats && numberOfRepeats >= 0) {\n      this.maxNumberOfRepeats = numberOfRepeats;\n      if (!repeats) {\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\n      }\n    }\n    this.id = Timer.id++;\n    this.interval = interval || this.interval;\n    this.fcn = fcn || this.fcn;\n    this.repeats = repeats || this.repeats;\n  }\n\n  /**\n   * Updates the timer after a certain number of milliseconds have elapsed. This is used internally by the engine.\n   * @param delta  Number of elapsed milliseconds since the last update.\n   */\n  public update(delta: number) {\n    if (!this._paused) {\n      this._totalTimeAlive += delta;\n      this._elapsedTime += delta;\n\n      if (this.maxNumberOfRepeats > -1 && this._numberOfTicks >= this.maxNumberOfRepeats) {\n        this.complete = true;\n      }\n\n      if (!this.complete && this._elapsedTime >= this.interval) {\n        this.fcn.call(this);\n        this._numberOfTicks++;\n        if (this.repeats) {\n          this._elapsedTime = 0;\n        } else {\n          this.complete = true;\n        }\n      }\n    }\n  }\n\n  /**\n   * Resets the timer so that it can be reused, and optionally reconfigure the timers interval.\n   * @param newInterval If specified, sets a new non-negative interval in milliseconds to refire the callback\n   * @param newNumberOfRepeats If specified, sets a new non-negative upper limit to the number of time this timer executes\n   */\n  public reset(newInterval?: number, newNumberOfRepeats?: number) {\n    if (!!newInterval && newInterval >= 0) {\n      this.interval = newInterval;\n    }\n\n    if (!!this.maxNumberOfRepeats && this.maxNumberOfRepeats >= 0) {\n      this.maxNumberOfRepeats = newNumberOfRepeats;\n      if (!this.repeats) {\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\n      }\n    }\n\n    this.complete = false;\n    this._elapsedTime = 0;\n    this._numberOfTicks = 0;\n  }\n\n  public get timesRepeated(): number {\n    return this._numberOfTicks;\n  }\n\n  public getTimeRunning(): number {\n    return this._totalTimeAlive;\n  }\n\n  /**\n   * Pauses the timer so that no more time will be incremented towards the next call\n   */\n  public pause() {\n    this._paused = true;\n  }\n\n  /**\n   * Unpauses the timer. Time will now increment towards the next call\n   */\n  public unpause() {\n    this._paused = false;\n  }\n\n  /**\n   * Cancels the timer, preventing any further executions.\n   */\n  public cancel() {\n    if (this.scene) {\n      this.scene.cancelTimer(this);\n    }\n  }\n}\n","import { BoundingBox } from './Collision/BoundingBox';\nimport { Color } from './Drawing/Color';\nimport { Class } from './Class';\nimport { Engine } from './Engine';\nimport { Vector } from './Algebra';\nimport { Actor } from './Actor';\nimport { Logger } from './Util/Log';\nimport { SpriteSheet } from './Drawing/SpriteSheet';\nimport * as Events from './Events';\nimport { Configurable } from './Configurable';\nimport { obsolete } from './Util/Decorators';\n\n/**\n * @hidden\n */\nexport class TileMapImpl extends Class {\n  private _collidingX: number = -1;\n  private _collidingY: number = -1;\n  private _onScreenXStart: number = 0;\n  private _onScreenXEnd: number = 9999;\n  private _onScreenYStart: number = 0;\n  private _onScreenYEnd: number = 9999;\n  private _spriteSheets: { [key: string]: SpriteSheet } = {};\n  public logger: Logger = Logger.getInstance();\n  public data: Cell[] = [];\n  public x: number;\n  public y: number;\n  public cellWidth: number;\n  public cellHeight: number;\n  public rows: number;\n  public cols: number;\n\n  public on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent) => void): void;\n  public on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n  public on(eventName: string, handler: (event: Events.GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  /**\n   * @param x             The x coordinate to anchor the TileMap's upper left corner (should not be changed once set)\n   * @param y             The y coordinate to anchor the TileMap's upper left corner (should not be changed once set)\n   * @param cellWidth     The individual width of each cell (in pixels) (should not be changed once set)\n   * @param cellHeight    The individual height of each cell (in pixels) (should not be changed once set)\n   * @param rows          The number of rows in the TileMap (should not be changed once set)\n   * @param cols          The number of cols in the TileMap (should not be changed once set)\n   */\n  constructor(xOrConfig: number | TileMapArgs, y: number, cellWidth: number, cellHeight: number, rows: number, cols: number) {\n    super();\n    if (xOrConfig && typeof xOrConfig === 'object') {\n      const config = xOrConfig;\n      xOrConfig = config.x;\n      y = config.y;\n      cellWidth = config.cellWidth;\n      cellHeight = config.cellHeight;\n      rows = config.rows;\n      cols = config.cols;\n    }\n    this.x = <number>xOrConfig;\n    this.y = y;\n    this.cellWidth = cellWidth;\n    this.cellHeight = cellHeight;\n    this.rows = rows;\n    this.cols = cols;\n    this.data = new Array<Cell>(rows * cols);\n    for (let i = 0; i < cols; i++) {\n      for (let j = 0; j < rows; j++) {\n        (() => {\n          const cd = new Cell(i * cellWidth + <number>xOrConfig, j * cellHeight + y, cellWidth, cellHeight, i + j * cols);\n          this.data[i + j * cols] = cd;\n        })();\n      }\n    }\n  }\n\n  public registerSpriteSheet(key: string, spriteSheet: SpriteSheet) {\n    this._spriteSheets[key] = spriteSheet;\n  }\n  /**\n   * Returns the intersection vector that can be used to resolve collisions with actors. If there\n   * is no collision null is returned.\n   */\n  public collides(actor: Actor): Vector {\n    const width = actor.pos.x + actor.width;\n    const height = actor.pos.y + actor.height;\n    const actorBounds = actor.body.collider.bounds;\n    const overlaps: Vector[] = [];\n    // trace points for overlap\n    for (let x = actorBounds.left; x <= width; x += Math.min(actor.width / 2, this.cellWidth / 2)) {\n      for (let y = actorBounds.top; y <= height; y += Math.min(actor.height / 2, this.cellHeight / 2)) {\n        const cell = this.getCellByPoint(x, y);\n        if (cell && cell.solid) {\n          const overlap = actorBounds.intersect(cell.bounds);\n          const dir = actor.center.sub(cell.center);\n          if (overlap && overlap.dot(dir) > 0) {\n            overlaps.push(overlap);\n          }\n        }\n      }\n    }\n    if (overlaps.length === 0) {\n      return null;\n    }\n    // Return the smallest change other than zero\n    const result = overlaps.reduce((accum, next) => {\n      let x = accum.x;\n      let y = accum.y;\n      if (Math.abs(accum.x) < Math.abs(next.x)) {\n        x = next.x;\n      }\n      if (Math.abs(accum.y) < Math.abs(next.y)) {\n        y = next.y;\n      }\n      return new Vector(x, y);\n    });\n    return result;\n  }\n\n  /**\n   * Returns the [[Cell]] by index (row major order)\n   */\n  public getCellByIndex(index: number): Cell {\n    return this.data[index];\n  }\n  /**\n   * Returns the [[Cell]] by its x and y coordinates\n   */\n  public getCell(x: number, y: number): Cell {\n    if (x < 0 || y < 0 || x >= this.cols || y >= this.rows) {\n      return null;\n    }\n    return this.data[x + y * this.cols];\n  }\n  /**\n   * Returns the [[Cell]] by testing a point in global coordinates,\n   * returns `null` if no cell was found.\n   */\n  public getCellByPoint(x: number, y: number): Cell {\n    x = Math.floor((x - this.x) / this.cellWidth);\n    y = Math.floor((y - this.y) / this.cellHeight);\n    const cell = this.getCell(x, y);\n    if (x >= 0 && y >= 0 && x < this.cols && y < this.rows && cell) {\n      return cell;\n    }\n    return null;\n  }\n\n  public update(engine: Engine, delta: number) {\n    this.emit('preupdate', new Events.PreUpdateEvent(engine, delta, this));\n\n    const worldCoordsUpperLeft = engine.screenToWorldCoordinates(new Vector(0, 0));\n    const worldCoordsLowerRight = engine.screenToWorldCoordinates(new Vector(engine.canvas.clientWidth, engine.canvas.clientHeight));\n\n    this._onScreenXStart = Math.max(Math.floor((worldCoordsUpperLeft.x - this.x) / this.cellWidth) - 2, 0);\n    this._onScreenYStart = Math.max(Math.floor((worldCoordsUpperLeft.y - this.y) / this.cellHeight) - 2, 0);\n    this._onScreenXEnd = Math.max(Math.floor((worldCoordsLowerRight.x - this.x) / this.cellWidth) + 2, 0);\n    this._onScreenYEnd = Math.max(Math.floor((worldCoordsLowerRight.y - this.y) / this.cellHeight) + 2, 0);\n\n    this.emit('postupdate', new Events.PostUpdateEvent(engine, delta, this));\n  }\n\n  /**\n   * Draws the tile map to the screen. Called by the [[Scene]].\n   * @param ctx    The current rendering context\n   * @param delta  The number of milliseconds since the last draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\n    this.emit('predraw', new Events.PreDrawEvent(ctx, delta, this));\n\n    ctx.save();\n    ctx.translate(this.x, this.y);\n\n    let x = this._onScreenXStart;\n    const xEnd = Math.min(this._onScreenXEnd, this.cols);\n    let y = this._onScreenYStart;\n    const yEnd = Math.min(this._onScreenYEnd, this.rows);\n\n    let cs: TileSprite[], csi: number, cslen: number;\n\n    for (x; x < xEnd; x++) {\n      for (y; y < yEnd; y++) {\n        // get non-negative tile sprites\n        cs = this.getCell(x, y).sprites.filter((s) => {\n          return s.spriteId > -1;\n        });\n\n        for (csi = 0, cslen = cs.length; csi < cslen; csi++) {\n          const ss = this._spriteSheets[cs[csi].spriteSheetKey];\n\n          // draw sprite, warning if sprite doesn't exist\n          if (ss) {\n            const sprite = ss.getSprite(cs[csi].spriteId);\n            if (sprite) {\n              sprite.draw(ctx, x * this.cellWidth, y * this.cellHeight);\n            } else {\n              this.logger.warn('Sprite does not exist for id', cs[csi].spriteId, 'in sprite sheet', cs[csi].spriteSheetKey, sprite, ss);\n            }\n          } else {\n            this.logger.warn('Sprite sheet', cs[csi].spriteSheetKey, 'does not exist', ss);\n          }\n        }\n      }\n      y = this._onScreenYStart;\n    }\n    ctx.restore();\n\n    this.emit('postdraw', new Events.PostDrawEvent(ctx, delta, this));\n  }\n\n  /**\n   * Draws all the tile map's debug info. Called by the [[Scene]].\n   * @param ctx  The current rendering context\n   */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    const width = this.cols * this.cellWidth;\n    const height = this.rows * this.cellHeight;\n    ctx.save();\n    ctx.strokeStyle = Color.Red.toString();\n    for (let x = 0; x < this.cols + 1; x++) {\n      ctx.beginPath();\n      ctx.moveTo(this.x + x * this.cellWidth, this.y);\n      ctx.lineTo(this.x + x * this.cellWidth, this.y + height);\n      ctx.stroke();\n    }\n    for (let y = 0; y < this.rows + 1; y++) {\n      ctx.beginPath();\n      ctx.moveTo(this.x, this.y + y * this.cellHeight);\n      ctx.lineTo(this.x + width, this.y + y * this.cellHeight);\n      ctx.stroke();\n    }\n    const solid = Color.Red;\n    solid.a = 0.3;\n    this.data\n      .filter(function(cell) {\n        return cell.solid;\n      })\n      .forEach(function(cell) {\n        ctx.fillStyle = solid.toString();\n        ctx.fillRect(cell.x, cell.y, cell.width, cell.height);\n      });\n    if (this._collidingY > -1 && this._collidingX > -1) {\n      ctx.fillStyle = Color.Cyan.toString();\n      ctx.fillRect(\n        this.x + this._collidingX * this.cellWidth,\n        this.y + this._collidingY * this.cellHeight,\n        this.cellWidth,\n        this.cellHeight\n      );\n    }\n    ctx.restore();\n  }\n}\n\n/**\n * [[include:Constructors.md]]\n */\nexport interface TileMapArgs extends Partial<TileMapImpl> {\n  x: number;\n  y: number;\n  cellWidth: number;\n  cellHeight: number;\n  rows: number;\n  cols: number;\n}\n\n/**\n * The [[TileMap]] class provides a lightweight way to do large complex scenes with collision\n * without the overhead of actors.\n *\n * [[include:TileMaps.md]]\n */\nexport class TileMap extends Configurable(TileMapImpl) {\n  constructor(config: TileMapArgs);\n  constructor(x: number, y: number, cellWidth: number, cellHeight: number, rows: number, cols: number);\n  constructor(xOrConfig: number | TileMapArgs, y?: number, cellWidth?: number, cellHeight?: number, rows?: number, cols?: number) {\n    super(xOrConfig, y, cellWidth, cellHeight, rows, cols);\n  }\n}\n\n/**\n * Tile sprites are used to render a specific sprite from a [[TileMap]]'s spritesheet(s)\n */\nexport class TileSprite {\n  /**\n   * @param spriteSheetKey  The key of the spritesheet to use\n   * @param spriteId        The index of the sprite in the [[SpriteSheet]]\n   */\n  constructor(public spriteSheetKey: string, public spriteId: number) {}\n}\n\n/**\n * @hidden\n */\nexport class CellImpl {\n  private _bounds: BoundingBox;\n  public x: number;\n  public y: number;\n  public width: number;\n  public height: number;\n  public index: number;\n  public solid: boolean = false;\n  public sprites: TileSprite[] = [];\n\n  /**\n   * @param x       Gets or sets x coordinate of the cell in world coordinates\n   * @param y       Gets or sets y coordinate of the cell in world coordinates\n   * @param width   Gets or sets the width of the cell\n   * @param height  Gets or sets the height of the cell\n   * @param index   The index of the cell in row major order\n   * @param solid   Gets or sets whether this cell is solid\n   * @param sprites The list of tile sprites to use to draw in this cell (in order)\n   */\n  constructor(\n    xOrConfig: number | CellArgs,\n    y: number,\n    width: number,\n    height: number,\n    index: number,\n    solid: boolean = false,\n    sprites: TileSprite[] = []\n  ) {\n    if (xOrConfig && typeof xOrConfig === 'object') {\n      const config = xOrConfig;\n      xOrConfig = config.x;\n      y = config.y;\n      width = config.width;\n      height = config.height;\n      index = config.index;\n      solid = config.solid;\n      sprites = config.sprites;\n    }\n    this.x = <number>xOrConfig;\n    this.y = y;\n    this.width = width;\n    this.height = height;\n    this.index = index;\n    this.solid = solid;\n    this.sprites = sprites;\n    this._bounds = new BoundingBox(this.x, this.y, this.x + this.width, this.y + this.height);\n  }\n\n  /**\n   * Returns the bounding box for this cell\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'BoundingBox.bounds' })\n  public getBounds() {\n    return this._bounds;\n  }\n\n  public get bounds() {\n    return this._bounds;\n  }\n\n  /**\n   * Gets the center coordinate of this cell\n   */\n  @obsolete({ message: 'Will be removed in v0.24.0', alternateMethod: 'BoundingBox.center' })\n  public getCenter(): Vector {\n    return new Vector(this.x + this.width / 2, this.y + this.height / 2);\n  }\n\n  public get center(): Vector {\n    return new Vector(this.x + this.width / 2, this.y + this.height / 2);\n  }\n\n  /**\n   * Add another [[TileSprite]] to this cell\n   */\n  public pushSprite(tileSprite: TileSprite) {\n    this.sprites.push(tileSprite);\n  }\n  /**\n   * Remove an instance of [[TileSprite]] from this cell\n   */\n  public removeSprite(tileSprite: TileSprite) {\n    let index = -1;\n    if ((index = this.sprites.indexOf(tileSprite)) > -1) {\n      this.sprites.splice(index, 1);\n    }\n  }\n  /**\n   * Clear all sprites from this cell\n   */\n  public clearSprites() {\n    this.sprites.length = 0;\n  }\n}\n\n/**\n * [[include:Constructors.md]]\n */\nexport interface CellArgs extends Partial<CellImpl> {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  index: number;\n  solid?: boolean;\n  sprites?: TileSprite[];\n}\n\n/**\n * TileMap Cell\n *\n * A light-weight object that occupies a space in a collision map. Generally\n * created by a [[TileMap]].\n *\n * Cells can draw multiple sprites. Note that the order of drawing is the order\n * of the sprites in the array so the last one will be drawn on top. You can\n * use transparency to create layers this way.\n */\nexport class Cell extends Configurable(CellImpl) {\n  constructor(config: CellArgs);\n  constructor(x: number, y: number, width: number, height: number, index: number, solid?: boolean, sprites?: TileSprite[]);\n  constructor(\n    xOrConfig: number | CellArgs,\n    y?: number,\n    width?: number,\n    height?: number,\n    index?: number,\n    solid?: boolean,\n    sprites?: TileSprite[]\n  ) {\n    super(xOrConfig, y, width, height, index, solid, sprites);\n  }\n}\n","/**\n * Internal class used to build instances of AudioContext\n */\n/* istanbul ignore next */\nexport class AudioContextFactory {\n  private static _INSTANCE: AudioContext = null;\n\n  public static create(): AudioContext {\n    if (!this._INSTANCE) {\n      if ((<any>window).AudioContext || (<any>window).webkitAudioContext) {\n        this._INSTANCE = new (<any>window).AudioContext();\n      }\n    }\n\n    return this._INSTANCE;\n  }\n}\n","import { AudioContextFactory } from '../Resources/Sound/AudioContext';\nimport { Promise, PromiseState } from '../Promises';\nimport { Logger } from './Log';\n\nexport interface LegacyWebAudioSource {\n  playbackState: string;\n  PLAYING_STATE: 'playing';\n  FINISHED_STATE: 'finished';\n}\n\nfunction isLegacyWebAudioSource(source: any): source is LegacyWebAudioSource {\n  return !!source.playbackState;\n}\n\nexport class WebAudio {\n  private static _unlocked: boolean = false;\n\n  /**\n   * Play an empty sound to unlock Safari WebAudio context. Call this function\n   * right after a user interaction event.\n   * @source https://paulbakaus.com/tutorials/html5/web-audio-on-ios/\n   */\n  static unlock(): Promise<boolean> {\n    const promise = new Promise<boolean>();\n    if (WebAudio._unlocked || !AudioContextFactory.create()) {\n      return promise.resolve(true);\n    }\n    const unlockTimeoutTimer = setTimeout(() => {\n      Logger.getInstance().warn('Excalibur was unable to unlock the audio context, audio probably will not play in this browser.');\n      promise.resolve();\n    }, 200);\n    const audioContext = AudioContextFactory.create();\n    audioContext.resume().then(\n      () => {\n        // create empty buffer and play it\n        const buffer = audioContext.createBuffer(1, 1, 22050);\n        const source = audioContext.createBufferSource();\n        let ended = false;\n\n        source.buffer = buffer;\n        source.connect(audioContext.destination);\n        source.onended = () => (ended = true);\n\n        if ((<any>source).noteOn) {\n          // deprecated\n          (<any>source).noteOn(0);\n        } else {\n          source.start(0);\n        }\n\n        // by checking the play state after some time, we know if we're really unlocked\n        setTimeout(() => {\n          if (isLegacyWebAudioSource(source)) {\n            if (source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE) {\n              WebAudio._unlocked = true;\n            }\n          } else {\n            if (audioContext.currentTime > 0 || ended) {\n              WebAudio._unlocked = true;\n            }\n          }\n        }, 0);\n\n        clearTimeout(unlockTimeoutTimer);\n        if (promise.state() === PromiseState.Pending) {\n          promise.resolve();\n        }\n      },\n      () => {\n        if (promise.state() === PromiseState.Pending) {\n          promise.reject(false);\n        }\n      }\n    );\n\n    return promise;\n  }\n\n  static isUnlocked() {\n    return this._unlocked;\n  }\n}\n","import { Engine } from './Engine';\nimport { EasingFunction, EasingFunctions } from './Util/EasingFunctions';\nimport { PromiseLike, Promise, PromiseState } from './Promises';\nimport { Vector } from './Algebra';\nimport { Actor } from './Actor';\nimport { removeItemFromArray } from './Util/Util';\nimport { CanUpdate, CanInitialize } from './Interfaces/LifecycleEvents';\nimport { PreUpdateEvent, PostUpdateEvent, GameEvent, InitializeEvent } from './Events';\nimport { Class } from './Class';\nimport { BoundingBox } from './Collision/BoundingBox';\n\n/**\n * Interface that describes a custom camera strategy for tracking targets\n */\nexport interface CameraStrategy<T> {\n  /**\n   * Target of the camera strategy that will be passed to the action\n   */\n  target: T;\n\n  /**\n   * Camera strategies perform an action to calculate a new focus returned out of the strategy\n   * @param target The target object to apply this camera strategy (if any)\n   * @param camera The current camera implementation in excalibur running the game\n   * @param engine The current engine running the game\n   * @param delta The elapsed time in milliseconds since the last frame\n   */\n  action: (target: T, camera: Camera, engine: Engine, delta: number) => Vector;\n}\n\n/**\n * Container to house convenience strategy methods\n * @internal\n */\nexport class StrategyContainer {\n  constructor(public camera: Camera) {}\n\n  /**\n   * Creates and adds the [[LockCameraToActorStrategy]] on the current camera.\n   * @param actor The actor to lock the camera to\n   */\n  public lockToActor(actor: Actor) {\n    this.camera.addStrategy(new LockCameraToActorStrategy(actor));\n  }\n\n  /**\n   * Creates and adds the [[LockCameraToActorAxisStrategy]] on the current camera\n   * @param actor The actor to lock the camera to\n   * @param axis The axis to follow the actor on\n   */\n  public lockToActorAxis(actor: Actor, axis: Axis) {\n    this.camera.addStrategy(new LockCameraToActorAxisStrategy(actor, axis));\n  }\n\n  /**\n   * Creates and adds the [[ElasticToActorStrategy]] on the current camera\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillationg spring that will over\n   * correct and bounce around the target\n   *\n   * @param target Target actor to elastically follow\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\n   */\n  public elasticToActor(actor: Actor, cameraElasticity: number, cameraFriction: number) {\n    this.camera.addStrategy(new ElasticToActorStrategy(actor, cameraElasticity, cameraFriction));\n  }\n\n  /**\n   * Creates and adds the [[RadiusAroundActorStrategy]] on the current camera\n   * @param target Target actor to follow when it is \"radius\" pixels away\n   * @param radius Number of pixels away before the camera will follow\n   */\n  public radiusAroundActor(actor: Actor, radius: number) {\n    this.camera.addStrategy(new RadiusAroundActorStrategy(actor, radius));\n  }\n}\n\n/**\n * Camera axis enum\n */\nexport enum Axis {\n  X,\n  Y\n}\n\n/**\n * Lock a camera to the exact x/y postition of an actor.\n */\nexport class LockCameraToActorStrategy implements CameraStrategy<Actor> {\n  constructor(public target: Actor) {}\n  public action = (target: Actor, _cam: Camera, _eng: Engine, _delta: number) => {\n    const center = target.center;\n    return center;\n  };\n}\n\n/**\n * Lock a camera to a specific axis around an actor.\n */\nexport class LockCameraToActorAxisStrategy implements CameraStrategy<Actor> {\n  constructor(public target: Actor, public axis: Axis) {}\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\n    const center = target.center;\n    const currentFocus = cam.getFocus();\n    if (this.axis === Axis.X) {\n      return new Vector(center.x, currentFocus.y);\n    } else {\n      return new Vector(currentFocus.x, center.y);\n    }\n  };\n}\n\n/**\n * Using [Hook's law](https://en.wikipedia.org/wiki/Hooke's_law), elastically move the camera towards the target actor.\n */\nexport class ElasticToActorStrategy implements CameraStrategy<Actor> {\n  /**\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillationg spring that will over\n   * correct and bounce around the target\n   *\n   * @param target Target actor to elastically follow\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\n   */\n  constructor(public target: Actor, public cameraElasticity: number, public cameraFriction: number) {}\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\n    const position = target.center;\n    let focus = cam.getFocus();\n    let cameraVel = new Vector(cam.dx, cam.dy);\n\n    // Calculate the strech vector, using the spring equation\n    // F = kX\n    // https://en.wikipedia.org/wiki/Hooke's_law\n    // Apply to the current camera velocity\n    const stretch = position.sub(focus).scale(this.cameraElasticity); // stretch is X\n    cameraVel = cameraVel.add(stretch);\n\n    // Calculate the friction (-1 to apply a force in the opposition of motion)\n    // Apply to the current camera velocity\n    const friction = cameraVel.scale(-1).scale(this.cameraFriction);\n    cameraVel = cameraVel.add(friction);\n\n    // Update position by velocity deltas\n    focus = focus.add(cameraVel);\n\n    return focus;\n  };\n}\n\nexport class RadiusAroundActorStrategy implements CameraStrategy<Actor> {\n  /**\n   *\n   * @param target Target actor to follow when it is \"radius\" pixels away\n   * @param radius Number of pixels away before the camera will follow\n   */\n  constructor(public target: Actor, public radius: number) {}\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\n    const position = target.center;\n    const focus = cam.getFocus();\n\n    const direction = position.sub(focus);\n    const distance = direction.magnitude();\n    if (distance >= this.radius) {\n      const offset = distance - this.radius;\n      return focus.add(direction.normalize().scale(offset));\n    }\n    return focus;\n  };\n}\n\n/**\n * Cameras\n *\n * [[Camera]] is the base class for all Excalibur cameras. Cameras are used\n * to move around your game and set focus. They are used to determine\n * what is \"off screen\" and can be used to scale the game.\n *\n * [[include:Cameras.md]]\n */\nexport class Camera extends Class implements CanUpdate, CanInitialize {\n  protected _follow: Actor;\n\n  private _cameraStrategies: CameraStrategy<any>[] = [];\n\n  public strategy: StrategyContainer = new StrategyContainer(this);\n\n  // camera physical quantities\n  public z: number = 1;\n\n  public dx: number = 0;\n  public dy: number = 0;\n  public dz: number = 0;\n\n  public ax: number = 0;\n  public ay: number = 0;\n  public az: number = 0;\n\n  public rotation: number = 0;\n  public rx: number = 0;\n\n  private _x: number = 0;\n  private _y: number = 0;\n  private _cameraMoving: boolean = false;\n  private _currentLerpTime: number = 0;\n  private _lerpDuration: number = 1000; // 1 second\n  private _lerpStart: Vector = null;\n  private _lerpEnd: Vector = null;\n  private _lerpPromise: PromiseLike<Vector>;\n\n  //camera effects\n  protected _isShaking: boolean = false;\n  private _shakeMagnitudeX: number = 0;\n  private _shakeMagnitudeY: number = 0;\n  private _shakeDuration: number = 0;\n  private _elapsedShakeTime: number = 0;\n  private _xShake: number = 0;\n  private _yShake: number = 0;\n\n  protected _isZooming: boolean = false;\n  private _zoomStart: number = 1;\n  private _zoomEnd: number = 1;\n  private _currentZoomTime: number = 0;\n  private _zoomDuration: number = 0;\n\n  private _zoomPromise: Promise<boolean>;\n  private _zoomEasing: EasingFunction = EasingFunctions.EaseInOutCubic;\n  private _easing: EasingFunction = EasingFunctions.EaseInOutCubic;\n\n  /**\n   * Get the camera's x position\n   */\n  public get x() {\n    return this._x;\n  }\n\n  /**\n   * Set the camera's x position (cannot be set when following an [[Actor]] or when moving)\n   */\n  public set x(value: number) {\n    if (!this._follow && !this._cameraMoving) {\n      this._x = value;\n    }\n  }\n\n  /**\n   * Get the camera's y position\n   */\n  public get y() {\n    return this._y;\n  }\n\n  /**\n   * Set the camera's y position (cannot be set when following an [[Actor]] or when moving)\n   */\n  public set y(value: number) {\n    if (!this._follow && !this._cameraMoving) {\n      this._y = value;\n    }\n  }\n\n  /**\n   * Get the camera's position as a vector\n   */\n  public get pos(): Vector {\n    return new Vector(this.x, this.y);\n  }\n\n  /**\n   * Set the cameras position\n   */\n  public set pos(value: Vector) {\n    this.x = value.x;\n    this.y = value.y;\n  }\n\n  /**\n   * Get the camera's velocity as a vector\n   */\n  public get vel() {\n    return new Vector(this.dx, this.dy);\n  }\n\n  /**\n   * Set the camera's velocity\n   */\n  public set vel(value: Vector) {\n    this.dx = value.x;\n    this.dy = value.y;\n  }\n\n  /**\n   * Returns the focal point of the camera, a new point giving the x and y position of the camera\n   */\n  public getFocus() {\n    return new Vector(this.x, this.y);\n  }\n\n  /**\n   * This moves the camera focal point to the specified position using specified easing function. Cannot move when following an Actor.\n   *\n   * @param pos The target position to move to\n   * @param duration The duration in milliseconds the move should last\n   * @param [easingFn] An optional easing function ([[ex.EasingFunctions.EaseInOutCubic]] by default)\n   * @returns A [[Promise]] that resolves when movement is finished, including if it's interrupted.\n   *          The [[Promise]] value is the [[Vector]] of the target position. It will be rejected if a move cannot be made.\n   */\n  public move(pos: Vector, duration: number, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): PromiseLike<Vector> {\n    if (typeof easingFn !== 'function') {\n      throw 'Please specify an EasingFunction';\n    }\n\n    // cannot move when following an actor\n    if (this._follow) {\n      return new Promise<Vector>().reject(pos);\n    }\n\n    // resolve existing promise, if any\n    if (this._lerpPromise && this._lerpPromise.state() === PromiseState.Pending) {\n      this._lerpPromise.resolve(pos);\n    }\n\n    this._lerpPromise = new Promise<Vector>();\n    this._lerpStart = this.getFocus().clone();\n    this._lerpDuration = duration;\n    this._lerpEnd = pos;\n    this._currentLerpTime = 0;\n    this._cameraMoving = true;\n    this._easing = easingFn;\n\n    return this._lerpPromise;\n  }\n\n  /**\n   * Sets the camera to shake at the specified magnitudes for the specified duration\n   * @param magnitudeX  The x magnitude of the shake\n   * @param magnitudeY  The y magnitude of the shake\n   * @param duration    The duration of the shake in milliseconds\n   */\n  public shake(magnitudeX: number, magnitudeY: number, duration: number) {\n    this._isShaking = true;\n    this._shakeMagnitudeX = magnitudeX;\n    this._shakeMagnitudeY = magnitudeY;\n    this._shakeDuration = duration;\n  }\n\n  /**\n   * Zooms the camera in or out by the specified scale over the specified duration.\n   * If no duration is specified, it take effect immediately.\n   * @param scale    The scale of the zoom\n   * @param duration The duration of the zoom in milliseconds\n   */\n  public zoom(scale: number, duration: number = 0, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<boolean> {\n    this._zoomPromise = new Promise<boolean>();\n\n    if (duration) {\n      this._isZooming = true;\n      this._zoomEasing = easingFn;\n      this._currentZoomTime = 0;\n      this._zoomDuration = duration;\n      this._zoomStart = this.z;\n      this._zoomEnd = scale;\n    } else {\n      this._isZooming = false;\n      this.z = scale;\n      this._zoomPromise.resolve(true);\n    }\n\n    return this._zoomPromise;\n  }\n\n  /**\n   * Gets the current zoom scale\n   */\n  public getZoom() {\n    return this.z;\n  }\n\n  /**\n   * Gets the boundingbox of the viewport of this camera in world coordinates\n   */\n  public get viewport(): BoundingBox {\n    if (this._engine) {\n      const halfWidth = this._engine.halfDrawWidth;\n      const halfHeight = this._engine.halfDrawHeight;\n\n      return new BoundingBox(this.x - halfWidth, this.y - halfHeight, this.x + halfWidth, this.y + halfHeight);\n    }\n    return new BoundingBox(0, 0, 0, 0);\n  }\n\n  /**\n   * Adds a new camera strategy to this camera\n   * @param cameraStrategy Instance of an [[ICameraStrategy]]\n   */\n  public addStrategy<T>(cameraStrategy: CameraStrategy<T>) {\n    this._cameraStrategies.push(cameraStrategy);\n  }\n\n  /**\n   * Removes a camera strategy by reference\n   * @param cameraStrategy Instance of an [[ICameraStrategy]]\n   */\n  public removeStrategy<T>(cameraStrategy: CameraStrategy<T>) {\n    removeItemFromArray(cameraStrategy, this._cameraStrategies);\n  }\n\n  /**\n   * Clears all camera strategies from the camera\n   */\n  public clearAllStrategies() {\n    this._cameraStrategies.length = 0;\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPreUpdate(engine, delta);\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before a scene is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // Overridable\n  }\n\n  /**\n   *  It is not recommended that internal excalibur methods be overriden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(engine: Engine, delta: number): void {\n    this.emit('postupdate', new PostUpdateEvent(engine, delta, this));\n    this.onPostUpdate(engine, delta);\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after a scene is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // Overridable\n  }\n\n  private _engine: Engine;\n  private _isInitialized = false;\n  public get isInitialized() {\n    return this._isInitialized;\n  }\n\n  public _initialize(_engine: Engine) {\n    if (!this.isInitialized) {\n      this.onInitialize(_engine);\n      super.emit('initialize', new InitializeEvent(_engine, this));\n      this._isInitialized = true;\n      this._engine = _engine;\n    }\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after a scene is updated.\n   */\n  public onInitialize(_engine: Engine) {\n    // Overridable\n  }\n\n  public on(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\n  public on(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\n  public on(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\n  public on(eventName: any, handler: any) {\n    super.on(eventName, handler);\n  }\n\n  public off(eventName: 'initialize', handler?: (event: InitializeEvent) => void): void;\n  public off(eventName: 'preupdate', handler?: (event: PreUpdateEvent) => void): void;\n  public off(eventName: 'postupdate', handler?: (event: PostUpdateEvent) => void): void;\n  public off(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\n  public off(eventName: string, handler: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  public once(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\n  public once(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\n  public once(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public update(_engine: Engine, delta: number) {\n    this._initialize(_engine);\n    this._preupdate(_engine, delta);\n\n    // Update placements based on linear algebra\n    this._x += (this.dx * delta) / 1000;\n    this._y += (this.dy * delta) / 1000;\n    this.z += (this.dz * delta) / 1000;\n\n    this.dx += (this.ax * delta) / 1000;\n    this.dy += (this.ay * delta) / 1000;\n    this.dz += (this.az * delta) / 1000;\n\n    this.rotation += (this.rx * delta) / 1000;\n\n    if (this._isZooming) {\n      if (this._currentZoomTime < this._zoomDuration) {\n        const zoomEasing = this._zoomEasing;\n        const newZoom = zoomEasing(this._currentZoomTime, this._zoomStart, this._zoomEnd, this._zoomDuration);\n\n        this.z = newZoom;\n        this._currentZoomTime += delta;\n      } else {\n        this._isZooming = false;\n        this.z = this._zoomEnd;\n        this._currentZoomTime = 0;\n        this._zoomPromise.resolve(true);\n      }\n    }\n\n    if (this._cameraMoving) {\n      if (this._currentLerpTime < this._lerpDuration) {\n        const moveEasing = EasingFunctions.CreateVectorEasingFunction(this._easing);\n\n        const lerpPoint = moveEasing(this._currentLerpTime, this._lerpStart, this._lerpEnd, this._lerpDuration);\n\n        this._x = lerpPoint.x;\n        this._y = lerpPoint.y;\n\n        this._currentLerpTime += delta;\n      } else {\n        this._x = this._lerpEnd.x;\n        this._y = this._lerpEnd.y;\n        const end = this._lerpEnd.clone();\n\n        this._lerpStart = null;\n        this._lerpEnd = null;\n        this._currentLerpTime = 0;\n        this._cameraMoving = false;\n        // Order matters here, resolve should be last so any chain promises have a clean slate\n        this._lerpPromise.resolve(end);\n      }\n    }\n\n    if (this._isDoneShaking()) {\n      this._isShaking = false;\n      this._elapsedShakeTime = 0;\n      this._shakeMagnitudeX = 0;\n      this._shakeMagnitudeY = 0;\n      this._shakeDuration = 0;\n      this._xShake = 0;\n      this._yShake = 0;\n    } else {\n      this._elapsedShakeTime += delta;\n      this._xShake = ((Math.random() * this._shakeMagnitudeX) | 0) + 1;\n      this._yShake = ((Math.random() * this._shakeMagnitudeY) | 0) + 1;\n    }\n\n    for (const s of this._cameraStrategies) {\n      this.pos = s.action.call(s, s.target, this, _engine, delta);\n    }\n\n    this._postupdate(_engine, delta);\n  }\n\n  /**\n   * Applies the relevant transformations to the game canvas to \"move\" or apply effects to the Camera\n   * @param ctx    Canvas context to apply transformations\n   * @param delta  The number of milliseconds since the last update\n   */\n  public draw(ctx: CanvasRenderingContext2D) {\n    const focus = this.getFocus();\n    const canvasWidth = ctx.canvas.width;\n    const canvasHeight = ctx.canvas.height;\n    const pixelRatio = this._engine ? this._engine.pixelRatio : window.devicePixelRatio;\n    const zoom = this.getZoom();\n\n    const newCanvasWidth = canvasWidth / zoom / pixelRatio;\n    const newCanvasHeight = canvasHeight / zoom / pixelRatio;\n\n    ctx.scale(zoom, zoom);\n    ctx.translate(-focus.x + newCanvasWidth / 2 + this._xShake, -focus.y + newCanvasHeight / 2 + this._yShake);\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    const focus = this.getFocus();\n    ctx.fillStyle = 'red';\n    ctx.strokeStyle = 'white';\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    ctx.arc(focus.x, focus.y, 15, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.stroke();\n\n    ctx.beginPath();\n    ctx.arc(focus.x, focus.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.stroke();\n\n    ctx.beginPath();\n    ctx.setLineDash([5, 15]);\n    ctx.lineWidth = 5;\n    ctx.strokeStyle = 'white';\n    ctx.strokeRect(this.viewport.left, this.viewport.top, this.viewport.width, this.viewport.height);\n    ctx.closePath();\n  }\n\n  private _isDoneShaking(): boolean {\n    return !this._isShaking || this._elapsedShakeTime >= this._shakeDuration;\n  }\n}\n","import { Color } from './Drawing/Color';\nimport { WebAudio } from './Util/WebAudio';\nimport { Logger } from './Util/Log';\nimport { Promise, PromiseState } from './Promises';\nimport { Engine } from './Engine';\nimport { Loadable } from './Interfaces/Loadable';\nimport { CanLoad } from './Interfaces/Loader';\nimport { Class } from './Class';\nimport * as DrawUtil from './Util/DrawUtil';\n\nimport logoImg from './Loader.logo.png';\nimport loaderCss from './Loader.css';\n\n/**\n * Pre-loading assets\n *\n * The loader provides a mechanism to preload multiple resources at\n * one time. The loader must be passed to the engine in order to\n * trigger the loading progress bar.\n *\n * The [[Loader]] itself implements [[ILoadable]] so you can load loaders.\n *\n * ## Example: Pre-loading resources for a game\n *\n * ```js\n * // create a loader\n * var loader = new ex.Loader();\n *\n * // create a resource dictionary (best practice is to keep a separate file)\n * var resources = {\n *   TextureGround: new ex.Texture(\"/images/textures/ground.png\"),\n *   SoundDeath: new ex.Sound(\"/sound/death.wav\", \"/sound/death.mp3\")\n * };\n *\n * // loop through dictionary and add to loader\n * for (var loadable in resources) {\n *   if (resources.hasOwnProperty(loadable)) {\n *     loader.addResource(resources[loadable]);\n *   }\n * }\n *\n * // start game\n * game.start(loader).then(function () {\n *   console.log(\"Game started!\");\n * });\n * ```\n *\n * ## Customize the Loader\n *\n * The loader can be customized to show different, text, logo, background color, and button.\n *\n * ```typescript\n * const loader = new ex.Loader([playerTexture]);\n *\n * // The loaders button text can simply modified using this\n * loader.playButtonText = 'Start the best game ever';\n *\n * // The logo can be changed by inserting a base64 image string here\n *\n * loader.logo = 'data:image/png;base64,iVBORw...';\n * loader.logoWidth = 15;\n * loader.logoHeight = 14;\n *\n * // The background color can be changed like so by supplying a valid CSS color string\n *\n * loader.backgroundColor = 'red'\n * loader.backgroundColor = '#176BAA'\n *\n * // To build a completely new button\n * loader.startButtonFactory = () => {\n *     let myButton = document.createElement('button');\n *     myButton.textContent = 'The best button';\n *     return myButton;\n * };\n *\n * engine.start(loader).then(() => {});\n * ```\n */\nexport class Loader extends Class implements CanLoad {\n  private _resourceList: Loadable[] = [];\n  private _index = 0;\n\n  private _playButtonShown: boolean = false;\n  private _resourceCount: number = 0;\n  private _numLoaded: number = 0;\n  private _progressCounts: { [key: string]: number } = {};\n  private _totalCounts: { [key: string]: number } = {};\n  private _engine: Engine;\n\n  // logo drawing stuff\n\n  // base64 string encoding of the excalibur logo (logo-white.png)\n  public logo = logoImg;\n  public logoWidth = 468;\n  public logoHeight = 118;\n  public backgroundColor = '#176BAA';\n\n  protected _imageElement: HTMLImageElement;\n  protected get _image() {\n    if (!this._imageElement) {\n      this._imageElement = new Image();\n      this._imageElement.src = this.logo;\n    }\n\n    return this._imageElement;\n  }\n\n  public suppressPlayButton: boolean = false;\n  protected _playButtonRootElement: HTMLElement;\n  protected _playButtonElement: HTMLButtonElement;\n  protected _styleBlock: HTMLStyleElement;\n  /** Loads the css from Loader.css */\n  protected _playButtonStyles: string = loaderCss.toString();\n  protected get _playButton() {\n    if (!this._playButtonRootElement) {\n      this._playButtonRootElement = document.createElement('div');\n      this._playButtonRootElement.style.position = 'absolute';\n      document.body.appendChild(this._playButtonRootElement);\n    }\n    if (!this._styleBlock) {\n      this._styleBlock = document.createElement('style');\n      this._styleBlock.textContent = this._playButtonStyles;\n      document.head.appendChild(this._styleBlock);\n    }\n    if (!this._playButtonElement) {\n      this._playButtonElement = this.startButtonFactory();\n      this._playButtonRootElement.appendChild(this._playButtonElement);\n    }\n    return this._playButtonElement;\n  }\n\n  /**\n   * Get/set play button text\n   */\n  public playButtonText: string = 'Play game';\n\n  /**\n   * Return a html button element for excalibur to use as a play button\n   */\n  public startButtonFactory = () => {\n    const buttonElement = document.createElement('button');\n    buttonElement.id = 'excalibur-play';\n    buttonElement.textContent = this.playButtonText;\n    buttonElement.style.display = 'none';\n    return buttonElement;\n  };\n\n  /**\n   * @param loadables  Optionally provide the list of resources you want to load at constructor time\n   */\n  constructor(loadables?: Loadable[]) {\n    super();\n\n    if (loadables) {\n      this.addResources(loadables);\n    }\n  }\n\n  public wireEngine(engine: Engine) {\n    this._engine = engine;\n  }\n\n  /**\n   * Add a resource to the loader to load\n   * @param loadable  Resource to add\n   */\n  public addResource(loadable: Loadable) {\n    const key = this._index++;\n    this._resourceList.push(loadable);\n    this._progressCounts[key] = 0;\n    this._totalCounts[key] = 1;\n    this._resourceCount++;\n  }\n\n  /**\n   * Add a list of resources to the loader to load\n   * @param loadables  The list of resources to load\n   */\n  public addResources(loadables: Loadable[]) {\n    let i = 0;\n    const len = loadables.length;\n\n    for (i; i < len; i++) {\n      this.addResource(loadables[i]);\n    }\n  }\n\n  /**\n   * Returns true if the loader has completely loaded all resources\n   */\n  public isLoaded() {\n    return this._numLoaded === this._resourceCount;\n  }\n\n  /**\n   * Shows the play button and returns a promise that resolves when clicked\n   */\n  public showPlayButton(): Promise<any> {\n    if (this.suppressPlayButton) {\n      return Promise.resolve();\n    } else {\n      this._playButtonShown = true;\n      this._playButton.style.display = 'block';\n      const promise = new Promise();\n\n      this._playButton.addEventListener('click', () => (promise.state() === PromiseState.Pending ? promise.resolve() : promise));\n      this._playButton.addEventListener('touchend', () => (promise.state() === PromiseState.Pending ? promise.resolve() : promise));\n      this._playButton.addEventListener('pointerup', () => (promise.state() === PromiseState.Pending ? promise.resolve() : promise));\n\n      return promise;\n    }\n  }\n\n  public hidePlayButton() {\n    this._playButtonShown = false;\n    this._playButton.style.display = 'none';\n  }\n\n  /**\n   * Begin loading all of the supplied resources, returning a promise\n   * that resolves when loading of all is complete\n   */\n  public load(): Promise<any> {\n    const complete = new Promise<any>();\n    const me = this;\n    if (this._resourceList.length === 0) {\n      me.showPlayButton().then(() => {\n        // Unlock audio context in chrome after user gesture\n        // https://github.com/excaliburjs/Excalibur/issues/262\n        // https://github.com/excaliburjs/Excalibur/issues/1031\n        WebAudio.unlock().then(() => {\n          me.hidePlayButton();\n          me.oncomplete.call(me);\n          complete.resolve();\n        });\n      });\n      return complete;\n    }\n\n    const progressArray = new Array<any>(this._resourceList.length);\n    const progressChunks = this._resourceList.length;\n\n    this._resourceList.forEach((r, i) => {\n      if (this._engine) {\n        r.wireEngine(this._engine);\n      }\n      r.onprogress = function(e) {\n        const total = <number>e.total;\n        const loaded = <number>e.loaded;\n        progressArray[i] = { loaded: (loaded / total) * (100 / progressChunks), total: 100 };\n\n        const progressResult: any = progressArray.reduce(\n          function(accum, next) {\n            return { loaded: accum.loaded + next.loaded, total: 100 };\n          },\n          { loaded: 0, total: 100 }\n        );\n\n        me.onprogress.call(me, progressResult);\n      };\n      r.oncomplete = r.onerror = function() {\n        me._numLoaded++;\n        if (me._numLoaded === me._resourceCount) {\n          setTimeout(() => {\n            me.showPlayButton().then(() => {\n              // Unlock audio context in chrome after user gesture\n              // https://github.com/excaliburjs/Excalibur/issues/262\n              // https://github.com/excaliburjs/Excalibur/issues/1031\n              WebAudio.unlock().then(() => {\n                me.hidePlayButton();\n                me.oncomplete.call(me);\n                complete.resolve();\n              });\n            });\n          }, 200); // short delay in showing the button for aesthetics\n        }\n      };\n    });\n\n    function loadNext(list: Loadable[], index: number) {\n      if (!list[index]) {\n        return;\n      }\n      list[index].load().then(function() {\n        loadNext(list, index + 1);\n      });\n    }\n    loadNext(this._resourceList, 0);\n\n    return complete;\n  }\n\n  /**\n   * Loader draw function. Draws the default Excalibur loading screen.\n   * Override `logo`, `logoWidth`, `logoHeight` and `backgroundColor` properties\n   * to customize the drawing, or just override entire method.\n   */\n  public draw(ctx: CanvasRenderingContext2D) {\n    const canvasHeight = this._engine.canvasHeight / this._engine.pixelRatio;\n    const canvasWidth = this._engine.canvasWidth / this._engine.pixelRatio;\n\n    if (this._playButtonRootElement) {\n      const left = ctx.canvas.offsetLeft;\n      const top = ctx.canvas.offsetTop;\n      const buttonWidth = this._playButton.clientWidth;\n      const buttonHeight = this._playButton.clientHeight;\n      this._playButtonRootElement.style.left = `${left + canvasWidth / 2 - buttonWidth / 2}px`;\n      this._playButtonRootElement.style.top = `${top + canvasHeight / 2 - buttonHeight / 2 + 100}px`;\n    }\n\n    ctx.fillStyle = this.backgroundColor;\n    ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n\n    const y = canvasHeight / 2;\n    const width = Math.min(this.logoWidth, canvasWidth * 0.75);\n    const x = canvasWidth / 2 - width / 2;\n\n    const imageHeight = Math.floor(width * (this.logoHeight / this.logoWidth)); // OG height/width factor\n    const oldAntialias = this._engine.getAntialiasing();\n    this._engine.setAntialiasing(true);\n    ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, x, y - imageHeight - 20, width, imageHeight);\n\n    // loading box\n    if (!this.suppressPlayButton && this._playButtonShown) {\n      this._engine.setAntialiasing(oldAntialias);\n      return;\n    }\n\n    ctx.lineWidth = 2;\n    DrawUtil.roundRect(ctx, x, y, width, 20, 10);\n    const progress = width * (this._numLoaded / this._resourceCount);\n    const margin = 5;\n    const progressWidth = progress - margin * 2;\n    const height = 20 - margin * 2;\n    DrawUtil.roundRect(ctx, x + margin, y + margin, progressWidth > 0 ? progressWidth : 0, height, 5, null, Color.White);\n    this._engine.setAntialiasing(oldAntialias);\n  }\n\n  /**\n   * Perform any calculations or logic in the `update` method. The default `Loader` does not\n   * do anything in this method so it is safe to override.\n   */\n  public update(_engine: Engine, _delta: number) {\n    // overridable update\n  }\n\n  public getData: () => any = () => {\n    return;\n  };\n\n  public setData: (data: any) => any = () => {\n    return;\n  };\n\n  public processData: (data: any) => any = () => {\n    return;\n  };\n\n  public onprogress: (e: any) => void = (e: any) => {\n    Logger.getInstance().debug('[ex.Loader] Loading ' + ((100 * e.loaded) / e.total).toFixed(0));\n\n    return;\n  };\n\n  public oncomplete: () => void = () => {\n    return;\n  };\n\n  public onerror: () => void = () => {\n    return;\n  };\n}\n","import { Logger } from './Log';\n/**\n * This is the list of features that will be used to log the supported\n * features to the console when Detector.logBrowserFeatures() is called.\n */\n\nconst REPORTED_FEATURES: { [key: string]: string } = {\n  webgl: 'WebGL',\n  webaudio: 'WebAudio',\n  gamepadapi: 'Gamepad API'\n};\n\n/**\n * Interface for detected browser features matrix\n */\nexport interface DetectedFeatures {\n  readonly canvas: boolean;\n  readonly arraybuffer: boolean;\n  readonly dataurl: boolean;\n  readonly objecturl: boolean;\n  readonly rgba: boolean;\n  readonly webaudio: boolean;\n  readonly webgl: boolean;\n  readonly gamepadapi: boolean;\n}\n\ninterface CriticalTests {\n  canvasSupport(): boolean;\n  arrayBufferSupport(): boolean;\n  dataUrlSupport(): boolean;\n  objectUrlSupport(): boolean;\n  rgbaSupport(): boolean;\n}\n\ninterface WarningTests {\n  webAudioSupport(): boolean;\n  webglSupport(): boolean;\n}\n\n/**\n * Excalibur internal feature detection helper class\n */\nexport class Detector {\n  private _features: DetectedFeatures = null;\n\n  public failedTests: string[] = [];\n\n  public constructor() {\n    this._features = this._loadBrowserFeatures();\n  }\n\n  /**\n   * Returns a map of currently supported browser features. This method\n   * treats the features as a singleton and will only calculate feature\n   * support if it has not previously been done.\n   */\n  public getBrowserFeatures(): DetectedFeatures {\n    if (this._features === null) {\n      this._features = this._loadBrowserFeatures();\n    }\n    return this._features;\n  }\n\n  /**\n   * Report on non-critical browser support for debugging purposes.\n   * Use native browser console colors for visibility.\n   */\n  public logBrowserFeatures(): void {\n    let msg = '%cSUPPORTED BROWSER FEATURES\\n==========================%c\\n';\n    const args = ['font-weight: bold; color: navy', 'font-weight: normal; color: inherit'];\n\n    const supported: any = this.getBrowserFeatures();\n    for (const feature of Object.keys(REPORTED_FEATURES)) {\n      if (supported[feature]) {\n        msg += '(%c\\u2713%c)'; // ()\n        args.push('font-weight: bold; color: green');\n        args.push('font-weight: normal; color: inherit');\n      } else {\n        msg += '(%c\\u2717%c)'; // ()\n        args.push('font-weight: bold; color: red');\n        args.push('font-weight: normal; color: inherit');\n      }\n\n      msg += ' ' + REPORTED_FEATURES[feature] + '\\n';\n    }\n\n    args.unshift(msg);\n    console.log.apply(console, args);\n  }\n\n  /**\n   * Executes several IIFE's to get a constant reference to supported\n   * features within the current execution context.\n   */\n  private _loadBrowserFeatures(): DetectedFeatures {\n    return {\n      // IIFE to check canvas support\n      canvas: (() => {\n        return this._criticalTests.canvasSupport();\n      })(),\n\n      // IIFE to check arraybuffer support\n      arraybuffer: (() => {\n        return this._criticalTests.arrayBufferSupport();\n      })(),\n\n      // IIFE to check dataurl support\n      dataurl: (() => {\n        return this._criticalTests.dataUrlSupport();\n      })(),\n\n      // IIFE to check objecturl support\n      objecturl: (() => {\n        return this._criticalTests.objectUrlSupport();\n      })(),\n\n      // IIFE to check rgba support\n      rgba: (() => {\n        return this._criticalTests.rgbaSupport();\n      })(),\n\n      // IIFE to check webaudio support\n      webaudio: (() => {\n        return this._warningTest.webAudioSupport();\n      })(),\n\n      // IIFE to check webgl support\n      webgl: (() => {\n        return this._warningTest.webglSupport();\n      })(),\n\n      // IIFE to check gamepadapi support\n      gamepadapi: (() => {\n        return !!(<any>navigator).getGamepads;\n      })()\n    };\n  }\n\n  // critical browser features required for ex to run\n  private _criticalTests: CriticalTests = {\n    // Test canvas/2d context support\n    canvasSupport: function() {\n      const elem = document.createElement('canvas');\n      return !!(elem.getContext && elem.getContext('2d'));\n    },\n\n    // Test array buffer support ex uses for downloading binary data\n    arrayBufferSupport: function() {\n      const xhr = new XMLHttpRequest();\n      xhr.open('GET', '/');\n      try {\n        xhr.responseType = 'arraybuffer';\n      } catch (e) {\n        return false;\n      }\n      return xhr.responseType === 'arraybuffer';\n    },\n\n    // Test data urls ex uses for sprites\n    dataUrlSupport: function() {\n      const canvas = document.createElement('canvas');\n      return canvas.toDataURL('image/png').indexOf('data:image/png') === 0;\n    },\n\n    // Test object url support for loading\n    objectUrlSupport: function() {\n      return 'URL' in window && 'revokeObjectURL' in URL && 'createObjectURL' in URL;\n    },\n\n    // RGBA support for colors\n    rgbaSupport: function() {\n      const style = document.createElement('a').style;\n      style.cssText = 'background-color:rgba(150,255,150,.5)';\n      return ('' + style.backgroundColor).indexOf('rgba') > -1;\n    }\n  };\n\n  // warnings excalibur performance will be degraded\n  private _warningTest: WarningTests = {\n    webAudioSupport: function() {\n      return !!(\n        (<any>window).AudioContext ||\n        (<any>window).webkitAudioContext ||\n        (<any>window).mozAudioContext ||\n        (<any>window).msAudioContext ||\n        (<any>window).oAudioContext\n      );\n    },\n    webglSupport: function() {\n      const elem = document.createElement('canvas');\n      return !!(elem.getContext && elem.getContext('webgl'));\n    }\n  };\n\n  public test(): boolean {\n    // Critical test will for ex not to run\n    let failedCritical = false;\n    for (const test in this._criticalTests) {\n      if (!this._criticalTests[<keyof CriticalTests>test].call(this)) {\n        this.failedTests.push(test);\n        Logger.getInstance().error('Critical browser feature missing, Excalibur requires:', test);\n        failedCritical = true;\n      }\n    }\n    if (failedCritical) {\n      return false;\n    }\n\n    // Warning tests do not for ex to return false to compatibility\n    for (const warning in this._warningTest) {\n      if (!this._warningTest[<keyof WarningTests>warning]()) {\n        Logger.getInstance().warn('Warning browser feature missing, Excalibur will have reduced performance:', warning);\n      }\n    }\n\n    return true;\n  }\n}\n","import { Physics } from './../Physics';\nimport { BoundingBox } from './BoundingBox';\nimport { Body } from './Body';\n\nimport { Ray } from '../Algebra';\nimport { Logger } from '../Util/Log';\n\n/**\n * Dynamic Tree Node used for tracking bounds within the tree\n */\nexport class TreeNode {\n  public left: TreeNode;\n  public right: TreeNode;\n  public bounds: BoundingBox;\n  public height: number;\n  public body: Body;\n  constructor(public parent?: TreeNode) {\n    this.parent = parent || null;\n    this.body = null;\n    this.bounds = new BoundingBox();\n    this.left = null;\n    this.right = null;\n    this.height = 0;\n  }\n\n  public isLeaf(): boolean {\n    return !this.left && !this.right;\n  }\n}\n\n/**\n * The DynamicTrees provides a spatial partiioning data structure for quickly querying for overlapping bounding boxes for\n * all tracked bodies. The worst case performance of this is O(n*log(n)) where n is the number of bodies in the tree.\n *\n * Internally the bounding boxes are organized as a balanced binary tree of bounding boxes, where the leaf nodes are tracked bodies.\n * Every non-leaf node is a bounding box that contains child bounding boxes.\n */\nexport class DynamicTree {\n  public root: TreeNode;\n  public nodes: { [key: number]: TreeNode };\n  constructor(public worldBounds: BoundingBox = new BoundingBox(-Number.MAX_VALUE, -Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE)) {\n    this.root = null;\n    this.nodes = {};\n  }\n\n  /**\n   * Inserts a node into the dynamic tree\n   */\n  private _insert(leaf: TreeNode): void {\n    // If there are no nodes in the tree, make this the root leaf\n    if (this.root === null) {\n      this.root = leaf;\n      this.root.parent = null;\n      return;\n    }\n\n    // Search the tree for a node that is not a leaf and find the best place to insert\n    const leafAABB = leaf.bounds;\n    let currentRoot = this.root;\n    while (!currentRoot.isLeaf()) {\n      const left = currentRoot.left;\n      const right = currentRoot.right;\n\n      const area = currentRoot.bounds.getPerimeter();\n      const combinedAABB = currentRoot.bounds.combine(leafAABB);\n      const combinedArea = combinedAABB.getPerimeter();\n\n      // Calculate cost heuristic for creating a new parent and leaf\n      const cost = 2 * combinedArea;\n\n      // Minimum cost of pushing the leaf down the tree\n      const inheritanceCost = 2 * (combinedArea - area);\n\n      // Cost of descending\n      let leftCost = 0;\n      const leftCombined = leafAABB.combine(left.bounds);\n      let newArea;\n      let oldArea;\n      if (left.isLeaf()) {\n        leftCost = leftCombined.getPerimeter() + inheritanceCost;\n      } else {\n        oldArea = left.bounds.getPerimeter();\n        newArea = leftCombined.getPerimeter();\n        leftCost = newArea - oldArea + inheritanceCost;\n      }\n\n      let rightCost = 0;\n      const rightCombined = leafAABB.combine(right.bounds);\n      if (right.isLeaf()) {\n        rightCost = rightCombined.getPerimeter() + inheritanceCost;\n      } else {\n        oldArea = right.bounds.getPerimeter();\n        newArea = rightCombined.getPerimeter();\n        rightCost = newArea - oldArea + inheritanceCost;\n      }\n\n      // cost is acceptable\n      if (cost < leftCost && cost < rightCost) {\n        break;\n      }\n\n      // Descend to the depths\n      if (leftCost < rightCost) {\n        currentRoot = left;\n      } else {\n        currentRoot = right;\n      }\n    }\n\n    // Create the new parent node and insert into the tree\n    const oldParent = currentRoot.parent;\n    const newParent = new TreeNode(oldParent);\n    newParent.bounds = leafAABB.combine(currentRoot.bounds);\n    newParent.height = currentRoot.height + 1;\n\n    if (oldParent !== null) {\n      // The sibling node was not the root\n      if (oldParent.left === currentRoot) {\n        oldParent.left = newParent;\n      } else {\n        oldParent.right = newParent;\n      }\n\n      newParent.left = currentRoot;\n      newParent.right = leaf;\n\n      currentRoot.parent = newParent;\n      leaf.parent = newParent;\n    } else {\n      // The sibling node was the root\n      newParent.left = currentRoot;\n      newParent.right = leaf;\n\n      currentRoot.parent = newParent;\n      leaf.parent = newParent;\n      this.root = newParent;\n    }\n\n    // Walk up the tree fixing heights and AABBs\n    let currentNode = leaf.parent;\n    while (currentNode) {\n      currentNode = this._balance(currentNode);\n\n      if (!currentNode.left) {\n        throw new Error('Parent of current leaf cannot have a null left child' + currentNode);\n      }\n      if (!currentNode.right) {\n        throw new Error('Parent of current leaf cannot have a null right child' + currentNode);\n      }\n\n      currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\n      currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\n\n      currentNode = currentNode.parent;\n    }\n  }\n\n  /**\n   * Removes a node from the dynamic tree\n   */\n  private _remove(leaf: TreeNode) {\n    if (leaf === this.root) {\n      this.root = null;\n      return;\n    }\n\n    const parent = leaf.parent;\n    const grandParent = parent.parent;\n    let sibling: TreeNode;\n    if (parent.left === leaf) {\n      sibling = parent.right;\n    } else {\n      sibling = parent.left;\n    }\n\n    if (grandParent) {\n      if (grandParent.left === parent) {\n        grandParent.left = sibling;\n      } else {\n        grandParent.right = sibling;\n      }\n      sibling.parent = grandParent;\n\n      let currentNode = grandParent;\n      while (currentNode) {\n        currentNode = this._balance(currentNode);\n        currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\n        currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\n\n        currentNode = currentNode.parent;\n      }\n    } else {\n      this.root = sibling;\n      sibling.parent = null;\n    }\n  }\n\n  /**\n   * Tracks a body in the dynamic tree\n   */\n  public trackBody(body: Body) {\n    const node = new TreeNode();\n    node.body = body;\n    node.bounds = body.collider.bounds;\n    node.bounds.left -= 2;\n    node.bounds.top -= 2;\n    node.bounds.right += 2;\n    node.bounds.bottom += 2;\n    this.nodes[body.id] = node;\n    this._insert(node);\n  }\n\n  /**\n   * Updates the dynamic tree given the current bounds of each body being tracked\n   */\n  public updateBody(body: Body) {\n    const node = this.nodes[body.id];\n    if (!node) {\n      return false;\n    }\n    const b = body.collider.bounds;\n\n    // if the body is outside the world no longer update it\n    if (!this.worldBounds.contains(b)) {\n      Logger.getInstance().warn('Collider with id ' + body.id + ' is outside the world bounds and will no longer be tracked for physics');\n      this.untrackBody(body);\n      return false;\n    }\n\n    if (node.bounds.contains(b)) {\n      return false;\n    }\n\n    this._remove(node);\n    b.left -= Physics.boundsPadding;\n    b.top -= Physics.boundsPadding;\n    b.right += Physics.boundsPadding;\n    b.bottom += Physics.boundsPadding;\n\n    const multdx = body.vel.x * Physics.dynamicTreeVelocityMultiplyer;\n    const multdy = body.vel.y * Physics.dynamicTreeVelocityMultiplyer;\n\n    if (multdx < 0) {\n      b.left += multdx;\n    } else {\n      b.right += multdx;\n    }\n\n    if (multdy < 0) {\n      b.top += multdy;\n    } else {\n      b.bottom += multdy;\n    }\n\n    node.bounds = b;\n    this._insert(node);\n    return true;\n  }\n\n  /**\n   * Untracks a body from the dynamic tree\n   */\n  public untrackBody(body: Body) {\n    const node = this.nodes[body.collider.id];\n    if (!node) {\n      return;\n    }\n    this._remove(node);\n    this.nodes[body.collider.id] = null;\n    delete this.nodes[body.collider.id];\n  }\n\n  /**\n   * Balances the tree about a node\n   */\n  private _balance(node: TreeNode) {\n    if (node === null) {\n      throw new Error('Cannot balance at null node');\n    }\n\n    if (node.isLeaf() || node.height < 2) {\n      return node;\n    }\n\n    const left = node.left;\n    const right = node.right;\n\n    const a = node;\n    const b = left;\n    const c = right;\n    const d = left.left;\n    const e = left.right;\n    const f = right.left;\n    const g = right.right;\n\n    const balance = c.height - b.height;\n    // Rotate c node up\n    if (balance > 1) {\n      // Swap the right node with it's parent\n      c.left = a;\n      c.parent = a.parent;\n      a.parent = c;\n\n      // The original node's old parent should point to the right node\n      // this is mega confusing\n      if (c.parent) {\n        if (c.parent.left === a) {\n          c.parent.left = c;\n        } else {\n          c.parent.right = c;\n        }\n      } else {\n        this.root = c;\n      }\n\n      // Rotate\n      if (f.height > g.height) {\n        c.right = f;\n        a.right = g;\n        g.parent = a;\n\n        a.bounds = b.bounds.combine(g.bounds);\n        c.bounds = a.bounds.combine(f.bounds);\n\n        a.height = 1 + Math.max(b.height, g.height);\n        c.height = 1 + Math.max(a.height, f.height);\n      } else {\n        c.right = g;\n        a.right = f;\n        f.parent = a;\n\n        a.bounds = b.bounds.combine(f.bounds);\n        c.bounds = a.bounds.combine(g.bounds);\n\n        a.height = 1 + Math.max(b.height, f.height);\n        c.height = 1 + Math.max(a.height, g.height);\n      }\n\n      return c;\n    }\n    // Rotate left node up\n    if (balance < -1) {\n      // swap\n      b.left = a;\n      b.parent = a.parent;\n      a.parent = b;\n\n      // node's old parent should point to b\n      if (b.parent) {\n        if (b.parent.left === a) {\n          b.parent.left = b;\n        } else {\n          if (b.parent.right !== a) {\n            throw 'Error rotating Dynamic Tree';\n          }\n          b.parent.right = b;\n        }\n      } else {\n        this.root = b;\n      }\n\n      // rotate\n      if (d.height > e.height) {\n        b.right = d;\n        a.left = e;\n        e.parent = a;\n\n        a.bounds = c.bounds.combine(e.bounds);\n        b.bounds = a.bounds.combine(d.bounds);\n\n        a.height = 1 + Math.max(c.height, e.height);\n        b.height = 1 + Math.max(a.height, d.height);\n      } else {\n        b.right = e;\n        a.left = d;\n        d.parent = a;\n\n        a.bounds = c.bounds.combine(d.bounds);\n        b.bounds = a.bounds.combine(e.bounds);\n\n        a.height = 1 + Math.max(c.height, d.height);\n        b.height = 1 + Math.max(a.height, e.height);\n      }\n      return b;\n    }\n\n    return node;\n  }\n\n  /**\n   * Returns the internal height of the tree, shorter trees are better. Performance drops as the tree grows\n   */\n  public getHeight(): number {\n    if (this.root === null) {\n      return 0;\n    }\n    return this.root.height;\n  }\n\n  /**\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be colliding with the provided body.\n   *\n   * In the query callback, it will be passed a potential collider. Returning true from this callback indicates\n   * that you are complete with your query and you do not want to continue. Returning false will continue searching\n   * the tree until all possible colliders have been returned.\n   */\n  public query(body: Body, callback: (other: Body) => boolean): void {\n    const bounds = body.collider.bounds;\n    const helper = (currentNode: TreeNode): boolean => {\n      if (currentNode && currentNode.bounds.intersect(bounds)) {\n        if (currentNode.isLeaf() && currentNode.body !== body) {\n          if (callback.call(body, currentNode.body)) {\n            return true;\n          }\n        } else {\n          return helper(currentNode.left) || helper(currentNode.right);\n        }\n      }\n      return false;\n    };\n    helper(this.root);\n  }\n\n  /**\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be intersecting. By default the raycast query uses an infinitely\n   * long ray to test the tree specified by `max`.\n   *\n   * In the query callback, it will be passed a potential body that intersects with the racast. Returning true from this\n   * callback indicates that your are complete with your query and do not want to continue. Return false will continue searching\n   * the tree until all possible bodies that would intersect with the ray have been returned.\n   */\n  public rayCastQuery(ray: Ray, max: number = Infinity, callback: (other: Body) => boolean): void {\n    const helper = (currentNode: TreeNode): boolean => {\n      if (currentNode && currentNode.bounds.rayCast(ray, max)) {\n        if (currentNode.isLeaf()) {\n          if (callback.call(ray, currentNode.body)) {\n            // ray hit a leaf! return the body\n            return true;\n          }\n        } else {\n          // ray hit but not at a leaf, recurse deeper\n          return helper(currentNode.left) || helper(currentNode.right);\n        }\n      }\n      return false; // ray missed\n    };\n    helper(this.root);\n  }\n\n  public getNodes(): TreeNode[] {\n    const helper = (currentNode: TreeNode): TreeNode[] => {\n      if (currentNode) {\n        return [currentNode].concat(helper(currentNode.left), helper(currentNode.right));\n      } else {\n        return [];\n      }\n    };\n    return helper(this.root);\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    // draw all the nodes in the Dynamic Tree\n    const helper = (currentNode: TreeNode) => {\n      if (currentNode) {\n        if (currentNode.isLeaf()) {\n          ctx.lineWidth = 1;\n          ctx.strokeStyle = 'green';\n        } else {\n          ctx.lineWidth = 1;\n          ctx.strokeStyle = 'white';\n        }\n        currentNode.bounds.debugDraw(ctx);\n\n        if (currentNode.left) {\n          helper(currentNode.left);\n        }\n        if (currentNode.right) {\n          helper(currentNode.right);\n        }\n      }\n    };\n\n    helper(this.root);\n  }\n}\n","import { Physics } from './../Physics';\nimport { CollisionBroadphase } from './CollisionResolver';\nimport { DynamicTree } from './DynamicTree';\nimport { Pair } from './Pair';\nimport { Body } from './Body';\n\nimport { Vector, Ray } from '../Algebra';\nimport { FrameStats } from '../Debug';\nimport { CollisionResolutionStrategy } from '../Physics';\nimport { Logger } from '../Util/Log';\nimport { CollisionStartEvent, CollisionEndEvent } from '../Events';\nimport { CollisionType } from './CollisionType';\nimport { Collider } from './Collider';\n\nexport class DynamicTreeCollisionBroadphase implements CollisionBroadphase {\n  private _dynamicCollisionTree = new DynamicTree();\n  private _collisionHash: { [key: string]: boolean } = {};\n  private _collisionPairCache: Pair[] = [];\n  private _lastFramePairs: Pair[] = [];\n  private _lastFramePairsHash: { [pairId: string]: Pair } = {};\n\n  /**\n   * Tracks a physics body for collisions\n   */\n  public track(target: Body): void {\n    if (!target) {\n      Logger.getInstance().warn('Cannot track null physics body');\n      return;\n    }\n    this._dynamicCollisionTree.trackBody(target);\n  }\n\n  /**\n   * Untracks a physics body\n   */\n  public untrack(target: Body): void {\n    if (!target) {\n      Logger.getInstance().warn('Cannot untrack a null physics body');\n      return;\n    }\n    this._dynamicCollisionTree.untrackBody(target);\n  }\n\n  private _shouldGenerateCollisionPair(colliderA: Collider, colliderB: Collider) {\n    // if the collision pair has been calculated already short circuit\n    const hash = Pair.calculatePairHash(colliderA, colliderB);\n    if (this._collisionHash[hash]) {\n      return false; // pair exists easy exit return false\n    }\n\n    return Pair.canCollide(colliderA, colliderB);\n  }\n\n  /**\n   * Detects potential collision pairs in a broadphase approach with the dynamic aabb tree strategy\n   */\n  public broadphase(targets: Body[], delta: number, stats?: FrameStats): Pair[] {\n    const seconds = delta / 1000;\n\n    // Retrieve the list of potential colliders, exclude killed, prevented, and self\n    const potentialColliders = targets.map((t) => t.collider).filter((other) => {\n      return other.active && other.type !== CollisionType.PreventCollision;\n    });\n\n    // clear old list of collision pairs\n    this._collisionPairCache = [];\n    this._collisionHash = {};\n\n    // check for normal collision pairs\n    let collider: Collider;\n    for (let j = 0, l = potentialColliders.length; j < l; j++) {\n      collider = potentialColliders[j];\n\n      // Query the collision tree for potential colliders\n      this._dynamicCollisionTree.query(collider.body, (other: Body) => {\n        if (this._shouldGenerateCollisionPair(collider, other.collider)) {\n          const pair = new Pair(collider, other.collider);\n          this._collisionHash[pair.id] = true;\n          this._collisionPairCache.push(pair);\n        }\n        // Always return false, to query whole tree. Returning true in the query method stops searching\n        return false;\n      });\n    }\n    if (stats) {\n      stats.physics.pairs = this._collisionPairCache.length;\n    }\n\n    // Check dynamic tree for fast moving objects\n    // Fast moving objects are those moving at least there smallest bound per frame\n    if (Physics.checkForFastBodies) {\n      for (const collider of potentialColliders) {\n        // Skip non-active objects. Does not make sense on other collison types\n        if (collider.type !== CollisionType.Active) {\n          continue;\n        }\n\n        // Maximum travel distance next frame\n        const updateDistance =\n          collider.body.vel.magnitude() * seconds + // velocity term\n          collider.body.acc.magnitude() * 0.5 * seconds * seconds; // acc term\n\n        // Find the minimum dimension\n        const minDimension = Math.min(collider.bounds.height, collider.bounds.width);\n        if (Physics.disableMinimumSpeedForFastBody || updateDistance > minDimension / 2) {\n          if (stats) {\n            stats.physics.fastBodies++;\n          }\n\n          // start with the oldPos because the integration for actors has already happened\n          // objects resting on a surface may be slightly penatrating in the current position\n          const updateVec = collider.body.pos.sub(collider.body.oldPos);\n          const centerPoint = collider.shape.center;\n          const furthestPoint = collider.shape.getFurthestPoint(collider.body.vel);\n          const origin: Vector = furthestPoint.sub(updateVec);\n\n          const ray: Ray = new Ray(origin, collider.body.vel);\n\n          // back the ray up by -2x surfaceEpsilon to account for fast moving objects starting on the surface\n          ray.pos = ray.pos.add(ray.dir.scale(-2 * Physics.surfaceEpsilon));\n          let minBody: Body;\n          let minTranslate: Vector = new Vector(Infinity, Infinity);\n          this._dynamicCollisionTree.rayCastQuery(ray, updateDistance + Physics.surfaceEpsilon * 2, (other: Body) => {\n            if (collider.body !== other && other.collider.shape && Pair.canCollide(collider, other.collider)) {\n              const hitPoint = other.collider.shape.rayCast(ray, updateDistance + Physics.surfaceEpsilon * 10);\n              if (hitPoint) {\n                const translate = hitPoint.sub(origin);\n                if (translate.magnitude() < minTranslate.magnitude()) {\n                  minTranslate = translate;\n                  minBody = other;\n                }\n              }\n            }\n            return false;\n          });\n\n          if (minBody && Vector.isValid(minTranslate)) {\n            const pair = new Pair(collider, minBody.collider);\n            if (!this._collisionHash[pair.id]) {\n              this._collisionHash[pair.id] = true;\n              this._collisionPairCache.push(pair);\n            }\n            // move the fast moving object to the other body\n            // need to push into the surface by ex.Physics.surfaceEpsilon\n            const shift = centerPoint.sub(furthestPoint);\n            collider.body.pos = origin\n              .add(shift)\n              .add(minTranslate)\n              .add(ray.dir.scale(2 * Physics.surfaceEpsilon));\n            collider.shape.recalc();\n\n            if (stats) {\n              stats.physics.fastBodyCollisions++;\n            }\n          }\n        }\n      }\n    }\n    // return cache\n    return this._collisionPairCache;\n  }\n\n  /**\n   * Applies narrow phase on collision pairs to find actual area intersections\n   * Adds actual colliding pairs to stats' Frame data\n   */\n  public narrowphase(pairs: Pair[], stats?: FrameStats): Pair[] {\n    for (let i = 0; i < pairs.length; i++) {\n      pairs[i].collide();\n      if (stats && pairs[i].collision) {\n        stats.physics.collisions++;\n        stats.physics.collidersHash[pairs[i].id] = pairs[i];\n      }\n    }\n    return pairs.filter((p) => p.collision);\n  }\n\n  /**\n   * Perform collision resolution given a strategy (rigid body or box) and move objects out of intersect.\n   */\n  public resolve(pairs: Pair[], delta: number, strategy: CollisionResolutionStrategy): Pair[] {\n    for (const pair of pairs) {\n      pair.resolve(strategy);\n\n      if (pair.collision) {\n        pair.colliderA.body.applyMtv();\n        pair.colliderB.body.applyMtv();\n        // todo still don't like this, this is a small integration step to resolve narrowphase collisions\n        pair.colliderA.body.integrate(delta * Physics.collisionShift);\n        pair.colliderB.body.integrate(delta * Physics.collisionShift);\n      }\n    }\n\n    return pairs.filter((p) => p.canCollide);\n  }\n\n  public runCollisionStartEnd(pairs: Pair[]) {\n    const currentFrameHash: { [pairId: string]: Pair } = {};\n\n    for (const p of pairs) {\n      // load currentFrameHash\n      currentFrameHash[p.id] = p;\n\n      // find all new collisions\n      if (!this._lastFramePairsHash[p.id]) {\n        const actor1 = p.colliderA;\n        const actor2 = p.colliderB;\n        actor1.emit('collisionstart', new CollisionStartEvent(actor1, actor2, p));\n        actor2.emit('collisionstart', new CollisionStartEvent(actor2, actor1, p));\n      }\n    }\n\n    // find all old collisions\n    for (const p of this._lastFramePairs) {\n      if (!currentFrameHash[p.id]) {\n        const actor1 = p.colliderA;\n        const actor2 = p.colliderB;\n        actor1.emit('collisionend', new CollisionEndEvent(actor1, actor2));\n        actor2.emit('collisionend', new CollisionEndEvent(actor2, actor1));\n      }\n    }\n\n    // reset the last frame cache\n    this._lastFramePairs = pairs;\n    this._lastFramePairsHash = currentFrameHash;\n  }\n\n  /**\n   * Update the dynamic tree positions\n   */\n  public update(targets: Body[]): number {\n    let updated = 0;\n    const len = targets.length;\n\n    for (let i = 0; i < len; i++) {\n      if (this._dynamicCollisionTree.updateBody(targets[i])) {\n        updated++;\n      }\n    }\n    return updated;\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    if (Physics.broadphaseDebug) {\n      this._dynamicCollisionTree.debugDraw(ctx);\n    }\n\n    if (Physics.showContacts || Physics.showCollisionNormals) {\n      for (const pair of this._collisionPairCache) {\n        pair.debugDraw(ctx);\n      }\n    }\n  }\n}\n","/**\n * A sorted list implementation. NOTE: this implementation is not self-balancing\n */\nexport class SortedList<T> {\n  private _getComparable: Function;\n  private _root: BinaryTreeNode;\n\n  constructor(getComparable: () => any) {\n    this._getComparable = getComparable;\n  }\n\n  public find(element: any): boolean {\n    return this._find(this._root, element);\n  }\n\n  private _find(node: BinaryTreeNode, element: any): boolean {\n    if (node == null) {\n      return false;\n    } else if (this._getComparable.call(element) === node.getKey()) {\n      if (node.getData().indexOf(element) > -1) {\n        return true;\n      } else {\n        return false;\n      }\n    } else if (this._getComparable.call(element) < node.getKey()) {\n      return this._find(node.getLeft(), element);\n    } else {\n      return this._find(node.getRight(), element);\n    }\n  }\n\n  // returns the array of elements at a specific key value\n  public get(key: number): any[] {\n    return this._get(this._root, key);\n  }\n\n  private _get(node: BinaryTreeNode, key: number): any[] {\n    if (node == null) {\n      return [];\n    } else if (key === node.getKey()) {\n      return node.getData();\n    } else if (key < node.getKey()) {\n      return this._get(node.getLeft(), key);\n    } else {\n      return this._get(node.getRight(), key);\n    }\n  }\n\n  public add(element: any): boolean {\n    if (this._root == null) {\n      this._root = new BinaryTreeNode(this._getComparable.call(element), [element], null, null);\n      return true;\n    } else {\n      return this._insert(this._root, element);\n    }\n  }\n\n  private _insert(node: BinaryTreeNode, element: any): boolean {\n    if (node != null) {\n      if (this._getComparable.call(element) === node.getKey()) {\n        if (node.getData().indexOf(element) > -1) {\n          return false; // the element we're trying to insert already exists\n        } else {\n          node.getData().push(element);\n          return true;\n        }\n      } else if (this._getComparable.call(element) < node.getKey()) {\n        if (node.getLeft() == null) {\n          node.setLeft(new BinaryTreeNode(this._getComparable.call(element), [element], null, null));\n          return true;\n        } else {\n          return this._insert(node.getLeft(), element);\n        }\n      } else {\n        if (node.getRight() == null) {\n          node.setRight(new BinaryTreeNode(this._getComparable.call(element), [element], null, null));\n          return true;\n        } else {\n          return this._insert(node.getRight(), element);\n        }\n      }\n    }\n    return false;\n  }\n\n  public removeByComparable(element: any): void {\n    this._root = this._remove(this._root, element);\n  }\n\n  private _remove(node: BinaryTreeNode, element: any): BinaryTreeNode {\n    if (node == null) {\n      return null;\n    } else if (this._getComparable.call(element) === node.getKey()) {\n      const elementIndex = node.getData().indexOf(element);\n      // if the node contains the element, remove the element\n      if (elementIndex > -1) {\n        node.getData().splice(elementIndex, 1);\n        // if we have removed the last element at this node, remove the node\n        if (node.getData().length === 0) {\n          // if the node is a leaf\n          if (node.getLeft() == null && node.getRight() == null) {\n            return null;\n          } else if (node.getLeft() == null) {\n            return node.getRight();\n          } else if (node.getRight() == null) {\n            return node.getLeft();\n          }\n          // if node has 2 children\n          const temp = this._findMinNode(node.getRight());\n          node.setKey(temp.getKey());\n          node.setData(temp.getData());\n          node.setRight(this._cleanup(node.getRight(), temp)); //\"cleanup nodes\" (move them up recursively)\n          return node;\n        } else {\n          // this prevents the node from being removed since it still contains elements\n          return node;\n        }\n      }\n    } else if (this._getComparable.call(element) < node.getKey()) {\n      node.setLeft(this._remove(node.getLeft(), element));\n      return node;\n    } else {\n      node.setRight(this._remove(node.getRight(), element));\n      return node;\n    }\n    return null;\n  }\n\n  // called once we have successfully removed the element we wanted, recursively corrects the part of the tree below the removed node\n  private _cleanup(node: BinaryTreeNode, element: BinaryTreeNode): BinaryTreeNode {\n    const comparable = element.getKey();\n    if (node == null) {\n      return null;\n    } else if (comparable === node.getKey()) {\n      // if the node is a leaf\n      if (node.getLeft() == null && node.getRight() == null) {\n        return null;\n      } else if (node.getLeft() == null) {\n        return node.getRight();\n      } else if (node.getRight() == null) {\n        return node.getLeft();\n      }\n      // if node has 2 children\n      const temp = this._findMinNode(node.getRight());\n      node.setKey(temp.getKey());\n      node.setData(temp.getData());\n\n      node.setRight(this._cleanup(node.getRight(), temp));\n      return node;\n    } else if (this._getComparable.call(element) < node.getKey()) {\n      node.setLeft(this._cleanup(node.getLeft(), element));\n      return node;\n    } else {\n      node.setRight(this._cleanup(node.getRight(), element));\n      return node;\n    }\n  }\n\n  private _findMinNode(node: BinaryTreeNode): BinaryTreeNode {\n    let current = node;\n    while (current.getLeft() != null) {\n      current = current.getLeft();\n    }\n    return current;\n  }\n\n  public list(): Array<T> {\n    const results = new Array<any>();\n    this._list(this._root, results);\n    return results;\n  }\n\n  private _list(treeNode: BinaryTreeNode, results: Array<T>): void {\n    if (treeNode != null) {\n      this._list(treeNode.getLeft(), results);\n      treeNode.getData().forEach(function(element) {\n        results.push(element);\n      });\n      this._list(treeNode.getRight(), results);\n    }\n  }\n}\n\n/**\n * A tree node part of [[SortedList]]\n */\nexport class BinaryTreeNode {\n  private _key: number;\n  private _data: Array<any>;\n  private _left: BinaryTreeNode;\n  private _right: BinaryTreeNode;\n\n  constructor(key: number, data: Array<any>, left: BinaryTreeNode, right: BinaryTreeNode) {\n    this._key = key;\n    this._data = data;\n    this._left = left;\n    this._right = right;\n  }\n\n  public getKey(): number {\n    return this._key;\n  }\n\n  public setKey(key: number) {\n    this._key = key;\n  }\n\n  public getData(): Array<any> {\n    return this._data;\n  }\n\n  public setData(data: any) {\n    this._data = data;\n  }\n\n  public getLeft(): BinaryTreeNode {\n    return this._left;\n  }\n\n  public setLeft(left: BinaryTreeNode) {\n    this._left = left;\n  }\n\n  public getRight(): BinaryTreeNode {\n    return this._right;\n  }\n\n  public setRight(right: BinaryTreeNode) {\n    this._right = right;\n  }\n}\n\n/**\n * Mock element for testing\n *\n * @internal\n */\nexport class MockedElement {\n  private _key: number = 0;\n\n  constructor(key: number) {\n    this._key = key;\n  }\n\n  public getTheKey() {\n    return this._key;\n  }\n\n  public setKey(key: number) {\n    this._key = key;\n  }\n}\n","import { BoundingBox } from './Collision/BoundingBox';\nimport { GameEvent } from './Events';\nimport { Vector } from './Algebra';\nimport { Scene } from './Scene';\nimport { ActionContext } from './Actions/ActionContext';\nimport { Actor } from './Actor';\nimport { Logger } from './Util/Log';\nimport { Eventable } from './Interfaces/Evented';\nimport { Actionable } from './Actions/Actionable';\nimport { Class } from './Class';\nimport { obsolete } from './Util/Decorators';\n\n/**\n * Groups are used for logically grouping Actors so they can be acted upon\n * in bulk.\n *\n * @obsolete Use [[CollisionGroupManager]] for collision based behavior\n * [[include:Groups.md]]\n */\n@obsolete({ message: 'ex.Group will be deprecated in v0.24.0', alternateMethod: 'Use ex.CollisionGroupManager' })\nexport class Group extends Class implements Actionable, Eventable {\n  private _logger: Logger = Logger.getInstance();\n  private _members: Actor[] = [];\n\n  public actions: ActionContext = new ActionContext();\n\n  constructor(public name: string, public scene: Scene) {\n    super();\n    if (scene == null) {\n      this._logger.error('Invalid constructor arguments passed to Group: ', name, ', scene must not be null!');\n    } else {\n      const existingGroup = scene.groups[name];\n      if (existingGroup) {\n        this._logger.warn('Group with name', name, 'already exists. This new group will replace it.');\n      }\n      scene.groups[name] = this;\n    }\n  }\n\n  public add(actor: Actor): void;\n  public add(actors: Actor[]): void;\n  public add(actorOrActors: any): void {\n    if (actorOrActors instanceof Actor) {\n      actorOrActors = [].concat(actorOrActors);\n    }\n\n    let groupIdx: number;\n    const len = actorOrActors.length;\n\n    for (let i = 0; i < len; i++) {\n      groupIdx = this.getMembers().indexOf(actorOrActors[i]);\n      if (groupIdx === -1) {\n        this._members.push(actorOrActors[i]);\n        this.scene.add(actorOrActors[i]);\n        this.actions.addActorToContext(actorOrActors[i]);\n        this.eventDispatcher.wire(actorOrActors[i].eventDispatcher);\n      }\n    }\n  }\n\n  public remove(actor: Actor): void {\n    const index = this._members.indexOf(actor);\n    if (index > -1) {\n      this._members.splice(index, 1);\n      this.actions.removeActorFromContext(actor);\n      this.eventDispatcher.unwire(actor.eventDispatcher);\n    }\n  }\n\n  public move(vector: Vector): void;\n  public move(dx: number, dy: number): void;\n  public move(args: Vector | number): void {\n    const members = this.getMembers();\n    const len = members.length;\n\n    if (arguments.length === 1 && args instanceof Vector) {\n      for (let i = 0; i < len; i++) {\n        members[i].pos.x += args.x;\n        members[i].pos.y += args.y;\n      }\n    } else if (typeof arguments[0] === 'number' && typeof arguments[1] === 'number') {\n      const x = arguments[0];\n      const y = arguments[1];\n\n      for (let i = 0; i < len; i++) {\n        members[i].pos.x += x;\n        members[i].pos.y += y;\n      }\n    } else {\n      this._logger.error('Invalid arguments passed to group move', this.name, 'args:', arguments);\n    }\n  }\n\n  public rotate(angle: number): void {\n    if (typeof angle !== 'number') {\n      this._logger.error('Invalid arguments passed to group rotate', this.name, 'args:', arguments);\n      return;\n    }\n\n    for (const member of this.getMembers()) {\n      member.rotation += angle;\n    }\n  }\n\n  public on(eventName: string, handler: (event: GameEvent<any>) => void) {\n    this.eventDispatcher.on(eventName, handler);\n  }\n\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void) {\n    this.eventDispatcher.off(eventName, handler);\n  }\n\n  public emit(topic: string, event: GameEvent<any>) {\n    this.eventDispatcher.emit(topic, event);\n  }\n\n  public contains(actor: Actor): boolean {\n    return this.getMembers().indexOf(actor) > -1;\n  }\n\n  public getMembers(): Actor[] {\n    return this._members;\n  }\n\n  public getRandomMember(): Actor {\n    return this._members[Math.floor(Math.random() * this._members.length)];\n  }\n\n  public getBounds(): BoundingBox {\n    return this.getMembers()\n      .map((a) => a.getBounds())\n      .reduce((prev: BoundingBox, curr: BoundingBox) => {\n        return prev.combine(curr);\n      });\n  }\n}\n","import { Engine } from './Engine';\nimport { Color } from './Drawing/Color';\nimport { SpriteFont } from './Drawing/SpriteSheet';\nimport { Actor } from './Actor';\nimport { Configurable } from './Configurable';\nimport { Vector } from './Algebra';\nimport { CollisionType } from './Collision/CollisionType';\n/**\n * Enum representing the different font size units\n * https://developer.mozilla.org/en-US/docs/Web/CSS/font-size\n */\nexport enum FontUnit {\n  /**\n   * Em is a scalable unit, 1 em is equal to the current font size of the current element, parent elements can effect em values\n   */\n  Em,\n  /**\n   * Rem is similar to the Em, it is a scalable unit. 1 rem is eqaul to the font size of the root element\n   */\n  Rem,\n  /**\n   * Pixel is a unit of length in screen pixels\n   */\n  Px,\n  /**\n   * Point is a physical unit length (1/72 of an inch)\n   */\n  Pt,\n  /**\n   * Percent is a scalable unit similar to Em, the only difference is the Em units scale faster when Text-Size stuff\n   */\n  Percent\n}\n\n/**\n * Enum representing the different horizontal text alignments\n */\nexport enum TextAlign {\n  /**\n   * The text is left-aligned.\n   */\n  Left,\n  /**\n   * The text is right-aligned.\n   */\n  Right,\n  /**\n   * The text is centered.\n   */\n  Center,\n  /**\n   * The text is aligned at the normal start of the line (left-aligned for left-to-right locales,\n   * right-aligned for right-to-left locales).\n   */\n  Start,\n  /**\n   * The text is aligned at the normal end of the line (right-aligned for left-to-right locales,\n   * left-aligned for right-to-left locales).\n   */\n  End\n}\n\n/**\n * Enum representing the different baseline text alignments\n */\nexport enum BaseAlign {\n  /**\n   * The text baseline is the top of the em square.\n   */\n  Top,\n  /**\n   * The text baseline is the hanging baseline.  Currently unsupported; this will act like\n   * alphabetic.\n   */\n  Hanging,\n  /**\n   * The text baseline is the middle of the em square.\n   */\n  Middle,\n  /**\n   * The text baseline is the normal alphabetic baseline.\n   */\n  Alphabetic,\n  /**\n   * The text baseline is the ideographic baseline; this is the bottom of\n   * the body of the characters, if the main body of characters protrudes\n   * beneath the alphabetic baseline.  Currently unsupported; this will\n   * act like alphabetic.\n   */\n  Ideographic,\n  /**\n   * The text baseline is the bottom of the bounding box.  This differs\n   * from the ideographic baseline in that the ideographic baseline\n   * doesn't consider descenders.\n   */\n  Bottom\n}\n\n/**\n * Enum representing the different possible font styles\n */\nexport enum FontStyle {\n  Normal,\n  Italic,\n  Oblique\n}\n\n/**\n * [[include:Constructors.md]]\n */\nexport interface LabelArgs extends Partial<LabelImpl> {\n  text?: string;\n  bold?: boolean;\n  pos?: Vector;\n  spriteFont?: SpriteFont;\n  fontFamily?: string;\n  fontSize?: number;\n  fontStyle?: FontStyle;\n  fontUnit?: FontUnit;\n  textAlign?: TextAlign;\n  maxWidth?: number;\n}\n\n/**\n * @hidden\n */\nexport class LabelImpl extends Actor {\n  /**\n   * The text to draw.\n   */\n  public text: string;\n\n  /**\n   * Sets or gets the bold property of the label's text, by default it's false\n   */\n  public bold: boolean = false;\n\n  /**\n   * The [[SpriteFont]] to use, if any. Overrides [[fontFamily]] if present.\n   */\n  public spriteFont: SpriteFont;\n\n  /**\n   * The CSS font family string (e.g. `sans-serif`, `Droid Sans Pro`). Web fonts\n   * are supported, same as in CSS.\n   */\n  public fontFamily: string;\n\n  /**\n   * The font size in the selected units, default is 10 (default units is pixel)\n   */\n  public fontSize: number = 10;\n\n  /**\n   * The font style for this label, the default is [[FontStyle.Normal]]\n   */\n  public fontStyle: FontStyle = FontStyle.Normal;\n\n  /**\n   * The css units for a font size such as px, pt, em (SpriteFont only support px), by default is 'px';\n   */\n  public fontUnit: FontUnit = FontUnit.Px;\n\n  /**\n   * Gets or sets the horizontal text alignment property for the label.\n   */\n  public textAlign: TextAlign = TextAlign.Left;\n\n  /**\n   * Gets or sets the baseline alignment property for the label.\n   */\n  public baseAlign: BaseAlign = BaseAlign.Bottom;\n\n  /**\n   * Gets or sets the maximum width (in pixels) that the label should occupy\n   */\n  public maxWidth: number;\n\n  /**\n   * Gets or sets the letter spacing on a Label. Only supported with Sprite Fonts.\n   */\n  public letterSpacing: number = 0; //px\n\n  /**\n   * Whether or not the [[SpriteFont]] will be case-sensitive when matching characters.\n   */\n  public caseInsensitive: boolean = true;\n\n  private _textShadowOn: boolean;\n  private _shadowOffsetX: number;\n  private _shadowOffsetY: number;\n\n  /**\n   * @param text        The text of the label\n   * @param x           The x position of the label\n   * @param y           The y position of the label\n   * @param fontFamily  Use any valid CSS font string for the label's font. Web fonts are supported. Default is `10px sans-serif`.\n   * @param spriteFont  Use an Excalibur sprite font for the label's font, if a SpriteFont is provided it will take precedence\n   * over a css font.\n   */\n  constructor(textOrConfig?: string | Partial<LabelImpl>, x?: number, y?: number, fontFamily?: string, spriteFont?: SpriteFont) {\n    super(\n      textOrConfig && typeof textOrConfig === 'object'\n        ? {\n            x: textOrConfig.x,\n            y: textOrConfig.y\n          }\n        : { x: x, y: y }\n    );\n\n    let text = '';\n    if (textOrConfig && typeof textOrConfig === 'object') {\n      fontFamily = textOrConfig.fontFamily;\n      spriteFont = textOrConfig.spriteFont;\n      text = textOrConfig.text;\n    } else {\n      text = <string>textOrConfig;\n    }\n\n    this.text = text || '';\n    this.color = Color.Black;\n    this.spriteFont = spriteFont;\n    this.body.collider.type = CollisionType.PreventCollision;\n    this.fontFamily = fontFamily || 'sans-serif'; // coalesce to default canvas font\n\n    this._textShadowOn = false;\n    this._shadowOffsetX = 0;\n    this._shadowOffsetY = 0;\n    if (spriteFont) {\n      //this._textSprites = spriteFont.getTextSprites();\n    }\n  }\n\n  /**\n   * Returns the width of the text in the label (in pixels);\n   * @param ctx  Rendering context to measure the string with\n   */\n  public getTextWidth(ctx: CanvasRenderingContext2D): number {\n    const oldFont = ctx.font;\n    ctx.font = this._fontString;\n    const width = ctx.measureText(this.text).width;\n    ctx.font = oldFont;\n    return width;\n  }\n\n  // TypeScript doesn't support string enums :(\n  private _lookupFontUnit(fontUnit: FontUnit): string {\n    switch (fontUnit) {\n      case FontUnit.Em:\n        return 'em';\n      case FontUnit.Rem:\n        return 'rem';\n      case FontUnit.Pt:\n        return 'pt';\n      case FontUnit.Px:\n        return 'px';\n      case FontUnit.Percent:\n        return '%';\n      default:\n        return 'px';\n    }\n  }\n\n  private _lookupTextAlign(textAlign: TextAlign): CanvasTextAlign {\n    switch (textAlign) {\n      case TextAlign.Left:\n        return 'left';\n      case TextAlign.Right:\n        return 'right';\n      case TextAlign.Center:\n        return 'center';\n      case TextAlign.End:\n        return 'end';\n      case TextAlign.Start:\n        return 'start';\n      default:\n        return 'start';\n    }\n  }\n\n  private _lookupBaseAlign(baseAlign: BaseAlign): CanvasTextBaseline {\n    switch (baseAlign) {\n      case BaseAlign.Alphabetic:\n        return 'alphabetic';\n      case BaseAlign.Bottom:\n        return 'bottom';\n      case BaseAlign.Hanging:\n        return 'hanging';\n      case BaseAlign.Ideographic:\n        return 'ideographic';\n      case BaseAlign.Middle:\n        return 'middle';\n      case BaseAlign.Top:\n        return 'top';\n      default:\n        return 'alphabetic';\n    }\n  }\n\n  private _lookupFontStyle(fontStyle: FontStyle): string {\n    const boldstring = this.bold ? ' bold' : '';\n    switch (fontStyle) {\n      case FontStyle.Italic:\n        return 'italic' + boldstring;\n      case FontStyle.Normal:\n        return 'normal' + boldstring;\n      case FontStyle.Oblique:\n        return 'oblique' + boldstring;\n      default:\n        return 'normal' + boldstring;\n    }\n  }\n\n  /**\n   * Sets the text shadow for sprite fonts\n   * @param offsetX      The x offset in pixels to place the shadow\n   * @param offsetY      The y offset in pixels to place the shadow\n   * @param shadowColor  The color of the text shadow\n   */\n  public setTextShadow(offsetX: number, offsetY: number, shadowColor: Color) {\n    this.spriteFont.setTextShadow(offsetX, offsetY, shadowColor);\n  }\n\n  /**\n   * Toggles text shadows on or off, only applies when using sprite fonts\n   */\n  public useTextShadow(on: boolean) {\n    this.spriteFont.useTextShadow(on);\n  }\n\n  /**\n   * Clears the current text shadow\n   */\n  public clearTextShadow() {\n    this._textShadowOn = false;\n    this._shadowOffsetX = 0;\n    this._shadowOffsetY = 0;\n  }\n\n  public update(engine: Engine, delta: number) {\n    super.update(engine, delta);\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\n    ctx.save();\n    ctx.translate(this.pos.x, this.pos.y);\n    ctx.scale(this.scale.x, this.scale.y);\n    ctx.rotate(this.rotation);\n\n    if (this._textShadowOn) {\n      ctx.save();\n      ctx.translate(this._shadowOffsetX, this._shadowOffsetY);\n      this._fontDraw(ctx);\n      ctx.restore();\n    }\n    this._fontDraw(ctx);\n\n    super.draw(ctx, delta);\n    ctx.restore();\n  }\n\n  private _fontDraw(ctx: CanvasRenderingContext2D) {\n    if (this.spriteFont) {\n      this.spriteFont.draw(ctx, this.text, 0, 0, {\n        color: this.color.clone(),\n        baseAlign: this.baseAlign,\n        textAlign: this.textAlign,\n        fontSize: this.fontSize,\n        letterSpacing: this.letterSpacing,\n        opacity: this.opacity\n      });\n    } else {\n      const oldAlign = ctx.textAlign;\n      const oldTextBaseline = ctx.textBaseline;\n\n      ctx.textAlign = this._lookupTextAlign(this.textAlign);\n      ctx.textBaseline = this._lookupBaseAlign(this.baseAlign);\n      if (this.color) {\n        this.color.a = this.opacity;\n      }\n      ctx.fillStyle = this.color.toString();\n      ctx.font = this._fontString;\n      if (this.maxWidth) {\n        ctx.fillText(this.text, 0, 0, this.maxWidth);\n      } else {\n        ctx.fillText(this.text, 0, 0);\n      }\n\n      ctx.textAlign = oldAlign;\n      ctx.textBaseline = oldTextBaseline;\n    }\n  }\n\n  protected get _fontString() {\n    return `${this._lookupFontStyle(this.fontStyle)} ${this.fontSize}${this._lookupFontUnit(this.fontUnit)} ${this.fontFamily}`;\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    super.debugDraw(ctx);\n  }\n}\n\n/**\n * Labels are the way to draw small amounts of text to the screen. They are\n * actors and inherit all of the benefits and capabilities.\n *\n * [[include:Labels.md]]\n */\nexport class Label extends Configurable(LabelImpl) {\n  constructor();\n  constructor(config?: LabelArgs);\n  constructor(text?: string, x?: number, y?: number, fontFamily?: string, spriteFont?: SpriteFont);\n  constructor(textOrConfig?: string | LabelArgs, x?: number, y?: number, fontFamily?: string, spriteFont?: SpriteFont) {\n    super(textOrConfig, x, y, fontFamily, spriteFont);\n  }\n}\n","import { Color } from './Drawing/Color';\nimport { Engine } from './Engine';\nimport { ActionQueue } from './Actions/Action';\nimport { EventDispatcher } from './EventDispatcher';\nimport { Actor, isActor } from './Actor';\nimport { Vector } from './Algebra';\nimport { ExitTriggerEvent, EnterTriggerEvent, CollisionEndEvent, CollisionStartEvent } from './Events';\nimport * as Util from './Util/Util';\nimport { CollisionType } from './Collision/CollisionType';\n\n/**\n * ITriggerOptions\n */\nexport interface TriggerOptions {\n  // position of the trigger\n  pos: Vector;\n  // width of the trigger\n  width: number;\n  // height of the trigger\n  height: number;\n  // whether the trigger is visible or not\n  visible: boolean;\n  // action to take when triggered\n  action: () => void;\n  // if specified the trigger will only fire on a specific actor and overrides any filter\n  target: Actor;\n  // Returns true if the triggers should fire on the collided actor\n  filter: (actor: Actor) => boolean;\n  // -1 if it should repeat forever\n  repeat: number;\n}\n\nconst triggerDefaults: Partial<TriggerOptions> = {\n  pos: Vector.Zero,\n  width: 10,\n  height: 10,\n  visible: false,\n  action: () => {\n    return;\n  },\n  filter: () => true,\n  repeat: -1\n};\n\n/**\n * Triggers are a method of firing arbitrary code on collision. These are useful\n * as 'buttons', 'switches', or to trigger effects in a game. By default triggers\n * are invisible, and can only be seen when [[Trigger.visible]] is set to `true`.\n *\n * [[include:Triggers.md]]\n */\nexport class Trigger extends Actor {\n  private _target: Actor;\n  /**\n   * Action to fire when triggered by collision\n   */\n  public action: () => void = () => {\n    return;\n  };\n  /**\n   * Filter to add additional granularity to action dispatch, if a filter is specified the action will only fire when\n   * filter return true for the collided actor.\n   */\n  public filter: (actor: Actor) => boolean = () => true;\n  /**\n   * Number of times to repeat before killing the trigger,\n   */\n  public repeat: number = -1;\n\n  /**\n   *\n   * @param opts Trigger options\n   */\n  constructor(opts: Partial<TriggerOptions>) {\n    super(opts.pos.x, opts.pos.y, opts.width, opts.height);\n    opts = Util.extend({}, triggerDefaults, opts);\n\n    this.filter = opts.filter || this.filter;\n    this.repeat = opts.repeat || this.repeat;\n    this.action = opts.action || this.action;\n    if (opts.target) {\n      this.target = opts.target;\n    }\n\n    this.visible = opts.visible;\n    this.body.collider.type = CollisionType.Passive;\n    this.eventDispatcher = new EventDispatcher(this);\n    this.actionQueue = new ActionQueue(this);\n\n    this.on('collisionstart', (evt: CollisionStartEvent<Actor>) => {\n      if (isActor(evt.other) && this.filter(evt.other)) {\n        this.emit('enter', new EnterTriggerEvent(this, evt.other));\n        this._dispatchAction();\n        // remove trigger if its done, -1 repeat forever\n        if (this.repeat === 0) {\n          this.kill();\n        }\n      }\n    });\n\n    this.on('collisionend', (evt: CollisionEndEvent<Actor>) => {\n      if (isActor(evt.other) && this.filter(evt.other)) {\n        this.emit('exit', new ExitTriggerEvent(this, evt.other));\n      }\n    });\n  }\n\n  public set target(target: Actor) {\n    this._target = target;\n    this.filter = (actor: Actor) => actor === target;\n  }\n\n  public get target() {\n    return this._target;\n  }\n\n  public _initialize(engine: Engine) {\n    super._initialize(engine);\n  }\n\n  private _dispatchAction() {\n    this.action.call(this);\n    this.repeat--;\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    super.debugDraw(ctx);\n    // Meant to draw debug information about actors\n    ctx.save();\n    ctx.translate(this.pos.x, this.pos.y);\n\n    const bb = this.body.collider.bounds;\n    const wp = this.getWorldPos();\n    bb.left = bb.left - wp.x;\n    bb.right = bb.right - wp.x;\n    bb.top = bb.top - wp.y;\n    bb.bottom = bb.bottom - wp.y;\n\n    // Currently collision primitives cannot rotate\n    // ctx.rotate(this.rotation);\n    ctx.fillStyle = Color.Violet.toString();\n    ctx.strokeStyle = Color.Violet.toString();\n    ctx.fillText('Trigger', 10, 10);\n    bb.debugDraw(ctx);\n\n    ctx.restore();\n  }\n}\n","import { Actor } from '../Actor';\nimport { UIActor } from '../UIActor';\nimport { Label } from '../Label';\nimport { Trigger } from '../Trigger';\n\nexport function isVanillaActor(actor: Actor) {\n  return !(actor instanceof UIActor) && !(actor instanceof Trigger) && !(actor instanceof Label);\n}\n\nexport function isUIActor(actor: Actor) {\n  return actor instanceof UIActor;\n}\n","import { Class } from './../Class';\nimport { GameEvent } from '../Events';\nimport * as Events from '../Events';\n\n/**\n * Enum representing input key codes\n */\nexport enum Keys {\n  Num1 = 97,\n  Num2 = 98,\n  Num3 = 99,\n  Num4 = 100,\n  Num5 = 101,\n  Num6 = 102,\n  Num7 = 103,\n  Num8 = 104,\n  Num9 = 105,\n  Num0 = 96,\n\n  Numlock = 144,\n\n  Semicolon = 186, // 59 in some browsers\n\n  A = 65,\n  B = 66,\n  C = 67,\n  D = 68,\n  E = 69,\n  F = 70,\n  G = 71,\n  H = 72,\n  I = 73,\n  J = 74,\n  K = 75,\n  L = 76,\n  M = 77,\n  N = 78,\n  O = 79,\n  P = 80,\n  Q = 81,\n  R = 82,\n  S = 83,\n  T = 84,\n  U = 85,\n  V = 86,\n  W = 87,\n  X = 88,\n  Y = 89,\n  Z = 90,\n\n  Shift = 16,\n  Alt = 18,\n  Up = 38,\n  Down = 40,\n  Left = 37,\n  Right = 39,\n  Space = 32,\n  Esc = 27\n}\n\n/**\n * Event thrown on a game object for a key event\n */\nexport class KeyEvent extends GameEvent<any> {\n  /**\n   * @param key  The key responsible for throwing the event\n   */\n  constructor(public key: Keys) {\n    super();\n  }\n}\n\n/**\n * Provides keyboard support for Excalibur.\n *\n * [[include:Keyboard.md]]\n */\nexport class Keyboard extends Class {\n  private _keys: number[] = [];\n  private _keysUp: number[] = [];\n  private _keysDown: number[] = [];\n\n  constructor() {\n    super();\n  }\n\n  public on(eventName: Events.press, handler: (event: KeyEvent) => void): void;\n  public on(eventName: Events.release, handler: (event: KeyEvent) => void): void;\n  public on(eventName: Events.hold, handler: (event: KeyEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  /**\n   * Initialize Keyboard event listeners\n   */\n  init(global?: GlobalEventHandlers): void {\n    global = global || window;\n    global.addEventListener('blur', () => {\n      this._keys.length = 0; // empties array efficiently\n    });\n\n    // key up is on window because canvas cannot have focus\n    global.addEventListener('keyup', (ev: KeyboardEvent) => {\n      const code = this._normalizeKeyCode(ev.keyCode);\n      const key = this._keys.indexOf(code);\n      this._keys.splice(key, 1);\n      this._keysUp.push(code);\n      const keyEvent = new KeyEvent(code);\n\n      // alias the old api, we may want to deprecate this in the future\n      this.eventDispatcher.emit('up', keyEvent);\n      this.eventDispatcher.emit('release', keyEvent);\n    });\n\n    // key down is on window because canvas cannot have focus\n    global.addEventListener('keydown', (ev: KeyboardEvent) => {\n      const code = this._normalizeKeyCode(ev.keyCode);\n      if (this._keys.indexOf(code) === -1) {\n        this._keys.push(code);\n        this._keysDown.push(code);\n        const keyEvent = new KeyEvent(code);\n        this.eventDispatcher.emit('down', keyEvent);\n        this.eventDispatcher.emit('press', keyEvent);\n      }\n    });\n  }\n\n  public update() {\n    // Reset keysDown and keysUp after update is complete\n    this._keysDown.length = 0;\n    this._keysUp.length = 0;\n\n    // Emit synthetic \"hold\" event\n    for (let i = 0; i < this._keys.length; i++) {\n      this.eventDispatcher.emit('hold', new KeyEvent(this._keys[i]));\n    }\n  }\n\n  /**\n   * Gets list of keys being pressed down\n   */\n  public getKeys(): Keys[] {\n    return this._keys;\n  }\n\n  /**\n   * Tests if a certain key was just pressed this frame. This is cleared at the end of the update frame.\n   * @param key Test whether a key was just pressed\n   */\n  public wasPressed(key: Keys): boolean {\n    return this._keysDown.indexOf(key) > -1;\n  }\n\n  /**\n   * Tests if a certain key is held down. This is persisted between frames.\n   * @param key  Test whether a key is held down\n   */\n  public isHeld(key: Keys): boolean {\n    return this._keys.indexOf(key) > -1;\n  }\n\n  /**\n   * Tests if a certain key was just released this frame. This is cleared at the end of the update frame.\n   * @param key  Test whether a key was just released\n   */\n  public wasReleased(key: Keys): boolean {\n    return this._keysUp.indexOf(key) > -1;\n  }\n\n  /**\n   * Normalizes some browser event key codes to map to standard Excalibur key codes\n   * @param code Event keyCode\n   * @see http://unixpapa.com/js/key.html\n   */\n  private _normalizeKeyCode(code: number) {\n    switch (code) {\n      case 59: // : ; in Firefox, Opera\n        return Keys.Semicolon;\n      default:\n        return code;\n    }\n  }\n}\n","import { UIActor } from './UIActor';\nimport { Physics } from './Physics';\nimport {\n  InitializeEvent,\n  ActivateEvent,\n  DeactivateEvent,\n  PreUpdateEvent,\n  PostUpdateEvent,\n  PreDrawEvent,\n  PostDrawEvent,\n  PreDebugDrawEvent,\n  PostDebugDrawEvent,\n  GameEvent\n} from './Events';\nimport { Logger } from './Util/Log';\nimport { Timer } from './Timer';\nimport { DynamicTreeCollisionBroadphase } from './Collision/DynamicTreeCollisionBroadphase';\nimport { CollisionBroadphase } from './Collision/CollisionResolver';\nimport { SortedList } from './Util/SortedList';\nimport { Engine } from './Engine';\nimport { Group } from './Group';\nimport { TileMap } from './TileMap';\nimport { Camera } from './Camera';\nimport { Actor } from './Actor';\nimport { Class } from './Class';\nimport { CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw } from './Interfaces/LifecycleEvents';\nimport * as Util from './Util/Util';\nimport * as Events from './Events';\nimport * as ActorUtils from './Util/Actors';\nimport { Trigger } from './Trigger';\nimport { obsolete } from './Util/Decorators';\nimport { Body } from './Collision/Body';\n/**\n * [[Actor|Actors]] are composed together into groupings called Scenes in\n * Excalibur. The metaphor models the same idea behind real world\n * actors in a scene. Only actors in scenes will be updated and drawn.\n *\n * Typical usages of a scene include: levels, menus, loading screens, etc.\n *\n * [[include:Scenes.md]]\n */\nexport class Scene extends Class implements CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw {\n  /**\n   * Gets or sets the current camera for the scene\n   */\n  public camera: Camera;\n\n  /**\n   * The actors in the current scene\n   */\n  public actors: Actor[] = [];\n\n  /**\n   * Physics bodies in the current scene\n   */\n  private _bodies: Body[] = [];\n\n  /**\n   * The triggers in the current scene\n   */\n  public triggers: Trigger[] = [];\n\n  /**\n   * The [[TileMap]]s in the scene, if any\n   */\n  public tileMaps: TileMap[] = [];\n\n  /**\n   * The [[Group]]s in the scene, if any\n   */\n  @obsolete({ message: 'ex.Group will be deprecated in v0.24.0' })\n  public get groups() {\n    return this._groups;\n  }\n  public set groups(groups: { [key: string]: Group }) {\n    this._groups = groups;\n  }\n  private _groups: { [key: string]: Group } = {};\n\n  /**\n   * Access to the Excalibur engine\n   */\n  private _engine: Engine;\n\n  /**\n   * The [[UIActor]]s in a scene, if any; these are drawn last\n   */\n  public uiActors: Actor[] = [];\n\n  private _isInitialized: boolean = false;\n\n  private _sortedDrawingTree: SortedList<Actor> = new SortedList<Actor>(Actor.prototype.getZIndex);\n\n  private _broadphase: CollisionBroadphase = new DynamicTreeCollisionBroadphase();\n\n  private _killQueue: Actor[] = [];\n  private _triggerKillQueue: Trigger[] = [];\n  private _timers: Timer[] = [];\n  private _cancelQueue: Timer[] = [];\n  private _logger: Logger = Logger.getInstance();\n\n  constructor(_engine: Engine) {\n    super();\n    this.camera = new Camera();\n    this._engine = _engine;\n    if (_engine) {\n      this.camera.x = _engine.halfDrawWidth;\n      this.camera.y = _engine.halfDrawHeight;\n    }\n  }\n\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent) => void): void;\n  public on(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\n  public on(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent) => void): void;\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent) => void): void;\n  public once(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\n  public once(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent) => void): void;\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent) => void): void;\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public off(eventName: Events.initialize, handler?: (event: InitializeEvent) => void): void;\n  public off(eventName: Events.activate, handler?: (event: ActivateEvent) => void): void;\n  public off(eventName: Events.deactivate, handler?: (event: DeactivateEvent) => void): void;\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent) => void): void;\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent) => void): void;\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\n  public off(eventName: Events.predebugdraw, handler?: (event: PreDebugDrawEvent) => void): void;\n  public off(eventName: Events.postdebugdraw, handler?: (event: PostDebugDrawEvent) => void): void;\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\n  public off(eventName: string, handler?: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  /**\n   * This is called before the first update of the [[Scene]]. Initializes scene members like the camera. This method is meant to be\n   * overridden. This is where initialization of child actors should take place.\n   */\n  public onInitialize(_engine: Engine): void {\n    // will be overridden\n  }\n\n  /**\n   * This is called when the scene is made active and started. It is meant to be overriden,\n   * this is where you should setup any DOM UI or event handlers needed for the scene.\n   */\n  public onActivate(_oldScene: Scene, _newScene: Scene): void {\n    // will be overridden\n  }\n\n  /**\n   * This is called when the scene is made transitioned away from and stopped. It is meant to be overriden,\n   * this is where you should cleanup any DOM UI or event handlers needed for the scene.\n   */\n  public onDeactivate(_oldScene: Scene, _newScene: Scene): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before a scene is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after a scene is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreDraw` is called directly before a scene is drawn.\n   */\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostDraw` is called directly after a scene is drawn.\n   */\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Initializes actors in the scene\n   */\n  private _initializeChildren(): void {\n    for (const child of this.actors) {\n      child._initialize(this._engine);\n    }\n  }\n\n  /**\n   * Gets whether or not the [[Scene]] has been initialized\n   */\n  public get isInitialized(): boolean {\n    return this._isInitialized;\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\n   *\n   * Initializes the scene before the first update, meant to be called by engine not by users of\n   * Excalibur\n   * @internal\n   */\n  public _initialize(engine: Engine) {\n    if (!this.isInitialized) {\n      this._engine = engine;\n      if (this.camera) {\n        this.camera.x = engine.halfDrawWidth;\n        this.camera.y = engine.halfDrawHeight;\n      }\n\n      this._initializeChildren();\n\n      this._logger.debug('Scene.onInitialize', this, engine);\n\n      this.eventDispatcher.emit('initialize', new InitializeEvent(engine, this));\n      this.onInitialize.call(this, engine);\n      this._isInitialized = true;\n    }\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\n   *\n   * Activates the scene with the base behavior, then calls the overridable `onActivate` implementation.\n   * @internal\n   */\n  public _activate(oldScene: Scene, newScene: Scene): void {\n    this._logger.debug('Scene.onActivate', this);\n    this.onActivate(oldScene, newScene);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\n   *\n   * Deactivates the scene with the base behavior, then calls the overridable `onDeactivate` implementation.\n   * @internal\n   */\n  public _deactivate(oldScene: Scene, newScene: Scene): void {\n    this._logger.debug('Scene.onDectivate', this);\n    this.onDeactivate(oldScene, newScene);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(_engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(_engine, delta, this));\n    this.onPreUpdate(_engine, delta);\n  }\n\n  /**\n   *  It is not recommended that internal excalibur methods be overriden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(_engine: Engine, delta: number): void {\n    this.emit('postupdate', new PostUpdateEvent(_engine, delta, this));\n    this.onPostUpdate(_engine, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\n   *\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\n   *\n   * @internal\n   */\n  public _predraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    this.emit('predraw', new PreDrawEvent(_ctx, _delta, this));\n    this.onPreDraw(_ctx, _delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\n   *\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\n   *\n   * @internal\n   */\n  public _postdraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    this.emit('postdraw', new PostDrawEvent(_ctx, _delta, this));\n    this.onPostDraw(_ctx, _delta);\n  }\n\n  /**\n   * Updates all the actors and timers in the scene. Called by the [[Engine]].\n   * @param engine  Reference to the current Engine\n   * @param delta   The number of milliseconds since the last update\n   */\n  public update(engine: Engine, delta: number) {\n    this._preupdate(engine, delta);\n    if (this.camera) {\n      this.camera.update(engine, delta);\n    }\n\n    let i: number, len: number;\n    // Remove timers in the cancel queue before updating them\n    for (i = 0, len = this._cancelQueue.length; i < len; i++) {\n      this.removeTimer(this._cancelQueue[i]);\n    }\n    this._cancelQueue.length = 0;\n\n    // Cycle through timers updating timers\n    for (const timer of this._timers) {\n      timer.update(delta);\n    }\n\n    // Cycle through actors updating UI actors\n    for (i = 0, len = this.uiActors.length; i < len; i++) {\n      this.uiActors[i].update(engine, delta);\n    }\n\n    // Cycle through actors updating tile maps\n    for (i = 0, len = this.tileMaps.length; i < len; i++) {\n      this.tileMaps[i].update(engine, delta);\n    }\n\n    // Cycle through actors updating actors\n    for (i = 0, len = this.actors.length; i < len; i++) {\n      this.actors[i].update(engine, delta);\n      this._bodies[i] = this.actors[i].body;\n    }\n\n    // Cycle through triggers updating\n    for (i = 0, len = this.triggers.length; i < len; i++) {\n      this.triggers[i].update(engine, delta);\n    }\n\n    this._collectActorStats(engine);\n\n    // propagates all events through their paths assigned\n    engine.input.pointers.propagate();\n\n    // Run the broadphase and narrowphase\n    if (this._broadphase && Physics.enabled) {\n      const beforeBroadphase = Date.now();\n      this._broadphase.update(this._bodies, delta);\n      let pairs = this._broadphase.broadphase(this._bodies, delta, engine.stats.currFrame);\n      const afterBroadphase = Date.now();\n\n      const beforeNarrowphase = Date.now();\n      let iter: number = Physics.collisionPasses;\n      const collisionDelta = delta / iter;\n      while (iter > 0) {\n        // Run the narrowphase\n        pairs = this._broadphase.narrowphase(pairs, engine.stats.currFrame);\n        // Run collision resolution strategy\n        pairs = this._broadphase.resolve(pairs, collisionDelta, Physics.collisionResolutionStrategy);\n\n        this._broadphase.runCollisionStartEnd(pairs);\n\n        iter--;\n      }\n\n      const afterNarrowphase = Date.now();\n      engine.stats.currFrame.physics.broadphase = afterBroadphase - beforeBroadphase;\n      engine.stats.currFrame.physics.narrowphase = afterNarrowphase - beforeNarrowphase;\n    }\n\n    engine.stats.currFrame.actors.killed = this._killQueue.length + this._triggerKillQueue.length;\n\n    this._processKillQueue(this._killQueue, this.actors);\n    this._processKillQueue(this._triggerKillQueue, this.triggers);\n\n    this._postupdate(engine, delta);\n  }\n\n  private _processKillQueue(killQueue: Actor[], collection: Actor[]) {\n    // Remove actors from scene graph after being killed\n    let actorIndex: number;\n    for (const killed of killQueue) {\n      //don't remove actors that were readded during the same frame they were killed\n      if (killed.isKilled()) {\n        actorIndex = collection.indexOf(killed);\n        if (actorIndex > -1) {\n          this._sortedDrawingTree.removeByComparable(killed);\n          collection.splice(actorIndex, 1);\n        }\n      }\n    }\n    killQueue.length = 0;\n  }\n\n  /**\n   * Draws all the actors in the Scene. Called by the [[Engine]].\n   * @param ctx    The current rendering context\n   * @param delta  The number of milliseconds since the last draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\n    this._predraw(ctx, delta);\n    ctx.save();\n\n    if (this.camera) {\n      this.camera.draw(ctx);\n    }\n\n    let i: number, len: number;\n\n    for (i = 0, len = this.tileMaps.length; i < len; i++) {\n      this.tileMaps[i].draw(ctx, delta);\n    }\n\n    const sortedChildren = this._sortedDrawingTree.list();\n    for (i = 0, len = sortedChildren.length; i < len; i++) {\n      // only draw actors that are visible and on screen\n      if (sortedChildren[i].visible && !sortedChildren[i].isOffScreen) {\n        sortedChildren[i].draw(ctx, delta);\n      }\n    }\n\n    if (this._engine && this._engine.isDebug) {\n      ctx.strokeStyle = 'yellow';\n      this.debugDraw(ctx);\n    }\n\n    ctx.restore();\n\n    for (i = 0, len = this.uiActors.length; i < len; i++) {\n      // only draw ui actors that are visible and on screen\n      if (this.uiActors[i].visible) {\n        this.uiActors[i].draw(ctx, delta);\n      }\n    }\n\n    if (this._engine && this._engine.isDebug) {\n      for (i = 0, len = this.uiActors.length; i < len; i++) {\n        this.uiActors[i].debugDraw(ctx);\n      }\n    }\n    this._postdraw(ctx, delta);\n  }\n\n  /**\n   * Draws all the actors' debug information in the Scene. Called by the [[Engine]].\n   * @param ctx  The current rendering context\n   */\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    this.emit('predebugdraw', new PreDebugDrawEvent(ctx, this));\n\n    let i: number, len: number;\n\n    for (i = 0, len = this.tileMaps.length; i < len; i++) {\n      this.tileMaps[i].debugDraw(ctx);\n    }\n\n    for (i = 0, len = this.actors.length; i < len; i++) {\n      this.actors[i].debugDraw(ctx);\n    }\n\n    for (i = 0, len = this.triggers.length; i < len; i++) {\n      this.triggers[i].debugDraw(ctx);\n    }\n\n    this._broadphase.debugDraw(ctx, 20);\n\n    this.camera.debugDraw(ctx);\n    this.emit('postdebugdraw', new PostDebugDrawEvent(ctx, this));\n  }\n\n  /**\n   * Checks whether an actor is contained in this scene or not\n   */\n  public contains(actor: Actor): boolean {\n    return this.actors.indexOf(actor) > -1;\n  }\n\n  /**\n   * Adds a [[Timer]] to the current [[Scene]].\n   * @param timer  The timer to add to the current [[Scene]].\n   */\n  public add(timer: Timer): void;\n\n  /**\n   * Adds a [[TileMap]] to the [[Scene]], once this is done the [[TileMap]] will be drawn and updated.\n   */\n  public add(tileMap: TileMap): void;\n\n  /**\n   * Adds a [[Trigger]] to the [[Scene]], once this is done the [[Trigger]] will listen for interactions with other actors.\n   * @param trigger\n   */\n  public add(trigger: Trigger): void;\n\n  /**\n   * Adds an actor to the scene, once this is done the [[Actor]] will be drawn and updated.\n   * @param actor  The actor to add to the current scene\n   */\n  public add(actor: Actor): void;\n\n  /**\n   * Adds a [[UIActor]] to the scene.\n   * @param uiActor  The UIActor to add to the current scene\n   */\n  public add(uiActor: UIActor): void;\n  public add(entity: any): void {\n    if (entity instanceof Actor) {\n      (<Actor>entity).unkill();\n    }\n    if (entity instanceof UIActor) {\n      if (!Util.contains(this.uiActors, entity)) {\n        this.addUIActor(entity);\n      }\n      return;\n    }\n\n    if (entity instanceof Actor) {\n      if (!Util.contains(this.actors, entity)) {\n        this._addChild(entity);\n      }\n      return;\n    }\n    if (entity instanceof Timer) {\n      if (!Util.contains(this._timers, entity)) {\n        this.addTimer(entity);\n      }\n      return;\n    }\n    if (entity instanceof TileMap) {\n      if (!Util.contains(this.tileMaps, entity)) {\n        this.addTileMap(entity);\n      }\n    }\n  }\n\n  /**\n   * Removes a [[Timer]] from the current scene, it will no longer be updated.\n   * @param timer  The timer to remove to the current scene.\n   */\n  public remove(timer: Timer): void;\n\n  /**\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\n   * @param tileMap {TileMap}\n   */\n  public remove(tileMap: TileMap): void;\n\n  /**\n   * Removes an actor from the scene, it will no longer be drawn or updated.\n   * @param actor  The actor to remove from the current scene.\n   */\n  public remove(actor: Actor): void;\n\n  /**\n   * Removes a [[UIActor]] to the scene, it will no longer be drawn or updated\n   * @param uiActor  The UIActor to remove from the current scene\n   */\n  public remove(uiActor: UIActor): void;\n  public remove(entity: any): void {\n    if (entity instanceof UIActor) {\n      this.removeUIActor(entity);\n      return;\n    }\n\n    if (entity instanceof Actor) {\n      this._removeChild(entity);\n    }\n    if (entity instanceof Timer) {\n      this.removeTimer(entity);\n    }\n\n    if (entity instanceof TileMap) {\n      this.removeTileMap(entity);\n    }\n  }\n\n  /**\n   * Adds (any) actor to act as a piece of UI, meaning it is always positioned\n   * in screen coordinates. UI actors do not participate in collisions.\n   * @todo Should this be `UIActor` only?\n   */\n  public addUIActor(actor: Actor) {\n    this.uiActors.push(actor);\n    actor.scene = this;\n  }\n\n  /**\n   * Removes an actor as a piece of UI\n   */\n  public removeUIActor(actor: Actor) {\n    const index = this.uiActors.indexOf(actor);\n    if (index > -1) {\n      this.uiActors.splice(index, 1);\n    }\n  }\n\n  /**\n   * Adds an actor to the scene, once this is done the actor will be drawn and updated.\n   */\n  protected _addChild(actor: Actor) {\n    this._broadphase.track(actor.body);\n    actor.scene = this;\n    if (actor instanceof Trigger) {\n      this.triggers.push(actor);\n    } else {\n      this.actors.push(actor);\n    }\n\n    this._sortedDrawingTree.add(actor);\n  }\n\n  /**\n   * Adds a [[TileMap]] to the scene, once this is done the TileMap will be drawn and updated.\n   */\n  public addTileMap(tileMap: TileMap) {\n    this.tileMaps.push(tileMap);\n  }\n\n  /**\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\n   */\n  public removeTileMap(tileMap: TileMap) {\n    const index = this.tileMaps.indexOf(tileMap);\n    if (index > -1) {\n      this.tileMaps.splice(index, 1);\n    }\n  }\n\n  /**\n   * Removes an actor from the scene, it will no longer be drawn or updated.\n   */\n  protected _removeChild(actor: Actor) {\n    if (!Util.contains(this.actors, actor)) {\n      return;\n    }\n    this._broadphase.untrack(actor.body);\n    if (actor instanceof Trigger) {\n      this._triggerKillQueue.push(actor);\n    } else {\n      if (!actor.isKilled()) {\n        actor.kill();\n      }\n      this._killQueue.push(actor);\n    }\n\n    actor.parent = null;\n  }\n\n  /**\n   * Adds a [[Timer]] to the scene\n   * @param timer  The timer to add\n   */\n  public addTimer(timer: Timer): Timer {\n    this._timers.push(timer);\n    timer.scene = this;\n    return timer;\n  }\n\n  /**\n   * Removes a [[Timer]] from the scene.\n   * @warning Can be dangerous, use [[cancelTimer]] instead\n   * @param timer  The timer to remove\n   */\n  public removeTimer(timer: Timer): Timer {\n    const i = this._timers.indexOf(timer);\n    if (i !== -1) {\n      this._timers.splice(i, 1);\n    }\n    return timer;\n  }\n\n  /**\n   * Cancels a [[Timer]], removing it from the scene nicely\n   * @param timer  The timer to cancel\n   */\n  public cancelTimer(timer: Timer): Timer {\n    this._cancelQueue.push(timer);\n    return timer;\n  }\n\n  /**\n   * Tests whether a [[Timer]] is active in the scene\n   */\n  public isTimerActive(timer: Timer): boolean {\n    return this._timers.indexOf(timer) > -1 && !timer.complete;\n  }\n\n  /**\n   * Creates and adds a [[Group]] to the scene with a name\n   */\n  @obsolete({ message: 'ex.Group will be deprecated in v0.24.0' })\n  public createGroup(name: string): Group {\n    return new Group(name, this);\n  }\n\n  /**\n   * Returns a [[Group]] by name\n   */\n  @obsolete({ message: 'ex.Group will be deprecated in v0.24.0' })\n  public getGroup(name: string): Group {\n    return this.groups[name];\n  }\n\n  /**\n   * Removes a [[Group]] by name\n   */\n  public removeGroup(name: string): void;\n\n  /**\n   * Removes a [[Group]] by reference\n   */\n  public removeGroup(group: Group): void;\n  @obsolete({ message: 'ex.Group will be deprecated in v0.24.0' })\n  public removeGroup(group: any): void {\n    if (typeof group === 'string') {\n      delete this.groups[group];\n    } else if (group instanceof Group) {\n      delete this.groups[group.name];\n    } else {\n      this._logger.error('Invalid arguments to removeGroup', group);\n    }\n  }\n\n  /**\n   * Removes the given actor from the sorted drawing tree\n   */\n  public cleanupDrawTree(actor: Actor) {\n    this._sortedDrawingTree.removeByComparable(actor);\n  }\n\n  /**\n   * Updates the given actor's position in the sorted drawing tree\n   */\n  public updateDrawTree(actor: Actor) {\n    this._sortedDrawingTree.add(actor);\n  }\n\n  /**\n   * Checks if an actor is in this scene's sorted draw tree\n   */\n  public isActorInDrawTree(actor: Actor): boolean {\n    return this._sortedDrawingTree.find(actor);\n  }\n\n  public isCurrentScene(): boolean {\n    if (this._engine) {\n      return this._engine.currentScene === this;\n    }\n    return false;\n  }\n\n  private _collectActorStats(engine: Engine) {\n    for (const _ui of this.uiActors) {\n      engine.stats.currFrame.actors.ui++;\n    }\n\n    for (const actor of this.actors) {\n      engine.stats.currFrame.actors.alive++;\n      for (const child of actor.children) {\n        if (ActorUtils.isUIActor(child)) {\n          engine.stats.currFrame.actors.ui++;\n        } else {\n          engine.stats.currFrame.actors.alive++;\n        }\n      }\n    }\n  }\n}\n","import { DebugFlags } from './DebugFlags';\nimport { Pair } from './Collision/Pair';\n\n/**\n * Debug stats containing current and previous frame statistics\n */\nexport interface DebugStats {\n  currFrame: FrameStats;\n  prevFrame: FrameStats;\n}\n\n/**\n * Hash containing the [[Pair.id]]s of pairs that collided in a frame\n */\nexport interface CollidersHash {\n  [pairId: string]: Pair;\n}\n\n/**\n * Represents a frame's individual statistics\n */\nexport interface FrameStatistics {\n  /**\n   * The number of the frame\n   */\n  id: number;\n\n  /**\n   * Gets the frame's delta (time since last frame scaled by [[Engine.timescale]]) (in ms)\n   */\n  delta: number;\n\n  /**\n   * Gets the frame's frames-per-second (FPS)\n   */\n  fps: number;\n\n  /**\n   * Duration statistics (in ms)\n   */\n  duration: FrameDurationStats;\n\n  /**\n   * Actor statistics\n   */\n  actors: FrameActorStats;\n\n  /**\n   * Physics statistics\n   */\n  physics: PhysicsStatistics;\n}\n\n/**\n * Represents actor stats for a frame\n */\nexport interface FrameActorStats {\n  /**\n   * Gets the frame's number of actors (alive)\n   */\n  alive: number;\n\n  /**\n   * Gets the frame's number of actors (killed)\n   */\n  killed: number;\n\n  /**\n   * Gets the frame's number of remaining actors (alive - killed)\n   */\n  remaining: number;\n\n  /**\n   * Gets the frame's number of UI actors\n   */\n  ui: number;\n\n  /**\n   * Gets the frame's number of total actors (remaining + UI)\n   */\n  total: number;\n}\n\n/**\n * Represents duration stats for a frame\n */\nexport interface FrameDurationStats {\n  /**\n   * Gets the frame's total time to run the update function (in ms)\n   */\n  update: number;\n\n  /**\n   * Gets the frame's total time to run the draw function (in ms)\n   */\n  draw: number;\n\n  /**\n   * Gets the frame's total render duration (update + draw duration) (in ms)\n   */\n  total: number;\n}\n\n/**\n * Represents physics stats for the current frame\n */\nexport interface PhysicsStatistics {\n  /**\n   * Gets the number of broadphase collision pairs which\n   */\n  pairs: number;\n\n  /**\n   * Gets the number of actual collisons\n   */\n  collisions: number;\n\n  /**\n   * A Hash storing the [[Pair.id]]s of [[Pair]]s that collided in the frame\n   */\n  collidersHash: CollidersHash;\n\n  /**\n   * Gets the number of fast moving bodies using raycast continuous collisions in the scene\n   */\n  fastBodies: number;\n\n  /**\n   * Gets the number of bodies that had a fast body collision resolution\n   */\n  fastBodyCollisions: number;\n\n  /**\n   * Gets the time it took to calculate the broadphase pairs\n   */\n  broadphase: number;\n\n  /**\n   * Gets the time it took to calculate the narrowphase\n   */\n  narrowphase: number;\n}\n\n/**\n * Debug statistics and flags for Excalibur. If polling these values, it would be\n * best to do so on the `postupdate` event for [[Engine]], after all values have been\n * updated during a frame.\n */\nexport class Debug implements DebugFlags {\n  /**\n   * Performance statistics\n   */\n  public stats: DebugStats = {\n    /**\n     * Current frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\n     * Best accessed on [[postframe]] event. See [[IFrameStats]]\n     */\n    currFrame: new FrameStats(),\n\n    /**\n     * Previous frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\n     * Best accessed on [[preframe]] event. Best inspected on engine event `preframe`. See [[IFrameStats]]\n     */\n    prevFrame: new FrameStats()\n  };\n}\n\n/**\n * Implementation of a frame's stats. Meant to have values copied via [[FrameStats.reset]], avoid\n * creating instances of this every frame.\n */\nexport class FrameStats implements FrameStatistics {\n  private _id: number = 0;\n  private _delta: number = 0;\n  private _fps: number = 0;\n  private _actorStats: FrameActorStats = {\n    alive: 0,\n    killed: 0,\n    ui: 0,\n    get remaining(this: FrameActorStats) {\n      return this.alive - this.killed;\n    },\n    get total(this: FrameActorStats) {\n      return this.remaining + this.ui;\n    }\n  };\n  private _durationStats: FrameDurationStats = {\n    update: 0,\n    draw: 0,\n    get total(this: FrameDurationStats) {\n      return this.update + this.draw;\n    }\n  };\n\n  private _physicsStats: PhysicsStats = new PhysicsStats();\n\n  /**\n   * Zero out values or clone other IFrameStat stats. Allows instance reuse.\n   *\n   * @param [otherStats] Optional stats to clone\n   */\n  public reset(otherStats?: FrameStatistics) {\n    if (otherStats) {\n      this.id = otherStats.id;\n      this.delta = otherStats.delta;\n      this.fps = otherStats.fps;\n      this.actors.alive = otherStats.actors.alive;\n      this.actors.killed = otherStats.actors.killed;\n      this.actors.ui = otherStats.actors.ui;\n      this.duration.update = otherStats.duration.update;\n      this.duration.draw = otherStats.duration.draw;\n      this._physicsStats.reset(otherStats.physics);\n    } else {\n      this.id = this.delta = this.fps = 0;\n      this.actors.alive = this.actors.killed = this.actors.ui = 0;\n      this.duration.update = this.duration.draw = 0;\n      this._physicsStats.reset();\n    }\n  }\n\n  /**\n   * Provides a clone of this instance.\n   */\n  public clone(): FrameStats {\n    const fs = new FrameStats();\n\n    fs.reset(this);\n\n    return fs;\n  }\n\n  /**\n   * Gets the frame's id\n   */\n  public get id() {\n    return this._id;\n  }\n\n  /**\n   * Sets the frame's id\n   */\n  public set id(value: number) {\n    this._id = value;\n  }\n\n  /**\n   * Gets the frame's delta (time since last frame)\n   */\n  public get delta() {\n    return this._delta;\n  }\n\n  /**\n   * Sets the frame's delta (time since last frame). Internal use only.\n   * @internal\n   */\n  public set delta(value: number) {\n    this._delta = value;\n  }\n\n  /**\n   * Gets the frame's frames-per-second (FPS)\n   */\n  public get fps() {\n    return this._fps;\n  }\n\n  /**\n   * Sets the frame's frames-per-second (FPS). Internal use only.\n   * @internal\n   */\n  public set fps(value: number) {\n    this._fps = value;\n  }\n\n  /**\n   * Gets the frame's actor statistics\n   */\n  public get actors() {\n    return this._actorStats;\n  }\n\n  /**\n   * Gets the frame's duration statistics\n   */\n  public get duration() {\n    return this._durationStats;\n  }\n\n  /**\n   * Gets the frame's physics statistics\n   */\n  public get physics() {\n    return this._physicsStats;\n  }\n}\n\nexport class PhysicsStats implements PhysicsStatistics {\n  private _pairs: number = 0;\n  private _collisions: number = 0;\n  private _collidersHash: CollidersHash = {};\n  private _fastBodies: number = 0;\n  private _fastBodyCollisions: number = 0;\n  private _broadphase: number = 0;\n  private _narrowphase: number = 0;\n\n  /**\n   * Zero out values or clone other IPhysicsStats stats. Allows instance reuse.\n   *\n   * @param [otherStats] Optional stats to clone\n   */\n  public reset(otherStats?: PhysicsStatistics) {\n    if (otherStats) {\n      this.pairs = otherStats.pairs;\n      this.collisions = otherStats.collisions;\n      this.collidersHash = otherStats.collidersHash;\n      this.fastBodies = otherStats.fastBodies;\n      this.fastBodyCollisions = otherStats.fastBodyCollisions;\n      this.broadphase = otherStats.broadphase;\n      this.narrowphase = otherStats.narrowphase;\n    } else {\n      this.pairs = this.collisions = this.fastBodies = 0;\n      this.fastBodyCollisions = this.broadphase = this.narrowphase = 0;\n      this.collidersHash = {};\n    }\n  }\n\n  /**\n   * Provides a clone of this instance.\n   */\n  public clone(): PhysicsStatistics {\n    const ps = new PhysicsStats();\n\n    ps.reset(this);\n\n    return ps;\n  }\n\n  public get pairs(): number {\n    return this._pairs;\n  }\n\n  public set pairs(value: number) {\n    this._pairs = value;\n  }\n\n  public get collisions(): number {\n    return this._collisions;\n  }\n\n  public set collisions(value: number) {\n    this._collisions = value;\n  }\n\n  public get collidersHash(): CollidersHash {\n    return this._collidersHash;\n  }\n\n  public set collidersHash(colliders: CollidersHash) {\n    this._collidersHash = colliders;\n  }\n\n  public get fastBodies(): number {\n    return this._fastBodies;\n  }\n\n  public set fastBodies(value: number) {\n    this._fastBodies = value;\n  }\n\n  public get fastBodyCollisions(): number {\n    return this._fastBodyCollisions;\n  }\n\n  public set fastBodyCollisions(value: number) {\n    this._fastBodyCollisions = value;\n  }\n\n  public get broadphase(): number {\n    return this._broadphase;\n  }\n\n  public set broadphase(value: number) {\n    this._broadphase = value;\n  }\n\n  public get narrowphase(): number {\n    return this._narrowphase;\n  }\n\n  public set narrowphase(value: number) {\n    this._narrowphase = value;\n  }\n}\n","import { Engine, ScrollPreventionMode } from './../Engine';\nimport { GameEvent } from '../Events';\nimport { Actor } from '../Actor';\nimport { Vector, GlobalCoordinates } from '../Algebra';\nimport { Class } from '../Class';\nimport * as Actors from '../Util/Actors';\nimport * as Util from '../Util/Util';\nimport * as Events from '../Events';\n\nexport interface ActorsUnderPointer {\n  [ActorId: number]: Actor;\n  length: number;\n}\n\n/**\n * The type of pointer for a [[PointerEvent]].\n */\nexport enum PointerType {\n  Touch = 'Touch',\n  Mouse = 'Mouse',\n  Pen = 'Pen',\n  Unknown = 'Unknown'\n}\n\n/**\n * Native browser button enumeration\n */\nexport enum NativePointerButton {\n  NoButton = -1,\n  Left = 0,\n  Middle = 1,\n  Right = 2,\n  Unknown = 3\n}\n\n/**\n * The mouse button being pressed.\n */\nexport enum PointerButton {\n  Left = 'Left',\n  Middle = 'Middle',\n  Right = 'Right',\n  Unknown = 'Unknown',\n  NoButton = 'NoButton'\n}\n\nexport enum WheelDeltaMode {\n  Pixel = 'Pixel',\n  Line = 'Line',\n  Page = 'Page'\n}\n\n/**\n * Determines the scope of handling mouse/touch events. See [[Pointers]] for more information.\n */\nexport enum PointerScope {\n  /**\n   * Handle events on the `canvas` element only. Events originating outside the\n   * `canvas` will not be handled.\n   */\n  Canvas = 'Canvas',\n\n  /**\n   * Handles events on the entire document. All events will be handled by Excalibur.\n   */\n  Document = 'Document'\n}\n\n/**\n * A constant used to normalize wheel events across different browsers\n *\n * This normalization factor is pulled from https://developer.mozilla.org/en-US/docs/Web/Events/wheel#Listening_to_this_event_across_browser\n */\nconst ScrollWheelNormalizationFactor = -1 / 40;\n\n/**\n * Type that indicates Excalibur's valid synthetic pointer events\n */\nexport type PointerEventName =\n  | 'pointerdragstart'\n  | 'pointerdragend'\n  | 'pointerdragmove'\n  | 'pointerdragenter'\n  | 'pointerdragleave'\n  | 'pointermove'\n  | 'pointerenter'\n  | 'pointerleave'\n  | 'pointerup'\n  | 'pointerdown';\n\n/**\n * Pointer events\n *\n * Represents a mouse, touch, or stylus event. See [[Pointers]] for more information on\n * handling pointer input.\n *\n * For mouse-based events, you can inspect [[PointerEvent.button]] to see what button was pressed.\n */\nexport class PointerEvent extends GameEvent<Actor> {\n  /** The world coordinates of the event. */\n  public get worldPos(): Vector {\n    return this.coordinates.worldPos.clone();\n  }\n\n  /** The page coordinates of the event. */\n  public get pagePos(): Vector {\n    return this.coordinates.pagePos.clone();\n  }\n\n  /** The screen coordinates of the event. */\n  public get screenPos(): Vector {\n    return this.coordinates.screenPos.clone();\n  }\n\n  /**\n   * @param coordinates         The [[GlobalCoordinates]] of the event\n   * @param pointer             The [[Pointer]] of the event\n   * @param index               The index of the pointer (zero-based)\n   * @param pointerType         The type of pointer\n   * @param button              The button pressed (if [[PointerType.Mouse]])\n   * @param ev                  The raw DOM event being handled\n   * @param pos                 (Will be added to signature in 0.14.0 release) The position of the event (in world coordinates)\n   */\n  constructor(\n    protected coordinates: GlobalCoordinates,\n    public pointer: Pointer,\n    public index: number,\n    public pointerType: PointerType,\n    public button: PointerButton,\n    public ev: any\n  ) {\n    super();\n  }\n\n  public get pos(): Vector {\n    return this.coordinates.worldPos.clone();\n  }\n  /**\n   * Sets event path to actor, depending on actor provided.\n   * If actor is lower in hierarchy tree, previous path'll be kept.\n   * @param actor Actor, to lay path form.\n   */\n  public layPath(actor: Actor): void {\n    if (!this.pointer.isActorUnderPointer(actor)) {\n      return;\n    }\n\n    const actorPath = actor.getAncestors();\n    this._path = actorPath.length > this._path.length ? actorPath : this._path;\n  }\n}\n\nexport class PointerEventFactory<T extends PointerEvent> {\n  constructor(\n    protected _pointerEventType: new (\n      coordinates: GlobalCoordinates,\n      pointer: Pointer,\n      index: number,\n      pointerType: PointerType,\n      button: PointerButton,\n      ev: any\n    ) => T\n  ) {}\n\n  /**\n   * Create specific PointerEvent\n   */\n  public create(\n    coordinates: GlobalCoordinates,\n    pointer: Pointer,\n    index: number,\n    pointerType: PointerType,\n    button: PointerButton,\n    ev: any\n  ): T {\n    return new this._pointerEventType(coordinates, pointer, index, pointerType, button, ev);\n  }\n}\n\nexport class PointerDragEvent extends PointerEvent {}\n\nexport class PointerUpEvent extends PointerEvent {\n  protected _name = 'pointerup';\n\n  protected _onActionEnd(actor: Actor) {\n    const pointer = this.pointer;\n\n    if (pointer.isDragEnd && actor.capturePointer.captureDragEvents) {\n      actor.eventDispatcher.emit('pointerdragend', this);\n    }\n  }\n}\n\nexport class PointerDownEvent extends PointerEvent {\n  protected _name = 'pointerdown';\n\n  protected _onActionEnd(actor: Actor) {\n    if (this.pointer.isDragStart && actor.capturePointer.captureDragEvents) {\n      actor.eventDispatcher.emit('pointerdragstart', this);\n    }\n  }\n}\n\nexport class PointerMoveEvent extends PointerEvent {\n  protected _name = 'pointermove';\n\n  public propagate(): void {\n    if (!this.eventPath.length) {\n      if (this.pointer.hasActorsUnderPointer) {\n        const actors = this.pointer.getActorsUnderPointer();\n        actors.forEach((actor) => {\n          if (!this.pointer.isActorUnderPointer(actor)) {\n            this._onActorLeave(actor);\n          }\n        });\n      }\n\n      return;\n    }\n\n    this.action();\n\n    if (this.bubbles) {\n      this.propagate();\n    }\n  }\n\n  /**\n   * Sets event path to actor, depending on actor provided.\n   * If actor is in a dragging state, current dragging target would be used.\n   * @param actor Actor, to lay path form.\n   */\n  public layPath(actor: Actor): void {\n    /**\n     *  double-check is preformed, because user could move pointer too fast and\n     *  in that case, pointer can appear out of boundings of the dragging element\n     */\n    if (this.pointer.isDragging) {\n      actor = this.pointer.dragTarget || actor;\n    } else if (!this.pointer.isActorUnderPointer(actor)) {\n      return;\n    }\n\n    const actorPath = actor.getAncestors();\n    this._path = actorPath.length > this._path.length ? actorPath : this._path;\n  }\n\n  protected _onActionStart(actor: Actor) {\n    if (!actor.capturePointer.captureMoveEvents) {\n      return;\n    }\n\n    if (this.pointer.isActorUnderPointer(actor) && !this.pointer.hasActorUnderPointerInList(actor)) {\n      this._onActorEnter(actor);\n    }\n\n    if (this.pointer.isDragging && actor.capturePointer.captureDragEvents) {\n      actor.eventDispatcher.emit('pointerdragmove', this);\n    }\n  }\n\n  private _onActorEnter(actor: Actor) {\n    const pe = createPointerEventByName('enter', this.coordinates, this.pointer, this.index, this.pointerType, this.button, this.ev);\n    pe.layPath(actor);\n    pe.propagate();\n    this.pointer.addActorUnderPointer(actor);\n\n    if (this.pointer.isDragging) {\n      this.pointer.dragTarget = actor;\n    }\n  }\n\n  private _onActorLeave(actor: Actor) {\n    const pe = createPointerEventByName('leave', this.coordinates, this.pointer, this.index, this.pointerType, this.button, this.ev);\n    pe.layPath(actor);\n    pe.propagate();\n    this.pointer.removeActorUnderPointer(actor);\n  }\n}\n\nexport class PointerEnterEvent extends PointerEvent {\n  protected _name = 'pointerenter';\n\n  protected _onActionStart(actor: Actor) {\n    if (!actor.capturePointer.captureMoveEvents) {\n      return;\n    }\n  }\n\n  protected _onActionEnd(actor: Actor) {\n    const pointer = this.pointer;\n\n    if (pointer.isDragging && actor.capturePointer.captureDragEvents) {\n      actor.eventDispatcher.emit('pointerdragenter', this);\n    }\n  }\n}\n\nexport class PointerLeaveEvent extends PointerEvent {\n  protected _name = 'pointerleave';\n\n  public layPath(actor: Actor): void {\n    const actorPath = actor.getAncestors();\n    this._path = actorPath.length > this._path.length ? actorPath : this._path;\n  }\n\n  protected _onActionStart(actor: Actor) {\n    if (!actor.capturePointer.captureMoveEvents) {\n      return;\n    }\n  }\n\n  protected _onActionEnd(actor: Actor) {\n    const pointer = this.pointer;\n\n    if (pointer.isDragging && actor.capturePointer.captureDragEvents) {\n      actor.eventDispatcher.emit('pointerdragleave', this);\n    }\n  }\n}\n\nexport class PointerCancelEvent extends PointerEvent {\n  protected _name = 'pointercancel';\n}\n/**\n * Wheel Events\n *\n * Represents a mouse wheel event. See [[Pointers]] for more information on\n * handling point input.\n */\nexport class WheelEvent extends GameEvent<Actor> {\n  /**\n   * @param x            The `x` coordinate of the event (in world coordinates)\n   * @param y            The `y` coordinate of the event (in world coordinates)\n   * @param pageX        The `x` coordinate of the event (in document coordinates)\n   * @param pageY        The `y` coordinate of the event (in document coordinates)\n   * @param screenX      The `x` coordinate of the event (in screen coordinates)\n   * @param screenY      The `y` coordinate of the event (in screen coordinates)\n   * @param index        The index of the pointer (zero-based)\n   * @param deltaX       The type of pointer\n   * @param deltaY       The type of pointer\n   * @param deltaZ       The type of pointer\n   * @param deltaMode    The type of movement [[WheelDeltaMode]]\n   * @param ev           The raw DOM event being handled\n   */\n  constructor(\n    public x: number,\n    public y: number,\n    public pageX: number,\n    public pageY: number,\n    public screenX: number,\n    public screenY: number,\n    public index: number,\n    public deltaX: number,\n    public deltaY: number,\n    public deltaZ: number,\n    public deltaMode: WheelDeltaMode,\n    public ev: any\n  ) {\n    super();\n  }\n}\n\nfunction createPointerEventByName(\n  eventName: string,\n  coordinates: GlobalCoordinates,\n  pointer: Pointer,\n  index: number,\n  pointerType: PointerType,\n  button: PointerButton,\n  ev: any\n) {\n  let factory: PointerEventFactory<PointerEvent>;\n\n  switch (eventName) {\n    case 'up':\n      factory = new PointerEventFactory(<any>PointerUpEvent);\n      break;\n    case 'down':\n      factory = new PointerEventFactory(<any>PointerDownEvent);\n      break;\n    case 'move':\n      factory = new PointerEventFactory(<any>PointerMoveEvent);\n      break;\n    case 'cancel':\n      factory = new PointerEventFactory(<any>PointerCancelEvent);\n      break;\n    case 'enter':\n      factory = new PointerEventFactory(<any>PointerEnterEvent);\n      break;\n    case 'leave':\n      factory = new PointerEventFactory(<any>PointerLeaveEvent);\n      break;\n  }\n\n  return factory.create(coordinates, pointer, index, pointerType, button, ev);\n}\n\n/**\n * Handles pointer events (mouse, touch, stylus, etc.) and normalizes to\n * [W3C Pointer Events](http://www.w3.org/TR/pointerevents/).\n *\n * [[include:Pointers.md]]\n */\nexport class Pointers extends Class {\n  private _engine: Engine;\n\n  private _pointerDown: PointerEvent[] = [];\n  private _pointerUp: PointerEvent[] = [];\n  private _pointerMove: PointerEvent[] = [];\n  private _pointerCancel: PointerEvent[] = [];\n  private _wheel: WheelEvent[] = [];\n  private _pointers: Pointer[] = [];\n  private _activePointers: number[] = [];\n\n  constructor(engine: Engine) {\n    super();\n\n    this._engine = engine;\n    this._pointers.push(new Pointer());\n    this._activePointers = [-1];\n    this.primary = this._pointers[0];\n  }\n\n  public on(eventName: Events.up, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.down, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.move, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.enter, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.leave, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.cancel, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.wheel, handler: (event: WheelEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  /**\n   * Primary pointer (mouse, 1 finger, stylus, etc.)\n   */\n  public primary: Pointer;\n\n  /**\n   * Initializes pointer event listeners\n   */\n  public init(target?: GlobalEventHandlers): void {\n    target = target || this._engine.canvas;\n\n    // Touch Events\n    target.addEventListener('touchstart', this._handleTouchEvent('down', this._pointerDown));\n    target.addEventListener('touchend', this._handleTouchEvent('up', this._pointerUp));\n    target.addEventListener('touchmove', this._handleTouchEvent('move', this._pointerMove));\n    target.addEventListener('touchcancel', this._handleTouchEvent('cancel', this._pointerCancel));\n\n    // W3C Pointer Events\n    // Current: IE11, IE10\n    if ((<any>window).PointerEvent) {\n      // IE11\n      this._engine.canvas.style.touchAction = 'none';\n      target.addEventListener('pointerdown', this._handlePointerEvent('down', this._pointerDown));\n      target.addEventListener('pointerup', this._handlePointerEvent('up', this._pointerUp));\n      target.addEventListener('pointermove', this._handlePointerEvent('move', this._pointerMove));\n      target.addEventListener('pointercancel', this._handlePointerEvent('cancel', this._pointerCancel));\n    } else if ((<any>window).MSPointerEvent) {\n      // IE10\n      this._engine.canvas.style.msTouchAction = 'none';\n      target.addEventListener('MSPointerDown', this._handlePointerEvent('down', this._pointerDown));\n      target.addEventListener('MSPointerUp', this._handlePointerEvent('up', this._pointerUp));\n      target.addEventListener('MSPointerMove', this._handlePointerEvent('move', this._pointerMove));\n      target.addEventListener('MSPointerCancel', this._handlePointerEvent('cancel', this._pointerCancel));\n    } else {\n      // Mouse Events\n      target.addEventListener('mousedown', this._handleMouseEvent('down', this._pointerDown));\n      target.addEventListener('mouseup', this._handleMouseEvent('up', this._pointerUp));\n      target.addEventListener('mousemove', this._handleMouseEvent('move', this._pointerMove));\n    }\n\n    // MDN MouseWheelEvent\n    if ('onwheel' in document.createElement('div')) {\n      // Modern Browsers\n      target.addEventListener('wheel', this._handleWheelEvent('wheel', this._wheel));\n    } else if (document.onmousewheel !== undefined) {\n      // Webkit and IE\n      target.addEventListener('mousewheel', this._handleWheelEvent('wheel', this._wheel));\n    } else {\n      // Remaining browser and older Firefox\n      target.addEventListener('MozMousePixelScroll', this._handleWheelEvent('wheel', this._wheel));\n    }\n  }\n\n  public update(): void {\n    this._pointerUp.length = 0;\n    this._pointerDown.length = 0;\n    this._pointerMove.length = 0;\n    this._pointerCancel.length = 0;\n    this._wheel.length = 0;\n\n    for (let i = 0; i < this._pointers.length; i++) {\n      this._pointers[i].update();\n    }\n  }\n\n  /**\n   * Safely gets a Pointer at a specific index and initializes one if it doesn't yet exist\n   * @param index  The pointer index to retrieve\n   */\n  public at(index: number): Pointer {\n    if (index >= this._pointers.length) {\n      // Ensure there is a pointer to retrieve\n      for (let i = this._pointers.length - 1, max = index; i < max; i++) {\n        this._pointers.push(new Pointer());\n        this._activePointers.push(-1);\n      }\n    }\n\n    return this._pointers[index];\n  }\n\n  /**\n   * Get number of pointers being watched\n   */\n  public count(): number {\n    return this._pointers.length;\n  }\n\n  /**\n   * Propogates events through ancestors chain if necessary\n   */\n  public propagate() {\n    this._propagatePointerEvent(this._pointerDown);\n    this._propagatePointerEvent(this._pointerUp);\n    this._propagatePointerEvent(this._pointerMove);\n    this._propagatePointerEvent(this._pointerCancel);\n    this._propagateWheelEvent('pointerwheel', this._wheel);\n  }\n\n  /**\n   * Revises pointer events paths accordingly to actor provided\n   * @param actor  Actor to be revised\n   */\n  public revisePointerEventsPaths(actor: Actor) {\n    this._revisePointerEventPath(actor, this._pointerDown);\n    this._revisePointerEventPath(actor, this._pointerUp);\n    this._revisePointerEventPath(actor, this._pointerMove);\n    this._revisePointerEventPath(actor, this._pointerCancel);\n    this._validateWheelEventPath(this._wheel, actor);\n  }\n\n  private _propagatePointerEvent(pointers: PointerEvent[]) {\n    const len = pointers.length;\n\n    for (let i = 0; i < len; i++) {\n      pointers[i].propagate();\n    }\n  }\n\n  private _revisePointerEventPath(actor: Actor, pointers: PointerEvent[]) {\n    const len = pointers.length;\n\n    for (let i = 0; i < len; i++) {\n      const pointerEvent = pointers[i];\n\n      pointerEvent.layPath(actor);\n    }\n  }\n\n  private _validateWheelEventPath(pointers: WheelEvent[], actor: Actor): void {\n    for (let i = 0; i < pointers.length; i++) {\n      const wheelEvent = pointers[i];\n      const isNotUIActor = !Actors.isUIActor(actor);\n\n      if (actor.contains(wheelEvent.x, wheelEvent.y, isNotUIActor)) {\n        wheelEvent.layPath(actor);\n      }\n    }\n  }\n\n  private _propagateWheelEvent(eventName: string, pointers: WheelEvent[]) {\n    const len = pointers.length;\n    let wheelEvent: WheelEvent;\n\n    for (let i = 0; i < len; i++) {\n      wheelEvent = pointers[i];\n\n      switch (eventName) {\n        case 'pointerwheel':\n          this._propagateWheelPointerEvent(wheelEvent);\n          break;\n      }\n    }\n  }\n\n  private _propagateWheelPointerEvent(wheelEvent: WheelEvent) {\n    if (!wheelEvent.eventPath.length) {\n      return;\n    }\n\n    const actor = wheelEvent.eventPath.pop();\n    actor.eventDispatcher.emit('pointerwheel', wheelEvent);\n\n    if (wheelEvent.bubbles) {\n      this._propagateWheelPointerEvent(wheelEvent);\n    }\n  }\n\n  private _handleMouseEvent(eventName: string, eventArr: PointerEvent[]) {\n    return (e: MouseEvent) => {\n      e.preventDefault();\n\n      const pointer = this.at(0);\n      const coordinates = GlobalCoordinates.fromPagePosition(e.pageX, e.pageY, this._engine);\n      const pe = createPointerEventByName(\n        eventName,\n        coordinates,\n        pointer,\n        0,\n        PointerType.Mouse,\n        this._nativeButtonToPointerButton(e.button),\n        e\n      );\n\n      eventArr.push(pe);\n      pointer.eventDispatcher.emit(eventName, pe);\n    };\n  }\n\n  private _handleTouchEvent(eventName: string, eventArr: PointerEvent[]) {\n    return (e: TouchEvent) => {\n      e.preventDefault();\n      for (let i = 0, len = e.changedTouches.length; i < len; i++) {\n        const index = this._pointers.length > 1 ? this._getPointerIndex(e.changedTouches[i].identifier) : 0;\n        if (index === -1) {\n          continue;\n        }\n\n        const pointer = this.at(index);\n        const coordinates = GlobalCoordinates.fromPagePosition(e.changedTouches[i].pageX, e.changedTouches[i].pageY, this._engine);\n        const pe = createPointerEventByName(eventName, coordinates, pointer, index, PointerType.Touch, PointerButton.Unknown, e);\n\n        eventArr.push(pe);\n        pointer.eventDispatcher.emit(eventName, pe);\n        // only with multi-pointer\n        if (this._pointers.length > 1) {\n          if (eventName === 'up') {\n            // remove pointer ID from pool when pointer is lifted\n            this._activePointers[index] = -1;\n          } else if (eventName === 'down') {\n            // set pointer ID to given index\n            this._activePointers[index] = e.changedTouches[i].identifier;\n          }\n        }\n      }\n    };\n  }\n\n  private _handlePointerEvent(eventName: string, eventArr: PointerEvent[]) {\n    return (e: MSPointerEvent) => {\n      e.preventDefault();\n\n      // get the index for this pointer ID if multi-pointer is asked for\n      const index = this._pointers.length > 1 ? this._getPointerIndex(e.pointerId) : 0;\n      if (index === -1) {\n        return;\n      }\n\n      const pointer = this.at(index);\n      const coordinates = GlobalCoordinates.fromPagePosition(e.pageX, e.pageY, this._engine);\n      const pe = createPointerEventByName(\n        eventName,\n        coordinates,\n        pointer,\n        index,\n        this._stringToPointerType(e.pointerType),\n        this._nativeButtonToPointerButton(e.button),\n        e\n      );\n\n      eventArr.push(pe);\n      pointer.eventDispatcher.emit(eventName, pe);\n\n      // only with multi-pointer\n      if (this._pointers.length > 1) {\n        if (eventName === 'up') {\n          // remove pointer ID from pool when pointer is lifted\n          this._activePointers[index] = -1;\n        } else if (eventName === 'down') {\n          // set pointer ID to given index\n          this._activePointers[index] = e.pointerId;\n        }\n      }\n    };\n  }\n\n  private _handleWheelEvent(eventName: string, eventArr: WheelEvent[]) {\n    return (e: MouseWheelEvent) => {\n      // Should we prevent page scroll because of this event\n      if (\n        this._engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\n        (this._engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas && e.target === this._engine.canvas)\n      ) {\n        e.preventDefault();\n      }\n\n      const x: number = e.pageX - Util.getPosition(this._engine.canvas).x;\n      const y: number = e.pageY - Util.getPosition(this._engine.canvas).y;\n      const transformedPoint = this._engine.screenToWorldCoordinates(new Vector(x, y));\n\n      // deltaX, deltaY, and deltaZ are the standard modern properties\n      // wheelDeltaX, wheelDeltaY, are legacy properties in webkit browsers and older IE\n      // e.detail is only used in opera\n\n      const deltaX = e.deltaX || e.wheelDeltaX * ScrollWheelNormalizationFactor || 0;\n      const deltaY =\n        e.deltaY || e.wheelDeltaY * ScrollWheelNormalizationFactor || e.wheelDelta * ScrollWheelNormalizationFactor || e.detail || 0;\n      const deltaZ = e.deltaZ || 0;\n      let deltaMode = WheelDeltaMode.Pixel;\n\n      if (e.deltaMode) {\n        if (e.deltaMode === 1) {\n          deltaMode = WheelDeltaMode.Line;\n        } else if (e.deltaMode === 2) {\n          deltaMode = WheelDeltaMode.Page;\n        }\n      }\n\n      const we = new WheelEvent(transformedPoint.x, transformedPoint.y, e.pageX, e.pageY, x, y, 0, deltaX, deltaY, deltaZ, deltaMode, e);\n\n      eventArr.push(we);\n      this.at(0).eventDispatcher.emit(eventName, we);\n    };\n  }\n\n  /**\n   * Gets the index of the pointer specified for the given pointer ID or finds the next empty pointer slot available.\n   * This is required because IE10/11 uses incrementing pointer IDs so we need to store a mapping of ID => idx\n   */\n  private _getPointerIndex(pointerId: number) {\n    let idx;\n    if ((idx = this._activePointers.indexOf(pointerId)) > -1) {\n      return idx;\n    }\n\n    for (let i = 0; i < this._activePointers.length; i++) {\n      if (this._activePointers[i] === -1) {\n        return i;\n      }\n    }\n\n    // ignore pointer because game isn't watching\n    return -1;\n  }\n\n  private _nativeButtonToPointerButton(s: NativePointerButton): PointerButton {\n    switch (s) {\n      case NativePointerButton.NoButton:\n        return PointerButton.NoButton;\n      case NativePointerButton.Left:\n        return PointerButton.Left;\n      case NativePointerButton.Middle:\n        return PointerButton.Middle;\n      case NativePointerButton.Right:\n        return PointerButton.Right;\n      case NativePointerButton.Unknown:\n        return PointerButton.Unknown;\n      default:\n        return Util.fail(s);\n    }\n  }\n\n  private _stringToPointerType(s: string) {\n    switch (s) {\n      case 'touch':\n        return PointerType.Touch;\n      case 'mouse':\n        return PointerType.Mouse;\n      case 'pen':\n        return PointerType.Pen;\n      default:\n        return PointerType.Unknown;\n    }\n  }\n}\n\n/**\n * Captures and dispatches PointerEvents\n */\nexport class Pointer extends Class {\n  private _isDown: boolean = false;\n  private _wasDown: boolean = false;\n  private _actorsUnderPointer: ActorsUnderPointer = { length: 0 };\n\n  /**\n   * Whether the Pointer is currently dragging.\n   */\n  public get isDragging(): boolean {\n    return this._isDown;\n  }\n\n  /**\n   * Whether the Pointer just started dragging.\n   */\n  public get isDragStart(): boolean {\n    return !this._wasDown && this._isDown;\n  }\n\n  /**\n   * Whether the Pointer just ended dragging.\n   */\n  public get isDragEnd(): boolean {\n    return this._wasDown && !this._isDown;\n  }\n\n  /**\n   * Returns true if pointer has any actors under\n   */\n  public get hasActorsUnderPointer(): boolean {\n    return !!this._actorsUnderPointer.length;\n  }\n\n  /**\n   * The last position on the document this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastPagePos: Vector = null;\n\n  /**\n   * The last position on the screen this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastScreenPos: Vector = null;\n\n  /**\n   * The last position in the game world coordinates this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastWorldPos: Vector = null;\n\n  /**\n   * Returns the currently dragging target or null if it isn't exist\n   */\n  public dragTarget: Actor = null;\n\n  constructor() {\n    super();\n\n    this.on('move', this._onPointerMove);\n    this.on('down', this._onPointerDown);\n    this.on('up', this._onPointerUp);\n  }\n\n  public update(): void {\n    if (this._wasDown && !this._isDown) {\n      this._wasDown = false;\n    } else if (!this._wasDown && this._isDown) {\n      this._wasDown = true;\n    }\n  }\n\n  /**\n   * Adds an Actor to actorsUnderPointer object.\n   * @param actor An Actor to be added;\n   */\n  public addActorUnderPointer(actor: Actor): void {\n    if (!this.hasActorUnderPointerInList(actor)) {\n      this._actorsUnderPointer[actor.id] = actor;\n      this._actorsUnderPointer.length += 1;\n    }\n  }\n\n  /**\n   * Removes an Actor from actorsUnderPointer object.\n   * @param actor An Actor to be removed;\n   */\n  public removeActorUnderPointer(actor: Actor): void {\n    if (this.hasActorUnderPointerInList(actor)) {\n      delete this._actorsUnderPointer[actor.id];\n      this._actorsUnderPointer.length -= 1;\n    }\n  }\n\n  /**\n   * Returns an Actor from actorsUnderPointer object.\n   * @param actor An Actor to be ;\n   */\n  public getActorsUnderPointer(): Actor[] {\n    const actors: Actor[] = [];\n\n    for (const id in this._actorsUnderPointer) {\n      if (id === 'length') {\n        continue;\n      }\n      const actor = this._actorsUnderPointer[id];\n      actors.push(actor);\n    }\n\n    return actors;\n  }\n\n  /**\n   * Checks if Pointer has a specific Actor under.\n   * @param actor An Actor for check;\n   */\n  public isActorUnderPointer(actor: Actor): boolean {\n    if (this.lastWorldPos) {\n      return actor.contains(this.lastWorldPos.x, this.lastWorldPos.y, !Actors.isUIActor(actor));\n    }\n    return false;\n  }\n\n  /**\n   * Checks if Pointer has a specific Actor in ActrorsUnderPointer list.\n   * @param actor An Actor for check;\n   */\n  public hasActorUnderPointerInList(actor: Actor): boolean {\n    return this._actorsUnderPointer.hasOwnProperty(actor.id.toString());\n  }\n\n  private _onPointerMove(ev: PointerEvent): void {\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\n  }\n\n  private _onPointerDown(ev: PointerEvent): void {\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\n    this._isDown = true;\n  }\n\n  private _onPointerUp(): void {\n    this._isDown = false;\n    this.dragTarget = null;\n  }\n}\n\ninterface TouchEvent extends Event {\n  altKey: boolean;\n  changedTouches: Touch[];\n  ctrlKey: boolean;\n  metaKey: boolean;\n  shiftKey: boolean;\n  targetTouches: Touch[];\n  touches: Touch[];\n  type: string;\n  target: Element;\n}\n\ninterface Touch {\n  identifier: number;\n  screenX: number;\n  screenY: number;\n  clientX: number;\n  clientY: number;\n  pageX: number;\n  pageY: number;\n  radiusX: number;\n  radiusY: number;\n  rotationAngle: number;\n  force: number;\n  target: Element;\n}\n","import { Class } from './../Class';\nimport { GameEvent, GamepadConnectEvent, GamepadDisconnectEvent, GamepadButtonEvent, GamepadAxisEvent } from '../Events';\nimport * as Events from '../Events';\n\n/**\n * Excalibur leverages the HTML5 Gamepad API [where it is supported](http://caniuse.com/#feat=gamepad)\n * to provide controller support for your games.\n *\n * [[include:Gamepads.md]]\n */\nexport class Gamepads extends Class {\n  /**\n   * Whether or not to poll for Gamepad input (default: `false`)\n   */\n  public enabled = false;\n\n  /**\n   * Whether or not Gamepad API is supported\n   */\n  public supported = !!(<any>navigator).getGamepads;\n\n  /**\n   * The minimum value an axis has to move before considering it a change\n   */\n  public static MinAxisMoveThreshold = 0.05;\n\n  private _gamePadTimeStamps = [0, 0, 0, 0];\n  private _oldPads: Gamepad[] = [];\n  private _pads: Gamepad[] = [];\n  private _initSuccess: boolean = false;\n  private _navigator: NavigatorGamepads = <any>navigator;\n  private _minimumConfiguration: GamepadConfiguration = null;\n\n  constructor() {\n    super();\n  }\n\n  public init() {\n    if (!this.supported) {\n      return;\n    }\n    if (this._initSuccess) {\n      return;\n    }\n\n    // In Chrome, this will return 4 undefined items until a button is pressed\n    // In FF, this will not return any items until a button is pressed\n    this._oldPads = this._clonePads(this._navigator.getGamepads());\n    if (this._oldPads.length && this._oldPads[0]) {\n      this._initSuccess = true;\n    }\n  }\n\n  /**\n   * Sets the minimum gamepad configuration, for example {axis: 4, buttons: 4} means\n   * this game requires at minimum 4 axis inputs and 4 buttons, this is not restrictive\n   * all other controllers with more axis or buttons are valid as well. If no minimum\n   * configuration is set all pads are valid.\n   */\n  public setMinimumGamepadConfiguration(config: GamepadConfiguration): void {\n    this._enableAndUpdate(); // if config is used, implicitly enable\n    this._minimumConfiguration = config;\n  }\n\n  /**\n   * When implicitly enabled, set the enabled flag and run an update so information is updated\n   */\n  private _enableAndUpdate() {\n    if (!this.enabled) {\n      this.enabled = true;\n      this.update();\n    }\n  }\n\n  /**\n   * Checks a navigator gamepad against the minimum configuration if present.\n   */\n  private _isGamepadValid(pad: NavigatorGamepad): boolean {\n    if (!this._minimumConfiguration) {\n      return true;\n    }\n    if (!pad) {\n      return false;\n    }\n    const axesLength = pad.axes.filter((value) => {\n      return typeof value !== undefined;\n    }).length;\n\n    const buttonLength = pad.buttons.filter((value) => {\n      return typeof value !== undefined;\n    }).length;\n    return axesLength >= this._minimumConfiguration.axis && buttonLength >= this._minimumConfiguration.buttons && pad.connected;\n  }\n\n  public on(eventName: Events.connect, handler: (event: GamepadConnectEvent) => void): void;\n  public on(eventName: Events.disconnect, handler: (event: GamepadDisconnectEvent) => void): void;\n  public on(eventName: Events.button, handler: (event: GamepadButtonEvent) => void): void;\n  public on(eventName: Events.axis, handler: (event: GamepadAxisEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    this._enableAndUpdate(); // implicitly enable\n    super.on(eventName, handler);\n  }\n\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void) {\n    this._enableAndUpdate(); // implicitly enable\n    super.off(eventName, handler);\n  }\n\n  /**\n   * Updates Gamepad state and publishes Gamepad events\n   */\n  public update() {\n    if (!this.enabled || !this.supported) {\n      return;\n    }\n    this.init();\n\n    const gamepads = this._navigator.getGamepads();\n\n    for (let i = 0; i < gamepads.length; i++) {\n      if (!gamepads[i]) {\n        const gamepad = this.at(i);\n        // If was connected, but now isn't emit the disconnect event\n        if (gamepad.connected) {\n          this.eventDispatcher.emit('disconnect', new GamepadDisconnectEvent(i, gamepad));\n        }\n        // Reset connection status\n        gamepad.connected = false;\n        continue;\n      } else {\n        if (!this.at(i).connected && this._isGamepadValid(gamepads[i])) {\n          this.eventDispatcher.emit('connect', new GamepadConnectEvent(i, this.at(i)));\n        }\n        // Set connection status\n        this.at(i).connected = true;\n      }\n\n      // Only supported in Chrome\n      if (gamepads[i].timestamp && gamepads[i].timestamp === this._gamePadTimeStamps[i]) {\n        continue;\n      }\n\n      this._gamePadTimeStamps[i] = gamepads[i].timestamp;\n\n      // Add reference to navigator gamepad\n      this.at(i).navigatorGamepad = gamepads[i];\n\n      // Buttons\n      let b: string, bi: number, a: string, ai: number, value: number;\n\n      for (b in Buttons) {\n        bi = <any>Buttons[b];\n        if (typeof bi === 'number') {\n          if (gamepads[i].buttons[bi]) {\n            value = gamepads[i].buttons[bi].value;\n            if (value !== this._oldPads[i].getButton(bi)) {\n              if (gamepads[i].buttons[bi].pressed) {\n                this.at(i).updateButton(bi, value);\n                this.at(i).eventDispatcher.emit('button', new GamepadButtonEvent(bi, value, this.at(i)));\n              } else {\n                this.at(i).updateButton(bi, 0);\n              }\n            }\n          }\n        }\n      }\n\n      // Axes\n      for (a in Axes) {\n        ai = <any>Axes[a];\n        if (typeof ai === 'number') {\n          value = gamepads[i].axes[ai];\n          if (value !== this._oldPads[i].getAxes(ai)) {\n            this.at(i).updateAxes(ai, value);\n            this.at(i).eventDispatcher.emit('axis', new GamepadAxisEvent(ai, value, this.at(i)));\n          }\n        }\n      }\n\n      this._oldPads[i] = this._clonePad(gamepads[i]);\n    }\n  }\n\n  /**\n   * Safely retrieves a Gamepad at a specific index and creates one if it doesn't yet exist\n   */\n  public at(index: number): Gamepad {\n    this._enableAndUpdate(); // implicitly enable gamepads when at() is called\n    if (index >= this._pads.length) {\n      // Ensure there is a pad to retrieve\n      for (let i = this._pads.length - 1, max = index; i < max; i++) {\n        this._pads.push(new Gamepad());\n        this._oldPads.push(new Gamepad());\n      }\n    }\n\n    return this._pads[index];\n  }\n\n  /**\n   * Returns a list of all valid gamepads that meet the minimum configuration requirement.\n   */\n  public getValidGamepads(): Gamepad[] {\n    this._enableAndUpdate();\n    const result: Gamepad[] = [];\n    for (let i = 0; i < this._pads.length; i++) {\n      if (this._isGamepadValid(this.at(i).navigatorGamepad) && this.at(i).connected) {\n        result.push(this.at(i));\n      }\n    }\n    return result;\n  }\n\n  /**\n   * Gets the number of connected gamepads\n   */\n  public count() {\n    return this._pads.filter((p) => p.connected).length;\n  }\n\n  private _clonePads(pads: NavigatorGamepad[]): Gamepad[] {\n    const arr = [];\n    for (let i = 0, len = pads.length; i < len; i++) {\n      arr.push(this._clonePad(pads[i]));\n    }\n    return arr;\n  }\n\n  /**\n   * Fastest way to clone a known object is to do it yourself\n   */\n  private _clonePad(pad: NavigatorGamepad): Gamepad {\n    let i, len;\n    const clonedPad = new Gamepad();\n\n    if (!pad) {\n      return clonedPad;\n    }\n\n    for (i = 0, len = pad.buttons.length; i < len; i++) {\n      if (pad.buttons[i]) {\n        clonedPad.updateButton(i, pad.buttons[i].value);\n      }\n    }\n    for (i = 0, len = pad.axes.length; i < len; i++) {\n      clonedPad.updateAxes(i, pad.axes[i]);\n    }\n\n    return clonedPad;\n  }\n}\n\n/**\n * Gamepad holds state information for a connected controller. See [[Gamepads]]\n * for more information on handling controller input.\n */\nexport class Gamepad extends Class {\n  public connected = false;\n  public navigatorGamepad: NavigatorGamepad;\n  private _buttons: number[] = new Array(16);\n  private _axes: number[] = new Array(4);\n\n  constructor() {\n    super();\n\n    for (let i = 0; i < this._buttons.length; i++) {\n      this._buttons[i] = 0;\n    }\n    for (let i = 0; i < this._axes.length; i++) {\n      this._axes[i] = 0;\n    }\n  }\n\n  /**\n   * Whether or not the given button is pressed\n   * @param button     The button to query\n   * @param threshold  The threshold over which the button is considered to be pressed\n   */\n  public isButtonPressed(button: Buttons, threshold: number = 1) {\n    return this._buttons[button] >= threshold;\n  }\n\n  /**\n   * Gets the given button value between 0 and 1\n   */\n  public getButton(button: Buttons) {\n    return this._buttons[button];\n  }\n\n  /**\n   * Gets the given axis value between -1 and 1. Values below\n   * [[MinAxisMoveThreshold]] are considered 0.\n   */\n  public getAxes(axes: Axes) {\n    const value = this._axes[axes];\n\n    if (Math.abs(value) < Gamepads.MinAxisMoveThreshold) {\n      return 0;\n    } else {\n      return value;\n    }\n  }\n\n  public updateButton(buttonIndex: number, value: number) {\n    this._buttons[buttonIndex] = value;\n  }\n\n  public updateAxes(axesIndex: number, value: number) {\n    this._axes[axesIndex] = value;\n  }\n}\n\n/**\n * Gamepad Buttons enumeration\n */\nexport enum Buttons {\n  /**\n   * Face 1 button (e.g. A)\n   */\n  Face1 = 0,\n  /**\n   * Face 2 button (e.g. B)\n   */\n  Face2 = 1,\n  /**\n   * Face 3 button (e.g. X)\n   */\n  Face3 = 2,\n  /**\n   * Face 4 button (e.g. Y)\n   */\n  Face4 = 3,\n  /**\n   * Left bumper button\n   */\n  LeftBumper = 4,\n  /**\n   * Right bumper button\n   */\n  RightBumper = 5,\n  /**\n   * Left trigger button\n   */\n  LeftTrigger = 6,\n  /**\n   * Right trigger button\n   */\n  RightTrigger = 7,\n  /**\n   * Select button\n   */\n  Select = 8,\n  /**\n   * Start button\n   */\n  Start = 9,\n  /**\n   * Left analog stick press (e.g. L3)\n   */\n  LeftStick = 10,\n  /**\n   * Right analog stick press (e.g. R3)\n   */\n  RightStick = 11,\n  /**\n   * D-pad up\n   */\n  DpadUp = 12,\n  /**\n   * D-pad down\n   */\n  DpadDown = 13,\n  /**\n   * D-pad left\n   */\n  DpadLeft = 14,\n  /**\n   * D-pad right\n   */\n  DpadRight = 15\n}\n\n/**\n * Gamepad Axes enumeration\n */\nexport enum Axes {\n  /**\n   * Left analogue stick X direction\n   */\n  LeftStickX = 0,\n  /**\n   * Left analogue stick Y direction\n   */\n  LeftStickY = 1,\n  /**\n   * Right analogue stick X direction\n   */\n  RightStickX = 2,\n  /**\n   * Right analogue stick Y direction\n   */\n  RightStickY = 3\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepads {\n  getGamepads(): NavigatorGamepad[];\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepad {\n  axes: number[];\n  buttons: NavigatorGamepadButton[];\n  connected: boolean;\n  id: string;\n  index: number;\n  mapping: string;\n  timestamp: number;\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepadButton {\n  pressed: boolean;\n  value: number;\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepadEvent {\n  gamepad: NavigatorGamepad;\n}\n\n/**\n * @internal\n */\nexport interface GamepadConfiguration {\n  axis: number;\n  buttons: number;\n}\n","import { EX_VERSION } from './';\nimport { polyfill } from './Polyfill';\npolyfill();\nimport { CanUpdate, CanDraw, CanInitialize } from './Interfaces/LifecycleEvents';\nimport { Loadable } from './Interfaces/Loadable';\nimport { Promise } from './Promises';\nimport { Vector } from './Algebra';\nimport { UIActor } from './UIActor';\nimport { Actor } from './Actor';\nimport { Timer } from './Timer';\nimport { TileMap } from './TileMap';\nimport { Animation } from './Drawing/Animation';\nimport { Loader } from './Loader';\nimport { Detector } from './Util/Detector';\nimport {\n  VisibleEvent,\n  HiddenEvent,\n  GameStartEvent,\n  GameStopEvent,\n  PreUpdateEvent,\n  PostUpdateEvent,\n  PreFrameEvent,\n  PostFrameEvent,\n  GameEvent,\n  DeactivateEvent,\n  ActivateEvent,\n  PreDrawEvent,\n  PostDrawEvent,\n  InitializeEvent\n} from './Events';\nimport { CanLoad } from './Interfaces/Loader';\nimport { Logger, LogLevel } from './Util/Log';\nimport { Color } from './Drawing/Color';\nimport { Scene } from './Scene';\nimport { PostProcessor } from './PostProcessing/PostProcessor';\nimport { Debug, DebugStats } from './Debug';\nimport { Class } from './Class';\nimport * as Input from './Input/Index';\nimport * as Util from './Util/Util';\nimport * as Events from './Events';\nimport { BoundingBox } from './Collision/BoundingBox';\n\n/**\n * Enum representing the different display modes available to Excalibur\n */\nexport enum DisplayMode {\n  /**\n   * Show the game as full screen\n   */\n  FullScreen,\n  /**\n   * Scale the game to the parent DOM container\n   */\n  Container,\n  /**\n   * Show the game as a fixed size\n   */\n  Fixed,\n\n  /**\n   * Allow the game to be positioned with the [[EngineOptions.position]] option\n   */\n  Position\n}\n\n/**\n * Enum representing the different mousewheel event bubble prevention\n */\nexport enum ScrollPreventionMode {\n  /**\n   * Do not prevent any page scrolling\n   */\n  None,\n  /**\n   * Prevent page scroll if mouse is over the game canvas\n   */\n  Canvas,\n  /**\n   * Prevent all page scrolling via mouse wheel\n   */\n  All\n}\n\n/**\n * Interface describing the absolute CSS position of the game window. For use when [[DisplayMode.Position]]\n * is specified and when the user wants to define exact pixel spacing of the window.\n * When a number is given, the value is interpreted as pixels\n */\nexport interface AbsolutePosition {\n  top?: number | string;\n  left?: number | string;\n  right?: number | string;\n  bottom?: number | string;\n}\n\n/**\n * Defines the available options to configure the Excalibur engine at constructor time.\n */\nexport interface EngineOptions {\n  /**\n   * Optionally configure the native canvas width of the game\n   */\n  width?: number;\n\n  /**\n   * Optionally configure the native canvas height of the game\n   */\n  height?: number;\n\n  /**\n   * Optionally configure the native canvas transparent backdrop\n   */\n  enableCanvasTransparency?: boolean;\n\n  /**\n   * Optionally specify the target canvas DOM element to render the game in\n   */\n  canvasElementId?: string;\n\n  /**\n   * The [[DisplayMode]] of the game. Depending on this value, [[width]] and [[height]] may be ignored.\n   */\n  displayMode?: DisplayMode;\n\n  /**\n   * Configures the pointer scope. Pointers scoped to the 'Canvas' can only fire events within the canvas viewport; whereas, 'Document'\n   * (default) scoped will fire anywhere on the page.\n   */\n  pointerScope?: Input.PointerScope;\n\n  /**\n   * Suppress boot up console message, which contains the \"powered by Excalibur message\"\n   */\n  suppressConsoleBootMessage?: boolean;\n\n  /**\n   * Suppress minimum browser feature detection, it is not recommended users of excalibur switch this off. This feature ensures that\n   * the currently running browser meets the minimum requirements for running excalibur. This can be useful if running on non-standard\n   * browsers or if there is a bug in excalibur preventing execution.\n   */\n  suppressMinimumBrowserFeatureDetection?: boolean;\n\n  /**\n   * Suppress HiDPI auto detection and scaling, it is not recommended users of excalibur switch off this feature. This feature detects\n   * and scales the drawing canvas appropriately to accommodate HiDPI screens.\n   */\n  suppressHiDPIScaling?: boolean;\n\n  /**\n   * Suppress play button, it is not recommended users of excalibur switch this feature. Some browsers require a user gesture (like a click)\n   * for certain browser features to work like web audio.\n   */\n  suppressPlayButton?: boolean;\n\n  /**\n   * Specify how the game window is to be positioned when the [[DisplayMode.Position]] is chosen. This option MUST be specified\n   * if the DisplayMode is set as [[DisplayMode.Position]]. The position can be either a string or an [[IAbsolutePosition]].\n   * String must be in the format of css style background-position. The vertical position must precede the horizontal position in strings.\n   *\n   * Valid String examples: \"top left\", \"top\", \"bottom\", \"middle\", \"middle center\", \"bottom right\"\n   * Valid [[IAbsolutePosition]] examples: `{top: 5, right: 10%}`, `{bottom: 49em, left: 10px}`, `{left: 10, bottom: 40}`\n   */\n  position?: string | AbsolutePosition;\n\n  /**\n   * Scroll prevention method.\n   */\n  scrollPreventionMode?: ScrollPreventionMode;\n\n  /**\n   * Optionally set the background color\n   */\n  backgroundColor?: Color;\n}\n\n/**\n * The Excalibur Engine\n *\n * The [[Engine]] is the main driver for a game. It is responsible for\n * starting/stopping the game, maintaining state, transmitting events,\n * loading resources, and managing the scene.\n *\n * [[include:Engine.md]]\n */\nexport class Engine extends Class implements CanInitialize, CanUpdate, CanDraw {\n  /**\n   * Direct access to the engine's canvas element\n   */\n  public canvas: HTMLCanvasElement;\n\n  /**\n   * Direct access to the engine's 2D rendering context\n   */\n  public ctx: CanvasRenderingContext2D;\n\n  /**\n   * Direct access to the canvas element ID, if an ID exists\n   */\n  public canvasElementId: string;\n\n  /**\n   * The width of the game canvas in pixels (physical width component of the\n   * resolution of the canvas element)\n   */\n  public get canvasWidth(): number {\n    return this.canvas.width;\n  }\n\n  /**\n   * Returns half width of the game canvas in pixels (half physical width component)\n   */\n  public get halfCanvasWidth(): number {\n    return this.canvas.width / 2;\n  }\n\n  /**\n   * The height of the game canvas in pixels, (physical height component of\n   * the resolution of the canvas element)\n   */\n  public get canvasHeight(): number {\n    return this.canvas.height;\n  }\n\n  /**\n   * Returns half height of the game canvas in pixels (half physical height component)\n   */\n  public get halfCanvasHeight(): number {\n    return this.canvas.height / 2;\n  }\n\n  /**\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get drawWidth(): number {\n    if (this.currentScene && this.currentScene.camera) {\n      return this.canvasWidth / this.currentScene.camera.getZoom() / this.pixelRatio;\n    }\n    return this.canvasWidth / this.pixelRatio;\n  }\n\n  /**\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get halfDrawWidth(): number {\n    return this.drawWidth / 2;\n  }\n\n  /**\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get drawHeight(): number {\n    if (this.currentScene && this.currentScene.camera) {\n      return this.canvasHeight / this.currentScene.camera.getZoom() / this.pixelRatio;\n    }\n    return this.canvasHeight / this.pixelRatio;\n  }\n\n  /**\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get halfDrawHeight(): number {\n    return this.drawHeight / 2;\n  }\n\n  /**\n   * Returns whether excalibur detects the current screen to be HiDPI\n   */\n  public get isHiDpi(): boolean {\n    return this.pixelRatio !== 1;\n  }\n\n  /**\n   * Access engine input like pointer, keyboard, or gamepad\n   */\n  public input: Input.EngineInput;\n\n  private _hasStarted: boolean = false;\n\n  /**\n   * Access Excalibur debugging functionality.\n   */\n  public debug = new Debug();\n\n  /**\n   * Access [[stats]] that holds frame statistics.\n   */\n  public get stats(): DebugStats {\n    return this.debug.stats;\n  }\n\n  /**\n   * Gets or sets the list of post processors to apply at the end of drawing a frame (such as [[ColorBlindCorrector]])\n   */\n  public postProcessors: PostProcessor[] = [];\n\n  /**\n   * The current [[Scene]] being drawn and updated on screen\n   */\n  public currentScene: Scene;\n\n  /**\n   * The default [[Scene]] of the game, use [[Engine.goToScene]] to transition to different scenes.\n   */\n  public rootScene: Scene;\n\n  /**\n   * Contains all the scenes currently registered with Excalibur\n   */\n  public scenes: { [key: string]: Scene } = {};\n\n  private _animations: AnimationNode[] = [];\n\n  /**\n   * Indicates whether the engine is set to fullscreen or not\n   */\n  public isFullscreen: boolean = false;\n\n  /**\n   * Indicates the current [[DisplayMode]] of the engine.\n   */\n  public displayMode: DisplayMode = DisplayMode.FullScreen;\n\n  private _suppressHiDPIScaling: boolean = false;\n\n  private _suppressPlayButton: boolean = false;\n  /**\n   * Returns the calculated pixel ration for use in rendering\n   */\n  public get pixelRatio(): number {\n    if (this._suppressHiDPIScaling) {\n      return 1;\n    }\n\n    if (window.devicePixelRatio < 1) {\n      return 1;\n    }\n\n    const devicePixelRatio = window.devicePixelRatio || 1;\n\n    const pixelRatio = devicePixelRatio;\n    return pixelRatio;\n  }\n\n  /**\n   * Indicates the current position of the engine. Valid only when DisplayMode is DisplayMode.Position\n   */\n  public position: string | AbsolutePosition;\n  /**\n   * Indicates whether audio should be paused when the game is no longer visible.\n   */\n  public pauseAudioWhenHidden: boolean = true;\n\n  /**\n   * Indicates whether the engine should draw with debug information\n   */\n  public isDebug: boolean = false;\n  public debugColor: Color = new Color(255, 255, 255);\n  /**\n   * Sets the background color for the engine.\n   */\n  public backgroundColor: Color;\n\n  /**\n   * Sets the Transparency for the engine.\n   */\n  public enableCanvasTransparency: boolean = true;\n\n  /**\n   * The action to take when a fatal exception is thrown\n   */\n  public onFatalException = (e: any) => {\n    Logger.getInstance().fatal(e);\n  };\n\n  /**\n   * The mouse wheel scroll prevention mode\n   */\n  public pageScrollPreventionMode: ScrollPreventionMode;\n\n  private _logger: Logger;\n  private _isSmoothingEnabled: boolean = true;\n\n  // this is a reference to the current requestAnimationFrame return value\n  private _requestId: number;\n\n  // this determines whether excalibur is compatible with your browser\n  private _compatible: boolean;\n\n  private _timescale: number = 1.0;\n\n  // loading\n  private _loader: CanLoad;\n  private _isLoading: boolean = false;\n\n  private _isInitialized: boolean = false;\n\n  public on(eventName: Events.initialize, handler: (event: Events.InitializeEvent) => void): void;\n  public on(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\n  public on(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\n  public on(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\n  public on(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent) => void): void;\n  public on(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\n  public on(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  public once(eventName: Events.initialize, handler: (event: Events.InitializeEvent) => void): void;\n  public once(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\n  public once(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\n  public once(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\n  public once(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent) => void): void;\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent) => void): void;\n  public once(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\n  public once(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent) => void): void;\n  public off(eventName: Events.visible, handler?: (event: VisibleEvent) => void): void;\n  public off(eventName: Events.hidden, handler?: (event: HiddenEvent) => void): void;\n  public off(eventName: Events.start, handler?: (event: GameStartEvent) => void): void;\n  public off(eventName: Events.stop, handler?: (event: GameStopEvent) => void): void;\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent) => void): void;\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent) => void): void;\n  public off(eventName: Events.preframe, handler?: (event: PreFrameEvent) => void): void;\n  public off(eventName: Events.postframe, handler?: (event: PostFrameEvent) => void): void;\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\n  public off(eventName: string, handler?: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  /**\n   * Default [[EngineOptions]]\n   */\n  private static _DefaultEngineOptions: EngineOptions = {\n    width: 0,\n    height: 0,\n    enableCanvasTransparency: true,\n    canvasElementId: '',\n    pointerScope: Input.PointerScope.Document,\n    suppressConsoleBootMessage: null,\n    suppressMinimumBrowserFeatureDetection: null,\n    suppressHiDPIScaling: null,\n    suppressPlayButton: null,\n    scrollPreventionMode: ScrollPreventionMode.Canvas,\n    backgroundColor: Color.fromHex('#2185d0') // Excalibur blue\n  };\n\n  /**\n   * Creates a new game using the given [[EngineOptions]]. By default, if no options are provided,\n   * the game will be rendered full screen (taking up all available browser window space).\n   * You can customize the game rendering through [[EngineOptions]].\n   *\n   * Example:\n   *\n   * ```js\n   * var game = new ex.Engine({\n   *   width: 0, // the width of the canvas\n   *   height: 0, // the height of the canvas\n   *   enableCanvasTransparency: true, // the transparencySection of the canvas\n   *   canvasElementId: '', // the DOM canvas element ID, if you are providing your own\n   *   displayMode: ex.DisplayMode.FullScreen, // the display mode\n   *   pointerScope: ex.Input.PointerScope.Document, // the scope of capturing pointer (mouse/touch) events\n   *   backgroundColor: ex.Color.fromHex('#2185d0') // background color of the engine\n   * });\n   *\n   * // call game.start, which is a Promise\n   * game.start().then(function () {\n   *   // ready, set, go!\n   * });\n   * ```\n   */\n  constructor(options?: EngineOptions) {\n    super();\n\n    options = Util.extend({}, Engine._DefaultEngineOptions, options);\n\n    // Check compatibility\n    const detector = new Detector();\n    if (!options.suppressMinimumBrowserFeatureDetection && !(this._compatible = detector.test())) {\n      const message = document.createElement('div');\n      message.innerText = 'Sorry, your browser does not support all the features needed for Excalibur';\n      document.body.appendChild(message);\n\n      detector.failedTests.forEach(function(test) {\n        const testMessage = document.createElement('div');\n        testMessage.innerText = 'Browser feature missing ' + test;\n        document.body.appendChild(testMessage);\n      });\n\n      if (options.canvasElementId) {\n        const canvas = document.getElementById(options.canvasElementId);\n        if (canvas) {\n          canvas.parentElement.removeChild(canvas);\n        }\n      }\n\n      return;\n    } else {\n      this._compatible = true;\n    }\n\n    // Use native console API for color fun\n    if (console.log && !options.suppressConsoleBootMessage) {\n      console.log(\n        `%cPowered by Excalibur.js (v${EX_VERSION})`,\n        'background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;'\n      );\n      console.log('\\n\\\n      /| ________________\\n\\\nO|===|* >________________>\\n\\\n      \\\\|');\n      console.log('Visit', 'http://excaliburjs.com', 'for more information');\n    }\n\n    // Suppress play button\n    if (options.suppressPlayButton) {\n      this._suppressPlayButton = true;\n    }\n\n    this._logger = Logger.getInstance();\n\n    // If debug is enabled, let's log browser features to the console.\n    if (this._logger.defaultLevel === LogLevel.Debug) {\n      detector.logBrowserFeatures();\n    }\n\n    this._logger.debug('Building engine...');\n\n    this.canvasElementId = options.canvasElementId;\n\n    if (options.canvasElementId) {\n      this._logger.debug('Using Canvas element specified: ' + options.canvasElementId);\n      this.canvas = <HTMLCanvasElement>document.getElementById(options.canvasElementId);\n    } else {\n      this._logger.debug('Using generated canvas element');\n      this.canvas = <HTMLCanvasElement>document.createElement('canvas');\n    }\n    if (options.width && options.height) {\n      if (options.displayMode === undefined) {\n        this.displayMode = DisplayMode.Fixed;\n      }\n      this._logger.debug('Engine viewport is size ' + options.width + ' x ' + options.height);\n\n      this.canvas.width = options.width;\n      this.canvas.height = options.height;\n    } else if (!options.displayMode) {\n      this._logger.debug('Engine viewport is fullscreen');\n      this.displayMode = DisplayMode.FullScreen;\n    }\n\n    if (options.backgroundColor) {\n      this.backgroundColor = options.backgroundColor.clone();\n    }\n\n    this.enableCanvasTransparency = options.enableCanvasTransparency;\n\n    this._loader = new Loader();\n\n    this._initialize(options);\n\n    this.rootScene = this.currentScene = new Scene(this);\n\n    this.addScene('root', this.rootScene);\n    this.goToScene('root');\n  }\n\n  /**\n   * Returns a BoundingBox of the top left corner of the screen\n   * and the bottom right corner of the screen.\n   */\n  public getWorldBounds() {\n    const left = this.screenToWorldCoordinates(Vector.Zero).x;\n    const top = this.screenToWorldCoordinates(Vector.Zero).y;\n    const right = left + this.drawWidth;\n    const bottom = top + this.drawHeight;\n\n    return new BoundingBox(left, top, right, bottom);\n  }\n\n  /**\n   * Gets the current engine timescale factor (default is 1.0 which is 1:1 time)\n   */\n  public get timescale() {\n    return this._timescale;\n  }\n\n  /**\n   * Sets the current engine timescale factor. Useful for creating slow-motion effects or fast-forward effects\n   * when using time-based movement.\n   */\n  public set timescale(value: number) {\n    if (value <= 0) {\n      Logger.getInstance().error('Cannot set engine.timescale to a value of 0 or less than 0.');\n      return;\n    }\n\n    this._timescale = value;\n  }\n\n  /**\n   * Plays a sprite animation on the screen at the specified `x` and `y`\n   * (in game coordinates, not screen pixels). These animations play\n   * independent of actors, and will be cleaned up internally as soon\n   * as they are complete. Note animations that loop will never be\n   * cleaned up.\n   *\n   * @param animation  Animation to play\n   * @param x          x game coordinate to play the animation\n   * @param y          y game coordinate to play the animation\n   */\n  public playAnimation(animation: Animation, x: number, y: number) {\n    this._animations.push(new AnimationNode(animation, x, y));\n  }\n\n  /**\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\n   * will be drawn and updated.\n   */\n  public addTileMap(tileMap: TileMap) {\n    this.currentScene.addTileMap(tileMap);\n  }\n\n  /**\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\n   */\n  public removeTileMap(tileMap: TileMap) {\n    this.currentScene.removeTileMap(tileMap);\n  }\n\n  /**\n   * Adds a [[Timer]] to the [[currentScene]].\n   * @param timer  The timer to add to the [[currentScene]].\n   */\n  public addTimer(timer: Timer): Timer {\n    return this.currentScene.addTimer(timer);\n  }\n\n  /**\n   * Removes a [[Timer]] from the [[currentScene]].\n   * @param timer  The timer to remove to the [[currentScene]].\n   */\n  public removeTimer(timer: Timer): Timer {\n    return this.currentScene.removeTimer(timer);\n  }\n\n  /**\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\n   * would levels or menus.\n   *\n   * @param key  The name of the scene, must be unique\n   * @param scene The scene to add to the engine\n   */\n  public addScene(key: string, scene: Scene) {\n    if (this.scenes[key]) {\n      this._logger.warn('Scene', key, 'already exists overwriting');\n    }\n    this.scenes[key] = scene;\n  }\n\n  /**\n   * Removes a [[Scene]] instance from the engine\n   * @param scene  The scene to remove\n   */\n  public removeScene(scene: Scene): void;\n  /**\n   * Removes a scene from the engine by key\n   * @param key  The scene key to remove\n   */\n  public removeScene(key: string): void;\n  /**\n   * @internal\n   */\n  public removeScene(entity: any): void {\n    if (entity instanceof Scene) {\n      // remove scene\n      for (const key in this.scenes) {\n        if (this.scenes.hasOwnProperty(key)) {\n          if (this.scenes[key] === entity) {\n            delete this.scenes[key];\n          }\n        }\n      }\n    }\n\n    if (typeof entity === 'string') {\n      // remove scene\n      delete this.scenes[entity];\n    }\n  }\n\n  /**\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\n   * would levels or menus.\n   * @param sceneKey  The key of the scene, must be unique\n   * @param scene     The scene to add to the engine\n   */\n  public add(sceneKey: string, scene: Scene): void;\n  /**\n   * Adds a [[Timer]] to the [[currentScene]].\n   * @param timer  The timer to add to the [[currentScene]].\n   */\n  public add(timer: Timer): void;\n  /**\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\n   * will be drawn and updated.\n   */\n  public add(tileMap: TileMap): void;\n  /**\n   * Adds an actor to the [[currentScene]] of the game. This is synonymous\n   * to calling `engine.currentScene.add(actor)`.\n   *\n   * Actors can only be drawn if they are a member of a scene, and only\n   * the [[currentScene]] may be drawn or updated.\n   *\n   * @param actor  The actor to add to the [[currentScene]]\n   */\n  public add(actor: Actor): void;\n\n  /**\n   * Adds a [[UIActor]] to the [[currentScene]] of the game,\n   * UIActors do not participate in collisions, instead the\n   * remain in the same place on the screen.\n   * @param uiActor  The UIActor to add to the [[currentScene]]\n   */\n  public add(uiActor: UIActor): void;\n  public add(entity: any): void {\n    if (entity instanceof UIActor) {\n      this.currentScene.addUIActor(entity);\n      return;\n    }\n    if (entity instanceof Actor) {\n      this._addChild(entity);\n    }\n    if (entity instanceof Timer) {\n      this.addTimer(entity);\n    }\n\n    if (entity instanceof TileMap) {\n      this.addTileMap(entity);\n    }\n\n    if (arguments.length === 2) {\n      this.addScene(<string>arguments[0], <Scene>arguments[1]);\n    }\n  }\n\n  /**\n   * Removes a scene instance from the engine\n   * @param scene  The scene to remove\n   */\n  public remove(scene: Scene): void;\n  /**\n   * Removes a scene from the engine by key\n   * @param sceneKey  The scene to remove\n   */\n  public remove(sceneKey: string): void;\n  /**\n   * Removes a [[Timer]] from the [[currentScene]].\n   * @param timer  The timer to remove to the [[currentScene]].\n   */\n  public remove(timer: Timer): void;\n  /**\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\n   */\n  public remove(tileMap: TileMap): void;\n  /**\n   * Removes an actor from the [[currentScene]] of the game. This is synonymous\n   * to calling `engine.currentScene.removeChild(actor)`.\n   * Actors that are removed from a scene will no longer be drawn or updated.\n   *\n   * @param actor  The actor to remove from the [[currentScene]].\n   */\n  public remove(actor: Actor): void;\n  /**\n   * Removes a [[UIActor]] to the scene, it will no longer be drawn or updated\n   * @param uiActor  The UIActor to remove from the [[currentScene]]\n   */\n  public remove(uiActor: UIActor): void;\n  public remove(entity: any): void {\n    if (entity instanceof UIActor) {\n      this.currentScene.removeUIActor(entity);\n      return;\n    }\n    if (entity instanceof Actor) {\n      this._removeChild(entity);\n    }\n    if (entity instanceof Timer) {\n      this.removeTimer(entity);\n    }\n\n    if (entity instanceof TileMap) {\n      this.removeTileMap(entity);\n    }\n\n    if (entity instanceof Scene) {\n      this.removeScene(entity);\n    }\n\n    if (typeof entity === 'string') {\n      this.removeScene(entity);\n    }\n  }\n\n  /**\n   * Adds an actor to the [[currentScene]] of the game. This is synonymous\n   * to calling `engine.currentScene.add(actor)`.\n   *\n   * Actors can only be drawn if they are a member of a scene, and only\n   * the [[currentScene]] may be drawn or updated.\n   *\n   * @param actor  The actor to add to the [[currentScene]]\n   */\n  protected _addChild(actor: Actor) {\n    this.currentScene.add(actor);\n  }\n\n  /**\n   * Removes an actor from the [[currentScene]] of the game. This is synonymous\n   * to calling `engine.currentScene.remove(actor)`.\n   * Actors that are removed from a scene will no longer be drawn or updated.\n   *\n   * @param actor  The actor to remove from the [[currentScene]].\n   */\n  protected _removeChild(actor: Actor) {\n    this.currentScene.remove(actor);\n  }\n\n  /**\n   * Changes the currently updating and drawing scene to a different,\n   * named scene. Calls the [[Scene]] lifecycle events.\n   * @param key  The key of the scene to transition to.\n   */\n  public goToScene(key: string) {\n    if (this.scenes[key]) {\n      const oldScene = this.currentScene;\n      const newScene = this.scenes[key];\n\n      this._logger.debug('Going to scene:', key);\n\n      // only deactivate when initialized\n      if (this.currentScene.isInitialized) {\n        this.currentScene._deactivate.call(this.currentScene, [oldScene, newScene]);\n        this.currentScene.eventDispatcher.emit('deactivate', new DeactivateEvent(newScene, this.currentScene));\n      }\n\n      // set current scene to new one\n      this.currentScene = newScene;\n\n      // initialize the current scene if has not been already\n      this.currentScene._initialize(this);\n\n      this.currentScene._activate.call(this.currentScene, [oldScene, newScene]);\n      this.currentScene.eventDispatcher.emit('activate', new ActivateEvent(oldScene, this.currentScene));\n    } else {\n      this._logger.error('Scene', key, 'does not exist!');\n    }\n  }\n\n  /**\n   * Transforms the current x, y from screen coordinates to world coordinates\n   * @param point  Screen coordinate to convert\n   */\n  public screenToWorldCoordinates(point: Vector): Vector {\n    let newX = point.x;\n    let newY = point.y;\n\n    // transform back to world space\n    newX = (newX / this.canvas.clientWidth) * this.drawWidth;\n    newY = (newY / this.canvas.clientHeight) * this.drawHeight;\n\n    // transform based on zoom\n    newX = newX - this.halfDrawWidth;\n    newY = newY - this.halfDrawHeight;\n\n    // shift by focus\n    if (this.currentScene && this.currentScene.camera) {\n      const focus = this.currentScene.camera.getFocus();\n      newX += focus.x;\n      newY += focus.y;\n    }\n\n    return new Vector(Math.floor(newX), Math.floor(newY));\n  }\n\n  /**\n   * Transforms a world coordinate, to a screen coordinate\n   * @param point  World coordinate to convert\n   */\n  public worldToScreenCoordinates(point: Vector): Vector {\n    let screenX = point.x;\n    let screenY = point.y;\n\n    // shift by focus\n    if (this.currentScene && this.currentScene.camera) {\n      const focus = this.currentScene.camera.getFocus();\n      screenX -= focus.x;\n      screenY -= focus.y;\n    }\n\n    // transform back on zoom\n    screenX = screenX + this.halfDrawWidth;\n    screenY = screenY + this.halfDrawHeight;\n\n    // transform back to screen space\n    screenX = (screenX * this.canvas.clientWidth) / this.drawWidth;\n    screenY = (screenY * this.canvas.clientHeight) / this.drawHeight;\n\n    return new Vector(Math.floor(screenX), Math.floor(screenY));\n  }\n\n  /**\n   * Sets the internal canvas height based on the selected display mode.\n   */\n  private _setHeightByDisplayMode(parent: HTMLElement | Window) {\n    if (this.displayMode === DisplayMode.Container) {\n      this.canvas.width = (<HTMLElement>parent).clientWidth;\n      this.canvas.height = (<HTMLElement>parent).clientHeight;\n    }\n\n    if (this.displayMode === DisplayMode.FullScreen) {\n      document.body.style.margin = '0px';\n      document.body.style.overflow = 'hidden';\n      this.canvas.width = (<Window>parent).innerWidth;\n      this.canvas.height = (<Window>parent).innerHeight;\n    }\n  }\n\n  /**\n   * Initializes the internal canvas, rendering context, displaymode, and native event listeners\n   */\n  private _initialize(options?: EngineOptions) {\n    if (options.displayMode) {\n      this.displayMode = options.displayMode;\n    }\n\n    if (this.displayMode === DisplayMode.FullScreen || this.displayMode === DisplayMode.Container) {\n      const parent = <any>(this.displayMode === DisplayMode.Container ? <any>(this.canvas.parentElement || document.body) : <any>window);\n\n      this._setHeightByDisplayMode(parent);\n\n      window.addEventListener('resize', () => {\n        this._logger.debug('View port resized');\n        this._setHeightByDisplayMode(parent);\n        this._logger.info('parent.clientHeight ' + parent.clientHeight);\n        this.setAntialiasing(this._isSmoothingEnabled);\n      });\n    } else if (this.displayMode === DisplayMode.Position) {\n      this._intializeDisplayModePosition(options);\n    }\n\n    // initialize inputs\n    this.input = {\n      keyboard: new Input.Keyboard(),\n      pointers: new Input.Pointers(this),\n      gamepads: new Input.Gamepads()\n    };\n    this.input.keyboard.init();\n    this.input.pointers.init(options && options.pointerScope === Input.PointerScope.Document ? document : this.canvas);\n    this.input.gamepads.init();\n\n    this.pageScrollPreventionMode = options.scrollPreventionMode;\n\n    // Issue #385 make use of the visibility api\n    // https://developer.mozilla.org/en-US/docs/Web/Guide/User_experience/Using_the_Page_Visibility_API\n\n    let hidden: keyof HTMLDocument, visibilityChange: string;\n    if (typeof document.hidden !== 'undefined') {\n      // Opera 12.10 and Firefox 18 and later support\n      hidden = 'hidden';\n      visibilityChange = 'visibilitychange';\n    } else if ('msHidden' in document) {\n      hidden = <keyof HTMLDocument>'msHidden';\n      visibilityChange = 'msvisibilitychange';\n    } else if ('webkitHidden' in document) {\n      hidden = <keyof HTMLDocument>'webkitHidden';\n      visibilityChange = 'webkitvisibilitychange';\n    }\n\n    document.addEventListener(visibilityChange, () => {\n      if (document[hidden]) {\n        this.eventDispatcher.emit('hidden', new HiddenEvent(this));\n        this._logger.debug('Window hidden');\n      } else {\n        this.eventDispatcher.emit('visible', new VisibleEvent(this));\n        this._logger.debug('Window visible');\n      }\n    });\n\n    this.ctx = <CanvasRenderingContext2D>this.canvas.getContext('2d', { alpha: this.enableCanvasTransparency });\n\n    this._suppressHiDPIScaling = !!options.suppressHiDPIScaling;\n    if (!options.suppressHiDPIScaling) {\n      this._initializeHiDpi();\n    }\n\n    if (!this.canvasElementId) {\n      document.body.appendChild(this.canvas);\n    }\n  }\n\n  public onInitialize(_engine: Engine) {\n    // Override me\n  }\n\n  private _intializeDisplayModePosition(options: EngineOptions) {\n    if (!options.position) {\n      throw new Error('DisplayMode of Position was selected but no position option was given');\n    } else {\n      this.canvas.style.display = 'block';\n      this.canvas.style.position = 'absolute';\n\n      if (typeof options.position === 'string') {\n        const specifiedPosition = options.position.split(' ');\n\n        switch (specifiedPosition[0]) {\n          case 'top':\n            this.canvas.style.top = '0px';\n            break;\n          case 'bottom':\n            this.canvas.style.bottom = '0px';\n            break;\n          case 'middle':\n            this.canvas.style.top = '50%';\n            const offsetY = -this.halfDrawHeight;\n            this.canvas.style.marginTop = offsetY.toString();\n            break;\n          default:\n            throw new Error('Invalid Position Given');\n        }\n\n        if (specifiedPosition[1]) {\n          switch (specifiedPosition[1]) {\n            case 'left':\n              this.canvas.style.left = '0px';\n              break;\n            case 'right':\n              this.canvas.style.right = '0px';\n              break;\n            case 'center':\n              this.canvas.style.left = '50%';\n              const offsetX = -this.halfDrawWidth;\n              this.canvas.style.marginLeft = offsetX.toString();\n              break;\n            default:\n              throw new Error('Invalid Position Given');\n          }\n        }\n      } else {\n        if (options.position.top) {\n          typeof options.position.top === 'number'\n            ? (this.canvas.style.top = options.position.top.toString() + 'px')\n            : (this.canvas.style.top = options.position.top);\n        }\n        if (options.position.right) {\n          typeof options.position.right === 'number'\n            ? (this.canvas.style.right = options.position.right.toString() + 'px')\n            : (this.canvas.style.right = options.position.right);\n        }\n        if (options.position.bottom) {\n          typeof options.position.bottom === 'number'\n            ? (this.canvas.style.bottom = options.position.bottom.toString() + 'px')\n            : (this.canvas.style.bottom = options.position.bottom);\n        }\n        if (options.position.left) {\n          typeof options.position.left === 'number'\n            ? (this.canvas.style.left = options.position.left.toString() + 'px')\n            : (this.canvas.style.left = options.position.left);\n        }\n      }\n    }\n  }\n\n  private _initializeHiDpi() {\n    // Scale the canvas if needed\n    if (this.isHiDpi) {\n      const oldWidth = this.canvas.width;\n      const oldHeight = this.canvas.height;\n\n      this.canvas.width = oldWidth * this.pixelRatio;\n      this.canvas.height = oldHeight * this.pixelRatio;\n\n      this.canvas.style.width = oldWidth + 'px';\n      this.canvas.style.height = oldHeight + 'px';\n\n      this._logger.warn(`Hi DPI screen detected, resetting canvas resolution from \n                           ${oldWidth}x${oldHeight} to ${this.canvas.width}x${this.canvas.height} \n                           css size will remain ${oldWidth}x${oldHeight}`);\n\n      this.ctx.scale(this.pixelRatio, this.pixelRatio);\n      this._logger.warn(`Canvas drawing context was scaled by ${this.pixelRatio}`);\n    }\n  }\n\n  /**\n   * If supported by the browser, this will set the antialiasing flag on the\n   * canvas. Set this to `false` if you want a 'jagged' pixel art look to your\n   * image resources.\n   * @param isSmooth  Set smoothing to true or false\n   */\n  public setAntialiasing(isSmooth: boolean) {\n    this._isSmoothingEnabled = isSmooth;\n\n    const ctx: any = this.ctx;\n    ctx.imageSmoothingEnabled = isSmooth;\n    for (const smoothing of ['webkitImageSmoothingEnabled', 'mozImageSmoothingEnabled', 'msImageSmoothingEnabled']) {\n      if (smoothing in ctx) {\n        ctx[smoothing] = isSmooth;\n      }\n    }\n  }\n\n  /**\n   * Return the current smoothing status of the canvas\n   */\n  public getAntialiasing(): boolean {\n    return (\n      (<any>this.ctx).imageSmoothingEnabled ||\n      (<any>this.ctx).webkitImageSmoothingEnabled ||\n      (<any>this.ctx).mozImageSmoothingEnabled ||\n      (<any>this.ctx).msImageSmoothingEnabled\n    );\n  }\n\n  /**\n   * Gets whether the actor is Initialized\n   */\n  public get isInitialized(): boolean {\n    return this._isInitialized;\n  }\n\n  private _overrideInitialize(engine: Engine) {\n    if (!this.isInitialized) {\n      this.onInitialize(engine);\n      super.emit('initialize', new InitializeEvent(engine, this));\n      this._isInitialized = true;\n    }\n  }\n\n  /**\n   * Updates the entire state of the game\n   * @param delta  Number of milliseconds elapsed since the last update.\n   */\n  private _update(delta: number) {\n    if (this._isLoading) {\n      // suspend updates untill loading is finished\n      this._loader.update(this, delta);\n      // Update input listeners\n      this.input.keyboard.update();\n      this.input.pointers.update();\n      this.input.gamepads.update();\n      return;\n    }\n    this._overrideInitialize(this);\n    // Publish preupdate events\n    this._preupdate(delta);\n\n    // process engine level events\n    this.currentScene.update(this, delta);\n\n    // update animations\n    this._animations = this._animations.filter(function(a) {\n      return !a.animation.isDone();\n    });\n\n    // Update input listeners\n    this.input.keyboard.update();\n    this.input.pointers.update();\n    this.input.gamepads.update();\n\n    // Publish update event\n    this._postupdate(delta);\n  }\n\n  /**\n   * @internal\n   */\n  public _preupdate(delta: number) {\n    this.emit('preupdate', new PreUpdateEvent(this, delta, this));\n    this.onPreUpdate(this, delta);\n  }\n\n  public onPreUpdate(_engine: Engine, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * @internal\n   */\n  public _postupdate(delta: number) {\n    this.emit('postupdate', new PostUpdateEvent(this, delta, this));\n    this.onPostUpdate(this, delta);\n  }\n\n  public onPostUpdate(_engine: Engine, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * Draws the entire game\n   * @param delta  Number of milliseconds elapsed since the last draw.\n   */\n  private _draw(delta: number) {\n    const ctx = this.ctx;\n    this._predraw(ctx, delta);\n\n    if (this._isLoading) {\n      this._loader.draw(ctx, delta);\n      // Drawing nothing else while loading\n      return;\n    }\n\n    ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight);\n    ctx.fillStyle = this.backgroundColor.toString();\n    ctx.fillRect(0, 0, this.canvasWidth, this.canvasHeight);\n\n    this.currentScene.draw(this.ctx, delta);\n\n    // todo needs to be a better way of doing this\n    let a = 0;\n    const len = this._animations.length;\n    for (a; a < len; a++) {\n      this._animations[a].animation.draw(ctx, this._animations[a].x, this._animations[a].y);\n    }\n\n    // Draw debug information\n    if (this.isDebug) {\n      this.ctx.font = 'Consolas';\n      this.ctx.fillStyle = this.debugColor.toString();\n      const keys = this.input.keyboard.getKeys();\n      for (let j = 0; j < keys.length; j++) {\n        this.ctx.fillText(keys[j].toString() + ' : ' + (Input.Keys[keys[j]] ? Input.Keys[keys[j]] : 'Not Mapped'), 100, 10 * j + 10);\n      }\n\n      this.ctx.fillText('FPS:' + this.stats.currFrame.fps.toFixed(2).toString(), 10, 10);\n    }\n\n    // Post processing\n    for (let i = 0; i < this.postProcessors.length; i++) {\n      this.postProcessors[i].process(this.ctx.getImageData(0, 0, this.canvasWidth, this.canvasHeight), this.ctx);\n    }\n\n    this._postdraw(ctx, delta);\n  }\n\n  /**\n   * @internal\n   */\n  public _predraw(_ctx: CanvasRenderingContext2D, delta: number) {\n    this.emit('predraw', new PreDrawEvent(_ctx, delta, this));\n    this.onPreDraw(_ctx, delta);\n  }\n\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * @internal\n   */\n  public _postdraw(_ctx: CanvasRenderingContext2D, delta: number) {\n    this.emit('postdraw', new PostDrawEvent(_ctx, delta, this));\n    this.onPostDraw(_ctx, delta);\n  }\n\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * Starts the internal game loop for Excalibur after loading\n   * any provided assets.\n   * @param loader  Optional [[ILoader]] to use to load resources. The default loader is [[Loader]], override to provide your own\n   * custom loader.\n   */\n  public start(loader?: CanLoad): Promise<any> {\n    if (!this._compatible) {\n      const promise = new Promise();\n      return promise.reject('Excalibur is incompatible with your browser');\n    }\n\n    let loadingComplete: Promise<any>;\n    if (loader) {\n      this._loader = loader;\n      this._loader.suppressPlayButton = this._suppressPlayButton || this._loader.suppressPlayButton;\n      this._loader.wireEngine(this);\n      loadingComplete = this.load(this._loader);\n    } else {\n      loadingComplete = Promise.resolve();\n    }\n\n    loadingComplete.then(() => {\n      this.emit('start', new GameStartEvent(this));\n    });\n\n    if (!this._hasStarted) {\n      this._hasStarted = true;\n      this._logger.debug('Starting game...');\n\n      Engine.createMainLoop(this, window.requestAnimationFrame, Date.now)();\n\n      this._logger.debug('Game started');\n    } else {\n      // Game already started;\n    }\n    return loadingComplete;\n  }\n\n  public static createMainLoop(game: Engine, raf: (func: Function) => number, nowFn: () => number) {\n    let lastTime = nowFn();\n\n    return function mainloop() {\n      if (!game._hasStarted) {\n        return;\n      }\n      try {\n        game._requestId = raf(mainloop);\n        game.emit('preframe', new PreFrameEvent(game, game.stats.prevFrame));\n\n        // Get the time to calculate time-elapsed\n        const now = nowFn();\n        let elapsed = Math.floor(now - lastTime) || 1;\n        // Resolves issue #138 if the game has been paused, or blurred for\n        // more than a 200 milliseconds, reset elapsed time to 1. This improves reliability\n        // and provides more expected behavior when the engine comes back\n        // into focus\n        if (elapsed > 200) {\n          elapsed = 1;\n        }\n        const delta = elapsed * game.timescale;\n\n        // reset frame stats (reuse existing instances)\n        const frameId = game.stats.prevFrame.id + 1;\n        game.stats.prevFrame.reset(game.stats.currFrame);\n        game.stats.currFrame.reset();\n        game.stats.currFrame.id = frameId;\n        game.stats.currFrame.delta = delta;\n        game.stats.currFrame.fps = 1.0 / (delta / 1000);\n\n        const beforeUpdate = nowFn();\n        game._update(delta);\n        const afterUpdate = nowFn();\n        game._draw(delta);\n        const afterDraw = nowFn();\n\n        game.stats.currFrame.duration.update = afterUpdate - beforeUpdate;\n        game.stats.currFrame.duration.draw = afterDraw - afterUpdate;\n\n        lastTime = now;\n\n        game.emit('postframe', new PostFrameEvent(game, game.stats.currFrame));\n      } catch (e) {\n        window.cancelAnimationFrame(game._requestId);\n        game.stop();\n        game.onFatalException(e);\n      }\n    };\n  }\n\n  /**\n   * Stops Excalibur's main loop, useful for pausing the game.\n   */\n  public stop() {\n    if (this._hasStarted) {\n      this.emit('stop', new GameStopEvent(this));\n      this._hasStarted = false;\n      this._logger.debug('Game stopped');\n    }\n  }\n\n  /**\n   * Returns the Engine's Running status, Useful for checking whether engine is running or paused.\n   */\n  public isPaused(): boolean {\n    return !this._hasStarted;\n  }\n\n  /**\n   * Takes a screen shot of the current viewport and returns it as an\n   * HTML Image Element.\n   */\n  public screenshot(): HTMLImageElement {\n    const result = new Image();\n    const raw = this.canvas.toDataURL('image/png');\n    result.src = raw;\n    return result;\n  }\n\n  /**\n   * Another option available to you to load resources into the game.\n   * Immediately after calling this the game will pause and the loading screen\n   * will appear.\n   * @param loader  Some [[ILoadable]] such as a [[Loader]] collection, [[Sound]], or [[Texture]].\n   */\n  public load(loader: Loadable): Promise<any> {\n    const complete = new Promise<any>();\n\n    this._isLoading = true;\n\n    loader.load().then(() => {\n      if (this._suppressPlayButton) {\n        setTimeout(() => {\n          this._isLoading = false;\n          complete.resolve();\n          // Delay is to give the logo a chance to show, otherwise don't delay\n        }, 500);\n      } else {\n        this._isLoading = false;\n        complete.resolve();\n      }\n    });\n\n    return complete;\n  }\n}\n\n/**\n * @internal\n */\nclass AnimationNode {\n  constructor(public animation: Animation, public x: number, public y: number) {}\n}\n","import { Engine } from './Engine';\nimport { Actor } from './Actor';\nimport { Sprite } from './Drawing/Sprite';\nimport { Color } from './Drawing/Color';\nimport { Vector } from './Algebra';\nimport * as Util from './Util/Util';\nimport * as DrawUtil from './Util/DrawUtil';\nimport * as Traits from './Traits/Index';\nimport { Configurable } from './Configurable';\nimport { Random } from './Math/Random';\nimport { CollisionType } from './Collision/CollisionType';\n\n/**\n * An enum that represents the types of emitter nozzles\n */\nexport enum EmitterType {\n  /**\n   * Constant for the circular emitter type\n   */\n  Circle,\n  /**\n   * Constant for the rectangular emitter type\n   */\n  Rectangle\n}\n\n/**\n * @hidden\n */\nexport class ParticleImpl {\n  public position: Vector = new Vector(0, 0);\n  public velocity: Vector = new Vector(0, 0);\n  public acceleration: Vector = new Vector(0, 0);\n  public particleRotationalVelocity: number = 0;\n  public currentRotation: number = 0;\n\n  public focus: Vector = null;\n  public focusAccel: number = 0;\n  public opacity: number = 1;\n  public beginColor: Color = Color.White;\n  public endColor: Color = Color.White;\n\n  // Life is counted in ms\n  public life: number = 300;\n  public fadeFlag: boolean = false;\n\n  // Color transitions\n  private _rRate: number = 1;\n  private _gRate: number = 1;\n  private _bRate: number = 1;\n  private _aRate: number = 0;\n  private _currentColor: Color = Color.White;\n\n  public emitter: ParticleEmitter = null;\n  public particleSize: number = 5;\n  public particleSprite: Sprite = null;\n\n  public startSize: number;\n  public endSize: number;\n  public sizeRate: number = 0;\n  public elapsedMultiplier: number = 0;\n\n  constructor(\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  ) {\n    let emitter = emitterOrConfig;\n    if (emitter && !(emitterOrConfig instanceof ParticleEmitter)) {\n      const config = emitterOrConfig;\n      emitter = config.emitter;\n      life = config.life;\n      opacity = config.opacity;\n      endColor = config.endColor;\n      beginColor = config.beginColor;\n      position = config.position;\n      velocity = config.velocity;\n      acceleration = config.acceleration;\n      startSize = config.startSize;\n      endSize = config.endSize;\n    }\n    this.emitter = <ParticleEmitter>emitter;\n    this.life = life || this.life;\n    this.opacity = opacity || this.opacity;\n    this.endColor = endColor || this.endColor.clone();\n    this.beginColor = beginColor || this.beginColor.clone();\n    this._currentColor = this.beginColor.clone();\n    this.position = position || this.position;\n    this.velocity = velocity || this.velocity;\n    this.acceleration = acceleration || this.acceleration;\n    this._rRate = (this.endColor.r - this.beginColor.r) / this.life;\n    this._gRate = (this.endColor.g - this.beginColor.g) / this.life;\n    this._bRate = (this.endColor.b - this.beginColor.b) / this.life;\n    this._aRate = this.opacity / this.life;\n\n    this.startSize = startSize || 0;\n    this.endSize = endSize || 0;\n\n    if (this.endSize > 0 && this.startSize > 0) {\n      this.sizeRate = (this.endSize - this.startSize) / this.life;\n      this.particleSize = this.startSize;\n    }\n  }\n\n  public kill() {\n    this.emitter.removeParticle(this);\n  }\n\n  public update(delta: number) {\n    this.life = this.life - delta;\n    this.elapsedMultiplier = this.elapsedMultiplier + delta;\n\n    if (this.life < 0) {\n      this.kill();\n    }\n\n    if (this.fadeFlag) {\n      this.opacity = Util.clamp(this._aRate * this.life, 0.0001, 1);\n    }\n\n    if (this.startSize > 0 && this.endSize > 0) {\n      this.particleSize = Util.clamp(\n        this.sizeRate * delta + this.particleSize,\n        Math.min(this.startSize, this.endSize),\n        Math.max(this.startSize, this.endSize)\n      );\n    }\n\n    this._currentColor.r = Util.clamp(this._currentColor.r + this._rRate * delta, 0, 255);\n    this._currentColor.g = Util.clamp(this._currentColor.g + this._gRate * delta, 0, 255);\n    this._currentColor.b = Util.clamp(this._currentColor.b + this._bRate * delta, 0, 255);\n    this._currentColor.a = Util.clamp(this.opacity, 0.0001, 1);\n\n    if (this.focus) {\n      const accel = this.focus\n        .sub(this.position)\n        .normalize()\n        .scale(this.focusAccel)\n        .scale(delta / 1000);\n      this.velocity = this.velocity.add(accel);\n    } else {\n      this.velocity = this.velocity.add(this.acceleration.scale(delta / 1000));\n    }\n    this.position = this.position.add(this.velocity.scale(delta / 1000));\n\n    if (this.particleRotationalVelocity) {\n      this.currentRotation = (this.currentRotation + (this.particleRotationalVelocity * delta) / 1000) % (2 * Math.PI);\n    }\n  }\n\n  public draw(ctx: CanvasRenderingContext2D) {\n    if (this.particleSprite) {\n      this.particleSprite.rotation = this.currentRotation;\n      this.particleSprite.scale.setTo(this.particleSize, this.particleSize);\n      this.particleSprite.draw(ctx, this.position.x, this.position.y);\n      return;\n    }\n\n    this._currentColor.a = Util.clamp(this.opacity, 0.0001, 1);\n    ctx.fillStyle = this._currentColor.toString();\n    ctx.beginPath();\n    ctx.arc(this.position.x, this.position.y, this.particleSize, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.closePath();\n  }\n}\n\n/**\n * [[include:Constructors.md]]\n */\nexport interface ParticleArgs extends Partial<ParticleImpl> {\n  emitter: ParticleEmitter;\n  position?: Vector;\n  velocity?: Vector;\n  acceleration?: Vector;\n  particleRotationalVelocity?: number;\n  currentRotation?: number;\n  particleSize?: number;\n  particleSprite?: Sprite;\n}\n\n/**\n * Particle is used in a [[ParticleEmitter]]\n */\nexport class Particle extends Configurable(ParticleImpl) {\n  constructor(config: ParticleArgs);\n  constructor(\n    emitter: ParticleEmitter,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  );\n  constructor(\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  ) {\n    super(emitterOrConfig, life, opacity, beginColor, endColor, position, velocity, acceleration, startSize, endSize);\n  }\n}\n\n/**\n * @hidden\n */\nexport class ParticleEmitterImpl extends Actor {\n  private _particlesToEmit: number;\n\n  public numParticles: number = 0;\n\n  /**\n   * Random number generator\n   */\n  public random: Random;\n\n  /**\n   * Gets or sets the isEmitting flag\n   */\n  public isEmitting: boolean = true;\n  /**\n   * Gets or sets the backing particle collection\n   */\n  public particles: Util.Collection<Particle> = null;\n\n  /**\n   * Gets or sets the backing deadParticle collection\n   */\n  public deadParticles: Util.Collection<Particle> = null;\n\n  /**\n   * Gets or sets the minimum particle velocity\n   */\n  public minVel: number = 0;\n  /**\n   * Gets or sets the maximum particle velocity\n   */\n  public maxVel: number = 0;\n\n  /**\n   * Gets or sets the acceleration vector for all particles\n   */\n  public acceleration: Vector = new Vector(0, 0);\n\n  /**\n   * Gets or sets the minimum angle in radians\n   */\n  public minAngle: number = 0;\n  /**\n   * Gets or sets the maximum angle in radians\n   */\n  public maxAngle: number = 0;\n\n  /**\n   * Gets or sets the emission rate for particles (particles/sec)\n   */\n  public emitRate: number = 1; //particles/sec\n  /**\n   * Gets or sets the life of each particle in milliseconds\n   */\n  public particleLife: number = 2000;\n  /**\n   * Gets or sets the opacity of each particle from 0 to 1.0\n   */\n  public opacity: number = 1;\n  /**\n   * Gets or sets the fade flag which causes particles to gradually fade out over the course of their life.\n   */\n  public fadeFlag: boolean = false;\n\n  /**\n   * Gets or sets the optional focus where all particles should accelerate towards\n   */\n  public focus: Vector = null;\n  /**\n   * Gets or sets the acceleration for focusing particles if a focus has been specified\n   */\n  public focusAccel: number = 1;\n  /*\n    * Gets or sets the optional starting size for the particles\n    */\n  public startSize: number = null;\n  /*\n    * Gets or sets the optional ending size for the particles\n    */\n  public endSize: number = null;\n\n  /**\n   * Gets or sets the minimum size of all particles\n   */\n  public minSize: number = 5;\n  /**\n   * Gets or sets the maximum size of all particles\n   */\n  public maxSize: number = 5;\n\n  /**\n   * Gets or sets the beginning color of all particles\n   */\n  public beginColor: Color = Color.White;\n  /**\n   * Gets or sets the ending color of all particles\n   */\n  public endColor: Color = Color.White;\n\n  /**\n   * Gets or sets the sprite that a particle should use\n   * @warning Performance intensive\n   */\n  public particleSprite: Sprite = null;\n\n  /**\n   * Gets or sets the emitter type for the particle emitter\n   */\n  public emitterType: EmitterType = EmitterType.Rectangle;\n\n  /**\n   * Gets or sets the emitter radius, only takes effect when the [[emitterType]] is [[EmitterType.Circle]]\n   */\n  public radius: number = 0;\n\n  /**\n   * Gets or sets the particle rotational speed velocity\n   */\n  public particleRotationalVelocity: number = 0;\n\n  /**\n   * Indicates whether particles should start with a random rotation\n   */\n  public randomRotation: boolean = false;\n\n  /**\n   * @param x       The x position of the emitter\n   * @param y       The y position of the emitter\n   * @param width   The width of the emitter\n   * @param height  The height of the emitter\n   */\n  constructor(xOrConfig?: number | ParticleEmitterArgs, y?: number, width?: number, height?: number) {\n    super(typeof xOrConfig === 'number' ? { x: xOrConfig, y: y, width: width, height: height } : xOrConfig);\n    this._particlesToEmit = 0;\n    this.body.collider.type = CollisionType.PreventCollision;\n    this.particles = new Util.Collection<Particle>();\n    this.deadParticles = new Util.Collection<Particle>();\n    this.random = new Random();\n\n    // Remove offscreen culling from particle emitters\n    for (let i = 0; i < this.traits.length; i++) {\n      if (this.traits[i] instanceof Traits.OffscreenCulling) {\n        this.traits.splice(i, 1);\n      }\n    }\n  }\n\n  public removeParticle(particle: Particle) {\n    this.deadParticles.push(particle);\n  }\n\n  /**\n   * Causes the emitter to emit particles\n   * @param particleCount  Number of particles to emit right now\n   */\n  public emitParticles(particleCount: number) {\n    for (let i = 0; i < particleCount; i++) {\n      this.particles.push(this._createParticle());\n    }\n  }\n\n  public clearParticles() {\n    this.particles.clear();\n  }\n\n  // Creates a new particle given the constraints of the emitter\n  private _createParticle(): Particle {\n    // todo implement emitter constraints;\n    let ranX = 0;\n    let ranY = 0;\n\n    const angle = Util.randomInRange(this.minAngle, this.maxAngle, this.random);\n    const vel = Util.randomInRange(this.minVel, this.maxVel, this.random);\n    const size = this.startSize || Util.randomInRange(this.minSize, this.maxSize, this.random);\n    const dx = vel * Math.cos(angle);\n    const dy = vel * Math.sin(angle);\n\n    if (this.emitterType === EmitterType.Rectangle) {\n      ranX = Util.randomInRange(this.pos.x, this.pos.x + this.width, this.random);\n      ranY = Util.randomInRange(this.pos.y, this.pos.y + this.height, this.random);\n    } else if (this.emitterType === EmitterType.Circle) {\n      const radius = Util.randomInRange(0, this.radius, this.random);\n      ranX = radius * Math.cos(angle) + this.pos.x;\n      ranY = radius * Math.sin(angle) + this.pos.y;\n    }\n\n    const p = new Particle(\n      this,\n      this.particleLife,\n      this.opacity,\n      this.beginColor,\n      this.endColor,\n      new Vector(ranX, ranY),\n      new Vector(dx, dy),\n      this.acceleration,\n      this.startSize,\n      this.endSize\n    );\n    p.fadeFlag = this.fadeFlag;\n    p.particleSize = size;\n    if (this.particleSprite) {\n      p.particleSprite = this.particleSprite;\n    }\n    p.particleRotationalVelocity = this.particleRotationalVelocity;\n    if (this.randomRotation) {\n      p.currentRotation = Util.randomInRange(0, Math.PI * 2, this.random);\n    }\n    if (this.focus) {\n      p.focus = this.focus.add(new Vector(this.pos.x, this.pos.y));\n      p.focusAccel = this.focusAccel;\n    }\n    return p;\n  }\n\n  public update(engine: Engine, delta: number) {\n    super.update(engine, delta);\n\n    if (this.isEmitting) {\n      this._particlesToEmit += this.emitRate * (delta / 1000);\n      //var numParticles = Math.ceil(this.emitRate * delta / 1000);\n      if (this._particlesToEmit > 1.0) {\n        this.emitParticles(Math.floor(this._particlesToEmit));\n        this._particlesToEmit = this._particlesToEmit - Math.floor(this._particlesToEmit);\n      }\n    }\n\n    this.particles.forEach((p) => p.update(delta));\n    this.deadParticles.forEach((p) => this.particles.removeElement(p));\n    this.deadParticles.clear();\n  }\n\n  public draw(ctx: CanvasRenderingContext2D) {\n    // todo is there a more efficient to draw\n    // possibly use a webgl offscreen canvas and shaders to do particles?\n    this.particles.forEach((p) => p.draw(ctx));\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    super.debugDraw(ctx);\n    ctx.fillStyle = Color.Black.toString();\n    ctx.fillText('Particles: ' + this.particles.count(), this.pos.x, this.pos.y + 20);\n\n    if (this.focus) {\n      ctx.fillRect(this.focus.x + this.pos.x, this.focus.y + this.pos.y, 3, 3);\n      DrawUtil.line(ctx, Color.Yellow, this.focus.x + this.pos.x, this.focus.y + this.pos.y, this.center.x, this.center.y);\n      ctx.fillText('Focus', this.focus.x + this.pos.x, this.focus.y + this.pos.y);\n    }\n  }\n}\n\n/**\n * [[include:Constructors.md]]\n */\nexport interface ParticleEmitterArgs extends Partial<ParticleEmitterImpl> {\n  width?: number;\n  height?: number;\n  isEmitting?: boolean;\n  minVel?: number;\n  maxVel?: number;\n  acceleration?: Vector;\n  minAngle?: number;\n  maxAngle?: number;\n  emitRate?: number;\n  particleLife?: number;\n  opacity?: number;\n  fadeFlag?: boolean;\n  focus?: Vector;\n  focusAccel?: number;\n  startSize?: number;\n  endSize?: number;\n  minSize?: number;\n  maxSize?: number;\n  beginColor?: Color;\n  endColor?: Color;\n  particleSprite?: Sprite;\n  emitterType?: EmitterType;\n  radius?: number;\n  particleRotationalVelocity?: number;\n  randomRotation?: boolean;\n  random?: Random;\n}\n\n/**\n * Using a particle emitter is a great way to create interesting effects\n * in your game, like smoke, fire, water, explosions, etc. `ParticleEmitter`\n * extend [[Actor]] allowing you to use all of the features that come with.\n *\n * [[include:Particles.md]]\n */\nexport class ParticleEmitter extends Configurable(ParticleEmitterImpl) {\n  constructor(config?: ParticleEmitterArgs);\n  constructor(x?: number | ParticleEmitterArgs, y?: number, width?: number, height?: number);\n  constructor(xOrConfig?: number | ParticleEmitterArgs, y?: number, width?: number, height?: number) {\n    super(xOrConfig, y, width, height);\n  }\n}\n","import { GameEvent } from '../Events';\nimport { Sound } from '../Resources/Sound/Sound';\nimport { Actor } from '../Actor';\nimport { AudioInstance } from '../Resources/Sound/AudioInstance';\n\nexport class MediaEvent extends GameEvent<Sound> {\n  /**\n   * Media event cannot bubble\n   */\n  public set bubbles(_value: boolean) {\n    // stubbed\n  }\n  /**\n   * Media event cannot bubble\n   */\n  public get bubbles(): boolean {\n    return false;\n  }\n  /**\n   * Media event cannot bubble, so they have no path\n   */\n  protected get _path(): Actor[] {\n    return null;\n  }\n  /**\n   * Media event cannot bubble, so they have no path\n   */\n  protected set _path(_val: Actor[]) {\n    // stubbed\n  }\n\n  constructor(public target: Sound, protected _name: string = 'MediaEvent') {\n    super();\n  }\n\n  /**\n   * Prevents event from bubbling\n   */\n  public stopPropagation(): void {\n    /**\n     * Stub\n     */\n  }\n  /**\n   * Action, that calls when event happens\n   */\n  public action(): void {\n    /**\n     * Stub\n     */\n  }\n  /**\n   * Propagate event further through event path\n   */\n  public propagate(): void {\n    /**\n     * Stub\n     */\n  }\n\n  public layPath(_actor: Actor): void {\n    /**\n     * Stub\n     */\n  }\n}\n\nexport class NativeSoundEvent extends MediaEvent {\n  constructor(target: Sound, public track?: AudioInstance) {\n    super(target, 'NativeSoundEvent');\n  }\n}\n","export * from './ActionContext';\nexport * from './Actionable';\nexport * from './RotationType';\n\nimport * as actions from './Action';\nexport { actions as Actions };\n\n// legacy Internal.Actions namespace support\nexport const Internal = { Actions: actions };\n","import { CollisionGroup } from './CollisionGroup';\n\n/**\n * Static class for managing collision groups in excalibur, there is a maximum of 32 collision groups possible in excalibur\n */\nexport class CollisionGroupManager {\n  // using bitmasking the maximum number of groups is 32, because that is the heighest 32bit integer that JS can present.\n  private static _STARTING_BIT = 0b1 | 0;\n  private static _MAX_GROUPS = 32;\n  private static _currentGroup = 1;\n  private static _currentBit = CollisionGroupManager._STARTING_BIT;\n  private static _groups: Map<string, CollisionGroup> = new Map<string, CollisionGroup>();\n\n  /**\n   * Create a new named collision group up to a max of 32.\n   * @param name Name for the collision group\n   * @param mask Optionally provide your own 32-bit mask, if none is provide the manager will generate one\n   */\n  public static create(name: string, mask?: number) {\n    if (this._currentGroup > this._MAX_GROUPS) {\n      throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);\n    }\n    if (this._groups.get(name)) {\n      throw new Error(`Collision group ${name} already exists`);\n    }\n    const group = new CollisionGroup(name, this._currentBit, mask !== undefined ? mask : ~this._currentBit);\n    this._currentBit = (this._currentBit << 1) | 0;\n    this._currentGroup++;\n    this._groups.set(name, group);\n    return group;\n  }\n\n  /**\n   * Get all collision groups currently tracked by excalibur\n   */\n  public static get groups(): CollisionGroup[] {\n    return Array.from(this._groups.values());\n  }\n\n  /**\n   * Get a collision group by it's name\n   * @param name\n   */\n  public static groupByName(name: string) {\n    return this._groups.get(name);\n  }\n\n  /**\n   * Resets the managers internal group management state\n   */\n  public static reset() {\n    this._groups = new Map<string, CollisionGroup>();\n    this._currentBit = this._STARTING_BIT;\n    this._currentGroup = 1;\n  }\n}\n","import { Sprite } from './Sprite';\nimport { AnimationArgs } from '../Drawing/Animation';\nimport * as Effects from './SpriteEffects';\nimport { Color } from './Color';\n\nimport { Drawable } from '../Interfaces/Drawable';\nimport { Vector } from '../Algebra';\nimport { Engine } from '../Engine';\nimport * as Util from '../Util/Util';\nimport { Configurable } from '../Configurable';\n\n/**\n * @hidden\n */\nexport class AnimationImpl implements Drawable {\n  /**\n   * The sprite frames to play, in order. See [[SpriteSheet.getAnimationForAll]] to quickly\n   * generate an [[Animation]].\n   */\n  public sprites: Sprite[] = [];\n\n  /**\n   * Duration to show each frame (in milliseconds)\n   */\n  public speed: number;\n\n  /**\n   * Current frame index being shown\n   */\n  public currentFrame: number = 0;\n\n  private _oldTime: number = Date.now();\n\n  public anchor: Vector = new Vector(0.0, 0.0);\n  public rotation: number = 0.0;\n  public scale: Vector = new Vector(1, 1);\n\n  /**\n   * Indicates whether the animation should loop after it is completed\n   */\n  public loop: boolean = true;\n\n  /**\n   * Indicates the frame index the animation should freeze on for a non-looping\n   * animation. By default it is the last frame.\n   */\n  public freezeFrame: number = -1;\n\n  private _engine: Engine;\n\n  /**\n   * Flip each frame vertically. Sets [[Sprite.flipVertical]].\n   */\n  public flipVertical: boolean = false;\n\n  /**\n   * Flip each frame horizontally. Sets [[Sprite.flipHorizontal]].\n   */\n  public flipHorizontal: boolean = false;\n\n  public drawWidth: number = 0;\n  public drawHeight: number = 0;\n  public width: number = 0;\n  public height: number = 0;\n\n  /**\n   * Typically you will use a [[SpriteSheet]] to generate an [[Animation]].\n   *\n   * @param engine  Reference to the current game engine\n   * @param images  An array of sprites to create the frames for the animation\n   * @param speed   The number in milliseconds to display each frame in the animation\n   * @param loop    Indicates whether the animation should loop after it is completed\n   */\n  constructor(engineOrConfig: Engine | AnimationArgs, sprites: Sprite[], speed: number, loop?: boolean) {\n    let engine = engineOrConfig;\n    if (engineOrConfig && !(engineOrConfig instanceof Engine)) {\n      const config = engineOrConfig;\n      engine = config.engine;\n      sprites = config.sprites;\n      speed = config.speed;\n      loop = config.loop;\n    }\n\n    this.sprites = sprites;\n    this.speed = speed;\n    this._engine = <Engine>engine;\n\n    if (loop != null) {\n      this.loop = loop;\n    }\n\n    if (sprites && sprites[0]) {\n      this.drawHeight = sprites[0] ? sprites[0].drawHeight : 0;\n      this.drawWidth = sprites[0] ? sprites[0].drawWidth : 0;\n\n      this.width = sprites[0] ? sprites[0].width : 0;\n      this.height = sprites[0] ? sprites[0].height : 0;\n\n      this.freezeFrame = sprites.length - 1;\n    }\n  }\n\n  /**\n   * Applies the opacity effect to a sprite, setting the alpha of all pixels to a given value\n   */\n  public opacity(value: number) {\n    this.addEffect(new Effects.Opacity(value));\n  }\n\n  /**\n   * Applies the grayscale effect to a sprite, removing color information.\n   */\n  public grayscale() {\n    this.addEffect(new Effects.Grayscale());\n  }\n\n  /**\n   * Applies the invert effect to a sprite, inverting the pixel colors.\n   */\n  public invert() {\n    this.addEffect(new Effects.Invert());\n  }\n\n  /**\n   * Applies the fill effect to a sprite, changing the color channels of all non-transparent pixels to match a given color\n   */\n  public fill(color: Color) {\n    this.addEffect(new Effects.Fill(color));\n  }\n\n  /**\n   * Applies the colorize effect to a sprite, changing the color channels of all pixels to be the average of the original color and the\n   * provided color.\n   */\n  public colorize(color: Color) {\n    this.addEffect(new Effects.Colorize(color));\n  }\n\n  /**\n   * Applies the lighten effect to a sprite, changes the lightness of the color according to hsl\n   */\n  public lighten(factor: number = 0.1) {\n    this.addEffect(new Effects.Lighten(factor));\n  }\n\n  /**\n   * Applies the darken effect to a sprite, changes the darkness of the color according to hsl\n   */\n  public darken(factor: number = 0.1) {\n    this.addEffect(new Effects.Darken(factor));\n  }\n\n  /**\n   * Applies the saturate effect to a sprite, saturates the color according to hsl\n   */\n  public saturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Saturate(factor));\n  }\n\n  /**\n   * Applies the desaturate effect to a sprite, desaturates the color according to hsl\n   */\n  public desaturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Desaturate(factor));\n  }\n\n  /**\n   * Add a [[ISpriteEffect]] manually\n   */\n  public addEffect(effect: Effects.SpriteEffect) {\n    for (const i in this.sprites) {\n      this.sprites[i].addEffect(effect);\n    }\n  }\n\n  /**\n   * Removes an [[ISpriteEffect]] from this animation.\n   * @param effect Effect to remove from this animation\n   */\n  public removeEffect(effect: Effects.SpriteEffect): void;\n\n  /**\n   * Removes an effect given the index from this animation.\n   * @param index  Index of the effect to remove from this animation\n   */\n  public removeEffect(index: number): void;\n  public removeEffect(param: any) {\n    for (const i in this.sprites) {\n      this.sprites[i].removeEffect(param);\n    }\n  }\n\n  /**\n   * Clear all sprite effects\n   */\n  public clearEffects() {\n    for (const i in this.sprites) {\n      this.sprites[i].clearEffects();\n    }\n  }\n\n  private _setAnchor(point: Vector) {\n    //if (!this.anchor.equals(point)) {\n    for (const i in this.sprites) {\n      this.sprites[i].anchor.setTo(point.x, point.y);\n    }\n    //}\n  }\n\n  private _setRotation(radians: number) {\n    //if (this.rotation !== radians) {\n    for (const i in this.sprites) {\n      this.sprites[i].rotation = radians;\n    }\n    //}\n  }\n\n  private _setScale(scale: Vector) {\n    //if (!this.scale.equals(scale)) {\n    for (const i in this.sprites) {\n      this.sprites[i].scale = scale;\n    }\n    //}\n  }\n\n  /**\n   * Resets the animation to first frame.\n   */\n  public reset() {\n    this.currentFrame = 0;\n  }\n\n  /**\n   * Indicates whether the animation is complete, animations that loop are never complete.\n   */\n  public isDone() {\n    return !this.loop && this.currentFrame >= this.sprites.length;\n  }\n\n  /**\n   * Not meant to be called by game developers. Ticks the animation forward internally and\n   * calculates whether to change to the frame.\n   * @internal\n   */\n  public tick() {\n    const time = Date.now();\n    if (time - this._oldTime > this.speed) {\n      this.currentFrame = this.loop ? (this.currentFrame + 1) % this.sprites.length : this.currentFrame + 1;\n      this._oldTime = time;\n    }\n  }\n\n  private _updateValues(): void {\n    this._setAnchor(this.anchor);\n    this._setRotation(this.rotation);\n    this._setScale(this.scale);\n  }\n\n  /**\n   * Skips ahead a specified number of frames in the animation\n   * @param frames  Frames to skip ahead\n   */\n  public skip(frames: number) {\n    this.currentFrame = (this.currentFrame + frames) % this.sprites.length;\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number) {\n    this.tick();\n    this._updateValues();\n    let currSprite: Sprite;\n    if (this.currentFrame < this.sprites.length) {\n      currSprite = this.sprites[this.currentFrame];\n      if (this.flipVertical) {\n        currSprite.flipVertical = this.flipVertical;\n      }\n      if (this.flipHorizontal) {\n        currSprite.flipHorizontal = this.flipHorizontal;\n      }\n      currSprite.draw(ctx, x, y);\n    }\n\n    if (this.freezeFrame !== -1 && this.currentFrame >= this.sprites.length) {\n      currSprite = this.sprites[Util.clamp(this.freezeFrame, 0, this.sprites.length - 1)];\n      currSprite.draw(ctx, x, y);\n    }\n\n    // add the calculated width\n    if (currSprite) {\n      this.drawWidth = currSprite.drawWidth;\n      this.drawHeight = currSprite.drawHeight;\n    }\n  }\n\n  /**\n   * Plays an animation at an arbitrary location in the game.\n   * @param x  The x position in the game to play\n   * @param y  The y position in the game to play\n   */\n  public play(x: number, y: number) {\n    this.reset();\n    this._engine.playAnimation(this, x, y);\n  }\n}\n\n/**\n * [[include:Constructors.md]]\n */\nexport interface AnimationArgs extends Partial<AnimationImpl> {\n  engine: Engine;\n  sprites: Sprite[];\n  speed: number;\n  loop?: boolean;\n  anchor?: Vector;\n  rotation?: number;\n  scale?: Vector;\n  flipVertical?: boolean;\n  flipHorizontal?: boolean;\n  width?: number;\n  height?: number;\n}\n\n/**\n * Animations allow you to display a series of images one after another,\n * creating the illusion of change. Generally these images will come from a [[SpriteSheet]] source.\n *\n * [[include:Animations.md]]\n */\nexport class Animation extends Configurable(AnimationImpl) {\n  constructor(config: AnimationArgs);\n  constructor(engine: Engine, images: Sprite[], speed: number, loop?: boolean);\n  constructor(engineOrConfig: Engine | AnimationArgs, images?: Sprite[], speed?: number, loop?: boolean) {\n    super(engineOrConfig, images, speed, loop);\n  }\n}\n","import { Color } from './Color';\nimport * as Effects from './SpriteEffects';\n\nimport { Drawable } from '../Interfaces/Drawable';\nimport { Vector } from '../Algebra';\n\n/**\n * Creates a closed polygon drawing given a list of [[Vector]]s.\n *\n * @warning Use sparingly as Polygons are performance intensive\n */\nexport class Polygon implements Drawable {\n  public flipVertical: boolean;\n  public flipHorizontal: boolean;\n  public drawWidth: number;\n  public drawHeight: number;\n\n  public width: number;\n  public height: number;\n\n  /**\n   * The color to use for the lines of the polygon\n   */\n  public lineColor: Color;\n  /**\n   * The color to use for the interior of the polygon\n   */\n  public fillColor: Color;\n  /**\n   * The width of the lines of the polygon\n   */\n  public lineWidth: number = 5;\n  /**\n   * Indicates whether the polygon is filled or not.\n   */\n  public filled: boolean = false;\n\n  private _points: Vector[] = [];\n  public anchor = new Vector(0, 0);\n  public rotation: number = 0;\n  public scale = new Vector(1, 1);\n\n  /**\n   * @param points  The vectors to use to build the polygon in order\n   */\n  constructor(points: Vector[]) {\n    this._points = points;\n\n    const minX = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.min(prev, curr.x);\n    }, 0);\n    const maxX = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.max(prev, curr.x);\n    }, 0);\n\n    this.drawWidth = maxX - minX;\n\n    const minY = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.min(prev, curr.y);\n    }, 0);\n    const maxY = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.max(prev, curr.y);\n    }, 0);\n\n    this.drawHeight = maxY - minY;\n\n    this.height = this.drawHeight;\n    this.width = this.drawWidth;\n  }\n\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public addEffect() {\n    // not supported on polygons\n  }\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public removeEffect(index: number): void;\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public removeEffect(effect: Effects.SpriteEffect): void;\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public removeEffect() {\n    // not supported on polygons\n  }\n\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public clearEffects() {\n    // not supported on polygons\n  }\n\n  public reset() {\n    //pass\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number) {\n    ctx.save();\n    ctx.translate(x + this.anchor.x, y + this.anchor.y);\n    ctx.scale(this.scale.x, this.scale.y);\n    ctx.rotate(this.rotation);\n    ctx.beginPath();\n    ctx.lineWidth = this.lineWidth;\n\n    // Iterate through the supplied points and construct a 'polygon'\n    const firstPoint = this._points[0];\n    ctx.moveTo(firstPoint.x, firstPoint.y);\n\n    let i = 0;\n    const len = this._points.length;\n\n    for (i; i < len; i++) {\n      ctx.lineTo(this._points[i].x, this._points[i].y);\n    }\n\n    ctx.lineTo(firstPoint.x, firstPoint.y);\n    ctx.closePath();\n\n    if (this.filled) {\n      ctx.fillStyle = this.fillColor.toString();\n      ctx.fill();\n    }\n\n    ctx.strokeStyle = this.lineColor.toString();\n\n    if (this.flipHorizontal) {\n      ctx.translate(this.drawWidth, 0);\n      ctx.scale(-1, 1);\n    }\n\n    if (this.flipVertical) {\n      ctx.translate(0, this.drawHeight);\n      ctx.scale(1, -1);\n    }\n\n    ctx.stroke();\n    ctx.restore();\n  }\n}\n","import { Sprite, SpriteArgs } from './Sprite';\nimport { Animation } from './Animation';\nimport { Color } from './Color';\nimport * as Effects from './SpriteEffects';\n\nimport { Texture } from '../Resources/Texture';\nimport { Engine } from '../Engine';\nimport { Logger } from '../Util/Log';\nimport { TextAlign, BaseAlign } from '../Label';\nimport { Configurable } from '../Configurable';\n\n/**\n * @hidden\n */\nexport class SpriteSheetImpl {\n  public sprites: Sprite[] = [];\n  public image: Texture = null;\n  public columns: number = 0;\n  public rows: number = 0;\n  public spWidth: number = 0;\n  public spHeight: number = 0;\n  public spacing: number = 0;\n  /**\n   * @param image     The backing image texture to build the SpriteSheet\n   * @param columns   The number of columns in the image texture\n   * @param rows      The number of rows in the image texture\n   * @param spWidth   The width of each individual sprite in pixels\n   * @param spHeight  The height of each individual sprite in pixels\n   * @param spacing   The spacing between every sprite in a spritesheet\n   */\n  constructor(\n    imageOrConfigOrSprites: Texture | SpriteSheetArgs | Sprite[],\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number\n  ) {\n    let loadFromImage: boolean = false;\n    if (imageOrConfigOrSprites instanceof Array) {\n      this.sprites = imageOrConfigOrSprites;\n    } else {\n      if (imageOrConfigOrSprites && !(imageOrConfigOrSprites instanceof Texture)) {\n        this.columns = imageOrConfigOrSprites.columns;\n        this.rows = imageOrConfigOrSprites.rows;\n        this.spWidth = imageOrConfigOrSprites.spWidth;\n        this.spHeight = imageOrConfigOrSprites.spHeight;\n        this.image = imageOrConfigOrSprites.image;\n        this.spacing = imageOrConfigOrSprites.spacing || 0;\n      } else {\n        this.image = <Texture>imageOrConfigOrSprites;\n        this.columns = columns;\n        this.rows = rows;\n        this.spWidth = spWidth;\n        this.spHeight = spHeight;\n        this.spacing = spacing || 0;\n      }\n      this.sprites = new Array(this.columns * this.rows);\n      loadFromImage = true;\n    }\n\n    // Inspect actual image dimensions with preloading\n    if (this.image instanceof Texture) {\n      let isWidthError: boolean = false;\n      let isHeightError: boolean = false;\n      this.image.loaded.then((image: HTMLImageElement) => {\n        isWidthError = this.spWidth * this.columns > image.naturalWidth;\n        isHeightError = this.spHeight * this.rows > image.naturalHeight;\n      });\n      if (isWidthError) {\n        throw new RangeError(\n          `SpriteSheet specified is wider, ` +\n            `${this.columns} cols x ${this.spWidth} pixels > ${this.image.image.naturalWidth} ` +\n            `pixels than image width`\n        );\n      }\n      if (isHeightError) {\n        throw new RangeError(\n          `SpriteSheet specified is taller, ` +\n            `${this.rows} rows x ${this.spHeight} pixels > ${this.image.image.naturalHeight} ` +\n            `pixels than image height`\n        );\n      }\n    }\n\n    if (loadFromImage) {\n      for (let i = 0; i < this.rows; i++) {\n        for (let j = 0; j < this.columns; j++) {\n          this.sprites[j + i * this.columns] = new Sprite(\n            this.image,\n            j * this.spWidth + this.spacing * j + this.spacing,\n            i * this.spHeight + this.spacing * i + this.spacing,\n            this.spWidth,\n            this.spHeight\n          );\n        }\n      }\n    }\n  }\n\n  /**\n   * Create an animation from the this SpriteSheet by listing out the\n   * sprite indices. Sprites are organized in row major order in the SpriteSheet.\n   * @param engine   Reference to the current game [[Engine]]\n   * @param indices  An array of sprite indices to use in the animation\n   * @param speed    The number in milliseconds to display each frame in the animation\n   */\n  public getAnimationByIndices(engine: Engine, indices: number[], speed: number) {\n    let images: Sprite[] = indices.map((index) => {\n      return this.sprites[index];\n    });\n\n    images = images.map(function(i) {\n      return i.clone();\n    });\n    return new Animation(engine, images, speed);\n  }\n\n  /**\n   * Create an animation from the this SpriteSheet by specifing the range of\n   * images with the beginning (inclusive) and ending (exclusive) index\n   * For example `getAnimationBetween(engine, 0, 5, 200)` returns an animation with 5 frames.\n   * @param engine      Reference to the current game Engine\n   * @param beginIndex  The index to start taking frames (inclusive)\n   * @param endIndex    The index to stop taking frames (exclusive)\n   * @param speed       The number in milliseconds to display each frame in the animation\n   */\n  public getAnimationBetween(engine: Engine, beginIndex: number, endIndex: number, speed: number) {\n    let images = this.sprites.slice(beginIndex, endIndex);\n    images = images.map(function(i) {\n      return i.clone();\n    });\n    return new Animation(engine, images, speed);\n  }\n\n  /**\n   * Treat the entire SpriteSheet as one animation, organizing the frames in\n   * row major order.\n   * @param engine  Reference to the current game [[Engine]]\n   * @param speed   The number in milliseconds to display each frame the animation\n   */\n  public getAnimationForAll(engine: Engine, speed: number) {\n    const sprites = this.sprites.map(function(i) {\n      return i.clone();\n    });\n    return new Animation(engine, sprites, speed);\n  }\n\n  /**\n   * Retreive a specific sprite from the SpriteSheet by its index. Sprites are organized\n   * in row major order in the SpriteSheet.\n   * @param index  The index of the sprite\n   */\n  public getSprite(index: number): Sprite {\n    if (index >= 0 && index < this.sprites.length) {\n      return this.sprites[index];\n    } else {\n      throw new Error('Invalid index: ' + index);\n    }\n  }\n\n  /**\n   * Get an animation with bespoke sprite coordinates. This is useful if the SpriteSheet is\n   * packed and not a uniform width or height. The resulting [[Animation]] will have the height and width of the\n   * largest dimension (width, height) from among the sprite coordinates\n   * @param engine\n   * @param spriteCoordinates\n   * @param speed\n   */\n  public getAnimationByCoords(engine: Engine, spriteCoordinates: SpriteArgs[], speed: number): Animation {\n    let maxWidth: number = 0;\n    let maxHeight: number = 0;\n    const sprites: Sprite[] = new Array(spriteCoordinates.length);\n    for (let i = 0; i < spriteCoordinates.length; i++) {\n      const coord = spriteCoordinates[i];\n      // no need to pass image again if using a spritesheet\n      coord.image = coord.image || this.image;\n      maxWidth = Math.max(maxWidth, coord.drawWidth);\n      maxHeight = Math.max(maxHeight, coord.drawHeight);\n      sprites[i] = new Sprite(coord);\n    }\n\n    const anim = new Animation(engine, sprites, speed);\n\n    anim.drawWidth = maxWidth;\n    anim.drawHeight = maxHeight;\n    return anim;\n  }\n}\n\n/**\n * [[include:Constructors.md]]\n */\nexport interface SpriteSheetArgs extends Partial<SpriteSheetImpl> {\n  image: Texture;\n  sprites?: Sprite[];\n  spWidth: number;\n  spHeight: number;\n  rows: number;\n  columns: number;\n  spacing?: number;\n}\n\n/**\n * Sprite sheets are a useful mechanism for slicing up image resources into\n * separate sprites or for generating in game animations. [[Sprite|Sprites]] are organized\n * in row major order in the [[SpriteSheet]].\n *\n * [[include:SpriteSheets.md]]\n */\nexport class SpriteSheet extends Configurable(SpriteSheetImpl) {\n  constructor(config: SpriteSheetArgs);\n  constructor(sprites: Sprite[]);\n  constructor(image: Texture, columns: number, rows: number, spWidth: number, spHeight: number);\n  constructor(\n    imageOrConfigOrSprites: Texture | SpriteSheetArgs | Sprite[],\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number\n  ) {\n    super(imageOrConfigOrSprites, columns, rows, spWidth, spHeight, spacing);\n  }\n}\n\nexport class SpriteFontImpl extends SpriteSheet {\n  private _currentColor: Color = Color.Black;\n  private _currentOpacity: Number = 1.0;\n  private _sprites: { [key: string]: Sprite } = {};\n\n  // text shadow\n  private _textShadowOn: boolean = false;\n  private _textShadowDirty: boolean = true;\n  private _textShadowColor: Color = Color.Black;\n  private _textShadowSprites: { [key: string]: Sprite } = {};\n  private _shadowOffsetX: number = 5;\n  private _shadowOffsetY: number = 5;\n  private _alphabet: string;\n  private _caseInsensitive: boolean;\n\n  /**\n   * @param image           The backing image texture to build the SpriteFont\n   * @param alphabet        A string representing all the characters in the image, in row major order.\n   * @param caseInsensitive  Indicate whether this font takes case into account\n   * @param columns         The number of columns of characters in the image\n   * @param rows            The number of rows of characters in the image\n   * @param spWidth         The width of each character in pixels\n   * @param spHeight        The height of each character in pixels\n   */\n  constructor(\n    imageOrConfig: Texture | SpriteFontArgs,\n    alphabet: string,\n    caseInsensitive: boolean,\n    columns: number,\n    rows: number,\n    spWidth: number,\n    spHeight: number,\n    spacing?: number\n  ) {\n    super(\n      imageOrConfig instanceof Texture\n        ? {\n            image: imageOrConfig,\n            spWidth: spWidth,\n            spHeight: spHeight,\n            rows: rows,\n            columns: columns,\n            spacing: spacing || 0\n          }\n        : imageOrConfig\n    );\n\n    if (imageOrConfig && !(imageOrConfig instanceof Texture)) {\n      alphabet = imageOrConfig.alphabet;\n      caseInsensitive = imageOrConfig.caseInsensitive;\n    }\n\n    this._alphabet = alphabet;\n    this._caseInsensitive = caseInsensitive;\n    this._sprites = this.getTextSprites();\n  }\n\n  /**\n   * Returns a dictionary that maps each character in the alphabet to the appropriate [[Sprite]].\n   */\n  public getTextSprites(): { [key: string]: Sprite } {\n    const lookup: { [key: string]: Sprite } = {};\n    for (let i = 0; i < this._alphabet.length; i++) {\n      let char = this._alphabet[i];\n      if (this._caseInsensitive) {\n        char = char.toLowerCase();\n      }\n      lookup[char] = this.sprites[i].clone();\n    }\n    return lookup;\n  }\n\n  /**\n   * Sets the text shadow for sprite fonts\n   * @param offsetX      The x offset in pixels to place the shadow\n   * @param offsetY      The y offset in pixels to place the shadow\n   * @param shadowColor  The color of the text shadow\n   */\n  public setTextShadow(offsetX: number, offsetY: number, shadowColor: Color) {\n    this._textShadowOn = true;\n    this._shadowOffsetX = offsetX;\n    this._shadowOffsetY = offsetY;\n    this._textShadowColor = shadowColor.clone();\n    this._textShadowDirty = true;\n    for (const character in this._sprites) {\n      this._textShadowSprites[character] = this._sprites[character].clone();\n    }\n  }\n\n  /**\n   * Toggles text shadows on or off\n   */\n  public useTextShadow(on: boolean) {\n    this._textShadowOn = on;\n    if (on) {\n      this.setTextShadow(5, 5, this._textShadowColor);\n    }\n  }\n\n  /**\n   * Draws the current sprite font\n   */\n  public draw(ctx: CanvasRenderingContext2D, text: string, x: number, y: number, options: SpriteFontOptions) {\n    options = this._parseOptions(options);\n\n    if (this._currentColor.toString() !== options.color.toString() || this._currentOpacity !== options.opacity) {\n      this._currentOpacity = options.opacity;\n      this._currentColor = options.color;\n      for (const char in this._sprites) {\n        this._sprites[char].clearEffects();\n        this._sprites[char].fill(options.color);\n        this._sprites[char].opacity(options.opacity);\n      }\n    }\n\n    if (this._textShadowOn && this._textShadowDirty && this._textShadowColor) {\n      for (const characterShadow in this._textShadowSprites) {\n        this._textShadowSprites[characterShadow].clearEffects();\n        this._textShadowSprites[characterShadow].addEffect(new Effects.Fill(this._textShadowColor.clone()));\n      }\n      this._textShadowDirty = false;\n    }\n\n    // find the current length of text in pixels\n    const sprite = this.sprites[0];\n\n    // find the current height fo the text in pixels\n    const height = sprite.drawHeight;\n\n    // calculate appropriate scale for font size\n    const scale = options.fontSize / height;\n\n    const length = text.length * sprite.drawWidth * scale + text.length * options.letterSpacing;\n\n    let currX = x;\n    if (options.textAlign === TextAlign.Left || options.textAlign === TextAlign.Start) {\n      currX = x;\n    } else if (options.textAlign === TextAlign.Right || options.textAlign === TextAlign.End) {\n      currX = x - length;\n    } else if (options.textAlign === TextAlign.Center) {\n      currX = x - length / 2;\n    }\n\n    let currY = y - height * scale;\n    if (options.baseAlign === BaseAlign.Top || options.baseAlign === BaseAlign.Hanging) {\n      currY = y;\n    } else if (\n      options.baseAlign === BaseAlign.Ideographic ||\n      options.baseAlign === BaseAlign.Bottom ||\n      options.baseAlign === BaseAlign.Alphabetic\n    ) {\n      currY = y - height * scale;\n    } else if (options.baseAlign === BaseAlign.Middle) {\n      currY = y - (height * scale) / 2;\n    }\n\n    for (let i = 0; i < text.length; i++) {\n      let character = text[i];\n      if (this._caseInsensitive) {\n        character = character.toLowerCase();\n      }\n      try {\n        // if text shadow\n        if (this._textShadowOn) {\n          this._textShadowSprites[character].scale.x = scale;\n          this._textShadowSprites[character].scale.y = scale;\n          this._textShadowSprites[character].draw(ctx, currX + this._shadowOffsetX, currY + this._shadowOffsetY);\n        }\n\n        const charSprite = this._sprites[character];\n        charSprite.scale.x = scale;\n        charSprite.scale.y = scale;\n        charSprite.draw(ctx, currX, currY);\n        currX += charSprite.drawWidth + options.letterSpacing;\n      } catch (e) {\n        Logger.getInstance().error(`SpriteFont Error drawing char ${character}`);\n      }\n    }\n  }\n\n  private _parseOptions(options: SpriteFontOptions): SpriteFontOptions {\n    return {\n      fontSize: options.fontSize || 10,\n      letterSpacing: options.letterSpacing || 0,\n      color: options.color || Color.Black,\n      textAlign: typeof options.textAlign === undefined ? TextAlign.Left : options.textAlign,\n      baseAlign: typeof options.baseAlign === undefined ? BaseAlign.Bottom : options.baseAlign,\n      maxWidth: options.maxWidth || -1,\n      opacity: options.opacity || 0\n    };\n  }\n}\n\n/**\n * Specify various font attributes for sprite fonts\n */\nexport interface SpriteFontOptions {\n  color?: Color;\n  opacity?: number;\n  fontSize?: number;\n  letterSpacing?: number;\n  textAlign?: TextAlign;\n  baseAlign?: BaseAlign;\n  maxWidth?: number;\n}\n\n/**\n * [[include:Constructors.md]]\n */\nexport interface SpriteFontArgs extends SpriteSheetArgs {\n  image: Texture;\n  columns: number;\n  rows: number;\n  spWidth: number;\n  spHeight: number;\n  alphabet: string;\n  caseInsensitive: boolean;\n}\n\n/**\n * Sprite fonts are a used in conjunction with a [[Label]] to specify\n * a particular bitmap as a font. Note that some font features are not\n * supported by Sprite fonts.\n *\n * [[include:SpriteFonts.md]]\n */\nexport class SpriteFont extends Configurable(SpriteFontImpl) {\n  constructor(config: SpriteFontArgs);\n  constructor(image: Texture, alphabet: string, caseInsensitive: boolean, columns: number, rows: number, spWidth: number, spHeight: number);\n  constructor(\n    imageOrConfig: Texture | SpriteFontArgs,\n    alphabet?: string,\n    caseInsensitive?: boolean,\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number\n  ) {\n    super(imageOrConfig, alphabet, caseInsensitive, columns, rows, spWidth, spHeight, spacing);\n  }\n}\n","import { Promise } from '../Promises';\nimport { Audio } from './Audio';\n\nexport type ExResponseType = '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text';\n\nexport interface ExResponseTypesLookup {\n  [name: string]: ExResponseType;\n}\n\nexport class ExResponse {\n  public static type: ExResponseTypesLookup = {\n    any: '',\n    blob: 'blob',\n    json: 'json',\n    text: 'text',\n    document: 'document',\n    arraybuffer: 'arraybuffer'\n  };\n}\n\n/**\n * Represents an audio implementation like [[AudioTagInstance]] or [[WebAudioInstance]]\n */\nexport interface AudioImplementation {\n  /**\n   * XHR response type\n   */\n  responseType: ExResponseType;\n\n  /**\n   * Processes raw data and transforms into sound data\n   */\n  processData(data: Blob | ArrayBuffer): Promise<string | AudioBuffer>;\n\n  /**\n   * Factory method that returns an instance of a played audio track\n   */\n  createInstance(data: string | AudioBuffer): Audio;\n}\n","import { Random } from './Random';\nimport { Color } from '../Drawing/Color';\nimport * as Util from '../Util/Util';\n\nfunction _lerp(time: number, a: number, b: number): number {\n  return a + time * (b - a);\n}\n\nfunction _fade(t: number): number {\n  return t * t * t * (t * (t * 6 - 15) + 10);\n}\n\n/**\n * Options for the perlin noise generator\n */\nexport interface PerlinOptions {\n  /**\n   * Random number seed for the Perlin noise generator\n   */\n  seed?: number;\n  /**\n   * Number of octaves to use when generating the noise, the number of octaves is the number of times the perlin\n   * noise is generated and laid on top of itself. Using higher values can increase the curviness of the noise, and\n   * make it look more natural.\n   */\n  octaves?: number;\n  /**\n   * Frequency to use when generating the noise, the higher the number the more quickly the pattern will oscilate. Another way\n   * to think about this is that it is like \"zooming\" out from an infinite pattern determined by the seed.\n   */\n  frequency?: number;\n  /**\n   * The amplitude determines the relative height of the peaks generated in the noise.\n   */\n  amplitude?: number;\n  /**\n   * The persistance determines how quickly the amplitude will drop off, a high degree of persistance results in smoother patterns,\n   * a low degree of persistance generates spikey patterns.\n   */\n  persistance?: number;\n}\n\n/**\n * Generates perlin noise based on the 2002 Siggraph paper http://mrl.nyu.edu/~perlin/noise/\n * Also https://flafla2.github.io/2014/08/09/perlinnoise.html\n */\nexport class PerlinGenerator {\n  private _perm: number[] = [\n    151,\n    160,\n    137,\n    91,\n    90,\n    15,\n    131,\n    13,\n    201,\n    95,\n    96,\n    53,\n    194,\n    233,\n    7,\n    225,\n    140,\n    36,\n    103,\n    30,\n    69,\n    142,\n    8,\n    99,\n    37,\n    240,\n    21,\n    10,\n    23,\n    190,\n    6,\n    148,\n    247,\n    120,\n    234,\n    75,\n    0,\n    26,\n    197,\n    62,\n    94,\n    252,\n    219,\n    203,\n    117,\n    35,\n    11,\n    32,\n    57,\n    177,\n    33,\n    88,\n    237,\n    149,\n    56,\n    87,\n    174,\n    20,\n    125,\n    136,\n    171,\n    168,\n    68,\n    175,\n    74,\n    165,\n    71,\n    134,\n    139,\n    48,\n    27,\n    166,\n    77,\n    146,\n    158,\n    231,\n    83,\n    111,\n    229,\n    122,\n    60,\n    211,\n    133,\n    230,\n    220,\n    105,\n    92,\n    41,\n    55,\n    46,\n    245,\n    40,\n    244,\n    102,\n    143,\n    54,\n    65,\n    25,\n    63,\n    161,\n    1,\n    216,\n    80,\n    73,\n    209,\n    76,\n    132,\n    187,\n    208,\n    89,\n    18,\n    169,\n    200,\n    196,\n    135,\n    130,\n    116,\n    188,\n    159,\n    86,\n    164,\n    100,\n    109,\n    198,\n    173,\n    186,\n    3,\n    64,\n    52,\n    217,\n    226,\n    250,\n    124,\n    123,\n    5,\n    202,\n    38,\n    147,\n    118,\n    126,\n    255,\n    82,\n    85,\n    212,\n    207,\n    206,\n    59,\n    227,\n    47,\n    16,\n    58,\n    17,\n    182,\n    189,\n    28,\n    42,\n    223,\n    183,\n    170,\n    213,\n    119,\n    248,\n    152,\n    2,\n    44,\n    154,\n    163,\n    70,\n    221,\n    153,\n    101,\n    155,\n    167,\n    43,\n    172,\n    9,\n    129,\n    22,\n    39,\n    253,\n    19,\n    98,\n    108,\n    110,\n    79,\n    113,\n    224,\n    232,\n    178,\n    185,\n    112,\n    104,\n    218,\n    246,\n    97,\n    228,\n    251,\n    34,\n    242,\n    193,\n    238,\n    210,\n    144,\n    12,\n    191,\n    179,\n    162,\n    241,\n    81,\n    51,\n    145,\n    235,\n    249,\n    14,\n    239,\n    107,\n    49,\n    192,\n    214,\n    31,\n    181,\n    199,\n    106,\n    157,\n    184,\n    84,\n    204,\n    176,\n    115,\n    121,\n    50,\n    45,\n    127,\n    4,\n    150,\n    254,\n    138,\n    236,\n    205,\n    93,\n    222,\n    114,\n    67,\n    29,\n    24,\n    72,\n    243,\n    141,\n    128,\n    195,\n    78,\n    66,\n    215,\n    61,\n    156,\n    180\n  ];\n  private _p: Uint8Array = new Uint8Array(512);\n  private _random: Random;\n\n  private _defaultPerlinOptions: PerlinOptions = {\n    octaves: 1,\n    frequency: 1,\n    amplitude: 1,\n    persistance: 0.5\n  };\n\n  /**\n   * The persistance determines how quickly the amplitude will drop off, a high degree of persistance results in smoother patterns,\n   * a low degree of persistance generates spikey patterns.\n   */\n  public persistance: number;\n\n  /**\n   * The amplitude determines the relative height of the peaks generated in the noise.\n   */\n  public amplitude: number;\n\n  /**\n   * Frequency to use when generating the noise, the higher the number the more quickly the pattern will oscilate. Another way\n   * to think about this is that it is like \"zooming\" out from an infinite pattern determined by the seed.\n   */\n  public frequency: number;\n\n  /**\n   * Number of octaves to use when generating the noise, the number of octaves is the number of times the perlin\n   * noise is generated and laid on top of itself. Using higher values can increase the curviness of the noise, and\n   * make it look more natural.\n   */\n  public octaves: number;\n\n  constructor(options?: PerlinOptions) {\n    options = Util.extend({}, this._defaultPerlinOptions, options);\n\n    this.persistance = options.persistance;\n    this.amplitude = options.amplitude;\n    this.frequency = options.frequency;\n    this.octaves = options.octaves;\n\n    if (options.seed) {\n      this._random = new Random(options.seed);\n    } else {\n      this._random = new Random();\n    }\n\n    this._perm = this._random.shuffle(this._perm);\n\n    for (let i = 0; i < 512; i++) {\n      this._p[i] = this._perm[i % 256] & 0xff;\n    }\n  }\n\n  /**\n   * Generates 1-Dimensional perlin noise given an x and generates noises values between [0, 1].\n   */\n  public noise(x: number): number;\n  /**\n   * Generates 2-Dimensional perlin noise given an (x, y) and generates noise values between [0, 1]\n   */\n  public noise(x: number, y: number): number;\n  /**\n   * Generates 3-Dimensional perlin noise given an (x, y, z) and generates noise values between [0, 1]\n   */\n  public noise(x: number, y: number, z: number): number;\n  public noise(): number {\n    let amp = this.amplitude;\n    let freq = this.frequency;\n\n    let total = 0;\n    let maxValue = 0;\n    for (let i = 0; i < this.octaves; i++) {\n      switch (arguments.length) {\n        case 1:\n          total += this._noise1d(arguments[0] * freq) * amp;\n          break;\n        case 2:\n          total += this._noise2d(arguments[0] * freq, arguments[1] * freq) * amp;\n          break;\n        case 3:\n          total += this._noise3d(arguments[0] * freq, arguments[1] * freq, arguments[2] * freq) * amp;\n          break;\n        /* istanbul ignore next */\n        default:\n          throw new Error('Invalid arguments for perlin noise');\n      }\n      maxValue += amp;\n      amp *= this.persistance;\n      freq *= 2;\n    }\n    return total / maxValue;\n  }\n\n  /**\n   * Generates a list starting at 0 and ending at 1 of contious perlin noise, by default the step is 1/length;\n   *\n   */\n  public sequence(length: number, step?: number): number[] {\n    if (!step) {\n      step = 1 / length;\n    }\n    const array: number[] = new Array(length);\n    for (let i = 0; i < length; i++) {\n      array[i] = this.noise(i * step);\n    }\n    return array;\n  }\n\n  /**\n   * Generates a 2D grid of perlin noise given a step value packed into a 1D array i = (x + y*width),\n   * by default the step will 1/(min(dimension))\n   */\n  public grid(width: number, height: number, step?: number): number[] {\n    if (!step) {\n      step = 1 / Math.min(width, height);\n    }\n\n    const array: number[] = new Array(width * height);\n\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        array[x + y * width] = this.noise(x * step, y * step);\n      }\n    }\n\n    return array;\n  }\n\n  private _gradient3d(hash: number, x: number, y: number, z: number) {\n    const h = hash & 0xf;\n    const u = h < 8 ? x : y;\n    const v = h < 4 ? y : h === 12 || h === 14 ? x : z;\n    return ((h & 0b1) === 0 ? u : -u) + ((h & 0b10) === 0 ? v : -v);\n  }\n\n  private _gradient2d(hash: number, x: number, y: number) {\n    const value = (hash & 0b1) === 0 ? x : y;\n    return (hash & 0b10) === 0 ? -value : value;\n  }\n\n  private _gradient1d(hash: number, x: number) {\n    return (hash & 0b1) === 0 ? -x : x;\n  }\n\n  private _noise1d(x: number) {\n    const intX = Math.floor(x) & 0xff; // force 0-255 integers to lookup in permutation\n    x -= Math.floor(x);\n    const fadeX = _fade(x);\n    return (_lerp(fadeX, this._gradient1d(this._p[intX], x), this._gradient1d(this._p[intX + 1], x - 1)) + 1) / 2;\n  }\n\n  private _noise2d(x: number, y: number) {\n    const intX = Math.floor(x) & 0xff;\n    const intY = Math.floor(y) & 0xff;\n\n    x -= Math.floor(x);\n    y -= Math.floor(y);\n\n    const fadeX = _fade(x);\n    const fadeY = _fade(y);\n    const a = this._p[intX] + intY;\n    const b = this._p[intX + 1] + intY;\n    return (\n      (_lerp(\n        fadeY,\n        _lerp(fadeX, this._gradient2d(this._p[a], x, y), this._gradient2d(this._p[b], x - 1, y)),\n        _lerp(fadeX, this._gradient2d(this._p[a + 1], x, y - 1), this._gradient2d(this._p[b + 1], x - 1, y - 1))\n      ) +\n        1) /\n      2\n    );\n  }\n\n  private _noise3d(x: number, y: number, z: number) {\n    const intX = Math.floor(x) & 0xff;\n    const intY = Math.floor(y) & 0xff;\n    const intZ = Math.floor(z) & 0xff;\n\n    x -= Math.floor(x);\n    y -= Math.floor(y);\n    z -= Math.floor(z);\n\n    const fadeX = _fade(x);\n    const fadeY = _fade(y);\n    const fadeZ = _fade(z);\n\n    const a = this._p[intX] + intY;\n    const b = this._p[intX + 1] + intY;\n\n    const aa = this._p[a] + intZ;\n    const ba = this._p[b] + intZ;\n\n    const ab = this._p[a + 1] + intZ;\n    const bb = this._p[b + 1] + intZ;\n\n    return (\n      (_lerp(\n        fadeZ,\n        _lerp(\n          fadeY,\n          _lerp(fadeX, this._gradient3d(this._p[aa], x, y, z), this._gradient3d(this._p[ba], x - 1, y, z)),\n          _lerp(fadeX, this._gradient3d(this._p[ab], x, y - 1, z), this._gradient3d(this._p[bb], x - 1, y - 1, z))\n        ),\n        _lerp(\n          fadeY,\n          _lerp(fadeX, this._gradient3d(this._p[aa + 1], x, y, z - 1), this._gradient3d(this._p[ba + 1], x - 1, y, z - 1)),\n          _lerp(fadeX, this._gradient3d(this._p[ab + 1], x, y - 1, z - 1), this._gradient3d(this._p[bb + 1], x - 1, y - 1, z - 1))\n        )\n      ) +\n        1) /\n      2\n    );\n  }\n}\n\n/**\n * A helper to draw 2D perlin maps given a perlin generator and a function\n */\nexport class PerlinDrawer2D {\n  /**\n   * @param generator - An existing perlin generator\n   * @param colorFcn - A color function that takes a value between [0, 255] derived from the perlin generator, and returns a color\n   */\n  constructor(public generator: PerlinGenerator, public colorFcn?: (val: number) => Color) {\n    if (!colorFcn) {\n      this.colorFcn = (val: number) => {\n        return val < 125 ? Color.Black : Color.White;\n      };\n    }\n  }\n\n  /**\n   * Returns an image of 2D perlin noise\n   */\n  public image(width: number, height: number): HTMLImageElement {\n    const image = document.createElement('img');\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    const ctx = canvas.getContext('2d');\n    this.draw(ctx, 0, 0, width, height);\n    image.src = canvas.toDataURL();\n    return image;\n  }\n\n  /**\n   * This draws a 2D perlin grid on a canvas context, not recommended to be called every frame due to performance\n   */\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number, width: number, height: number) {\n    const grid = this.generator.grid(width, height);\n    const imageData = ctx.getImageData(x, y, width, height);\n    for (let j = 0; j < height; j++) {\n      for (let i = 0; i < width; i++) {\n        const val = grid[i + width * j];\n        const c = Math.floor(val * 255) & 0xff;\n        const pixel = (i + j * imageData.width) * 4;\n        const color = this.colorFcn(c);\n\n        imageData.data[pixel] = color.r;\n        imageData.data[pixel + 1] = color.g;\n        imageData.data[pixel + 2] = color.b;\n        imageData.data[pixel + 3] = Math.floor(color.a * 255);\n      }\n    }\n    ctx.putImageData(imageData, x, y);\n  }\n}\n","import { Logger } from './../Util/Log';\nimport { PostProcessor } from './PostProcessor';\nimport { Engine } from '../Engine';\n\nexport enum ColorBlindness {\n  Protanope,\n  Deuteranope,\n  Tritanope\n}\n\n/**\n * This post processor can correct colors and simulate color blindness.\n * It is possible to use this on every game, but the game's performance\n * will suffer measurably. It's better to use it as a helpful tool while developing your game.\n * Remember, the best practice is to design with color blindness in mind.\n *\n * [[include:ColorBlind.md]]\n */\nexport class ColorBlindCorrector implements PostProcessor {\n  private _vertexShader =\n    'attribute vec2 a_position;' +\n    'attribute vec2 a_texCoord;' +\n    'uniform vec2 u_resolution;' +\n    'varying vec2 v_texCoord;' +\n    'void main() {' +\n    // convert the rectangle from pixels to 0.0 to 1.0\n    'vec2 zeroToOne = a_position / u_resolution;' +\n    // convert from 0->1 to 0->2\n    'vec2 zeroToTwo = zeroToOne * 2.0;' +\n    // convert from 0->2 to -1->+1 (clipspace)\n    'vec2 clipSpace = zeroToTwo - 1.0;' +\n    'gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);' +\n    // pass the texCoord to the fragment shader\n    // The GPU will interpolate this value between points.\n    'v_texCoord = a_texCoord;' +\n    '}';\n\n  private _fragmentShader =\n    'precision mediump float;' +\n    // our texture\n    'uniform sampler2D u_image;' +\n    // the texCoords passed in from the vertex shader.\n    'varying vec2 v_texCoord;' +\n    // Color blind conversions\n    /*'mat3 m[9] =' +\n   '{' +\n      'mat3(1.0, 0.0, 0.0,  0.0, 1.0, 0.0,  0.0, 0.0, 1.0  ),' + // normal\n      'mat3(0.567, 0.433, 0.0,  0.558, 0.442, 0.0,  0.0, 0.242, 0.758),' + // protanopia\n      'mat3(0.817, 0.183, 0.0,  0.333, 0.667, 0.0,  0.0, 0.125,0.875),' + // protanomaly\n      'mat3(0.625, 0.375, 0.0,  0.7, 0.3, 0.0,  0.0, 0.3,0.7  ),' + // deuteranopia\n      'mat3(0.8, 0.2, 0.0,  0.258, 0.742, 0.0,  0.0, 0.142,0.858),' + // deuteranomaly\n      'mat3(0.95, 0.05, 0.0,  0.0, 0.433, 0.567,  0.0, 0.475,0.525),' + // tritanopia\n      'mat3(0.967, 0.033, 0.0,  0.0, 0.733, 0.267,  0.0, 0.183,0.817),' + // tritanomaly\n      'mat3(0.299, 0.587, 0.114,  0.299, 0.587, 0.114,  0.299, 0.587,0.114),' + // achromatopsia\n      'mat3(0.618, 0.320, 0.062,  0.163, 0.775, 0.062,  0.163, 0.320,0.516)' +  // achromatomaly\n   '};' +*/\n\n    'void main() {' +\n    'vec4 o =  texture2D(u_image, v_texCoord);' +\n    // RGB to LMS matrix conversion\n    'float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);' +\n    'float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);' +\n    'float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);' +\n    // Simulate color blindness\n\n    '//MODE CODE//' +\n    /* Deuteranope for testing \n      'float l = 1.0 * L + 0.0 * M + 0.0 * S;' +\n            'float m = 0.494207 * L + 0.0 * M + 1.24827 * S;' +\n            'float s = 0.0 * L + 0.0 * M + 1.0 * S;' +*/\n\n    // LMS to RGB matrix conversion\n    'vec4 error;' +\n    'error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);' +\n    'error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);' +\n    'error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);' +\n    'error.a = 1.0;' +\n    'vec4 diff = o - error;' +\n    'vec4 correction;' +\n    'correction.r = 0.0;' +\n    'correction.g =  (diff.r * 0.7) + (diff.g * 1.0);' +\n    'correction.b =  (diff.r * 0.7) + (diff.b * 1.0);' +\n    'correction = o + correction;' +\n    'correction.a = o.a;' +\n    '//SIMULATE//' +\n    '}';\n\n  private _internalCanvas: HTMLCanvasElement;\n  private _gl: WebGLRenderingContext;\n  private _program: WebGLProgram;\n\n  constructor(public engine: Engine, public simulate: boolean = false, public colorMode: ColorBlindness = ColorBlindness.Protanope) {\n    this._internalCanvas = document.createElement('canvas');\n    this._internalCanvas.width = engine.drawWidth;\n    this._internalCanvas.height = engine.drawHeight;\n\n    this._gl = <WebGLRenderingContext>this._internalCanvas.getContext('webgl', { preserveDrawingBuffer: true });\n\n    this._program = this._gl.createProgram();\n    const fragmentShader = this._getShader('Fragment', this._getFragmentShaderByMode(colorMode));\n    const vertextShader = this._getShader('Vertex', this._vertexShader);\n\n    this._gl.attachShader(this._program, vertextShader);\n    this._gl.attachShader(this._program, fragmentShader);\n    this._gl.linkProgram(this._program);\n\n    if (!this._gl.getProgramParameter(this._program, this._gl.LINK_STATUS)) {\n      Logger.getInstance().error('Unable to link shader program!');\n    }\n\n    this._gl.useProgram(this._program);\n  }\n\n  private _getFragmentShaderByMode(colorMode: ColorBlindness) {\n    let code = '';\n    if (colorMode === ColorBlindness.Protanope) {\n      code =\n        'float l = 0.0 * L + 2.02344 * M + -2.52581 * S;' +\n        'float m = 0.0 * L + 1.0 * M + 0.0 * S;' +\n        'float s = 0.0 * L + 0.0 * M + 1.0 * S;';\n    } else if (colorMode === ColorBlindness.Deuteranope) {\n      code =\n        'float l = 1.0 * L + 0.0 * M + 0.0 * S;' +\n        'float m = 0.494207 * L + 0.0 * M + 1.24827 * S;' +\n        'float s = 0.0 * L + 0.0 * M + 1.0 * S;';\n    } else if (colorMode === ColorBlindness.Tritanope) {\n      code =\n        'float l = 1.0 * L + 0.0 * M + 0.0 * S;' +\n        'float m = 0.0 * L + 1.0 * M + 0.0 * S;' +\n        'float s = -0.395913 * L + 0.801109 * M + 0.0 * S;';\n    }\n\n    if (this.simulate) {\n      this._fragmentShader = this._fragmentShader.replace('//SIMULATE//', 'gl_FragColor = error.rgba;');\n    } else {\n      this._fragmentShader = this._fragmentShader.replace('//SIMULATE//', 'gl_FragColor = correction.rgba;');\n    }\n\n    return this._fragmentShader.replace('//MODE CODE//', code);\n  }\n\n  private _setRectangle(x: number, y: number, width: number, height: number) {\n    const x1 = x;\n    const x2 = x + width;\n    const y1 = y;\n    const y2 = y + height;\n    this._gl.bufferData(this._gl.ARRAY_BUFFER, new Float32Array([x1, y1, x2, y1, x1, y2, x1, y2, x2, y1, x2, y2]), this._gl.STATIC_DRAW);\n  }\n\n  private _getShader(type: string, program: string): WebGLShader {\n    let shader: WebGLShader;\n    if (type === 'Fragment') {\n      shader = this._gl.createShader(this._gl.FRAGMENT_SHADER);\n    } else if (type === 'Vertex') {\n      shader = this._gl.createShader(this._gl.VERTEX_SHADER);\n    } else {\n      Logger.getInstance().error('Error unknown shader type', type);\n    }\n\n    this._gl.shaderSource(shader, program);\n    this._gl.compileShader(shader);\n\n    if (!this._gl.getShaderParameter(shader, this._gl.COMPILE_STATUS)) {\n      Logger.getInstance().error('Unable to compile shader!', this._gl.getShaderInfoLog(shader));\n      return null;\n    }\n\n    return shader;\n  }\n\n  public process(image: ImageData, out: CanvasRenderingContext2D) {\n    // look up where the vertex data needs to go.\n    const positionLocation = this._gl.getAttribLocation(this._program, 'a_position');\n    const texCoordLocation = this._gl.getAttribLocation(this._program, 'a_texCoord');\n\n    const texCoordBuffer = this._gl.createBuffer();\n    this._gl.bindBuffer(this._gl.ARRAY_BUFFER, texCoordBuffer);\n    this._gl.bufferData(\n      this._gl.ARRAY_BUFFER,\n      new Float32Array([0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0]),\n      this._gl.STATIC_DRAW\n    );\n    this._gl.enableVertexAttribArray(texCoordLocation);\n    this._gl.vertexAttribPointer(texCoordLocation, 2, this._gl.FLOAT, false, 0, 0);\n\n    // Create a texture.\n    const texture = this._gl.createTexture();\n    this._gl.bindTexture(this._gl.TEXTURE_2D, texture);\n\n    // Set the parameters so we can render any size image.\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_S, this._gl.CLAMP_TO_EDGE);\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_T, this._gl.CLAMP_TO_EDGE);\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_MIN_FILTER, this._gl.NEAREST);\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_MAG_FILTER, this._gl.NEAREST);\n    // Flip the texture when unpacking into the gl context, gl reads textures in the opposite order as everything else :/\n    this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL, 1);\n    // Upload the image into the texture.\n    this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, image);\n\n    // lookup uniforms\n    const resolutionLocation = this._gl.getUniformLocation(this._program, 'u_resolution');\n\n    // set the resolution\n    this._gl.uniform2f(resolutionLocation, this._internalCanvas.width, this._internalCanvas.height);\n\n    // Create a buffer for the position of the rectangle corners.\n    const positionBuffer = this._gl.createBuffer();\n    this._gl.bindBuffer(this._gl.ARRAY_BUFFER, positionBuffer);\n    this._gl.enableVertexAttribArray(positionLocation);\n    this._gl.vertexAttribPointer(positionLocation, 2, this._gl.FLOAT, false, 0, 0);\n\n    // Set a rectangle the same size as the image.\n    this._setRectangle(0, 0, image.width, image.height);\n\n    // Draw the rectangle.\n    this._gl.drawArrays(this._gl.TRIANGLES, 0, 6);\n\n    // Grab tranformed image from internal canvas\n    const pixelData = new Uint8Array(image.width * image.height * 4);\n    this._gl.readPixels(0, 0, image.width, image.height, this._gl.RGBA, this._gl.UNSIGNED_BYTE, pixelData);\n\n    (<any>image.data).set(pixelData);\n\n    out.putImageData(image, 0, 0);\n  }\n}\n","import { Audio } from '../../Interfaces/Audio';\nimport { Promise } from '../../Promises';\nimport * as Util from '../../Util/Util';\nimport { AudioContextFactory } from './AudioContext';\n\n/**\n * Internal class for producing of AudioInstances\n */\n/* istanbul ignore next */\nexport class AudioInstanceFactory {\n  public static create(src: string | AudioBuffer): AudioInstance {\n    if (typeof src === 'string') {\n      return new AudioTagInstance(src);\n    }\n\n    if (src instanceof AudioBuffer) {\n      return new WebAudioInstance(src);\n    }\n\n    return new AudioInstance(src);\n  }\n}\n\n/**\n * Internal class representing base AudioInstance implementation\n */\n/* istanbul ignore next */\nexport class AudioInstance implements Audio {\n  public set loop(value: boolean) {\n    this._loop = value;\n\n    if (this._instance) {\n      this._instance.loop = value;\n      this._wireUpOnEnded();\n    }\n  }\n  public get loop(): boolean {\n    return this._loop;\n  }\n  public set volume(value: number) {\n    this._volume = Util.clamp(value, 0, 1.0);\n  }\n  public get volume(): number {\n    return this._volume;\n  }\n\n  protected _volume = 1;\n  protected _loop = false;\n  protected _playingPromise: Promise<boolean>;\n  protected _isPlaying = false;\n  protected _isPaused = false;\n  protected _instance: HTMLAudioElement | AudioBufferSourceNode;\n\n  constructor(protected _src: string | AudioBuffer) {}\n\n  public isPlaying() {\n    return this._isPlaying;\n  }\n\n  public pause() {\n    if (!this._isPlaying) {\n      return;\n    }\n\n    this._isPaused = true;\n    this._isPlaying = false;\n  }\n\n  public stop() {\n    if (!this._isPlaying) {\n      return;\n    }\n\n    this._isPlaying = false;\n    this._isPaused = false;\n  }\n\n  public play() {\n    if (this._isPaused) {\n      this._resumePlayBack();\n    }\n\n    if (!this._isPlaying) {\n      this._startPlayBack();\n    }\n\n    return this._playingPromise;\n  }\n\n  protected _startPlayBack() {\n    this._isPlaying = true;\n    this._isPaused = false;\n    this._playingPromise = new Promise<boolean>();\n  }\n\n  protected _resumePlayBack() {\n    if (!this._isPaused) {\n      return;\n    }\n\n    this._isPaused = false;\n    this._isPlaying = true;\n  }\n\n  protected _wireUpOnEnded() {\n    if (!this.loop) {\n      this._instance.onended = () => this._handleOnEnded();\n    }\n  }\n\n  protected _handleOnEnded() {\n    /**\n     * Override me\n     */\n  }\n}\n\n/**\n * Internal class representing a HTML5 audio instance\n */\n/* istanbul ignore next */\nexport class AudioTagInstance extends AudioInstance {\n  public set volume(value: number) {\n    value = Util.clamp(value, 0, 1.0);\n\n    this._volume = value;\n    this._instance.volume = value;\n  }\n  public get volume(): number {\n    return this._volume;\n  }\n\n  protected _src: string;\n  protected _instance: HTMLAudioElement;\n\n  constructor(src: string) {\n    super(src);\n\n    this._instance = new Audio(src);\n  }\n\n  public pause() {\n    if (!this._isPlaying) {\n      return;\n    }\n\n    this._instance.pause();\n    this._isPaused = true;\n    this._isPlaying = false;\n  }\n\n  public stop() {\n    super.stop();\n\n    this._instance.pause();\n    this._instance.currentTime = 0;\n\n    this._handleOnEnded();\n  }\n\n  protected _startPlayBack() {\n    super._startPlayBack();\n\n    this._instance.load();\n    this._instance.loop = this.loop;\n    this._instance.play();\n\n    this._wireUpOnEnded();\n  }\n\n  protected _resumePlayBack() {\n    super._resumePlayBack();\n\n    this._instance.play();\n    this._wireUpOnEnded();\n  }\n\n  protected _handleOnEnded() {\n    this._isPlaying = false;\n    this._isPaused = false;\n    this._playingPromise.resolve(true);\n  }\n}\n\n/**\n * Internal class representing a Web Audio AudioBufferSourceNode instance\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API\n */\n/* istanbul ignore next */\nexport class WebAudioInstance extends AudioInstance {\n  public set volume(value: number) {\n    value = Util.clamp(value, 0, 1.0);\n\n    this._volume = value;\n\n    if (this._volumeNode.gain.setTargetAtTime) {\n      // https://developer.mozilla.org/en-US/docs/Web/API/AudioParam/setTargetAtTime\n      // After each .1 seconds timestep, the target value will ~63.2% closer to the target value.\n      // This exponential ramp provides a more pleasant trasition in gain\n      this._volumeNode.gain.setTargetAtTime(value, this._audioContext.currentTime, 0.1);\n    } else {\n      this._volumeNode.gain.value = value;\n    }\n  }\n  public get volume(): number {\n    return this._volume;\n  }\n\n  private get _playbackRate(): number {\n    return this._instance ? 1 / (this._instance.playbackRate.value || 1.0) : null;\n  }\n\n  protected _src: AudioBuffer;\n  protected _instance: AudioBufferSourceNode;\n  private _audioContext: AudioContext = AudioContextFactory.create();\n  private _volumeNode = this._audioContext.createGain();\n  private _startTime: number;\n\n  /**\n   * Current playback offset (in seconds)\n   */\n  private _currentOffset = 0;\n\n  constructor(_src: AudioBuffer) {\n    super(_src);\n\n    this._createNewBufferSource();\n  }\n\n  public pause() {\n    super.pause();\n\n    this._instance.stop(0);\n    // Playback rate will be a scale factor of how fast/slow the audio is being played\n    // default is 1.0\n    // we need to invert it to get the time scale\n\n    this._setPauseOffset();\n  }\n\n  public stop() {\n    super.stop();\n\n    this._currentOffset = 0;\n    this._instance.stop(0);\n\n    // handler will not be wired up if we were looping\n    if (!this._instance.onended) {\n      this._handleOnEnded();\n    }\n  }\n\n  protected _startPlayBack() {\n    super._startPlayBack();\n\n    if (!this._instance) {\n      this._createNewBufferSource();\n    }\n\n    this._rememberStartTime();\n\n    this._volumeNode.connect(this._audioContext.destination);\n    this._instance.start(0, 0);\n    this._currentOffset = 0;\n\n    this._playingPromise = new Promise<boolean>();\n    this._wireUpOnEnded();\n  }\n\n  protected _resumePlayBack() {\n    super._resumePlayBack();\n\n    // a buffer source can only be started once\n    // so we need to dispose of the previous instance before\n    // \"resuming\" the next one\n    this._instance.onended = null; // dispose of any previous event handler\n    this._createNewBufferSource();\n\n    const duration = this._playbackRate * this._src.duration;\n    const restartTime = this._currentOffset % duration;\n\n    this._rememberStartTime(restartTime * -1000);\n    this._instance.start(0, restartTime);\n    this._wireUpOnEnded();\n  }\n\n  protected _handleOnEnded() {\n    // pausing calls stop(0) which triggers onended event\n    // so we don't \"resolve\" yet (when we resume we'll try again)\n    if (!this._isPaused) {\n      this._isPlaying = false;\n      this._playingPromise.resolve(true);\n    }\n  }\n\n  private _rememberStartTime(amend?: number) {\n    this._startTime = new Date().getTime() + (amend | 0);\n  }\n\n  private _setPauseOffset() {\n    this._currentOffset = ((new Date().getTime() - this._startTime) * this._playbackRate) / 1000; // in seconds\n  }\n\n  private _createNewBufferSource() {\n    this._instance = this._audioContext.createBufferSource();\n    this._instance.buffer = this._src;\n    this._instance.loop = this.loop;\n    this._instance.playbackRate.setValueAtTime(1.0, 0);\n\n    this._instance.connect(this._volumeNode);\n  }\n}\n","import { Logger } from './Log';\n\n/**\n * Whether or not the browser can play this file as HTML5 Audio\n */\nexport function canPlayFile(file: string): boolean {\n  try {\n    const a = new Audio();\n    const filetype = /.*\\.([A-Za-z0-9]+)$/;\n    const type = file.match(filetype)[1];\n    if (a.canPlayType('audio/' + type)) {\n      return true;\n    } else {\n      return false;\n    }\n  } catch (e) {\n    Logger.getInstance().warn('Cannot determine audio support, assuming no support for the Audio Tag', e);\n    return false;\n  }\n}\n","import { ExResponse } from '../../Interfaces/AudioImplementation';\nimport { Audio } from '../../Interfaces/Audio';\nimport { Engine } from '../../Engine';\nimport { Resource } from '../Resource';\nimport { AudioInstance, AudioInstanceFactory } from './AudioInstance';\nimport { AudioContextFactory } from './AudioContext';\nimport { NativeSoundEvent } from '../../Events/MediaEvents';\nimport { Promise } from '../../Promises';\nimport { canPlayFile } from '../../Util/Sound';\n\n/**\n * The [[Sound]] object allows games built in Excalibur to load audio\n * components, from soundtracks to sound effects. [[Sound]] is an [[ILoadable]]\n * which means it can be passed to a [[Loader]] to pre-load before a game or level.\n *\n * [[include:Sounds.md]]\n */\nexport class Sound extends Resource<Blob | ArrayBuffer> implements Audio {\n  /**\n   * Indicates whether the clip should loop when complete\n   * @param value  Set the looping flag\n   */\n  public set loop(value: boolean) {\n    this._loop = value;\n\n    for (const track of this._tracks) {\n      track.loop = this._loop;\n    }\n\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._loop);\n  }\n  public get loop(): boolean {\n    return this._loop;\n  }\n\n  public set volume(value: number) {\n    this._volume = value;\n\n    for (const track of this._tracks) {\n      track.volume = this._volume;\n    }\n\n    this.emit('volumechange', new NativeSoundEvent(this));\n\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._volume);\n  }\n  public get volume(): number {\n    return this._volume;\n  }\n\n  /**\n   * Return array of Current AudioInstances playing or being paused\n   */\n  public get instances(): AudioInstance[] {\n    return this._tracks;\n  }\n\n  public path: string;\n\n  private _loop = false;\n  private _volume = 1;\n  private _isPaused = false;\n  private _tracks: AudioInstance[] = [];\n  private _engine: Engine;\n  private _wasPlayingOnHidden: boolean = false;\n  private _processedData = new Promise<string | AudioBuffer>();\n  private _audioContext = AudioContextFactory.create();\n\n  /**\n   * @param paths A list of audio sources (clip.wav, clip.mp3, clip.ogg) for this audio clip. This is done for browser compatibility.\n   */\n  constructor(...paths: string[]) {\n    super('', '');\n\n    this._detectResponseType();\n    /* Chrome : MP3, WAV, Ogg\n         * Firefox : WAV, Ogg,\n         * IE : MP3, WAV coming soon\n         * Safari MP3, WAV, Ogg\n         */\n    for (const path of paths) {\n      if (canPlayFile(path)) {\n        this.path = path;\n        break;\n      }\n    }\n\n    if (!this.path) {\n      this.logger.warn('This browser does not support any of the audio files specified:', paths.join(', '));\n      this.logger.warn('Attempting to use', paths[0]);\n      this.path = paths[0]; // select the first specified\n    }\n  }\n\n  public wireEngine(engine: Engine) {\n    if (engine) {\n      this._engine = engine;\n\n      this._engine.on('hidden', () => {\n        if (engine.pauseAudioWhenHidden && this.isPlaying()) {\n          this._wasPlayingOnHidden = true;\n          this.pause();\n        }\n      });\n\n      this._engine.on('visible', () => {\n        if (engine.pauseAudioWhenHidden && this._wasPlayingOnHidden) {\n          this.play();\n          this._wasPlayingOnHidden = false;\n        }\n      });\n    }\n  }\n\n  /**\n   * Returns how many instances of the sound are currently playing\n   */\n  public instanceCount(): number {\n    return this._tracks.length;\n  }\n\n  /**\n   * Whether or not the sound is playing right now\n   */\n  public isPlaying(): boolean {\n    return this._tracks.some((t) => t.isPlaying());\n  }\n\n  /**\n   * Play the sound, returns a promise that resolves when the sound is done playing\n   * An optional volume argument can be passed in to play the sound. Max volume is 1.0\n   */\n  public play(volume?: number): Promise<boolean> {\n    if (!this.isLoaded()) {\n      this.logger.warn('Cannot start playing. Resource', this.path, 'is not loaded yet');\n\n      return Promise.resolve(true);\n    }\n\n    this.volume = volume || this.volume;\n\n    if (this._isPaused) {\n      return this._resumePlayback();\n    } else {\n      return this._startPlayback();\n    }\n  }\n\n  /**\n   * Stop the sound, and do not rewind\n   */\n  public pause() {\n    if (!this.isPlaying()) {\n      return;\n    }\n\n    for (const track of this._tracks) {\n      track.pause();\n    }\n\n    this._isPaused = true;\n\n    this.emit('pause', new NativeSoundEvent(this));\n\n    this.logger.debug('Paused all instances of sound', this.path);\n  }\n\n  /**\n   * Stop the sound and rewind\n   */\n  public stop() {\n    if (!this.isPlaying()) {\n      return;\n    }\n\n    for (const track of this._tracks) {\n      track.stop();\n    }\n\n    this.emit('stop', new NativeSoundEvent(this));\n\n    this._isPaused = false;\n    this._tracks.length = 0;\n    this.logger.debug('Stopped all instances of sound', this.path);\n  }\n\n  public setData(data: any) {\n    this.emit('emptied', new NativeSoundEvent(this));\n\n    this.data = data;\n    this._processedData = new Promise<string | AudioBuffer>();\n  }\n\n  public processData(data: Blob | ArrayBuffer): Promise<string | AudioBuffer> {\n    /**\n     * Processes raw arraybuffer data and decodes into WebAudio buffer (async).\n     */\n    const processPromise: Promise<string | AudioBuffer> =\n      data instanceof ArrayBuffer ? this._processArrayBufferData(data) : this._processBlobData(data);\n\n    return processPromise.then((processedData) => this._setProcessedData(processedData));\n  }\n\n  /**\n   * Get Id of provided AudioInstance in current trackList\n   * @param track [[AudioInstance]] which Id is to be given\n   */\n  public getTrackId(track: AudioInstance): number {\n    return this._tracks.indexOf(track);\n  }\n\n  private _resumePlayback(): Promise<boolean> {\n    if (this._isPaused) {\n      const resumed = [];\n      // ensure we resume *current* tracks (if paused)\n      for (const track of this._tracks) {\n        resumed.push(track.play());\n      }\n\n      this._isPaused = false;\n\n      this.emit('resume', new NativeSoundEvent(this));\n\n      this.logger.debug('Resuming paused instances for sound', this.path, this._tracks);\n      // resolve when resumed tracks are done\n      return Promise.join(resumed);\n    } else {\n      return Promise.resolve(true);\n    }\n  }\n\n  private _startPlayback(): Promise<boolean> {\n    const newTrack = this._createNewTrack();\n    const playPromise = new Promise<boolean>();\n\n    newTrack.then((track) => {\n      track.play().then((resolved) => {\n        // when done, remove track\n        this.emit('playbackend', new NativeSoundEvent(this, track));\n        this._tracks.splice(this.getTrackId(track), 1);\n\n        playPromise.resolve(resolved);\n\n        return resolved;\n      });\n\n      this.emit('playbackstart', new NativeSoundEvent(this, track));\n      this.logger.debug('Playing new instance for sound', this.path);\n    });\n\n    return playPromise;\n  }\n\n  private _processArrayBufferData(data: ArrayBuffer): Promise<AudioBuffer> {\n    const complete = new Promise<AudioBuffer>();\n\n    this._audioContext.decodeAudioData(\n      data,\n      (buffer: AudioBuffer) => {\n        complete.resolve(buffer);\n      },\n      () => {\n        this.logger.error(\n          'Unable to decode ' +\n            ' this browser may not fully support this format, or the file may be corrupt, ' +\n            'if this is an mp3 try removing id3 tags and album art from the file.'\n        );\n        complete.resolve(undefined);\n      }\n    );\n\n    return complete;\n  }\n\n  private _processBlobData(data: Blob): Promise<string> {\n    return new Promise<string>().resolve(super.processData(data));\n  }\n\n  private _setProcessedData(processedData: string | AudioBuffer): void {\n    this._processedData.resolve(processedData);\n  }\n\n  private _createNewTrack(): Promise<AudioInstance> {\n    const aiPromise = new Promise<AudioInstance>();\n\n    if (this._processedData.state() !== 0) {\n      this.processData(this.data);\n    }\n\n    this._processedData.then(\n      (processedData) => {\n        aiPromise.resolve(this._getTrackInstance(processedData));\n\n        return processedData;\n      },\n      (error) => {\n        this.logger.error(error, 'Cannot create AudioInstance due to wrong processed data.');\n      }\n    );\n\n    return aiPromise;\n  }\n\n  private _getTrackInstance(data: string | AudioBuffer): AudioInstance {\n    const newTrack = AudioInstanceFactory.create(data);\n\n    newTrack.loop = this.loop;\n    newTrack.volume = this.volume;\n\n    this._tracks.push(newTrack);\n\n    return newTrack;\n  }\n\n  private _detectResponseType() {\n    if ((<any>window).AudioContext) {\n      this.responseType = ExResponse.type.arraybuffer;\n    } else {\n      this.responseType = ExResponse.type.blob;\n    }\n  }\n}\n","import { Resource } from './Resource';\nimport { Promise } from '../Promises';\nimport { Sprite } from '../Drawing/Sprite';\nimport { Texture } from './Texture';\nimport { Color } from '../Drawing/Color';\nimport { SpriteSheet } from '../Drawing/SpriteSheet';\nimport { Animation } from '../Drawing/Animation';\nimport { Engine } from '../Engine';\n/**\n * The [[Texture]] object allows games built in Excalibur to load image resources.\n * [[Texture]] is an [[ILoadable]] which means it can be passed to a [[Loader]]\n * to pre-load before starting a level or game.\n *\n * [[include:Textures.md]]\n */\nexport class Gif extends Resource<Texture[]> {\n  /**\n   * The width of the texture in pixels\n   */\n  public width: number;\n\n  /**\n   * The height of the texture in pixels\n   */\n  public height: number;\n\n  /**\n   * A [[Promise]] that resolves when the Texture is loaded.\n   */\n  public loaded: Promise<any> = new Promise<any>();\n\n  private _isLoaded: boolean = false;\n  private _stream: Stream = null;\n  private _gif: ParseGif = null;\n  private _texture: Texture[] = [];\n  private _animation: Animation = null;\n  private _transparentColor: Color = null;\n\n  /**\n   * Populated once loading is complete\n   */\n  public images: HTMLImageElement;\n\n  /**\n   * @param path       Path to the image resource\n   * @param color      Optionally set the color to treat as transparent the gif, by default [[Color.Magenta]]\n   * @param bustCache  Optionally load texture with cache busting\n   */\n  constructor(public path: string, public color: Color = Color.Magenta, public bustCache = true) {\n    super(path, 'arraybuffer', bustCache);\n    this._transparentColor = color;\n  }\n\n  /**\n   * Returns true if the Texture is completely loaded and is ready\n   * to be drawn.\n   */\n  public isLoaded(): boolean {\n    return this._isLoaded;\n  }\n\n  /**\n   * Begins loading the texture and returns a promise to be resolved on completion\n   */\n  public load(): Promise<Texture[]> {\n    const complete = new Promise<Texture[]>();\n    const loaded = super.load();\n    loaded.then(\n      () => {\n        this._stream = new Stream(this.getData());\n        this._gif = new ParseGif(this._stream, this._transparentColor);\n        const promises: Promise<HTMLImageElement>[] = [];\n        for (let imageIndex: number = 0; imageIndex < this._gif.images.length; imageIndex++) {\n          const texture = new Texture(this._gif.images[imageIndex].src, false);\n          this._texture.push(texture);\n          promises.push(texture.load());\n        }\n        Promise.join(promises).then(() => {\n          this._isLoaded = true;\n          complete.resolve(this._texture);\n        });\n      },\n      () => {\n        complete.reject('Error loading texture.');\n      }\n    );\n    return complete;\n  }\n\n  public asSprite(id: number = 0): Sprite {\n    const sprite = this._texture[id].asSprite();\n    return sprite;\n  }\n\n  public asSpriteSheet(): SpriteSheet {\n    const spriteArray: Sprite[] = this._texture.map((texture) => {\n      return texture.asSprite();\n    });\n    return new SpriteSheet(spriteArray);\n  }\n\n  public asAnimation(engine: Engine, speed: number): Animation {\n    const spriteSheet: SpriteSheet = this.asSpriteSheet();\n    this._animation = spriteSheet.getAnimationForAll(engine, speed);\n    return this._animation;\n  }\n\n  public get readCheckBytes(): number[] {\n    return this._gif.checkBytes;\n  }\n}\n\nexport interface Frame {\n  sentinel: number;\n  type: string;\n  leftPos: number;\n  topPos: number;\n  width: number;\n  height: number;\n  lctFlag: boolean;\n  interlaced: boolean;\n  sorted: boolean;\n  reserved: boolean[];\n  lctSize: number;\n  lzwMinCodeSize: number;\n  pixels: number[];\n}\n\nconst bitsToNum = (ba: any) => {\n  return ba.reduce(function(s: number, n: number) {\n    return s * 2 + n;\n  }, 0);\n};\n\nconst byteToBitArr = (bite: any) => {\n  const a = [];\n  for (let i = 7; i >= 0; i--) {\n    a.push(!!(bite & (1 << i)));\n  }\n  return a;\n};\n\nexport class Stream {\n  data: any = null;\n  len: number = 0;\n  position: number = 0;\n\n  constructor(dataArray: ArrayBuffer) {\n    this.data = new Uint8Array(dataArray);\n    this.len = this.data.byteLength;\n    if (this.len === 0) {\n      throw new Error('No data loaded from file');\n    }\n  }\n\n  public readByte = () => {\n    if (this.position >= this.data.byteLength) {\n      throw new Error('Attempted to read past end of stream.');\n    }\n    return this.data[this.position++];\n  };\n\n  public readBytes = (n: number) => {\n    const bytes = [];\n    for (let i = 0; i < n; i++) {\n      bytes.push(this.readByte());\n    }\n    return bytes;\n  };\n\n  public read = (n: number) => {\n    let s = '';\n    for (let i = 0; i < n; i++) {\n      s += String.fromCharCode(this.readByte());\n    }\n    return s;\n  };\n\n  public readUnsigned = () => {\n    // Little-endian.\n    const a = this.readBytes(2);\n    return (a[1] << 8) + a[0];\n  };\n}\n\nconst lzwDecode = function(minCodeSize: number, data: any) {\n  // TODO: Now that the GIF parser is a bit different, maybe this should get an array of bytes instead of a String?\n  let pos = 0; // Maybe this streaming thing should be merged with the Stream?\n\n  const readCode = function(size: number) {\n    let code = 0;\n    for (let i = 0; i < size; i++) {\n      if (data.charCodeAt(pos >> 3) & (1 << (pos & 7))) {\n        code |= 1 << i;\n      }\n      pos++;\n    }\n    return code;\n  };\n\n  const output: any[] = [];\n\n  const clearCode = 1 << minCodeSize;\n  const eoiCode = clearCode + 1;\n\n  let codeSize = minCodeSize + 1;\n\n  let dict: any[] = [];\n\n  const clear = function() {\n    dict = [];\n    codeSize = minCodeSize + 1;\n    for (let i = 0; i < clearCode; i++) {\n      dict[i] = [i];\n    }\n    dict[clearCode] = [];\n    dict[eoiCode] = null;\n  };\n\n  let code;\n  let last;\n\n  while (true) {\n    last = code;\n    code = readCode(codeSize);\n    if (code === clearCode) {\n      clear();\n      continue;\n    }\n    if (code === eoiCode) {\n      break;\n    }\n\n    if (code < dict.length) {\n      if (last !== clearCode) {\n        dict.push(dict[last].concat(dict[code][0]));\n      }\n    } else {\n      if (code !== dict.length) {\n        throw new Error('Invalid LZW code.');\n      }\n      dict.push(dict[last].concat(dict[last][0]));\n    }\n    output.push.apply(output, dict[code]);\n\n    if (dict.length === 1 << codeSize && codeSize < 12) {\n      // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\n      codeSize++;\n    }\n  }\n\n  // I don't know if this is technically an error, but some GIFs do it.\n  //if (Math.ceil(pos / 8) !== data.length) throw new Error('Extraneous LZW bytes.');\n  return output;\n};\n\n// The actual parsing; returns an object with properties.\nexport class ParseGif {\n  private _st: Stream = null;\n  private _handler: any = {};\n  private _transparentColor: Color = null;\n  public frames: Frame[] = [];\n  public images: HTMLImageElement[] = [];\n  public globalColorTable: any[] = [];\n  public checkBytes: number[] = [];\n\n  constructor(stream: Stream, color: Color = Color.Magenta) {\n    this._st = stream;\n    this._handler = {};\n    this._transparentColor = color;\n    this.parseHeader();\n    this.parseBlock();\n  }\n\n  // LZW (GIF-specific)\n  parseColorTable = (entries: any) => {\n    // Each entry is 3 bytes, for RGB.\n    const ct = [];\n    for (let i = 0; i < entries; i++) {\n      const rgb: number[] = this._st.readBytes(3);\n      const rgba =\n        '#' +\n        rgb\n          .map((x: any) => {\n            const hex = x.toString(16);\n            return hex.length === 1 ? '0' + hex : hex;\n          })\n          .join('');\n      ct.push(rgba);\n    }\n    return ct;\n  };\n\n  readSubBlocks = () => {\n    let size, data;\n    data = '';\n    do {\n      size = this._st.readByte();\n      data += this._st.read(size);\n    } while (size !== 0);\n    return data;\n  };\n\n  parseHeader = () => {\n    const hdr: any = {\n      sig: null,\n      ver: null,\n      width: null,\n      height: null,\n      colorRes: null,\n      globalColorTableSize: null,\n      gctFlag: null,\n      sorted: null,\n      globalColorTable: [],\n      bgColor: null,\n      pixelAspectRatio: null // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\n    };\n\n    hdr.sig = this._st.read(3);\n    hdr.ver = this._st.read(3);\n    if (hdr.sig !== 'GIF') {\n      throw new Error('Not a GIF file.'); // XXX: This should probably be handled more nicely.\n    }\n\n    hdr.width = this._st.readUnsigned();\n    hdr.height = this._st.readUnsigned();\n\n    const bits = byteToBitArr(this._st.readByte());\n    hdr.gctFlag = bits.shift();\n    hdr.colorRes = bitsToNum(bits.splice(0, 3));\n    hdr.sorted = bits.shift();\n    hdr.globalColorTableSize = bitsToNum(bits.splice(0, 3));\n\n    hdr.bgColor = this._st.readByte();\n    hdr.pixelAspectRatio = this._st.readByte(); // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\n\n    if (hdr.gctFlag) {\n      hdr.globalColorTable = this.parseColorTable(1 << (hdr.globalColorTableSize + 1));\n      this.globalColorTable = hdr.globalColorTable;\n    }\n    if (this._handler.hdr && this._handler.hdr(hdr)) {\n      this.checkBytes.push(this._handler.hdr);\n    }\n  };\n\n  parseExt = (block: any) => {\n    const parseGCExt = (block: any) => {\n      this.checkBytes.push(this._st.readByte()); // Always 4\n\n      const bits = byteToBitArr(this._st.readByte());\n      block.reserved = bits.splice(0, 3); // Reserved; should be 000.\n      block.disposalMethod = bitsToNum(bits.splice(0, 3));\n      block.userInput = bits.shift();\n      block.transparencyGiven = bits.shift();\n\n      block.delayTime = this._st.readUnsigned();\n\n      block.transparencyIndex = this._st.readByte();\n\n      block.terminator = this._st.readByte();\n\n      if (this._handler.gce && this._handler.gce(block)) {\n        this.checkBytes.push(this._handler.gce);\n      }\n    };\n\n    const parseComExt = (block: any) => {\n      block.comment = this.readSubBlocks();\n      if (this._handler.com && this._handler.com(block)) {\n        this.checkBytes.push(this._handler.com);\n      }\n    };\n\n    const parsePTExt = (block: any) => {\n      this.checkBytes.push(this._st.readByte()); // Always 12\n      block.ptHeader = this._st.readBytes(12);\n      block.ptData = this.readSubBlocks();\n      if (this._handler.pte && this._handler.pte(block)) {\n        this.checkBytes.push(this._handler.pte);\n      }\n    };\n\n    const parseAppExt = (block: any) => {\n      const parseNetscapeExt = (block: any) => {\n        this.checkBytes.push(this._st.readByte()); // Always 3\n        block.unknown = this._st.readByte(); // ??? Always 1? What is this?\n        block.iterations = this._st.readUnsigned();\n        block.terminator = this._st.readByte();\n        if (this._handler.app && this._handler.app.NETSCAPE && this._handler.app.NETSCAPE(block)) {\n          this.checkBytes.push(this._handler.app);\n        }\n      };\n\n      const parseUnknownAppExt = (block: any) => {\n        block.appData = this.readSubBlocks();\n        // FIXME: This won't work if a handler wants to match on any identifier.\n        if (this._handler.app && this._handler.app[block.identifier] && this._handler.app[block.identifier](block)) {\n          this.checkBytes.push(this._handler.app[block.identifier]);\n        }\n      };\n\n      this.checkBytes.push(this._st.readByte()); // Always 11\n      block.identifier = this._st.read(8);\n      block.authCode = this._st.read(3);\n      switch (block.identifier) {\n        case 'NETSCAPE':\n          parseNetscapeExt(block);\n          break;\n        default:\n          parseUnknownAppExt(block);\n          break;\n      }\n    };\n\n    const parseUnknownExt = (block: any) => {\n      block.data = this.readSubBlocks();\n      if (this._handler.unknown && this._handler.unknown(block)) {\n        this.checkBytes.push(this._handler.unknown);\n      }\n    };\n\n    block.label = this._st.readByte();\n    switch (block.label) {\n      case 0xf9:\n        block.extType = 'gce';\n        parseGCExt(block);\n        break;\n      case 0xfe:\n        block.extType = 'com';\n        parseComExt(block);\n        break;\n      case 0x01:\n        block.extType = 'pte';\n        parsePTExt(block);\n        break;\n      case 0xff:\n        block.extType = 'app';\n        parseAppExt(block);\n        break;\n      default:\n        block.extType = 'unknown';\n        parseUnknownExt(block);\n        break;\n    }\n  };\n\n  parseImg = (img: any) => {\n    const deinterlace = (pixels: any, width: any) => {\n      // Of course this defeats the purpose of interlacing. And it's *probably*\n      // the least efficient way it's ever been implemented. But nevertheless...\n\n      const newPixels = new Array(pixels.length);\n      const rows = pixels.length / width;\n      const cpRow = (toRow: any, fromRow: any) => {\n        const fromPixels = pixels.slice(fromRow * width, (fromRow + 1) * width);\n        newPixels.splice.apply(newPixels, [toRow * width, width].concat(fromPixels));\n      };\n\n      const offsets = [0, 4, 2, 1];\n      const steps = [8, 8, 4, 2];\n\n      let fromRow = 0;\n      for (let pass = 0; pass < 4; pass++) {\n        for (let toRow = offsets[pass]; toRow < rows; toRow += steps[pass]) {\n          cpRow(toRow, fromRow);\n          fromRow++;\n        }\n      }\n\n      return newPixels;\n    };\n\n    img.leftPos = this._st.readUnsigned();\n    img.topPos = this._st.readUnsigned();\n    img.width = this._st.readUnsigned();\n    img.height = this._st.readUnsigned();\n\n    const bits = byteToBitArr(this._st.readByte());\n    img.lctFlag = bits.shift();\n    img.interlaced = bits.shift();\n    img.sorted = bits.shift();\n    img.reserved = bits.splice(0, 2);\n    img.lctSize = bitsToNum(bits.splice(0, 3));\n\n    if (img.lctFlag) {\n      img.lct = this.parseColorTable(1 << (img.lctSize + 1));\n    }\n\n    img.lzwMinCodeSize = this._st.readByte();\n\n    const lzwData = this.readSubBlocks();\n\n    img.pixels = lzwDecode(img.lzwMinCodeSize, lzwData);\n\n    if (img.interlaced) {\n      // Move\n      img.pixels = deinterlace(img.pixels, img.width);\n    }\n\n    this.frames.push(img);\n    this.arrayToImage(img);\n    if (this._handler.img && this._handler.img(img)) {\n      this.checkBytes.push(this._handler);\n    }\n  };\n\n  public parseBlock = () => {\n    const block = {\n      sentinel: this._st.readByte(),\n      type: ''\n    };\n    const blockChar = String.fromCharCode(block.sentinel);\n    switch (blockChar) {\n      case '!':\n        block.type = 'ext';\n        this.parseExt(block);\n        break;\n      case ',':\n        block.type = 'img';\n        this.parseImg(block);\n        break;\n      case ';':\n        block.type = 'eof';\n        if (this._handler.eof && this._handler.eof(block)) {\n          this.checkBytes.push(this._handler.eof);\n        }\n        break;\n      default:\n        throw new Error('Unknown block: 0x' + block.sentinel.toString(16));\n    }\n\n    if (block.type !== 'eof') {\n      this.parseBlock();\n    }\n  };\n\n  arrayToImage = (frame: Frame) => {\n    let count = 0;\n    const c = document.createElement('canvas');\n    c.id = count.toString();\n    c.width = frame.width;\n    c.height = frame.height;\n    count++;\n    const context = c.getContext('2d');\n    const pixSize = 1;\n    let y = 0;\n    let x = 0;\n    for (let i = 0; i < frame.pixels.length; i++) {\n      if (x % frame.width === 0) {\n        y++;\n        x = 0;\n      }\n      if (this.globalColorTable[frame.pixels[i]] === this._transparentColor.toHex()) {\n        context.fillStyle = `rgba(0, 0, 0, 0)`;\n      } else {\n        context.fillStyle = this.globalColorTable[frame.pixels[i]];\n      }\n\n      context.fillRect(x, y, pixSize, pixSize);\n      x++;\n    }\n    const img = new Image();\n    img.src = c.toDataURL();\n    this.images.push(img);\n  };\n}\n","/**\n * The current Excalibur version string\n * @description `process.env.__EX_VERSION` gets replaced by Webpack on build\n */\nexport let EX_VERSION = process.env.__EX_VERSION;\nimport { polyfill } from './Polyfill';\npolyfill();\n\n// This file is used as the bundle entrypoint and exports everything\n// that will be exposed as the `ex` global variable.\n\nexport * from './Engine';\nexport { Actor, ActorArgs as IActorArgs } from './Actor';\nexport { CollisionType } from './Collision/CollisionType';\nexport * from './Algebra';\nexport * from './Camera';\nexport * from './Class';\nexport * from './Configurable';\nexport * from './Debug';\nexport * from './EventDispatcher';\nexport * from './Events/MediaEvents';\nexport * from './Events';\nexport * from './Group';\nexport { Label, FontStyle, FontUnit, TextAlign, BaseAlign } from './Label';\nexport * from './Loader';\nexport { Particle, ParticleEmitter, ParticleArgs, ParticleEmitterArgs, EmitterType } from './Particles';\nexport * from './Physics';\nexport * from './Promises';\nexport * from './Scene';\nexport { TileMap, Cell, TileMapArgs, CellArgs, TileSprite } from './TileMap';\nexport * from './Timer';\nexport * from './Trigger';\nexport * from './UIActor';\n\nexport * from './Actions/Index';\nexport * from './Collision/Index';\nexport * from './Drawing/Index';\nexport * from './Interfaces/Index';\nexport * from './Math/Index';\nexport * from './PostProcessing/Index';\nexport * from './Resources/Index';\n\n// ex.Events namespace\nimport * as events from './Events';\nexport { events as Events };\n\n// ex.Input namespace\nimport * as input from './Input/Index';\nexport { input as Input };\n\n// ex.Traits namespace\nimport * as traits from './Traits/Index';\nexport { traits as Traits };\n\n// ex.Util namespaces\nimport * as util from './Util/Index';\nexport { util as Util };\n\nexport * from './Util/Decorators';\nexport * from './Util/Detector';\nexport * from './Util/CullingBox';\nexport * from './Util/EasingFunctions';\nexport * from './Util/Log';\nexport * from './Util/SortedList';\n\n// ex.Deprecated\nimport * as deprecated from './Deprecated';\nexport { deprecated as Deprecated };\nexport * from './Deprecated';\n"],"sourceRoot":""}