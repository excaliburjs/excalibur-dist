/*! excalibur - v0.7.0 - 2016-08-29
* https://github.com/excaliburjs/Excalibur
* Copyright (c) 2016 Excalibur.js <https://github.com/excaliburjs/Excalibur/graphs/contributors>; Licensed BSD-2-Clause*/
var EX_VERSION = "0.7.0";
var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)};"undefined"==typeof window&&(window={audioContext:function(){}}),"undefined"==typeof window||window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setInterval(t,1e3/60)}),"undefined"==typeof window||window.cancelAnimationFrame||(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(){}),"undefined"==typeof window||window.AudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var i,o;if(null==this)throw new TypeError(" this is null or not defined");var n=Object(this),s=n.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(i=e),o=0;s>o;){var r;o in n&&(r=n[o],t.call(i,r,o,n)),o++}}),Array.prototype.some||(Array.prototype.some=function(t){"use strict";if(void 0===this||null===this)throw new TypeError;var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var o=arguments.length>=2?arguments[1]:void 0,n=0;i>n;n++)if(n in e&&t.call(o,e[n],n,e))return!0;return!1}),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,o=function(){},n=function(){return i.apply(this instanceof o&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return o.prototype=this.prototype,n.prototype=new o,n});var ex;(function(t){var e;(function(e){var i=function(){function t(){}return t.prototype.updatePixel=function(t,e,i){var o=4*(t+e*i.width),n=i.data,s=(n[o+0]+n[o+1]+n[o+2])/3;n[o+0]=s,n[o+1]=s,n[o+2]=s},t}();e.Grayscale=i;var o=function(){function t(){}return t.prototype.updatePixel=function(t,e,i){var o=4*(t+e*i.width),n=i.data;n[o+0]=255-n[o+0],n[o+1]=255-n[o+1],n[o+2]=255-n[o+2]},t}();e.Invert=o;var n=function(){function t(t){this.opacity=t}return t.prototype.updatePixel=function(t,e,i){var o=4*(t+e*i.width),n=i.data;0!==n[o+3]&&(n[o+3]=Math.round(255*this.opacity))},t}();e.Opacity=n;var s=function(){function t(t){this.color=t}return t.prototype.updatePixel=function(t,e,i){var o=4*(t+e*i.width),n=i.data;0!==n[o+3]&&(n[o+0]=(n[o+0]+this.color.r)/2,n[o+1]=(n[o+1]+this.color.g)/2,n[o+2]=(n[o+2]+this.color.b)/2)},t}();e.Colorize=s;var r=function(){function e(t){void 0===t&&(t=.1),this.factor=t}return e.prototype.updatePixel=function(e,i,o){var n=4*(e+i*o.width),s=o.data,r=t.Color.fromRGB(s[n+0],s[n+1],s[n+2],s[n+3]).lighten(this.factor);s[n+0]=r.r,s[n+1]=r.g,s[n+2]=r.b,s[n+3]=r.a},e}();e.Lighten=r;var a=function(){function e(t){void 0===t&&(t=.1),this.factor=t}return e.prototype.updatePixel=function(e,i,o){var n=4*(e+i*o.width),s=o.data,r=t.Color.fromRGB(s[n+0],s[n+1],s[n+2],s[n+3]).darken(this.factor);s[n+0]=r.r,s[n+1]=r.g,s[n+2]=r.b,s[n+3]=r.a},e}();e.Darken=a;var h=function(){function e(t){void 0===t&&(t=.1),this.factor=t}return e.prototype.updatePixel=function(e,i,o){var n=4*(e+i*o.width),s=o.data,r=t.Color.fromRGB(s[n+0],s[n+1],s[n+2],s[n+3]).saturate(this.factor);s[n+0]=r.r,s[n+1]=r.g,s[n+2]=r.b,s[n+3]=r.a},e}();e.Saturate=h;var c=function(){function e(t){void 0===t&&(t=.1),this.factor=t}return e.prototype.updatePixel=function(e,i,o){var n=4*(e+i*o.width),s=o.data,r=t.Color.fromRGB(s[n+0],s[n+1],s[n+2],s[n+3]).desaturate(this.factor);s[n+0]=r.r,s[n+1]=r.g,s[n+2]=r.b,s[n+3]=r.a},e}();e.Desaturate=c;var l=function(){function t(t){this.color=t}return t.prototype.updatePixel=function(t,e,i){var o=4*(t+e*i.width),n=i.data;0!==n[o+3]&&(n[o+0]=this.color.r,n[o+1]=this.color.g,n[o+2]=this.color.b)},t}();e.Fill=l})(e=t.Effects||(t.Effects={}))})(ex||(ex={}));var ex;(function(t){var e=function(){function e(t,e){this.x=t,this.y=e}return e.fromAngle=function(t){return new e(Math.cos(t),Math.sin(t))},e.prototype.setTo=function(t,e){this.x=t,this.y=e},e.prototype.equals=function(t,e){return void 0===e&&(e=.001),e>=Math.abs(this.x-t.x)&&e>=Math.abs(this.y-t.y)},e.prototype.distance=function(t){return t||(t=new e(0,0)),Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},e.prototype.normalize=function(){var t=this.distance();return t>0?new e(this.x/t,this.y/t):new e(0,1)},e.prototype.average=function(t){return this.add(t).scale(.5)},e.prototype.scale=function(t){return new e(this.x*t,this.y*t)},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.addEqual=function(t){return this.x+=t.x,this.y+=t.y,this},e.prototype.subEqual=function(t){return this.x-=t.x,this.y-=t.y,this},e.prototype.scaleEqual=function(t){return this.x*=t,this.y*=t,this},e.prototype.dot=function(t){return this.x*t.x+this.y*t.y},e.prototype.cross=function(t){return t instanceof e?this.x*t.y-this.y*t.x:"number"==typeof t?new e(t*this.y,-t*this.x):void 0},e.prototype.perpendicular=function(){return new e(this.y,-this.x)},e.prototype.normal=function(){return this.perpendicular().normalize()},e.prototype.negate=function(){return this.scale(-1)},e.prototype.toAngle=function(){return Math.atan2(this.y,this.x)},e.prototype.rotate=function(i,o){o||(o=new t.Vector(0,0));var n=Math.sin(i),s=Math.cos(i),r=s*(this.x-o.x)-n*(this.y-o.y)+o.x,a=n*(this.x-o.x)+s*(this.y-o.y)+o.y;return new e(r,a)},e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.toString=function(){return"("+this.x+", "+this.y+")"},e.Zero=new e(0,0),e.Up=new e(0,-1),e.Down=new e(0,1),e.Left=new e(-1,0),e.Right=new e(1,0),e}();t.Vector=e;var i=function(){function t(t,e){this.pos=t,this.dir=e.normalize()}return t.prototype.intersect=function(t){var e=t.begin.sub(this.pos);if(0===this.dir.cross(t.getSlope())&&0!==e.cross(this.dir))return-1;var i=this.dir.cross(t.getSlope());if(0===i)return-1;var o=e.cross(t.getSlope())/i;if(o>=0){var n=e.cross(this.dir)/i/t.getLength();if(n>=0&&1>=n)return o}return-1},t.prototype.getPoint=function(t){return this.pos.add(this.dir.scale(t))},t}();t.Ray=i;var o=function(){function t(t,e){this.begin=t,this.end=e}return t.prototype.getSlope=function(){var t=this.begin,e=this.end,i=t.distance(e);return e.sub(t).scale(1/i)},t.prototype.getLength=function(){var t=this.begin,e=this.end,i=t.distance(e);return i},t}();t.Line=o;var n=function(){function t(t,e){this.min=t,this.max=e}return t.prototype.overlaps=function(t){return this.max>t.min&&t.max>this.min},t.prototype.getOverlap=function(t){return this.overlaps(t)?this.max>t.max?t.max-this.min:this.max-t.min:0},t}();t.Projection=n})(ex||(ex={}));var ex;(function(t){(function(t){t[t.Box=0]="Box",t[t.RigidBody=1]="RigidBody"})(t.CollisionResolutionStrategy||(t.CollisionResolutionStrategy={}));var e=t.CollisionResolutionStrategy;(function(t){t[t.Naive=0]="Naive",t[t.DynamicAABBTree=1]="DynamicAABBTree"})(t.BroadphaseStrategy||(t.BroadphaseStrategy={}));var i=t.BroadphaseStrategy;(function(t){t[t.Euler=0]="Euler"})(t.Integrator||(t.Integrator={}));var o=t.Integrator,n=function(){function n(){}return n.useBoxPhysics=function(){t.Physics.collisionResolutionStrategy=t.CollisionResolutionStrategy.Box},n.useRigidBodyPhysics=function(){t.Physics.collisionResolutionStrategy=t.CollisionResolutionStrategy.RigidBody},n.acc=new t.Vector(0,0),n.enabled=!0,n.collisionPasses=5,n.broadphaseStrategy=i.DynamicAABBTree,n.broadphaseDebug=!1,n.showCollisionNormals=!1,n.showMotionVectors=!1,n.showBounds=!1,n.showArea=!1,n.showContacts=!1,n.showNormals=!1,n.collisionResolutionStrategy=e.Box,n.defaultMass=10,n.integrator=o.Euler,n.integrationSteps=1,n.allowRigidBodyRotation=!0,n}();t.Physics=n})(ex||(ex={}));var ex;(function(t){var e=function(){function e(t,e,i,o,n){this.bodyA=t,this.bodyB=e,this.mtv=i,this.point=o,this.normal=n}return e.prototype.resolve=function(e,i){if(i===t.CollisionResolutionStrategy.RigidBody)this._resolveRigidBodyCollision(e);else{if(i!==t.CollisionResolutionStrategy.Box)throw Error("Unknown collision resolution strategy");this._resolveBoxCollision(e)}},e.prototype._applyBoxImpluse=function(e,i,o,n){if((e.collisionType===t.CollisionType.Active||e.collisionType===t.CollisionType.Elastic)&&i.collisionType!==t.CollisionType.Passive)if(e.collisionType===t.CollisionType.Active&&i.collisionType===t.CollisionType.Active&&(o=o.scale(.5)),e.pos.y+=o.y,e.pos.x+=o.x,e.collisionType===t.CollisionType.Elastic)n===t.Side.Left?e.vel.x=Math.abs(e.vel.x):n===t.Side.Right?e.vel.x=-Math.abs(e.vel.x):n===t.Side.Top?e.vel.y=Math.abs(e.vel.y):n===t.Side.Bottom&&(e.vel.y=-Math.abs(e.vel.y));else{if(0!==this.mtv.x){var s=0;0>=e.vel.x&&0>=i.vel.x?(s=Math.min(e.vel.x,i.vel.x),s=e.vel.x+e.vel.x):e.vel.x>=0&&i.vel.x>=0?(s=Math.max(e.vel.x,i.vel.x),s=e.vel.x+e.vel.x):s=0,e.vel.x=s}if(0!==this.mtv.y){var r=0;r=0>=e.vel.y&&0>=i.vel.y?Math.min(e.vel.y,i.vel.y):e.vel.y>=0&&i.vel.y>=0?Math.max(e.vel.y,i.vel.y):0,e.vel.y=r}}},e.prototype._resolveBoxCollision=function(){var e=this.bodyA.body.actor,i=this.bodyB.body.actor,o=t.Util.getSideFromVector(this.mtv),n=this.mtv.negate();e.emit("collision",new t.CollisionEvent(e,i,o,n)),i.emit("collision",new t.CollisionEvent(i,e,t.Util.getOppositeSide(o),n.negate())),this._applyBoxImpluse(e,i,n,o),this._applyBoxImpluse(i,e,n.negate(),t.Util.getOppositeSide(o))},e.prototype._resolveRigidBodyCollision=function(){var e=this.bodyA.body.actor,i=this.bodyB.body.actor,o=this.mtv;this.point;var n=this.normal;if(e!==i){var s=e.collisionType===t.CollisionType.Fixed?0:1/e.mass,r=i.collisionType===t.CollisionType.Fixed?0:1/i.mass,a=e.collisionType===t.CollisionType.Fixed?0:1/e.moi,h=i.collisionType===t.CollisionType.Fixed?0:1/i.moi,c=Math.min(e.restitution,i.restitution),l=Math.min(e.friction,i.friction);n=n.normalize();var u=n.normal().normalize(),p=this.point.sub(this.bodyA.getCenter()),d=this.point.sub(this.bodyB.getCenter()),f=i.vel.add(d.cross(-i.rx)).sub(e.vel.sub(p.cross(e.rx))),g=f.dot(n),_=f.dot(u),y=p.dot(u),v=p.dot(n),m=d.dot(u),x=d.dot(n);if(!(g>0)){var w=t.Util.getSideFromVector(this.mtv);e.emit("collision",new t.CollisionEvent(this.bodyA.body.actor,this.bodyB.body.actor,w,this.mtv)),i.emit("collision",new t.CollisionEvent(this.bodyB.body.actor,this.bodyA.body.actor,t.Util.getOppositeSide(w),this.mtv.negate()));var b=-((1+c)*g)/(s+r+a*y*y+h*m*m);if(e.collisionType===t.CollisionType.Fixed?(i.vel=i.vel.add(n.scale(b*r)),t.Physics.allowRigidBodyRotation&&(i.rx-=b*h*-d.cross(n)),i.addMtv(o)):i.collisionType===t.CollisionType.Fixed?(e.vel=e.vel.sub(n.scale(b*s)),t.Physics.allowRigidBodyRotation&&(e.rx+=b*a*-p.cross(n)),e.addMtv(o.negate())):(i.vel=i.vel.add(n.scale(b*r)),e.vel=e.vel.sub(n.scale(b*s)),t.Physics.allowRigidBodyRotation&&(i.rx-=b*h*-d.cross(n),e.rx+=b*a*-p.cross(n)),i.addMtv(o.scale(.5)),e.addMtv(o.scale(-.5))),l&&_){var C=f.sub(n.scale(f.dot(n))).normalize(),A=f.dot(C)/(s+r+v*v*a+x*x*h),S=new t.Vector(0,0);S=b*l>=Math.abs(A)?C.scale(A).negate():C.scale(-b*l),e.collisionType===t.CollisionType.Fixed?(i.vel=i.vel.add(S.scale(r)),t.Physics.allowRigidBodyRotation&&(i.rx+=S.dot(C)*h*d.cross(C))):i.collisionType===t.CollisionType.Fixed?(e.vel=e.vel.sub(S.scale(s)),t.Physics.allowRigidBodyRotation&&(e.rx-=S.dot(C)*a*p.cross(C))):(i.vel=i.vel.add(S.scale(r)),e.vel=e.vel.sub(S.scale(s)),t.Physics.allowRigidBodyRotation&&(i.rx+=S.dot(C)*h*d.cross(C),e.rx-=S.dot(C)*a*p.cross(C)))}}}},e}();t.CollisionContact=e})(ex||(ex={}));var ex;(function(t){t.CollisionJumpTable={CollideCircleCircle:function(e,i){var o=e.radius+i.radius,n=e.body.pos.add(e.pos),s=i.body.pos.add(i.pos);if(n.distance(s)>o)return null;var r=s.sub(n).normalize(),a=r.scale(o-s.distance(n)),h=e.getFurthestPoint(r).add(n);return new t.CollisionContact(e,i,a,h,r)},CollideCirclePolygon:function(e,i){i.getAxes();var o=e.getCenter();i.getCenter();var n=e.testSeparatingAxisTheorem(i);if(!n)return null;var s=n.dot(i.getCenter().sub(e.getCenter()));n=0>s?n.negate():n;var r=[],a=i.getFurthestPoint(n.negate()),h=e.getFurthestPoint(n).add(o);return e.contains(a)&&r.push(a),i.contains(h)&&r.push(h),0===r.length&&r.push(h),new t.CollisionContact(e,i,n,2===r.length?r[0].average(r[1]):r[0],n.normalize())},CollideCircleEdge:function(e,i){var o=e.body.pos,n=i.end.sub(i.begin),s=n.dot(i.end.sub(o)),r=n.dot(o.sub(i.begin));if(0>=r){var a=i.begin.sub(o),h=a.dot(a);return h>e.radius*e.radius?null:new t.CollisionContact(e,i,a.normalize().scale(e.radius-Math.sqrt(h)),i.begin,a.normalize())}if(0>=s){var c=i.end.sub(o),l=c.dot(c);return l>e.radius*e.radius?null:new t.CollisionContact(e,i,c.normalize().scale(e.radius-Math.sqrt(l)),i.end,c.normalize())}var u=n.dot(n),p=i.begin.scale(s).add(i.end.scale(r)).scale(1/u),d=o.sub(p),f=d.dot(d);if(f>e.radius*e.radius)return null;var g=n.perpendicular();0>g.dot(o.sub(i.begin))&&(g.x=-g.x,g.y=-g.y),g=g.normalize();var _=g.scale(Math.abs(e.radius-Math.sqrt(f)));return new t.CollisionContact(e,i,_.negate(),p,g.negate())},CollideEdgeEdge:function(){return null},CollidePolygonEdge:function(e,i){var o=e.getCenter(),n=i.end.sub(i.begin),s=n.normal(),r=n.dot(i.end.sub(o)),a=n.dot(o.sub(i.begin)),h=n.dot(n),c=i.begin.scale(r).add(i.end.scale(a)).scale(1/h);o.sub(c);var l=new t.PolygonArea({points:[i.begin,i.end,i.end.sub(s.scale(10)),i.begin.sub(s.scale(10))]}),u=e.testSeparatingAxisTheorem(l);return u?new t.CollisionContact(e,i,u,e.getFurthestPoint(s.negate()),s.negate()):null},CollidePolygonPolygon:function(e,i){e.getAxes().concat(i.getAxes()),e.getTransformedPoints().concat(i.getTransformedPoints());var o=e.testSeparatingAxisTheorem(i);if(!o)return null;var n=o.dot(i.getCenter().sub(e.getCenter()));o=0>n?o.negate():o;var s=[],r=e.getFurthestPoint(o),a=i.getFurthestPoint(o.negate());i.contains(r)&&s.push(r),e.contains(a)&&s.push(a),0===s.length&&s.push(a);var h=2===s.length?s[0].add(s[1]).scale(.5):s[0];return new t.CollisionContact(e,i,o,h,o.normalize())}}})(ex||(ex={}));var ex;(function(t){var e=function(){function e(e){this.pos=t.Vector.Zero.clone(),this.pos=e.pos||t.Vector.Zero.clone(),this.radius=e.radius||0,this.body=e.body||null}return e.prototype.getCenter=function(){return this.body?this.pos.add(this.body.pos):this.pos},e.prototype.contains=function(t){var e=this.body.pos.distance(t);return this.radius>=e?!0:!1},e.prototype.castRay=function(t){var e=this.getCenter(),i=t.dir,o=t.pos,n=Math.sqrt(Math.pow(i.dot(o.sub(e)),2)-Math.pow(o.sub(e).distance(),2)+Math.pow(this.radius,2));if(0>n)return null;var s=0;if(0===n)return s=-i.dot(o.sub(e)),s>0?t.getPoint(s):null;var r=-i.dot(o.sub(e))+n,a=-i.dot(o.sub(e))-n;return t.getPoint(Math.min(r,a))},e.prototype.collide=function(i){if(i instanceof e)return t.CollisionJumpTable.CollideCircleCircle(this,i);if(i instanceof t.PolygonArea)return t.CollisionJumpTable.CollideCirclePolygon(this,i);if(i instanceof t.EdgeArea)return t.CollisionJumpTable.CollideCircleEdge(this,i);throw Error("Circle could not collide with unknown ICollisionArea "+typeof i)},e.prototype.getFurthestPoint=function(t){return this.pos.add(t.normalize().scale(this.radius))},e.prototype.getBounds=function(){return new t.BoundingBox(this.pos.x+this.body.pos.x-this.radius,this.pos.y+this.body.pos.y-this.radius,this.pos.x+this.body.pos.x+this.radius,this.pos.y+this.body.pos.y+this.radius)},e.prototype.getAxes=function(){return null},e.prototype.getMomentOfInertia=function(){var e=this.body?this.body.mass:t.Physics.defaultMass;return e*this.radius*this.radius/2},e.prototype.testSeparatingAxisTheorem=function(t){var e=t.getAxes(),i=t.getCenter(),o=t.getFurthestPoint(this.pos.sub(i));e.push(this.pos.sub(o).normalize());for(var n=Number.MAX_VALUE,s=null,r=-1,a=0;e.length>a;a++){var h=t.project(e[a]),c=this.project(e[a]),l=h.getOverlap(c);if(0>=l)return null;n>l&&(n=l,s=e[a],r=a)}return 0>r?null:s.normalize().scale(n)},e.prototype.recalc=function(){},e.prototype.project=function(e){var i=[],o=this.getCenter(),n=o.dot(e);return i.push(n),i.push(n+this.radius),i.push(n-this.radius),new t.Projection(Math.min.apply(Math,i),Math.max.apply(Math,i))},e.prototype.debugDraw=function(e,i){void 0===i&&(i=t.Color.Green.clone());var o=this.body?this.body.pos.add(this.pos):this.pos,n=this.body?this.body.rotation:0;e.beginPath(),e.strokeStyle=""+i,e.arc(o.x,o.y,this.radius,0,2*Math.PI),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(Math.cos(n)*this.radius+o.x,Math.sin(n)*this.radius+o.y),e.closePath(),e.stroke()},e}();t.CircleArea=e})(ex||(ex={}));var ex;(function(t){var e=function(){function e(e){this.begin=e.begin||t.Vector.Zero.clone(),this.end=e.end||t.Vector.Zero.clone(),this.body=e.body||null,this.pos=this.getCenter()}return e.prototype.getCenter=function(){var t=this.begin.average(this.end).add(this._getBodyPos());return t},e.prototype._getBodyPos=function(){var e=t.Vector.Zero.clone();return this.body.pos&&(e=this.body.pos),e},e.prototype._getTransformedBegin=function(){var t=this.body?this.body.rotation:0;return this.begin.rotate(t).add(this._getBodyPos())},e.prototype._getTransformedEnd=function(){var t=this.body?this.body.rotation:0;return this.end.rotate(t).add(this._getBodyPos())},e.prototype.getSlope=function(){var t=this._getTransformedBegin(),e=this._getTransformedEnd(),i=t.distance(e);return e.sub(t).scale(1/i)},e.prototype.getLength=function(){var t=this._getTransformedBegin(),e=this._getTransformedEnd(),i=t.distance(e);return i},e.prototype.contains=function(){return!1},e.prototype.castRay=function(t){var e=this._getTransformedBegin().sub(t.pos);if(0===t.dir.cross(this.getSlope())&&0!==e.cross(t.dir))return null;var i=t.dir.cross(this.getSlope());if(0===i)return null;var o=e.cross(this.getSlope())/i;if(o>=0){var n=e.cross(t.dir)/i/this.getLength();if(n>=0&&1>=n)return t.getPoint(o)}return null},e.prototype.collide=function(i){if(i instanceof t.CircleArea)return t.CollisionJumpTable.CollideCircleEdge(i,this);if(i instanceof t.PolygonArea)return t.CollisionJumpTable.CollidePolygonEdge(i,this);if(i instanceof e)return t.CollisionJumpTable.CollideEdgeEdge(this,i);throw Error("Circle could not collide with unknown ICollisionArea "+typeof i)},e.prototype.getFurthestPoint=function(t){var e=this._getTransformedBegin(),i=this._getTransformedEnd();return t.dot(e)>0?e:i},e.prototype.getBounds=function(){var e=this._getTransformedBegin(),i=this._getTransformedEnd();return new t.BoundingBox(Math.min(e.x,i.x),Math.min(e.y,i.y),Math.max(e.x,i.x),Math.max(e.y,i.y))},e.prototype.getAxes=function(){var t=this._getTransformedEnd().sub(this._getTransformedBegin()),e=t.normal(),i=[];return i.push(e),i.push(e.negate()),i.push(e.normal()),i.push(e.normal().negate()),i},e.prototype.getMomentOfInertia=function(){var e=this.body?this.body.mass:t.Physics.defaultMass,i=this.end.sub(this.begin).distance()/2;return e*i*i},e.prototype.recalc=function(){},e.prototype.project=function(e){for(var i=[],o=[this._getTransformedBegin(),this._getTransformedEnd()],n=o.length,s=0;n>s;s++)i.push(o[s].dot(e));return new t.Projection(Math.min.apply(Math,i),Math.max.apply(Math,i))},e.prototype.debugDraw=function(e,i){void 0===i&&(i=t.Color.Red.clone()),e.strokeStyle=""+i,e.beginPath(),e.moveTo(this.begin.x,this.begin.y),e.lineTo(this.end.x,this.end.y),e.closePath(),e.stroke()},e}();t.EdgeArea=e})(ex||(ex={}));var ex;(function(t){var e=function(){function e(e){this._transformedPoints=[],this._axes=[],this._sides=[],this.pos=e.pos||t.Vector.Zero.clone();var i=!!e.clockwiseWinding;this.points=(i?e.points.reverse():e.points)||[],this.body=e.body||null,this._calculateTransformation()}return e.prototype.getCenter=function(){return this.body?this.body.pos.add(this.pos):this.pos},e.prototype._calculateTransformation=function(){var t=this.body?this.body.pos.add(this.pos):this.pos,e=this.body?this.body.rotation:0,i=this.points.length;this._transformedPoints.length=0;for(var o=0;i>o;o++)this._transformedPoints[o]=this.points[o].rotate(e).add(t)},e.prototype.getTransformedPoints=function(){return this._transformedPoints.length||this._calculateTransformation(),this._transformedPoints},e.prototype.getSides=function(){if(this._sides.length)return this._sides;for(var e=[],i=this.getTransformedPoints(),o=i.length,n=0;o>n;n++)e.push(new t.Line(i[n],i[(n-1+o)%o]));return this._sides=e,this._sides},e.prototype.recalc=function(){this._sides.length=0,this._axes.length=0,this._transformedPoints.length=0,this.getTransformedPoints(),this.getAxes(),this.getSides()},e.prototype.contains=function(e){var i=new t.Ray(e,new t.Vector(1,0)),o=this.getSides().reduce(function(t,e){return i.intersect(e)>=0?t+1:t},0);return 0===o%2?!1:!0},e.prototype.collide=function(i){if(i instanceof t.CircleArea)return t.CollisionJumpTable.CollideCirclePolygon(i,this);if(i instanceof e)return t.CollisionJumpTable.CollidePolygonPolygon(this,i);if(i instanceof t.EdgeArea)return t.CollisionJumpTable.CollidePolygonEdge(this,i);throw Error("Polygon could not collide with unknown ICollisionArea "+typeof i)},e.prototype.getFurthestPoint=function(t){for(var e=this.getTransformedPoints(),i=null,o=-Number.MAX_VALUE,n=0;e.length>n;n++){var s=t.dot(e[n]);s>o&&(o=s,i=e[n])}return i},e.prototype.getBounds=function(){var e=this.getTransformedPoints(),i=e.reduce(function(t,e){return Math.min(t,e.x)},999999999),o=e.reduce(function(t,e){return Math.max(t,e.x)},-99999999),n=e.reduce(function(t,e){return Math.min(t,e.y)},9999999999),s=e.reduce(function(t,e){return Math.max(t,e.y)},-9999999999);return new t.BoundingBox(i,n,o,s)},e.prototype.getMomentOfInertia=function(){for(var e=this.body?this.body.mass:t.Physics.defaultMass,i=0,o=0,n=0;this.points.length>n;n++){var s=(n+1)%this.points.length,r=this.points[s].cross(this.points[n]);i+=r*(this.points[n].dot(this.points[n])+this.points[n].dot(this.points[s])+this.points[s].dot(this.points[s])),o+=r}return e/6*(i/o)},e.prototype.castRay=function(t){for(var e=this.getSides(),i=e.length,o=Number.MAX_VALUE,n=-1,s=0;i>s;s++){var r=t.intersect(e[s]);r>=0&&o>r&&(o=r,n=s)}return n>=0?t.getPoint(o):null},e.prototype.getAxes=function(){if(this._axes.length)return this._axes;for(var t=[],e=this.getTransformedPoints(),i=e.length,o=0;i>o;o++)t.push(e[o].sub(e[(o+1)%i]).normal());return this._axes=t,this._axes},e.prototype.testSeparatingAxisTheorem=function(t){for(var e=this,i=t,o=e.getAxes().concat(i.getAxes()),n=Number.MAX_VALUE,s=null,r=-1,a=0;o.length>a;a++){var h=e.project(o[a]),c=i.project(o[a]),l=h.getOverlap(c);if(0>=l)return null;n>l&&(n=l,s=o[a],r=a)}return-1===r?null:s.normalize().scale(n)},e.prototype.project=function(e){for(var i=this.getTransformedPoints(),o=i.length,n=Number.MAX_VALUE,s=-Number.MAX_VALUE,r=0;o>r;r++){var a=i[r].dot(e);n=Math.min(n,a),s=Math.max(s,a)}return new t.Projection(n,s)},e.prototype.debugDraw=function(e,i){void 0===i&&(i=t.Color.Red.clone()),e.beginPath(),e.strokeStyle=""+i;var o=this.getTransformedPoints()[0];e.moveTo(o.x,o.y),this.getTransformedPoints().forEach(function(t){e.lineTo(t.x,t.y)}),e.lineTo(o.x,o.y),e.closePath(),e.stroke()},e}();t.PolygonArea=e})(ex||(ex={}));var ex;(function(t){var e;(function(e){var i=function(){function e(){}return e.prototype.update=function(e,i,o){var n=o/1e3,s=e.acc.clone();e.collisionType!==t.CollisionType.Active||e instanceof t.UIActor||e instanceof t.Trigger||e instanceof t.Label||s.addEqual(t.Physics.acc),e.oldVel=e.vel,e.vel.addEqual(s.scale(n)),e.pos.addEqual(e.vel.scale(n)).addEqual(s.scale(.5*n*n)),e.rx+=e.torque*(1/e.moi)*n,e.rotation+=e.rx*n,e.scale.x+=e.sx*o/1e3,e.scale.y+=e.sy*o/1e3},e}();e.EulerMovement=i})(e=t.Traits||(t.Traits={}))})(ex||(ex={}));var ex;(function(t){var e=function(){function e(){this._topLeft=new t.Vector(0,0),this._topRight=new t.Vector(0,0),this._bottomLeft=new t.Vector(0,0),this._bottomRight=new t.Vector(0,0)}return e.prototype.isSpriteOffScreen=function(e,i){var o=e.currentDrawing.width*e.currentDrawing.scale.x,n=e.currentDrawing.height*e.currentDrawing.scale.y,s=e.rotation,r=e.getCenter(),a=e.getWorldPos();this._topLeft.x=a.x-o/2,this._topLeft.y=a.y-n/2,this._topLeft=this._topLeft.rotate(s,r),this._topRight.x=a.x+o/2,this._topRight.y=a.y-n/2,this._topRight=this._topRight.rotate(s,r),this._bottomLeft.x=a.x-o/2,this._bottomLeft.y=a.y+n/2,this._bottomLeft=this._bottomLeft.rotate(s,r),this._bottomRight.x=a.x+o/2,this._bottomRight.y=a.y+n/2,this._bottomRight=this._bottomRight.rotate(s,r);var h=i.worldToScreenCoordinates(this._topLeft),c=i.worldToScreenCoordinates(this._topRight),l=i.worldToScreenCoordinates(this._bottomLeft),u=i.worldToScreenCoordinates(this._bottomRight);this._xCoords=[],this._yCoords=[],this._xCoords.push(h.x,c.x,l.x,u.x),this._yCoords.push(h.y,c.y,l.y,u.y),this._xMin=Math.min.apply(null,this._xCoords),this._yMin=Math.min.apply(null,this._yCoords),this._xMax=Math.max.apply(null,this._xCoords),this._yMax=Math.max.apply(null,this._yCoords);var p=i.screenToWorldCoordinates(new t.Vector(this._xMin,this._yMin)),d=i.screenToWorldCoordinates(new t.Vector(this._xMax,this._yMax));this._xMinWorld=p.x,this._yMinWorld=p.y,this._xMaxWorld=d.x,this._yMaxWorld=d.y;var f=[];f.push(new t.Vector(this._xMin,this._yMin),new t.Vector(this._xMax,this._yMin),new t.Vector(this._xMin,this._yMax),new t.Vector(this._xMax,this._yMax));for(var g=0;f.length>g;g++)if(f[g].x>0&&f[g].y>0&&f[g].x<i.canvas.clientWidth&&f[g].y<i.canvas.clientHeight)return!1;return!0},e.prototype.debugDraw=function(e){e.beginPath(),e.strokeStyle=""+t.Color.White,e.rect(this._xMinWorld,this._yMinWorld,this._xMaxWorld-this._xMinWorld,this._yMaxWorld-this._yMinWorld),e.stroke(),e.fillStyle=""+t.Color.Red,e.beginPath(),e.arc(this._topLeft.x,this._topLeft.y,5,0,2*Math.PI),e.closePath(),e.fill(),e.fillStyle=""+t.Color.Green,e.beginPath(),e.arc(this._topRight.x,this._topRight.y,5,0,2*Math.PI),e.closePath(),e.fill(),e.fillStyle=""+t.Color.Blue,e.beginPath(),e.arc(this._bottomLeft.x,this._bottomLeft.y,5,0,2*Math.PI),e.closePath(),e.fill(),e.fillStyle=""+t.Color.Magenta,e.beginPath(),e.arc(this._bottomRight.x,this._bottomRight.y,5,0,2*Math.PI),e.closePath(),e.fill()},e}();t.CullingBox=e})(ex||(ex={}));var ex;(function(t){var e;(function(e){var i=function(){function e(){this.cullingBox=new t.CullingBox}return e.prototype.update=function(e,i){var o=e.eventDispatcher,n=e.anchor,s=e.getGlobalScale(),r=s.x*e.getWidth()/e.scale.x,a=s.y*e.getHeight()/e.scale.y,h=e.getWorldPos(),c=i.worldToScreenCoordinates(new t.Vector(h.x-n.x*r,h.y-n.y*a)),l=1;e.scene&&e.scene.camera&&(l=e.scene.camera.getZoom());var u=!0;null!=e.currentDrawing&&(u=this.cullingBox.isSpriteOffScreen(e,i)),e.isOffScreen?(c.x+r*l>0&&c.y+a*l>0&&c.x<i.width&&c.y<i.height||!u)&&(o.emit("enterviewport",new t.EnterViewPortEvent),e.isOffScreen=!1):(0>c.x+r*l||0>c.y+a*l||c.x>i.width||c.y>i.height)&&u&&(o.emit("exitviewport",new t.ExitViewPortEvent),e.isOffScreen=!0)},e}();e.OffscreenCulling=i})(e=t.Traits||(t.Traits={}))})(ex||(ex={}));var ex;(function(t){var e;(function(t){var e=function(){function t(){}return t.prototype.update=function(t,e){t.enableCapturePointer&&(t.isKilled()||e.input.pointers.propogate(t))},t}();t.CapturePointer=e})(e=t.Traits||(t.Traits={}))})(ex||(ex={}));var ex;(function(t){var e;(function(e){var i=function(){function e(){}return e.prototype.update=function(e,i){var o=e.eventDispatcher;if(e.collisionType!==t.CollisionType.PreventCollision&&i.currentScene&&i.currentScene.tileMaps)for(var n=0;i.currentScene.tileMaps.length>n;n++)for(var s,r=i.currentScene.tileMaps[n],a=t.Side.None,h=2,c=!1;(s=r.collides(e))&&!(0>h--);)a=e.getSideFromIntersect(s),o.emit("collision",new t.CollisionEvent(e,null,a,s)),(e.collisionType===t.CollisionType.Active||e.collisionType===t.CollisionType.Elastic)&&(e.pos.y+=s.y,e.pos.x+=s.x,e.collisionType!==t.CollisionType.Elastic||c||(c=!0,a===t.Side.Left?e.vel.x=Math.abs(e.vel.x):a===t.Side.Right?e.vel.x=-Math.abs(e.vel.x):a===t.Side.Top?e.vel.y=Math.abs(e.vel.y):a===t.Side.Bottom&&(e.vel.y=-Math.abs(e.vel.y))))},e}();e.TileMapCollisionDetection=i})(e=t.Traits||(t.Traits={}))})(ex||(ex={}));var ex;(function(t){(function(t){t[t.None=0]="None",t[t.Top=1]="Top",t[t.Bottom=2]="Bottom",t[t.Left=3]="Left",t[t.Right=4]="Right"})(t.Side||(t.Side={})),t.Side})(ex||(ex={}));var ex;(function(t){var e;(function(e){function i(){var t={},e=!1,o=0,n=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(e=arguments[0],o++);for(var s=function(o){for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=e&&"[object Object]"===Object.prototype.toString.call(o[n])?i(!0,t[n],o[n]):o[n])};n>o;o++){var r=arguments[o];s(r)}return t}function o(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="",o=0;t.length>o;){var n,s,r=255&t.charCodeAt(o++),a=255&t.charCodeAt(o++),h=255&t.charCodeAt(o++),c=r>>2,l=(3&r)<<4|a>>4;isNaN(a)?n=s=64:(n=(15&a)<<2|h>>6,s=isNaN(h)?64:63&h),i+=e.charAt(c)+e.charAt(l)+e.charAt(n)+e.charAt(s)}return i}function n(t,e,i){return e>=t?e:t>=i?i:t}function s(t,e){return t+Math.random()*(e-t)}function r(t,e){return Math.round(s(t,e))}function a(t){var e=t;if(t>this.TwoPI)for(;e>this.TwoPI;)e-=this.TwoPI;if(0>t)for(;0>e;)e+=this.TwoPI;return e}function h(t){return 180/Math.PI*t}function c(t){return t/180*Math.PI}function l(e){var i=0,o=0,n=function(t){i+=t.offsetLeft,t.offsetParent&&n(t.offsetParent)},s=function(t){o+=t.offsetTop,t.offsetParent&&s(t.offsetParent)};return n(e),s(e),new t.Vector(i,o)}function u(t,e){return-1===e.indexOf(t)?(e.push(t),!0):!1}function p(t,e){var i=-1;return(i=e.indexOf(t))>-1?(e.splice(i,1),!0):!1}function d(t,e){for(var i=0;t.length>i;i++)if(t[i]===e)return!0;return!1}function f(e){return e===t.Side.Top?t.Side.Bottom:e===t.Side.Bottom?t.Side.Top:e===t.Side.Left?t.Side.Right:e===t.Side.Right?t.Side.Left:t.Side.None}function g(e){e.dot(t.Vector.Left),e.dot(t.Vector.Right),e.dot(t.Vector.Up),e.dot(t.Vector.Down);for(var i=[t.Vector.Left,t.Vector.Right,t.Vector.Up,t.Vector.Down],o=[t.Side.Left,t.Side.Right,t.Side.Top,t.Side.Bottom],n=-Number.MAX_VALUE,s=-1,r=0;i.length>r;r++)i[r].dot(e)>n&&(n=i[r].dot(e),s=r);return o[s]}e.TwoPI=2*Math.PI,e.extend=i,e.base64Encode=o,e.clamp=n,e.randomInRange=s,e.randomIntInRange=r,e.canonicalizeAngle=a,e.toDegrees=h,e.toRadians=c,e.getPosition=l,e.addItemToArray=u,e.removeItemToArray=p,e.contains=d,e.getOppositeSide=f,e.getSideFromVector=g;var _=function(){function t(e){void 0===e&&(e=t.DefaultSize),this._internalArray=null,this._endPointer=0,this._internalArray=Array(e)}return t.prototype._resize=function(){for(var t=2*this._internalArray.length,e=Array(t),i=this.count(),o=0;i>o;o++)e[o]=this._internalArray[o];delete this._internalArray,this._internalArray=e},t.prototype.push=function(t){return this._endPointer===this._internalArray.length&&this._resize(),this._internalArray[this._endPointer++]=t},t.prototype.pop=function(){return this._endPointer=0>this._endPointer-1?0:this._endPointer-1,this._internalArray[this._endPointer]},t.prototype.count=function(){return this._endPointer},t.prototype.clear=function(){this._endPointer=0},t.prototype.internalSize=function(){return this._internalArray.length},t.prototype.elementAt=function(t){return t>=this.count()?void 0:this._internalArray[t]},t.prototype.insert=function(t,e){return t>=this.count()&&this._resize(),this._internalArray[t]=e},t.prototype.remove=function(t){var e=this.count();if(0!==e){for(var i=this._internalArray[t],o=t;e>o;o++)this._internalArray[o]=this._internalArray[o+1];return this._endPointer--,i}},t.prototype.removeElement=function(t){var e=this._internalArray.indexOf(t);this.remove(e)},t.prototype.toArray=function(){return this._internalArray.slice(0,this._endPointer)},t.prototype.forEach=function(t){var e=0,i=this.count();for(e;i>e;e++)t.call(this,this._internalArray[e],e)},t.prototype.map=function(t){for(var e=this.count(),i=0;e>i;i++)this._internalArray[i]=t.call(this,this._internalArray[i],i)},t.DefaultSize=200,t
}();e.Collection=_})(e=t.Util||(t.Util={}))})(ex||(ex={}));var ex;(function(t){var e=function(){function e(e,i,o,n,s){var r=this;this.sx=i,this.sy=o,this.swidth=n,this.sheight=s,this.rotation=0,this.anchor=new t.Vector(0,0),this.scale=new t.Vector(1,1),this.logger=t.Logger.getInstance(),this.flipVertical=!1,this.flipHorizontal=!1,this.width=0,this.height=0,this.effects=[],this.internalImage=new Image,this.naturalWidth=0,this.naturalHeight=0,this._spriteCanvas=null,this._spriteCtx=null,this._pixelData=null,this._pixelsLoaded=!1,this._dirtyEffect=!1,(0>i||0>o||0>n||0>s)&&this.logger.error("Sprite cannot have any negative dimensions x:",i,"y:",o,"width:",n,"height:",s),this._texture=e,this._spriteCanvas=document.createElement("canvas"),this._spriteCanvas.width=n,this._spriteCanvas.height=s,this._spriteCtx=this._spriteCanvas.getContext("2d"),this._texture.loaded.then(function(){r._spriteCanvas.width=r._spriteCanvas.width||r._texture.image.naturalWidth,r._spriteCanvas.height=r._spriteCanvas.height||r._texture.image.naturalHeight,r._loadPixels(),r._dirtyEffect=!0}).error(function(t){r.logger.error("Error loading texture ",r._texture.path,t)}),this.width=n,this.height=s,this.naturalWidth=n,this.naturalHeight=s}return e.prototype._loadPixels=function(){if(this._texture.isLoaded()&&!this._pixelsLoaded){var e=t.Util.clamp,i=this._texture.image.naturalWidth||0,o=this._texture.image.naturalHeight||0;this.swidth>i&&this.logger.warn("The sprite width",this.swidth,"exceeds the width",i,"of the backing texture",this._texture.path),this.sheight>o&&this.logger.warn("The sprite height",this.sheight,"exceeds the height",o,"of the backing texture",this._texture.path),this._spriteCtx.drawImage(this._texture.image,e(this.sx,0,i),e(this.sy,0,o),e(this.swidth,0,i),e(this.sheight,0,o),0,0,this.swidth,this.sheight),this.internalImage.src=this._spriteCanvas.toDataURL("image/png"),this._pixelsLoaded=!0}},e.prototype.opacity=function(e){this.addEffect(new t.Effects.Opacity(e))},e.prototype.grayscale=function(){this.addEffect(new t.Effects.Grayscale)},e.prototype.invert=function(){this.addEffect(new t.Effects.Invert)},e.prototype.fill=function(e){this.addEffect(new t.Effects.Fill(e))},e.prototype.colorize=function(e){this.addEffect(new t.Effects.Colorize(e))},e.prototype.lighten=function(e){void 0===e&&(e=.1),this.addEffect(new t.Effects.Lighten(e))},e.prototype.darken=function(e){void 0===e&&(e=.1),this.addEffect(new t.Effects.Darken(e))},e.prototype.saturate=function(e){void 0===e&&(e=.1),this.addEffect(new t.Effects.Saturate(e))},e.prototype.desaturate=function(e){void 0===e&&(e=.1),this.addEffect(new t.Effects.Desaturate(e))},e.prototype.addEffect=function(t){this.effects.push(t),this._texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0},e.prototype.removeEffect=function(t){var e=-1;e="number"==typeof t?t:this.effects.indexOf(t),0>e||e>=this.effects.length||(this.effects.splice(e,1),this._texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0)},e.prototype._applyEffects=function(){var e=t.Util.clamp,i=this._texture.image.naturalWidth||0,o=this._texture.image.naturalHeight||0;this._spriteCtx.clearRect(0,0,this.swidth,this.sheight),this._spriteCtx.drawImage(this._texture.image,e(this.sx,0,i),e(this.sy,0,o),e(this.swidth,0,i),e(this.sheight,0,o),0,0,this.swidth,this.sheight),this._pixelData=this._spriteCtx.getImageData(0,0,this.swidth,this.sheight);var n=0,s=0,r=0,a=this.effects.length;for(n;a>n;n++)for(r=0;this.sheight>r;r++)for(s=0;this.swidth>s;s++)this.effects[n].updatePixel(s,r,this._pixelData);this._spriteCtx.clearRect(0,0,this.swidth,this.sheight),this._spriteCtx.putImageData(this._pixelData,0,0),this.internalImage.src=this._spriteCanvas.toDataURL("image/png")},e.prototype.clearEffects=function(){this.effects.length=0,this._applyEffects()},e.prototype.reset=function(){},e.prototype.debugDraw=function(e,i,o){e.save(),e.translate(i,o),e.rotate(this.rotation);var n=this.width*this.scale.x*this.anchor.x,s=this.height*this.scale.y*this.anchor.y;e.strokeStyle=t.Color.Black,e.strokeRect(-n,-s,this.width*this.scale.x,this.height*this.scale.y),e.restore()},e.prototype.draw=function(t,e,i){this._dirtyEffect&&(this._applyEffects(),this._dirtyEffect=!1),this.width=this.naturalWidth*this.scale.x,this.height=this.naturalHeight*this.scale.y,t.save();var o=this.width*this.anchor.x,n=this.height*this.anchor.y;t.translate(e,i),t.rotate(this.rotation),this.flipHorizontal&&(t.translate(this.swidth*this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,this.sheight*this.scale.y),t.scale(1,-1)),this.internalImage&&t.drawImage(this.internalImage,0,0,this.swidth,this.sheight,-o,-n,this.swidth*this.scale.x,this.sheight*this.scale.y),t.restore()},e.prototype.clone=function(){var t=new e(this._texture,this.sx,this.sy,this.swidth,this.sheight);t.scale=this.scale.clone(),t.rotation=this.rotation,t.flipHorizontal=this.flipHorizontal,t.flipVertical=this.flipVertical;var i=0,o=this.effects.length;for(i;o>i;i++)t.addEffect(this.effects[i]);return t},e}();t.Sprite=e})(ex||(ex={}));var ex;(function(t){var e=function(){function e(e,i,o,n,s){this.image=e,this.columns=i,this.rows=o,this.sprites=[],this._internalImage=e.image,this.sprites=Array(i*o);var r=0,a=0;for(r=0;o>r;r++)for(a=0;i>a;a++)this.sprites[a+r*i]=new t.Sprite(this.image,a*n,r*s,n,s)}return e.prototype.getAnimationByIndices=function(e,i,o){var n=this,s=i.map(function(t){return n.sprites[t]});return s=s.map(function(t){return t.clone()}),new t.Animation(e,s,o)},e.prototype.getAnimationBetween=function(e,i,o,n){var s=this.sprites.slice(i,o);return s=s.map(function(t){return t.clone()}),new t.Animation(e,s,n)},e.prototype.getAnimationForAll=function(e,i){var o=this.sprites.map(function(t){return t.clone()});return new t.Animation(e,o,i)},e.prototype.getSprite=function(t){return t>=0&&this.sprites.length>t?this.sprites[t]:void 0},e}();t.SpriteSheet=e;var i=function(e){function i(i,o,n,s,r,a,h){e.call(this,i,s,r,a,h),this.image=i,this.alphabet=o,this.caseInsensitive=n,this.spWidth=a,this.spHeight=h,this._spriteLookup={},this._colorLookup={},this._currentColor=t.Color.Black.clone(),this._currentOpacity=1,this._sprites={},this._textShadowOn=!1,this._textShadowDirty=!0,this._textShadowColor=t.Color.Black.clone(),this._textShadowSprites={},this._shadowOffsetX=5,this._shadowOffsetY=5,this._sprites=this.getTextSprites()}return __extends(i,e),i.prototype.getTextSprites=function(){for(var t={},e=0;this.alphabet.length>e;e++){var i=this.alphabet[e];this.caseInsensitive&&(i=i.toLowerCase()),t[i]=this.sprites[e].clone()}return t},i.prototype.setTextShadow=function(t,e,i){this._textShadowOn=!0,this._shadowOffsetX=t,this._shadowOffsetY=e,this._textShadowColor=i.clone(),this._textShadowDirty=!0;for(var o in this._sprites)this._textShadowSprites[o]=this._sprites[o].clone()},i.prototype.useTextShadow=function(t){this._textShadowOn=t,t&&this.setTextShadow(5,5,this._textShadowColor)},i.prototype.draw=function(e,i,o,n,s){if(s=this._parseOptions(s),""+this._currentColor!=""+s.color||this._currentOpacity!==s.opacity){this._currentOpacity=s.opacity,this._currentColor=s.color;for(var r in this._sprites)this._sprites[r].clearEffects(),this._sprites[r].fill(s.color),this._sprites[r].opacity(s.opacity)}if(this._textShadowOn&&this._textShadowDirty&&this._textShadowColor){for(var a in this._textShadowSprites)this._textShadowSprites[a].clearEffects(),this._textShadowSprites[a].addEffect(new t.Effects.Fill(this._textShadowColor.clone()));this._textShadowDirty=!1}var h=this.sprites[0],c=h.sheight,l=s.fontSize/c,u=i.length*h.swidth*l+i.length*s.letterSpacing,p=o;s.textAlign===t.TextAlign.Left||s.textAlign===t.TextAlign.Start?p=o:s.textAlign===t.TextAlign.Right||s.textAlign===t.TextAlign.End?p=o-u:s.textAlign===t.TextAlign.Center&&(p=o-u/2);var d=n-c*l;s.baseAlign===t.BaseAlign.Top||s.baseAlign===t.BaseAlign.Hanging?d=n:s.baseAlign===t.BaseAlign.Ideographic||s.baseAlign===t.BaseAlign.Bottom||s.baseAlign===t.BaseAlign.Alphabetic?d=n-c*l:s.baseAlign===t.BaseAlign.Middle&&(d=n-c*l/2);for(var f=0;i.length>f;f++){var g=i[f];this.caseInsensitive&&(g=g.toLowerCase());try{this._textShadowOn&&(this._textShadowSprites[g].scale.x=l,this._textShadowSprites[g].scale.y=l,this._textShadowSprites[g].draw(e,p+this._shadowOffsetX,d+this._shadowOffsetY));var _=this._sprites[g];_.scale.x=l,_.scale.y=l,_.draw(e,p,d),p+=_.width+s.letterSpacing}catch(y){t.Logger.getInstance().error("SpriteFont Error drawing char "+g)}}},i.prototype._parseOptions=function(e){return{fontSize:e.fontSize||10,letterSpacing:e.letterSpacing||0,color:e.color||t.Color.Black.clone(),textAlign:void 0===typeof e.textAlign?t.TextAlign.Left:e.textAlign,baseAlign:void 0===typeof e.baseAlign?t.BaseAlign.Bottom:e.baseAlign,maxWidth:e.maxWidth||-1,opacity:e.opacity||0}},i}(e);t.SpriteFont=i})(ex||(ex={}));var ex;(function(t){var e=function(){function e(e,i,n,s,r,a){var h=this;this.x=e,this.y=i,this.cellWidth=n,this.cellHeight=s,this.rows=r,this.cols=a,this._collidingX=-1,this._collidingY=-1,this._onScreenXStart=0,this._onScreenXEnd=9999,this._onScreenYStart=0,this._onScreenYEnd=9999,this._spriteSheets={},this.logger=t.Logger.getInstance(),this.data=[],this.data=Array(r*a);for(var c=0;a>c;c++)for(var l=0;r>l;l++)(function(){var t=new o(c*n+e,l*s+i,n,s,c+l*a);h.data[c+l*a]=t})()}return e.prototype.registerSpriteSheet=function(t,e){this._spriteSheets[t]=e},e.prototype.collides=function(e){for(var i=e.pos.x+e.getWidth(),o=e.pos.y+e.getHeight(),n=e.getBounds(),s=[],r=n.left;i>=r;r+=Math.min(e.getWidth()/2,this.cellWidth/2))for(var a=n.top;o>=a;a+=Math.min(e.getHeight()/2,this.cellHeight/2)){var h=this.getCellByPoint(r,a);if(h&&h.solid){var c=n.collides(h.getBounds()),l=e.getCenter().sub(h.getCenter());c&&c.dot(l)>0&&s.push(c)}}if(0===s.length)return null;var u=s.reduce(function(e,i){var o=e.x,n=e.y;return Math.abs(e.x)<Math.abs(i.x)&&(o=i.x),Math.abs(e.y)<Math.abs(i.y)&&(n=i.y),new t.Vector(o,n)});return u},e.prototype.getCellByIndex=function(t){return this.data[t]},e.prototype.getCell=function(t,e){return 0>t||0>e||t>=this.cols||e>=this.rows?null:this.data[t+e*this.cols]},e.prototype.getCellByPoint=function(t,e){t=Math.floor((t-this.x)/this.cellWidth),e=Math.floor((e-this.y)/this.cellHeight);var i=this.getCell(t,e);return t>=0&&e>=0&&this.cols>t&&this.rows>e&&i?i:null},e.prototype.update=function(e){var i=e.screenToWorldCoordinates(new t.Vector(0,0)),o=e.screenToWorldCoordinates(new t.Vector(e.canvas.clientWidth,e.canvas.clientHeight));this._onScreenXStart=Math.max(Math.floor(i.x/this.cellWidth)-2,0),this._onScreenYStart=Math.max(Math.floor((i.y-this.y)/this.cellHeight)-2,0),this._onScreenXEnd=Math.max(Math.floor(o.x/this.cellWidth)+2,0),this._onScreenYEnd=Math.max(Math.floor((o.y-this.y)/this.cellHeight)+2,0)},e.prototype.draw=function(t){t.save(),t.translate(this.x,this.y);var e,i,o,n=this._onScreenXStart,s=Math.min(this._onScreenXEnd,this.cols),r=this._onScreenYStart,a=Math.min(this._onScreenYEnd,this.rows);for(n;s>n;n++){for(r;a>r;r++)for(e=this.getCell(n,r).sprites.filter(function(t){return t.spriteId>-1}),i=0,o=e.length;o>i;i++){var h=this._spriteSheets[e[i].spriteSheetKey];if(h){var c=h.getSprite(e[i].spriteId);c?c.draw(t,n*this.cellWidth,r*this.cellHeight):this.logger.warn("Sprite does not exist for id",e[i].spriteId,"in sprite sheet",e[i].spriteSheetKey,c,h)}else this.logger.warn("Sprite sheet",e[i].spriteSheetKey,"does not exist",h)}r=this._onScreenYStart}t.restore()},e.prototype.debugDraw=function(e){var i=this.cols*this.cellWidth,o=this.rows*this.cellHeight;e.save(),e.strokeStyle=""+t.Color.Red;for(var n=0;this.cols+1>n;n++)e.beginPath(),e.moveTo(this.x+n*this.cellWidth,this.y),e.lineTo(this.x+n*this.cellWidth,this.y+o),e.stroke();for(var s=0;this.rows+1>s;s++)e.beginPath(),e.moveTo(this.x,this.y+s*this.cellHeight),e.lineTo(this.x+i,this.y+s*this.cellHeight),e.stroke();var r=t.Color.Red.clone();r.a=.3,this.data.filter(function(t){return t.solid}).forEach(function(t){e.fillStyle=""+r,e.fillRect(t.x,t.y,t.width,t.height)}),this._collidingY>-1&&this._collidingX>-1&&(e.fillStyle=""+t.Color.Cyan,e.fillRect(this.x+this._collidingX*this.cellWidth,this.y+this._collidingY*this.cellHeight,this.cellWidth,this.cellHeight)),e.restore()},e}();t.TileMap=e;var i=function(){function t(t,e){this.spriteSheetKey=t,this.spriteId=e}return t}();t.TileSprite=i;var o=function(){function e(e,i,o,n,s,r,a){void 0===r&&(r=!1),void 0===a&&(a=[]),this.x=e,this.y=i,this.width=o,this.height=n,this.index=s,this.solid=r,this.sprites=a,this._bounds=new t.BoundingBox(this.x,this.y,this.x+this.width,this.y+this.height)}return e.prototype.getBounds=function(){return this._bounds},e.prototype.getCenter=function(){return new t.Vector(this.x+this.width/2,this.y+this.height/2)},e.prototype.pushSprite=function(t){this.sprites.push(t)},e.prototype.removeSprite=function(t){var e=-1;(e=this.sprites.indexOf(t))>-1&&this.sprites.splice(e,1)},e.prototype.clearSprites=function(){this.sprites.length=0},e}();t.Cell=o})(ex||(ex={}));var ex;(function(t){var e=function(){function e(t,e,i,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===o&&(o=0),this.left=t,this.top=e,this.right=i,this.bottom=o}return e.prototype.getWidth=function(){return this.right-this.left},e.prototype.getHeight=function(){return this.bottom-this.top},e.prototype.getPerimeter=function(){var t=this.getWidth(),e=this.getHeight();return 2*(t+e)},e.prototype.getPoints=function(){var e=[];return e.push(new t.Vector(this.left,this.top)),e.push(new t.Vector(this.right,this.top)),e.push(new t.Vector(this.right,this.bottom)),e.push(new t.Vector(this.left,this.bottom)),e},e.prototype.toPolygon=function(e){return new t.PolygonArea({body:e.body,points:this.getPoints(),pos:t.Vector.Zero.clone()})},e.prototype.contains=function(i){return i instanceof t.Vector?this.left<=i.x&&this.top<=i.y&&this.bottom>=i.y&&this.right>=i.x:i instanceof e?this.left<i.left&&this.top<i.top&&i.bottom<this.bottom&&i.right<this.right?!0:!1:!1},e.prototype.combine=function(t){var i=new e(Math.min(this.left,t.left),Math.min(this.top,t.top),Math.max(this.right,t.right),Math.max(this.bottom,t.bottom));return i},e.prototype.collides=function(i){if(i instanceof e){var o=i,n=this.combine(o);if(n.getWidth()<o.getWidth()+this.getWidth()&&n.getHeight()<o.getHeight()+this.getHeight()){var s=0;s=this.right>=o.left&&this.right<=o.right?o.left-this.right:o.right-this.left;var r=0;return r=this.top<=o.bottom&&this.top>=o.top?o.bottom-this.top:o.top-this.bottom,Math.abs(s)<Math.abs(r)?new t.Vector(s,0):new t.Vector(0,r)}return null}return null},e.prototype.debugDraw=function(e,i){void 0===i&&(i=t.Color.Yellow),e.strokeStyle=""+i,e.strokeRect(this.left,this.top,this.getWidth(),this.getHeight())},e}();t.BoundingBox=e})(ex||(ex={}));var ex;(function(t){var e=function(){function e(e){this.actor=e,this.collisionArea=null,this.pos=new t.Vector(0,0),this.oldPos=new t.Vector(0,0),this.vel=new t.Vector(0,0),this.oldVel=new t.Vector(0,0),this.acc=new t.Vector(0,0),this.torque=0,this.mass=1,this.moi=1e3,this.motion=10,this.friction=.99,this.restitution=.2,this.rotation=0,this.rx=0}return e.prototype.getBounds=function(){return t.Physics.collisionResolutionStrategy===t.CollisionResolutionStrategy.Box?this.actor.getBounds():this.collisionArea.getBounds()},e.prototype.getRelativeBounds=function(){return t.Physics.collisionResolutionStrategy===t.CollisionResolutionStrategy.Box?this.actor.getRelativeBounds():this.actor.getRelativeBounds()},e.prototype.useBoxCollision=function(e){void 0===e&&(e=t.Vector.Zero.clone()),this.collisionArea=new t.PolygonArea({body:this,points:this.actor.getRelativeBounds().getPoints(),pos:e}),this.moi=this.collisionArea.getMomentOfInertia()||this.moi},e.prototype.usePolygonCollision=function(e,i){void 0===i&&(i=t.Vector.Zero.clone()),this.collisionArea=new t.PolygonArea({body:this,points:e,pos:i}),this.moi=this.collisionArea.getMomentOfInertia()||this.moi},e.prototype.useCircleCollision=function(e,i){void 0===i&&(i=t.Vector.Zero.clone()),e||(e=this.actor.getWidth()/2),this.collisionArea=new t.CircleArea({body:this,radius:e,pos:i}),this.moi=this.collisionArea.getMomentOfInertia()||this.moi},e.prototype.useEdgeCollision=function(e,i,o){void 0===o&&(o=t.Vector.Zero.clone()),this.collisionArea=new t.EdgeArea({begin:e,end:i,body:this}),this.moi=this.collisionArea.getMomentOfInertia()||this.moi},e.prototype.debugDraw=function(e){t.Physics.showMotionVectors&&(t.Util.DrawUtil.vector(e,t.Color.Yellow,this.pos,this.acc.add(t.Physics.acc)),t.Util.DrawUtil.vector(e,t.Color.Red,this.pos,this.vel),t.Util.DrawUtil.point(e,t.Color.Red,this.pos)),t.Physics.showBounds&&this.getBounds().debugDraw(e,t.Color.Yellow),t.Physics.showArea&&this.collisionArea.debugDraw(e,t.Color.Green)},e}();t.Body=e})(ex||(ex={}));var ex;(function(t){var e=function(){function e(){this.eventDispatcher=new t.EventDispatcher(this)}return e.prototype.on=function(t,e){this.eventDispatcher.on(t,e)},e.prototype.off=function(t,e){this.eventDispatcher.off(t,e)},e.prototype.emit=function(t,e){this.eventDispatcher.emit(t,e)},e.extend=function(t){var i,o=this;i=t&&t.hasOwnProperty("constructor")?t.constructor:function(){return o.apply(this,arguments)};var n=function(){this.constructor=i};if(n.prototype=o.prototype,i.prototype=new n,t)for(var s in t)t.hasOwnProperty(s)&&(i.prototype[s]=t[s]);return i.extend=e.extend,i},e}();t.Class=e})(ex||(ex={}));var ex;(function(t){var e=function(){function t(e,i,o){this.id=0,this.interval=10,this.fcn=function(){},this.repeats=!1,this._elapsedTime=0,this._totalTimeAlive=0,this.complete=!1,this.scene=null,this.id=t.id++,this.interval=i||this.interval,this.fcn=e||this.fcn,this.repeats=o||this.repeats}return t.prototype.update=function(t){this._totalTimeAlive+=t,this._elapsedTime+=t,this._elapsedTime>this.interval&&(this.fcn.call(this),this.repeats?this._elapsedTime=0:this.complete=!0)},t.prototype.getTimeRunning=function(){return this._totalTimeAlive},t.prototype.cancel=function(){this.scene&&this.scene.cancelTimer(this)},t.id=0,t}();t.Timer=e})(ex||(ex={}));var ex;(function(t){var e=function(){function e(){}return e.prototype.register=function(){},e.prototype.remove=function(){},e.prototype.findCollisionContacts=function(e,i){for(var o,n,s=e.filter(function(e){return!e.isKilled()&&e.collisionType!==t.CollisionType.PreventCollision}),r=[],a=0,h=s.length;h>a;a++){o=s[a];for(var c=a+1;h>c;c++){n=s[c];var l;if(l=o.collides(n)){o.getSideFromIntersect(l);var u=new t.CollisionContact(o.collisionArea,n.collisionArea,l,o.pos,l);r.some(function(t){return t.id===u.id})||r.push(u)}}}var p=0,d=r.length;for(p;d>p;p++)r[p].resolve(i,t.Physics.collisionResolutionStrategy);return r},e.prototype.update=function(){return 0},e.prototype.debugDraw=function(){},e}();t.NaiveCollisionBroadphase=e})(ex||(ex={}));var ex;(function(t){var e=function(){function e(e){this.parent=e,this.parent=e||null,this.body=null,this.bounds=new t.BoundingBox,this.left=null,this.right=null,this.height=0}return e.prototype.isLeaf=function(){return!this.left&&!this.right},e}();t.TreeNode=e;var i=function(){function t(){this.root=null,this.nodes={}}return t.prototype.insert=function(t){if(null===this.root)return this.root=t,this.root.parent=null,void 0;for(var i=t.bounds,o=this.root;!o.isLeaf();){var n,s,r=o.left,a=o.right,h=o.bounds.getPerimeter(),c=o.bounds.combine(i),l=c.getPerimeter(),u=2*l,p=2*(l-h),d=0,f=i.combine(r.bounds);r.isLeaf()?d=f.getPerimeter()+p:(s=r.bounds.getPerimeter(),n=f.getPerimeter(),d=n-s+p);var g=0,_=i.combine(a.bounds);if(a.isLeaf()?g=_.getPerimeter()+p:(s=a.bounds.getPerimeter(),n=_.getPerimeter(),g=n-s+p),d>u&&g>u)break;o=g>d?r:a}var y=o.parent,v=new e(y);v.bounds=i.combine(o.bounds),v.height=o.height+1,null!==y?(y.left===o?y.left=v:y.right=v,v.left=o,v.right=t,o.parent=v,t.parent=v):(v.left=o,v.right=t,o.parent=v,t.parent=v,this.root=v);for(var m=t.parent;m;){if(m=this.balance(m),!m.left)throw Error("Parent of current leaf cannot have a null left child"+m);if(!m.right)throw Error("Parent of current leaf cannot have a null right child"+m);m.height=1+Math.max(m.left.height,m.right.height),m.bounds=m.left.bounds.combine(m.right.bounds),m=m.parent}},t.prototype.remove=function(t){if(t===this.root)return this.root=null,void 0;var e,i=t.parent,o=i.parent;if(e=i.left===t?i.right:i.left,o){o.left===i?o.left=e:o.right=e,e.parent=o;for(var n=o;n;)n=this.balance(n),n.bounds=n.left.bounds.combine(n.right.bounds),n.height=1+Math.max(n.left.height,n.right.height),n=n.parent}else this.root=e,e.parent=null},t.prototype.registerBody=function(t){var i=new e;i.body=t,i.bounds=t.getBounds(),i.bounds.left-=2,i.bounds.top-=2,i.bounds.right+=2,i.bounds.bottom+=2,this.nodes[t.actor.id]=i,this.insert(i)},t.prototype.updateBody=function(t){var e=this.nodes[t.actor.id];if(e){var i=t.getBounds();if(e.bounds.contains(i))return!1;this.remove(e),i.left-=5,i.top-=5,i.right+=5,i.bottom+=5;var o=2*t.vel.x,n=2*t.vel.y;return 0>o?i.left+=o:i.right+=o,0>n?i.top+=n:i.bottom+=n,e.bounds=i,this.insert(e),!0}},t.prototype.removeBody=function(t){var e=this.nodes[t.actor.id];e&&(this.remove(e),this.nodes[t.actor.id]=null,delete this.nodes[t.actor.id])},t.prototype.balance=function(t){if(null===t)throw Error("Cannot balance at null node");if(t.isLeaf()||2>t.height)return t;var e=t.left,i=t.right,o=t,n=e,s=i,r=e.left,a=e.right,h=i.left,c=i.right,l=s.height-n.height;if(l>1)return s.left=o,s.parent=o.parent,o.parent=s,s.parent?s.parent.left===o?s.parent.left=s:s.parent.right=s:this.root=s,h.height>c.height?(s.right=h,o.right=c,c.parent=o,o.bounds=n.bounds.combine(c.bounds),s.bounds=o.bounds.combine(h.bounds),o.height=1+Math.max(n.height,c.height),s.height=1+Math.max(o.height,h.height)):(s.right=c,o.right=h,h.parent=o,o.bounds=n.bounds.combine(h.bounds),s.bounds=o.bounds.combine(c.bounds),o.height=1+Math.max(n.height,h.height),s.height=1+Math.max(o.height,c.height)),s;if(-1>l){if(n.left=o,n.parent=o.parent,o.parent=n,n.parent)if(n.parent.left===o)n.parent.left=n;else{if(n.parent.right!==o)throw"Error rotating Dynamic Tree";n.parent.right=n}else this.root=n;return r.height>a.height?(n.right=r,o.left=a,a.parent=o,o.bounds=s.bounds.combine(a.bounds),n.bounds=o.bounds.combine(r.bounds),o.height=1+Math.max(s.height,a.height),n.height=1+Math.max(o.height,r.height)):(n.right=a,o.left=r,r.parent=o,o.bounds=s.bounds.combine(r.bounds),n.bounds=o.bounds.combine(a.bounds),o.height=1+Math.max(s.height,r.height),n.height=1+Math.max(o.height,a.height)),n}return t},t.prototype.getHeight=function(){return null===this.root?0:this.root.height},t.prototype.query=function(t,e){var i=t.getBounds(),o=function(n){return n&&n.bounds.collides(i)?n.isLeaf()&&n.body!==t?e.call(t,n.body)?!0:void 0:o(n.left)||o(n.right):null};return o(this.root)},t.prototype.rayCast=function(){return null},t.prototype.getNodes=function(){var t=function(e){return e?[e].concat(t(e.left),t(e.right)):[]};return t(this.root)},t.prototype.debugDraw=function(t){var e=function(i){i&&(t.strokeStyle=i.isLeaf()?"green":"white",i.bounds.debugDraw(t),i.left&&e(i.left),i.right&&e(i.right))};e(this.root)},t}();t.DynamicTree=i})(ex||(ex={}));var ex;(function(t){var e=function(){function e(){this._dynamicCollisionTree=new t.DynamicTree,this._collisionHash={},this._collisionContactCache=[]}return e.prototype.register=function(t){this._dynamicCollisionTree.registerBody(t.body)},e.prototype.remove=function(t){this._dynamicCollisionTree.removeBody(t.body)},e.prototype._canCollide=function(e,i){var o=e.calculatePairHash(i);return this._collisionHash[o]?!1:e.collisionType===t.CollisionType.Fixed&&i.collisionType===t.CollisionType.Fixed?!1:i.collisionType===t.CollisionType.PreventCollision||i.isKilled()?!1:!0},e.prototype.findCollisionContacts=function(e,i){var o,n=this,s=e.filter(function(e){return!e.isKilled()&&e.collisionType!==t.CollisionType.PreventCollision}),r=[];this._collisionContactCache.forEach(function(t){var e=t.bodyA.collide(t.bodyB);n._collisionHash[t.id]=!0,e&&(e.id=t.id,r.push(e))}),this._collisionContactCache=r;for(var a=0,h=s.length;h>a;a++)o=s[a],this._dynamicCollisionTree.query(o.body,function(t){if(n._canCollide(o,t.actor)){var e=[],i=o.collisionArea,s=t.collisionArea,r=i.collide(s);if(r&&(r.id=o.calculatePairHash(t.actor),e.push(r)),e.length){n._collisionHash[r.id]=!0;for(var a=0,h=e;h.length>a;a++){var c=h[a];n._collisionContactCache.push(c)}}return!1}});var c=0,l=this._collisionContactCache.length;for(c;l>c;c++)this._collisionContactCache[c].resolve(i,t.Physics.collisionResolutionStrategy);return e.forEach(function(t){t.applyMtv()}),this._collisionHash={},this._collisionContactCache},e.prototype.update=function(t){var e=0,i=0,o=t.length;for(i;o>i;i++)this._dynamicCollisionTree.updateBody(t[i].body)&&e++;return e},e.prototype.debugDraw=function(e,i){if(t.Physics.broadphaseDebug&&this._dynamicCollisionTree.debugDraw(e,i),t.Physics.showContacts||t.Physics.showCollisionNormals)for(var o=0;this._collisionContactCache.length>o;o++)t.Physics.showContacts&&t.Util.DrawUtil.point(e,t.Color.Red,this._collisionContactCache[o].point),t.Physics.showCollisionNormals&&t.Util.DrawUtil.vector(e,t.Color.Cyan,this._collisionContactCache[o].point,this._collisionContactCache[o].normal,30)},e}();t.DynamicTreeCollisionBroadphase=e})(ex||(ex={}));var ex;(function(t){var e=function(){function e(){this.z=1,this.dx=0,this.dy=0,this.dz=0,this.ax=0,this.ay=0,this.az=0,this.rotation=0,this.rx=0,this._x=0,this._y=0,this._cameraMoving=!1,this._currentLerpTime=0,this._lerpDuration=1e3,this._totalLerpTime=0,this._lerpStart=null,this._lerpEnd=null,this._isShaking=!1,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._elapsedShakeTime=0,this._xShake=0,this._yShake=0,this._isZooming=!1,this._currentZoomScale=1,this._maxZoomScale=1,this._zoomDuration=0,this._elapsedZoomTime=0,this._zoomIncrement=.01,this._easing=t.EasingFunctions.EaseInOutCubic}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._follow||this._cameraMoving||(this._x=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._follow||this._cameraMoving||(this._y=t)},enumerable:!0,configurable:!0}),e.prototype.setActorToFollow=function(t){this._follow=t},e.prototype.getFocus=function(){return new t.Vector(this.x,this.y)},e.prototype.move=function(e,i,o){if(void 0===o&&(o=t.EasingFunctions.EaseInOutCubic),"function"!=typeof o)throw"Please specify an EasingFunction";return this._follow?(new t.Promise).reject(e):(this._lerpPromise&&this._lerpPromise.state()===t.PromiseState.Pending&&this._lerpPromise.resolve(e),this._lerpPromise=new t.Promise,this._lerpStart=this.getFocus().clone(),this._lerpDuration=i,this._lerpEnd=e,this._currentLerpTime=0,this._cameraMoving=!0,this._easing=o,this._lerpPromise)},e.prototype.shake=function(t,e,i){this._isShaking=!0,this._shakeMagnitudeX=t,this._shakeMagnitudeY=e,this._shakeDuration=i},e.prototype.zoom=function(t,e){void 0===e&&(e=0),this._isZooming=!0,this._maxZoomScale=t,this._zoomDuration=e,e&&(this._zoomIncrement=1e3*(Math.abs(this._maxZoomScale-this._currentZoomScale)/e)),1>this._maxZoomScale?e?this._zoomIncrement=-1*this._zoomIncrement:(this._isZooming=!1,this._setCurrentZoomScale(this._maxZoomScale)):e||(this._isZooming=!1,this._setCurrentZoomScale(this._maxZoomScale))},e.prototype.getZoom=function(){return this.z},e.prototype._setCurrentZoomScale=function(t){this.z=t},e.prototype.update=function(t,e){this._x+=this.dx*e/1e3,this._y+=this.dy*e/1e3,this.z+=this.dz*e/1e3,this.dx+=this.ax*e/1e3,this.dy+=this.ay*e/1e3,this.dz+=this.az*e/1e3,this.rotation+=this.rx*e/1e3,this._cameraMoving&&(this._currentLerpTime<this._lerpDuration?(this._x=this._lerpEnd.x<this._lerpStart.x?this._lerpStart.x-(this._easing(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):this._easing(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._y=this._lerpEnd.y<this._lerpStart.y?this._lerpStart.y-(this._easing(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):this._easing(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._currentLerpTime+=e):(this._x=this._lerpEnd.x,this._y=this._lerpEnd.y,this._lerpPromise.resolve(this._lerpEnd),this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1)),this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._xShake=0,this._yShake=0):(this._elapsedShakeTime+=e,this._xShake=(0|Math.random()*this._shakeMagnitudeX)+1,this._yShake=(0|Math.random()*this._shakeMagnitudeY)+1)},e.prototype.draw=function(t){var e=this.getFocus(),i=t.canvas.width,o=t.canvas.height,n=i/this.getZoom(),s=o/this.getZoom();t.scale(this.getZoom(),this.getZoom()),t.translate(-e.x+n/2+this._xShake,-e.y+s/2+this._yShake)},e.prototype.debugDraw=function(t){var e=this.getFocus();t.fillStyle="red",t.strokeStyle="white",t.lineWidth=3,t.beginPath(),t.arc(e.x,e.y,15,0,2*Math.PI),t.closePath(),t.stroke(),t.beginPath(),t.arc(e.x,e.y,5,0,2*Math.PI),t.closePath(),t.stroke()},e.prototype._isDoneShaking=function(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration},e.prototype._isDoneZooming=function(){return 0!==this._zoomDuration?this._elapsedZoomTime>=this._zoomDuration:1>this._maxZoomScale?this._currentZoomScale<=this._maxZoomScale:this._currentZoomScale>=this._maxZoomScale},e}();t.BaseCamera=e;var i=function(e){function i(){e.apply(this,arguments)}return __extends(i,e),i.prototype.getFocus=function(){return this._follow?new t.Vector(this._follow.pos.x+this._follow.getWidth()/2,e.prototype.getFocus.call(this).y):e.prototype.getFocus.call(this)},i}(e);t.SideCamera=i;var o=function(e){function i(){e.apply(this,arguments)}return __extends(i,e),i.prototype.getFocus=function(){return this._follow?new t.Vector(this._follow.pos.x+this._follow.getWidth()/2,this._follow.pos.y+this._follow.getHeight()/2):e.prototype.getFocus.call(this)},i}(e);t.LockedCamera=o})(ex||(ex={}));var ex;(function(t){(function(t){t[t.ShortestPath=0]="ShortestPath",t[t.LongestPath=1]="LongestPath",t[t.Clockwise=2]="Clockwise",t[t.CounterClockwise=3]="CounterClockwise"})(t.RotationType||(t.RotationType={})),t.RotationType})(ex||(ex={}));var ex;(function(t){var e;(function(e){var i;(function(e){var i=function(){function e(e,i,o,n,s){this.actor=e,this.easingFcn=s,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=new t.Vector(0,0),this._lerpEnd=new t.Vector(0,0),this._initialized=!1,this._stopped=!1,this._distance=0,this._lerpDuration=n,this._lerpEnd=new t.Vector(i,o)}return e.prototype._initialize=function(){this._lerpStart=new t.Vector(this.actor.pos.x,this.actor.pos.y),this._currentLerpTime=0,this._distance=this._lerpStart.distance(this._lerpEnd)},e.prototype.update=function(t){this._initialized||(this._initialize(),this._initialized=!0);var e=this.actor.pos.x,i=this.actor.pos.y;this._currentLerpTime<this._lerpDuration?(e=this._lerpEnd.x<this._lerpStart.x?this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),i=this._lerpEnd.y<this._lerpStart.y?this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this.actor.pos.x=e,this.actor.pos.y=i,this._currentLerpTime+=t):(this.actor.pos.x=this._lerpEnd.x,this.actor.pos.y=this._lerpEnd.y)},e.prototype.isComplete=function(e){return this._stopped||new t.Vector(e.pos.x,e.pos.y).distance(this._lerpStart)>=this._distance},e.prototype.reset=function(){this._initialized=!1},e.prototype.stop=function(){this._stopped=!0},e}();e.EaseTo=i;var o=function(){function e(e,i,o,n){this._started=!1,this._stopped=!1,this._actor=e,this._end=new t.Vector(i,o),this._speed=n
}return e.prototype.update=function(){this._started||(this._started=!0,this._start=new t.Vector(this._actor.pos.x,this._actor.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());var e=this._dir.scale(this._speed);this._actor.vel.x=e.x,this._actor.vel.y=e.y,this.isComplete(this._actor)&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},e.prototype.isComplete=function(e){return this._stopped||new t.Vector(e.pos.x,e.pos.y).distance(this._start)>=this._distance},e.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},e.prototype.reset=function(){this._started=!1},e}();e.MoveTo=o;var n=function(){function e(e,i,o,n){if(this._started=!1,this._stopped=!1,this._actor=e,this._end=new t.Vector(i,o),0>=n)throw t.Logger.getInstance().error("Attempted to moveBy time less than or equal to zero : "+n),Error("Cannot move in time <= 0");this._time=n}return e.prototype.update=function(){this._started||(this._started=!0,this._start=new t.Vector(this._actor.pos.x,this._actor.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize(),this._speed=this._distance/(this._time/1e3));var e=this._dir.scale(this._speed);this._actor.vel.x=e.x,this._actor.vel.y=e.y,this.isComplete(this._actor)&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},e.prototype.isComplete=function(e){return this._stopped||new t.Vector(e.pos.x,e.pos.y).distance(this._start)>=this._distance},e.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},e.prototype.reset=function(){this._started=!1},e}();e.MoveBy=n;var s=function(){function e(e,i,o){this._started=!1,this._stopped=!1,this._actor=e,this._actorToFollow=i,this._current=new t.Vector(this._actor.pos.x,this._actor.pos.y),this._end=new t.Vector(i.pos.x,i.pos.y),this._maximumDistance=void 0!==o?o:this._current.distance(this._end),this._speed=0}return e.prototype.update=function(){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());var t=Math.sqrt(Math.pow(this._actorToFollow.vel.x,2)+Math.pow(this._actorToFollow.vel.y,2));if(0!==t&&(this._speed=t),this._current.x=this._actor.pos.x,this._current.y=this._actor.pos.y,this._end.x=this._actorToFollow.pos.x,this._end.y=this._actorToFollow.pos.y,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){var e=this._dir.scale(this._speed);this._actor.vel.x=e.x,this._actor.vel.y=e.y}else this._actor.vel.x=0,this._actor.vel.y=0;this.isComplete(this._actor)&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},e.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},e.prototype.isComplete=function(){return this._stopped},e.prototype.reset=function(){this._started=!1},e}();e.Follow=s;var r=function(){function e(e,i,o){this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._actor=e,this._actorToMeet=i,this._current=new t.Vector(this._actor.pos.x,this._actor.pos.y),this._end=new t.Vector(i.pos.x,i.pos.y),this._speed=o||0,void 0!==o&&(this._speedWasSpecified=!0)}return e.prototype.update=function(){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());var t=Math.sqrt(Math.pow(this._actorToMeet.vel.x,2)+Math.pow(this._actorToMeet.vel.y,2));0===t||this._speedWasSpecified||(this._speed=t),this._current.x=this._actor.pos.x,this._current.y=this._actor.pos.y,this._end.x=this._actorToMeet.pos.x,this._end.y=this._actorToMeet.pos.y,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();var e=this._dir.scale(this._speed);this._actor.vel.x=e.x,this._actor.vel.y=e.y,this.isComplete(this._actor)&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},e.prototype.isComplete=function(){return this._stopped||1>=this._distanceBetween},e.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},e.prototype.reset=function(){this._started=!1},e}();e.Meet=r;var a=function(){function e(e,i,o,n){this._started=!1,this._stopped=!1,this._actor=e,this._end=i,this._speed=o,this._rotationType=n||t.RotationType.ShortestPath}return e.prototype.update=function(){if(!this._started){this._started=!0,this._start=this._actor.rotation;var e=Math.abs(this._end-this._start),i=t.Util.TwoPI-e;switch(e>i?(this._shortDistance=i,this._longDistance=e):(this._shortDistance=e,this._longDistance=i),this._shortestPathIsPositive=(this._start-this._end+t.Util.TwoPI)%t.Util.TwoPI>=Math.PI,this._rotationType){case t.RotationType.ShortestPath:this._distance=this._shortDistance,this._direction=this._shortestPathIsPositive?1:-1;break;case t.RotationType.LongestPath:this._distance=this._longDistance,this._direction=this._shortestPathIsPositive?-1:1;break;case t.RotationType.Clockwise:this._direction=1,this._distance=this._shortestPathIsPositive?this._shortDistance:this._longDistance;break;case t.RotationType.CounterClockwise:this._direction=-1,this._distance=this._shortestPathIsPositive?this._longDistance:this._shortDistance}}this._actor.rx=this._direction*this._speed,this.isComplete(this._actor)&&(this._actor.rotation=this._end,this._actor.rx=0,this._stopped=!0)},e.prototype.isComplete=function(){var t=Math.abs(this._actor.rotation-this._start);return this._stopped||t>=Math.abs(this._distance)},e.prototype.stop=function(){this._actor.rx=0,this._stopped=!0},e.prototype.reset=function(){this._started=!1},e}();e.RotateTo=a;var h=function(){function e(e,i,o,n){this._started=!1,this._stopped=!1,this._actor=e,this._end=i,this._time=o,this._rotationType=n||t.RotationType.ShortestPath}return e.prototype.update=function(){if(!this._started){this._started=!0,this._start=this._actor.rotation;var e=Math.abs(this._end-this._start),i=t.Util.TwoPI-e;switch(e>i?(this._shortDistance=i,this._longDistance=e):(this._shortDistance=e,this._longDistance=i),this._shortestPathIsPositive=(this._start-this._end+t.Util.TwoPI)%t.Util.TwoPI>=Math.PI,this._rotationType){case t.RotationType.ShortestPath:this._distance=this._shortDistance,this._direction=this._shortestPathIsPositive?1:-1;break;case t.RotationType.LongestPath:this._distance=this._longDistance,this._direction=this._shortestPathIsPositive?-1:1;break;case t.RotationType.Clockwise:this._direction=1,this._distance=this._shortDistance>=0?this._shortDistance:this._longDistance;break;case t.RotationType.CounterClockwise:this._direction=-1,this._distance=0>=this._shortDistance?this._shortDistance:this._longDistance}this._speed=Math.abs(1e3*(this._distance/this._time))}this._actor.rx=this._direction*this._speed,this.isComplete(this._actor)&&(this._actor.rotation=this._end,this._actor.rx=0,this._stopped=!0)},e.prototype.isComplete=function(){var t=Math.abs(this._actor.rotation-this._start);return this._stopped||t>=Math.abs(this._distance)},e.prototype.stop=function(){this._actor.rx=0,this._stopped=!0},e.prototype.reset=function(){this._started=!1},e}();e.RotateBy=h;var c=function(){function t(t,e,i,o,n){this._started=!1,this._stopped=!1,this._actor=t,this._endX=e,this._endY=i,this._speedX=o,this._speedY=n}return t.prototype.update=function(){if(this._started||(this._started=!0,this._startX=this._actor.scale.x,this._startY=this._actor.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._actor.scale.x-this._startX)>=this._distanceX)this._actor.sx=0;else{var t=this._endY<this._startY?-1:1;this._actor.sx=this._speedX*t}if(Math.abs(this._actor.scale.y-this._startY)>=this._distanceY)this._actor.sy=0;else{var e=this._endY<this._startY?-1:1;this._actor.sy=this._speedY*e}this.isComplete(this._actor)&&(this._actor.scale.x=this._endX,this._actor.scale.y=this._endY,this._actor.sx=0,this._actor.sy=0)},t.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.scale.y-this._startX)>=this._distanceX&&Math.abs(this._actor.scale.y-this._startY)>=this._distanceY},t.prototype.stop=function(){this._actor.sx=0,this._actor.sy=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}();e.ScaleTo=c;var l=function(){function t(t,e,i,o){this._started=!1,this._stopped=!1,this._actor=t,this._endX=e,this._endY=i,this._time=o,this._speedX=1e3*((this._endX-this._actor.scale.x)/o),this._speedY=1e3*((this._endY-this._actor.scale.y)/o)}return t.prototype.update=function(){this._started||(this._started=!0,this._startX=this._actor.scale.x,this._startY=this._actor.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY));var t=this._endX<this._startX?-1:1,e=this._endY<this._startY?-1:1;this._actor.sx=this._speedX*t,this._actor.sy=this._speedY*e,this.isComplete(this._actor)&&(this._actor.scale.x=this._endX,this._actor.scale.y=this._endY,this._actor.sx=0,this._actor.sy=0)},t.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.scale.x-this._startX)>=this._distanceX&&Math.abs(this._actor.scale.y-this._startY)>=this._distanceY},t.prototype.stop=function(){this._actor.sx=0,this._actor.sy=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}();e.ScaleBy=l;var u=function(){function t(t,e){this._elapsedTime=0,this._started=!1,this._stopped=!1,this._actor=t,this._delay=e}return t.prototype.update=function(t){this._started||(this._started=!0),this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._elapsedTime+=t},t.prototype.isComplete=function(){return this._stopped||this._elapsedTime>=this._delay},t.prototype.stop=function(){this._stopped=!0},t.prototype.reset=function(){this._elapsedTime=0,this._started=!1},t}();e.Delay=u;var p=function(){function t(t,e,i,o){void 0===o&&(o=1),this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._actor=t,this._timeVisible=e,this._timeNotVisible=i,this._duration=(e+i)*o}return t.prototype.update=function(t){this._started||(this._started=!0),this._elapsedTime+=t,this._totalTime+=t,this._actor.visible&&this._elapsedTime>=this._timeVisible&&(this._actor.visible=!1,this._elapsedTime=0),!this._actor.visible&&this._elapsedTime>=this._timeNotVisible&&(this._actor.visible=!0,this._elapsedTime=0),this.isComplete(this._actor)&&(this._actor.visible=!0)},t.prototype.isComplete=function(){return this._stopped||this._totalTime>=this._duration},t.prototype.stop=function(){this._actor.visible=!0,this._stopped=!0},t.prototype.reset=function(){this._started=!1,this._elapsedTime=0,this._totalTime=0},t}();e.Blink=p;var d=function(){function e(t,e,i){this._multiplyer=1,this._started=!1,this._stopped=!1,this._actor=t,this._endOpacity=e,this._speed=i,t.opacity>e&&(this._multiplyer=-1)}return e.prototype.update=function(e){this._started||(this._started=!0),this._speed>0&&(this._actor.opacity+=this._multiplyer*Math.abs(this._actor.opacity-this._endOpacity)*e/this._speed),this._speed-=e,t.Logger.getInstance().debug("actor opacity: "+this._actor.opacity),this.isComplete(this._actor)&&(this._actor.opacity=this._endOpacity)},e.prototype.isComplete=function(){return this._stopped||.05>Math.abs(this._actor.opacity-this._endOpacity)},e.prototype.stop=function(){this._stopped=!0},e.prototype.reset=function(){this._started=!1},e}();e.Fade=d;var f=function(){function t(t){this._started=!1,this._stopped=!1,this._actor=t}return t.prototype.update=function(){this._actor.actionQueue.clearActions(),this._actor.kill(),this._stopped=!0},t.prototype.isComplete=function(){return this._stopped},t.prototype.stop=function(){},t.prototype.reset=function(){},t}();e.Die=f;var g=function(){function t(t,e){this._method=null,this._actor=null,this._hasBeenCalled=!1,this._actor=t,this._method=e}return t.prototype.update=function(){this._method.call(this._actor),this._hasBeenCalled=!0},t.prototype.isComplete=function(){return this._hasBeenCalled},t.prototype.reset=function(){this._hasBeenCalled=!1},t.prototype.stop=function(){this._hasBeenCalled=!0},t}();e.CallMethod=g;var _=function(){function t(t,e,i){this._stopped=!1,this._actor=t,this._actionQueue=new v(t),this._repeat=e,this._originalRepeat=e;var o=0,n=i.length;for(o;n>o;o++)i[o].reset(),this._actionQueue.add(i[o])}return t.prototype.update=function(t){this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._actionQueue.hasNext()||(this._actionQueue.reset(),this._repeat--),this._actionQueue.update(t)},t.prototype.isComplete=function(){return this._stopped||0>=this._repeat},t.prototype.stop=function(){this._stopped=!0},t.prototype.reset=function(){this._repeat=this._originalRepeat},t}();e.Repeat=_;var y=function(){function t(t,e){this._stopped=!1,this._actor=t,this._actionQueue=new v(t);var i=0,o=e.length;for(i;o>i;i++)e[i].reset(),this._actionQueue.add(e[i])}return t.prototype.update=function(t){this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._stopped||(this._actionQueue.hasNext()||this._actionQueue.reset(),this._actionQueue.update(t))},t.prototype.isComplete=function(){return this._stopped},t.prototype.stop=function(){this._stopped=!0,this._actionQueue.clearActions()},t.prototype.reset=function(){},t}();e.RepeatForever=y;var v=function(){function t(t){this._actions=[],this._completedActions=[],this._actor=t}return t.prototype.add=function(t){this._actions.push(t)},t.prototype.remove=function(t){var e=this._actions.indexOf(t);this._actions.splice(e,1)},t.prototype.clearActions=function(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()},t.prototype.getActions=function(){return this._actions.concat(this._completedActions)},t.prototype.hasNext=function(){return this._actions.length>0},t.prototype.reset=function(){this._actions=this.getActions();var t=0,e=this._actions.length;for(t;e>t;t++)this._actions[t].reset();this._completedActions=[]},t.prototype.update=function(t){this._actions.length>0&&(this._currentAction=this._actions[0],this._currentAction.update(t),this._currentAction.isComplete(this._actor)&&this._completedActions.push(this._actions.shift()))},t}();e.ActionQueue=v})(i=e.Actions||(e.Actions={}))})(e=t.Internal||(t.Internal={}))})(ex||(ex={}));var ex;(function(t){var e=function(){function e(){this._actors=[],this._queues=[],null!==arguments&&(this._actors=Array.prototype.slice.call(arguments,0),this._queues=this._actors.map(function(t){return t.actionQueue}))}return e.prototype.clearActions=function(){var t=0,e=this._queues.length;for(t;e>t;t++)this._queues[t].clearActions()},e.prototype.addActorToContext=function(t){this._actors.push(t),this._queues.push(t.actionQueue)},e.prototype.removeActorFromContext=function(t){var e=this._actors.indexOf(t);e>-1&&(this._actors.splice(e,1),this._queues.splice(e,1))},e.prototype.easeTo=function(e,i,o,n){void 0===n&&(n=t.EasingFunctions.Linear);var s=0,r=this._queues.length;for(s;r>s;s++)this._queues[s].add(new t.Internal.Actions.EaseTo(this._actors[s],e,i,o,n));return this},e.prototype.moveTo=function(e,i,o){var n=0,s=this._queues.length;for(n;s>n;n++)this._queues[n].add(new t.Internal.Actions.MoveTo(this._actors[n],e,i,o));return this},e.prototype.moveBy=function(e,i,o){var n=0,s=this._queues.length;for(n;s>n;n++)this._queues[n].add(new t.Internal.Actions.MoveBy(this._actors[n],e,i,o));return this},e.prototype.rotateTo=function(e,i,o){var n=0,s=this._queues.length;for(n;s>n;n++)this._queues[n].add(new t.Internal.Actions.RotateTo(this._actors[n],e,i,o));return this},e.prototype.rotateBy=function(e,i,o){var n=0,s=this._queues.length;for(n;s>n;n++)this._queues[n].add(new t.Internal.Actions.RotateBy(this._actors[n],e,i,o));return this},e.prototype.scaleTo=function(e,i,o,n){var s=0,r=this._queues.length;for(s;r>s;s++)this._queues[s].add(new t.Internal.Actions.ScaleTo(this._actors[s],e,i,o,n));return this},e.prototype.scaleBy=function(e,i,o){var n=0,s=this._queues.length;for(n;s>n;n++)this._queues[n].add(new t.Internal.Actions.ScaleBy(this._actors[n],e,i,o));return this},e.prototype.blink=function(e,i,o){void 0===o&&(o=1);var n=0,s=this._queues.length;for(n;s>n;n++)this._queues[n].add(new t.Internal.Actions.Blink(this._actors[n],e,i,o));return this},e.prototype.fade=function(e,i){var o=0,n=this._queues.length;for(o;n>o;o++)this._queues[o].add(new t.Internal.Actions.Fade(this._actors[o],e,i));return this},e.prototype.delay=function(e){var i=0,o=this._queues.length;for(i;o>i;i++)this._queues[i].add(new t.Internal.Actions.Delay(this._actors[i],e));return this},e.prototype.die=function(){var e=0,i=this._queues.length;for(e;i>e;e++)this._queues[e].add(new t.Internal.Actions.Die(this._actors[e]));return this},e.prototype.callMethod=function(e){var i=0,o=this._queues.length;for(i;o>i;i++)this._queues[i].add(new t.Internal.Actions.CallMethod(this._actors[i],e));return this},e.prototype.repeat=function(e){if(!e)return this.repeatForever(),this;var i=0,o=this._queues.length;for(i;o>i;i++)this._queues[i].add(new t.Internal.Actions.Repeat(this._actors[i],e,this._actors[i].actionQueue.getActions()));return this},e.prototype.repeatForever=function(){var e=0,i=this._queues.length;for(e;i>e;e++)this._queues[e].add(new t.Internal.Actions.RepeatForever(this._actors[e],this._actors[e].actionQueue.getActions()));return this},e.prototype.follow=function(e,i){var o=0,n=this._queues.length;for(o;n>o;o++)void 0===i?this._queues[o].add(new t.Internal.Actions.Follow(this._actors[o],e)):this._queues[o].add(new t.Internal.Actions.Follow(this._actors[o],e,i));return this},e.prototype.meet=function(e,i){var o=0,n=this._queues.length;for(o;n>o;o++)void 0===i?this._queues[o].add(new t.Internal.Actions.Meet(this._actors[o],e)):this._queues[o].add(new t.Internal.Actions.Meet(this._actors[o],e,i));return this},e.prototype.asPromise=function(){var e=this,i=this._queues.map(function(i,o){var n=new t.Promise;return i.add(new t.Internal.Actions.CallMethod(e._actors[o],function(){n.resolve()})),n});return t.Promise.join.apply(this,i)},e}();t.ActionContext=e})(ex||(ex={}));var ex;(function(t){var e=function(e){function i(i,o){if(e.call(this),this.name=i,this.scene=o,this._logger=t.Logger.getInstance(),this._members=[],this.actions=new t.ActionContext,null==o)this._logger.error("Invalid constructor arguments passed to Group: ",i,", scene must not be null!");else{var n=o.groups[i];n&&this._logger.warn("Group with name",i,"already exists. This new group will replace it."),o.groups[i]=this}}return __extends(i,e),i.prototype.add=function(e){e instanceof t.Actor&&(e=[].concat(e));var i,o=0,n=e.length;for(o;n>o;o++)i=this.getMembers().indexOf(e[o]),-1===i&&(this._members.push(e[o]),this.scene.add(e[o]),this.actions.addActorToContext(e[o]),this.eventDispatcher.wire(e[o].eventDispatcher))},i.prototype.remove=function(t){var e=this._members.indexOf(t);e>-1&&(this._members.splice(e,1),this.actions.removeActorFromContext(t),this.eventDispatcher.unwire(t.eventDispatcher))},i.prototype.move=function(e){var i=0,o=this.getMembers(),n=o.length;if(1===arguments.length&&e instanceof t.Vector)for(i;n>i;i++)o[i].pos.x+=e.x,o[i].pos.y+=e.y;else if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var s=arguments[0],r=arguments[1];for(i;n>i;i++)o[i].pos.x+=s,o[i].pos.y+=r}else this._logger.error("Invalid arguments passed to group move",this.name,"args:",arguments)},i.prototype.rotate=function(){if("number"==typeof arguments[0]){var t=arguments[0],e=0,i=this.getMembers(),o=i.length;for(e;o>e;e++)i[e].rotation+=t}else this._logger.error("Invalid arguments passed to group rotate",this.name,"args:",arguments)},i.prototype.on=function(t,e){this.eventDispatcher.on(t,e)},i.prototype.off=function(t,e){this.eventDispatcher.off(t,e)},i.prototype.emit=function(t,e){this.eventDispatcher.emit(t,e)},i.prototype.contains=function(t){return this.getMembers().indexOf(t)>-1},i.prototype.getMembers=function(){return this._members},i.prototype.getRandomMember=function(){return this._members[Math.floor(Math.random()*this._members.length)]},i.prototype.getBounds=function(){return this.getMembers().map(function(t){return t.getBounds()}).reduce(function(t,e){return t.combine(e)})},i}(t.Class);t.Group=e})(ex||(ex={}));var ex;(function(t){var e=function(){function t(t){this._getComparable=t}return t.prototype.find=function(t){return this._find(this._root,t)},t.prototype._find=function(t,e){return null==t?!1:this._getComparable.call(e)===t.getKey()?t.getData().indexOf(e)>-1?!0:!1:this._getComparable.call(e)<t.getKey()?this._find(t.getLeft(),e):this._find(t.getRight(),e)},t.prototype.get=function(t){return this._get(this._root,t)},t.prototype._get=function(t,e){return null==t?[]:e===t.getKey()?t.getData():t.getKey()>e?this._get(t.getLeft(),e):this._get(t.getRight(),e)},t.prototype.add=function(t){return null==this._root?(this._root=new i(this._getComparable.call(t),[t],null,null),!0):this._insert(this._root,t)},t.prototype._insert=function(t,e){return null!=t?this._getComparable.call(e)===t.getKey()?t.getData().indexOf(e)>-1?!1:(t.getData().push(e),!0):this._getComparable.call(e)<t.getKey()?null==t.getLeft()?(t.setLeft(new i(this._getComparable.call(e),[e],null,null)),!0):this._insert(t.getLeft(),e):null==t.getRight()?(t.setRight(new i(this._getComparable.call(e),[e],null,null)),!0):this._insert(t.getRight(),e):!1},t.prototype.removeByComparable=function(t){this._root=this._remove(this._root,t)},t.prototype._remove=function(t,e){if(null==t)return null;if(this._getComparable.call(e)!==t.getKey())return this._getComparable.call(e)<t.getKey()?(t.setLeft(this._remove(t.getLeft(),e)),t):(t.setRight(this._remove(t.getRight(),e)),t);var i=t.getData().indexOf(e);if(i>-1){if(t.getData().splice(i,1),0===t.getData().length){if(null==t.getLeft()&&null==t.getRight())return null;if(null==t.getLeft())return t.getRight();if(null==t.getRight())return t.getLeft();var o=this._findMinNode(t.getRight());return t.setKey(o.getKey()),t.setData(o.getData()),t.setRight(this._cleanup(t.getRight(),o)),t}return t}},t.prototype._cleanup=function(t,e){var i=e.getKey();if(null==t)return null;if(i===t.getKey()){if(null==t.getLeft()&&null==t.getRight())return null;if(null==t.getLeft())return t.getRight();if(null==t.getRight())return t.getLeft();var o=this._findMinNode(t.getRight());return t.setKey(o.getKey()),t.setData(o.getData()),t.setRight(this._cleanup(t.getRight(),o)),t}return this._getComparable.call(e)<t.getKey()?(t.setLeft(this._cleanup(t.getLeft(),e)),t):(t.setRight(this._cleanup(t.getRight(),e)),t)},t.prototype._findMinNode=function(t){for(var e=t;null!=e.getLeft();)e=e.getLeft();return e},t.prototype.list=function(){var t=[];return this._list(this._root,t),t},t.prototype._list=function(t,e){null!=t&&(this._list(t.getLeft(),e),t.getData().forEach(function(t){e.push(t)}),this._list(t.getRight(),e))},t}();t.SortedList=e;var i=function(){function t(t,e,i,o){this._key=t,this._data=e,this._left=i,this._right=o}return t.prototype.getKey=function(){return this._key},t.prototype.setKey=function(t){this._key=t},t.prototype.getData=function(){return this._data},t.prototype.setData=function(t){this._data=t},t.prototype.getLeft=function(){return this._left},t.prototype.setLeft=function(t){this._left=t},t.prototype.getRight=function(){return this._right},t.prototype.setRight=function(t){this._right=t},t}();t.BinaryTreeNode=i;var o=function(){function t(t){this._key=0,this._key=t}return t.prototype.getTheKey=function(){return this._key},t.prototype.setKey=function(t){this._key=t},t}();t.MockedElement=o})(ex||(ex={}));var ex;(function(t){var e=function(e){function i(i){e.call(this),this.children=[],this.tileMaps=[],this.groups={},this.uiActors=[],this.isInitialized=!1,this._sortedDrawingTree=new t.SortedList(t.Actor.prototype.getZIndex),this._broadphase=new t.DynamicTreeCollisionBroadphase,this._killQueue=[],this._timers=[],this._cancelQueue=[],this._logger=t.Logger.getInstance(),this.camera=new t.BaseCamera,i&&(this.camera.x=i.width/2,this.camera.y=i.height/2)}return __extends(i,e),i.prototype.onInitialize=function(t){this.camera&&(this.camera.x=t.width/2,this.camera.y=t.height/2),this._logger.debug("Scene.onInitialize",this,t)},i.prototype.onActivate=function(){this._logger.debug("Scene.onActivate",this)},i.prototype.onDeactivate=function(){this._logger.debug("Scene.onDeactivate",this)},i.prototype.update=function(e,i){this.emit("preupdate",new t.PreUpdateEvent(e,i,this));var o,n;for(this.camera&&this.camera.update(e,i),o=0,n=this.uiActors.length;n>o;o++)this.uiActors[o].update(e,i);for(o=0,n=this.tileMaps.length;n>o;o++)this.tileMaps[o].update(e,i);for(var s=t.Physics.collisionPasses,r=i/s;s>0;){for(o=0,n=this.children.length;n>o;o++)this.children[o].update(e,r),this.children[o].collisionArea.recalc();this._broadphase&&t.Physics.enabled&&(this._broadphase.update(this.children,r),this._broadphase.findCollisionContacts(this.children,r)),s--}var a;for(o=0,n=this._killQueue.length;n>o;o++)a=this.children.indexOf(this._killQueue[o]),a>-1&&(this._sortedDrawingTree.removeByComparable(this._killQueue[o]),this.children.splice(a,1));for(this._killQueue.length=0,o=0,n=this._cancelQueue.length;n>o;o++)this.removeTimer(this._cancelQueue[o]);this._cancelQueue.length=0,this._timers=this._timers.filter(function(t){return t.update(i),!t.complete}),this.emit("postupdate",new t.PostUpdateEvent(e,i,this))},i.prototype.draw=function(e,i){this.emit("predraw",new t.PreDrawEvent(e,i,this)),e.save(),this.camera&&this.camera.draw(e,i);var o,n;for(o=0,n=this.tileMaps.length;n>o;o++)this.tileMaps[o].draw(e,i);var s=this._sortedDrawingTree.list();for(o=0,n=s.length;n>o;o++)s[o].visible&&!s[o].isOffScreen&&s[o].draw(e,i);for(this.engine&&this.engine.isDebug&&(e.strokeStyle="yellow",this.debugDraw(e)),e.restore(),o=0,n=this.uiActors.length;n>o;o++)this.uiActors[o].visible&&this.uiActors[o].draw(e,i);if(this.engine&&this.engine.isDebug)for(o=0,n=this.uiActors.length;n>o;o++)this.uiActors[o].debugDraw(e);this.emit("postdraw",new t.PostDrawEvent(e,i,this))},i.prototype.debugDraw=function(e){this.emit("predebugdraw",new t.PreDebugDrawEvent(e,this));var i,o;for(i=0,o=this.tileMaps.length;o>i;i++)this.tileMaps[i].debugDraw(e);for(i=0,o=this.children.length;o>i;i++)this.children[i].debugDraw(e);this._broadphase.debugDraw(e,20),this.camera.debugDraw(e),this.emit("postdebugdraw",new t.PostDebugDrawEvent(e,this))},i.prototype.contains=function(t){return this.children.indexOf(t)>-1},i.prototype.add=function(e){return e instanceof t.Actor&&e.unkill(),e instanceof t.UIActor?(t.Util.contains(this.uiActors,e)||this.addUIActor(e),void 0):e instanceof t.Actor?(t.Util.contains(this.children,e)||(this._addChild(e),this._sortedDrawingTree.add(e)),void 0):e instanceof t.Timer?(t.Util.contains(this._timers,e)||this.addTimer(e),void 0):(e instanceof t.TileMap&&(t.Util.contains(this.tileMaps,e)||this.addTileMap(e)),void 0)},i.prototype.remove=function(e){return e instanceof t.UIActor?(this.removeUIActor(e),void 0):(e instanceof t.Actor&&(this._broadphase.remove(e),this._removeChild(e)),e instanceof t.Timer&&this.removeTimer(e),e instanceof t.TileMap&&this.removeTileMap(e),void 0)},i.prototype.addUIActor=function(t){this.uiActors.push(t),t.scene=this},i.prototype.removeUIActor=function(t){var e=this.uiActors.indexOf(t);e>-1&&this.uiActors.splice(e,1)},i.prototype._addChild=function(t){this._broadphase.register(t),t.scene=this,this.children.push(t),this._sortedDrawingTree.add(t),t.parent=this.actor},i.prototype.addTileMap=function(t){this.tileMaps.push(t)},i.prototype.removeTileMap=function(t){var e=this.tileMaps.indexOf(t);e>-1&&this.tileMaps.splice(e,1)},i.prototype._removeChild=function(t){this._broadphase.remove(t),this._killQueue.push(t),t.parent=null},i.prototype.addTimer=function(t){return this._timers.push(t),t.scene=this,t},i.prototype.removeTimer=function(t){var e=this._timers.indexOf(t);return-1!==e&&this._timers.splice(e,1),t},i.prototype.cancelTimer=function(t){return this._cancelQueue.push(t),t},i.prototype.isTimerActive=function(t){return this._timers.indexOf(t)>-1},i.prototype.createGroup=function(e){return new t.Group(e,this)},i.prototype.getGroup=function(t){return this.groups[t]},i.prototype.removeGroup=function(e){"string"==typeof e?delete this.groups[e]:e instanceof t.Group?delete this.groups[e.name]:this._logger.error("Invalid arguments to removeGroup",e)},i.prototype.cleanupDrawTree=function(t){this._sortedDrawingTree.removeByComparable(t)},i.prototype.updateDrawTree=function(t){this._sortedDrawingTree.add(t)},i}(t.Class);t.Scene=e})(ex||(ex={}));var ex;(function(t){var e=function(){function t(){}return t.Linear=function(t,e,i,o){return i-=e,i*t/o+e},t.EaseInQuad=function(t,e,i,o){return i-=e,t/=o,i*t*t+e},t.EaseOutQuad=function(t,e,i,o){return i-=e,t/=o,-i*t*(t-2)+e},t.EaseInOutQuad=function(t,e,i,o){return i-=e,t/=o/2,1>t?i/2*t*t+e:(t--,-i/2*(t*(t-2)-1)+e)},t.EaseInCubic=function(t,e,i,o){return i-=e,t/=o,i*t*t*t+e},t.EaseOutCubic=function(t,e,i,o){return i-=e,t/=o,t--,i*(t*t*t+1)+e},t.EaseInOutCubic=function(t,e,i,o){return i-=e,t/=o/2,1>t?i/2*t*t*t+e:(t-=2,i/2*(t*t*t+2)+e)},t}();t.EasingFunctions=e})(ex||(ex={}));var ex;(function(t){var e=function(e){function o(n,s,r,a,h){e.call(this),this.id=o.maxId++,this.body=new t.Body(this),this._height=0,this._width=0,this._collisionContacts=[],this._totalMtv=t.Vector.Zero.clone(),this.scale=new t.Vector(1,1),this.sx=0,this.sy=0,this.isOffScreen=!1,this.visible=!0,this.opacity=1,this.previousOpacity=1,this.logger=t.Logger.getInstance(),this.scene=null,this.parent=null,this.children=[],this.collisionType=i.PreventCollision,this.collisionGroups=[],this._collisionHandlers={},this._isInitialized=!1,this.frames={},this._framesDirty=!1,this.currentDrawing=null,this.traits=[],this.enableCapturePointer=!1,this.capturePointer={captureMoveEvents:!1},this._zIndex=0,this._isKilled=!1,this._opacityFx=new t.Effects.Opacity(this.opacity),this.pos.x=n||0,this.pos.y=s||0,this._width=r||0,this._height=a||0,h&&(this.color=h.clone(),this.opacity=h.a),this.traits.push(new t.Traits.EulerMovement),this.traits.push(new t.Traits.TileMapCollisionDetection),this.traits.push(new t.Traits.OffscreenCulling),this.traits.push(new t.Traits.CapturePointer),this.actionQueue=new t.Internal.Actions.ActionQueue(this),this.actions=new t.ActionContext(this),this.anchor=new t.Vector(.5,.5),this.body.useBoxCollision()}return __extends(o,e),Object.defineProperty(o.prototype,"collisionArea",{get:function(){return this.body.collisionArea},set:function(t){this.body.collisionArea=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"x",{get:function(){return this.body.pos.x},set:function(t){this.body.pos.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"y",{get:function(){return this.body.pos.y},set:function(t){this.body.pos.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"pos",{get:function(){return this.body.pos},set:function(t){this.body.pos=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"oldPos",{get:function(){return this.body.oldPos},set:function(t){this.body.oldPos=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"vel",{get:function(){return this.body.vel},set:function(t){this.body.vel=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"oldVel",{get:function(){return this.body.oldVel},set:function(t){this.body.oldVel=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"acc",{get:function(){return this.body.acc},set:function(t){this.body.acc=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"rotation",{get:function(){return this.body.rotation},set:function(t){this.body.rotation=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"rx",{get:function(){return this.body.rx},set:function(t){this.body.rx=t
},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"torque",{get:function(){return this.body.torque},set:function(t){this.body.torque=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"mass",{get:function(){return this.body.mass},set:function(t){this.body.mass=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"moi",{get:function(){return this.body.moi},set:function(t){this.body.moi=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"friction",{get:function(){return this.body.friction},set:function(t){this.body.friction=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"restitution",{get:function(){return this.body.restitution},set:function(t){this.body.restitution=t},enumerable:!0,configurable:!0}),o.prototype.onInitialize=function(){},o.prototype._checkForPointerOptIn=function(t){!t||"pointerdown"!==t.toLowerCase()&&"pointerdown"!==t.toLowerCase()&&"pointermove"!==t.toLowerCase()||(this.enableCapturePointer=!0,"pointermove"===t.toLowerCase()&&(this.capturePointer.captureMoveEvents=!0))},o.prototype.on=function(t,e){this._checkForPointerOptIn(t),this.eventDispatcher.on(t,e)},o.prototype.kill=function(){this.scene?(this.emit("kill",new t.KillEvent(this)),this.scene.remove(this),this._isKilled=!0):this.logger.warn("Cannot kill actor, it was never added to the Scene")},o.prototype.unkill=function(){this._isKilled=!1},o.prototype.isKilled=function(){return this._isKilled},o.prototype.add=function(e){e.collisionType=i.PreventCollision,t.Util.addItemToArray(e,this.children)&&(e.parent=this)},o.prototype.remove=function(e){t.Util.removeItemToArray(e,this.children)&&(e.parent=null)},o.prototype.setDrawing=function(e){e=""+e,this.currentDrawing!==this.frames[e]&&(null!=this.frames[e]?(this.frames[e].reset(),this.currentDrawing=this.frames[e]):t.Logger.getInstance().error("the specified drawing key '"+e+"' does not exist"))},o.prototype.addMtv=function(t){this._totalMtv.addEqual(t)},o.prototype.applyMtv=function(){this.pos.addEqual(this._totalMtv),this._totalMtv.setTo(0,0)},o.prototype.addDrawing=function(){2===arguments.length?(this.frames[arguments[0]]=arguments[1],this.currentDrawing||(this.currentDrawing=arguments[1]),this._framesDirty=!0):(arguments[0]instanceof t.Sprite&&this.addDrawing("default",arguments[0]),arguments[0]instanceof t.Texture&&this.addDrawing("default",arguments[0].asSprite()))},Object.defineProperty(o.prototype,"z",{get:function(){return this.getZIndex()},set:function(t){this.setZIndex(t)},enumerable:!0,configurable:!0}),o.prototype.getZIndex=function(){return this._zIndex},o.prototype.setZIndex=function(t){this.scene.cleanupDrawTree(this),this._zIndex=t,this.scene.updateDrawTree(this)},o.prototype.addCollisionGroup=function(t){this.collisionGroups.push(t)},o.prototype.removeCollisionGroup=function(t){var e=this.collisionGroups.indexOf(t);-1!==e&&this.collisionGroups.splice(e,1)},o.prototype.calculatePairHash=function(t){return this.id<t.id?"#"+this.id+"+"+t.id:"#"+t.id+"+"+this.id},o.prototype.getCenter=function(){return new t.Vector(this.pos.x+this.getWidth()/2-this.anchor.x*this.getWidth(),this.pos.y+this.getHeight()/2-this.anchor.y*this.getHeight())},o.prototype.getWidth=function(){return this._width*this.scale.x},o.prototype.setWidth=function(t){this._width=t/this.scale.x},o.prototype.getHeight=function(){return this._height*this.scale.y},o.prototype.setHeight=function(t){this._height=t/this.scale.y},o.prototype.getLeft=function(){return this.getBounds().left},o.prototype.getRight=function(){return this.getBounds().right},o.prototype.getTop=function(){return this.getBounds().top},o.prototype.getBottom=function(){return this.getBounds().bottom},o.prototype.getWorldRotation=function(){return this.parent?this.rotation+this.parent.getWorldRotation():this.rotation},o.prototype.getWorldPos=function(){if(!this.parent)return this.pos.clone();var e=[],i=this;for(e.push(this);i.parent;)i=i.parent,e.push(i);var o=e.reduceRight(function(t,e){return e.parent?t+e.pos.x*e.getGlobalScale().x:t+e.pos.x},0),n=e.reduceRight(function(t,e){return e.parent?t+e.pos.y*e.getGlobalScale().y:t+e.pos.y},0),s=i.getWorldPos(),r=this.getWorldRotation();return new t.Vector(o,n).rotate(r,s)},o.prototype.getGlobalScale=function(){if(!this.parent)return new t.Vector(this.scale.x,this.scale.y);var e=this.parent.getGlobalScale();return new t.Vector(this.scale.x*e.x,this.scale.y*e.y)},o.prototype.getBounds=function(){var e=this._getCalculatedAnchor(),i=this.getWorldPos();return new t.BoundingBox(i.x-e.x,i.y-e.y,i.x+this.getWidth()-e.x,i.y+this.getHeight()-e.y)},o.prototype.getRelativeBounds=function(){var e=this._getCalculatedAnchor();return new t.BoundingBox(-e.x,-e.y,this.getWidth()-e.x,this.getHeight()-e.y)},o.prototype.contains=function(e,i,o){void 0===o&&(o=!1);var n=this.getBounds().contains(new t.Vector(e,i));return o?n||this.children.some(function(t){return t.contains(e,i,!0)}):n},o.prototype.getSideFromIntersect=function(e){return e?Math.abs(e.x)>Math.abs(e.y)?0>e.x?t.Side.Right:t.Side.Left:0>e.y?t.Side.Bottom:t.Side.Top:t.Side.None},o.prototype.collidesWithSide=function(e){var i=this.collides(e);return i?Math.abs(i.x)>Math.abs(i.y)?this.pos.x<e.pos.x?t.Side.Right:t.Side.Left:this.pos.y<e.pos.y?t.Side.Bottom:t.Side.Top:t.Side.None},o.prototype.collides=function(t){var e=this.getBounds(),i=t.getBounds(),o=e.collides(i);return o},o.prototype.onCollidesWith=function(t,e){this._collisionHandlers[t]||(this._collisionHandlers[t]=[]),this._collisionHandlers[t].push(e)},o.prototype.getCollisionHandlers=function(){return this._collisionHandlers},o.prototype.removeCollidesWith=function(t){this._collisionHandlers[t]=[]},o.prototype.within=function(t,e){return e>=Math.sqrt(Math.pow(this.pos.x-t.pos.x,2)+Math.pow(this.pos.y-t.pos.y,2))},o.prototype._getCalculatedAnchor=function(){return new t.Vector(this.getWidth()*this.anchor.x,this.getHeight()*this.anchor.y)},o.prototype.update=function(e,i){if(this._isInitialized||(this.onInitialize(e),this.eventDispatcher.emit("initialize",new t.InitializeEvent(e)),this._isInitialized=!0),this.emit("preupdate",new t.PreUpdateEvent(e,i,this)),this.actionQueue.update(i),this.color&&(this.color.a=this.opacity),this.previousOpacity!==this.opacity&&(this.previousOpacity=this.opacity,this._opacityFx.opacity=this.opacity,this._framesDirty=!0),this._framesDirty){this._framesDirty=!1;for(var o in this.frames)this.frames[o].removeEffect(this._opacityFx),this.frames[o].addEffect(this._opacityFx)}for(var n=0,s=this.traits;s.length>n;n++){var r=s[n];r.update(this,e,i)}for(var a=0;this.children.length>a;a++)this.children[a].update(e,i);this.eventDispatcher.emit("update",new t.PostUpdateEvent(e,i,this)),this.emit("postupdate",new t.PostUpdateEvent(e,i,this))},o.prototype.draw=function(e,i){if(e.save(),e.translate(this.pos.x,this.pos.y),e.scale(this.scale.x,this.scale.y),e.rotate(this.rotation),e.save(),e.translate(-(this._width*this.anchor.x),-(this._height*this.anchor.y)),this.emit("predraw",new t.PreDrawEvent(e,i,this)),this.currentDrawing){var o=this.currentDrawing,n=(this._width-o.naturalWidth*o.scale.x)*this.anchor.x,s=(this._height-o.naturalHeight*o.scale.y)*this.anchor.y;this.currentDrawing.draw(e,n,s)}else this.color&&(e.fillStyle=""+this.color,e.fillRect(0,0,this._width,this._height));e.restore();for(var r=0;this.children.length>r;r++)this.children[r].visible&&this.children[r].draw(e,i);this.emit("postdraw",new t.PostDrawEvent(e,i,this)),e.restore()},o.prototype.debugDraw=function(e){this.emit("predebugdraw",new t.PreDebugDrawEvent(e,this)),this.body.debugDraw(e),e.save(),e.translate(this.pos.x,this.pos.y),e.rotate(this.rotation);for(var i=0;this.children.length>i;i++)this.children[i].debugDraw(e);e.restore(),this.emit("postdebugdraw",new t.PostDebugDrawEvent(e,this))},o.maxId=0,o}(t.Class);t.Actor=e,function(t){t[t.PreventCollision=0]="PreventCollision",t[t.Passive=1]="Passive",t[t.Active=2]="Active",t[t.Elastic=3]="Elastic",t[t.Fixed=4]="Fixed"}(t.CollisionType||(t.CollisionType={}));var i=t.CollisionType})(ex||(ex={}));var ex;(function(t){(function(t){t[t.Debug=0]="Debug",t[t.Info=1]="Info",t[t.Warn=2]="Warn",t[t.Error=3]="Error",t[t.Fatal=4]="Fatal"})(t.LogLevel||(t.LogLevel={}));var e=t.LogLevel,i=function(){function t(){if(this._appenders=[],this.defaultLevel=e.Info,t._instance)throw Error("Logger is a singleton");return t._instance=this,t._instance.addAppender(new o),t._instance}return t.getInstance=function(){return null==t._instance&&(t._instance=new t),t._instance},t.prototype.addAppender=function(t){this._appenders.push(t)},t.prototype.clearAppenders=function(){this._appenders.length=0},t.prototype._log=function(t,e){null==t&&(t=this.defaultLevel);var i=0,o=this._appenders.length;for(i;o>i;i++)t>=this.defaultLevel&&this._appenders[i].log(t,e)},t.prototype.debug=function(){for(var t=[],i=0;arguments.length>i;i++)t[i-0]=arguments[i];this._log(e.Debug,t)},t.prototype.info=function(){for(var t=[],i=0;arguments.length>i;i++)t[i-0]=arguments[i];this._log(e.Info,t)},t.prototype.warn=function(){for(var t=[],i=0;arguments.length>i;i++)t[i-0]=arguments[i];this._log(e.Warn,t)},t.prototype.error=function(){for(var t=[],i=0;arguments.length>i;i++)t[i-0]=arguments[i];this._log(e.Error,t)},t.prototype.fatal=function(){for(var t=[],i=0;arguments.length>i;i++)t[i-0]=arguments[i];this._log(e.Fatal,t)},t._instance=null,t}();t.Logger=i;var o=function(){function t(){}return t.prototype.log=function(t,i){if(console||console.log||!console.warn||!console.error){var o=[];o.unshift.apply(o,i),o.unshift("["+e[t]+"] : "),e.Warn>t?console.log.apply?console.log.apply(console,o):console.log(o.join(" ")):e.Error>t?console.warn.apply?console.warn.apply(console,o):console.warn(o.join(" ")):console.error.apply?console.error.apply(console,o):console.error(o.join(" "))}},t}();t.ConsoleAppender=o;var n=function(){function t(t,e){this._messages=[],this._canvas=document.createElement("canvas"),this._canvas.width=t||window.innerWidth,this._canvas.height=e||window.innerHeight,this._canvas.style.position="absolute",this._ctx=this._canvas.getContext("2d"),document.body.appendChild(this._canvas)}return t.prototype.log=function(t,i){var o=i.join(",");this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._messages.unshift("["+e[t]+"] : "+o);for(var n=10,s=1,r=0;this._messages.length>r;r++)this._ctx.fillStyle="rgba(255,255,255,"+s.toFixed(2)+")",this._ctx.fillText(this._messages[r],200,n),n+=10,s=s>0?s-.05:0},t}();t.ScreenAppender=n})(ex||(ex={}));var ex;(function(t){var e=function(){function t(){}return t}();t.GameEvent=e;var i=function(t){function e(e){t.call(this),this.target=e}return __extends(e,t),e}(e);t.KillEvent=i;var o=function(t){function e(e,i,o){t.call(this),this.ctx=e,this.delta=i,this.target=o}return __extends(e,t),e}(e);t.PreDrawEvent=o;var n=function(t){function e(e,i,o){t.call(this),this.ctx=e,this.delta=i,this.target=o}return __extends(e,t),e}(e);t.PostDrawEvent=n;var s=function(t){function e(e,i){t.call(this),this.ctx=e,this.target=i}return __extends(e,t),e}(e);t.PreDebugDrawEvent=s;var r=function(t){function e(e,i){t.call(this),this.ctx=e,this.target=i}return __extends(e,t),e}(e);t.PostDebugDrawEvent=r;var a=function(t){function e(e,i,o){t.call(this),this.engine=e,this.delta=i,this.target=o}return __extends(e,t),e}(e);t.PreUpdateEvent=a;var h=function(t){function e(e,i,o){t.call(this),this.engine=e,this.delta=i,this.target=o}return __extends(e,t),e}(e);t.PostUpdateEvent=h;var c=function(t){function e(e,i){t.call(this),this.index=e,this.gamepad=i}return __extends(e,t),e}(e);t.GamepadConnectEvent=c;var l=function(t){function e(e){t.call(this),this.index=e}return __extends(e,t),e}(e);t.GamepadDisconnectEvent=l;var u=function(t){function e(e,i){t.call(this),this.button=e,this.value=i}return __extends(e,t),e}(t.GameEvent);t.GamepadButtonEvent=u;var p=function(t){function e(e,i){t.call(this),this.axis=e,this.value=i}return __extends(e,t),e}(t.GameEvent);t.GamepadAxisEvent=p;var d=function(t){function e(e,i){t.call(this),this.topic=e,this.handler=i}return __extends(e,t),e}(e);t.SubscribeEvent=d;var f=function(t){function e(e,i){t.call(this),this.topic=e,this.handler=i}return __extends(e,t),e}(e);t.UnsubscribeEvent=f;var g=function(t){function e(){t.call(this)}return __extends(e,t),e}(e);t.VisibleEvent=g;var _=function(t){function e(){t.call(this)}return __extends(e,t),e}(e);t.HiddenEvent=_;var y=function(t){function e(e,i,o,n){t.call(this),this.actor=e,this.other=i,this.side=o,this.intersection=n}return __extends(e,t),e}(e);t.CollisionEvent=y;var v=function(t){function e(e){t.call(this),this.engine=e}return __extends(e,t),e}(e);t.InitializeEvent=v;var m=function(t){function e(e){t.call(this),this.oldScene=e}return __extends(e,t),e}(e);t.ActivateEvent=m;var x=function(t){function e(e){t.call(this),this.newScene=e}return __extends(e,t),e}(e);t.DeactivateEvent=x;var w=function(t){function e(){t.call(this)}return __extends(e,t),e}(e);t.ExitViewPortEvent=w;var b=function(t){function e(){t.call(this)}return __extends(e,t),e}(e);t.EnterViewPortEvent=b})(ex||(ex={}));var ex;(function(t){var e=function(){function e(e){this._handlers={},this._wiredEventDispatchers=[],this._log=t.Logger.getInstance(),this._target=e}return e.prototype.emit=function(e,i){if(e){e=e.toLowerCase();var o=this._target;i||(i=new t.GameEvent),i.target=o;var n,s;if(this._handlers[e])for(n=0,s=this._handlers[e].length,n;s>n;n++)this._handlers[e][n].call(o,i);for(n=0,s=this._wiredEventDispatchers.length,n;s>n;n++)this._wiredEventDispatchers[n].emit(e,i)}},e.prototype.on=function(e,i){e=e.toLowerCase(),this._handlers[e]||(this._handlers[e]=[]),this._handlers[e].push(i),"unsubscribe"!==e&&"subscribe"!==e&&this.emit("subscribe",new t.SubscribeEvent(e,i))},e.prototype.off=function(e,i){e=e.toLowerCase();var o=this._handlers[e];if(o)if(i){var n=o.indexOf(i);this._handlers[e].splice(n,1)}else this._handlers[e].length=0;"unsubscribe"!==e&&"subscribe"!==e&&this.emit("unsubscribe",new t.UnsubscribeEvent(e,i))},e.prototype.wire=function(t){t._wiredEventDispatchers.push(this)},e.prototype.unwire=function(t){var e=t._wiredEventDispatchers.indexOf(this);e>-1&&t._wiredEventDispatchers.splice(e,1)},e}();t.EventDispatcher=e})(ex||(ex={}));var ex;(function(t){var e=function(){function t(t,e,i,o){this.r=t,this.g=e,this.b=i,this.a=null!=o?o:1}return t.fromRGB=function(e,i,o,n){return new t(e,i,o,n)},t.fromHex=function(e){var i=/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,o=null;if(o=e.match(i)){var n=parseInt(o[1],16),s=parseInt(o[2],16),r=parseInt(o[3],16),a=1;return o[4]&&(a=parseInt(o[4],16)/255),new t(n,s,r,a)}throw Error("Invalid hex string: "+e)},t.fromHSL=function(t,e,o,n){void 0===n&&(n=1);var s=new i(t,e,o,n);return s.toRGBA()},t.prototype.lighten=function(t){void 0===t&&(t=.1);var e=i.fromRGBA(this.r,this.g,this.b,this.a);return e.l+=e.l*t,e.toRGBA()},t.prototype.darken=function(t){void 0===t&&(t=.1);var e=i.fromRGBA(this.r,this.g,this.b,this.a);return e.l-=e.l*t,e.toRGBA()},t.prototype.saturate=function(t){void 0===t&&(t=.1);var e=i.fromRGBA(this.r,this.g,this.b,this.a);return e.s+=e.s*t,e.toRGBA()},t.prototype.desaturate=function(t){void 0===t&&(t=.1);var e=i.fromRGBA(this.r,this.g,this.b,this.a);return e.s-=e.s*t,e.toRGBA()},t.prototype.mulitiply=function(e){var i=255*(e.r/255*this.r/255),o=255*(e.g/255*this.g/255),n=255*(e.b/255*this.b/255),s=e.a*this.a;return new t(i,o,n,s)},t.prototype.screen=function(t){var e=t.invert(),i=t.invert();return e.mulitiply(i).invert()},t.prototype.invert=function(){return new t(255-this.r,255-this.g,255-this.b,1-this.a)},t.prototype.average=function(e){var i=(e.r+this.r)/2,o=(e.g+this.g)/2,n=(e.b+this.b)/2,s=(e.a+this.a)/2;return new t(i,o,n,s)},t.prototype.toString=function(){var t=this.r.toFixed(0)+""+", "+(this.g.toFixed(0)+"")+", "+(this.b.toFixed(0)+"");return void 0!==this.a||null!==this.a?"rgba("+t+", "+(this.a+"")+")":"rgb("+t+")"},t.prototype.fillStyle=function(){return""+this},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.Black=t.fromHex("#000000"),t.White=t.fromHex("#FFFFFF"),t.Gray=t.fromHex("#808080"),t.LightGray=t.fromHex("#D3D3D3"),t.DarkGray=t.fromHex("#A9A9A9"),t.Yellow=t.fromHex("#FFFF00"),t.Orange=t.fromHex("#FFA500"),t.Red=t.fromHex("#FF0000"),t.Vermillion=t.fromHex("#FF5B31"),t.Rose=t.fromHex("#FF007F"),t.Magenta=t.fromHex("#FF00FF"),t.Violet=t.fromHex("#7F00FF"),t.Blue=t.fromHex("#0000FF"),t.Azure=t.fromHex("#007FFF"),t.Cyan=t.fromHex("#00FFFF"),t.Viridian=t.fromHex("#59978F"),t.Green=t.fromHex("#00FF00"),t.Chartreuse=t.fromHex("#7FFF00"),t.Transparent=t.fromHex("#FFFFFF00"),t}();t.Color=e;var i=function(){function t(t,e,i,o){this.h=t,this.s=e,this.l=i,this.a=o}return t.fromRGBA=function(e,i,o,n){e/=255,i/=255,o/=255;var s,r,a=Math.max(e,i,o),h=Math.min(e,i,o),c=(a+h)/2;if(a===h)s=r=0;else{var l=a-h;switch(r=c>.5?l/(2-a-h):l/(a+h),a){case e:s=(i-o)/l+(o>i?6:0);break;case i:s=(o-e)/l+2;break;case o:s=(e-i)/l+4}s/=6}return new t(s,r,c,n)},t.prototype.toRGBA=function(){function t(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+6*(e-t)*(2/3-i):t}var i,o,n;if(0===this.s)i=o=n=this.l;else{var s=.5>this.l?this.l*(1+this.s):this.l+this.s-this.l*this.s,r=2*this.l-s;i=t(r,s,this.h+1/3),o=t(r,s,this.h),n=t(r,s,this.h-1/3)}return new e(255*i,255*o,255*n,this.a)},t}()})(ex||(ex={}));var ex;(function(t){var e=function(){function e(e){this.lineWidth=5,this.filled=!1,this._points=[],this.anchor=new t.Vector(0,0),this.rotation=0,this.scale=new t.Vector(1,1),this._points=e;var i=this._points.reduce(function(t,e){return Math.min(t,e.x)},0),o=this._points.reduce(function(t,e){return Math.max(t,e.x)},0);this.width=o-i;var n=this._points.reduce(function(t,e){return Math.min(t,e.y)},0),s=this._points.reduce(function(t,e){return Math.max(t,e.y)},0);this.height=s-n,this.naturalHeight=this.height,this.naturalWidth=this.width}return e.prototype.addEffect=function(){},e.prototype.removeEffect=function(){},e.prototype.clearEffects=function(){},e.prototype.reset=function(){},e.prototype.draw=function(t,e,i){t.save(),t.translate(e+this.anchor.x,i+this.anchor.y),t.scale(this.scale.x,this.scale.y),t.rotate(this.rotation),t.beginPath(),t.lineWidth=this.lineWidth;var o=this._points[0];t.moveTo(o.x,o.y);var n=0,s=this._points.length;for(n;s>n;n++)t.lineTo(this._points[n].x,this._points[n].y);t.lineTo(o.x,o.y),t.closePath(),this.filled&&(t.fillStyle=""+this.fillColor,t.fill()),t.strokeStyle=""+this.lineColor,this.flipHorizontal&&(t.translate(this.width,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,this.height),t.scale(1,-1)),t.stroke(),t.restore()},e}();t.Polygon=e})(ex||(ex={}));var ex;(function(t){var e=function(e){function i(i,o,n){void 0===n&&(n=!0),e.call(this),this.path=i,this.responseType=o,this.bustCache=n,this.data=null,this.logger=t.Logger.getInstance(),this.onprogress=function(){},this.oncomplete=function(){},this.onerror=function(){}}return __extends(i,e),i.prototype.isLoaded=function(){return null!==this.data},i.prototype.wireEngine=function(t){this._engine=t},i.prototype._cacheBust=function(t){var e=/\?\w*=\w*/;return t+=e.test(t)?"&__="+Date.now():"?__="+Date.now()},i.prototype._start=function(){this.logger.debug("Started loading resource "+this.path)},i.prototype.load=function(){var e=this,i=new t.Promise;if(null!==this.data)return this.logger.debug("Already have data for resource",this.path),i.resolve(this.data),this.oncomplete(),i;var o=new XMLHttpRequest;return o.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),o.responseType=this.responseType,o.onloadstart=function(t){e._start(t)},o.onprogress=this.onprogress,o.onerror=this.onerror,o.onload=function(){return 200!==o.status?(e.logger.error("Failed to load resource ",e.path," server responded with error code",o.status),e.onerror(o.response),i.resolve(o.response),void 0):(e.data=e.processData(o.response),e.oncomplete(),e.logger.debug("Completed loading resource",e.path),i.resolve(e.data),void 0)},o.send(),i},i.prototype.getData=function(){return this.data},i.prototype.setData=function(t){this.data=this.processData(t)},i.prototype.processData=function(t){return URL.createObjectURL(t)},i}(t.Class);t.Resource=e})(ex||(ex={}));var ex;(function(t){(function(t){t[t.Resolved=0]="Resolved",t[t.Rejected=1]="Rejected",t[t.Pending=2]="Pending"})(t.PromiseState||(t.PromiseState={}));var e=t.PromiseState,i=function(){function i(){this._state=e.Pending,this._successCallbacks=[],this._rejectCallback=function(){},this._logger=t.Logger.getInstance()}return i.wrap=function(t){var e=(new i).resolve(t);return e},i.join=function(){for(var t=[],e=0;arguments.length>e;e++)t[e-0]=arguments[e];var o=new i;if(!t||!t.length)return o.resolve();var n=t.length,s=0,r=0,a=[];return t.forEach(function(t){t.then(function(){s+=1,s===n?o.resolve():s+r+a.length===n&&o.reject(a)},function(){r+=1,s+r+a.length===n&&o.reject(a)}).error(function(t){a.push(t),a.length+s+r===n&&o.reject(a)})}),o},i.prototype.then=function(t,i){if(t&&(this._successCallbacks.push(t),this.state()===e.Resolved))try{t.call(this,this._value)}catch(o){this._handleError(o)}if(i&&(this._rejectCallback=i,this.state()===e.Rejected))try{i.call(this,this._value)}catch(o){this._handleError(o)}return this},i.prototype.error=function(t){return t&&(this._errorCallback=t),this},i.prototype.resolve=function(t){var i=this;if(this._state!==e.Pending)throw Error("Cannot resolve a promise that is not in a pending state!");this._value=t;try{this._state=e.Resolved,this._successCallbacks.forEach(function(t){t.call(i,i._value)})}catch(o){this._handleError(o)}return this},i.prototype.reject=function(t){if(this._state!==e.Pending)throw Error("Cannot reject a promise that is not in a pending state!");this._value=t;try{this._state=e.Rejected,this._rejectCallback.call(this,this._value)}catch(i){this._handleError(i)}return this},i.prototype.state=function(){return this._state},i.prototype._handleError=function(t){if(!this._errorCallback)throw t;this._errorCallback.call(this,t)},i}();t.Promise=i})(ex||(ex={}));var ex;(function(t){var e=function(e){function i(i,o){void 0===o&&(o=!0),e.call(this,i,"blob",o),this.path=i,this.bustCache=o,this.loaded=new t.Promise,this._isLoaded=!1,this._sprite=null,this._sprite=new t.Sprite(this,0,0,0,0)}return __extends(i,e),i.prototype.isLoaded=function(){return this._isLoaded},i.prototype.load=function(){var i=this,o=new t.Promise,n=e.prototype.load.call(this);return n.then(function(){i.image=new Image,i.image.addEventListener("load",function(){i._isLoaded=!0,i.width=i._sprite.swidth=i._sprite.naturalWidth=i._sprite.width=i.image.naturalWidth,i.height=i._sprite.sheight=i._sprite.naturalHeight=i._sprite.height=i.image.naturalHeight,i.loaded.resolve(i.image),o.resolve(i.image)}),i.image.src=e.prototype.getData.call(i)},function(){o.reject("Error loading texture.")}),o},i.prototype.asSprite=function(){return this._sprite},i}(t.Resource);t.Texture=e})(ex||(ex={}));var ex;(function(t){var e=function(){function e(){for(var i=[],o=0;arguments.length>o;o++)i[o-0]=arguments[o];this._logger=t.Logger.getInstance(),this.onprogress=function(){},this.oncomplete=function(){},this.onerror=function(){},this.onload=function(){},this._isLoaded=!1,this._wasPlayingOnHidden=!1,this.path="";for(var n=0;i.length>n;n++)if(e.canPlayFile(i[n])){this.path=i[n];break}this.path||(this._logger.warn("This browser does not support any of the audio files specified:",i.join(", ")),this._logger.warn("Attempting to use",i[0]),this.path=i[0]),this.sound=new t.Internal.FallbackAudio(this.path,1)}return e.canPlayFile=function(e){try{var i=new Audio,o=/.*\.([A-Za-z0-9]+)$/,n=e.match(o)[1];return i.canPlayType("audio/"+n)?!0:!1}catch(s){return t.Logger.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",s),!1}},e.prototype.wireEngine=function(t){var e=this;t&&(this._engine=t,this._engine.on("hidden",function(){t.pauseAudioWhenHidden&&e.isPlaying()&&(e._wasPlayingOnHidden=!0,e.pause())}),this._engine.on("visible",function(){t.pauseAudioWhenHidden&&e._wasPlayingOnHidden&&(e.play(),e._wasPlayingOnHidden=!1)}))},e.prototype.setVolume=function(t){this.sound&&this.sound.setVolume(t)},e.prototype.setLoop=function(t){this.sound&&this.sound.setLoop(t)},e.prototype.isPlaying=function(){return this.sound?this.sound.isPlaying():void 0},e.prototype.play=function(){return this.sound?this.sound.play():void 0},e.prototype.pause=function(){this.sound&&this.sound.pause()},e.prototype.stop=function(){this.sound&&this.sound.stop()},e.prototype.isLoaded=function(){return this._isLoaded},e.prototype.load=function(){var e=this,i=new t.Promise;return null!==this.sound.getData()?(this._logger.debug("Already have data for resource",this.path),i.resolve(this.sound),i):(this._logger.debug("Started loading sound",this.path),this.sound.onprogress=this.onprogress,this.sound.onload=function(){e.oncomplete(),e._isLoaded=!0,e._logger.debug("Completed loading sound",e.path),i.resolve(e.sound)},this.sound.onerror=function(t){e.onerror(t),i.resolve(t)},this.sound.load(),i)},e.prototype.getData=function(){return this.sound.getData()},e.prototype.setData=function(t){this.sound.setData(t)},e.prototype.processData=function(t){return this.sound.processData(t)},e}();t.Sound=e})(ex||(ex={}));var ex;(function(t){var e=function(e){function i(i,o,n,s){e.call(this,i,o,n,s),this.traits=[],this.traits.push(new t.Traits.EulerMovement),this.traits.push(new t.Traits.CapturePointer),this.anchor.setTo(0,0),this.collisionType=t.CollisionType.PreventCollision,this.enableCapturePointer=!0}return __extends(i,e),i.prototype.onInitialize=function(t){this._engine=t},i.prototype.contains=function(i,o,n){if(void 0===n&&(n=!0),n)return e.prototype.contains.call(this,i,o);var s=this._engine.worldToScreenCoordinates(new t.Vector(i,o));return e.prototype.contains.call(this,s.x,s.y)},i}(t.Actor);t.UIActor=e})(ex||(ex={}));var ex;(function(t){var e=function(e){function i(i,o,n,s,r,a){e.call(this,i,o,n,s),this._action=function(){},this.repeats=1,this.target=null,this.repeats=a||this.repeats,this._action=r||this._action,this.collisionType=t.CollisionType.PreventCollision,this.eventDispatcher=new t.EventDispatcher(this),this.actionQueue=new t.Internal.Actions.ActionQueue(this)}return __extends(i,e),i.prototype.update=function(e,i){if(this.actionQueue.update(i),this.pos.x+=this.vel.x*i/1e3,this.pos.y+=this.vel.y*i/1e3,this.rotation+=this.rx*i/1e3,this.scale.x+=this.sx*i/1e3,this.scale.y+=this.sy*i/1e3,this.target)this.collides(this.target)&&this._dispatchAction();else for(var o=0;e.currentScene.children.length>o;o++){var n=e.currentScene.children[o];n!==this&&n.collisionType!==t.CollisionType.PreventCollision&&this.collides(n)&&this._dispatchAction()}0===this.repeats&&this.kill()},i.prototype._dispatchAction=function(){this._action.call(this),this.repeats--},i.prototype.draw=function(){},i.prototype.debugDraw=function(i){e.prototype.debugDraw.call(this,i),i.save(),i.translate(this.pos.x,this.pos.y);var o=this.getBounds(),n=this.getWorldPos();o.left=o.left-n.x,o.right=o.right-n.x,o.top=o.top-n.y,o.bottom=o.bottom-n.y,i.fillStyle=""+t.Color.Violet,i.strokeStyle=""+t.Color.Violet,i.fillText("Trigger",10,10),o.debugDraw(i),i.restore()},i}(t.Actor);t.Trigger=e})(ex||(ex={}));var ex;(function(t){(function(t){t[t.Circle=0]="Circle",t[t.Rectangle=1]="Rectangle"})(t.EmitterType||(t.EmitterType={}));var e=t.EmitterType,i=function(){function e(e,i,o,n,s,r,a,h,c,l){this.position=new t.Vector(0,0),this.velocity=new t.Vector(0,0),this.acceleration=new t.Vector(0,0),this.particleRotationalVelocity=0,this.currentRotation=0,this.focus=null,this.focusAccel=0,this.opacity=1,this.beginColor=t.Color.White.clone(),this.endColor=t.Color.White.clone(),this.life=300,this.fadeFlag=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=t.Color.White.clone(),this.emitter=null,this.particleSize=5,this.particleSprite=null,this.sizeRate=0,this.elapsedMultiplier=0,this.emitter=e,this.life=i||this.life,this.opacity=o||this.opacity,this.endColor=s||this.endColor.clone(),this.beginColor=n||this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.position=r||this.position,this.velocity=a||this.velocity,this.acceleration=h||this.acceleration,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.opacity/this.life,this.startSize=c||0,this.endSize=l||0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.particleSize=this.startSize)}return e.prototype.kill=function(){this.emitter.removeParticle(this)},e.prototype.update=function(e){if(this.life=this.life-e,this.elapsedMultiplier=this.elapsedMultiplier+e,0>this.life&&this.kill(),this.fadeFlag&&(this.opacity=t.Util.clamp(this._aRate*this.life,1e-4,1)),this.startSize>0&&this.endSize>0&&(this.particleSize=t.Util.clamp(this.sizeRate*e+this.particleSize,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=t.Util.clamp(this._currentColor.r+this._rRate*e,0,255),this._currentColor.g=t.Util.clamp(this._currentColor.g+this._gRate*e,0,255),this._currentColor.b=t.Util.clamp(this._currentColor.b+this._bRate*e,0,255),this._currentColor.a=t.Util.clamp(this.opacity,1e-4,1),this.focus){var i=this.focus.sub(this.position).normalize().scale(this.focusAccel).scale(e/1e3);this.velocity=this.velocity.add(i)}else this.velocity=this.velocity.add(this.acceleration.scale(e/1e3));this.position=this.position.add(this.velocity.scale(e/1e3)),this.particleRotationalVelocity&&(this.currentRotation=(this.currentRotation+this.particleRotationalVelocity*e/1e3)%(2*Math.PI))},e.prototype.draw=function(e){return this.particleSprite?(this.particleSprite.rotation=this.currentRotation,this.particleSprite.scale.setTo(this.particleSize,this.particleSize),this.particleSprite.draw(e,this.position.x,this.position.y),void 0):(this._currentColor.a=t.Util.clamp(this.opacity,1e-4,1),e.fillStyle=""+this._currentColor,e.beginPath(),e.arc(this.position.x,this.position.y,this.particleSize,0,2*Math.PI),e.fill(),e.closePath(),void 0)},e}();t.Particle=i;var o=function(o){function n(i,n,s,r){o.call(this,i,n,s,r,t.Color.White),this._particlesToEmit=0,this.numParticles=0,this.isEmitting=!0,this.particles=null,this.deadParticles=null,this.minVel=0,this.maxVel=0,this.acceleration=new t.Vector(0,0),this.minAngle=0,this.maxAngle=0,this.emitRate=1,this.particleLife=2e3,this.opacity=1,this.fadeFlag=!1,this.focus=null,this.focusAccel=1,this.startSize=null,this.endSize=null,this.minSize=5,this.maxSize=5,this.beginColor=t.Color.White,this.endColor=t.Color.White,this.particleSprite=null,this.emitterType=e.Rectangle,this.radius=0,this.particleRotationalVelocity=0,this.randomRotation=!1,this.collisionType=t.CollisionType.PreventCollision,this.particles=new t.Util.Collection,this.deadParticles=new t.Util.Collection;for(var a=0;this.traits.length>a;a++)this.traits[a]instanceof t.Traits.OffscreenCulling&&this.traits.splice(a,1)}return __extends(n,o),n.prototype.removeParticle=function(t){this.deadParticles.push(t)},n.prototype.emitParticles=function(t){for(var e=0;t>e;e++)this.particles.push(this._createParticle())},n.prototype.clearParticles=function(){this.particles.clear()},n.prototype._createParticle=function(){var o=0,n=0,s=t.Util.randomInRange(this.minAngle,this.maxAngle),r=t.Util.randomInRange(this.minVel,this.maxVel),a=this.startSize||t.Util.randomInRange(this.minSize,this.maxSize),h=r*Math.cos(s),c=r*Math.sin(s);if(this.emitterType===e.Rectangle)o=t.Util.randomInRange(this.pos.x,this.pos.x+this.getWidth()),n=t.Util.randomInRange(this.pos.y,this.pos.y+this.getHeight());else if(this.emitterType===e.Circle){var l=t.Util.randomInRange(0,this.radius);o=l*Math.cos(s)+this.pos.x,n=l*Math.sin(s)+this.pos.y}var u=new i(this,this.particleLife,this.opacity,this.beginColor,this.endColor,new t.Vector(o,n),new t.Vector(h,c),this.acceleration,this.startSize,this.endSize);
return u.fadeFlag=this.fadeFlag,u.particleSize=a,this.particleSprite&&(u.particleSprite=this.particleSprite),u.particleRotationalVelocity=this.particleRotationalVelocity,this.randomRotation&&(u.currentRotation=t.Util.randomInRange(0,2*Math.PI)),this.focus&&(u.focus=this.focus.add(new t.Vector(this.pos.x,this.pos.y)),u.focusAccel=this.focusAccel),u},n.prototype.update=function(t,e){var i=this;o.prototype.update.call(this,t,e),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(e/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit))),this.particles.forEach(function(t){return t.update(e)}),this.deadParticles.forEach(function(t){return i.particles.removeElement(t)}),this.deadParticles.clear()},n.prototype.draw=function(t){this.particles.forEach(function(e){return e.draw(t)})},n.prototype.debugDraw=function(e){o.prototype.debugDraw.call(this,e),e.fillStyle=""+t.Color.Black,e.fillText("Particles: "+this.particles.count(),this.pos.x,this.pos.y+20),this.focus&&(e.fillRect(this.focus.x+this.pos.x,this.focus.y+this.pos.y,3,3),t.Util.DrawUtil.line(e,t.Color.Yellow,this.focus.x+this.pos.x,this.focus.y+this.pos.y,o.prototype.getCenter.call(this).x,o.prototype.getCenter.call(this).y),e.fillText("Focus",this.focus.x+this.pos.x,this.focus.y+this.pos.y))},n}(t.Actor);t.ParticleEmitter=o})(ex||(ex={}));var ex;(function(t){var e=function(){function e(e,i,o,n){this.currentFrame=0,this._oldTime=Date.now(),this.anchor=new t.Vector(0,0),this.rotation=0,this.scale=new t.Vector(1,1),this.loop=!1,this.freezeFrame=-1,this.flipVertical=!1,this.flipHorizontal=!1,this.width=0,this.height=0,this.naturalWidth=0,this.naturalHeight=0,this.sprites=i,this.speed=o,this._engine=e,null!=n&&(this.loop=n),i&&i[0]&&(this.height=i[0]?i[0].height:0,this.width=i[0]?i[0].width:0,this.naturalWidth=i[0]?i[0].naturalWidth:0,this.naturalHeight=i[0]?i[0].naturalHeight:0,this.freezeFrame=i.length-1)}return e.prototype.opacity=function(e){this.addEffect(new t.Effects.Opacity(e))},e.prototype.grayscale=function(){this.addEffect(new t.Effects.Grayscale)},e.prototype.invert=function(){this.addEffect(new t.Effects.Invert)},e.prototype.fill=function(e){this.addEffect(new t.Effects.Fill(e))},e.prototype.colorize=function(e){this.addEffect(new t.Effects.Colorize(e))},e.prototype.lighten=function(e){void 0===e&&(e=.1),this.addEffect(new t.Effects.Lighten(e))},e.prototype.darken=function(e){void 0===e&&(e=.1),this.addEffect(new t.Effects.Darken(e))},e.prototype.saturate=function(e){void 0===e&&(e=.1),this.addEffect(new t.Effects.Saturate(e))},e.prototype.desaturate=function(e){void 0===e&&(e=.1),this.addEffect(new t.Effects.Desaturate(e))},e.prototype.addEffect=function(t){for(var e in this.sprites)this.sprites[e].addEffect(t)},e.prototype.removeEffect=function(t){for(var e in this.sprites)this.sprites[e].removeEffect(t)},e.prototype.clearEffects=function(){for(var t in this.sprites)this.sprites[t].clearEffects()},e.prototype._setAnchor=function(t){for(var e in this.sprites)this.sprites[e].anchor.setTo(t.x,t.y)},e.prototype._setRotation=function(t){for(var e in this.sprites)this.sprites[e].rotation=t},e.prototype._setScale=function(t){for(var e in this.sprites)this.sprites[e].scale=t},e.prototype.reset=function(){this.currentFrame=0},e.prototype.isDone=function(){return!this.loop&&this.currentFrame>=this.sprites.length},e.prototype.tick=function(){var t=Date.now();t-this._oldTime>this.speed&&(this.currentFrame=this.loop?(this.currentFrame+1)%this.sprites.length:this.currentFrame+1,this._oldTime=t)},e.prototype._updateValues=function(){this._setAnchor(this.anchor),this._setRotation(this.rotation),this._setScale(this.scale)},e.prototype.skip=function(t){this.currentFrame=(this.currentFrame+t)%this.sprites.length},e.prototype.draw=function(e,i,o){this.tick(),this._updateValues();var n;this.currentFrame<this.sprites.length&&(n=this.sprites[this.currentFrame],this.flipVertical&&(n.flipVertical=this.flipVertical),this.flipHorizontal&&(n.flipHorizontal=this.flipHorizontal),n.draw(e,i,o)),-1!==this.freezeFrame&&this.currentFrame>=this.sprites.length&&(n=this.sprites[t.Util.clamp(this.freezeFrame,0,this.sprites.length-1)],n.draw(e,i,o)),n&&(this.width=n.width,this.height=n.height)},e.prototype.play=function(t,e){this.reset(),this._engine.playAnimation(this,t,e)},e}();t.Animation=e})(ex||(ex={}));var ex;(function(t){var e;(function(e){var i=function(){function e(e,i){this.path=e,this._log=t.Logger.getInstance(),this.onload=function(){},this.onprogress=function(){},this.onerror=function(){},window.AudioContext?(this._log.debug("Using new Web Audio Api for "+e),this._soundImpl=new s(e,i)):(this._log.debug("Falling back to Audio Element for "+e),this._soundImpl=new o(e,i))}return e.prototype.setVolume=function(t){this._soundImpl.setVolume(t)},e.prototype.setLoop=function(t){this._soundImpl.setLoop(t)},e.prototype.load=function(){this._soundImpl.onload=this.onload,this._soundImpl.onprogress=this.onprogress,this._soundImpl.onerror=this.onerror,this._soundImpl.load()},e.prototype.processData=function(t){return this._soundImpl.processData(t)},e.prototype.getData=function(){return this._soundImpl.getData()},e.prototype.setData=function(t){this._soundImpl.setData(t)},e.prototype.isPlaying=function(){return this._soundImpl.isPlaying()},e.prototype.play=function(){return this._soundImpl.play()},e.prototype.pause=function(){this._soundImpl.pause()},e.prototype.stop=function(){this._soundImpl.stop()},e}();e.FallbackAudio=i;var o=function(){function e(e,i){var o=this;this.path=e,this._audioElements=Array(5),this._loadedAudio=null,this._isLoaded=!1,this._index=0,this._log=t.Logger.getInstance(),this._isPlaying=!1,this._currentOffset=0,this.onload=function(){},this.onprogress=function(){},this.onerror=function(){};for(var n=0;this._audioElements.length>n;n++)(function(t){o._audioElements[t]=new Audio})(n);i?this.setVolume(t.Util.clamp(i,0,1)):this.setVolume(1)}return e.prototype.isPlaying=function(){return this._isPlaying},e.prototype._audioLoaded=function(){this._isLoaded=!0},e.prototype.setVolume=function(t){var e=0,i=this._audioElements.length;for(e;i>e;e++)this._audioElements[e].volume=t},e.prototype.setLoop=function(t){var e=0,i=this._audioElements.length;for(e;i>e;e++)this._audioElements[e].loop=t},e.prototype.getLoop=function(){this._audioElements.some(function(t){return t.loop})},e.prototype.load=function(){var t=this;if(!this._loadedAudio){var e=new XMLHttpRequest;e.open("GET",this.path,!0),e.responseType="blob",e.onprogress=this.onprogress,e.onerror=this.onerror,e.onload=function(i){return 200!==e.status?(t._log.error("Failed to load audio resource ",t.path," server responded with error code",e.status),t.onerror(e.response),t._isLoaded=!1,void 0):(t._isLoaded=!0,t.setData(e.response),t.onload(i),void 0)},e.send()}},e.prototype.getData=function(){return this._loadedAudio},e.prototype.setData=function(t){this._isLoaded=!0,this._loadedAudio=this.processData(t)},e.prototype.processData=function(t){var e=URL.createObjectURL(t);return this._audioElements.forEach(function(t){t.src=e}),this._audioLoaded(),e},e.prototype.play=function(){var e=this;this._audioElements[this._index].load(),this._audioElements[this._index].play(),this._currentOffset=0;var i=new t.Promise;return this._isPlaying=!0,this.getLoop()||this._audioElements[this._index].addEventListener("ended",function(){e._isPlaying=!1,i.resolve(!0)}),this._index=(this._index+1)%this._audioElements.length,i},e.prototype.pause=function(){this._index=(this._index-1+this._audioElements.length)%this._audioElements.length,this._currentOffset=this._audioElements[this._index].currentTime,this._audioElements.forEach(function(t){t.pause()}),this._isPlaying=!1},e.prototype.stop=function(){this._audioElements.forEach(function(t){t.pause()}),this._isPlaying=!1},e}();if(e.AudioTag=o,window.AudioContext)var n=new window.AudioContext;var s=function(){function e(e,i){this.path=e,this._context=n,this._volume=this._context.createGain(),this._buffer=null,this._sound=null,this._isLoaded=!1,this._loop=!1,this._isPlaying=!1,this._isPaused=!1,this._currentOffset=0,this._logger=t.Logger.getInstance(),this._data=null,this.onload=function(){},this.onprogress=function(){},this.onerror=function(){},this._volume.gain.value=i?t.Util.clamp(i,0,1):1}return e.prototype.setVolume=function(t){this._volume.gain.value=t},e.prototype.load=function(){var t=this;if(null===this._data){var e=new XMLHttpRequest;e.open("GET",this.path),e.responseType="arraybuffer",e.onprogress=this.onprogress,e.onerror=this.onerror,e.onload=function(){return 200!==e.status?(t._logger.error("Failed to load audio resource ",t.path," server responded with error code",e.status),t.onerror(e.response),t._isLoaded=!1,void 0):(t.setData(e.response),void 0)};try{e.send()}catch(i){console.error("Error loading sound! If this is a cross origin error, you must host your sound with your html and javascript.")}}},e.prototype.getData=function(){return this._data},e.prototype.setData=function(t){this._data=this.processData(t)},e.prototype.processData=function(t){var e=this;return this._context.decodeAudioData(t,function(t){e._buffer=t,e._isLoaded=!0,e.onload(e)},function(){e._logger.error("Unable to decode "+e.path+" this browser may not fully support this format, or the file may be corrupt, "+"if this is an mp3 try removing id3 tags and album art from the file."),e._isLoaded=!1,e.onload(e)}),t},e.prototype.setLoop=function(t){this._loop=t},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.play=function(){var e=this;if(this._isLoaded){this._sound=this._context.createBufferSource(),this._sound.buffer=this._buffer,this._sound.loop=this._loop,this._sound.connect(this._volume),this._volume.connect(this._context.destination),this._sound.start(0,this._currentOffset%this._buffer.duration),this._currentOffset=0;var i;return i=this._isPaused&&this._playPromise?this._playPromise:new t.Promise,this._isPaused=!1,this._isPlaying=!0,this._loop||(this._sound.onended=function(){e._isPlaying=!1,e._isPaused||i.resolve(!0)}.bind(this)),this._playPromise=i,i}return t.Promise.wrap(!0)},e.prototype.pause=function(){if(this._isPlaying)try{window.clearTimeout(this._playingTimer),this._sound.stop(0),this._currentOffset=this._context.currentTime,this._isPlaying=!1,this._isPaused=!0}catch(t){this._logger.warn("The sound clip",this.path,"has already been paused!")}},e.prototype.stop=function(){if(this._sound)try{window.clearTimeout(this._playingTimer),this._currentOffset=0,this._sound.stop(0),this._isPlaying=!1,this._isPaused=!1}catch(t){this._logger.warn("The sound clip",this.path,"has already been stopped!")}},e.unlock=function(){if(!this._unlocked&&n){var t=n.createBuffer(1,1,22050),e=n.createBufferSource();e.buffer=t,e.connect(n.destination),e.noteOn?e.noteOn(0):e.start(0),setTimeout(function(){(e.playbackState===e.PLAYING_STATE||e.playbackState===e.FINISHED_STATE)&&(this._unlocked=!0)},0)}},e.isUnlocked=function(){return this._unlocked},e._unlocked=!1,e}();e.WebAudio=s})(e=t.Internal||(t.Internal={}))})(ex||(ex={}));var ex;(function(t){var e;(function(e){var i;(function(e){function i(e,i,o,n,s,r){void 0===i&&(i=t.Color.Red.clone()),e.beginPath(),e.strokeStyle=""+i,e.moveTo(o,n),e.lineTo(s,r),e.closePath(),e.stroke()}function o(e,i,o){void 0===i&&(i=t.Color.Red.clone()),e.beginPath(),e.strokeStyle=""+i,e.arc(o.x,o.y,5,0,2*Math.PI),e.closePath(),e.stroke()}function n(t,e,i,o,n){void 0===n&&(n=1);var s=e?""+e:"blue",r=o.scale(n);t.beginPath(),t.strokeStyle=s,t.moveTo(i.x,i.y),t.lineTo(i.x+r.x,i.y+r.y),t.closePath(),t.stroke()}function s(e,i,o,n,s,r,a,h){void 0===r&&(r=5),void 0===a&&(a=t.Color.White),void 0===h&&(h=null);var c;if("number"==typeof r)c={tl:r,tr:r,br:r,bl:r};else{var l={tl:0,tr:0,br:0,bl:0};for(var u in l)c[u]=r[u]||l[u]}e.beginPath(),e.moveTo(i+c.tl,o),e.lineTo(i+n-c.tr,o),e.quadraticCurveTo(i+n,o,i+n,o+c.tr),e.lineTo(i+n,o+s-c.br),e.quadraticCurveTo(i+n,o+s,i+n-c.br,o+s),e.lineTo(i+c.bl,o+s),e.quadraticCurveTo(i,o+s,i,o+s-c.bl),e.lineTo(i,o+c.tl),e.quadraticCurveTo(i,o,i+c.tl,o),e.closePath(),h&&(e.fillStyle=""+h,e.fill()),a&&(e.strokeStyle=""+a,e.stroke())}e.line=i,e.point=o,e.vector=n,e.roundRect=s})(i=e.DrawUtil||(e.DrawUtil={}))})(e=t.Util||(t.Util={}))})(ex||(ex={}));var ex;(function(t){var e=function(e){function i(i){e.call(this),this._resourceList=[],this._index=0,this._resourceCount=0,this._numLoaded=0,this._progressCounts={},this._totalCounts={},this.getData=function(){},this.setData=function(){},this.processData=function(){},this.onprogress=function(e){t.Logger.getInstance().debug("[ex.Loader] Loading "+(100*e.loaded/e.total).toFixed(0))},this.oncomplete=function(){},this.onerror=function(){},i&&this.addResources(i)}return __extends(i,e),i.prototype.wireEngine=function(t){this._engine=t},i.prototype.addResource=function(t){var e=this._index++;this._resourceList.push(t),this._progressCounts[e]=0,this._totalCounts[e]=1,this._resourceCount++},i.prototype.addResources=function(t){var e=0,i=t.length;for(e;i>e;e++)this.addResource(t[e])},i.prototype._sumCounts=function(t){var e=0;for(var i in t)e+=0|t[i];return e},i.prototype.isLoaded=function(){return this._numLoaded===this._resourceCount},i.prototype.load=function(){function e(t,i){t[i]&&t[i].load().then(function(){e(t,i+1)})}var i=this,o=new t.Promise,n=this;if(0===this._resourceList.length)return n.oncomplete.call(n),o;var s=Array(this._resourceList.length),r=this._resourceList.length;return this._resourceList.forEach(function(t,e){i._engine&&t.wireEngine(i._engine),t.onprogress=function(t){var i=t.total,o=t.loaded;s[e]={loaded:o/i*(100/r),total:100};var a=s.reduce(function(t,e){return{loaded:t.loaded+e.loaded,total:100}},{loaded:0,total:100});n.onprogress.call(n,a)},t.oncomplete=t.onerror=function(){n._numLoaded++,n._numLoaded===n._resourceCount&&(n.oncomplete.call(n),o.resolve())}}),e(this._resourceList,0),o},i.prototype.draw=function(e){e.fillStyle="#176BAA",e.fillRect(0,0,this._engine.width,this._engine.height);var i=468,o=118,n=this._engine.canvas.height/2,s=Math.min(i,.75*this._engine.canvas.width),r=this._engine.width/2-s/2,a=new Image;a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdQAAAB2CAYAAABxhGI9AAAACXBIWXMAAAsSAAALEgHS3X78AAAKnUlEQVR42u3dP2wjSx0H8N8hJIonIRmJjsq0SBR+BQ1dcqKhe0lD77SvSwpKkJKGPulpktfRIMUdEqKIqV57rpAokM4dbSiyq7ONPTP7x39ifz7SFbnEnp3xer47O7uzH15fXwMA6OYHmgAABCoACFQAEKgAgEAFAIEKAAIVAAQqACBQAUCgAoBABQCBCgAIVAAQqAAgUAFAoAIAAhUABCoACFQAEKgAgECFLbmOiNeFf2PbAyz68Pr6qhUgbRwR92v+/zwiJrYHMEKFMmcN///UtgcQqFBk1PD/97U9Qx8VCFSgu4EmAIEKAAIVAAQqACBQ4Z25jojP8eX+0WtNAgIVaOY+Im5j+eKh24h41jQgUIEyZ7F5NaPU7wCBCiwYd/w9cOB+qAlgJ3KLLow0EV198803RWvJfvfddx+0lhEqHKu5JgAjVCBvlhmFzjQRXUekHz9+TP79y8uLRjNChXfvoePvAYEKxNtj1e42/O5JoIJABcrdRMRVLM+X3kTEpaaB988cKuzWg9EobTWdMx0Oly8uN4dqhAoARqgnaN3arHfqu7OyH8ItKLVB/P+CEfMTHyGPY3npx1m8zWGDEeoBfUk/xdti57dr/r1Wv2+6EPow3tZ5rRdS72s1neuF97xvWd+XTH0/V+UMttDWqbI/r2nrxfp+jv2uSjSO7S+OXy/A/3lN+9xX5T5HxEUPZZ0tfB71+w57eJ/HFu+z+jkv1u92YX9fbI/HhX3JA9rp5MPr66tWaG9UfUGbrHIzi7cLUyYFf/tpTady03EEeL8mUJ6i7MKYNvWNqr4Pe2jradXO60LrvPAz2PQ5RPX684ah8dxD+2zantnCgVipSVV+m/tgB9W2DDq2Sx/vM95wcHhZhWVJm8yrv58cSgfTdc70+++/X/r522+/tUKSEepBqo+om4ZLPerMjUwuNnQCtx1GWJtee1FwdD5uWd86xLs8UaVt2aNEO1/saZ/Z5rYMW4zq6v34rGV9Bg3q2eZ9SkeNm9qwyUh30OPIHYFKx5FG03C7znSOqYBq+qW/zpQ3anH037TNHluG6f0WPsPhHvab4QFty7ogOeuxDYcNy2/zu2214WNYWxmBurNO8bGn97pNBOO8xy/9uCorZZ4I2r4C7aJgO7ZV9iE49Dm6NvOWx+pWE9CUq3zbdTp9doz38TbXtzqH9RT5CyWe422OaZoZGeZCabrhPQY9HjwsjpTvCg4YtlE2+Ta/j2bzn8fqrDqgm+6yUHOmAvWUjAtGhbNYvsBknDnqH1Qhc7VmxHgeb/NbudA5j/UXlYwif2p6luhAc9teu1npiHKnDs8if6tCm7JLX3NKpgttXe9ruc9mHMd7a83iwdxF5vt8tutARaCeklRnNK9C8WnNF7geJQ4T4XG3JhSnVdilQrG+yOnrlVHfsEGYzhNBn7Lu6tS7+HJafJQ4EMiNlNqWXZ9WPvVgnVYHG5M1ByDXkT6leX2EgTqJtyt45yv7S2qO3sEZjZhDLXeR+YKdJ0Zdk8QocvH9N732KrNtq+FZ/zzIHABcJrYpd+Xv14lOd5ap76SgrduW/VTQ1qcQpqnbgu4ifZvUMNpd9XuoZmvCtPaQ2Y/BCHVLgbrJTeRPDdVf6pfMKDU2fOkHmVFFfXr3MsouLsnNvV5kRoe5+s431PeuoKPqWnaurY/ZPBEeqwceN4l96iwO6H7Mjq4y7VGPVNe10VaZMzVCPVWpI/Z6FZbcv5fMqGCU+dLfFGzj58jP8+bCdJCo7yzKTwdOF0bu9Ug7V4c+yz7FJfYeGoysUss0HssIdVZwYLDujMqlESoCdTtGsZtbHnJBeNdDSJSs0jTKdMJN1HNX54Wv7bvsU9NkVJVa13dX+/wuArV0X/l5RHyo/lnfF4G6p6DrS0kHdtXhy35TGErDPYZUn2WfWqDOo/lVqdMD2O/hKJhD7S/odukymq9s02QN4EEPR/zbaOumZc+r15zK1Zqznl9jsfiemTM1QmV3HUuTkedlg9HIQzRbUD93dfC+2tpj2fIHEH2+RqCCQH13gZq7hWXTNpVu19OB1fc9nQ0AKOKUb5lU0P1kDyOneoWk0lOZ9cIP0x7qu8+2BhCoR2wYu1+e7DmaXzBSsu5vaX1ne2zrpmUPTmxf7PM1Dm4y/vC7ny7Nif7+z/9ZmtM0Z3panPLtPmra9f16bcK0Dpbnwk43Vd/RHtu6zfNQTy1QBy3aqG2g9nVmxml+BOoJyT3NpWmn9xhfFnu4bvDa+44BXhqqfdf3uUF9+yz77AT31Yue2mjecYQ62NLfgkA9ghHqLNEhNem4H1c6vdyDxhf/bpz5m4coW/c39wi6VH2bPtHlcaV9cvXts+zxCe6rTeqc2ndL7uGd93QwM9bFcAzMoZZ7SgTBbWx+asui61h/iq1+RmjqdbnQXQ3T1DNQ63V/U9ucqm/pMzPb1rePsk/1iTOjgvatR4W3Lc8ULB78pELyrnAfeTcj1NU509/86mfJ33/8+Mf00a05UyPUEw7UVCeWG/WNEiExyHRMt5ltW30izUPk18ytt7lNfc8i//DvtvXto+ySA5BjljsLUF8lPkqMPEtW1JomDsiGBZ9Byb4NAvUITSN9GuwsIj6t6UTOqk7jJREkmzqli8xIs96udSO20sX0H1vW92IL9e1a9rgqVyf91gbPsTy9UD9n9lOkT8k+RfkFR5PMNqxOcdSf32PBvg3vilO+zdxE+okx9Wm0ph36XYsRZCpMF993GOk5qvqB3Dct6jvssb67KvuUNJ3frw92bhr8/STSF0JdRPMLpUCgnsgo9S76PZ246ZFk1wWvK5m3vVoYvW1Sz7nN91jfXbQ1ZQc7TW6HeaoOalypG/8/p/rP1aNAc6ZHzSnfdqPUPhdy2PQw6Nz9gSVhuhiqueUHR3uu7y7K3rdDX4u46ZrPbUa0IFBZ0seKQ3XQTRt2vm3W/a2DbNKys++rvm3ep6+y1x2UdP3bWU9lzra47U1GmlctX/sQ23t+aOlByLTh/4NAPaCRxtcdO5HLSJ/6vNtCwGx67VPmPbvWd1q9frKHtp4kAqRJ2HR9j762JfX3bZ//elPtj13PPDx1+D5tqk/Xi6NO8SHz7MmH19dXrdBNfVFP6T2PT1UHNit87/t4m5+aRH+nQBdvqyhZDKJLfZs8h7XPsqdV2ZOV+tanKB8aln0dyxdAXbV4j4gvt4oMOrbP6vbU73NW7TMlbdTnPrWpfqXfh9HKZ9vke7KuTeZRNtXRSe6+1FV//ce/ln5eXfsXgcqXzr6+9261M3moOoa7E6nvTZTfy7iNsmfb7kjfgXGsvxe0vihsEts9HTquPpt1q1vtahu2TqAiUAEEKj0zhwoARqgAu/OnX/442WH+9xc/Wvr58re/Tr7f41/+ZsRqhAoACFQAEKgAcHjMoQJskJsz/eqrr5Z+vvr7v5fmQFevAl5lztQIFQAQqAAgUAHgIJlDBdhgdQ41N2eKESoAIFABQKACwFEwhwoARqgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAEKgAgUAFAoAKAQAUAgQoACFQAEKgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAQqAAgUAFAoAKAQAUAlvwPcFDns1DsH4sAAAAASUVORK5CYII=";var h=Math.floor(s*(o/i)),c=this._engine.getAntialiasing();this._engine.setAntialiasing(!0),e.drawImage(a,0,0,i,o,r,n-h-20,s,h),e.lineWidth=2,t.Util.DrawUtil.roundRect(e,r,n,s,20,10);var l=s*(this._numLoaded/this._resourceCount),u=5,p=l-2*u,d=20-2*u;t.Util.DrawUtil.roundRect(e,r+u,n+u,p>0?p:0,d,5,null,t.Color.White),this._engine.setAntialiasing(c)},i.prototype.update=function(){},i}(t.Class);t.Loader=e;var i=function(e){function i(i,o){var n=this;e.call(this,o),this._handleOnTrigger=function(){return n._waitPromise.state()!==t.PromiseState.Pending?!1:(t.Internal.WebAudio.unlock(),n._waitPromise.resolve(n._loadedValue),n._playTrigger.style.display="none",!1)},this._playTrigger=document.getElementById(i),this._playTrigger.addEventListener("click",this._handleOnTrigger)}return __extends(i,e),i.prototype.load=function(){var i=this;return this._waitPromise=new t.Promise,e.prototype.load.call(this).then(function(t){i._loaded=!0,i._loadedValue=t,i._playTrigger.style.display="block"},function(t){i._waitPromise.reject(t)}),this._waitPromise},i}(e);t.PauseAfterLoader=i})(ex||(ex={}));var ex;(function(t){var e=function(){function e(){this.failedTests=[],this._criticalTests={canvasSupport:function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},arrayBufferSupport:function(){var t=new XMLHttpRequest;t.open("GET","/");try{t.responseType="arraybuffer"}catch(e){return!1}return"arraybuffer"===t.responseType},dataUrlSupport:function(){var t=document.createElement("canvas");return 0===t.toDataURL("image/png").indexOf("data:image/png")},objectUrlSupport:function(){return"URL"in window&&"revokeObjectURL"in URL&&"createObjectURL"in URL},rgbaSupport:function(){var t=document.createElement("a").style;return t.cssText="background-color:rgba(150,255,150,.5)",(""+t.backgroundColor).indexOf("rgba")>-1}},this._warningTest={webAudioSupport:function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext)},webglSupport:function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("webgl"))}}}return e.prototype.test=function(){var e=!1;for(var i in this._criticalTests)this._criticalTests[i]()||(this.failedTests.push(i),t.Logger.getInstance().error("Critical browser feature missing, Excalibur requires:",i),e=!0);if(e)return!1;for(var o in this._warningTest)this._warningTest[o]()||t.Logger.getInstance().warn("Warning browser feature missing, Excalibur will have reduced performance:",o);return!0},e}();t.Detector=e})(ex||(ex={}));var ex;(function(t){(function(t){t[t.Em=0]="Em",t[t.Rem=1]="Rem",t[t.Px=2]="Px",t[t.Pt=3]="Pt",t[t.Percent=4]="Percent"})(t.FontUnit||(t.FontUnit={}));var e=t.FontUnit;(function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Start=3]="Start",t[t.End=4]="End"})(t.TextAlign||(t.TextAlign={}));var i=t.TextAlign;(function(t){t[t.Top=0]="Top",t[t.Hanging=1]="Hanging",t[t.Middle=2]="Middle",t[t.Alphabetic=3]="Alphabetic",t[t.Ideographic=4]="Ideographic",t[t.Bottom=5]="Bottom"})(t.BaseAlign||(t.BaseAlign={}));var o=t.BaseAlign,n=function(n){function s(s,r,a,h,c){n.call(this,r,a),this.fontSize=10,this.fontUnit=e.Px,this.textAlign=i.Left,this.baseAlign=o.Bottom,this.letterSpacing=0,this.caseInsensitive=!0,this._textShadowOn=!1,this._shadowOffsetX=0,this._shadowOffsetY=0,this._shadowColor=t.Color.Black.clone(),this._shadowColorDirty=!1,this._textSprites={},this._shadowSprites={},this._color=t.Color.Black.clone(),this.text=s||"",this.color=t.Color.Black.clone(),this.spriteFont=c,this.collisionType=t.CollisionType.PreventCollision,this.fontFamily=h||"sans-serif"}return __extends(s,n),s.prototype.getTextWidth=function(t){var e=t.font;t.font=this.fontFamily;var i=t.measureText(this.text).width;return t.font=e,i},s.prototype._lookupFontUnit=function(t){switch(t){case e.Em:return"em";case e.Rem:return"rem";case e.Pt:return"pt";case e.Px:return"px";case e.Percent:return"%";default:return"px"}},s.prototype._lookupTextAlign=function(t){switch(t){case i.Left:return"left";case i.Right:return"right";case i.Center:return"center";case i.End:return"end";case i.Start:return"start";default:return"start"}},s.prototype._lookupBaseAlign=function(t){switch(t){case o.Alphabetic:return"alphabetic";case o.Bottom:return"bottom";case o.Hanging:return"hangin";case o.Ideographic:return"ideographic";case o.Middle:return"middle";case o.Top:return"top";default:return"alphabetic"}},s.prototype.setTextShadow=function(t,e,i){this.spriteFont.setTextShadow(t,e,i)},s.prototype.useTextShadow=function(t){this.spriteFont.useTextShadow(t)},s.prototype.clearTextShadow=function(){this._textShadowOn=!1,this._shadowOffsetX=0,this._shadowOffsetY=0,this._shadowColor=t.Color.Black.clone()},s.prototype.update=function(t,e){n.prototype.update.call(this,t,e)},s.prototype.draw=function(t,e){t.save(),t.translate(this.pos.x,this.pos.y),t.scale(this.scale.x,this.scale.y),t.rotate(this.rotation),this._textShadowOn&&(t.save(),t.translate(this._shadowOffsetX,this._shadowOffsetY),this._fontDraw(t,e,this._shadowSprites),t.restore()),this._fontDraw(t,e,this._textSprites),n.prototype.draw.call(this,t,e),t.restore()},s.prototype._fontDraw=function(t){if(this.spriteFont)this.spriteFont.draw(t,this.text,0,0,{color:this.color.clone(),baseAlign:this.baseAlign,textAlign:this.textAlign,fontSize:this.fontSize,letterSpacing:this.letterSpacing,opacity:this.opacity});else{var e=t.textAlign,i=t.textBaseline;t.textAlign=this._lookupTextAlign(this.textAlign),t.textBaseline=this._lookupBaseAlign(this.baseAlign),this.color&&(this.color.a=this.opacity),t.fillStyle=""+this.color,t.font=""+this.fontSize+this._lookupFontUnit(this.fontUnit)+" "+this.fontFamily,this.maxWidth?t.fillText(this.text,0,0,this.maxWidth):t.fillText(this.text,0,0),t.textAlign=e,t.textBaseline=i}},s.prototype.debugDraw=function(t){n.prototype.debugDraw.call(this,t)},s}(t.Actor);t.Label=n})(ex||(ex={}));var ex;(function(t){var e;(function(e){(function(t){t[t.Touch=0]="Touch",t[t.Mouse=1]="Mouse",t[t.Pen=2]="Pen",t[t.Unknown=3]="Unknown"})(e.PointerType||(e.PointerType={}));var i=e.PointerType;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Unknown=3]="Unknown"})(e.PointerButton||(e.PointerButton={}));var o=e.PointerButton;(function(t){t[t.Canvas=0]="Canvas",t[t.Document=1]="Document"})(e.PointerScope||(e.PointerScope={}));var n=e.PointerScope,s=function(t){function e(e,i,o,n,s,r){t.call(this),this.x=e,this.y=i,this.index=o,this.pointerType=n,this.button=s,this.ev=r}return __extends(e,t),e}(t.GameEvent);e.PointerEvent=s;var r=function(e){function r(t){e.call(this),this._pointerDown=[],this._pointerUp=[],this._pointerMove=[],this._pointerCancel=[],this._pointers=[],this._activePointers=[],this._engine=t,this._pointers.push(new a),this._activePointers=[-1],this.primary=this._pointers[0]}return __extends(r,e),r.prototype.init=function(t){void 0===t&&(t=n.Document);var e=document;e=t===n.Document?document:this._engine.canvas,e.addEventListener("touchstart",this._handleTouchEvent("down",this._pointerDown)),e.addEventListener("touchend",this._handleTouchEvent("up",this._pointerUp)),e.addEventListener("touchmove",this._handleTouchEvent("move",this._pointerMove)),e.addEventListener("touchcancel",this._handleTouchEvent("cancel",this._pointerCancel)),window.PointerEvent?(this._engine.canvas.style.touchAction="none",e.addEventListener("pointerdown",this._handlePointerEvent("down",this._pointerDown)),e.addEventListener("pointerup",this._handlePointerEvent("up",this._pointerUp)),e.addEventListener("pointermove",this._handlePointerEvent("move",this._pointerMove)),e.addEventListener("pointercancel",this._handlePointerEvent("cancel",this._pointerMove))):window.MSPointerEvent?(this._engine.canvas.style.msTouchAction="none",e.addEventListener("MSPointerDown",this._handlePointerEvent("down",this._pointerDown)),e.addEventListener("MSPointerUp",this._handlePointerEvent("up",this._pointerUp)),e.addEventListener("MSPointerMove",this._handlePointerEvent("move",this._pointerMove)),e.addEventListener("MSPointerCancel",this._handlePointerEvent("cancel",this._pointerMove))):(e.addEventListener("mousedown",this._handleMouseEvent("down",this._pointerDown)),e.addEventListener("mouseup",this._handleMouseEvent("up",this._pointerUp)),e.addEventListener("mousemove",this._handleMouseEvent("move",this._pointerMove)))},r.prototype.update=function(){this._pointerUp.length=0,this._pointerDown.length=0,this._pointerMove.length=0,this._pointerCancel.length=0},r.prototype.at=function(t){if(t>=this._pointers.length)for(var e=this._pointers.length-1,i=t;i>e;e++)this._pointers.push(new a),this._activePointers.push(-1);return this._pointers[t]},r.prototype.count=function(){return this._pointers.length},r.prototype.propogate=function(e){var i=e instanceof t.UIActor,o=0,n=this._pointerUp.length;for(o;n>o;o++)e.contains(this._pointerUp[o].x,this._pointerUp[o].y,!i)&&e.eventDispatcher.emit("pointerup",this._pointerUp[o]);for(o=0,n=this._pointerDown.length,o;n>o;o++)e.contains(this._pointerDown[o].x,this._pointerDown[o].y,!i)&&e.eventDispatcher.emit("pointerdown",this._pointerDown[o]);if(e.capturePointer.captureMoveEvents)for(o=0,n=this._pointerMove.length,o;n>o;o++)e.contains(this._pointerMove[o].x,this._pointerMove[o].y,!i)&&e.eventDispatcher.emit("pointermove",this._pointerMove[o]);for(o=0,n=this._pointerCancel.length,o;n>o;o++)e.contains(this._pointerCancel[o].x,this._pointerCancel[o].y,!i)&&e.eventDispatcher.emit("pointercancel",this._pointerCancel[o])},r.prototype._handleMouseEvent=function(e,o){var n=this;return function(r){r.preventDefault();var a=r.pageX-t.Util.getPosition(n._engine.canvas).x,h=r.pageY-t.Util.getPosition(n._engine.canvas).y,c=n._engine.screenToWorldCoordinates(new t.Vector(a,h)),l=new s(c.x,c.y,0,i.Mouse,r.button,r);o.push(l),n.at(0).eventDispatcher.emit(e,l)}},r.prototype._handleTouchEvent=function(e,n){var r=this;return function(a){a.preventDefault();for(var h=0,c=a.changedTouches.length;c>h;h++){var l=r._pointers.length>1?r._getPointerIndex(a.changedTouches[h].identifier):0;if(-1!==l){var u=a.changedTouches[h].pageX-t.Util.getPosition(r._engine.canvas).x,p=a.changedTouches[h].pageY-t.Util.getPosition(r._engine.canvas).y,d=r._engine.screenToWorldCoordinates(new t.Vector(u,p)),f=new s(d.x,d.y,l,i.Touch,o.Unknown,a);n.push(f),r.at(l).eventDispatcher.emit(e,f),r._pointers.length>1&&("up"===e?r._activePointers[l]=-1:"down"===e&&(r._activePointers[l]=a.changedTouches[h].identifier))}}}},r.prototype._handlePointerEvent=function(e,i){var o=this;return function(n){n.preventDefault();var r=o._pointers.length>1?o._getPointerIndex(n.pointerId):0;if(-1!==r){var a=n.pageX-t.Util.getPosition(o._engine.canvas).x,h=n.pageY-t.Util.getPosition(o._engine.canvas).y,c=o._engine.screenToWorldCoordinates(new t.Vector(a,h)),l=new s(c.x,c.y,r,o._stringToPointerType(n.pointerType),n.button,n);i.push(l),o.at(r).eventDispatcher.emit(e,l),o._pointers.length>1&&("up"===e?o._activePointers[r]=-1:"down"===e&&(o._activePointers[r]=n.pointerId))}}},r.prototype._getPointerIndex=function(t){var e;if((e=this._activePointers.indexOf(t))>-1)return e;for(var i=0;this._activePointers.length>i;i++)if(-1===this._activePointers[i])return i;return-1},r.prototype._stringToPointerType=function(t){switch(t){case"touch":return i.Touch;case"mouse":return i.Mouse;case"pen":return i.Pen;default:return i.Unknown}},r}(t.Class);e.Pointers=r;var a=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(t.Class);e.Pointer=a})(e=t.Input||(t.Input={}))})(ex||(ex={}));var ex;(function(t){var e;(function(e){(function(t){t[t.Num1=97]="Num1",t[t.Num2=98]="Num2",t[t.Num3=99]="Num3",t[t.Num4=100]="Num4",t[t.Num5=101]="Num5",t[t.Num6=102]="Num6",t[t.Num7=103]="Num7",t[t.Num8=104]="Num8",t[t.Num9=105]="Num9",t[t.Num0=96]="Num0",t[t.Numlock=144]="Numlock",t[t.Semicolon=186]="Semicolon",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.Shift=16]="Shift",t[t.Alt=18]="Alt",t[t.Up=38]="Up",t[t.Down=40]="Down",t[t.Left=37]="Left",t[t.Right=39]="Right",t[t.Space=32]="Space",t[t.Esc=27]="Esc"})(e.Keys||(e.Keys={})),e.Keys;var i=function(t){function e(e){t.call(this),this.key=e}return __extends(e,t),e}(t.GameEvent);e.KeyEvent=i;var o=function(t){function e(e){t.call(this),this._keys=[],this._keysUp=[],this._keysDown=[],this._engine=e}return __extends(e,t),e.prototype.init=function(){var t=this;window.addEventListener("blur",function(){t._keys.length=0}),window.addEventListener("keyup",function(e){var o=t._keys.indexOf(e.keyCode);t._keys.splice(o,1),t._keysUp.push(e.keyCode);var n=new i(e.keyCode);t.eventDispatcher.emit("up",n),t.eventDispatcher.emit("release",n)}),window.addEventListener("keydown",function(e){if(-1===t._keys.indexOf(e.keyCode)){t._keys.push(e.keyCode),t._keysDown.push(e.keyCode);var o=new i(e.keyCode);t.eventDispatcher.emit("down",o),t.eventDispatcher.emit("press",o)}})},e.prototype.update=function(){this._keysDown.length=0,this._keysUp.length=0;for(var t=0;this._keys.length>t;t++)this.eventDispatcher.emit("hold",new i(this._keys[t]))},e.prototype.getKeys=function(){return this._keys},e.prototype.wasPressed=function(t){return this._keysDown.indexOf(t)>-1},e.prototype.isHeld=function(t){return this._keys.indexOf(t)>-1},e.prototype.wasReleased=function(t){return this._keysUp.indexOf(t)>-1},e}(t.Class);e.Keyboard=o})(e=t.Input||(t.Input={}))})(ex||(ex={}));var ex;(function(t){var e;(function(e){var i=function(e){function i(t){e.call(this),this.enabled=!1,this.supported=!!navigator.getGamepads,this._gamePadTimeStamps=[0,0,0,0],this._oldPads=[],this._pads=[],this._initSuccess=!1,this._navigator=navigator,this._minimumConfiguration=null,this._engine=t}return __extends(i,e),i.prototype.init=function(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))
},i.prototype.setMinimumGamepadConfiguration=function(t){this._enableAndUpdate(),this._minimumConfiguration=t},i.prototype._enableAndUpdate=function(){this.enabled||(this.enabled=!0,this.update(100))},i.prototype._isGamepadValid=function(t){if(!this._minimumConfiguration)return!0;if(!t)return!1;var e=t.axes.filter(function(t){return void 0!==typeof t}).length,i=t.buttons.filter(function(t){return void 0!==typeof t}).length;return e>=this._minimumConfiguration.axis&&i>=this._minimumConfiguration.buttons&&t.connected},i.prototype.on=function(t,i){this._enableAndUpdate(),e.prototype.on.call(this,t,i)},i.prototype.off=function(t,i){this._enableAndUpdate(),e.prototype.off.call(this,t,i)},i.prototype.update=function(){if(this.enabled&&this.supported){this.init();for(var e=this._navigator.getGamepads(),i=0;e.length>i;i++)if(e[i]){if(!this.at(i).connected&&this._isGamepadValid(e[i])&&this.eventDispatcher.emit("connect",new t.GamepadConnectEvent(i,this.at(i))),this.at(i).connected=!0,!e[i].timestamp||e[i].timestamp!==this._gamePadTimeStamps[i]){this._gamePadTimeStamps[i]=e[i].timestamp,this.at(i).navigatorGamepad=e[i];var o,r,a,h,c;for(o in n)r=n[o],"number"==typeof r&&e[i].buttons[r]&&(c=e[i].buttons[r].value,c!==this._oldPads[i].getButton(r)&&(e[i].buttons[r].pressed?(this.at(i).updateButton(r,c),this.at(i).eventDispatcher.emit("button",new t.GamepadButtonEvent(r,c))):this.at(i).updateButton(r,0)));for(a in s)h=s[a],"number"==typeof h&&(c=e[i].axes[h],c!==this._oldPads[i].getAxes(h)&&(this.at(i).updateAxes(h,c),this.at(i).eventDispatcher.emit("axis",new t.GamepadAxisEvent(h,c))));this._oldPads[i]=this._clonePad(e[i])}}else this.at(i).connected&&this.eventDispatcher.emit("disconnect",new t.GamepadDisconnectEvent(i)),this.at(i).connected=!1}},i.prototype.at=function(t){if(this._enableAndUpdate(),t>=this._pads.length)for(var e=this._pads.length-1,i=t;i>e;e++)this._pads.push(new o),this._oldPads.push(new o);return this._pads[t]},i.prototype.getValidGamepads=function(){this._enableAndUpdate();for(var t=[],e=0;this._pads.length>e;e++)this._isGamepadValid(this.at(e).navigatorGamepad)&&this.at(e).connected&&t.push(this.at(e));return t},i.prototype.count=function(){return this._pads.filter(function(t){return t.connected}).length},i.prototype._clonePads=function(t){for(var e=[],i=0,o=t.length;o>i;i++)e.push(this._clonePad(t[i]));return e},i.prototype._clonePad=function(t){var e,i,n=new o;if(!t)return n;for(e=0,i=t.buttons.length;i>e;e++)t.buttons[e]&&n.updateButton(e,t.buttons[e].value);for(e=0,i=t.axes.length;i>e;e++)n.updateAxes(e,t.axes[e]);return n},i.MinAxisMoveThreshold=.05,i}(t.Class);e.Gamepads=i;var o=function(t){function e(){t.call(this),this.connected=!1,this._buttons=Array(16),this._axes=Array(4);var e;for(e=0;this._buttons.length>e;e++)this._buttons[e]=0;for(e=0;this._axes.length>e;e++)this._axes[e]=0}return __extends(e,t),e.prototype.isButtonPressed=function(t,e){return void 0===e&&(e=1),this._buttons[t]>=e},e.prototype.getButton=function(t){return this._buttons[t]},e.prototype.getAxes=function(t){var e=this._axes[t];return Math.abs(e)<i.MinAxisMoveThreshold?0:e},e.prototype.updateButton=function(t,e){this._buttons[t]=e},e.prototype.updateAxes=function(t,e){this._axes[t]=e},e}(t.Class);e.Gamepad=o,function(t){t[t.Face1=0]="Face1",t[t.Face2=1]="Face2",t[t.Face3=2]="Face3",t[t.Face4=3]="Face4",t[t.LeftBumper=4]="LeftBumper",t[t.RightBumper=5]="RightBumper",t[t.LeftTrigger=6]="LeftTrigger",t[t.RightTrigger=7]="RightTrigger",t[t.Select=8]="Select",t[t.Start=9]="Start",t[t.LeftStick=10]="LeftStick",t[t.RightStick=11]="RightStick",t[t.DpadUp=12]="DpadUp",t[t.DpadDown=13]="DpadDown",t[t.DpadLeft=14]="DpadLeft",t[t.DpadRight=15]="DpadRight"}(e.Buttons||(e.Buttons={}));var n=e.Buttons;(function(t){t[t.LeftStickX=0]="LeftStickX",t[t.LeftStickY=1]="LeftStickY",t[t.RightStickX=2]="RightStickX",t[t.RightStickY=3]="RightStickY"})(e.Axes||(e.Axes={}));var s=e.Axes})(e=t.Input||(t.Input={}))})(ex||(ex={}));var ex;(function(t){(function(t){t[t.FullScreen=0]="FullScreen",t[t.Container=1]="Container",t[t.Fixed=2]="Fixed"})(t.DisplayMode||(t.DisplayMode={}));var e=t.DisplayMode,i=function(i){function n(o){i.call(this),this._hasStarted=!1,this.fps=0,this.postProcessors=[],this.scenes={},this._animations=[],this.isFullscreen=!1,this.displayMode=e.FullScreen,this.pauseAudioWhenHidden=!0,this.isDebug=!1,this.debugColor=new t.Color(255,255,255),this.backgroundColor=new t.Color(0,0,100),this.onFatalException=function(e){t.Logger.getInstance().fatal(e)},this._isSmoothingEnabled=!0,this._isLoading=!1,o=t.Util.extend({},n._DefaultEngineOptions,o);var s=new t.Detector;if(this._compatible=s.test())console.log&&(console.log("%cPowered by Excalibur.js (v"+EX_VERSION+")","background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;"),console.log("\n      /| ________________\nO|===|* >________________>\n      \\|"),console.log("Visit","http://excaliburjs.com","for more information")),this._logger=t.Logger.getInstance(),this._logger.debug("Building engine..."),this.canvasElementId=o.canvasElementId,o.canvasElementId?(this._logger.debug("Using Canvas element specified: "+o.canvasElementId),this.canvas=document.getElementById(o.canvasElementId)):(this._logger.debug("Using generated canvas element"),this.canvas=document.createElement("canvas")),o.width&&o.height?(void 0===o.displayMode&&(this.displayMode=e.Fixed),this._logger.debug("Engine viewport is size "+o.width+" x "+o.height),this.width=o.width,this.canvas.width=o.width,this.height=o.height,this.canvas.height=o.height):o.displayMode||(this._logger.debug("Engine viewport is fullscreen"),this.displayMode=e.FullScreen),this._loader=new t.Loader,this._initialize(o),this.rootScene=this.currentScene=new t.Scene(this),this.addScene("root",this.rootScene),this.goToScene("root");else{var r=document.createElement("div");if(r.innerText="Sorry, your browser does not support all the features needed for Excalibur",document.body.appendChild(r),s.failedTests.forEach(function(t){var e=document.createElement("div");e.innerText="Browser feature missing "+t,document.body.appendChild(e)}),o.canvasElementId){var a=document.getElementById(o.canvasElementId);a&&a.parentElement.removeChild(a)}}}return __extends(n,i),n.prototype.playAnimation=function(t,e,i){this._animations.push(new o(t,e,i))},n.prototype.addTileMap=function(t){this.currentScene.addTileMap(t)},n.prototype.removeTileMap=function(t){this.currentScene.removeTileMap(t)},n.prototype.addTimer=function(t){return this.currentScene.addTimer(t)},n.prototype.removeTimer=function(t){return this.currentScene.removeTimer(t)},n.prototype.addScene=function(t,e){this.scenes[t]&&this._logger.warn("Scene",t,"already exists overwriting"),this.scenes[t]=e,e.engine=this},n.prototype.removeScene=function(e){if(e instanceof t.Scene)for(var i in this.scenes)this.scenes.hasOwnProperty(i)&&this.scenes[i]===e&&delete this.scenes[i];"string"==typeof e&&delete this.scenes[e]},n.prototype.add=function(e){return e instanceof t.UIActor?(this.currentScene.addUIActor(e),void 0):(e instanceof t.Actor&&this._addChild(e),e instanceof t.Timer&&this.addTimer(e),e instanceof t.TileMap&&this.addTileMap(e),2===arguments.length&&this.addScene(arguments[0],arguments[1]),void 0)},n.prototype.remove=function(e){return e instanceof t.UIActor?(this.currentScene.removeUIActor(e),void 0):(e instanceof t.Actor&&this._removeChild(e),e instanceof t.Timer&&this.removeTimer(e),e instanceof t.TileMap&&this.removeTileMap(e),e instanceof t.Scene&&this.removeScene(e),"string"==typeof e&&this.removeScene(e),void 0)},n.prototype._addChild=function(t){this.currentScene.add(t)},n.prototype._removeChild=function(t){this.currentScene.remove(t)},n.prototype.goToScene=function(e){if(this.scenes[e]){var i=this.currentScene,o=this.scenes[e];this._logger.debug("Going to scene:",e),this.currentScene.isInitialized&&(this.currentScene.onDeactivate.call(this.currentScene),this.currentScene.eventDispatcher.emit("deactivate",new t.DeactivateEvent(o))),this.currentScene=o,this.currentScene.isInitialized||(this.currentScene.onInitialize.call(this.currentScene,this),this.currentScene.eventDispatcher.emit("initialize",new t.InitializeEvent(this)),this.currentScene.isInitialized=!0),this.currentScene.onActivate.call(this.currentScene),this.currentScene.eventDispatcher.emit("activate",new t.ActivateEvent(i))}else this._logger.error("Scene",e,"does not exist!")},n.prototype.getWidth=function(){return this.currentScene&&this.currentScene.camera?this.width/this.currentScene.camera.getZoom():this.width},n.prototype.getHeight=function(){return this.currentScene&&this.currentScene.camera?this.height/this.currentScene.camera.getZoom():this.height},n.prototype.screenToWorldCoordinates=function(e){var i=e.x,o=e.y;if(i=i/this.canvas.clientWidth*this.getWidth(),o=o/this.canvas.clientHeight*this.getHeight(),i-=this.getWidth()/2,o-=this.getHeight()/2,this.currentScene&&this.currentScene.camera){var n=this.currentScene.camera.getFocus();i+=n.x,o+=n.y}return new t.Vector(Math.floor(i),Math.floor(o))},n.prototype.worldToScreenCoordinates=function(e){var i=e.x,o=e.y;if(this.currentScene&&this.currentScene.camera){var n=this.currentScene.camera.getFocus();i-=n.x,o-=n.y}return i+=this.getWidth()/2,o+=this.getHeight()/2,i=i*this.canvas.clientWidth/this.getWidth(),o=o*this.canvas.clientHeight/this.getHeight(),new t.Vector(Math.floor(i),Math.floor(o))},n.prototype._setHeightByDisplayMode=function(t){this.displayMode===e.Container&&(this.width=this.canvas.width=t.clientWidth,this.height=this.canvas.height=t.clientHeight),this.displayMode===e.FullScreen&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.width=this.canvas.width=t.innerWidth,this.height=this.canvas.height=t.innerHeight)},n.prototype._initialize=function(i){var o=this;if(this.displayMode===e.FullScreen||this.displayMode===e.Container){var n=this.displayMode===e.Container?this.canvas.parentElement||document.body:window;this._setHeightByDisplayMode(n),window.addEventListener("resize",function(){o._logger.debug("View port resized"),o._setHeightByDisplayMode(n),o._logger.info("parent.clientHeight "+n.clientHeight),o.setAntialiasing(o._isSmoothingEnabled)})}this.input={keyboard:new t.Input.Keyboard(this),pointers:new t.Input.Pointers(this),gamepads:new t.Input.Gamepads(this)},this.input.keyboard.init(),this.input.pointers.init(i?i.pointerScope:t.Input.PointerScope.Document),this.input.gamepads.init(),document.addEventListener("visibilitychange",function(){document.hidden||document.msHidden?(o.eventDispatcher.emit("hidden",new t.HiddenEvent),o._logger.debug("Window hidden")):(o.eventDispatcher.emit("visible",new t.VisibleEvent),o._logger.debug("Window visible"))}),this.ctx=this.canvas.getContext("2d"),this.canvasElementId||document.body.appendChild(this.canvas)},n.prototype.setAntialiasing=function(t){this._isSmoothingEnabled=t,this.ctx.imageSmoothingEnabled=t,this.ctx.webkitImageSmoothingEnabled=t,this.ctx.mozImageSmoothingEnabled=t,this.ctx.msImageSmoothingEnabled=t},n.prototype.getAntialiasing=function(){return this.ctx.imageSmoothingEnabled||this.ctx.webkitImageSmoothingEnabled||this.ctx.mozImageSmoothingEnabled||this.ctx.msImageSmoothingEnabled},n.prototype._update=function(e){return this._isLoading?(this._loader.update(this,e),this.input.keyboard.update(e),this.input.pointers.update(e),this.input.gamepads.update(e),void 0):(this.emit("preupdate",new t.PreUpdateEvent(this,e,this)),this.currentScene.update(this,e),this._animations=this._animations.filter(function(t){return!t.animation.isDone()}),this.input.keyboard.update(e),this.input.pointers.update(e),this.input.gamepads.update(e),this.eventDispatcher.emit("update",new t.PostUpdateEvent(this,e,this)),this.emit("postupdate",new t.PostUpdateEvent(this,e,this)),void 0)},n.prototype._draw=function(e){var i=this.ctx;if(this.emit("predraw",new t.PreDrawEvent(i,e,this)),this._isLoading)return this._loader.draw(i,e),void 0;i.clearRect(0,0,this.width,this.height),i.fillStyle=""+this.backgroundColor,i.fillRect(0,0,this.width,this.height),this.currentScene.draw(this.ctx,e);var o=0,n=this._animations.length;for(o;n>o;o++)this._animations[o].animation.draw(i,this._animations[o].x,this._animations[o].y);if(this.fps=1/(e/1e3),this.isDebug){this.ctx.font="Consolas",this.ctx.fillStyle=""+this.debugColor;for(var s=this.input.keyboard.getKeys(),r=0;s.length>r;r++)this.ctx.fillText(""+s[r]+" : "+(t.Input.Keys[s[r]]?t.Input.Keys[s[r]]:"Not Mapped"),100,10*r+10);this.ctx.fillText("FPS:"+(""+this.fps.toFixed(2)),10,10)}for(var a=0;this.postProcessors.length>a;a++)this.postProcessors[a].process(this.ctx.getImageData(0,0,this.width,this.height),this.ctx);this.emit("postdraw",new t.PostDrawEvent(i,e,this))},n.prototype.start=function(e){if(!this._compatible){var i=new t.Promise;return i.reject("Excalibur is incompatible with your browser")}var o;if(e?(this._loader=e,this._loader.wireEngine(this),o=this.load(this._loader)):o=t.Promise.wrap(),!this._hasStarted){this._hasStarted=!0,this._logger.debug("Starting game...");var n=Date.now(),s=this;(function r(){if(s._hasStarted)try{s._requestId=window.requestAnimationFrame(r);var t=Date.now(),e=Math.floor(t-n)||1;e>200&&(e=1),s._update(e),s._draw(e),n=t}catch(i){window.cancelAnimationFrame(s._requestId),s.stop(),s.onFatalException(i)}})(),this._logger.debug("Game started")}return o},n.prototype.stop=function(){this._hasStarted&&(this._hasStarted=!1,this._logger.debug("Game stopped"))},n.prototype.screenshot=function(){var t=new Image,e=this.canvas.toDataURL("image/png");return t.src=e,t},n.prototype.load=function(e){var i=this,o=new t.Promise;return this._isLoading=!0,e.load().then(function(){setTimeout(function(){i._isLoading=!1,o.resolve()},500)}),o},n._DefaultEngineOptions={width:0,height:0,canvasElementId:"",pointerScope:t.Input.PointerScope.Document},n}(t.Class);t.Engine=i;var o=function(){function t(t,e,i){this.animation=t,this.x=e,this.y=i}return t}()})(ex||(ex={}));
;
// Concatenated onto excalibur after build
// Exports the excalibur module so it can be used with browserify
// https://github.com/excaliburjs/Excalibur/issues/312
if (typeof module !== 'undefined') {module.exports = ex;}