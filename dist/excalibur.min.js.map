{"version":3,"sources":["webpack://ex/webpack/universalModuleDefinition","webpack://ex/webpack/bootstrap","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/export.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/well-known-symbol.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-method-uses-to-length.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/to-length.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/fails.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/global.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/to-object.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/is-object.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/has.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-define-property.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-method-is-strict.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/descriptors.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/add-to-unscopables.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/to-indexed-object.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-iteration.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/to-integer.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/create-non-enumerable-property.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/an-object.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/is-array.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/to-absolute-index.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/iterators.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/a-function.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/create-property.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-species-create.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-method-has-species-support.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/create-property-descriptor.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/indexed-object.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/get-built-in.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/require-object-coercible.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/internal-state.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/set-global.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/to-primitive.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/shared-key.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/is-pure.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/hidden-keys.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/classof-raw.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/path.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-includes.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/enum-bug-keys.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-get-prototype-of.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/function-bind-context.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/inspect-source.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/shared-store.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/ie8-dom-define.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/document-create-element.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/shared.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/uid.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/define-iterator.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-get-own-property-descriptor.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/redefine.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-keys-internal.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/iterators-core.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/native-symbol.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-create.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/set-to-string-tag.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/engine-v8-version.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/flatten-into-array.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-reduce.js","webpack://ex/./Loader.css?8141","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/es/array/index.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.string.iterator.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/string-multibyte.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/native-weak-map.js","webpack://ex/(webpack)/buildin/global.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-property-is-enumerable.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/copy-constructor-properties.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/own-keys.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-get-own-property-names.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-get-own-property-symbols.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/is-forced.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/create-iterator-constructor.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/correct-prototype-getter.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/use-symbol-as-uid.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-define-properties.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-keys.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/html.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-set-prototype-of.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/a-possible-prototype.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.from.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-from.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/call-with-safe-iteration-closing.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/is-array-iterator-method.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/get-iterator-method.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/classof.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/to-string-tag-support.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/check-correctness-of-iteration.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.is-array.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.of.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.concat.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/engine-user-agent.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.copy-within.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-copy-within.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.every.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.fill.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-fill.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.filter.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.find.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.find-index.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.flat.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.flat-map.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.for-each.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-for-each.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.includes.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.index-of.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.iterator.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.join.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.last-index-of.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-last-index-of.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.map.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.reduce.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.reduce-right.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.reverse.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.slice.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.some.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.sort.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.species.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/set-species.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.splice.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.unscopables.flat.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.unscopables.flat-map.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/es/function/index.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.function.bind.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/function-bind.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.function.name.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.function.has-instance.js","webpack://ex/./Loader.css","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/css-loader/dist/runtime/api.js","webpack://ex/./Promises.ts","webpack://ex/./Polyfill.ts","webpack://ex/./Collision/Side.ts","webpack://ex/./Math/Random.ts","webpack://ex/./Util/Util.ts","webpack://ex/./Util/Log.ts","webpack://ex/./Util/Decorators.ts","webpack://ex/./Algebra.ts","webpack://ex/./Events.ts","webpack://ex/./EventDispatcher.ts","webpack://ex/./Class.ts","webpack://ex/./Resources/Resource.ts","webpack://ex/./Drawing/Color.ts","webpack://ex/./Drawing/SpriteEffects.ts","webpack://ex/./Configurable.ts","webpack://ex/./Actions/RotationType.ts","webpack://ex/./Drawing/Sprite.ts","webpack://ex/./Resources/Texture.ts","webpack://ex/./Collision/CollisionType.ts","webpack://ex/./Actions/Action.ts","webpack://ex/./Util/EasingFunctions.ts","webpack://ex/./Actions/ActionContext.ts","webpack://ex/./Physics.ts","webpack://ex/./Collision/BoundingBox.ts","webpack://ex/./Collision/CollisionContact.ts","webpack://ex/./Collision/CollisionJumpTable.ts","webpack://ex/./Collision/ClosestLineJumpTable.ts","webpack://ex/./Collision/Circle.ts","webpack://ex/./Collision/Edge.ts","webpack://ex/./Collision/ConvexPolygon.ts","webpack://ex/./Collision/Shape.ts","webpack://ex/./Collision/Body.ts","webpack://ex/./Traits/TileMapCollisionDetection.ts","webpack://ex/./Util/CullingBox.ts","webpack://ex/./Traits/OffscreenCulling.ts","webpack://ex/./Traits/CapturePointer.ts","webpack://ex/./Util/DrawUtil.ts","webpack://ex/./Collision/CollisionGroup.ts","webpack://ex/./Collision/Pair.ts","webpack://ex/./Collision/Collider.ts","webpack://ex/./Actor.ts","webpack://ex/./ScreenElement.ts","webpack://ex/./Timer.ts","webpack://ex/./TileMap.ts","webpack://ex/./Resources/Sound/AudioContext.ts","webpack://ex/./Util/WebAudio.ts","webpack://ex/./Camera.ts","webpack://ex/./Loader.ts","webpack://ex/./Loader.logo.png","webpack://ex/./Util/Detector.ts","webpack://ex/./Collision/DynamicTree.ts","webpack://ex/./Collision/DynamicTreeCollisionBroadphase.ts","webpack://ex/./Util/SortedList.ts","webpack://ex/./Label.ts","webpack://ex/./Trigger.ts","webpack://ex/./Util/Actors.ts","webpack://ex/./Input/Keyboard.ts","webpack://ex/./Scene.ts","webpack://ex/./Debug.ts","webpack://ex/./Input/Pointer.ts","webpack://ex/./Input/PointerEvents.ts","webpack://ex/./Input/Gamepad.ts","webpack://ex/./Input/Pointers.ts","webpack://ex/./Util/Browser.ts","webpack://ex/./Engine.ts","webpack://ex/./Particles.ts","webpack://ex/./Events/MediaEvents.ts","webpack://ex/./Actions/Index.ts","webpack://ex/./Collision/CollisionGroupManager.ts","webpack://ex/./Drawing/Animation.ts","webpack://ex/./Drawing/Polygon.ts","webpack://ex/./Drawing/SpriteSheet.ts","webpack://ex/./Interfaces/AudioImplementation.ts","webpack://ex/./Math/PerlinNoise.ts","webpack://ex/./PostProcessing/ColorBlindCorrector.ts","webpack://ex/./Resources/Sound/AudioInstance.ts","webpack://ex/./Util/Sound.ts","webpack://ex/./Resources/Sound/Sound.ts","webpack://ex/./Resources/Gif.ts","webpack://ex/./index.ts"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","global","getOwnPropertyDescriptor","f","createNonEnumerableProperty","redefine","setGlobal","copyConstructorProperties","isForced","options","source","target","targetProperty","sourceProperty","descriptor","TARGET","GLOBAL","STATIC","stat","noTargetGet","forced","undefined","sham","shared","has","uid","NATIVE_SYMBOL","USE_SYMBOL_AS_UID","WellKnownSymbolsStore","createWellKnownSymbol","withoutSetter","DESCRIPTORS","fails","cache","thrower","it","METHOD_NAME","method","ACCESSORS","argument0","argument1","O","length","toInteger","min","Math","argument","exec","error","check","globalThis","self","Function","requireObjectCoercible","IE8_DOM_DEFINE","anObject","toPrimitive","nativeDefineProperty","P","Attributes","TypeError","wellKnownSymbol","definePropertyModule","UNSCOPABLES","ArrayPrototype","Array","configurable","IndexedObject","toObject","toLength","arraySpeciesCreate","push","createMethod","TYPE","IS_MAP","IS_FILTER","IS_SOME","IS_EVERY","IS_FIND_INDEX","NO_HOLES","$this","callbackfn","that","specificCreate","result","boundFunction","index","forEach","map","filter","some","every","find","findIndex","ceil","floor","isNaN","createPropertyDescriptor","isObject","String","classof","isArray","arg","max","integer","propertyKey","SPECIES","originalArray","C","constructor","V8_VERSION","array","foo","Boolean","bitmap","writable","split","propertyIsEnumerable","path","aFunction","variable","namespace","arguments","set","NATIVE_WEAK_MAP","objectHas","sharedKey","hiddenKeys","WeakMap","store","wmget","wmhas","wmset","metadata","STATE","enforce","getterFor","state","type","input","PREFERRED_STRING","fn","val","toString","valueOf","keys","slice","toIndexedObject","toAbsoluteIndex","IS_INCLUDES","el","fromIndex","includes","indexOf","CORRECT_PROTOTYPE_GETTER","IE_PROTO","ObjectPrototype","getPrototypeOf","a","b","apply","functionToString","inspectSource","createElement","document","EXISTS","IS_PURE","version","copyright","id","postfix","random","$","createIteratorConstructor","setPrototypeOf","setToStringTag","Iterators","IteratorsCore","IteratorPrototype","BUGGY_SAFARI_ITERATORS","ITERATOR","returnThis","this","Iterable","NAME","IteratorConstructor","next","DEFAULT","IS_SET","FORCED","CurrentIteratorPrototype","methods","KEY","getIterationMethod","KIND","defaultIterator","IterablePrototype","TO_STRING_TAG","INCORRECT_VALUES_NAME","nativeIterator","anyNativeIterator","entries","values","proto","propertyIsEnumerableModule","nativeGetOwnPropertyDescriptor","InternalStateModule","getInternalState","enforceInternalState","TEMPLATE","unsafe","simple","join","names","PrototypeOfArrayIteratorPrototype","arrayIterator","getOwnPropertySymbols","activeXDocument","defineProperties","enumBugKeys","html","documentCreateElement","EmptyConstructor","scriptTag","content","LT","NullProtoObject","domain","ActiveXObject","iframeDocument","iframe","write","close","temp","parentWindow","NullProtoObjectViaActiveX","style","display","appendChild","src","contentWindow","open","F","Properties","TAG","match","userAgent","process","versions","v8","flattenIntoArray","original","sourceLen","start","depth","mapper","thisArg","element","targetIndex","sourceIndex","mapFn","IS_RIGHT","argumentsLength","memo","left","right","charAt","defineIterator","setInternalState","iterated","string","point","done","CONVERT_TO_STRING","pos","first","second","S","position","size","charCodeAt","codeAt","test","g","e","nativePropertyIsEnumerable","NASHORN_BUG","1","V","ownKeys","getOwnPropertyDescriptorModule","getBuiltIn","getOwnPropertyNamesModule","getOwnPropertySymbolsModule","concat","internalObjectKeys","getOwnPropertyNames","replacement","feature","detection","data","normalize","POLYFILL","NATIVE","replace","toLowerCase","iterator","objectKeys","aPossiblePrototype","setter","CORRECT_SETTER","__proto__","from","checkCorrectnessOfIteration","iterable","callWithSafeIterationClosing","isArrayIteratorMethod","createProperty","getIteratorMethod","arrayLike","step","mapfn","mapping","iteratorMethod","ENTRIES","returnMethod","TO_STRING_TAG_SUPPORT","classofRaw","CORRECT_ARGUMENTS","tag","tryGet","callee","SAFE_CLOSING","called","iteratorWithReturn","SKIP_CLOSING","ITERATION_SUPPORT","of","arrayMethodHasSpeciesSupport","IS_CONCAT_SPREADABLE","IS_CONCAT_SPREADABLE_SUPPORT","SPECIES_SUPPORT","isConcatSpreadable","spreadable","k","len","E","A","copyWithin","addToUnscopables","to","end","count","inc","$every","arrayMethodIsStrict","arrayMethodUsesToLength","STRICT_METHOD","USES_TO_LENGTH","fill","endPos","$filter","HAS_SPECIES_SUPPORT","$find","SKIPS_HOLES","$findIndex","flat","depthArg","flatMap","$forEach","$includes","$indexOf","nativeIndexOf","NEGATIVE_ZERO","searchElement","kind","Arguments","nativeJoin","ES3_STRINGS","separator","lastIndexOf","nativeLastIndexOf","$map","$reduce","reduce","$reduceRight","reduceRight","nativeReverse","reverse","0","nativeSlice","Constructor","fin","$some","nativeSort","sort","FAILS_ON_UNDEFINED","FAILS_ON_NULL","comparefn","setSpecies","CONSTRUCTOR_NAME","splice","deleteCount","insertCount","actualDeleteCount","actualStart","factories","construct","argsLength","args","list","partArgs","FunctionPrototype","FunctionPrototypeToString","nameRE","HAS_INSTANCE","___CSS_LOADER_API_IMPORT___","useSourceMap","item","cssMapping","btoa","sourceMapping","sourceMap","base64","unescape","encodeURIComponent","JSON","stringify","sourceURLs","sources","sourceRoot","cssWithMappingToString","mediaQuery","dedupe","alreadyImportedModules","_i","PromiseState","polyfill","audioContext","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","callback","setInterval","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","AudioContext","webkitAudioContext","mozAudioContext","msAudioContext","oAudioContext","devicePixelRatio","Side","_state","Pending","_successCallbacks","_rejectCallback","resolve","Promise","reject","promises","joinedPromise","total","successes","rejects","errors","then","successCallback","rejectCallback","Resolved","_value","_handleError","Rejected","errorCallback","_errorCallback","Error","cb","seed","_lowerMask","_upperMask","_w","_n","_m","_a","_u","_s","_b","_t","_c","_l","_f","_mt","Date","now","_index","_twist","mag01","y","nextInt","floating","bool","likelihood","pickOne","pickSet","numPicks","allowDuplicates","_pickSetWithDuplicates","_pickSetWithoutDuplicates","currentPick","tempArray","shuffle","swap","randomIndex","range","d4","d6","d8","d10","d12","d20","TwoPI","PI","extend","extended","deep","assignExists","assign","merge","obj","prop","base64Encode","inputStr","b64","outputStr","byte1","byte2","byte3","enc1","enc2","enc3","enc4","nullish","nullishVal","defaultVal","clamp","randomInRange","Random","randomIntInRange","round","canonicalizeAngle","angle","tmpAngle","toDegrees","radians","toRadians","degrees","getPosition","oLeft","oTop","calcOffsetLeft","parent","offsetLeft","offsetParent","calcOffsetTop","offsetTop","addItemToArray","removeItemFromArray","contains","getOppositeSide","side","Top","Bottom","Left","Right","None","getSideFromDirection","direction","directions","Up","Down","directionEnum","Number","MAX_VALUE","maxIndex","dot","LogLevel","initialSize","Collection","DefaultSize","_internalArray","_endPointer","_resize","newSize","newArray","pop","clear","internalSize","elementAt","insert","remove","removed","removeElement","toArray","func","fail","message","_appenders","defaultLevel","Info","Logger","_instance","addAppender","ConsoleAppender","getInstance","appender","clearAppenders","_log","level","log","debug","Debug","info","warn","Warn","fatal","Fatal","console","consoleArgs","unshift","width","height","_messages","_canvas","innerWidth","innerHeight","_ctx","getContext","body","clearRect","opacity","fillStyle","toFixed","fillText","maxMessages","obsoleteMessage","resetObsoleteCounter","logMessage","trace","showStackTrace","obsolete","alternateMethod","showStackTrack","SyntaxError","x","Vector","fromAngle","cos","sin","isValid","vec","Infinity","distance","vec1","vec2","sqrt","pow","setTo","equals","vector","tolerance","abs","v","Zero","magnitude","newLength","scale","average","add","sizeOrScale","sub","addEqual","subEqual","scaleEqual","cross","perpendicular","normal","negate","toAngle","atan2","rotate","anchor","sinAngle","cosAngle","clone","dir","intersect","line","numerator","begin","getSlope","divisor","u","getLength","getPoint","time","slope","getEdge","flip","Line","distanceToPoint","x0","y0","dy","dx","findVectorToPoint","aMinusP","findPoint","intercept","hasPoint","currPoint","threshold","dxc","dyc","dx1","dy1","overlaps","projection","getOverlap","worldPos","pagePos","screenPos","fromPagePosition","xOrPos","yOrEngine","engineOrUndefined","pageX","pageY","engine","screenX","canvas","screenY","screenToWorldCoordinates","GlobalCoordinates","EventTypes","bubbles","stopPropagation","GameEvent","ctx","delta","prevStats","stats","gamepad","button","axis","topic","handler","actor","other","intersection","pair","oldScene","newScene","_handlers","_wiredEventDispatchers","_target","emit","eventName","event","on","SubscribeEvent","off","eventHandlers","UnsubscribeEvent","once","ev","wire","eventDispatcher","unwire","eventObject","responseType","bustCache","logger","arrayBuffer","onprogress","oncomplete","onerror","isLoaded","wireEngine","_engine","_cacheBust","uri","_start","load","complete","request","XMLHttpRequest","onloadstart","onload","status","response","processData","send","getData","getArrayData","setData","URL","createObjectURL","fromRGB","Color","fromHex","hex","parseInt","fromHSL","h","HSLColor","toRGBA","lighten","factor","fromRGBA","darken","saturate","desaturate","multiply","color","mulitiply","screen","color1","invert","color2","format","toHSLA","toHex","_componentToHex","Vermilion","hue2rgb","q","updatePixel","imageData","firstPixel","pixel","avg","Configurable","base","props","RotationType","imageOrConfig","rotation","offset","One","flipVertical","flipHorizontal","effects","_spriteCanvas","_spriteCtx","_pixelData","_pixelsLoaded","_dirtyEffect","_opacity","image","_texture","loaded","naturalWidth","naturalHeight","_loadPixels","drawImage","grayscale","addEffect","colorize","effect","_applyEffects","removeEffect","param","indexToRemove","getImageData","putImageData","clearEffects","reset","debugDraw","save","translate","xpoint","drawWidth","ypoint","drawHeight","strokeStyle","Black","strokeRect","restore","draw","ctxOrOptions","CanvasRenderingContext2D","_drawWithOptions","oldAlpha","globalAlpha","Sprite","_isLoaded","_sprite","Image","addEventListener","asSprite","CollisionType","duration","easingFcn","_currentLerpTime","_lerpDuration","_lerpStart","_lerpEnd","_initialized","_stopped","_distance","_initialize","update","newX","newY","isComplete","stop","destx","desty","speed","_started","_actor","_end","_speed","_delta","_dir","vel","offsetX","offsetY","_offset","actorToFollow","followDistance","_actorToFollow","_current","_maximumDistance","_distanceBetween","actorToFollowSpeed","actorToMeet","_speedWasSpecified","_actorToMeet","actorToMeetSpeed","angleRadians","rotationType","_rotationType","ShortestPath","distance1","distance2","_shortDistance","_longDistance","_shortestPathIsPositive","_direction","LongestPath","Clockwise","CounterClockwise","rx","distanceTravelled","angleRadiansOffset","scaleX","scaleY","speedX","speedY","_endX","_endY","_speedX","_speedY","_startX","_startY","_distanceX","_distanceY","sx","directionX","sy","directionY","ScaleTo","scaleOffsetX","scaleOffsetY","_startScale","_endScale","_directionX","_directionY","ScaleBy","delay","_elapsedTime","_delay","timeVisible","timeNotVisible","numBlinks","_timeVisible","_timeNotVisible","_totalTime","_duration","visible","endOpacity","_multiplier","_endOpacity","actionQueue","clearActions","kill","_method","_hasBeenCalled","repeat","actions","_actionQueue","ActionQueue","_repeat","_originalRepeat","hasNext","_actions","_completedActions","action","_currentAction","getActions","shift","CreateReversibleEasingFunction","easing","CreateReversableEasingFunction","EasingFunctions","CreateVectorEasingFunction","Linear","currentTime","startValue","endValue","EaseInQuad","EaseOutQuad","EaseInOutQuad","EaseInCubic","EaseOutCubic","EaseInOutCubic","_actors","_queues","addActorToContext","removeActorFromContext","easeTo","moveTo","moveBy","xOffset","yOffset","rotateTo","rotateBy","scaleTo","sizeX","sizeY","scaleBy","sizeOffsetX","sizeOffsetY","blink","fade","die","callMethod","times","repeatForever","follow","meet","asPromise","CollisionResolutionStrategy","BroadphaseStrategy","Integrator","useBoxPhysics","Physics","collisionResolutionStrategy","Box","useRigidBodyPhysics","RigidBody","dynamicTreeVelocityMultiplier","acc","enabled","collisionPasses","broadphaseStrategy","DynamicAABBTree","broadphaseDebug","showCollisionNormals","showMotionVectors","showBounds","showArea","showContacts","showNormals","defaultMass","integrator","Euler","integrationSteps","allowRigidBodyRotation","collisionShift","boundsPadding","surfaceEpsilon","checkForFastBodies","disableMinimumSpeedForFastBody","leftOrOptions","top","bottom","getSideFromIntersection","fromPoints","points","minX","minY","maxX","maxY","BoundingBox","fromDimension","Half","getPoints","shifted","getPerimeter","results","toPolygon","maybeCollider","collider","rayCast","ray","farClipDistance","tmin","tmax","xinv","yinv","tx1","tx2","ty1","ty2","rayCastTime","combine","totalBoundingBox","dimensions","overlapX","overlapY","intersectWithSide","bb","Yellow","colliderA","colliderB","mtv","strategy","_resolveRigidBodyCollision","_resolveBoxCollision","_applyBoxImpulse","Active","Passive","mtvDir","velAdj","PostCollisionEvent","PreCollisionEvent","bodyA","bodyB","invMassA","Fixed","mass","invMassB","invMoiA","inertia","invMoiB","coefRestitution","bounciness","coefFriction","friction","tangent","ra","center","rb","rv","rvNormal","rvTangent","raTangent","raNormal","rbTangent","rbNormal","impulse","addMtv","jt","frictionImpulse","CollisionJumpTable","CollideCircleCircle","circleA","circleB","radius","circleAPos","circleBPos","axisOfCollision","mvt","pointOfCollision","getFurthestPoint","CollideCirclePolygon","circle","polygon","minAxis","testSeparatingAxisTheorem","samedir","verts","point1","point2","CollideCircleEdge","edge","cc","da","dda","db","ddb","den","pointOnEdge","dd","CollideEdgeEdge","CollidePolygonEdge","edgeNormal","face","pc","linePoly","CollidePolygonPolygon","polyA","polyB","sameDir","pointA","pointB","contact","ClosestLine","p0","q0","w0","denom","sDenom","tDenom","tClosestParallel","sClosest","tClosest","ClosestLineJumpTable","PolygonPolygonClosestLine","polygonA","polygonB","otherWorldPos","otherDirection","thisDirection","rayTowardsOther","Ray","rayTowardsThis","thisPoint","otherPoint","thisFace","getClosestFace","otherFace","PolygonEdgeClosestLine","edgeLine","asLine","PolygonCircleClosestLine","circlex","circley","CircleCircleClosestLine","CircleEdgeClosestLine","circleWorlPos","EdgeEdgeClosestLine","edgeA","edgeB","edgeLineA","edgeLineB","Circle","orig","discriminant","toi","toi1","toi2","positiveToi","mintoi","getClosestLineBetween","shape","collide","bodyPos","axes","closestPointOnPoly","minOverlap","minIndex","proj1","project","proj2","overlap","recalc","scalars","dotProduct","Projection","Green","newPos","beginPath","arc","closePath","stroke","lineTo","Edge","_getBodyPos","_getTransformedBegin","_getTransformedEnd","transformedBegin","transformedEnd","_boundsFromBeginEnd","asLocalLine","Red","_transformedPoints","_axes","_sides","winding","clockwiseWinding","_calculateTransformation","ConvexPolygon","getTransformedPoints","oldPos","oldRotation","oldScale","getSides","lines","testRay","accum","pts","furthestPoint","maxDistance","sides","POSITIVE_INFINITY","faceIndex","dist","denominator","iplusone","crossTerm","minContactTime","contactIndex","contactTime","poly2","scalar","firstPoint","Polygon","oldVel","oldAcc","torque","motion","_geometryDirty","_totalMtv","useBoxCollider","Body","isKilled","_collider","_wireColliderEventsToActor","applyMtv","markCollisionShapeDirty","captureOldTransform","integrate","seconds","totalAcc","usePolygonCollider","useCircleCollider","useEdgeCollider","evt","CollisionStartEvent","CollisionEndEvent","PreventCollision","currentScene","tileMaps","j","intersectMap","collides","_topLeft","_topRight","_bottomLeft","_bottomRight","isSpriteOffScreen","drawingWidth","currentDrawing","drawingHeight","getWorldPos","topLeftScreen","worldToScreenCoordinates","topRightScreen","bottomLeftScreen","bottomRightScreen","_xCoords","_yCoords","_xMin","_yMin","_xMax","_yMax","minWorld","maxWorld","_xMinWorld","_yMinWorld","_xMaxWorld","_yMaxWorld","boundingPoints","clientWidth","clientHeight","White","rect","Blue","Magenta","cullingBox","events","actorBoundsOffscreen","camera","viewport","bounds","isOffScreen","EnterViewPortEvent","ExitViewPortEvent","enableCapturePointer","pointers","checkAndUpdateActorUnderPointer","x1","y1","x2","y2","thickness","cap","lineWidth","lineCap","origin","roundRect","br","tl","tr","bl","defaultRadius","quadraticCurveTo","category","mask","_name","_category","_mask","canCollide","All","CollisionGroup","collision","Pair","calculatePairHash","group","active","actorA","actorB","Cyan","isCollider","useShapeInertia","_events","_shape","Collider","touching","localBounds","isActor","Actor","xOrConfig","ActorImpl","maxId","_height","_width","previousOpacity","scene","children","_isInitialized","frames","_effectsDirty","_draggable","_dragging","_pointerDragStartHandler","_pointerDragEndHandler","_pointerDragMoveHandler","pe","pointer","lastWorldPos","_pointerDragLeaveHandler","traits","capturePointer","captureMoveEvents","captureDragEvents","_zIndex","_isKilled","_opacityFx","_capturePointerEvents","_captureMoveEvents","_captureDragEvents","_initDefaults","shouldInitializeBody","collisionType","config","_body","thePos","theVel","theAcc","theAngle","angularVelocity","scalePerSecondX","scalePerSecondY","isDraggable","_color","onInitialize","isInitialized","InitializeEvent","defaults","_checkForPointerOptIn","normalized","_prekill","_scene","PreKillEvent","onPreKill","_postkill","PostKillEvent","onPostKill","KillEvent","unkill","setDrawing","addDrawing","getZIndex","newZ","setZIndex","newIndex","cleanupDrawTree","updateDrawTree","getGlobalScale","getWorldRotation","parents","px","py","parentScale","recurse","childShift","containment","child","within","_reapplyEffects","drawing","_preupdate","_postupdate","onPreUpdate","onPostUpdate","PreUpdateEvent","_predraw","_postdraw","onPreDraw","onPostDraw","PreDrawEvent","PreDebugDrawEvent","ticks","Pi","oldFont","font","tick","textAlign","PostDebugDrawEvent","getAncestors","currentActor","useWorld","coords","UIActor","fcn","interval","repeats","numberOfRepeats","maxNumberOfRepeats","_totalTimeAlive","_paused","_numberOfTicks","Timer","_callbacks","newInterval","newNumberOfRepeats","getTimeRunning","pause","unpause","cancel","cancelTimer","cellWidth","cellHeight","rows","cols","_collidingX","_collidingY","_onScreenXStart","_onScreenXEnd","_onScreenYStart","_onScreenYEnd","_spriteSheets","cd","Cell","registerSpriteSheet","spriteSheet","actorBounds","cell","getCellByPoint","solid","getCellByIndex","getCell","worldCoordsUpperLeft","worldCoordsLowerRight","cs","csi","cslen","xEnd","yEnd","sprites","spriteId","ss","spriteSheetKey","sprite","getSprite","fillRect","_bounds","pushSprite","tileSprite","removeSprite","clearSprites","_INSTANCE","Axis","unlock","promise","WebAudio","_unlocked","AudioContextFactory","unlockTimeoutTimer","setTimeout","resume","buffer","createBuffer","createBufferSource","ended","connect","destination","onended","noteOn","playbackState","isLegacyWebAudioSource","PLAYING_STATE","FINISHED_STATE","clearTimeout","isUnlocked","loadables","_resourceList","_playButtonShown","_resourceCount","_numLoaded","_progressCounts","_totalCounts","logo","logoWidth","logoHeight","backgroundColor","suppressPlayButton","_playButtonStyles","playButtonText","startButtonFactory","buttonElement","textContent","addResources","_imageElement","_playButtonRootElement","_styleBlock","head","_playButtonElement","addResource","loadable","showPlayButton","_playButton","hidePlayButton","me","progressArray","progressChunks","progressResult","loadNext","canvasHeight","pixelRatio","canvasWidth","buttonWidth","buttonHeight","imageHeight","oldAntialias","getAntialiasing","setAntialiasing","_image","progressWidth","margin","REPORTED_FEATURES","webgl","webaudio","gamepadapi","_features","failedTests","_criticalTests","canvasSupport","elem","arrayBufferSupport","xhr","dataUrlSupport","toDataURL","objectUrlSupport","rgbaSupport","cssText","_warningTest","webAudioSupport","webglSupport","_loadBrowserFeatures","getBrowserFeatures","logBrowserFeatures","msg","supported","arraybuffer","dataurl","objecturl","rgba","navigator","getGamepads","failedCritical","warning","isLeaf","worldBounds","nodes","_insert","leaf","leafAABB","currentRoot","area","combinedArea","cost","inheritanceCost","leftCost","leftCombined","oldArea","rightCost","rightCombined","oldParent","newParent","currentNode","_balance","_remove","sibling","grandParent","trackBody","node","updateBody","untrackBody","multdx","multdy","balance","getHeight","query","helper","rayCastQuery","getNodes","_dynamicCollisionTree","_collisionHash","_collisionPairCache","_lastFramePairs","_lastFramePairsHash","track","untrack","_shouldGenerateCollisionPair","hash","broadphase","targets","potentialColliders","physics","pairs","updateDistance","minDimension","fastBodies","updateVec","centerPoint","hitPoint","fastBodyCollisions","narrowphase","collisions","collidersHash","runCollisionStartEnd","currentFrameHash","actor1","actor2","updated","getComparable","_getComparable","_find","_root","getKey","getLeft","getRight","_get","BinaryTreeNode","setLeft","setRight","removeByComparable","elementIndex","_findMinNode","setKey","_cleanup","comparable","current","_list","treeNode","_key","_data","_left","_right","getTheKey","lockToActor","addStrategy","LockCameraToActorStrategy","lockToActorAxis","elasticToActor","cameraElasticity","cameraFriction","ElasticToActorStrategy","radiusAroundActor","RadiusAroundActorStrategy","FontUnit","TextAlign","BaseAlign","FontStyle","_cam","_eng","cam","currentFocus","getFocus","X","focus","cameraVel","stretch","_cameraStrategies","StrategyContainer","z","dz","az","_cameraMoving","_isShaking","_shakeMagnitudeX","_shakeMagnitudeY","_shakeDuration","_elapsedShakeTime","_xShake","_yShake","_isZooming","_zoomStart","_zoomEnd","_currentZoomTime","_zoomDuration","_zoomEasing","_easing","_follow","move","easingFn","_lerpPromise","shake","magnitudeX","magnitudeY","zoom","_zoomPromise","getZoom","halfWidth","halfDrawWidth","halfHeight","halfDrawHeight","cameraStrategy","removeStrategy","clearAllStrategies","PostUpdateEvent","newZoom","zoomEasing","lerpPoint","moveEasing","_isDoneShaking","newCanvasWidth","newCanvasHeight","setLineDash","textOrConfig","fontFamily","spriteFont","bold","fontSize","fontStyle","Normal","fontUnit","Px","baseAlign","letterSpacing","caseInsensitive","text","_textShadowOn","_shadowOffsetX","_shadowOffsetY","getTextWidth","_fontString","measureText","_lookupFontUnit","Em","Rem","Pt","Percent","_lookupTextAlign","Center","End","Start","_lookupBaseAlign","Alphabetic","Hanging","Ideographic","Middle","_lookupFontStyle","boldstring","Italic","Oblique","setTextShadow","shadowColor","useTextShadow","clearTextShadow","_fontDraw","oldAlign","oldTextBaseline","textBaseline","maxWidth","triggerDefaults","opts","EnterTriggerEvent","_dispatchAction","ExitTriggerEvent","wp","Violet","isScreenElement","Keys","actors","_bodies","triggers","screenElements","_sortedDrawingTree","SortedList","_broadphase","_killQueue","_triggerKillQueue","_timers","_cancelQueue","_logger","onActivate","_oldScene","_newScene","onDeactivate","_initializeChildren","_activate","_deactivate","PostDrawEvent","removeTimer","_collectActorStats","dispatchPointerEvents","beforeBroadphase","currFrame","afterBroadphase","beforeNarrowphase","iter","collisionDelta","afterNarrowphase","killed","_processKillQueue","killQueue","collection","actorIndex","sortedChildren","isDebug","entity","addScreenElement","_addChild","addTimer","TileMap","addTileMap","removeScreenElement","_removeChild","removeTileMap","tileMap","timer","isTimerActive","isActorInDrawTree","isCurrentScene","ui","alive","FrameStats","prevFrame","_id","_fps","_actorStats","remaining","_durationStats","_physicsStats","PhysicsStats","otherStats","fps","fs","_pairs","_collisions","_collidersHash","_fastBodies","_fastBodyCollisions","_narrowphase","ps","colliders","PointerType","PointerScope","_keys","_keysUp","_keysDown","init","code","_normalizeKeyCode","keyCode","keyEvent","KeyEvent","getKeys","wasPressed","isHeld","wasReleased","Semicolon","NativePointerButton","PointerButton","WheelDeltaMode","Pointer","_MAX_ID","_isDown","_wasDown","_actorsUnderPointer","_actorsLastFrame","_actorsNoLongerUnderPointer","lastPagePos","lastScreenPos","dragTarget","_onPointerMove","_onPointerDown","_onPointerUp","addActorUnderPointer","isActorUnderPointer","removeActorUnderPointer","getActorsUnderPointer","getActorsUnderPointerLastFrame","getActorsForEvents","checkActorUnderPointer","wasActorUnderPointer","_ev","coordinates","pointerType","propagate","doAction","_onActionStart","_onActionEnd","_pointerEventType","PointerEvent","isDragEnd","isDragStart","isDragging","deltaX","deltaY","deltaZ","deltaMode","createPointerEventByName","PointerEventFactory","PointerUpEvent","PointerDownEvent","PointerMoveEvent","PointerCancelEvent","PointerEnterEvent","PointerLeaveEvent","Buttons","Axes","_pointerDown","_pointerUp","_pointerMove","_pointerCancel","_wheel","_pointers","_activePointers","primary","_handleTouchEvent","touchAction","_handlePointerEvent","MSPointerEvent","msTouchAction","_handleMouseEvent","wheelOptions","passive","pageScrollPreventionMode","ScrollPreventionMode","Canvas","_handleWheelEvent","onmousewheel","triggerEvent","pointerId","eventish","preventDefault","CapturePointer","at","_dispatchWithBubble","_dispatchPointerLeaveEvents","lastMoveEventPerPointerPerActor","pointerLeave","_dispatchPointerEnterEvents","lastMoveEventPerPointer","pointerEnter","_propagateWheelPointerEvent","wheelEvent","eventArr","Mouse","_nativeButtonToPointerButton","changedTouches","_getPointerIndex","identifier","Touch","Unknown","_stringToPointerType","transformedPoint","wheelDeltaX","wheelDeltaY","wheelDelta","detail","Pixel","Page","we","WheelEvent","idx","NoButton","Pen","_gamePadTimeStamps","_oldPads","_pads","_initSuccess","_navigator","_minimumConfiguration","_clonePads","setMinimumGamepadConfiguration","_enableAndUpdate","_isGamepadValid","pad","axesLength","buttonLength","buttons","connected","gamepads","GamepadConnectEvent","timestamp","navigatorGamepad","bi","ai","getButton","pressed","updateButton","GamepadButtonEvent","getAxes","updateAxes","GamepadAxisEvent","_clonePad","GamepadDisconnectEvent","Gamepad","getValidGamepads","pads","arr","clonedPad","MinAxisMoveThreshold","_buttons","isButtonPressed","buttonIndex","axesIndex","DisplayMode","nativeComponent","_nativeHandlers","_decorate","removeEventListener","_windowGlobal","_documentGlobal","_windowComponent","BrowserComponent","_documentComponent","EmitterType","_hasStarted","postProcessors","scenes","_animations","isFullscreen","displayMode","FullScreen","_suppressHiDPIScaling","_suppressPlayButton","pauseAudioWhenHidden","debugColor","enableCanvasTransparency","onFatalException","_isSmoothingEnabled","_timescale","_isLoading","Engine","_DefaultEngineOptions","browser","BrowserEvents","detector","suppressMinimumBrowserFeatureDetection","_compatible","innerText","testMessage","canvasElementId","getElementById","parentElement","removeChild","suppressConsoleBootMessage","EX_VERSION","canvasElement","_loader","rootScene","addScene","goToScene","getWorldBounds","playAnimation","animation","AnimationNode","removeScene","DeactivateEvent","ActivateEvent","_setHeightByDisplayMode","Container","overflow","hidden","visibilityChange","Position","_initializeDisplayModePosition","scrollPreventionMode","keyboard","pointerScope","Document","HiddenEvent","VisibleEvent","alpha","suppressHiDPIScaling","_initializeHiDpi","specifiedPosition","marginTop","marginLeft","isHiDpi","oldWidth","oldHeight","isSmooth","imageSmoothingEnabled","smoothing","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled","_overrideInitialize","_update","isDone","_draw","loader","loadingComplete","GameStartEvent","createMainLoop","game","raf","nowFn","lastTime","mainloop","_requestId","PreFrameEvent","elapsed","timescale","frameId","beforeUpdate","afterUpdate","afterDraw","PostFrameEvent","GameStopEvent","isPaused","screenshot","raw","_val","layPath","MediaEvent","processedData","emitterOrConfig","life","beginColor","endColor","velocity","acceleration","startSize","endSize","particleRotationalVelocity","currentRotation","focusAccel","fadeFlag","_rRate","_gRate","_bRate","_aRate","_currentColor","emitter","particleSize","particleSprite","sizeRate","elapsedMultiplier","ParticleEmitter","removeParticle","accel","numParticles","isEmitting","particles","deadParticles","minVel","maxVel","minAngle","maxAngle","emitRate","particleLife","minSize","maxSize","emitterType","Rectangle","randomRotation","_particlesToEmit","particle","emitParticles","particleCount","_createParticle","clearParticles","ranX","ranY","Particle","Internal","Actions","_currentGroup","_MAX_GROUPS","_groups","_currentBit","groupByName","Map","_STARTING_BIT","CollisionGroupManager","engineOrConfig","images","loop","currentFrame","_oldTime","freezeFrame","_setAnchor","_setRotation","_setScale","_updateValues","skip","currSprite","play","filled","_points","prev","curr","fillColor","lineColor","imageOrConfigOrSprites","columns","spWidth","spHeight","spacing","loadFromImage","RangeError","getAnimationByIndices","indices","Animation","getAnimationBetween","beginIndex","endIndex","getAnimationForAll","getAnimationByCoords","spriteCoordinates","maxHeight","coord","anim","alphabet","_currentOpacity","_sprites","_textShadowDirty","_textShadowColor","_textShadowSprites","_alphabet","_caseInsensitive","getTextSprites","lookup","char","character","_parseOptions","characterShadow","currX","currY","charSprite","SpriteSheet","any","blob","json","_lerp","_fade","ColorBlindness","_perm","_p","Uint8Array","_defaultPerlinOptions","octaves","frequency","amplitude","persistance","_random","noise","amp","freq","maxValue","_noise1d","_noise2d","_noise3d","sequence","grid","_gradient3d","_gradient2d","_gradient1d","intX","intY","fadeX","fadeY","intZ","fadeZ","aa","ba","ab","generator","colorFcn","simulate","colorMode","Protanope","_vertexShader","_fragmentShader","_internalCanvas","_gl","preserveDrawingBuffer","_program","createProgram","fragmentShader","_getShader","_getFragmentShaderByMode","vertextShader","attachShader","linkProgram","getProgramParameter","LINK_STATUS","useProgram","Deuteranope","Tritanope","_setRectangle","bufferData","ARRAY_BUFFER","Float32Array","STATIC_DRAW","program","shader","createShader","FRAGMENT_SHADER","VERTEX_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","out","positionLocation","getAttribLocation","texCoordLocation","texCoordBuffer","bindBuffer","enableVertexAttribArray","vertexAttribPointer","FLOAT","texture","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","pixelStorei","UNPACK_FLIP_Y_WEBGL","texImage2D","RGBA","UNSIGNED_BYTE","resolutionLocation","getUniformLocation","uniform2f","positionBuffer","drawArrays","TRIANGLES","pixelData","readPixels","AudioBuffer","_src","_volume","_loop","_isPlaying","_isPaused","_wireUpOnEnded","isPlaying","_resumePlayBack","_startPlayBack","_playingPromise","_handleOnEnded","Audio","volume","_audioContext","_volumeNode","createGain","_currentOffset","_createNewBufferSource","gain","setTargetAtTime","playbackRate","_setPauseOffset","_rememberStartTime","_playbackRate","restartTime","amend","_startTime","getTime","setValueAtTime","canPlayFile","file","canPlayType","_isStopped","_tracks","_wasPlayingOnHidden","_processedData","_detectResponseType","paths","NativeSoundEvent","instanceCount","_resumePlayback","_startPlayback","ArrayBuffer","_processArrayBufferData","_processBlobData","_setProcessedData","getTrackId","resumed","newTrack","_createNewTrack","playPromise","resolved","decodeAudioData","NativeSoundProcessedEvent","aiPromise","_getTrackInstance","AudioInstanceFactory","ExResponse","_stream","_gif","_animation","_transparentColor","Stream","imageIndex","asSpriteSheet","spriteArray","asAnimation","checkBytes","bitsToNum","byteToBitArr","bite","dataArray","readByte","byteLength","readBytes","bytes","read","fromCharCode","readUnsigned","stream","_st","_handler","globalColorTable","parseColorTable","ct","readSubBlocks","parseHeader","hdr","sig","ver","colorRes","globalColorTableSize","gctFlag","sorted","bgColor","pixelAspectRatio","bits","parseExt","block","label","extType","reserved","disposalMethod","userInput","transparencyGiven","delayTime","transparencyIndex","terminator","gce","parseGCExt","comment","com","parseComExt","ptHeader","ptData","pte","parsePTExt","authCode","unknown","iterations","app","NETSCAPE","parseNetscapeExt","appData","parseUnknownAppExt","parseAppExt","parseUnknownExt","parseImg","img","leftPos","topPos","lctFlag","interlaced","lctSize","lct","lzwMinCodeSize","lzwData","pixels","minCodeSize","last","readCode","output","clearCode","eoiCode","codeSize","dict","lzwDecode","newPixels","cpRow","toRow","fromRow","fromPixels","offsets","steps","pass","deinterlace","arrayToImage","parseBlock","sentinel","eof","frame","context"],"mappings":"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AAU1zD,EAAQ0zD,UAAY,GAC9BM,cAAeh0D,EAAQg0D,eAAiB,EACxCjhC,MAAO/yB,EAAQ+yB,OAAS,GAAM8D,MAC9BsoB,eAAwCv+C,WAAtBZ,EAAQm/C,UAA0ByQ,GAAUxsC,KAAOpjB,EAAQm/C,UAC7E4U,eAAwCnzD,WAAtBZ,EAAQ+zD,UAA0BlE,GAAU1sC,OAASnjB,EAAQ+zD,UAC/EoC,SAAUn2D,EAAQm2D,WAAa,EAC/B5uC,QAASvnB,EAAQunB,SAAW,IAGlC,EA/LA,CAAoCosD,MCzNpC,4BASA,OARgB,EAAA1rE,KAA8B,CAC1C2rE,IAAK,GACLC,KAAM,OACNC,KAAM,OACN5f,KAAM,OACNvqD,SAAU,WACVq/C,YAAa,eAEjB,EATA,GCLA,SAAS+qB,GAAMvoD,EAAcniB,EAAWC,GACtC,OAAOD,EAAImiB,GAAQliB,EAAID,GAGzB,SAAS2qE,GAAMt1E,GACb,OAAOA,EAAIA,EAAIA,GAAKA,GAAS,EAAJA,EAAQ,IAAM,IAqCzC,IC1CYu1E,GD0CZ,cAqSE,WAAYj0E,GApSJ,KAAAk0E,MAAkB,CACxB,IACA,IACA,IACA,GACA,GACA,GACA,IACA,GACA,IACA,GACA,GACA,GACA,IACA,IACA,EACA,IACA,IACA,GACA,IACA,GACA,GACA,IACA,EACA,GACA,GACA,IACA,GACA,GACA,GACA,IACA,EACA,IACA,IACA,IACA,IACA,GACA,EACA,GACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,GACA,GACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,IACA,GACA,IACA,GACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,EACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,EACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,EACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,GACA,IACA,GACA,GACA,GACA,GACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,EACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,EACA,IACA,GACA,GACA,IACA,GACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,EACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,KAEM,KAAAC,GAAiB,IAAIC,WAAW,KAGhC,KAAAC,sBAAuC,CAC7CC,QAAS,EACTC,UAAW,EACXC,UAAW,EACXC,YAAa,IA4Bbz0E,EAAU,EAAY,GAAI6K,KAAKwpE,sBAAuBr0E,GAEtD6K,KAAK4pE,YAAcz0E,EAAQy0E,YAC3B5pE,KAAK2pE,UAAYx0E,EAAQw0E,UACzB3pE,KAAK0pE,UAAYv0E,EAAQu0E,UACzB1pE,KAAKypE,QAAUt0E,EAAQs0E,QAEnBt0E,EAAQqd,KACVxS,KAAK6pE,QAAU,IAAIhzD,EAAO1hB,EAAQqd,MAElCxS,KAAK6pE,QAAU,IAAIhzD,EAGrB7W,KAAKqpE,MAAQrpE,KAAK6pE,QAAQp1D,QAAQzU,KAAKqpE,OAEvC,IAAK,IAAI12E,EAAI,EAAGA,EAAI,IAAKA,IACvBqN,KAAKspE,GAAG32E,GAA2B,IAAtBqN,KAAKqpE,MAAM12E,EAAI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","file":"excalibur.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ex\"] = factory();\n\telse\n\t\troot[\"ex\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 127);\n","var global = require('../internals/global');\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar redefine = require('../internals/redefine');\nvar setGlobal = require('../internals/set-global');\nvar copyConstructorProperties = require('../internals/copy-constructor-properties');\nvar isForced = require('../internals/is-forced');\n\n/*\n  options.target      - name of the target object\n  options.global      - target is the global object\n  options.stat        - export as static methods of target\n  options.proto       - export as prototype methods of target\n  options.real        - real prototype method for the `pure` version\n  options.forced      - export even if the native feature is available\n  options.bind        - bind methods to the target, required for the `pure` version\n  options.wrap        - wrap constructors to preventing global pollution, required for the `pure` version\n  options.unsafe      - use the simple assignment of property instead of delete + defineProperty\n  options.sham        - add a flag to not completely full polyfills\n  options.enumerable  - export as enumerable property\n  options.noTargetGet - prevent calling a getter on target\n*/\nmodule.exports = function (options, source) {\n  var TARGET = options.target;\n  var GLOBAL = options.global;\n  var STATIC = options.stat;\n  var FORCED, target, key, targetProperty, sourceProperty, descriptor;\n  if (GLOBAL) {\n    target = global;\n  } else if (STATIC) {\n    target = global[TARGET] || setGlobal(TARGET, {});\n  } else {\n    target = (global[TARGET] || {}).prototype;\n  }\n  if (target) for (key in source) {\n    sourceProperty = source[key];\n    if (options.noTargetGet) {\n      descriptor = getOwnPropertyDescriptor(target, key);\n      targetProperty = descriptor && descriptor.value;\n    } else targetProperty = target[key];\n    FORCED = isForced(GLOBAL ? key : TARGET + (STATIC ? '.' : '#') + key, options.forced);\n    // contained in target\n    if (!FORCED && targetProperty !== undefined) {\n      if (typeof sourceProperty === typeof targetProperty) continue;\n      copyConstructorProperties(sourceProperty, targetProperty);\n    }\n    // add a flag to not completely full polyfills\n    if (options.sham || (targetProperty && targetProperty.sham)) {\n      createNonEnumerableProperty(sourceProperty, 'sham', true);\n    }\n    // extend global\n    redefine(target, key, sourceProperty, options);\n  }\n};\n","var global = require('../internals/global');\nvar shared = require('../internals/shared');\nvar has = require('../internals/has');\nvar uid = require('../internals/uid');\nvar NATIVE_SYMBOL = require('../internals/native-symbol');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nvar WellKnownSymbolsStore = shared('wks');\nvar Symbol = global.Symbol;\nvar createWellKnownSymbol = USE_SYMBOL_AS_UID ? Symbol : Symbol && Symbol.withoutSetter || uid;\n\nmodule.exports = function (name) {\n  if (!has(WellKnownSymbolsStore, name)) {\n    if (NATIVE_SYMBOL && has(Symbol, name)) WellKnownSymbolsStore[name] = Symbol[name];\n    else WellKnownSymbolsStore[name] = createWellKnownSymbol('Symbol.' + name);\n  } return WellKnownSymbolsStore[name];\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\nvar has = require('../internals/has');\n\nvar defineProperty = Object.defineProperty;\nvar cache = {};\n\nvar thrower = function (it) { throw it; };\n\nmodule.exports = function (METHOD_NAME, options) {\n  if (has(cache, METHOD_NAME)) return cache[METHOD_NAME];\n  if (!options) options = {};\n  var method = [][METHOD_NAME];\n  var ACCESSORS = has(options, 'ACCESSORS') ? options.ACCESSORS : false;\n  var argument0 = has(options, 0) ? options[0] : thrower;\n  var argument1 = has(options, 1) ? options[1] : undefined;\n\n  return cache[METHOD_NAME] = !!method && !fails(function () {\n    if (ACCESSORS && !DESCRIPTORS) return true;\n    var O = { length: -1 };\n\n    if (ACCESSORS) defineProperty(O, 1, { enumerable: true, get: thrower });\n    else O[1] = 1;\n\n    method.call(O, argument0, argument1);\n  });\n};\n","var toInteger = require('../internals/to-integer');\n\nvar min = Math.min;\n\n// `ToLength` abstract operation\n// https://tc39.github.io/ecma262/#sec-tolength\nmodule.exports = function (argument) {\n  return argument > 0 ? min(toInteger(argument), 0x1FFFFFFFFFFFFF) : 0; // 2 ** 53 - 1 == 9007199254740991\n};\n","module.exports = function (exec) {\n  try {\n    return !!exec();\n  } catch (error) {\n    return true;\n  }\n};\n","var check = function (it) {\n  return it && it.Math == Math && it;\n};\n\n// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nmodule.exports =\n  // eslint-disable-next-line no-undef\n  check(typeof globalThis == 'object' && globalThis) ||\n  check(typeof window == 'object' && window) ||\n  check(typeof self == 'object' && self) ||\n  check(typeof global == 'object' && global) ||\n  // eslint-disable-next-line no-new-func\n  Function('return this')();\n","var requireObjectCoercible = require('../internals/require-object-coercible');\n\n// `ToObject` abstract operation\n// https://tc39.github.io/ecma262/#sec-toobject\nmodule.exports = function (argument) {\n  return Object(requireObjectCoercible(argument));\n};\n","module.exports = function (it) {\n  return typeof it === 'object' ? it !== null : typeof it === 'function';\n};\n","var hasOwnProperty = {}.hasOwnProperty;\n\nmodule.exports = function (it, key) {\n  return hasOwnProperty.call(it, key);\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\nvar anObject = require('../internals/an-object');\nvar toPrimitive = require('../internals/to-primitive');\n\nvar nativeDefineProperty = Object.defineProperty;\n\n// `Object.defineProperty` method\n// https://tc39.github.io/ecma262/#sec-object.defineproperty\nexports.f = DESCRIPTORS ? nativeDefineProperty : function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPrimitive(P, true);\n  anObject(Attributes);\n  if (IE8_DOM_DEFINE) try {\n    return nativeDefineProperty(O, P, Attributes);\n  } catch (error) { /* empty */ }\n  if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported');\n  if ('value' in Attributes) O[P] = Attributes.value;\n  return O;\n};\n","'use strict';\nvar fails = require('../internals/fails');\n\nmodule.exports = function (METHOD_NAME, argument) {\n  var method = [][METHOD_NAME];\n  return !!method && fails(function () {\n    // eslint-disable-next-line no-useless-call,no-throw-literal\n    method.call(null, argument || function () { throw 1; }, 1);\n  });\n};\n","var fails = require('../internals/fails');\n\n// Thank's IE8 for his funny defineProperty\nmodule.exports = !fails(function () {\n  return Object.defineProperty({}, 1, { get: function () { return 7; } })[1] != 7;\n});\n","var wellKnownSymbol = require('../internals/well-known-symbol');\nvar create = require('../internals/object-create');\nvar definePropertyModule = require('../internals/object-define-property');\n\nvar UNSCOPABLES = wellKnownSymbol('unscopables');\nvar ArrayPrototype = Array.prototype;\n\n// Array.prototype[@@unscopables]\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables\nif (ArrayPrototype[UNSCOPABLES] == undefined) {\n  definePropertyModule.f(ArrayPrototype, UNSCOPABLES, {\n    configurable: true,\n    value: create(null)\n  });\n}\n\n// add a key to Array.prototype[@@unscopables]\nmodule.exports = function (key) {\n  ArrayPrototype[UNSCOPABLES][key] = true;\n};\n","// toObject with fallback for non-array-like ES3 strings\nvar IndexedObject = require('../internals/indexed-object');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\nmodule.exports = function (it) {\n  return IndexedObject(requireObjectCoercible(it));\n};\n","var bind = require('../internals/function-bind-context');\nvar IndexedObject = require('../internals/indexed-object');\nvar toObject = require('../internals/to-object');\nvar toLength = require('../internals/to-length');\nvar arraySpeciesCreate = require('../internals/array-species-create');\n\nvar push = [].push;\n\n// `Array.prototype.{ forEach, map, filter, some, every, find, findIndex }` methods implementation\nvar createMethod = function (TYPE) {\n  var IS_MAP = TYPE == 1;\n  var IS_FILTER = TYPE == 2;\n  var IS_SOME = TYPE == 3;\n  var IS_EVERY = TYPE == 4;\n  var IS_FIND_INDEX = TYPE == 6;\n  var NO_HOLES = TYPE == 5 || IS_FIND_INDEX;\n  return function ($this, callbackfn, that, specificCreate) {\n    var O = toObject($this);\n    var self = IndexedObject(O);\n    var boundFunction = bind(callbackfn, that, 3);\n    var length = toLength(self.length);\n    var index = 0;\n    var create = specificCreate || arraySpeciesCreate;\n    var target = IS_MAP ? create($this, length) : IS_FILTER ? create($this, 0) : undefined;\n    var value, result;\n    for (;length > index; index++) if (NO_HOLES || index in self) {\n      value = self[index];\n      result = boundFunction(value, index, O);\n      if (TYPE) {\n        if (IS_MAP) target[index] = result; // map\n        else if (result) switch (TYPE) {\n          case 3: return true;              // some\n          case 5: return value;             // find\n          case 6: return index;             // findIndex\n          case 2: push.call(target, value); // filter\n        } else if (IS_EVERY) return false;  // every\n      }\n    }\n    return IS_FIND_INDEX ? -1 : IS_SOME || IS_EVERY ? IS_EVERY : target;\n  };\n};\n\nmodule.exports = {\n  // `Array.prototype.forEach` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.foreach\n  forEach: createMethod(0),\n  // `Array.prototype.map` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.map\n  map: createMethod(1),\n  // `Array.prototype.filter` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.filter\n  filter: createMethod(2),\n  // `Array.prototype.some` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.some\n  some: createMethod(3),\n  // `Array.prototype.every` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.every\n  every: createMethod(4),\n  // `Array.prototype.find` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.find\n  find: createMethod(5),\n  // `Array.prototype.findIndex` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.findIndex\n  findIndex: createMethod(6)\n};\n","var ceil = Math.ceil;\nvar floor = Math.floor;\n\n// `ToInteger` abstract operation\n// https://tc39.github.io/ecma262/#sec-tointeger\nmodule.exports = function (argument) {\n  return isNaN(argument = +argument) ? 0 : (argument > 0 ? floor : ceil)(argument);\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar definePropertyModule = require('../internals/object-define-property');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\n\nmodule.exports = DESCRIPTORS ? function (object, key, value) {\n  return definePropertyModule.f(object, key, createPropertyDescriptor(1, value));\n} : function (object, key, value) {\n  object[key] = value;\n  return object;\n};\n","var isObject = require('../internals/is-object');\n\nmodule.exports = function (it) {\n  if (!isObject(it)) {\n    throw TypeError(String(it) + ' is not an object');\n  } return it;\n};\n","var classof = require('../internals/classof-raw');\n\n// `IsArray` abstract operation\n// https://tc39.github.io/ecma262/#sec-isarray\nmodule.exports = Array.isArray || function isArray(arg) {\n  return classof(arg) == 'Array';\n};\n","var toInteger = require('../internals/to-integer');\n\nvar max = Math.max;\nvar min = Math.min;\n\n// Helper for a popular repeating case of the spec:\n// Let integer be ? ToInteger(index).\n// If integer < 0, let result be max((length + integer), 0); else let result be min(integer, length).\nmodule.exports = function (index, length) {\n  var integer = toInteger(index);\n  return integer < 0 ? max(integer + length, 0) : min(integer, length);\n};\n","module.exports = {};\n","module.exports = function (it) {\n  if (typeof it != 'function') {\n    throw TypeError(String(it) + ' is not a function');\n  } return it;\n};\n","'use strict';\nvar toPrimitive = require('../internals/to-primitive');\nvar definePropertyModule = require('../internals/object-define-property');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\n\nmodule.exports = function (object, key, value) {\n  var propertyKey = toPrimitive(key);\n  if (propertyKey in object) definePropertyModule.f(object, propertyKey, createPropertyDescriptor(0, value));\n  else object[propertyKey] = value;\n};\n","var isObject = require('../internals/is-object');\nvar isArray = require('../internals/is-array');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar SPECIES = wellKnownSymbol('species');\n\n// `ArraySpeciesCreate` abstract operation\n// https://tc39.github.io/ecma262/#sec-arrayspeciescreate\nmodule.exports = function (originalArray, length) {\n  var C;\n  if (isArray(originalArray)) {\n    C = originalArray.constructor;\n    // cross-realm fallback\n    if (typeof C == 'function' && (C === Array || isArray(C.prototype))) C = undefined;\n    else if (isObject(C)) {\n      C = C[SPECIES];\n      if (C === null) C = undefined;\n    }\n  } return new (C === undefined ? Array : C)(length === 0 ? 0 : length);\n};\n","var fails = require('../internals/fails');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar V8_VERSION = require('../internals/engine-v8-version');\n\nvar SPECIES = wellKnownSymbol('species');\n\nmodule.exports = function (METHOD_NAME) {\n  // We can't use this feature detection in V8 since it causes\n  // deoptimization and serious performance degradation\n  // https://github.com/zloirock/core-js/issues/677\n  return V8_VERSION >= 51 || !fails(function () {\n    var array = [];\n    var constructor = array.constructor = {};\n    constructor[SPECIES] = function () {\n      return { foo: 1 };\n    };\n    return array[METHOD_NAME](Boolean).foo !== 1;\n  });\n};\n","module.exports = function (bitmap, value) {\n  return {\n    enumerable: !(bitmap & 1),\n    configurable: !(bitmap & 2),\n    writable: !(bitmap & 4),\n    value: value\n  };\n};\n","var fails = require('../internals/fails');\nvar classof = require('../internals/classof-raw');\n\nvar split = ''.split;\n\n// fallback for non-array-like ES3 and non-enumerable old V8 strings\nmodule.exports = fails(function () {\n  // throws an error in rhino, see https://github.com/mozilla/rhino/issues/346\n  // eslint-disable-next-line no-prototype-builtins\n  return !Object('z').propertyIsEnumerable(0);\n}) ? function (it) {\n  return classof(it) == 'String' ? split.call(it, '') : Object(it);\n} : Object;\n","var path = require('../internals/path');\nvar global = require('../internals/global');\n\nvar aFunction = function (variable) {\n  return typeof variable == 'function' ? variable : undefined;\n};\n\nmodule.exports = function (namespace, method) {\n  return arguments.length < 2 ? aFunction(path[namespace]) || aFunction(global[namespace])\n    : path[namespace] && path[namespace][method] || global[namespace] && global[namespace][method];\n};\n","// `RequireObjectCoercible` abstract operation\n// https://tc39.github.io/ecma262/#sec-requireobjectcoercible\nmodule.exports = function (it) {\n  if (it == undefined) throw TypeError(\"Can't call method on \" + it);\n  return it;\n};\n","var NATIVE_WEAK_MAP = require('../internals/native-weak-map');\nvar global = require('../internals/global');\nvar isObject = require('../internals/is-object');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar objectHas = require('../internals/has');\nvar sharedKey = require('../internals/shared-key');\nvar hiddenKeys = require('../internals/hidden-keys');\n\nvar WeakMap = global.WeakMap;\nvar set, get, has;\n\nvar enforce = function (it) {\n  return has(it) ? get(it) : set(it, {});\n};\n\nvar getterFor = function (TYPE) {\n  return function (it) {\n    var state;\n    if (!isObject(it) || (state = get(it)).type !== TYPE) {\n      throw TypeError('Incompatible receiver, ' + TYPE + ' required');\n    } return state;\n  };\n};\n\nif (NATIVE_WEAK_MAP) {\n  var store = new WeakMap();\n  var wmget = store.get;\n  var wmhas = store.has;\n  var wmset = store.set;\n  set = function (it, metadata) {\n    wmset.call(store, it, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return wmget.call(store, it) || {};\n  };\n  has = function (it) {\n    return wmhas.call(store, it);\n  };\n} else {\n  var STATE = sharedKey('state');\n  hiddenKeys[STATE] = true;\n  set = function (it, metadata) {\n    createNonEnumerableProperty(it, STATE, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return objectHas(it, STATE) ? it[STATE] : {};\n  };\n  has = function (it) {\n    return objectHas(it, STATE);\n  };\n}\n\nmodule.exports = {\n  set: set,\n  get: get,\n  has: has,\n  enforce: enforce,\n  getterFor: getterFor\n};\n","var global = require('../internals/global');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\n\nmodule.exports = function (key, value) {\n  try {\n    createNonEnumerableProperty(global, key, value);\n  } catch (error) {\n    global[key] = value;\n  } return value;\n};\n","var isObject = require('../internals/is-object');\n\n// `ToPrimitive` abstract operation\n// https://tc39.github.io/ecma262/#sec-toprimitive\n// instead of the ES6 spec version, we didn't implement @@toPrimitive case\n// and the second argument - flag - preferred type is a string\nmodule.exports = function (input, PREFERRED_STRING) {\n  if (!isObject(input)) return input;\n  var fn, val;\n  if (PREFERRED_STRING && typeof (fn = input.toString) == 'function' && !isObject(val = fn.call(input))) return val;\n  if (typeof (fn = input.valueOf) == 'function' && !isObject(val = fn.call(input))) return val;\n  if (!PREFERRED_STRING && typeof (fn = input.toString) == 'function' && !isObject(val = fn.call(input))) return val;\n  throw TypeError(\"Can't convert object to primitive value\");\n};\n","var shared = require('../internals/shared');\nvar uid = require('../internals/uid');\n\nvar keys = shared('keys');\n\nmodule.exports = function (key) {\n  return keys[key] || (keys[key] = uid(key));\n};\n","module.exports = false;\n","module.exports = {};\n","var toString = {}.toString;\n\nmodule.exports = function (it) {\n  return toString.call(it).slice(8, -1);\n};\n","var global = require('../internals/global');\n\nmodule.exports = global;\n","var toIndexedObject = require('../internals/to-indexed-object');\nvar toLength = require('../internals/to-length');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\n\n// `Array.prototype.{ indexOf, includes }` methods implementation\nvar createMethod = function (IS_INCLUDES) {\n  return function ($this, el, fromIndex) {\n    var O = toIndexedObject($this);\n    var length = toLength(O.length);\n    var index = toAbsoluteIndex(fromIndex, length);\n    var value;\n    // Array#includes uses SameValueZero equality algorithm\n    // eslint-disable-next-line no-self-compare\n    if (IS_INCLUDES && el != el) while (length > index) {\n      value = O[index++];\n      // eslint-disable-next-line no-self-compare\n      if (value != value) return true;\n    // Array#indexOf ignores holes, Array#includes - not\n    } else for (;length > index; index++) {\n      if ((IS_INCLUDES || index in O) && O[index] === el) return IS_INCLUDES || index || 0;\n    } return !IS_INCLUDES && -1;\n  };\n};\n\nmodule.exports = {\n  // `Array.prototype.includes` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.includes\n  includes: createMethod(true),\n  // `Array.prototype.indexOf` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.indexof\n  indexOf: createMethod(false)\n};\n","// IE8- don't enum bug keys\nmodule.exports = [\n  'constructor',\n  'hasOwnProperty',\n  'isPrototypeOf',\n  'propertyIsEnumerable',\n  'toLocaleString',\n  'toString',\n  'valueOf'\n];\n","var has = require('../internals/has');\nvar toObject = require('../internals/to-object');\nvar sharedKey = require('../internals/shared-key');\nvar CORRECT_PROTOTYPE_GETTER = require('../internals/correct-prototype-getter');\n\nvar IE_PROTO = sharedKey('IE_PROTO');\nvar ObjectPrototype = Object.prototype;\n\n// `Object.getPrototypeOf` method\n// https://tc39.github.io/ecma262/#sec-object.getprototypeof\nmodule.exports = CORRECT_PROTOTYPE_GETTER ? Object.getPrototypeOf : function (O) {\n  O = toObject(O);\n  if (has(O, IE_PROTO)) return O[IE_PROTO];\n  if (typeof O.constructor == 'function' && O instanceof O.constructor) {\n    return O.constructor.prototype;\n  } return O instanceof Object ? ObjectPrototype : null;\n};\n","var aFunction = require('../internals/a-function');\n\n// optional / simple context binding\nmodule.exports = function (fn, that, length) {\n  aFunction(fn);\n  if (that === undefined) return fn;\n  switch (length) {\n    case 0: return function () {\n      return fn.call(that);\n    };\n    case 1: return function (a) {\n      return fn.call(that, a);\n    };\n    case 2: return function (a, b) {\n      return fn.call(that, a, b);\n    };\n    case 3: return function (a, b, c) {\n      return fn.call(that, a, b, c);\n    };\n  }\n  return function (/* ...args */) {\n    return fn.apply(that, arguments);\n  };\n};\n","var store = require('../internals/shared-store');\n\nvar functionToString = Function.toString;\n\n// this helper broken in `3.4.1-3.4.4`, so we can't use `shared` helper\nif (typeof store.inspectSource != 'function') {\n  store.inspectSource = function (it) {\n    return functionToString.call(it);\n  };\n}\n\nmodule.exports = store.inspectSource;\n","var global = require('../internals/global');\nvar setGlobal = require('../internals/set-global');\n\nvar SHARED = '__core-js_shared__';\nvar store = global[SHARED] || setGlobal(SHARED, {});\n\nmodule.exports = store;\n","var DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\nvar createElement = require('../internals/document-create-element');\n\n// Thank's IE8 for his funny defineProperty\nmodule.exports = !DESCRIPTORS && !fails(function () {\n  return Object.defineProperty(createElement('div'), 'a', {\n    get: function () { return 7; }\n  }).a != 7;\n});\n","var global = require('../internals/global');\nvar isObject = require('../internals/is-object');\n\nvar document = global.document;\n// typeof document.createElement is 'object' in old IE\nvar EXISTS = isObject(document) && isObject(document.createElement);\n\nmodule.exports = function (it) {\n  return EXISTS ? document.createElement(it) : {};\n};\n","var IS_PURE = require('../internals/is-pure');\nvar store = require('../internals/shared-store');\n\n(module.exports = function (key, value) {\n  return store[key] || (store[key] = value !== undefined ? value : {});\n})('versions', []).push({\n  version: '3.6.4',\n  mode: IS_PURE ? 'pure' : 'global',\n  copyright: '© 2020 Denis Pushkarev (zloirock.ru)'\n});\n","var id = 0;\nvar postfix = Math.random();\n\nmodule.exports = function (key) {\n  return 'Symbol(' + String(key === undefined ? '' : key) + ')_' + (++id + postfix).toString(36);\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar createIteratorConstructor = require('../internals/create-iterator-constructor');\nvar getPrototypeOf = require('../internals/object-get-prototype-of');\nvar setPrototypeOf = require('../internals/object-set-prototype-of');\nvar setToStringTag = require('../internals/set-to-string-tag');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar redefine = require('../internals/redefine');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar IS_PURE = require('../internals/is-pure');\nvar Iterators = require('../internals/iterators');\nvar IteratorsCore = require('../internals/iterators-core');\n\nvar IteratorPrototype = IteratorsCore.IteratorPrototype;\nvar BUGGY_SAFARI_ITERATORS = IteratorsCore.BUGGY_SAFARI_ITERATORS;\nvar ITERATOR = wellKnownSymbol('iterator');\nvar KEYS = 'keys';\nvar VALUES = 'values';\nvar ENTRIES = 'entries';\n\nvar returnThis = function () { return this; };\n\nmodule.exports = function (Iterable, NAME, IteratorConstructor, next, DEFAULT, IS_SET, FORCED) {\n  createIteratorConstructor(IteratorConstructor, NAME, next);\n\n  var getIterationMethod = function (KIND) {\n    if (KIND === DEFAULT && defaultIterator) return defaultIterator;\n    if (!BUGGY_SAFARI_ITERATORS && KIND in IterablePrototype) return IterablePrototype[KIND];\n    switch (KIND) {\n      case KEYS: return function keys() { return new IteratorConstructor(this, KIND); };\n      case VALUES: return function values() { return new IteratorConstructor(this, KIND); };\n      case ENTRIES: return function entries() { return new IteratorConstructor(this, KIND); };\n    } return function () { return new IteratorConstructor(this); };\n  };\n\n  var TO_STRING_TAG = NAME + ' Iterator';\n  var INCORRECT_VALUES_NAME = false;\n  var IterablePrototype = Iterable.prototype;\n  var nativeIterator = IterablePrototype[ITERATOR]\n    || IterablePrototype['@@iterator']\n    || DEFAULT && IterablePrototype[DEFAULT];\n  var defaultIterator = !BUGGY_SAFARI_ITERATORS && nativeIterator || getIterationMethod(DEFAULT);\n  var anyNativeIterator = NAME == 'Array' ? IterablePrototype.entries || nativeIterator : nativeIterator;\n  var CurrentIteratorPrototype, methods, KEY;\n\n  // fix native\n  if (anyNativeIterator) {\n    CurrentIteratorPrototype = getPrototypeOf(anyNativeIterator.call(new Iterable()));\n    if (IteratorPrototype !== Object.prototype && CurrentIteratorPrototype.next) {\n      if (!IS_PURE && getPrototypeOf(CurrentIteratorPrototype) !== IteratorPrototype) {\n        if (setPrototypeOf) {\n          setPrototypeOf(CurrentIteratorPrototype, IteratorPrototype);\n        } else if (typeof CurrentIteratorPrototype[ITERATOR] != 'function') {\n          createNonEnumerableProperty(CurrentIteratorPrototype, ITERATOR, returnThis);\n        }\n      }\n      // Set @@toStringTag to native iterators\n      setToStringTag(CurrentIteratorPrototype, TO_STRING_TAG, true, true);\n      if (IS_PURE) Iterators[TO_STRING_TAG] = returnThis;\n    }\n  }\n\n  // fix Array#{values, @@iterator}.name in V8 / FF\n  if (DEFAULT == VALUES && nativeIterator && nativeIterator.name !== VALUES) {\n    INCORRECT_VALUES_NAME = true;\n    defaultIterator = function values() { return nativeIterator.call(this); };\n  }\n\n  // define iterator\n  if ((!IS_PURE || FORCED) && IterablePrototype[ITERATOR] !== defaultIterator) {\n    createNonEnumerableProperty(IterablePrototype, ITERATOR, defaultIterator);\n  }\n  Iterators[NAME] = defaultIterator;\n\n  // export additional methods\n  if (DEFAULT) {\n    methods = {\n      values: getIterationMethod(VALUES),\n      keys: IS_SET ? defaultIterator : getIterationMethod(KEYS),\n      entries: getIterationMethod(ENTRIES)\n    };\n    if (FORCED) for (KEY in methods) {\n      if (BUGGY_SAFARI_ITERATORS || INCORRECT_VALUES_NAME || !(KEY in IterablePrototype)) {\n        redefine(IterablePrototype, KEY, methods[KEY]);\n      }\n    } else $({ target: NAME, proto: true, forced: BUGGY_SAFARI_ITERATORS || INCORRECT_VALUES_NAME }, methods);\n  }\n\n  return methods;\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar propertyIsEnumerableModule = require('../internals/object-property-is-enumerable');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar toPrimitive = require('../internals/to-primitive');\nvar has = require('../internals/has');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\n\nvar nativeGetOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// `Object.getOwnPropertyDescriptor` method\n// https://tc39.github.io/ecma262/#sec-object.getownpropertydescriptor\nexports.f = DESCRIPTORS ? nativeGetOwnPropertyDescriptor : function getOwnPropertyDescriptor(O, P) {\n  O = toIndexedObject(O);\n  P = toPrimitive(P, true);\n  if (IE8_DOM_DEFINE) try {\n    return nativeGetOwnPropertyDescriptor(O, P);\n  } catch (error) { /* empty */ }\n  if (has(O, P)) return createPropertyDescriptor(!propertyIsEnumerableModule.f.call(O, P), O[P]);\n};\n","var global = require('../internals/global');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar has = require('../internals/has');\nvar setGlobal = require('../internals/set-global');\nvar inspectSource = require('../internals/inspect-source');\nvar InternalStateModule = require('../internals/internal-state');\n\nvar getInternalState = InternalStateModule.get;\nvar enforceInternalState = InternalStateModule.enforce;\nvar TEMPLATE = String(String).split('String');\n\n(module.exports = function (O, key, value, options) {\n  var unsafe = options ? !!options.unsafe : false;\n  var simple = options ? !!options.enumerable : false;\n  var noTargetGet = options ? !!options.noTargetGet : false;\n  if (typeof value == 'function') {\n    if (typeof key == 'string' && !has(value, 'name')) createNonEnumerableProperty(value, 'name', key);\n    enforceInternalState(value).source = TEMPLATE.join(typeof key == 'string' ? key : '');\n  }\n  if (O === global) {\n    if (simple) O[key] = value;\n    else setGlobal(key, value);\n    return;\n  } else if (!unsafe) {\n    delete O[key];\n  } else if (!noTargetGet && O[key]) {\n    simple = true;\n  }\n  if (simple) O[key] = value;\n  else createNonEnumerableProperty(O, key, value);\n// add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative\n})(Function.prototype, 'toString', function toString() {\n  return typeof this == 'function' && getInternalState(this).source || inspectSource(this);\n});\n","var has = require('../internals/has');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar indexOf = require('../internals/array-includes').indexOf;\nvar hiddenKeys = require('../internals/hidden-keys');\n\nmodule.exports = function (object, names) {\n  var O = toIndexedObject(object);\n  var i = 0;\n  var result = [];\n  var key;\n  for (key in O) !has(hiddenKeys, key) && has(O, key) && result.push(key);\n  // Don't enum bug & hidden keys\n  while (names.length > i) if (has(O, key = names[i++])) {\n    ~indexOf(result, key) || result.push(key);\n  }\n  return result;\n};\n","'use strict';\nvar getPrototypeOf = require('../internals/object-get-prototype-of');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar has = require('../internals/has');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar IS_PURE = require('../internals/is-pure');\n\nvar ITERATOR = wellKnownSymbol('iterator');\nvar BUGGY_SAFARI_ITERATORS = false;\n\nvar returnThis = function () { return this; };\n\n// `%IteratorPrototype%` object\n// https://tc39.github.io/ecma262/#sec-%iteratorprototype%-object\nvar IteratorPrototype, PrototypeOfArrayIteratorPrototype, arrayIterator;\n\nif ([].keys) {\n  arrayIterator = [].keys();\n  // Safari 8 has buggy iterators w/o `next`\n  if (!('next' in arrayIterator)) BUGGY_SAFARI_ITERATORS = true;\n  else {\n    PrototypeOfArrayIteratorPrototype = getPrototypeOf(getPrototypeOf(arrayIterator));\n    if (PrototypeOfArrayIteratorPrototype !== Object.prototype) IteratorPrototype = PrototypeOfArrayIteratorPrototype;\n  }\n}\n\nif (IteratorPrototype == undefined) IteratorPrototype = {};\n\n// 25.1.2.1.1 %IteratorPrototype%[@@iterator]()\nif (!IS_PURE && !has(IteratorPrototype, ITERATOR)) {\n  createNonEnumerableProperty(IteratorPrototype, ITERATOR, returnThis);\n}\n\nmodule.exports = {\n  IteratorPrototype: IteratorPrototype,\n  BUGGY_SAFARI_ITERATORS: BUGGY_SAFARI_ITERATORS\n};\n","var fails = require('../internals/fails');\n\nmodule.exports = !!Object.getOwnPropertySymbols && !fails(function () {\n  // Chrome 38 Symbol has incorrect toString conversion\n  // eslint-disable-next-line no-undef\n  return !String(Symbol());\n});\n","var anObject = require('../internals/an-object');\nvar defineProperties = require('../internals/object-define-properties');\nvar enumBugKeys = require('../internals/enum-bug-keys');\nvar hiddenKeys = require('../internals/hidden-keys');\nvar html = require('../internals/html');\nvar documentCreateElement = require('../internals/document-create-element');\nvar sharedKey = require('../internals/shared-key');\n\nvar GT = '>';\nvar LT = '<';\nvar PROTOTYPE = 'prototype';\nvar SCRIPT = 'script';\nvar IE_PROTO = sharedKey('IE_PROTO');\n\nvar EmptyConstructor = function () { /* empty */ };\n\nvar scriptTag = function (content) {\n  return LT + SCRIPT + GT + content + LT + '/' + SCRIPT + GT;\n};\n\n// Create object with fake `null` prototype: use ActiveX Object with cleared prototype\nvar NullProtoObjectViaActiveX = function (activeXDocument) {\n  activeXDocument.write(scriptTag(''));\n  activeXDocument.close();\n  var temp = activeXDocument.parentWindow.Object;\n  activeXDocument = null; // avoid memory leak\n  return temp;\n};\n\n// Create object with fake `null` prototype: use iframe Object with cleared prototype\nvar NullProtoObjectViaIFrame = function () {\n  // Thrash, waste and sodomy: IE GC bug\n  var iframe = documentCreateElement('iframe');\n  var JS = 'java' + SCRIPT + ':';\n  var iframeDocument;\n  iframe.style.display = 'none';\n  html.appendChild(iframe);\n  // https://github.com/zloirock/core-js/issues/475\n  iframe.src = String(JS);\n  iframeDocument = iframe.contentWindow.document;\n  iframeDocument.open();\n  iframeDocument.write(scriptTag('document.F=Object'));\n  iframeDocument.close();\n  return iframeDocument.F;\n};\n\n// Check for document.domain and active x support\n// No need to use active x approach when document.domain is not set\n// see https://github.com/es-shims/es5-shim/issues/150\n// variation of https://github.com/kitcambridge/es5-shim/commit/4f738ac066346\n// avoid IE GC bug\nvar activeXDocument;\nvar NullProtoObject = function () {\n  try {\n    /* global ActiveXObject */\n    activeXDocument = document.domain && new ActiveXObject('htmlfile');\n  } catch (error) { /* ignore */ }\n  NullProtoObject = activeXDocument ? NullProtoObjectViaActiveX(activeXDocument) : NullProtoObjectViaIFrame();\n  var length = enumBugKeys.length;\n  while (length--) delete NullProtoObject[PROTOTYPE][enumBugKeys[length]];\n  return NullProtoObject();\n};\n\nhiddenKeys[IE_PROTO] = true;\n\n// `Object.create` method\n// https://tc39.github.io/ecma262/#sec-object.create\nmodule.exports = Object.create || function create(O, Properties) {\n  var result;\n  if (O !== null) {\n    EmptyConstructor[PROTOTYPE] = anObject(O);\n    result = new EmptyConstructor();\n    EmptyConstructor[PROTOTYPE] = null;\n    // add \"__proto__\" for Object.getPrototypeOf polyfill\n    result[IE_PROTO] = O;\n  } else result = NullProtoObject();\n  return Properties === undefined ? result : defineProperties(result, Properties);\n};\n","var defineProperty = require('../internals/object-define-property').f;\nvar has = require('../internals/has');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\n\nmodule.exports = function (it, TAG, STATIC) {\n  if (it && !has(it = STATIC ? it : it.prototype, TO_STRING_TAG)) {\n    defineProperty(it, TO_STRING_TAG, { configurable: true, value: TAG });\n  }\n};\n","var global = require('../internals/global');\nvar userAgent = require('../internals/engine-user-agent');\n\nvar process = global.process;\nvar versions = process && process.versions;\nvar v8 = versions && versions.v8;\nvar match, version;\n\nif (v8) {\n  match = v8.split('.');\n  version = match[0] + match[1];\n} else if (userAgent) {\n  match = userAgent.match(/Edge\\/(\\d+)/);\n  if (!match || match[1] >= 74) {\n    match = userAgent.match(/Chrome\\/(\\d+)/);\n    if (match) version = match[1];\n  }\n}\n\nmodule.exports = version && +version;\n","'use strict';\nvar isArray = require('../internals/is-array');\nvar toLength = require('../internals/to-length');\nvar bind = require('../internals/function-bind-context');\n\n// `FlattenIntoArray` abstract operation\n// https://tc39.github.io/proposal-flatMap/#sec-FlattenIntoArray\nvar flattenIntoArray = function (target, original, source, sourceLen, start, depth, mapper, thisArg) {\n  var targetIndex = start;\n  var sourceIndex = 0;\n  var mapFn = mapper ? bind(mapper, thisArg, 3) : false;\n  var element;\n\n  while (sourceIndex < sourceLen) {\n    if (sourceIndex in source) {\n      element = mapFn ? mapFn(source[sourceIndex], sourceIndex, original) : source[sourceIndex];\n\n      if (depth > 0 && isArray(element)) {\n        targetIndex = flattenIntoArray(target, original, element, toLength(element.length), targetIndex, depth - 1) - 1;\n      } else {\n        if (targetIndex >= 0x1FFFFFFFFFFFFF) throw TypeError('Exceed the acceptable array length');\n        target[targetIndex] = element;\n      }\n\n      targetIndex++;\n    }\n    sourceIndex++;\n  }\n  return targetIndex;\n};\n\nmodule.exports = flattenIntoArray;\n","var aFunction = require('../internals/a-function');\nvar toObject = require('../internals/to-object');\nvar IndexedObject = require('../internals/indexed-object');\nvar toLength = require('../internals/to-length');\n\n// `Array.prototype.{ reduce, reduceRight }` methods implementation\nvar createMethod = function (IS_RIGHT) {\n  return function (that, callbackfn, argumentsLength, memo) {\n    aFunction(callbackfn);\n    var O = toObject(that);\n    var self = IndexedObject(O);\n    var length = toLength(O.length);\n    var index = IS_RIGHT ? length - 1 : 0;\n    var i = IS_RIGHT ? -1 : 1;\n    if (argumentsLength < 2) while (true) {\n      if (index in self) {\n        memo = self[index];\n        index += i;\n        break;\n      }\n      index += i;\n      if (IS_RIGHT ? index < 0 : length <= index) {\n        throw TypeError('Reduce of empty array with no initial value');\n      }\n    }\n    for (;IS_RIGHT ? index >= 0 : length > index; index += i) if (index in self) {\n      memo = callbackfn(memo, self[index], index, O);\n    }\n    return memo;\n  };\n};\n\nmodule.exports = {\n  // `Array.prototype.reduce` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.reduce\n  left: createMethod(false),\n  // `Array.prototype.reduceRight` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.reduceright\n  right: createMethod(true)\n};\n","\n        var result = require(\"!!../../node_modules/css-loader/dist/cjs.js!./Loader.css\");\n\n        if (typeof result === \"string\") {\n            module.exports = result;\n        } else {\n            module.exports = result.toString();\n        }\n    ","require('../../modules/es.string.iterator');\nrequire('../../modules/es.array.from');\nrequire('../../modules/es.array.is-array');\nrequire('../../modules/es.array.of');\nrequire('../../modules/es.array.concat');\nrequire('../../modules/es.array.copy-within');\nrequire('../../modules/es.array.every');\nrequire('../../modules/es.array.fill');\nrequire('../../modules/es.array.filter');\nrequire('../../modules/es.array.find');\nrequire('../../modules/es.array.find-index');\nrequire('../../modules/es.array.flat');\nrequire('../../modules/es.array.flat-map');\nrequire('../../modules/es.array.for-each');\nrequire('../../modules/es.array.includes');\nrequire('../../modules/es.array.index-of');\nrequire('../../modules/es.array.iterator');\nrequire('../../modules/es.array.join');\nrequire('../../modules/es.array.last-index-of');\nrequire('../../modules/es.array.map');\nrequire('../../modules/es.array.reduce');\nrequire('../../modules/es.array.reduce-right');\nrequire('../../modules/es.array.reverse');\nrequire('../../modules/es.array.slice');\nrequire('../../modules/es.array.some');\nrequire('../../modules/es.array.sort');\nrequire('../../modules/es.array.species');\nrequire('../../modules/es.array.splice');\nrequire('../../modules/es.array.unscopables.flat');\nrequire('../../modules/es.array.unscopables.flat-map');\nvar path = require('../../internals/path');\n\nmodule.exports = path.Array;\n","'use strict';\nvar charAt = require('../internals/string-multibyte').charAt;\nvar InternalStateModule = require('../internals/internal-state');\nvar defineIterator = require('../internals/define-iterator');\n\nvar STRING_ITERATOR = 'String Iterator';\nvar setInternalState = InternalStateModule.set;\nvar getInternalState = InternalStateModule.getterFor(STRING_ITERATOR);\n\n// `String.prototype[@@iterator]` method\n// https://tc39.github.io/ecma262/#sec-string.prototype-@@iterator\ndefineIterator(String, 'String', function (iterated) {\n  setInternalState(this, {\n    type: STRING_ITERATOR,\n    string: String(iterated),\n    index: 0\n  });\n// `%StringIteratorPrototype%.next` method\n// https://tc39.github.io/ecma262/#sec-%stringiteratorprototype%.next\n}, function next() {\n  var state = getInternalState(this);\n  var string = state.string;\n  var index = state.index;\n  var point;\n  if (index >= string.length) return { value: undefined, done: true };\n  point = charAt(string, index);\n  state.index += point.length;\n  return { value: point, done: false };\n});\n","var toInteger = require('../internals/to-integer');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\n// `String.prototype.{ codePointAt, at }` methods implementation\nvar createMethod = function (CONVERT_TO_STRING) {\n  return function ($this, pos) {\n    var S = String(requireObjectCoercible($this));\n    var position = toInteger(pos);\n    var size = S.length;\n    var first, second;\n    if (position < 0 || position >= size) return CONVERT_TO_STRING ? '' : undefined;\n    first = S.charCodeAt(position);\n    return first < 0xD800 || first > 0xDBFF || position + 1 === size\n      || (second = S.charCodeAt(position + 1)) < 0xDC00 || second > 0xDFFF\n        ? CONVERT_TO_STRING ? S.charAt(position) : first\n        : CONVERT_TO_STRING ? S.slice(position, position + 2) : (first - 0xD800 << 10) + (second - 0xDC00) + 0x10000;\n  };\n};\n\nmodule.exports = {\n  // `String.prototype.codePointAt` method\n  // https://tc39.github.io/ecma262/#sec-string.prototype.codepointat\n  codeAt: createMethod(false),\n  // `String.prototype.at` method\n  // https://github.com/mathiasbynens/String.prototype.at\n  charAt: createMethod(true)\n};\n","var global = require('../internals/global');\nvar inspectSource = require('../internals/inspect-source');\n\nvar WeakMap = global.WeakMap;\n\nmodule.exports = typeof WeakMap === 'function' && /native code/.test(inspectSource(WeakMap));\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","'use strict';\nvar nativePropertyIsEnumerable = {}.propertyIsEnumerable;\nvar getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// Nashorn ~ JDK8 bug\nvar NASHORN_BUG = getOwnPropertyDescriptor && !nativePropertyIsEnumerable.call({ 1: 2 }, 1);\n\n// `Object.prototype.propertyIsEnumerable` method implementation\n// https://tc39.github.io/ecma262/#sec-object.prototype.propertyisenumerable\nexports.f = NASHORN_BUG ? function propertyIsEnumerable(V) {\n  var descriptor = getOwnPropertyDescriptor(this, V);\n  return !!descriptor && descriptor.enumerable;\n} : nativePropertyIsEnumerable;\n","var has = require('../internals/has');\nvar ownKeys = require('../internals/own-keys');\nvar getOwnPropertyDescriptorModule = require('../internals/object-get-own-property-descriptor');\nvar definePropertyModule = require('../internals/object-define-property');\n\nmodule.exports = function (target, source) {\n  var keys = ownKeys(source);\n  var defineProperty = definePropertyModule.f;\n  var getOwnPropertyDescriptor = getOwnPropertyDescriptorModule.f;\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    if (!has(target, key)) defineProperty(target, key, getOwnPropertyDescriptor(source, key));\n  }\n};\n","var getBuiltIn = require('../internals/get-built-in');\nvar getOwnPropertyNamesModule = require('../internals/object-get-own-property-names');\nvar getOwnPropertySymbolsModule = require('../internals/object-get-own-property-symbols');\nvar anObject = require('../internals/an-object');\n\n// all object keys, includes non-enumerable and symbols\nmodule.exports = getBuiltIn('Reflect', 'ownKeys') || function ownKeys(it) {\n  var keys = getOwnPropertyNamesModule.f(anObject(it));\n  var getOwnPropertySymbols = getOwnPropertySymbolsModule.f;\n  return getOwnPropertySymbols ? keys.concat(getOwnPropertySymbols(it)) : keys;\n};\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\nvar hiddenKeys = enumBugKeys.concat('length', 'prototype');\n\n// `Object.getOwnPropertyNames` method\n// https://tc39.github.io/ecma262/#sec-object.getownpropertynames\nexports.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {\n  return internalObjectKeys(O, hiddenKeys);\n};\n","exports.f = Object.getOwnPropertySymbols;\n","var fails = require('../internals/fails');\n\nvar replacement = /#|\\.prototype\\./;\n\nvar isForced = function (feature, detection) {\n  var value = data[normalize(feature)];\n  return value == POLYFILL ? true\n    : value == NATIVE ? false\n    : typeof detection == 'function' ? fails(detection)\n    : !!detection;\n};\n\nvar normalize = isForced.normalize = function (string) {\n  return String(string).replace(replacement, '.').toLowerCase();\n};\n\nvar data = isForced.data = {};\nvar NATIVE = isForced.NATIVE = 'N';\nvar POLYFILL = isForced.POLYFILL = 'P';\n\nmodule.exports = isForced;\n","'use strict';\nvar IteratorPrototype = require('../internals/iterators-core').IteratorPrototype;\nvar create = require('../internals/object-create');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\nvar setToStringTag = require('../internals/set-to-string-tag');\nvar Iterators = require('../internals/iterators');\n\nvar returnThis = function () { return this; };\n\nmodule.exports = function (IteratorConstructor, NAME, next) {\n  var TO_STRING_TAG = NAME + ' Iterator';\n  IteratorConstructor.prototype = create(IteratorPrototype, { next: createPropertyDescriptor(1, next) });\n  setToStringTag(IteratorConstructor, TO_STRING_TAG, false, true);\n  Iterators[TO_STRING_TAG] = returnThis;\n  return IteratorConstructor;\n};\n","var fails = require('../internals/fails');\n\nmodule.exports = !fails(function () {\n  function F() { /* empty */ }\n  F.prototype.constructor = null;\n  return Object.getPrototypeOf(new F()) !== F.prototype;\n});\n","var NATIVE_SYMBOL = require('../internals/native-symbol');\n\nmodule.exports = NATIVE_SYMBOL\n  // eslint-disable-next-line no-undef\n  && !Symbol.sham\n  // eslint-disable-next-line no-undef\n  && typeof Symbol.iterator == 'symbol';\n","var DESCRIPTORS = require('../internals/descriptors');\nvar definePropertyModule = require('../internals/object-define-property');\nvar anObject = require('../internals/an-object');\nvar objectKeys = require('../internals/object-keys');\n\n// `Object.defineProperties` method\n// https://tc39.github.io/ecma262/#sec-object.defineproperties\nmodule.exports = DESCRIPTORS ? Object.defineProperties : function defineProperties(O, Properties) {\n  anObject(O);\n  var keys = objectKeys(Properties);\n  var length = keys.length;\n  var index = 0;\n  var key;\n  while (length > index) definePropertyModule.f(O, key = keys[index++], Properties[key]);\n  return O;\n};\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\n// `Object.keys` method\n// https://tc39.github.io/ecma262/#sec-object.keys\nmodule.exports = Object.keys || function keys(O) {\n  return internalObjectKeys(O, enumBugKeys);\n};\n","var getBuiltIn = require('../internals/get-built-in');\n\nmodule.exports = getBuiltIn('document', 'documentElement');\n","var anObject = require('../internals/an-object');\nvar aPossiblePrototype = require('../internals/a-possible-prototype');\n\n// `Object.setPrototypeOf` method\n// https://tc39.github.io/ecma262/#sec-object.setprototypeof\n// Works with __proto__ only. Old v8 can't work with null proto objects.\n/* eslint-disable no-proto */\nmodule.exports = Object.setPrototypeOf || ('__proto__' in {} ? function () {\n  var CORRECT_SETTER = false;\n  var test = {};\n  var setter;\n  try {\n    setter = Object.getOwnPropertyDescriptor(Object.prototype, '__proto__').set;\n    setter.call(test, []);\n    CORRECT_SETTER = test instanceof Array;\n  } catch (error) { /* empty */ }\n  return function setPrototypeOf(O, proto) {\n    anObject(O);\n    aPossiblePrototype(proto);\n    if (CORRECT_SETTER) setter.call(O, proto);\n    else O.__proto__ = proto;\n    return O;\n  };\n}() : undefined);\n","var isObject = require('../internals/is-object');\n\nmodule.exports = function (it) {\n  if (!isObject(it) && it !== null) {\n    throw TypeError(\"Can't set \" + String(it) + ' as a prototype');\n  } return it;\n};\n","var $ = require('../internals/export');\nvar from = require('../internals/array-from');\nvar checkCorrectnessOfIteration = require('../internals/check-correctness-of-iteration');\n\nvar INCORRECT_ITERATION = !checkCorrectnessOfIteration(function (iterable) {\n  Array.from(iterable);\n});\n\n// `Array.from` method\n// https://tc39.github.io/ecma262/#sec-array.from\n$({ target: 'Array', stat: true, forced: INCORRECT_ITERATION }, {\n  from: from\n});\n","'use strict';\nvar bind = require('../internals/function-bind-context');\nvar toObject = require('../internals/to-object');\nvar callWithSafeIterationClosing = require('../internals/call-with-safe-iteration-closing');\nvar isArrayIteratorMethod = require('../internals/is-array-iterator-method');\nvar toLength = require('../internals/to-length');\nvar createProperty = require('../internals/create-property');\nvar getIteratorMethod = require('../internals/get-iterator-method');\n\n// `Array.from` method implementation\n// https://tc39.github.io/ecma262/#sec-array.from\nmodule.exports = function from(arrayLike /* , mapfn = undefined, thisArg = undefined */) {\n  var O = toObject(arrayLike);\n  var C = typeof this == 'function' ? this : Array;\n  var argumentsLength = arguments.length;\n  var mapfn = argumentsLength > 1 ? arguments[1] : undefined;\n  var mapping = mapfn !== undefined;\n  var iteratorMethod = getIteratorMethod(O);\n  var index = 0;\n  var length, result, step, iterator, next, value;\n  if (mapping) mapfn = bind(mapfn, argumentsLength > 2 ? arguments[2] : undefined, 2);\n  // if the target is not iterable or it's an array with the default iterator - use a simple case\n  if (iteratorMethod != undefined && !(C == Array && isArrayIteratorMethod(iteratorMethod))) {\n    iterator = iteratorMethod.call(O);\n    next = iterator.next;\n    result = new C();\n    for (;!(step = next.call(iterator)).done; index++) {\n      value = mapping ? callWithSafeIterationClosing(iterator, mapfn, [step.value, index], true) : step.value;\n      createProperty(result, index, value);\n    }\n  } else {\n    length = toLength(O.length);\n    result = new C(length);\n    for (;length > index; index++) {\n      value = mapping ? mapfn(O[index], index) : O[index];\n      createProperty(result, index, value);\n    }\n  }\n  result.length = index;\n  return result;\n};\n","var anObject = require('../internals/an-object');\n\n// call something on iterator step with safe closing on error\nmodule.exports = function (iterator, fn, value, ENTRIES) {\n  try {\n    return ENTRIES ? fn(anObject(value)[0], value[1]) : fn(value);\n  // 7.4.6 IteratorClose(iterator, completion)\n  } catch (error) {\n    var returnMethod = iterator['return'];\n    if (returnMethod !== undefined) anObject(returnMethod.call(iterator));\n    throw error;\n  }\n};\n","var wellKnownSymbol = require('../internals/well-known-symbol');\nvar Iterators = require('../internals/iterators');\n\nvar ITERATOR = wellKnownSymbol('iterator');\nvar ArrayPrototype = Array.prototype;\n\n// check on default Array iterator\nmodule.exports = function (it) {\n  return it !== undefined && (Iterators.Array === it || ArrayPrototype[ITERATOR] === it);\n};\n","var classof = require('../internals/classof');\nvar Iterators = require('../internals/iterators');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar ITERATOR = wellKnownSymbol('iterator');\n\nmodule.exports = function (it) {\n  if (it != undefined) return it[ITERATOR]\n    || it['@@iterator']\n    || Iterators[classof(it)];\n};\n","var TO_STRING_TAG_SUPPORT = require('../internals/to-string-tag-support');\nvar classofRaw = require('../internals/classof-raw');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\n// ES3 wrong here\nvar CORRECT_ARGUMENTS = classofRaw(function () { return arguments; }()) == 'Arguments';\n\n// fallback for IE11 Script Access Denied error\nvar tryGet = function (it, key) {\n  try {\n    return it[key];\n  } catch (error) { /* empty */ }\n};\n\n// getting tag from ES6+ `Object.prototype.toString`\nmodule.exports = TO_STRING_TAG_SUPPORT ? classofRaw : function (it) {\n  var O, tag, result;\n  return it === undefined ? 'Undefined' : it === null ? 'Null'\n    // @@toStringTag case\n    : typeof (tag = tryGet(O = Object(it), TO_STRING_TAG)) == 'string' ? tag\n    // builtinTag case\n    : CORRECT_ARGUMENTS ? classofRaw(O)\n    // ES3 arguments fallback\n    : (result = classofRaw(O)) == 'Object' && typeof O.callee == 'function' ? 'Arguments' : result;\n};\n","var wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\nvar test = {};\n\ntest[TO_STRING_TAG] = 'z';\n\nmodule.exports = String(test) === '[object z]';\n","var wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar ITERATOR = wellKnownSymbol('iterator');\nvar SAFE_CLOSING = false;\n\ntry {\n  var called = 0;\n  var iteratorWithReturn = {\n    next: function () {\n      return { done: !!called++ };\n    },\n    'return': function () {\n      SAFE_CLOSING = true;\n    }\n  };\n  iteratorWithReturn[ITERATOR] = function () {\n    return this;\n  };\n  // eslint-disable-next-line no-throw-literal\n  Array.from(iteratorWithReturn, function () { throw 2; });\n} catch (error) { /* empty */ }\n\nmodule.exports = function (exec, SKIP_CLOSING) {\n  if (!SKIP_CLOSING && !SAFE_CLOSING) return false;\n  var ITERATION_SUPPORT = false;\n  try {\n    var object = {};\n    object[ITERATOR] = function () {\n      return {\n        next: function () {\n          return { done: ITERATION_SUPPORT = true };\n        }\n      };\n    };\n    exec(object);\n  } catch (error) { /* empty */ }\n  return ITERATION_SUPPORT;\n};\n","var $ = require('../internals/export');\nvar isArray = require('../internals/is-array');\n\n// `Array.isArray` method\n// https://tc39.github.io/ecma262/#sec-array.isarray\n$({ target: 'Array', stat: true }, {\n  isArray: isArray\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar fails = require('../internals/fails');\nvar createProperty = require('../internals/create-property');\n\nvar ISNT_GENERIC = fails(function () {\n  function F() { /* empty */ }\n  return !(Array.of.call(F) instanceof F);\n});\n\n// `Array.of` method\n// https://tc39.github.io/ecma262/#sec-array.of\n// WebKit Array.of isn't generic\n$({ target: 'Array', stat: true, forced: ISNT_GENERIC }, {\n  of: function of(/* ...args */) {\n    var index = 0;\n    var argumentsLength = arguments.length;\n    var result = new (typeof this == 'function' ? this : Array)(argumentsLength);\n    while (argumentsLength > index) createProperty(result, index, arguments[index++]);\n    result.length = argumentsLength;\n    return result;\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar fails = require('../internals/fails');\nvar isArray = require('../internals/is-array');\nvar isObject = require('../internals/is-object');\nvar toObject = require('../internals/to-object');\nvar toLength = require('../internals/to-length');\nvar createProperty = require('../internals/create-property');\nvar arraySpeciesCreate = require('../internals/array-species-create');\nvar arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar V8_VERSION = require('../internals/engine-v8-version');\n\nvar IS_CONCAT_SPREADABLE = wellKnownSymbol('isConcatSpreadable');\nvar MAX_SAFE_INTEGER = 0x1FFFFFFFFFFFFF;\nvar MAXIMUM_ALLOWED_INDEX_EXCEEDED = 'Maximum allowed index exceeded';\n\n// We can't use this feature detection in V8 since it causes\n// deoptimization and serious performance degradation\n// https://github.com/zloirock/core-js/issues/679\nvar IS_CONCAT_SPREADABLE_SUPPORT = V8_VERSION >= 51 || !fails(function () {\n  var array = [];\n  array[IS_CONCAT_SPREADABLE] = false;\n  return array.concat()[0] !== array;\n});\n\nvar SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('concat');\n\nvar isConcatSpreadable = function (O) {\n  if (!isObject(O)) return false;\n  var spreadable = O[IS_CONCAT_SPREADABLE];\n  return spreadable !== undefined ? !!spreadable : isArray(O);\n};\n\nvar FORCED = !IS_CONCAT_SPREADABLE_SUPPORT || !SPECIES_SUPPORT;\n\n// `Array.prototype.concat` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.concat\n// with adding support of @@isConcatSpreadable and @@species\n$({ target: 'Array', proto: true, forced: FORCED }, {\n  concat: function concat(arg) { // eslint-disable-line no-unused-vars\n    var O = toObject(this);\n    var A = arraySpeciesCreate(O, 0);\n    var n = 0;\n    var i, k, length, len, E;\n    for (i = -1, length = arguments.length; i < length; i++) {\n      E = i === -1 ? O : arguments[i];\n      if (isConcatSpreadable(E)) {\n        len = toLength(E.length);\n        if (n + len > MAX_SAFE_INTEGER) throw TypeError(MAXIMUM_ALLOWED_INDEX_EXCEEDED);\n        for (k = 0; k < len; k++, n++) if (k in E) createProperty(A, n, E[k]);\n      } else {\n        if (n >= MAX_SAFE_INTEGER) throw TypeError(MAXIMUM_ALLOWED_INDEX_EXCEEDED);\n        createProperty(A, n++, E);\n      }\n    }\n    A.length = n;\n    return A;\n  }\n});\n","var getBuiltIn = require('../internals/get-built-in');\n\nmodule.exports = getBuiltIn('navigator', 'userAgent') || '';\n","var $ = require('../internals/export');\nvar copyWithin = require('../internals/array-copy-within');\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\n// `Array.prototype.copyWithin` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.copywithin\n$({ target: 'Array', proto: true }, {\n  copyWithin: copyWithin\n});\n\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables('copyWithin');\n","'use strict';\nvar toObject = require('../internals/to-object');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar toLength = require('../internals/to-length');\n\nvar min = Math.min;\n\n// `Array.prototype.copyWithin` method implementation\n// https://tc39.github.io/ecma262/#sec-array.prototype.copywithin\nmodule.exports = [].copyWithin || function copyWithin(target /* = 0 */, start /* = 0, end = @length */) {\n  var O = toObject(this);\n  var len = toLength(O.length);\n  var to = toAbsoluteIndex(target, len);\n  var from = toAbsoluteIndex(start, len);\n  var end = arguments.length > 2 ? arguments[2] : undefined;\n  var count = min((end === undefined ? len : toAbsoluteIndex(end, len)) - from, len - to);\n  var inc = 1;\n  if (from < to && to < from + count) {\n    inc = -1;\n    from += count - 1;\n    to += count - 1;\n  }\n  while (count-- > 0) {\n    if (from in O) O[to] = O[from];\n    else delete O[to];\n    to += inc;\n    from += inc;\n  } return O;\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar $every = require('../internals/array-iteration').every;\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar STRICT_METHOD = arrayMethodIsStrict('every');\nvar USES_TO_LENGTH = arrayMethodUsesToLength('every');\n\n// `Array.prototype.every` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.every\n$({ target: 'Array', proto: true, forced: !STRICT_METHOD || !USES_TO_LENGTH }, {\n  every: function every(callbackfn /* , thisArg */) {\n    return $every(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n","var $ = require('../internals/export');\nvar fill = require('../internals/array-fill');\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\n// `Array.prototype.fill` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.fill\n$({ target: 'Array', proto: true }, {\n  fill: fill\n});\n\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables('fill');\n","'use strict';\nvar toObject = require('../internals/to-object');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar toLength = require('../internals/to-length');\n\n// `Array.prototype.fill` method implementation\n// https://tc39.github.io/ecma262/#sec-array.prototype.fill\nmodule.exports = function fill(value /* , start = 0, end = @length */) {\n  var O = toObject(this);\n  var length = toLength(O.length);\n  var argumentsLength = arguments.length;\n  var index = toAbsoluteIndex(argumentsLength > 1 ? arguments[1] : undefined, length);\n  var end = argumentsLength > 2 ? arguments[2] : undefined;\n  var endPos = end === undefined ? length : toAbsoluteIndex(end, length);\n  while (endPos > index) O[index++] = value;\n  return O;\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar $filter = require('../internals/array-iteration').filter;\nvar arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('filter');\n// Edge 14- issue\nvar USES_TO_LENGTH = arrayMethodUsesToLength('filter');\n\n// `Array.prototype.filter` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.filter\n// with adding support of @@species\n$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT || !USES_TO_LENGTH }, {\n  filter: function filter(callbackfn /* , thisArg */) {\n    return $filter(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar $find = require('../internals/array-iteration').find;\nvar addToUnscopables = require('../internals/add-to-unscopables');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar FIND = 'find';\nvar SKIPS_HOLES = true;\n\nvar USES_TO_LENGTH = arrayMethodUsesToLength(FIND);\n\n// Shouldn't skip holes\nif (FIND in []) Array(1)[FIND](function () { SKIPS_HOLES = false; });\n\n// `Array.prototype.find` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.find\n$({ target: 'Array', proto: true, forced: SKIPS_HOLES || !USES_TO_LENGTH }, {\n  find: function find(callbackfn /* , that = undefined */) {\n    return $find(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables(FIND);\n","'use strict';\nvar $ = require('../internals/export');\nvar $findIndex = require('../internals/array-iteration').findIndex;\nvar addToUnscopables = require('../internals/add-to-unscopables');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar FIND_INDEX = 'findIndex';\nvar SKIPS_HOLES = true;\n\nvar USES_TO_LENGTH = arrayMethodUsesToLength(FIND_INDEX);\n\n// Shouldn't skip holes\nif (FIND_INDEX in []) Array(1)[FIND_INDEX](function () { SKIPS_HOLES = false; });\n\n// `Array.prototype.findIndex` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.findindex\n$({ target: 'Array', proto: true, forced: SKIPS_HOLES || !USES_TO_LENGTH }, {\n  findIndex: function findIndex(callbackfn /* , that = undefined */) {\n    return $findIndex(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables(FIND_INDEX);\n","'use strict';\nvar $ = require('../internals/export');\nvar flattenIntoArray = require('../internals/flatten-into-array');\nvar toObject = require('../internals/to-object');\nvar toLength = require('../internals/to-length');\nvar toInteger = require('../internals/to-integer');\nvar arraySpeciesCreate = require('../internals/array-species-create');\n\n// `Array.prototype.flat` method\n// https://github.com/tc39/proposal-flatMap\n$({ target: 'Array', proto: true }, {\n  flat: function flat(/* depthArg = 1 */) {\n    var depthArg = arguments.length ? arguments[0] : undefined;\n    var O = toObject(this);\n    var sourceLen = toLength(O.length);\n    var A = arraySpeciesCreate(O, 0);\n    A.length = flattenIntoArray(A, O, O, sourceLen, 0, depthArg === undefined ? 1 : toInteger(depthArg));\n    return A;\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar flattenIntoArray = require('../internals/flatten-into-array');\nvar toObject = require('../internals/to-object');\nvar toLength = require('../internals/to-length');\nvar aFunction = require('../internals/a-function');\nvar arraySpeciesCreate = require('../internals/array-species-create');\n\n// `Array.prototype.flatMap` method\n// https://github.com/tc39/proposal-flatMap\n$({ target: 'Array', proto: true }, {\n  flatMap: function flatMap(callbackfn /* , thisArg */) {\n    var O = toObject(this);\n    var sourceLen = toLength(O.length);\n    var A;\n    aFunction(callbackfn);\n    A = arraySpeciesCreate(O, 0);\n    A.length = flattenIntoArray(A, O, O, sourceLen, 0, 1, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n    return A;\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar forEach = require('../internals/array-for-each');\n\n// `Array.prototype.forEach` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.foreach\n$({ target: 'Array', proto: true, forced: [].forEach != forEach }, {\n  forEach: forEach\n});\n","'use strict';\nvar $forEach = require('../internals/array-iteration').forEach;\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar STRICT_METHOD = arrayMethodIsStrict('forEach');\nvar USES_TO_LENGTH = arrayMethodUsesToLength('forEach');\n\n// `Array.prototype.forEach` method implementation\n// https://tc39.github.io/ecma262/#sec-array.prototype.foreach\nmodule.exports = (!STRICT_METHOD || !USES_TO_LENGTH) ? function forEach(callbackfn /* , thisArg */) {\n  return $forEach(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n} : [].forEach;\n","'use strict';\nvar $ = require('../internals/export');\nvar $includes = require('../internals/array-includes').includes;\nvar addToUnscopables = require('../internals/add-to-unscopables');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar USES_TO_LENGTH = arrayMethodUsesToLength('indexOf', { ACCESSORS: true, 1: 0 });\n\n// `Array.prototype.includes` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.includes\n$({ target: 'Array', proto: true, forced: !USES_TO_LENGTH }, {\n  includes: function includes(el /* , fromIndex = 0 */) {\n    return $includes(this, el, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables('includes');\n","'use strict';\nvar $ = require('../internals/export');\nvar $indexOf = require('../internals/array-includes').indexOf;\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar nativeIndexOf = [].indexOf;\n\nvar NEGATIVE_ZERO = !!nativeIndexOf && 1 / [1].indexOf(1, -0) < 0;\nvar STRICT_METHOD = arrayMethodIsStrict('indexOf');\nvar USES_TO_LENGTH = arrayMethodUsesToLength('indexOf', { ACCESSORS: true, 1: 0 });\n\n// `Array.prototype.indexOf` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.indexof\n$({ target: 'Array', proto: true, forced: NEGATIVE_ZERO || !STRICT_METHOD || !USES_TO_LENGTH }, {\n  indexOf: function indexOf(searchElement /* , fromIndex = 0 */) {\n    return NEGATIVE_ZERO\n      // convert -0 to +0\n      ? nativeIndexOf.apply(this, arguments) || 0\n      : $indexOf(this, searchElement, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n","'use strict';\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar addToUnscopables = require('../internals/add-to-unscopables');\nvar Iterators = require('../internals/iterators');\nvar InternalStateModule = require('../internals/internal-state');\nvar defineIterator = require('../internals/define-iterator');\n\nvar ARRAY_ITERATOR = 'Array Iterator';\nvar setInternalState = InternalStateModule.set;\nvar getInternalState = InternalStateModule.getterFor(ARRAY_ITERATOR);\n\n// `Array.prototype.entries` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.entries\n// `Array.prototype.keys` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.keys\n// `Array.prototype.values` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.values\n// `Array.prototype[@@iterator]` method\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@iterator\n// `CreateArrayIterator` internal method\n// https://tc39.github.io/ecma262/#sec-createarrayiterator\nmodule.exports = defineIterator(Array, 'Array', function (iterated, kind) {\n  setInternalState(this, {\n    type: ARRAY_ITERATOR,\n    target: toIndexedObject(iterated), // target\n    index: 0,                          // next index\n    kind: kind                         // kind\n  });\n// `%ArrayIteratorPrototype%.next` method\n// https://tc39.github.io/ecma262/#sec-%arrayiteratorprototype%.next\n}, function () {\n  var state = getInternalState(this);\n  var target = state.target;\n  var kind = state.kind;\n  var index = state.index++;\n  if (!target || index >= target.length) {\n    state.target = undefined;\n    return { value: undefined, done: true };\n  }\n  if (kind == 'keys') return { value: index, done: false };\n  if (kind == 'values') return { value: target[index], done: false };\n  return { value: [index, target[index]], done: false };\n}, 'values');\n\n// argumentsList[@@iterator] is %ArrayProto_values%\n// https://tc39.github.io/ecma262/#sec-createunmappedargumentsobject\n// https://tc39.github.io/ecma262/#sec-createmappedargumentsobject\nIterators.Arguments = Iterators.Array;\n\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables('keys');\naddToUnscopables('values');\naddToUnscopables('entries');\n","'use strict';\nvar $ = require('../internals/export');\nvar IndexedObject = require('../internals/indexed-object');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\n\nvar nativeJoin = [].join;\n\nvar ES3_STRINGS = IndexedObject != Object;\nvar STRICT_METHOD = arrayMethodIsStrict('join', ',');\n\n// `Array.prototype.join` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.join\n$({ target: 'Array', proto: true, forced: ES3_STRINGS || !STRICT_METHOD }, {\n  join: function join(separator) {\n    return nativeJoin.call(toIndexedObject(this), separator === undefined ? ',' : separator);\n  }\n});\n","var $ = require('../internals/export');\nvar lastIndexOf = require('../internals/array-last-index-of');\n\n// `Array.prototype.lastIndexOf` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.lastindexof\n$({ target: 'Array', proto: true, forced: lastIndexOf !== [].lastIndexOf }, {\n  lastIndexOf: lastIndexOf\n});\n","'use strict';\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar toInteger = require('../internals/to-integer');\nvar toLength = require('../internals/to-length');\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar min = Math.min;\nvar nativeLastIndexOf = [].lastIndexOf;\nvar NEGATIVE_ZERO = !!nativeLastIndexOf && 1 / [1].lastIndexOf(1, -0) < 0;\nvar STRICT_METHOD = arrayMethodIsStrict('lastIndexOf');\n// For preventing possible almost infinite loop in non-standard implementations, test the forward version of the method\nvar USES_TO_LENGTH = arrayMethodUsesToLength('indexOf', { ACCESSORS: true, 1: 0 });\nvar FORCED = NEGATIVE_ZERO || !STRICT_METHOD || !USES_TO_LENGTH;\n\n// `Array.prototype.lastIndexOf` method implementation\n// https://tc39.github.io/ecma262/#sec-array.prototype.lastindexof\nmodule.exports = FORCED ? function lastIndexOf(searchElement /* , fromIndex = @[*-1] */) {\n  // convert -0 to +0\n  if (NEGATIVE_ZERO) return nativeLastIndexOf.apply(this, arguments) || 0;\n  var O = toIndexedObject(this);\n  var length = toLength(O.length);\n  var index = length - 1;\n  if (arguments.length > 1) index = min(index, toInteger(arguments[1]));\n  if (index < 0) index = length + index;\n  for (;index >= 0; index--) if (index in O && O[index] === searchElement) return index || 0;\n  return -1;\n} : nativeLastIndexOf;\n","'use strict';\nvar $ = require('../internals/export');\nvar $map = require('../internals/array-iteration').map;\nvar arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('map');\n// FF49- issue\nvar USES_TO_LENGTH = arrayMethodUsesToLength('map');\n\n// `Array.prototype.map` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.map\n// with adding support of @@species\n$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT || !USES_TO_LENGTH }, {\n  map: function map(callbackfn /* , thisArg */) {\n    return $map(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar $reduce = require('../internals/array-reduce').left;\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar STRICT_METHOD = arrayMethodIsStrict('reduce');\nvar USES_TO_LENGTH = arrayMethodUsesToLength('reduce', { 1: 0 });\n\n// `Array.prototype.reduce` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.reduce\n$({ target: 'Array', proto: true, forced: !STRICT_METHOD || !USES_TO_LENGTH }, {\n  reduce: function reduce(callbackfn /* , initialValue */) {\n    return $reduce(this, callbackfn, arguments.length, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar $reduceRight = require('../internals/array-reduce').right;\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar STRICT_METHOD = arrayMethodIsStrict('reduceRight');\n// For preventing possible almost infinite loop in non-standard implementations, test the forward version of the method\nvar USES_TO_LENGTH = arrayMethodUsesToLength('reduce', { 1: 0 });\n\n// `Array.prototype.reduceRight` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.reduceright\n$({ target: 'Array', proto: true, forced: !STRICT_METHOD || !USES_TO_LENGTH }, {\n  reduceRight: function reduceRight(callbackfn /* , initialValue */) {\n    return $reduceRight(this, callbackfn, arguments.length, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar isArray = require('../internals/is-array');\n\nvar nativeReverse = [].reverse;\nvar test = [1, 2];\n\n// `Array.prototype.reverse` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.reverse\n// fix for Safari 12.0 bug\n// https://bugs.webkit.org/show_bug.cgi?id=188794\n$({ target: 'Array', proto: true, forced: String(test) === String(test.reverse()) }, {\n  reverse: function reverse() {\n    // eslint-disable-next-line no-self-assign\n    if (isArray(this)) this.length = this.length;\n    return nativeReverse.call(this);\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar isObject = require('../internals/is-object');\nvar isArray = require('../internals/is-array');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar toLength = require('../internals/to-length');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar createProperty = require('../internals/create-property');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('slice');\nvar USES_TO_LENGTH = arrayMethodUsesToLength('slice', { ACCESSORS: true, 0: 0, 1: 2 });\n\nvar SPECIES = wellKnownSymbol('species');\nvar nativeSlice = [].slice;\nvar max = Math.max;\n\n// `Array.prototype.slice` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.slice\n// fallback for not array-like ES3 strings and DOM objects\n$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT || !USES_TO_LENGTH }, {\n  slice: function slice(start, end) {\n    var O = toIndexedObject(this);\n    var length = toLength(O.length);\n    var k = toAbsoluteIndex(start, length);\n    var fin = toAbsoluteIndex(end === undefined ? length : end, length);\n    // inline `ArraySpeciesCreate` for usage native `Array#slice` where it's possible\n    var Constructor, result, n;\n    if (isArray(O)) {\n      Constructor = O.constructor;\n      // cross-realm fallback\n      if (typeof Constructor == 'function' && (Constructor === Array || isArray(Constructor.prototype))) {\n        Constructor = undefined;\n      } else if (isObject(Constructor)) {\n        Constructor = Constructor[SPECIES];\n        if (Constructor === null) Constructor = undefined;\n      }\n      if (Constructor === Array || Constructor === undefined) {\n        return nativeSlice.call(O, k, fin);\n      }\n    }\n    result = new (Constructor === undefined ? Array : Constructor)(max(fin - k, 0));\n    for (n = 0; k < fin; k++, n++) if (k in O) createProperty(result, n, O[k]);\n    result.length = n;\n    return result;\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar $some = require('../internals/array-iteration').some;\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar STRICT_METHOD = arrayMethodIsStrict('some');\nvar USES_TO_LENGTH = arrayMethodUsesToLength('some');\n\n// `Array.prototype.some` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.some\n$({ target: 'Array', proto: true, forced: !STRICT_METHOD || !USES_TO_LENGTH }, {\n  some: function some(callbackfn /* , thisArg */) {\n    return $some(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar aFunction = require('../internals/a-function');\nvar toObject = require('../internals/to-object');\nvar fails = require('../internals/fails');\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\n\nvar test = [];\nvar nativeSort = test.sort;\n\n// IE8-\nvar FAILS_ON_UNDEFINED = fails(function () {\n  test.sort(undefined);\n});\n// V8 bug\nvar FAILS_ON_NULL = fails(function () {\n  test.sort(null);\n});\n// Old WebKit\nvar STRICT_METHOD = arrayMethodIsStrict('sort');\n\nvar FORCED = FAILS_ON_UNDEFINED || !FAILS_ON_NULL || !STRICT_METHOD;\n\n// `Array.prototype.sort` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.sort\n$({ target: 'Array', proto: true, forced: FORCED }, {\n  sort: function sort(comparefn) {\n    return comparefn === undefined\n      ? nativeSort.call(toObject(this))\n      : nativeSort.call(toObject(this), aFunction(comparefn));\n  }\n});\n","var setSpecies = require('../internals/set-species');\n\n// `Array[@@species]` getter\n// https://tc39.github.io/ecma262/#sec-get-array-@@species\nsetSpecies('Array');\n","'use strict';\nvar getBuiltIn = require('../internals/get-built-in');\nvar definePropertyModule = require('../internals/object-define-property');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar DESCRIPTORS = require('../internals/descriptors');\n\nvar SPECIES = wellKnownSymbol('species');\n\nmodule.exports = function (CONSTRUCTOR_NAME) {\n  var Constructor = getBuiltIn(CONSTRUCTOR_NAME);\n  var defineProperty = definePropertyModule.f;\n\n  if (DESCRIPTORS && Constructor && !Constructor[SPECIES]) {\n    defineProperty(Constructor, SPECIES, {\n      configurable: true,\n      get: function () { return this; }\n    });\n  }\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar toInteger = require('../internals/to-integer');\nvar toLength = require('../internals/to-length');\nvar toObject = require('../internals/to-object');\nvar arraySpeciesCreate = require('../internals/array-species-create');\nvar createProperty = require('../internals/create-property');\nvar arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('splice');\nvar USES_TO_LENGTH = arrayMethodUsesToLength('splice', { ACCESSORS: true, 0: 0, 1: 2 });\n\nvar max = Math.max;\nvar min = Math.min;\nvar MAX_SAFE_INTEGER = 0x1FFFFFFFFFFFFF;\nvar MAXIMUM_ALLOWED_LENGTH_EXCEEDED = 'Maximum allowed length exceeded';\n\n// `Array.prototype.splice` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.splice\n// with adding support of @@species\n$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT || !USES_TO_LENGTH }, {\n  splice: function splice(start, deleteCount /* , ...items */) {\n    var O = toObject(this);\n    var len = toLength(O.length);\n    var actualStart = toAbsoluteIndex(start, len);\n    var argumentsLength = arguments.length;\n    var insertCount, actualDeleteCount, A, k, from, to;\n    if (argumentsLength === 0) {\n      insertCount = actualDeleteCount = 0;\n    } else if (argumentsLength === 1) {\n      insertCount = 0;\n      actualDeleteCount = len - actualStart;\n    } else {\n      insertCount = argumentsLength - 2;\n      actualDeleteCount = min(max(toInteger(deleteCount), 0), len - actualStart);\n    }\n    if (len + insertCount - actualDeleteCount > MAX_SAFE_INTEGER) {\n      throw TypeError(MAXIMUM_ALLOWED_LENGTH_EXCEEDED);\n    }\n    A = arraySpeciesCreate(O, actualDeleteCount);\n    for (k = 0; k < actualDeleteCount; k++) {\n      from = actualStart + k;\n      if (from in O) createProperty(A, k, O[from]);\n    }\n    A.length = actualDeleteCount;\n    if (insertCount < actualDeleteCount) {\n      for (k = actualStart; k < len - actualDeleteCount; k++) {\n        from = k + actualDeleteCount;\n        to = k + insertCount;\n        if (from in O) O[to] = O[from];\n        else delete O[to];\n      }\n      for (k = len; k > len - actualDeleteCount + insertCount; k--) delete O[k - 1];\n    } else if (insertCount > actualDeleteCount) {\n      for (k = len - actualDeleteCount; k > actualStart; k--) {\n        from = k + actualDeleteCount - 1;\n        to = k + insertCount - 1;\n        if (from in O) O[to] = O[from];\n        else delete O[to];\n      }\n    }\n    for (k = 0; k < insertCount; k++) {\n      O[k + actualStart] = arguments[k + 2];\n    }\n    O.length = len - actualDeleteCount + insertCount;\n    return A;\n  }\n});\n","// this method was added to unscopables after implementation\n// in popular engines, so it's moved to a separate module\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\naddToUnscopables('flat');\n","// this method was added to unscopables after implementation\n// in popular engines, so it's moved to a separate module\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\naddToUnscopables('flatMap');\n","require('../../modules/es.function.bind');\nrequire('../../modules/es.function.name');\nrequire('../../modules/es.function.has-instance');\nvar path = require('../../internals/path');\n\nmodule.exports = path.Function;\n","var $ = require('../internals/export');\nvar bind = require('../internals/function-bind');\n\n// `Function.prototype.bind` method\n// https://tc39.github.io/ecma262/#sec-function.prototype.bind\n$({ target: 'Function', proto: true }, {\n  bind: bind\n});\n","'use strict';\nvar aFunction = require('../internals/a-function');\nvar isObject = require('../internals/is-object');\n\nvar slice = [].slice;\nvar factories = {};\n\nvar construct = function (C, argsLength, args) {\n  if (!(argsLength in factories)) {\n    for (var list = [], i = 0; i < argsLength; i++) list[i] = 'a[' + i + ']';\n    // eslint-disable-next-line no-new-func\n    factories[argsLength] = Function('C,a', 'return new C(' + list.join(',') + ')');\n  } return factories[argsLength](C, args);\n};\n\n// `Function.prototype.bind` method implementation\n// https://tc39.github.io/ecma262/#sec-function.prototype.bind\nmodule.exports = Function.bind || function bind(that /* , ...args */) {\n  var fn = aFunction(this);\n  var partArgs = slice.call(arguments, 1);\n  var boundFunction = function bound(/* args... */) {\n    var args = partArgs.concat(slice.call(arguments));\n    return this instanceof boundFunction ? construct(fn, args.length, args) : fn.apply(that, args);\n  };\n  if (isObject(fn.prototype)) boundFunction.prototype = fn.prototype;\n  return boundFunction;\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar defineProperty = require('../internals/object-define-property').f;\n\nvar FunctionPrototype = Function.prototype;\nvar FunctionPrototypeToString = FunctionPrototype.toString;\nvar nameRE = /^\\s*function ([^ (]*)/;\nvar NAME = 'name';\n\n// Function instances `.name` property\n// https://tc39.github.io/ecma262/#sec-function-instances-name\nif (DESCRIPTORS && !(NAME in FunctionPrototype)) {\n  defineProperty(FunctionPrototype, NAME, {\n    configurable: true,\n    get: function () {\n      try {\n        return FunctionPrototypeToString.call(this).match(nameRE)[1];\n      } catch (error) {\n        return '';\n      }\n    }\n  });\n}\n","'use strict';\nvar isObject = require('../internals/is-object');\nvar definePropertyModule = require('../internals/object-define-property');\nvar getPrototypeOf = require('../internals/object-get-prototype-of');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar HAS_INSTANCE = wellKnownSymbol('hasInstance');\nvar FunctionPrototype = Function.prototype;\n\n// `Function.prototype[@@hasInstance]` method\n// https://tc39.github.io/ecma262/#sec-function.prototype-@@hasinstance\nif (!(HAS_INSTANCE in FunctionPrototype)) {\n  definePropertyModule.f(FunctionPrototype, HAS_INSTANCE, { value: function (O) {\n    if (typeof this != 'function' || !isObject(O)) return false;\n    if (!isObject(this.prototype)) return O instanceof this;\n    // for environment w/o native `@@hasInstance` logic enough `instanceof`, but add this:\n    while (O = getPrototypeOf(O)) if (this.prototype === O) return true;\n    return false;\n  } });\n}\n","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \"/* Buttons styles start */\\n\\nbutton#excalibur-play {\\n  display: inline-block;\\n  position: relative;\\n  z-index: 999;\\n  border-radius: 6px;\\n  border: none;\\n  /*border: 3px solid;\\n    border-color: white;\\n    box-shadow: 0 0 10px #ccc;*/\\n  padding: 1rem 1.5rem 1rem 4rem;\\n  margin: 0;\\n  text-decoration: none;\\n  background: #00b233;\\n  color: #ffffff;\\n  font-family: sans-serif;\\n  font-size: 2rem;\\n  line-height: 1;\\n  cursor: pointer;\\n  text-align: center;\\n  transition: background 250ms ease-in-out, transform 150ms ease;\\n  -webkit-appearance: none;\\n  -moz-appearance: none;\\n\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\n  animation: excalibur-button-fadein 200ms;\\n}\\n\\n/*\\nbutton#excalibur-play {\\n  display: none;\\n}*/\\n\\nbutton#excalibur-play:after {\\n  position: absolute;\\n  content: '';\\n  border: 8px solid;\\n  border-color: transparent transparent transparent white;\\n  left: 35px;\\n  top: 24px;\\n  width: 0;\\n  height: 0;\\n}\\n\\nbutton#excalibur-play:before {\\n  position: absolute;\\n  content: '';\\n  border: 3px solid;\\n  left: 19px;\\n  top: 14px;\\n  border-radius: 20px;\\n  width: 30px;\\n  height: 30px;\\n}\\n\\nbutton#excalibur-play:hover,\\nbutton#excalibur-play:focus {\\n  background: #00982c;\\n}\\n\\nbutton#excalibur-play:focus {\\n  outline: 1px solid #fff;\\n  outline-offset: -4px;\\n}\\n\\nbutton#excalibur-play:active {\\n  transform: scale(0.99);\\n}\\n\\n@keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Firefox < 16 */\\n@-moz-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Safari, Chrome and Opera > 12.1 */\\n@-webkit-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Internet Explorer */\\n@-ms-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Opera < 12.1 */\\n@-o-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\", \"\"]);\n// Exports\nmodule.exports = exports;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\n// eslint-disable-next-line func-names\nmodule.exports = function (useSourceMap) {\n  var list = []; // return the list of modules as css string\n\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = cssWithMappingToString(item, useSourceMap);\n\n      if (item[2]) {\n        return \"@media \".concat(item[2], \" {\").concat(content, \"}\");\n      }\n\n      return content;\n    }).join('');\n  }; // import a list of modules into the list\n  // eslint-disable-next-line func-names\n\n\n  list.i = function (modules, mediaQuery, dedupe) {\n    if (typeof modules === 'string') {\n      // eslint-disable-next-line no-param-reassign\n      modules = [[null, modules, '']];\n    }\n\n    var alreadyImportedModules = {};\n\n    if (dedupe) {\n      for (var i = 0; i < this.length; i++) {\n        // eslint-disable-next-line prefer-destructuring\n        var id = this[i][0];\n\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n\n    for (var _i = 0; _i < modules.length; _i++) {\n      var item = [].concat(modules[_i]);\n\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        // eslint-disable-next-line no-continue\n        continue;\n      }\n\n      if (mediaQuery) {\n        if (!item[2]) {\n          item[2] = mediaQuery;\n        } else {\n          item[2] = \"\".concat(mediaQuery, \" and \").concat(item[2]);\n        }\n      }\n\n      list.push(item);\n    }\n  };\n\n  return list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n  var content = item[1] || ''; // eslint-disable-next-line prefer-destructuring\n\n  var cssMapping = item[3];\n\n  if (!cssMapping) {\n    return content;\n  }\n\n  if (useSourceMap && typeof btoa === 'function') {\n    var sourceMapping = toComment(cssMapping);\n    var sourceURLs = cssMapping.sources.map(function (source) {\n      return \"/*# sourceURL=\".concat(cssMapping.sourceRoot || '').concat(source, \" */\");\n    });\n    return [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n  }\n\n  return [content].join('\\n');\n} // Adapted from convert-source-map (MIT)\n\n\nfunction toComment(sourceMap) {\n  // eslint-disable-next-line no-undef\n  var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n  var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n  return \"/*# \".concat(data, \" */\");\n}","// Promises/A+ Spec http://promises-aplus.github.io/promises-spec/\n\n/**\n * Valid states for a promise to be in\n */\nexport enum PromiseState {\n  Resolved,\n  Rejected,\n  Pending\n}\n\nexport interface PromiseLike<T> {\n  then(successCallback?: (value?: T) => any, rejectCallback?: (value?: T) => any): PromiseLike<T>;\n  error(rejectCallback?: (value?: any) => any): PromiseLike<T>;\n\n  //Cannot define static methods on interfaces\n  //wrap<T>(value?: T): IPromise<T>;\n\n  resolve(value?: T): PromiseLike<T>;\n  reject(value?: any): PromiseLike<T>;\n\n  state(): PromiseState;\n}\n\n/**\n * Promises are used to do asynchronous work and they are useful for\n * creating a chain of actions. In Excalibur they are used for loading,\n * sounds, animation, actions, and more.\n *\n * [[include:Promises.md]]\n */\nexport class Promise<T> implements PromiseLike<T> {\n  private _state: PromiseState = PromiseState.Pending;\n  private _value: T;\n  private _successCallbacks: { (value?: T): any }[] = [];\n  private _rejectCallback: (value?: any) => any = () => {\n    return;\n  };\n  private _errorCallback: (value?: any) => any;\n\n  /**\n   * Create and resolve a Promise with an optional value\n   * @param value  An optional value to wrap in a resolved promise\n   */\n  public static resolve<T>(value?: T): Promise<T> {\n    const promise = new Promise<T>().resolve(value);\n\n    return promise;\n  }\n\n  /**\n   * Create and reject a Promise with an optional value\n   * @param value  An optional value to wrap in a rejected promise\n   */\n  public static reject<T>(value?: T): Promise<T> {\n    const promise = new Promise<T>().reject(value);\n\n    return promise;\n  }\n\n  /**\n   * Returns a new promise that resolves when all the promises passed to it resolve, or rejects\n   * when at least 1 promise rejects.\n   */\n  public static join<T>(promises: Promise<T>[]): Promise<T>;\n\n  /**\n   * Returns a new promise that resolves when all the promises passed to it resolve, or rejects\n   * when at least 1 promise rejects.\n   */\n  public static join<T>(...promises: Promise<T>[]): Promise<T>;\n\n  public static join<T>() {\n    let promises: Promise<T>[] = [];\n\n    if (arguments.length > 0 && !Array.isArray(arguments[0])) {\n      for (let _i = 0; _i < arguments.length; _i++) {\n        promises[_i - 0] = arguments[_i];\n      }\n    } else if (arguments.length === 1 && Array.isArray(arguments[0])) {\n      promises = arguments[0];\n    }\n\n    const joinedPromise = new Promise<T>();\n    if (!promises || !promises.length) {\n      return joinedPromise.resolve();\n    }\n\n    const total = promises.length;\n    let successes = 0;\n    let rejects = 0;\n    const errors: any = [];\n\n    promises.forEach((p) => {\n      p.then(\n        () => {\n          successes += 1;\n          if (successes === total) {\n            joinedPromise.resolve();\n          } else if (successes + rejects + errors.length === total) {\n            joinedPromise.reject(errors);\n          }\n        },\n        () => {\n          rejects += 1;\n          if (successes + rejects + errors.length === total) {\n            joinedPromise.reject(errors);\n          }\n        }\n      ).error((e) => {\n        errors.push(e);\n        if (errors.length + successes + rejects === total) {\n          joinedPromise.reject(errors);\n        }\n      });\n    });\n\n    return joinedPromise;\n  }\n\n  /**\n   * Chain success and reject callbacks after the promise is resolved\n   * @param successCallback  Call on resolution of promise\n   * @param rejectCallback   Call on rejection of promise\n   */\n  public then(successCallback?: (value?: T) => any, rejectCallback?: (value?: any) => any) {\n    if (successCallback) {\n      this._successCallbacks.push(successCallback);\n\n      // If the promise is already resolved call immediately\n      if (this.state() === PromiseState.Resolved) {\n        try {\n          successCallback.call(this, this._value);\n        } catch (e) {\n          this._handleError(e);\n        }\n      }\n    }\n    if (rejectCallback) {\n      this._rejectCallback = rejectCallback;\n\n      // If the promise is already rejected call immediately\n      if (this.state() === PromiseState.Rejected) {\n        try {\n          rejectCallback.call(this, this._value);\n        } catch (e) {\n          this._handleError(e);\n        }\n      }\n    }\n\n    return this;\n  }\n\n  /**\n   * Add an error callback to the promise\n   * @param errorCallback  Call if there was an error in a callback\n   */\n  public error(errorCallback?: (value?: any) => any) {\n    if (errorCallback) {\n      this._errorCallback = errorCallback;\n    }\n    return this;\n  }\n\n  /**\n   * Resolve the promise and pass an option value to the success callbacks\n   * @param value  Value to pass to the success callbacks\n   */\n  public resolve(value?: T): Promise<T> {\n    if (this._state === PromiseState.Pending) {\n      this._value = value;\n      try {\n        this._state = PromiseState.Resolved;\n        this._successCallbacks.forEach((cb) => {\n          cb.call(this, this._value);\n        });\n      } catch (e) {\n        this._handleError(e);\n      }\n    } else {\n      throw new Error('Cannot resolve a promise that is not in a pending state!');\n    }\n    return this;\n  }\n\n  /**\n   * Reject the promise and pass an option value to the reject callbacks\n   * @param value  Value to pass to the reject callbacks\n   */\n  public reject(value?: any) {\n    if (this._state === PromiseState.Pending) {\n      this._value = value;\n      try {\n        this._state = PromiseState.Rejected;\n        this._rejectCallback.call(this, this._value);\n      } catch (e) {\n        this._handleError(e);\n      }\n    } else {\n      throw new Error('Cannot reject a promise that is not in a pending state!');\n    }\n    return this;\n  }\n\n  /**\n   * Inspect the current state of a promise\n   */\n  public state(): PromiseState {\n    return this._state;\n  }\n\n  private _handleError(e: any) {\n    if (this._errorCallback) {\n      this._errorCallback.call(this, e);\n    } else {\n      // rethrow error\n      throw e;\n    }\n  }\n}\n","import 'core-js/es/array';\nimport 'core-js/es/function';\n\nexport function polyfill() {\n  /* istanbul ignore next */\n  if (typeof window === 'undefined') {\n    window = <any>{\n      audioContext: function() {\n        return;\n      }\n    };\n  }\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !window.requestAnimationFrame) {\n    (<any>window).requestAnimationFrame =\n      (<any>window).webkitRequestAnimationFrame ||\n      (<any>window).mozRequestAnimationFrame ||\n      function(callback: Function) {\n        window.setInterval(callback, 1000 / 60);\n      };\n  }\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !window.cancelAnimationFrame) {\n    (<any>window).cancelAnimationFrame =\n      (<any>window).webkitCancelAnimationFrame ||\n      (<any>window).mozCancelAnimationFrame ||\n      function() {\n        return;\n      };\n  }\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !(<any>window).AudioContext) {\n    (<any>window).AudioContext =\n      (<any>window).AudioContext ||\n      (<any>window).webkitAudioContext ||\n      (<any>window).mozAudioContext ||\n      (<any>window).msAudioContext ||\n      (<any>window).oAudioContext;\n  }\n\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !(<any>window).devicePixelRatio) {\n    (<any>window).devicePixelRatio = window.devicePixelRatio || 1;\n  }\n}\n","/**\n * An enum that describes the sides of an Actor for collision\n */\nexport enum Side {\n  None = 'None',\n  Top = 'Top',\n  Bottom = 'Bottom',\n  Left = 'Left',\n  Right = 'Right'\n}\n","/**\n * Pseudo-Random Utility\n *\n * A pseudo-random utility to add seeded random support for help in\n * generating things like terrain or reproducible randomness. Uses the\n * [Mersenne Twister](https://en.wikipedia.org/wiki/Mersenne_Twister) algorithm.\n *\n * [[include:Random.md]]\n */\n\n/**\n * 32-bit mask\n */\nconst BITMASK32: number = 0xffffffff;\n\n/**\n * Pseudo-random number generator following the Mersenne_Twister algorithm. Given a seed this generator will produce the same sequence\n * of numbers each time it is called.\n * See https://en.wikipedia.org/wiki/Mersenne_Twister for more details.\n * Uses the MT19937-32 (2002) implementation documented here http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/MT2002/emt19937ar.html\n *\n * Api inspired by http://chancejs.com/# https://github.com/chancejs/chancejs\n */\nexport class Random {\n  // Separation point of one one word, the number of bits in the lower bitmask 0 <= r <= w-1\n  private _lowerMask: number = 0x7fffffff; // 31 bits same as _r\n  private _upperMask: number = 0x80000000; // 34 high bits\n\n  // Word size, 64 bits\n  private _w: number = 32;\n\n  // Degree of recurrence\n  private _n: number = 624;\n\n  // Middle word, an offset used in the recurrence defining the series x, 1<=m<n\n  private _m: number = 397;\n  // coefficients of teh rational normal form twist matrix\n  private _a: number = 0x9908b0df;\n\n  // tempering bit shifts and masks\n  private _u: number = 11;\n  private _s: number = 7;\n  private _b: number = 0x9d2c5680;\n  private _t: number = 15;\n  private _c: number = 0xefc60000;\n  private _l: number = 18;\n  private _f: number = 1812433253;\n\n  private _mt: number[];\n\n  private _index: number;\n\n  /**\n   * If no seed is specified, the Date.now() is used\n   */\n  constructor(public seed?: number) {\n    this._mt = new Array<number>(this._n);\n    // need to mask to support higher bit machines\n    this._mt[0] = (seed || Date.now()) >>> 0;\n\n    for (let i = 1; i < this._n; i++) {\n      const s = this._mt[i - 1] ^ (this._mt[i - 1] >>> (this._w - 2));\n      // numbers are bigger than the JS max safe int, add in 16-bit chunks to prevent IEEE rounding errors on high bits\n      this._mt[i] = (((this._f * ((s & 0xffff0000) >>> 16)) << 16) + this._f * (s & 0xffff) + i) >>> 0;\n    }\n    this._index = this._n;\n  }\n\n  /**\n   * Apply the twist\n   */\n  private _twist(): void {\n    const mag01 = [0x0, this._a];\n    let y = 0,\n      i = 0;\n    for (; i < this._n - this._m; i++) {\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\n      this._mt[i] = this._mt[i + this._m] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n    }\n    for (; i < this._n - 1; i++) {\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\n      this._mt[i] = this._mt[i + (this._m - this._n)] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n    }\n    y = (this._mt[this._n - 1] & this._upperMask) | (this._mt[0] & this._lowerMask);\n    this._mt[this._n - 1] = this._mt[this._m - 1] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n\n    this._index = 0;\n  }\n\n  /**\n   * Return next 32 bit integer number in sequence\n   */\n  public nextInt(): number {\n    if (this._index >= this._n) {\n      this._twist();\n    }\n\n    let y = this._mt[this._index++];\n\n    y ^= y >>> this._u;\n    y ^= (y << this._s) & this._b;\n    y ^= (y << this._t) & this._c;\n    y ^= y >>> this._l;\n\n    return y >>> 0;\n  }\n\n  /**\n   * Return a random floating point number between [0, 1)\n   */\n  public next(): number {\n    return this.nextInt() * (1.0 / 4294967296.0); // divided by 2^32\n  }\n\n  /**\n   * Return a random floating point in range [min, max) min is included, max is not included\n   */\n  public floating(min: number, max: number): number {\n    return (max - min) * this.next() + min;\n  }\n\n  /**\n   * Return a random integer in range [min, max] min is included, max is included.\n   * Implemented with rejection sampling, see https://medium.com/@betable/tifu-by-using-math-random-f1c308c4fd9d#.i13tdiu5a\n   */\n  public integer(min: number, max: number): number {\n    return Math.floor((max - min + 1) * this.next() + min);\n  }\n\n  /**\n   * Returns true or false randomly with 50/50 odds by default.\n   * By default the likelihood of returning a true is .5 (50%).\n   * @param likelihood takes values between [0, 1]\n   */\n  public bool(likelihood: number = 0.5): boolean {\n    return this.next() <= likelihood;\n  }\n\n  /**\n   * Returns one element from an array at random\n   */\n  public pickOne<T>(array: Array<T>): T {\n    return array[this.integer(0, array.length - 1)];\n  }\n\n  /**\n   * Returns a new array random picking elements from the original\n   * @param array Original array to pick from\n   * @param numPicks can be any positive number\n   * @param allowDuplicates indicates whether the returned set is allowed duplicates (it does not mean there will always be duplicates\n   * just that it is possible)\n   */\n  public pickSet<T>(array: Array<T>, numPicks: number, allowDuplicates: boolean = false): Array<T> {\n    if (allowDuplicates) {\n      return this._pickSetWithDuplicates(array, numPicks);\n    } else {\n      return this._pickSetWithoutDuplicates(array, numPicks);\n    }\n  }\n\n  /**\n   * Returns a new array randomly picking elements in the original (not reused)\n   * @param numPicks must be less than or equal to the number of elements in the array.\n   */\n  private _pickSetWithoutDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\n    if (numPicks > array.length || numPicks < 0) {\n      throw new Error('Invalid number of elements to pick, must pick a value 0 < n <= length');\n    }\n    if (numPicks === array.length) {\n      return array;\n    }\n\n    const result: Array<T> = new Array<T>(numPicks);\n    let currentPick = 0;\n    const tempArray = array.slice(0);\n    while (currentPick < numPicks) {\n      const index = this.integer(0, tempArray.length - 1);\n      result[currentPick++] = tempArray[index];\n      tempArray.splice(index, 1);\n    }\n\n    return result;\n  }\n\n  /**\n   * Returns a new array random picking elements from the original allowing duplicates\n   * @param numPicks can be any positive number\n   */\n  private _pickSetWithDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\n    // Typescript numbers are all floating point, so do we add check for int? (or floor the input?)\n    if (numPicks < 0) {\n      throw new Error('Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT');\n    }\n    const result = new Array<T>(numPicks);\n    for (let i = 0; i < numPicks; i++) {\n      result[i] = this.pickOne(array);\n    }\n    return result;\n  }\n\n  /**\n   * Returns a new array that has its elements shuffled. Using the Fisher/Yates method\n   * https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\n   */\n  public shuffle<T>(array: Array<T>): Array<T> {\n    const tempArray = array.slice(0);\n    let swap: T = null;\n    for (let i = 0; i < tempArray.length - 2; i++) {\n      const randomIndex = this.integer(i, tempArray.length - 1);\n      swap = tempArray[i];\n      tempArray[i] = tempArray[randomIndex];\n      tempArray[randomIndex] = swap;\n    }\n\n    return tempArray;\n  }\n\n  /**\n   * Generate a list of random integer numbers\n   * @param length the length of the final array\n   * @param min the minimum integer number to generate inclusive\n   * @param max the maximum integer number to generate inclusive\n   */\n  public range(length: number, min: number, max: number): Array<number> {\n    const result: Array<number> = new Array(length);\n    for (let i = 0; i < length; i++) {\n      result[i] = this.integer(min, max);\n    }\n    return result;\n  }\n\n  /**\n   * Returns the result of a d4 dice roll\n   */\n  public d4() {\n    return this.integer(1, 4);\n  }\n\n  /**\n   * Returns the result of a d6 dice roll\n   */\n  public d6() {\n    return this.integer(1, 6);\n  }\n\n  /**\n   * Returns the result of a d8 dice roll\n   */\n  public d8() {\n    return this.integer(1, 8);\n  }\n\n  /**\n   * Returns the result of a d10 dice roll\n   */\n  public d10() {\n    return this.integer(1, 10);\n  }\n\n  /**\n   * Returns the result of a d12 dice roll\n   */\n  public d12() {\n    return this.integer(1, 12);\n  }\n\n  /**\n   * Returns the result of a d20 dice roll\n   */\n  public d20() {\n    return this.integer(1, 20);\n  }\n}\n","import { Vector } from '../Algebra';\nimport { Random } from '../Math/Random';\nimport { Side } from '../Collision/Side';\n\n/**\n * Two PI constant\n */\nexport const TwoPI: number = Math.PI * 2;\n\n/**\n * Merges one or more objects into a single target object\n *\n * @param deep Whether or not to do a deep clone\n * @param target The target object to attach properties on\n * @param objects The objects whose properties to merge\n * @returns Merged object with properties from other objects\n */\nexport function extend(deep: boolean, target: any, ...objects: any[]): any;\n\n/**\n * Merges one or more objects into a single target object\n *\n * @param target The target object to attach properties on\n * @param object2 The second object whose properties to merge\n * @returns Merged object with properties from other objects\n */\nexport function extend<T1, T2>(target: T1, object2: T2): T1 & T2;\n\n/**\n * Merges one or more objects into a single target object\n *\n * @param target The target object to attach properties on\n * @param object2 The second object whose properties to merge\n * @param object3 The third object whose properties to merge\n * @returns Merged object with properties from other objects\n */\nexport function extend<T1, T2, T3>(target: T1, object2: T2, object3: T3): T1 & T2 & T3;\n\n/**\n * Merges one or more objects into a single target object\n *\n * @param target The target object to attach properties on\n * @param objects The objects whose properties to merge\n * @returns Merged object with properties from other objects\n */\nexport function extend(target: any, ...objects: any[]): any;\n\n/**\n * Merges one or more objects into a single target object\n *\n * @returns Merged object with properties from other objects\n * @credit https://gomakethings.com/vanilla-javascript-version-of-jquery-extend/\n */\nexport function extend() {\n  const extended: { [key: string]: any } = {};\n  let deep = false;\n  let i = 0;\n  const length = arguments.length;\n\n  // Check if a deep merge\n  if (Object.prototype.toString.call(arguments[0]) === '[object Boolean]') {\n    deep = arguments[0];\n    i++;\n  }\n\n  // Merge the object into the extended object\n  const assignExists = typeof (<any>Object).assign === 'function';\n  let merge = null;\n  if (!assignExists) {\n    merge = function(obj: any) {\n      for (const prop in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, prop)) {\n          // If deep merge and property is an object, merge properties\n          if (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') {\n            extended[prop] = extend(true, extended[prop], obj[prop]);\n          } else {\n            extended[prop] = obj[prop];\n          }\n        }\n      }\n    };\n  } else {\n    merge = (<any>Object).assign;\n  }\n\n  // Loop through each object and conduct a merge\n  for (; i < length; i++) {\n    const obj = arguments[i];\n    if (!assignExists) {\n      merge(obj);\n    } else {\n      merge(extended, obj);\n    }\n  }\n\n  return extended;\n}\n\nexport function base64Encode(inputStr: string) {\n  const b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n  let outputStr = '';\n  let i = 0;\n\n  while (i < inputStr.length) {\n    //all three \"& 0xff\" added below are there to fix a known bug\n    //with bytes returned by xhr.responseText\n    const byte1 = inputStr.charCodeAt(i++) & 0xff;\n    const byte2 = inputStr.charCodeAt(i++) & 0xff;\n    const byte3 = inputStr.charCodeAt(i++) & 0xff;\n\n    const enc1 = byte1 >> 2;\n    const enc2 = ((byte1 & 3) << 4) | (byte2 >> 4);\n\n    let enc3, enc4;\n    if (isNaN(byte2)) {\n      enc3 = enc4 = 64;\n    } else {\n      enc3 = ((byte2 & 15) << 2) | (byte3 >> 6);\n      if (isNaN(byte3)) {\n        enc4 = 64;\n      } else {\n        enc4 = byte3 & 63;\n      }\n    }\n\n    outputStr += b64.charAt(enc1) + b64.charAt(enc2) + b64.charAt(enc3) + b64.charAt(enc4);\n  }\n\n  return outputStr;\n}\n\n/**\n * Sugar that will use `nullishVal` if it's not null or undefined. Simulates the `??` operator\n * @param nullishVal\n * @param defaultVal\n */\nexport function nullish<T>(nullishVal: T | undefined | null, defaultVal: T): T {\n  return nullishVal !== null && nullishVal !== undefined ? nullishVal : defaultVal;\n}\n\n/**\n * Clamps a value between a min and max inclusive\n */\nexport function clamp(val: number, min: number, max: number) {\n  return Math.min(Math.max(min, val), max);\n}\n\nexport function randomInRange(min: number, max: number, random: Random = new Random()): number {\n  return random ? random.floating(min, max) : min + Math.random() * (max - min);\n}\n\nexport function randomIntInRange(min: number, max: number, random: Random = new Random()): number {\n  return random ? random.integer(min, max) : Math.round(randomInRange(min, max));\n}\n\nexport function canonicalizeAngle(angle: number): number {\n  let tmpAngle = angle;\n  if (angle > TwoPI) {\n    while (tmpAngle > TwoPI) {\n      tmpAngle -= TwoPI;\n    }\n  }\n\n  if (angle < 0) {\n    while (tmpAngle < 0) {\n      tmpAngle += TwoPI;\n    }\n  }\n  return tmpAngle;\n}\n\nexport function toDegrees(radians: number): number {\n  return (180 / Math.PI) * radians;\n}\n\nexport function toRadians(degrees: number): number {\n  return (degrees / 180) * Math.PI;\n}\n\nexport function getPosition(el: HTMLElement): Vector {\n  let oLeft: number = 0,\n    oTop: number = 0;\n\n  const calcOffsetLeft = (parent: HTMLElement) => {\n    oLeft += parent.offsetLeft;\n\n    if (parent.offsetParent) {\n      calcOffsetLeft(<HTMLElement>parent.offsetParent);\n    }\n  };\n  const calcOffsetTop = (parent: HTMLElement) => {\n    oTop += parent.offsetTop;\n    if (parent.offsetParent) {\n      calcOffsetTop(<HTMLElement>parent.offsetParent);\n    }\n  };\n\n  calcOffsetLeft(el);\n  calcOffsetTop(el);\n\n  return new Vector(oLeft, oTop);\n}\n\nexport function addItemToArray<T>(item: T, array: T[]): boolean {\n  if (array.indexOf(item) === -1) {\n    array.push(item);\n    return true;\n  }\n  return false;\n}\n\nexport function removeItemFromArray<T>(item: T, array: T[]): boolean {\n  let index = -1;\n  if ((index = array.indexOf(item)) > -1) {\n    array.splice(index, 1);\n    return true;\n  }\n\n  return false;\n}\n\nexport function contains(array: Array<any>, obj: any): boolean {\n  for (let i = 0; i < array.length; i++) {\n    if (array[i] === obj) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function getOppositeSide(side: Side) {\n  if (side === Side.Top) {\n    return Side.Bottom;\n  }\n  if (side === Side.Bottom) {\n    return Side.Top;\n  }\n  if (side === Side.Left) {\n    return Side.Right;\n  }\n  if (side === Side.Right) {\n    return Side.Left;\n  }\n\n  return Side.None;\n}\n\n/**\n * Returns the side in the direction of the vector supplied\n * @param direction Vector to check\n */\nexport function getSideFromDirection(direction: Vector) {\n  const directions = [Vector.Left, Vector.Right, Vector.Up, Vector.Down];\n  const directionEnum = [Side.Left, Side.Right, Side.Top, Side.Bottom];\n\n  let max = -Number.MAX_VALUE;\n  let maxIndex = -1;\n  for (let i = 0; i < directions.length; i++) {\n    if (directions[i].dot(direction) > max) {\n      max = directions[i].dot(direction);\n      maxIndex = i;\n    }\n  }\n  return directionEnum[maxIndex];\n}\n\n/**\n * Excalibur's dynamically resizing collection\n */\nexport class Collection<T> {\n  /**\n   * Default collection size\n   */\n  public static DefaultSize = 200;\n  private _internalArray: T[] = null;\n  private _endPointer: number = 0;\n\n  /**\n   * @param initialSize  Initial size of the internal backing array\n   */\n  constructor(initialSize: number = Collection.DefaultSize) {\n    this._internalArray = new Array<T>(initialSize);\n  }\n\n  private _resize() {\n    const newSize = this._internalArray.length * 2;\n    const newArray = new Array<T>(newSize);\n    const count = this.count();\n    for (let i = 0; i < count; i++) {\n      newArray[i] = this._internalArray[i];\n    }\n\n    delete this._internalArray;\n    this._internalArray = newArray;\n  }\n\n  /**\n   * Push elements to the end of the collection\n   */\n  public push(element: T): T {\n    if (this._endPointer === this._internalArray.length) {\n      this._resize();\n    }\n    return (this._internalArray[this._endPointer++] = element);\n  }\n\n  /**\n   * Removes elements from the end of the collection\n   */\n  public pop(): T {\n    this._endPointer = this._endPointer - 1 < 0 ? 0 : this._endPointer - 1;\n    return this._internalArray[this._endPointer];\n  }\n\n  /**\n   * Returns the count of the collection\n   */\n  public count(): number {\n    return this._endPointer;\n  }\n\n  /**\n   * Empties the collection\n   */\n  public clear() {\n    this._endPointer = 0;\n  }\n\n  /**\n   * Returns the size of the internal backing array\n   */\n  public internalSize(): number {\n    return this._internalArray.length;\n  }\n\n  /**\n   * Returns an element at a specific index\n   * @param index  Index of element to retrieve\n   */\n  public elementAt(index: number): T {\n    if (index >= this.count()) {\n      //Logger.getInstance().error('Invalid parameter: ' + index);\n      throw new Error('Invalid index ' + index);\n    }\n    return this._internalArray[index];\n  }\n\n  /**\n   * Inserts an element at a specific index\n   * @param index  Index to insert the element\n   * @param value  Element to insert\n   */\n  public insert(index: number, value: T): T {\n    if (index >= this.count()) {\n      this._resize();\n    }\n    return (this._internalArray[index] = value);\n  }\n\n  /**\n   * Removes an element at a specific index\n   * @param index  Index of element to remove\n   */\n  public remove(index: number): T {\n    const count = this.count();\n    if (count === 0) {\n      //Logger.getInstance().error('Invalid parameter: ' + index);\n      throw new Error('Invalid parameter ' + index);\n    }\n    // O(n) Shift\n    const removed = this._internalArray[index];\n    for (let i = index; i < count; i++) {\n      this._internalArray[i] = this._internalArray[i + 1];\n    }\n    this._endPointer--;\n    return removed;\n  }\n\n  /**\n   * Removes an element by reference\n   * @param element  Element to retrieve\n   */\n  public removeElement(element: T) {\n    const index = this._internalArray.indexOf(element);\n    this.remove(index);\n  }\n\n  /**\n   * Returns a array representing the collection\n   */\n  public toArray(): T[] {\n    return this._internalArray.slice(0, this._endPointer);\n  }\n\n  /**\n   * Iterate over every element in the collection\n   * @param func  Callback to call for each element passing a reference to the element and its index, returned values are ignored\n   */\n  public forEach(func: (element: T, index: number) => any) {\n    let i = 0;\n    const count = this.count();\n    for (i; i < count; i++) {\n      func.call(this, this._internalArray[i], i);\n    }\n  }\n\n  /**\n   * Mutate every element in the collection\n   * @param func  Callback to call for each element passing a reference to the element and its index, any values returned mutate\n   * the collection\n   */\n  public map(func: (element: T, index: number) => any) {\n    const count = this.count();\n    for (let i = 0; i < count; i++) {\n      this._internalArray[i] = func.call(this, this._internalArray[i], i);\n    }\n  }\n}\n\n/**\n * Used for exhaustive checks at compile time\n */\nexport function fail(message: never): never {\n  throw new Error(message);\n}\n","/* eslint-disable no-console */\n/**\n * Logging level that Excalibur will tag\n */\nexport enum LogLevel {\n  Debug,\n  Info,\n  Warn,\n  Error,\n  Fatal\n}\n\n/**\n * Static singleton that represents the logging facility for Excalibur.\n * Excalibur comes built-in with a [[ConsoleAppender]] and [[ScreenAppender]].\n * Derive from [[Appender]] to create your own logging appenders.\n *\n * [[include:Logger.md]]\n */\nexport class Logger {\n  private static _instance: Logger = null;\n  private _appenders: Appender[] = [];\n\n  constructor() {\n    if (Logger._instance) {\n      throw new Error('Logger is a singleton');\n    }\n    Logger._instance = this;\n    // Default console appender\n    Logger._instance.addAppender(new ConsoleAppender());\n    return Logger._instance;\n  }\n\n  /**\n   * Gets or sets the default logging level. Excalibur will only log\n   * messages if equal to or above this level. Default: [[LogLevel.Info]]\n   */\n  public defaultLevel: LogLevel = LogLevel.Info;\n\n  /**\n   * Gets the current static instance of Logger\n   */\n  public static getInstance(): Logger {\n    if (Logger._instance == null) {\n      Logger._instance = new Logger();\n    }\n    return Logger._instance;\n  }\n\n  /**\n   * Adds a new [[Appender]] to the list of appenders to write to\n   */\n  public addAppender(appender: Appender): void {\n    this._appenders.push(appender);\n  }\n\n  /**\n   * Clears all appenders from the logger\n   */\n  public clearAppenders(): void {\n    this._appenders.length = 0;\n  }\n\n  /**\n   * Logs a message at a given LogLevel\n   * @param level  The LogLevel`to log the message at\n   * @param args   An array of arguments to write to an appender\n   */\n  private _log(level: LogLevel, args: any[]): void {\n    if (level == null) {\n      level = this.defaultLevel;\n    }\n\n    const len = this._appenders.length;\n\n    for (let i = 0; i < len; i++) {\n      if (level >= this.defaultLevel) {\n        this._appenders[i].log(level, args);\n      }\n    }\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Debug]] level\n   * @param args  Accepts any number of arguments\n   */\n  public debug(...args: any[]): void {\n    this._log(LogLevel.Debug, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Info]] level\n   * @param args  Accepts any number of arguments\n   */\n  public info(...args: any[]): void {\n    this._log(LogLevel.Info, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Warn]] level\n   * @param args  Accepts any number of arguments\n   */\n  public warn(...args: any[]): void {\n    this._log(LogLevel.Warn, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Error]] level\n   * @param args  Accepts any number of arguments\n   */\n  public error(...args: any[]): void {\n    this._log(LogLevel.Error, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Fatal]] level\n   * @param args  Accepts any number of arguments\n   */\n  public fatal(...args: any[]): void {\n    this._log(LogLevel.Fatal, args);\n  }\n}\n\n/**\n * Contract for any log appender (such as console/screen)\n */\nexport interface Appender {\n  /**\n   * Logs a message at the given [[LogLevel]]\n   * @param level  Level to log at\n   * @param args   Arguments to log\n   */\n  log(level: LogLevel, args: any[]): void;\n}\n\n/**\n * Console appender for browsers (i.e. `console.log`)\n */\nexport class ConsoleAppender implements Appender {\n  /**\n   * Logs a message at the given [[LogLevel]]\n   * @param level  Level to log at\n   * @param args   Arguments to log\n   */\n  public log(level: LogLevel, args: any[]): void {\n    // Check for console support\n    if (!console && !console.log && console.warn && console.error) {\n      // todo maybe do something better than nothing\n      return;\n    }\n\n    // Create a new console args array\n    const consoleArgs: any[] = [];\n    consoleArgs.unshift.apply(consoleArgs, args);\n    consoleArgs.unshift('[' + LogLevel[level] + '] : ');\n\n    if (level < LogLevel.Warn) {\n      // Call .log for Debug/Info\n      if (console.log.apply) {\n        // this is required on some older browsers that don't support apply on console.log :(\n        console.log.apply(console, consoleArgs);\n      } else {\n        console.log(consoleArgs.join(' '));\n      }\n    } else if (level < LogLevel.Error) {\n      // Call .warn for Warn\n      if (console.warn.apply) {\n        console.warn.apply(console, consoleArgs);\n      } else {\n        console.warn(consoleArgs.join(' '));\n      }\n    } else {\n      // Call .error for Error/Fatal\n      if (console.error.apply) {\n        console.error.apply(console, consoleArgs);\n      } else {\n        console.error(consoleArgs.join(' '));\n      }\n    }\n  }\n}\n\n/**\n * On-screen (canvas) appender\n */\nexport class ScreenAppender implements Appender {\n  // @todo Clean this up\n\n  private _messages: string[] = [];\n  private _canvas: HTMLCanvasElement;\n  private _ctx: CanvasRenderingContext2D;\n\n  /**\n   * @param width   Width of the screen appender in pixels\n   * @param height  Height of the screen appender in pixels\n   */\n  constructor(width?: number, height?: number) {\n    this._canvas = <HTMLCanvasElement>document.createElement('canvas');\n    this._canvas.width = width || window.innerWidth;\n    this._canvas.height = height || window.innerHeight;\n    this._canvas.style.position = 'absolute';\n    // eslint-disable-next-line\n    this._ctx = <CanvasRenderingContext2D>this._canvas.getContext('2d'); // eslint-disable-line\n    document.body.appendChild(this._canvas);\n  }\n\n  /**\n   * Logs a message at the given [[LogLevel]]\n   * @param level  Level to log at\n   * @param args   Arguments to log\n   */\n  public log(level: LogLevel, args: any[]): void {\n    const message = args.join(',');\n\n    this._ctx.clearRect(0, 0, this._canvas.width, this._canvas.height);\n\n    this._messages.unshift('[' + LogLevel[level] + '] : ' + message);\n\n    let pos = 10;\n    let opacity = 1.0;\n    for (let i = 0; i < this._messages.length; i++) {\n      this._ctx.fillStyle = 'rgba(255,255,255,' + opacity.toFixed(2) + ')';\n      this._ctx.fillText(this._messages[i], 200, pos);\n      pos += 10;\n      opacity = opacity > 0 ? opacity - 0.05 : 0;\n    }\n  }\n}\n","import { Logger } from './Log';\nimport * as Util from './Util';\n\n/**\n * Obsolete decorator options\n */\nexport interface ObsoleteOptions {\n  // Optionally specify a custom message\n  message?: string;\n  // Optionally indicate that an alternate method to the obsolete one exists\n  alternateMethod?: string;\n  // Optional show stack trace, by default off\n  showStackTrace?: boolean;\n}\n\nexport const maxMessages = 5;\nconst obsoleteMessage: { [messageCount: string]: number } = {};\nexport const resetObsoleteCounter = () => {\n  for (const message in obsoleteMessage) {\n    obsoleteMessage[message] = 0;\n  }\n};\n\nconst logMessage = (message: string, options: ObsoleteOptions) => {\n  if (obsoleteMessage[message] < maxMessages) {\n    Logger.getInstance().warn(message);\n\n    // tslint:disable-next-line: no-console\n    if (console.trace && options.showStackTrace) {\n      // tslint:disable-next-line: no-console\n      console.trace();\n    }\n  }\n  obsoleteMessage[message]++;\n};\n\n/**\n * Obsolete decorator for marking Excalibur methods obsolete, you can optionally specify a custom message and/or alternate replacement\n * method do the deprecated one. Inspired by https://github.com/jayphelps/core-decorators.js\n */\nexport function obsolete(options?: ObsoleteOptions): any {\n  options = Util.extend(\n    {},\n    {\n      message: 'This feature will be removed in future versions of Excalibur.',\n      alternateMethod: null,\n      showStackTrack: false\n    },\n    options\n  );\n\n  return function(target: any, property: string, descriptor: PropertyDescriptor): any {\n    if (\n      descriptor &&\n      !(typeof descriptor.value === 'function' || typeof descriptor.get === 'function' || typeof descriptor.set === 'function')\n    ) {\n      throw new SyntaxError('Only classes/functions/getters/setters can be marked as obsolete');\n    }\n    const methodSignature = `${target.name || ''}${target.name && property ? '.' : ''}${property ? property : ''}`;\n\n    const message =\n      `${methodSignature} is marked obsolete: ${options.message}` +\n      (options.alternateMethod ? ` Use ${options.alternateMethod} instead` : '');\n\n    if (!obsoleteMessage[message]) {\n      obsoleteMessage[message] = 0;\n    }\n\n    // If descriptor is null it is a class\n    const method = descriptor ? { ...descriptor } : target;\n    if (!descriptor) {\n      const constructor = function() {\n        const args = Array.prototype.slice.call(arguments);\n        logMessage(message, options);\n        return new method(...args);\n      };\n      constructor.prototype = method.prototype;\n      return constructor;\n    }\n\n    if (descriptor && descriptor.value) {\n      method.value = function(this: any) {\n        logMessage(message, options);\n        return descriptor.value.apply(this, arguments);\n      };\n      return method;\n    }\n\n    if (descriptor && descriptor.get) {\n      method.get = function(this: any) {\n        logMessage(message, options);\n        return descriptor.get.apply(this, arguments);\n      };\n    }\n\n    if (descriptor && descriptor.set) {\n      method.set = function(this: any) {\n        logMessage(message, options);\n        return descriptor.set.apply(this, arguments);\n      };\n    }\n    return method;\n  };\n}\n","import { Engine } from './Engine';\nimport * as Util from './Util/Util';\nimport { Clonable } from './Interfaces/Clonable';\nimport { obsolete } from './Util/Decorators';\n\n/**\n * A 2D vector on a plane.\n */\nexport class Vector implements Clonable<Vector> {\n  /**\n   * A (0, 0) vector\n   */\n  public static get Zero() {\n    return new Vector(0, 0);\n  }\n\n  /**\n   * A (1, 1) vector\n   */\n  public static get One() {\n    return new Vector(1, 1);\n  }\n\n  /**\n   * A (0.5, 0.5) vector\n   */\n  public static get Half() {\n    return new Vector(0.5, 0.5);\n  }\n\n  /**\n   * A unit vector pointing up (0, -1)\n   */\n  public static get Up() {\n    return new Vector(0, -1);\n  }\n\n  /**\n   * A unit vector pointing down (0, 1)\n   */\n  public static get Down() {\n    return new Vector(0, 1);\n  }\n\n  /**\n   * A unit vector pointing left (-1, 0)\n   */\n  public static get Left() {\n    return new Vector(-1, 0);\n  }\n  /**\n   * A unit vector pointing right (1, 0)\n   */\n  public static get Right() {\n    return new Vector(1, 0);\n  }\n\n  /**\n   * Returns a vector of unit length in the direction of the specified angle in Radians.\n   * @param angle The angle to generate the vector\n   */\n  public static fromAngle(angle: number) {\n    return new Vector(Math.cos(angle), Math.sin(angle));\n  }\n\n  /**\n   * Checks if vector is not null, undefined, or if any of its components are NaN or Infinity.\n   */\n  public static isValid(vec: Vector) {\n    if (vec === null || vec === undefined) {\n      return false;\n    }\n    if (isNaN(vec.x) || isNaN(vec.y)) {\n      return false;\n    }\n\n    if (vec.x === Infinity || vec.y === Infinity || vec.x === -Infinity || vec.y === -Infinity) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Calculates distance between two Vectors\n   * @param vec1\n   * @param vec2\n   */\n  public static distance(vec1: Vector, vec2: Vector) {\n    return Math.sqrt(Math.pow(vec1.x - vec2.x, 2) + Math.pow(vec1.y - vec2.y, 2));\n  }\n\n  /**\n   * @param x  X component of the Vector\n   * @param y  Y component of the Vector\n   */\n  constructor(public x: number, public y: number) {}\n\n  /**\n   * Sets the x and y components at once\n   */\n  public setTo(x: number, y: number) {\n    this.x = x;\n    this.y = y;\n  }\n\n  /**\n   * Compares this point against another and tests for equality\n   * @param point  The other point to compare to\n   */\n  public equals(vector: Vector, tolerance: number = 0.001): boolean {\n    return Math.abs(this.x - vector.x) <= tolerance && Math.abs(this.y - vector.y) <= tolerance;\n  }\n\n  /**\n   * The distance to another vector. If no other Vector is specified, this will return the [[magnitude]].\n   * @param v  The other vector. Leave blank to use origin vector.\n   */\n  public distance(v?: Vector): number {\n    if (!v) {\n      v = Vector.Zero;\n    }\n    return Math.sqrt(Math.pow(this.x - v.x, 2) + Math.pow(this.y - v.y, 2));\n  }\n\n  /**\n   * The magnitude (size) of the Vector\n   * @obsolete magnitude will be removed in favour of '.size' in version 0.25.0\n   */\n  @obsolete({ message: 'will be removed in favour of `.size` in version 0.25.0' })\n  public magnitude(): number {\n    return this.distance();\n  }\n\n  /**\n   * The size(magnitude) of the Vector\n   */\n  public get size(): number {\n    return this.distance();\n  }\n\n  public set size(newLength: number) {\n    const v = this.normalize().scale(newLength);\n    this.x = v.x;\n    this.y = v.y;\n  }\n\n  /**\n   * Normalizes a vector to have a magnitude of 1.\n   */\n  public normalize(): Vector {\n    const d = this.distance();\n    if (d > 0) {\n      return new Vector(this.x / d, this.y / d);\n    } else {\n      return new Vector(0, 1);\n    }\n  }\n\n  /**\n   * Returns the average (midpoint) between the current point and the specified\n   */\n  public average(vec: Vector): Vector {\n    return this.add(vec).scale(0.5);\n  }\n\n  /**\n   * Scales a vector's by a factor of size\n   * @param size  The factor to scale the magnitude by\n   */\n  public scale(scale: Vector): Vector;\n  public scale(size: number): Vector;\n  public scale(sizeOrScale: number | Vector): Vector {\n    if (sizeOrScale instanceof Vector) {\n      return new Vector(this.x * sizeOrScale.x, this.y * sizeOrScale.y);\n    } else {\n      return new Vector(this.x * sizeOrScale, this.y * sizeOrScale);\n    }\n  }\n\n  /**\n   * Adds one vector to another\n   * @param v The vector to add\n   */\n  public add(v: Vector): Vector {\n    return new Vector(this.x + v.x, this.y + v.y);\n  }\n\n  /**\n   * Subtracts a vector from another, if you subtract vector `B.sub(A)` the resulting vector points from A -> B\n   * @param v The vector to subtract\n   */\n  public sub(v: Vector): Vector {\n    return new Vector(this.x - v.x, this.y - v.y);\n  }\n\n  /**\n   * Adds one vector to this one modifying the original\n   * @param v The vector to add\n   */\n  public addEqual(v: Vector): Vector {\n    this.x += v.x;\n    this.y += v.y;\n    return this;\n  }\n\n  /**\n   * Subtracts a vector from this one modifying the original\n   * @parallel v The vector to subtract\n   */\n  public subEqual(v: Vector): Vector {\n    this.x -= v.x;\n    this.y -= v.y;\n    return this;\n  }\n\n  /**\n   * Scales this vector by a factor of size and modifies the original\n   */\n  public scaleEqual(size: number): Vector {\n    this.x *= size;\n    this.y *= size;\n    return this;\n  }\n\n  /**\n   * Performs a dot product with another vector\n   * @param v  The vector to dot\n   */\n  public dot(v: Vector): number {\n    return this.x * v.x + this.y * v.y;\n  }\n\n  /**\n   * Performs a 2D cross product with scalar. 2D cross products with a scalar return a vector.\n   * @param v  The scalar to cross\n   */\n  public cross(v: number): Vector;\n  /**\n   * Performs a 2D cross product with another vector. 2D cross products return a scalar value not a vector.\n   * @param v  The vector to cross\n   */\n  public cross(v: Vector): number;\n  public cross(v: any): any {\n    if (v instanceof Vector) {\n      return this.x * v.y - this.y * v.x;\n    } else if (typeof v === 'number') {\n      return new Vector(v * this.y, -v * this.x);\n    }\n  }\n\n  /**\n   * Returns the perpendicular vector to this one\n   */\n  public perpendicular(): Vector {\n    return new Vector(this.y, -this.x);\n  }\n\n  /**\n   * Returns the normal vector to this one, same as the perpendicular of length 1\n   */\n  public normal(): Vector {\n    return this.perpendicular().normalize();\n  }\n\n  /**\n   * Negate the current vector\n   */\n  public negate(): Vector {\n    return this.scale(-1);\n  }\n\n  /**\n   * Returns the angle of this vector.\n   */\n  public toAngle(): number {\n    return Math.atan2(this.y, this.x);\n  }\n\n  /**\n   * Rotates the current vector around a point by a certain number of\n   * degrees in radians\n   */\n  public rotate(angle: number, anchor?: Vector): Vector {\n    if (!anchor) {\n      anchor = new Vector(0, 0);\n    }\n    const sinAngle = Math.sin(angle);\n    const cosAngle = Math.cos(angle);\n    const x = cosAngle * (this.x - anchor.x) - sinAngle * (this.y - anchor.y) + anchor.x;\n    const y = sinAngle * (this.x - anchor.x) + cosAngle * (this.y - anchor.y) + anchor.y;\n    return new Vector(x, y);\n  }\n\n  /**\n   * Creates new vector that has the same values as the previous.\n   */\n  public clone(): Vector {\n    return new Vector(this.x, this.y);\n  }\n\n  /**\n   * Returns a string representation of the vector.\n   */\n  public toString(): string {\n    return `(${this.x}, ${this.y})`;\n  }\n}\n\n/**\n * A 2D ray that can be cast into the scene to do collision detection\n */\nexport class Ray {\n  public pos: Vector;\n  public dir: Vector;\n\n  /**\n   * @param pos The starting position for the ray\n   * @param dir The vector indicating the direction of the ray\n   */\n  constructor(pos: Vector, dir: Vector) {\n    this.pos = pos;\n    this.dir = dir.normalize();\n  }\n\n  /**\n   * Tests a whether this ray intersects with a line segment. Returns a number greater than or equal to 0 on success.\n   * This number indicates the mathematical intersection time.\n   * @param line  The line to test\n   */\n  public intersect(line: Line): number {\n    const numerator = line.begin.sub(this.pos);\n\n    // Test is line and ray are parallel and non intersecting\n    if (this.dir.cross(line.getSlope()) === 0 && numerator.cross(this.dir) !== 0) {\n      return -1;\n    }\n\n    // Lines are parallel\n    const divisor = this.dir.cross(line.getSlope());\n    if (divisor === 0) {\n      return -1;\n    }\n\n    const t = numerator.cross(line.getSlope()) / divisor;\n\n    if (t >= 0) {\n      const u = numerator.cross(this.dir) / divisor / line.getLength();\n      if (u >= 0 && u <= 1) {\n        return t;\n      }\n    }\n    return -1;\n  }\n\n  /**\n   * Returns the point of intersection given the intersection time\n   */\n  public getPoint(time: number): Vector {\n    return this.pos.add(this.dir.scale(time));\n  }\n}\n\n/**\n * A 2D line segment\n */\nexport class Line {\n  /**\n   * @param begin  The starting point of the line segment\n   * @param end  The ending point of the line segment\n   */\n  constructor(public begin: Vector, public end: Vector) {}\n\n  /**\n   * Gets the raw slope (m) of the line. Will return (+/-)Infinity for vertical lines.\n   */\n  public get slope() {\n    return (this.end.y - this.begin.y) / (this.end.x - this.begin.x);\n  }\n\n  /**\n   * Gets the Y-intercept (b) of the line. Will return (+/-)Infinity if there is no intercept.\n   */\n  public get intercept() {\n    return this.begin.y - this.slope * this.begin.x;\n  }\n\n  /**\n   * Gets the normal of the line\n   */\n  public normal(): Vector {\n    return this.end.sub(this.begin).normal();\n  }\n\n  /**\n   * Returns the slope of the line in the form of a vector of length 1\n   */\n  public getSlope(): Vector {\n    const begin = this.begin;\n    const end = this.end;\n    const distance = begin.distance(end);\n    return end.sub(begin).scale(1 / distance);\n  }\n\n  /**\n   * Returns the edge of the line as vector, the length of the vector is the length of the edge\n   */\n  public getEdge(): Vector {\n    const begin = this.begin;\n    const end = this.end;\n    return end.sub(begin);\n  }\n\n  /**\n   * Returns the length of the line segment in pixels\n   */\n  public getLength(): number {\n    const begin = this.begin;\n    const end = this.end;\n    const distance = begin.distance(end);\n    return distance;\n  }\n\n  /**\n   * Returns the midpoint of the edge\n   */\n  public get midpoint(): Vector {\n    return this.begin.add(this.end).scale(0.5);\n  }\n\n  /**\n   * Flips the direction of the line segment\n   */\n  public flip(): Line {\n    return new Line(this.end, this.begin);\n  }\n\n  /**\n   * Find the perpendicular distance from the line to a point\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\n   * @param point\n   */\n  public distanceToPoint(point: Vector) {\n    const x0 = point.x;\n    const y0 = point.y;\n\n    const l = this.getLength();\n\n    const dy = this.end.y - this.begin.y;\n    const dx = this.end.x - this.begin.x;\n    const distance = Math.abs(dy * x0 - dx * y0 + this.end.x * this.begin.y - this.end.y * this.begin.x) / l;\n    return distance;\n  }\n\n  /**\n   * Find the perpendicular line from the line to a point\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\n   * (a - p) - ((a - p) * n)n\n   * a is a point on the line\n   * p is the arbitrary point above the line\n   * n is a unit vector in direction of the line\n   * @param point\n   */\n  public findVectorToPoint(point: Vector): Vector {\n    const aMinusP = this.begin.sub(point);\n    const n = this.getSlope();\n\n    return aMinusP.sub(n.scale(aMinusP.dot(n)));\n  }\n\n  /**\n   * Finds a point on the line given only an X or a Y value. Given an X value, the function returns\n   * a new point with the calculated Y value and vice-versa.\n   *\n   * @param x The known X value of the target point\n   * @param y The known Y value of the target point\n   * @returns A new point with the other calculated axis value\n   */\n  public findPoint(x: number = null, y: number = null): Vector {\n    const m = this.slope;\n    const b = this.intercept;\n\n    if (x !== null) {\n      return new Vector(x, m * x + b);\n    } else if (y !== null) {\n      return new Vector((y - b) / m, y);\n    } else {\n      throw new Error('You must provide an X or a Y value');\n    }\n  }\n\n  /**\n   * Whether or not the given point lies on this line. This method is precise by default\n   * meaning the point must lie exactly on the line. Adjust threshold to\n   * loosen the strictness of the check for floating-point calculations.\n   */\n  public hasPoint(x: number, y: number, threshold?: number): boolean;\n\n  /**\n   * Whether or not the given point lies on this line. This method is precise by default\n   * meaning the point must lie exactly on the line. Adjust threshold to\n   * loosen the strictness of the check for floating-point calculations.\n   */\n  public hasPoint(v: Vector, threshold?: number): boolean;\n\n  /**\n   * @see http://stackoverflow.com/a/11908158/109458\n   */\n  public hasPoint(): boolean {\n    let currPoint: Vector;\n    let threshold = 0;\n\n    if (typeof arguments[0] === 'number' && typeof arguments[1] === 'number') {\n      currPoint = new Vector(arguments[0], arguments[1]);\n      threshold = arguments[2] || 0;\n    } else if (arguments[0] instanceof Vector) {\n      currPoint = arguments[0];\n      threshold = arguments[1] || 0;\n    } else {\n      throw 'Could not determine the arguments for Vector.hasPoint';\n    }\n\n    const dxc = currPoint.x - this.begin.x;\n    const dyc = currPoint.y - this.begin.y;\n\n    const dx1 = this.end.x - this.begin.x;\n    const dy1 = this.end.y - this.begin.y;\n\n    const cross = dxc * dy1 - dyc * dx1;\n\n    // check whether point lines on the line\n    if (Math.abs(cross) > threshold) {\n      return false;\n    }\n\n    // check whether point lies in-between start and end\n    if (Math.abs(dx1) >= Math.abs(dy1)) {\n      return dx1 > 0 ? this.begin.x <= currPoint.x && currPoint.x <= this.end.x : this.end.x <= currPoint.x && currPoint.x <= this.begin.x;\n    } else {\n      return dy1 > 0 ? this.begin.y <= currPoint.y && currPoint.y <= this.end.y : this.end.y <= currPoint.y && currPoint.y <= this.begin.y;\n    }\n  }\n}\n\n/**\n * A 1 dimensional projection on an axis, used to test overlaps\n */\nexport class Projection {\n  constructor(public min: number, public max: number) {}\n  public overlaps(projection: Projection): boolean {\n    return this.max > projection.min && projection.max > this.min;\n  }\n\n  public getOverlap(projection: Projection): number {\n    if (this.overlaps(projection)) {\n      if (this.max > projection.max) {\n        return projection.max - this.min;\n      } else {\n        return this.max - projection.min;\n      }\n    }\n    return 0;\n  }\n}\n\nexport class GlobalCoordinates {\n  public static fromPagePosition(x: number, y: number, engine: Engine): GlobalCoordinates;\n  public static fromPagePosition(pos: Vector, engine: Engine): GlobalCoordinates;\n  public static fromPagePosition(xOrPos: number | Vector, yOrEngine: number | Engine, engineOrUndefined?: Engine): GlobalCoordinates {\n    let pageX: number;\n    let pageY: number;\n    let pagePos: Vector;\n    let engine: Engine;\n\n    if (arguments.length === 3) {\n      pageX = <number>xOrPos;\n      pageY = <number>yOrEngine;\n      pagePos = new Vector(pageX, pageY);\n      engine = engineOrUndefined;\n    } else {\n      pagePos = <Vector>xOrPos;\n      pageX = pagePos.x;\n      pageY = pagePos.y;\n      engine = <Engine>yOrEngine;\n    }\n\n    const screenX: number = pageX - Util.getPosition(engine.canvas).x;\n    const screenY: number = pageY - Util.getPosition(engine.canvas).y;\n    const screenPos = new Vector(screenX, screenY);\n    const worldPos = engine.screenToWorldCoordinates(screenPos);\n\n    return new GlobalCoordinates(worldPos, pagePos, screenPos);\n  }\n\n  constructor(public worldPos: Vector, public pagePos: Vector, public screenPos: Vector) {}\n}\n\n/**\n * Shorthand for creating new Vectors - returns a new Vector instance with the\n * provided X and Y components.\n *\n * @param x  X component of the Vector\n * @param y  Y component of the Vector\n */\nexport function vec(x: number, y: number): Vector {\n  return new Vector(x, y);\n}\n","import { Scene } from './Scene';\nimport { Vector } from './Algebra';\nimport { Actor } from './Actor';\nimport { Trigger } from './Trigger';\nimport { FrameStats } from './Debug';\nimport { Engine } from './Engine';\nimport { TileMap } from './TileMap';\nimport { Side } from './Collision/Side';\nimport * as Input from './Input/Index';\nimport { Pair, Camera } from './index';\nimport { Collider } from './Collision/Collider';\n\nexport enum EventTypes {\n  Kill = 'kill',\n  PreKill = 'prekill',\n  PostKill = 'postkill',\n\n  PreDraw = 'predraw',\n  PostDraw = 'postdraw',\n\n  PreDebugDraw = 'predebugdraw',\n  PostDebugDraw = 'postdebugdraw',\n\n  PreUpdate = 'preupdate',\n  PostUpdate = 'postupdate',\n\n  PreFrame = 'preframe',\n  PostFrame = 'postframe',\n\n  PreCollision = 'precollision',\n  CollisionStart = 'collisionstart',\n  CollisionEnd = 'collisionend',\n  PostCollision = 'postcollision',\n\n  Initialize = 'initialize',\n  Activate = 'activate',\n  Deactivate = 'deactivate',\n\n  ExitViewport = 'exitviewport',\n  EnterViewport = 'enterviewport',\n\n  ExitTrigger = 'exit',\n  EnterTrigger = 'enter',\n\n  Connect = 'connect',\n  Disconnect = 'disconnect',\n  Button = 'button',\n  Axis = 'axis',\n\n  Subscribe = 'subscribe',\n  Unsubscribe = 'unsubscribe',\n\n  Visible = 'visible',\n  Hidden = 'hidden',\n  Start = 'start',\n  Stop = 'stop',\n\n  PointerUp = 'pointerup',\n  PointerDown = 'pointerdown',\n  PointerMove = 'pointermove',\n  PointerEnter = 'pointerenter',\n  PointerLeave = 'pointerleave',\n  PointerCancel = 'pointercancel',\n  PointerWheel = 'pointerwheel',\n\n  Up = 'up',\n  Down = 'down',\n  Move = 'move',\n  Enter = 'enter',\n  Leave = 'leave',\n  Cancel = 'cancel',\n  Wheel = 'wheel',\n\n  Press = 'press',\n  Release = 'release',\n  Hold = 'hold',\n\n  PointerDragStart = 'pointerdragstart',\n  PointerDragEnd = 'pointerdragend',\n  PointerDragEnter = 'pointerdragenter',\n  PointerDragLeave = 'pointerdragleave',\n  PointerDragMove = 'pointerdragmove'\n}\n\n/* istanbul ignore next */\n/* compiler only: these are internal to lib */\nexport type kill = 'kill';\nexport type prekill = 'prekill';\nexport type postkill = 'postkill';\n\nexport type predraw = 'predraw';\nexport type postdraw = 'postdraw';\n\nexport type predebugdraw = 'predebugdraw';\nexport type postdebugdraw = 'postdebugdraw';\n\nexport type preupdate = 'preupdate';\nexport type postupdate = 'postupdate';\n\nexport type preframe = 'preframe';\nexport type postframe = 'postframe';\n\nexport type precollision = 'precollision';\nexport type collisionstart = 'collisionstart';\nexport type collisionend = 'collisionend';\nexport type postcollision = 'postcollision';\n\nexport type initialize = 'initialize';\nexport type activate = 'activate';\nexport type deactivate = 'deactivate';\n\nexport type exitviewport = 'exitviewport';\nexport type enterviewport = 'enterviewport';\n\nexport type exittrigger = 'exit';\nexport type entertrigger = 'enter';\n\nexport type connect = 'connect';\nexport type disconnect = 'disconnect';\nexport type button = 'button';\nexport type axis = 'axis';\n\nexport type subscribe = 'subscribe';\nexport type unsubscribe = 'unsubscribe';\n\nexport type visible = 'visible';\nexport type hidden = 'hidden';\nexport type start = 'start';\nexport type stop = 'stop';\n\nexport type pointerup = 'pointerup';\nexport type pointerdown = 'pointerdown';\nexport type pointermove = 'pointermove';\nexport type pointerenter = 'pointerenter';\nexport type pointerleave = 'pointerleave';\nexport type pointercancel = 'pointercancel';\nexport type pointerwheel = 'pointerwheel';\n\nexport type up = 'up';\nexport type down = 'down';\nexport type move = 'move';\nexport type enter = 'enter';\nexport type leave = 'leave';\nexport type cancel = 'cancel';\nexport type wheel = 'wheel';\n\nexport type press = 'press';\nexport type release = 'release';\nexport type hold = 'hold';\n\nexport type pointerdragstart = 'pointerdragstart';\nexport type pointerdragend = 'pointerdragend';\nexport type pointerdragenter = 'pointerdragenter';\nexport type pointerdragleave = 'pointerdragleave';\nexport type pointerdragmove = 'pointerdragmove';\n\n/**\n * Base event type in Excalibur that all other event types derive from. Not all event types are thrown on all Excalibur game objects,\n * some events are unique to a type, others are not.\n *\n */\nexport class GameEvent<T, U = T> {\n  /**\n   * Target object for this event.\n   */\n  public target: T;\n\n  /**\n   * Other target object for this event\n   */\n  public other: U | null;\n\n  /**\n   * If set to false, prevents event from propagating to other actors. If true it will be propagated\n   * to all actors that apply.\n   */\n  public bubbles: boolean = true;\n\n  /**\n   * Prevents event from bubbling\n   */\n  public stopPropagation() {\n    this.bubbles = false;\n  }\n}\n\n/**\n * The 'kill' event is emitted on actors when it is killed. The target is the actor that was killed.\n */\nexport class KillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'prekill' event is emitted directly before an actor is killed.\n */\nexport class PreKillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'postkill' event is emitted directly after the actor is killed.\n */\nexport class PostKillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'start' event is emitted on engine when has started and is ready for interaction.\n */\nexport class GameStartEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * The 'stop' event is emitted on engine when has been stopped and will no longer take input, update or draw.\n */\nexport class GameStopEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * The 'predraw' event is emitted on actors, scenes, and engine before drawing starts. Actors' predraw happens inside their graphics\n * transform so that all drawing takes place with the actor as the origin.\n *\n */\nexport class PreDrawEvent extends GameEvent<Actor | Scene | Engine | TileMap> {\n  constructor(public ctx: CanvasRenderingContext2D, public delta: number, public target: Actor | Scene | Engine | TileMap) {\n    super();\n  }\n}\n\n/**\n * The 'postdraw' event is emitted on actors, scenes, and engine after drawing finishes. Actors' postdraw happens inside their graphics\n * transform so that all drawing takes place with the actor as the origin.\n *\n */\nexport class PostDrawEvent extends GameEvent<Actor | Scene | Engine | TileMap> {\n  constructor(public ctx: CanvasRenderingContext2D, public delta: number, public target: Actor | Scene | Engine | TileMap) {\n    super();\n  }\n}\n\n/**\n * The 'predebugdraw' event is emitted on actors, scenes, and engine before debug drawing starts.\n */\nexport class PreDebugDrawEvent extends GameEvent<Actor | Scene | Engine> {\n  constructor(public ctx: CanvasRenderingContext2D, public target: Actor | Scene | Engine) {\n    super();\n  }\n}\n\n/**\n * The 'postdebugdraw' event is emitted on actors, scenes, and engine after debug drawing starts.\n */\nexport class PostDebugDrawEvent extends GameEvent<Actor | Scene | Engine> {\n  constructor(public ctx: CanvasRenderingContext2D, public target: Actor | Scene | Engine) {\n    super();\n  }\n}\n\n/**\n * The 'preupdate' event is emitted on actors, scenes, camera, and engine before the update starts.\n */\nexport class PreUpdateEvent extends GameEvent<Actor | Scene | Engine | TileMap | Camera> {\n  constructor(public engine: Engine, public delta: number, public target: Actor | Scene | Engine | TileMap | Camera) {\n    super();\n  }\n}\n\n/**\n * The 'postupdate' event is emitted on actors, scenes, camera, and engine after the update ends.\n */\nexport class PostUpdateEvent extends GameEvent<Actor | Scene | Engine | TileMap | Camera> {\n  constructor(public engine: Engine, public delta: number, public target: Actor | Scene | Engine | TileMap | Camera) {\n    super();\n  }\n}\n\n/**\n * The 'preframe' event is emitted on the engine, before the frame begins.\n */\nexport class PreFrameEvent extends GameEvent<Engine> {\n  constructor(public engine: Engine, public prevStats: FrameStats) {\n    super();\n    this.target = engine;\n  }\n}\n\n/**\n * The 'postframe' event is emitted on the engine, after a frame ends.\n */\nexport class PostFrameEvent extends GameEvent<Engine> {\n  constructor(public engine: Engine, public stats: FrameStats) {\n    super();\n    this.target = engine;\n  }\n}\n\n/**\n * Event received when a gamepad is connected to Excalibur. [[Gamepads]] receives this event.\n */\nexport class GamepadConnectEvent extends GameEvent<Input.Gamepad> {\n  constructor(public index: number, public gamepad: Input.Gamepad) {\n    super();\n    this.target = gamepad;\n  }\n}\n\n/**\n * Event received when a gamepad is disconnected from Excalibur. [[Gamepads]] receives this event.\n */\nexport class GamepadDisconnectEvent extends GameEvent<Input.Gamepad> {\n  constructor(public index: number, public gamepad: Input.Gamepad) {\n    super();\n    this.target = gamepad;\n  }\n}\n\n/**\n * Gamepad button event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\n */\nexport class GamepadButtonEvent extends GameEvent<Input.Gamepad> {\n  /**\n   * @param button  The Gamepad button\n   * @param value   A numeric value between 0 and 1\n   */\n  constructor(public button: Input.Buttons, public value: number, public target: Input.Gamepad) {\n    super();\n  }\n}\n\n/**\n * Gamepad axis event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\n */\nexport class GamepadAxisEvent extends GameEvent<Input.Gamepad> {\n  /**\n   * @param axis  The Gamepad axis\n   * @param value A numeric value between -1 and 1\n   */\n  constructor(public axis: Input.Axes, public value: number, public target: Input.Gamepad) {\n    super();\n  }\n}\n\n/**\n * Subscribe event thrown when handlers for events other than subscribe are added. Meta event that is received by\n * [[EventDispatcher|event dispatchers]].\n */\nexport class SubscribeEvent<T> extends GameEvent<T> {\n  constructor(public topic: string, public handler: (event: GameEvent<T>) => void) {\n    super();\n  }\n}\n\n/**\n * Unsubscribe event thrown when handlers for events other than unsubscribe are removed. Meta event that is received by\n * [[EventDispatcher|event dispatchers]].\n */\nexport class UnsubscribeEvent<T> extends GameEvent<T> {\n  constructor(public topic: string, public handler: (event: GameEvent<T>) => void) {\n    super();\n  }\n}\n\n/**\n * Event received by the [[Engine]] when the browser window is visible on a screen.\n */\nexport class VisibleEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * Event received by the [[Engine]] when the browser window is hidden from all screens.\n */\nexport class HiddenEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor|actor]] when a collision will occur this frame if it resolves\n */\nexport class PreCollisionEvent<T extends Collider | Actor = Actor> extends GameEvent<T> {\n  /**\n   * @param actor         The actor the event was thrown on\n   * @param other         The actor that will collided with the current actor\n   * @param side          The side that will be collided with the current actor\n   * @param intersection  Intersection vector\n   */\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown on an [[Actor|actor]] when a collision has been resolved (body reacted) this frame\n */\nexport class PostCollisionEvent<T extends Collider | Actor = Actor> extends GameEvent<T> {\n  /**\n   * @param actor         The actor the event was thrown on\n   * @param other         The actor that did collide with the current actor\n   * @param side          The side that did collide with the current actor\n   * @param intersection  Intersection vector\n   */\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown the first time an [[Actor|actor]] collides with another, after an actor is in contact normal collision events are fired.\n */\nexport class CollisionStartEvent<T extends Collider | Actor = Actor> extends GameEvent<T> {\n  /**\n   *\n   * @param actor\n   * @param other\n   * @param pair\n   */\n  constructor(actor: T, public other: T, public pair: Pair) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown when the [[Actor|actor]] is no longer colliding with another\n */\nexport class CollisionEndEvent<T extends Collider | Actor = Actor> extends GameEvent<T> {\n  /**\n   *\n   */\n  constructor(actor: T, public other: T) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] and a [[Scene]] only once before the first update call\n */\nexport class InitializeEvent extends GameEvent<Actor | Scene | Engine | Camera> {\n  /**\n   * @param engine  The reference to the current engine\n   */\n  constructor(public engine: Engine, public target: Actor | Scene | Engine | Camera) {\n    super();\n  }\n}\n\n/**\n * Event thrown on a [[Scene]] on activation\n */\nexport class ActivateEvent extends GameEvent<Scene> {\n  /**\n   * @param oldScene  The reference to the old scene\n   */\n  constructor(public oldScene: Scene, public target: Scene) {\n    super();\n  }\n}\n\n/**\n * Event thrown on a [[Scene]] on deactivation\n */\nexport class DeactivateEvent extends GameEvent<Scene> {\n  /**\n   * @param newScene  The reference to the new scene\n   */\n  constructor(public newScene: Scene, public target: Scene) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] when it completely leaves the screen.\n */\nexport class ExitViewPortEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] when it completely leaves the screen.\n */\nexport class EnterViewPortEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\nexport class EnterTriggerEvent extends GameEvent<Actor> {\n  constructor(public target: Trigger, public actor: Actor) {\n    super();\n  }\n}\n\nexport class ExitTriggerEvent extends GameEvent<Actor> {\n  constructor(public target: Trigger, public actor: Actor) {\n    super();\n  }\n}\n","import { GameEvent, SubscribeEvent, UnsubscribeEvent } from './Events';\nimport { Eventable } from './Interfaces/Evented';\n\n/**\n * Excalibur's internal event dispatcher implementation.\n * Callbacks are fired immediately after an event is published.\n * Typically you will use [[Class.eventDispatcher]] since most classes in\n * Excalibur inherit from [[Class]]. You will rarely create an `EventDispatcher`\n * yourself.\n *\n * [[include:Events.md]]\n */\nexport class EventDispatcher<T = any> implements Eventable {\n  private _handlers: { [key: string]: { (event: GameEvent<T>): void }[] } = {};\n  private _wiredEventDispatchers: Eventable[] = [];\n\n  private _target: T;\n\n  /**\n   * @param target  The object that will be the recipient of events from this event dispatcher\n   */\n  constructor(target: T) {\n    this._target = target;\n  }\n\n  /**\n   * Clears any existing handlers or wired event dispatchers on this event dispatcher\n   */\n  public clear() {\n    this._handlers = {};\n    this._wiredEventDispatchers = [];\n  }\n\n  /**\n   * Emits an event for target\n   * @param eventName  The name of the event to publish\n   * @param event      Optionally pass an event data object to the handler\n   */\n  public emit(eventName: string, event: GameEvent<T>) {\n    if (!eventName) {\n      // key not mapped\n      return;\n    }\n    eventName = eventName.toLowerCase();\n    const target = this._target;\n    if (!event) {\n      event = new GameEvent();\n    }\n    event.target = target;\n\n    let i: number, len: number;\n\n    if (this._handlers[eventName]) {\n      i = 0;\n      len = this._handlers[eventName].length;\n\n      for (i; i < len; i++) {\n        this._handlers[eventName][i].call(target, event);\n      }\n    }\n\n    i = 0;\n    len = this._wiredEventDispatchers.length;\n\n    for (i; i < len; i++) {\n      this._wiredEventDispatchers[i].emit(eventName, event);\n    }\n  }\n\n  /**\n   * Subscribe an event handler to a particular event name, multiple handlers per event name are allowed.\n   * @param eventName  The name of the event to subscribe to\n   * @param handler    The handler callback to fire on this event\n   */\n  public on(eventName: string, handler: (event: GameEvent<T>) => void) {\n    eventName = eventName.toLowerCase();\n    if (!this._handlers[eventName]) {\n      this._handlers[eventName] = [];\n    }\n    this._handlers[eventName].push(handler);\n\n    // meta event handlers\n    if (eventName !== 'unsubscribe' && eventName !== 'subscribe') {\n      this.emit('subscribe', new SubscribeEvent(eventName, handler));\n    }\n  }\n\n  /**\n   * Unsubscribe an event handler(s) from an event. If a specific handler\n   * is specified for an event, only that handler will be unsubscribed.\n   * Otherwise all handlers will be unsubscribed for that event.\n   *\n   * @param eventName  The name of the event to unsubscribe\n   * @param handler    Optionally the specific handler to unsubscribe\n   *\n   */\n  public off(eventName: string, handler?: (event: GameEvent<T>) => void) {\n    eventName = eventName.toLowerCase();\n    const eventHandlers = this._handlers[eventName];\n\n    if (eventHandlers) {\n      // if no explicit handler is give with the event name clear all handlers\n      if (!handler) {\n        this._handlers[eventName].length = 0;\n      } else {\n        const index = eventHandlers.indexOf(handler);\n        this._handlers[eventName].splice(index, 1);\n      }\n    }\n    // meta event handlers\n    if (eventName !== 'unsubscribe' && eventName !== 'subscribe') {\n      this.emit('unsubscribe', new UnsubscribeEvent(eventName, handler));\n    }\n  }\n\n  /**\n   * Once listens to an event one time, then unsubscribes from that event\n   *\n   * @param eventName The name of the event to subscribe to once\n   * @param handler   The handler of the event that will be auto unsubscribed\n   */\n  public once(eventName: string, handler: (event: GameEvent<T>) => void) {\n    const metaHandler = (event: GameEvent<T>) => {\n      const ev = event || new GameEvent();\n      ev.target = ev.target || this._target;\n\n      this.off(eventName, handler);\n      handler.call(ev.target, ev);\n    };\n\n    this.on(eventName, metaHandler);\n  }\n\n  /**\n   * Wires this event dispatcher to also receive events from another\n   */\n  public wire(eventDispatcher: EventDispatcher): void {\n    eventDispatcher._wiredEventDispatchers.push(this);\n  }\n\n  /**\n   * Unwires this event dispatcher from another\n   */\n  public unwire(eventDispatcher: EventDispatcher): void {\n    const index = eventDispatcher._wiredEventDispatchers.indexOf(this);\n    if (index > -1) {\n      eventDispatcher._wiredEventDispatchers.splice(index, 1);\n    }\n  }\n}\n","import { GameEvent } from './Events';\nimport { EventDispatcher } from './EventDispatcher';\nimport { Eventable } from './Interfaces/Evented';\n\n/**\n * Excalibur base class that provides basic functionality such as [[EventDispatcher]]\n * and extending abilities for vanilla Javascript projects\n */\nexport class Class implements Eventable {\n  /**\n   * Direct access to the game object event dispatcher.\n   */\n  public eventDispatcher: EventDispatcher;\n\n  constructor() {\n    this.eventDispatcher = new EventDispatcher(this);\n  }\n\n  /**\n   * Alias for `addEventListener`. You can listen for a variety of\n   * events off of the engine; see the events section below for a complete list.\n   * @param eventName  Name of the event to listen for\n   * @param handler    Event handler for the thrown event\n   */\n  public on(eventName: string, handler: (event: GameEvent<any>) => void) {\n    this.eventDispatcher.on(eventName, handler);\n  }\n\n  /**\n   * Alias for `removeEventListener`. If only the eventName is specified\n   * it will remove all handlers registered for that specific event. If the eventName\n   * and the handler instance are specified only that handler will be removed.\n   *\n   * @param eventName  Name of the event to listen for\n   * @param handler    Event handler for the thrown event\n   */\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void) {\n    this.eventDispatcher.off(eventName, handler);\n  }\n\n  /**\n   * Emits a new event\n   * @param eventName   Name of the event to emit\n   * @param eventObject Data associated with this event\n   */\n  public emit(eventName: string, eventObject: GameEvent<any>) {\n    this.eventDispatcher.emit(eventName, eventObject);\n  }\n\n  /**\n   * Once listens to an event one time, then unsubscribes from that event\n   *\n   * @param eventName The name of the event to subscribe to once\n   * @param handler   The handler of the event that will be auto unsubscribed\n   */\n  public once(eventName: string, handler: (event: GameEvent<any>) => void) {\n    this.eventDispatcher.once(eventName, handler);\n  }\n}\n","import { Loadable } from '../Interfaces/Loadable';\nimport { Class } from '../Class';\nimport { Engine } from '../Engine';\nimport { Promise } from '../Promises';\nimport { Logger } from '../Util/Log';\n\n/**\n * The [[Resource]] type allows games built in Excalibur to load generic resources.\n * For any type of remote resource it is recommended to use [[Resource]] for preloading.\n *\n * [[include:Resources.md]]\n */\nexport class Resource<T> extends Class implements Loadable {\n  public data: T = null;\n  public logger: Logger = Logger.getInstance();\n  public arrayBuffer: ArrayBuffer = null;\n\n  /**\n   * @param path          Path to the remote resource\n   * @param responseType  The type to expect as a response: \"\" | \"arraybuffer\" | \"blob\" | \"document\" | \"json\" | \"text\";\n   * @param bustCache     Whether or not to cache-bust requests\n   */\n  constructor(\n    public path: string,\n    public responseType: '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text',\n    public bustCache: boolean = true\n  ) {\n    super();\n  }\n\n  /**\n   * Returns true if the Resource is completely loaded and is ready\n   * to be drawn.\n   */\n  public isLoaded(): boolean {\n    return this.data !== null;\n  }\n\n  public wireEngine(_engine: Engine) {\n    // override me\n  }\n\n  private _cacheBust(uri: string): string {\n    const query: RegExp = /\\?\\w*=\\w*/;\n    if (query.test(uri)) {\n      uri += '&__=' + Date.now();\n    } else {\n      uri += '?__=' + Date.now();\n    }\n    return uri;\n  }\n\n  private _start() {\n    this.logger.debug('Started loading resource ' + this.path);\n  }\n\n  /**\n   * Begin loading the resource and returns a promise to be resolved on completion\n   */\n  public load(): Promise<T> {\n    const complete = new Promise<T>();\n\n    // Exit early if we already have data\n    if (this.data !== null) {\n      this.logger.debug('Already have data for resource', this.path);\n      complete.resolve(this.data);\n      this.oncomplete();\n      return complete;\n    }\n\n    const request = new XMLHttpRequest();\n    request.open('GET', this.bustCache ? this._cacheBust(this.path) : this.path, true);\n    request.responseType = this.responseType;\n    request.onloadstart = () => {\n      this._start();\n    };\n    request.onprogress = this.onprogress;\n    request.onerror = this.onerror;\n    request.onload = () => {\n      // XHR on file:// success status is 0, such as with PhantomJS\n      if (request.status !== 0 && request.status !== 200) {\n        this.logger.error('Failed to load resource ', this.path, ' server responded with error code', request.status);\n        this.onerror(request.response);\n        complete.resolve(request.response);\n        return;\n      }\n\n      this.data = this.processData(request.response);\n\n      this.oncomplete();\n      this.logger.debug('Completed loading resource', this.path);\n      complete.resolve(this.data);\n    };\n    request.send();\n    return complete;\n  }\n\n  /**\n   * Returns the loaded data once the resource is loaded\n   */\n  public getData(): any {\n    return this.data;\n  }\n\n  public getArrayData(): any {\n    return this.arrayBuffer;\n  }\n\n  /**\n   * Sets the data for this resource directly\n   */\n  public setData(data: any) {\n    this.data = this.processData(data);\n  }\n\n  /**\n   * This method is meant to be overridden to handle any additional\n   * processing. Such as decoding downloaded audio bits.\n   */\n  public processData(data: T): any {\n    // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseType\n    // Blob requires an object url\n    if (this.responseType === 'blob') {\n      return URL.createObjectURL(data);\n    }\n    return data;\n  }\n\n  public onprogress: (e: any) => void = () => {\n    return;\n  };\n\n  public oncomplete: () => void = () => {\n    return;\n  };\n\n  public onerror: (e: any) => void = () => {\n    return;\n  };\n}\n","import { obsolete } from '../Util/Decorators';\n\n/**\n * Provides standard colors (e.g. [[Color.Black]])\n * but you can also create custom colors using RGB, HSL, or Hex. Also provides\n * useful color operations like [[Color.lighten]], [[Color.darken]], and more.\n *\n * [[include:Colors.md]]\n */\nexport class Color {\n  /**\n   * Red channel\n   */\n  public r: number;\n  /**\n   * Green channel\n   */\n  public g: number;\n  /**\n   * Blue channel\n   */\n  public b: number;\n  /**\n   * Alpha channel (between 0 and 1)\n   */\n  public a: number;\n\n  /**\n   * Hue\n   */\n  public h: number;\n  /**\n   * Saturation\n   */\n  public s: number;\n  /**\n   * Lightness\n   */\n  public l: number;\n\n  /**\n   * Creates a new instance of Color from an r, g, b, a\n   *\n   * @param r  The red component of color (0-255)\n   * @param g  The green component of color (0-255)\n   * @param b  The blue component of color (0-255)\n   * @param a  The alpha component of color (0-1.0)\n   */\n  constructor(r: number, g: number, b: number, a?: number) {\n    this.r = r;\n    this.g = g;\n    this.b = b;\n    this.a = a != null ? a : 1;\n  }\n\n  /**\n   * Creates a new instance of Color from an r, g, b, a\n   *\n   * @param r  The red component of color (0-255)\n   * @param g  The green component of color (0-255)\n   * @param b  The blue component of color (0-255)\n   * @param a  The alpha component of color (0-1.0)\n   */\n  public static fromRGB(r: number, g: number, b: number, a?: number): Color {\n    return new Color(r, g, b, a);\n  }\n\n  /**\n   * Creates a new instance of Color from a hex string\n   *\n   * @param hex  CSS color string of the form #ffffff, the alpha component is optional\n   */\n  public static fromHex(hex: string): Color {\n    const hexRegEx: RegExp = /^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;\n    let match = null;\n    if ((match = hex.match(hexRegEx))) {\n      const r = parseInt(match[1], 16);\n      const g = parseInt(match[2], 16);\n      const b = parseInt(match[3], 16);\n      let a = 1;\n      if (match[4]) {\n        a = parseInt(match[4], 16) / 255;\n      }\n      return new Color(r, g, b, a);\n    } else {\n      throw new Error('Invalid hex string: ' + hex);\n    }\n  }\n\n  /**\n   * Creates a new instance of Color from hsla values\n   *\n   * @param h  Hue is represented [0-1]\n   * @param s  Saturation is represented [0-1]\n   * @param l  Luminance is represented [0-1]\n   * @param a  Alpha is represented [0-1]\n   */\n  public static fromHSL(h: number, s: number, l: number, a: number = 1.0): Color {\n    const temp = new HSLColor(h, s, l, a);\n    return temp.toRGBA();\n  }\n\n  /**\n   * Lightens the current color by a specified amount\n   *\n   * @param factor  The amount to lighten by [0-1]\n   */\n  public lighten(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.l += (1 - temp.l) * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Darkens the current color by a specified amount\n   *\n   * @param factor  The amount to darken by [0-1]\n   */\n  public darken(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.l -= temp.l * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Saturates the current color by a specified amount\n   *\n   * @param factor  The amount to saturate by [0-1]\n   */\n  public saturate(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.s += temp.s * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Desaturates the current color by a specified amount\n   *\n   * @param factor  The amount to desaturate by [0-1]\n   */\n  public desaturate(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.s -= temp.s * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Multiplies a color by another, results in a darker color\n   *\n   * @param color  The other color\n   */\n  public multiply(color: Color): Color {\n    const newR = (((color.r / 255) * this.r) / 255) * 255;\n    const newG = (((color.g / 255) * this.g) / 255) * 255;\n    const newB = (((color.b / 255) * this.b) / 255) * 255;\n    const newA = color.a * this.a;\n    return new Color(newR, newG, newB, newA);\n  }\n\n  /**\n   * Multiplies a color by another, results in a darker color\n   * @param color\n   * @obsolete Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0\n   */\n  @obsolete({ message: 'Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0' })\n  public mulitiply(color: Color): Color {\n    return this.multiply(color);\n  }\n\n  /**\n   * Screens a color by another, results in a lighter color\n   *\n   * @param color  The other color\n   */\n  public screen(color: Color): Color {\n    const color1 = color.invert();\n    const color2 = color.invert();\n    return color1.multiply(color2).invert();\n  }\n\n  /**\n   * Inverts the current color\n   */\n  public invert(): Color {\n    return new Color(255 - this.r, 255 - this.g, 255 - this.b, 1.0 - this.a);\n  }\n\n  /**\n   * Averages the current color with another\n   *\n   * @param color  The other color\n   */\n  public average(color: Color): Color {\n    const newR = (color.r + this.r) / 2;\n    const newG = (color.g + this.g) / 2;\n    const newB = (color.b + this.b) / 2;\n    const newA = (color.a + this.a) / 2;\n    return new Color(newR, newG, newB, newA);\n  }\n\n  /**\n   * Returns a CSS string representation of a color.\n   *\n   * @param format Color representation, accepts: rgb, hsl, or hex\n   */\n  public toString(format: 'rgb' | 'hsl' | 'hex' = 'rgb') {\n    switch (format) {\n      case 'rgb':\n        return this.toRGBA();\n      case 'hsl':\n        return this.toHSLA();\n      case 'hex':\n        return this.toHex();\n      default:\n        throw new Error('Invalid Color format');\n    }\n  }\n\n  /**\n   * Returns Hex Value of a color component\n   * @param c color component\n   * @see https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb\n   */\n  private _componentToHex(c: number) {\n    const hex = c.toString(16);\n    return hex.length === 1 ? '0' + hex : hex;\n  }\n\n  /**\n   * Return Hex representation of a color.\n   */\n  public toHex() {\n    return '#' + this._componentToHex(this.r) + this._componentToHex(this.g) + this._componentToHex(this.b);\n  }\n\n  /**\n   * Return RGBA representation of a color.\n   */\n  public toRGBA() {\n    const result = String(this.r.toFixed(0)) + ', ' + String(this.g.toFixed(0)) + ', ' + String(this.b.toFixed(0));\n    if (this.a !== undefined || this.a !== null) {\n      return 'rgba(' + result + ', ' + String(this.a) + ')';\n    }\n    return 'rgb(' + result + ')';\n  }\n\n  /**\n   * Return HSLA representation of a color.\n   */\n  public toHSLA() {\n    return HSLColor.fromRGBA(this.r, this.g, this.b, this.a).toString();\n  }\n\n  /**\n   * Returns a CSS string representation of a color.\n   */\n  public fillStyle() {\n    return this.toString();\n  }\n\n  /**\n   * Returns a clone of the current color.\n   */\n  public clone(): Color {\n    return new Color(this.r, this.g, this.b, this.a);\n  }\n\n  /**\n   * Black (#000000)\n   */\n  public static get Black(): Color {\n    return Color.fromHex('#000000');\n  }\n\n  /**\n   * White (#FFFFFF)\n   */\n  public static get White(): Color {\n    return Color.fromHex('#FFFFFF');\n  }\n\n  /**\n   * Gray (#808080)\n   */\n  public static get Gray(): Color {\n    return Color.fromHex('#808080');\n  }\n\n  /**\n   * Light gray (#D3D3D3)\n   */\n  public static get LightGray(): Color {\n    return Color.fromHex('#D3D3D3');\n  }\n\n  /**\n   * Dark gray (#A9A9A9)\n   */\n  public static get DarkGray(): Color {\n    return Color.fromHex('#A9A9A9');\n  }\n\n  /**\n   * Yellow (#FFFF00)\n   */\n  public static get Yellow(): Color {\n    return Color.fromHex('#FFFF00');\n  }\n\n  /**\n   * Orange (#FFA500)\n   */\n  public static get Orange(): Color {\n    return Color.fromHex('#FFA500');\n  }\n\n  /**\n   * Red (#FF0000)\n   */\n  public static get Red(): Color {\n    return Color.fromHex('#FF0000');\n  }\n\n  /**\n   * Vermilion (#FF5B31)\n   */\n  public static get Vermilion(): Color {\n    return Color.fromHex('#FF5B31');\n  }\n\n  /**\n   * Vermilion (#FF5B31)\n   * @obsolete Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0\n   */\n  @obsolete({\n    message: 'Alias for incorrect spelling used in older versions',\n    alternateMethod: 'Vermilion'\n  })\n  public static get Vermillion(): Color {\n    return Color.Vermilion;\n  }\n\n  /**\n   * Rose (#FF007F)\n   */\n  public static get Rose(): Color {\n    return Color.fromHex('#FF007F');\n  }\n\n  /**\n   * Magenta (#FF00FF)\n   */\n  public static get Magenta(): Color {\n    return Color.fromHex('#FF00FF');\n  }\n\n  /**\n   * Violet (#7F00FF)\n   */\n  public static get Violet(): Color {\n    return Color.fromHex('#7F00FF');\n  }\n\n  /**\n   * Blue (#0000FF)\n   */\n  public static get Blue(): Color {\n    return Color.fromHex('#0000FF');\n  }\n\n  /**\n   * Azure (#007FFF)\n   */\n  public static get Azure(): Color {\n    return Color.fromHex('#007FFF');\n  }\n\n  /**\n   * Cyan (#00FFFF)\n   */\n  public static get Cyan(): Color {\n    return Color.fromHex('#00FFFF');\n  }\n\n  /**\n   * Viridian (#59978F)\n   */\n  public static get Viridian(): Color {\n    return Color.fromHex('#59978F');\n  }\n\n  /**\n   * Green (#00FF00)\n   */\n  public static get Green(): Color {\n    return Color.fromHex('#00FF00');\n  }\n\n  /**\n   * Chartreuse (#7FFF00)\n   */\n  public static get Chartreuse(): Color {\n    return Color.fromHex('#7FFF00');\n  }\n\n  /**\n   * Transparent (#FFFFFF00)\n   */\n  public static get Transparent(): Color {\n    return Color.fromHex('#FFFFFF00');\n  }\n}\n\n/**\n * Internal HSL Color representation\n *\n * http://en.wikipedia.org/wiki/HSL_and_HSV\n * http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c\n */\nclass HSLColor {\n  constructor(public h: number, public s: number, public l: number, public a: number) {}\n\n  public static hue2rgb(p: number, q: number, t: number): number {\n    if (t < 0) {\n      t += 1;\n    }\n    if (t > 1) {\n      t -= 1;\n    }\n    if (t < 1 / 6) {\n      return p + (q - p) * 6 * t;\n    }\n    if (t < 1 / 2) {\n      return q;\n    }\n    if (t < 2 / 3) {\n      return p + (q - p) * (2 / 3 - t) * 6;\n    }\n    return p;\n  }\n\n  public static fromRGBA(r: number, g: number, b: number, a: number): HSLColor {\n    r /= 255;\n    g /= 255;\n    b /= 255;\n    const max = Math.max(r, g, b),\n      min = Math.min(r, g, b);\n    let h, s;\n    const l = (max + min) / 2;\n\n    if (max === min) {\n      h = s = 0; // achromatic\n    } else {\n      const d = max - min;\n      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n      switch (max) {\n        case r:\n          h = (g - b) / d + (g < b ? 6 : 0);\n          break;\n        case g:\n          h = (b - r) / d + 2;\n          break;\n        case b:\n          h = (r - g) / d + 4;\n          break;\n      }\n      h /= 6;\n    }\n\n    return new HSLColor(h, s, l, a);\n  }\n\n  public toRGBA(): Color {\n    let r: number, g: number, b: number;\n\n    if (this.s === 0) {\n      r = g = b = this.l; // achromatic\n    } else {\n      const q = this.l < 0.5 ? this.l * (1 + this.s) : this.l + this.s - this.l * this.s;\n      const p = 2 * this.l - q;\n      r = HSLColor.hue2rgb(p, q, this.h + 1 / 3);\n      g = HSLColor.hue2rgb(p, q, this.h);\n      b = HSLColor.hue2rgb(p, q, this.h - 1 / 3);\n    }\n\n    return new Color(r * 255, g * 255, b * 255, this.a);\n  }\n\n  public toString(): string {\n    const h = this.h.toFixed(0),\n      s = this.s.toFixed(0),\n      l = this.l.toFixed(0),\n      a = this.a.toFixed(0);\n    return `hsla(${h}, ${s}, ${l}, ${a})`;\n  }\n}\n","/**\n * These effects can be applied to any bitmap image but are mainly used\n * for [[Sprite]] effects or [[Animation]] effects.\n *\n * [[include:SpriteEffects.md]]\n */\n\n/**\n * @typedoc\n */\n\nimport { Color } from './Color';\n\n/**\n * The interface that all sprite effects must implement\n */\nexport interface SpriteEffect {\n  /**\n   * Should update individual pixels values\n   * @param x          The pixel's x coordinate\n   * @param y          The pixel's y coordinate\n   * @param imageData  The sprite's raw pixel data\n   */\n  updatePixel(x: number, y: number, imageData: ImageData): void;\n}\n\n/**\n * Applies the \"Grayscale\" effect to a sprite, removing color information.\n */\nexport class Grayscale implements SpriteEffect {\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const avg = (pixel[firstPixel + 0] + pixel[firstPixel + 1] + pixel[firstPixel + 2]) / 3;\n    pixel[firstPixel + 0] = avg;\n    pixel[firstPixel + 1] = avg;\n    pixel[firstPixel + 2] = avg;\n  }\n}\n\n/**\n * Applies the \"Invert\" effect to a sprite, inverting the pixel colors.\n */\nexport class Invert implements SpriteEffect {\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    pixel[firstPixel + 0] = 255 - pixel[firstPixel + 0];\n    pixel[firstPixel + 1] = 255 - pixel[firstPixel + 1];\n    pixel[firstPixel + 2] = 255 - pixel[firstPixel + 2];\n  }\n}\n\n/**\n * Applies the \"Opacity\" effect to a sprite, setting the alpha of all pixels to a given value.\n */\nexport class Opacity implements SpriteEffect {\n  /**\n   * @param opacity  The new opacity of the sprite from 0-1.0\n   */\n  constructor(public opacity: number) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    if (pixel[firstPixel + 3] !== 0) {\n      pixel[firstPixel + 3] = Math.round(this.opacity * pixel[firstPixel + 3]);\n    }\n  }\n}\n\n/**\n * Applies the \"Colorize\" effect to a sprite, changing the color channels of all the pixels to an\n * average of the original color and the provided color\n */\nexport class Colorize implements SpriteEffect {\n  /**\n   * @param color  The color to apply to the sprite\n   */\n  constructor(public color: Color) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    if (pixel[firstPixel + 3] !== 0) {\n      pixel[firstPixel + 0] = (pixel[firstPixel + 0] + this.color.r) / 2;\n      pixel[firstPixel + 1] = (pixel[firstPixel + 1] + this.color.g) / 2;\n      pixel[firstPixel + 2] = (pixel[firstPixel + 2] + this.color.b) / 2;\n    }\n  }\n}\n\n/**\n * Applies the \"Lighten\" effect to a sprite, changes the lightness of the color according to HSL\n */\nexport class Lighten implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).lighten(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Darken\" effect to a sprite, changes the darkness of the color according to HSL\n */\nexport class Darken implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).darken(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Saturate\" effect to a sprite, saturates the color according to HSL\n */\nexport class Saturate implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).saturate(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Desaturate\" effect to a sprite, desaturates the color according to HSL\n */\nexport class Desaturate implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).desaturate(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Fill\" effect to a sprite, changing the color channels of all non-transparent pixels to match\n * a given color\n */\nexport class Fill implements SpriteEffect {\n  /**\n   * @param color  The color to apply to the sprite\n   */\n  constructor(public color: Color) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    if (pixel[firstPixel + 3] !== 0) {\n      pixel[firstPixel + 0] = this.color.r;\n      pixel[firstPixel + 1] = this.color.g;\n      pixel[firstPixel + 2] = this.color.b;\n    }\n  }\n}\n","export type Constructor<T> = {\n  new (...args: any[]): T;\n};\nexport function Configurable<T extends Constructor<{}>>(base: T): T {\n  return class extends base {\n    public assign(props: Partial<T>) {\n      //set the value of every property that was passed in,\n      //if the constructor previously set this value, it will be overridden here\n      for (const k in props) {\n        // eslint-disable-next-line\n        if (typeof (<any>this)[k] !== 'function') {\n          // eslint-disable-next-line\n          (<any>this)[k] = (<any>props)[k];\n        }\n      }\n    }\n\n    constructor(...args: any[]) {\n      super(...args);\n      //get the number of arguments that aren't undefined. TS passes a value to all parameters\n      //of whatever ctor is the implementation, so args.length doesn't work here.\n      const size = args.filter(function(value) {\n        return value !== undefined;\n      }).length;\n      if (size === 1 && args[0] && typeof args[0] === 'object' && !(args[0] instanceof Array)) {\n        this.assign(args[0]);\n      }\n    }\n  };\n}\n","/**\n * An enum that describes the strategies that rotation actions can use\n */\nexport enum RotationType {\n  /**\n   * Rotation via `ShortestPath` will use the smallest angle\n   * between the starting and ending points. This strategy is the default behavior.\n   */\n  ShortestPath = 0,\n  /**\n   * Rotation via `LongestPath` will use the largest angle\n   * between the starting and ending points.\n   */\n  LongestPath = 1,\n  /**\n   * Rotation via `Clockwise` will travel in a clockwise direction,\n   * regardless of the starting and ending points.\n   */\n  Clockwise = 2,\n  /**\n   * Rotation via `CounterClockwise` will travel in a counterclockwise direction,\n   * regardless of the starting and ending points.\n   */\n  CounterClockwise = 3\n}\n","import * as Effects from './SpriteEffects';\nimport { Color } from './Color';\n\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\nimport { Texture } from '../Resources/Texture';\nimport { Vector } from '../Algebra';\nimport { Logger } from '../Util/Log';\nimport { clamp, nullish } from '../Util/Util';\nimport { Configurable } from '../Configurable';\n\n/**\n * @hidden\n */\nexport class SpriteImpl implements Drawable {\n  private _texture: Texture;\n\n  public x: number = 0;\n  public y: number = 0;\n\n  public get drawWidth(): number {\n    return this.width * this.scale.x;\n  }\n\n  public get drawHeight(): number {\n    return this.height * this.scale.y;\n  }\n\n  public rotation: number = 0.0;\n  public anchor: Vector = new Vector(0.0, 0.0);\n  public offset: Vector = Vector.Zero;\n  public scale: Vector = Vector.One;\n\n  public logger: Logger = Logger.getInstance();\n\n  /**\n   * Draws the sprite flipped vertically\n   */\n  public flipVertical: boolean = false;\n\n  /**\n   * Draws the sprite flipped horizontally\n   */\n  public flipHorizontal: boolean = false;\n\n  public effects: Effects.SpriteEffect[] = [];\n\n  public width: number = 0;\n  public height: number = 0;\n\n  private _spriteCanvas: HTMLCanvasElement = null;\n  private _spriteCtx: CanvasRenderingContext2D = null;\n  private _pixelData: ImageData = null;\n  private _pixelsLoaded: boolean = false;\n  private _dirtyEffect: boolean = false;\n\n  /**\n   * @param image   The backing image texture to build the Sprite\n   * @param x      The x position of the sprite\n   * @param y      The y position of the sprite\n   * @param width  The width of the sprite in pixels\n   * @param height The height of the sprite in pixels\n   */\n  constructor(imageOrConfig: Texture | SpriteArgs, x: number, y: number, width: number, height: number) {\n    let image = imageOrConfig;\n    if (imageOrConfig && !(imageOrConfig instanceof Texture)) {\n      x = imageOrConfig.x | 0;\n      y = imageOrConfig.y | 0;\n      width = imageOrConfig.width | 0;\n      height = imageOrConfig.height | 0;\n      image = imageOrConfig.image;\n      if (!image) {\n        const message = 'An image texture is required to contsruct a sprite';\n        throw new Error(message);\n      }\n    }\n\n    this.x = x || 0;\n    this.y = y || 0;\n\n    this._texture = <Texture>image;\n    this._spriteCanvas = document.createElement('canvas');\n    this._spriteCanvas.width = width;\n    this._spriteCanvas.height = height;\n    this._spriteCtx = <CanvasRenderingContext2D>this._spriteCanvas.getContext('2d'); // eslint-disable-line\n    this._texture.loaded\n      .then(() => {\n        this.width = this.width || this._texture.image.naturalWidth;\n        this.height = this.height || this._texture.image.naturalHeight;\n        this._spriteCanvas.width = this._spriteCanvas.width || this._texture.image.naturalWidth;\n        this._spriteCanvas.height = this._spriteCanvas.height || this._texture.image.naturalHeight;\n        this._loadPixels();\n        this._dirtyEffect = true;\n      })\n      .error((e) => {\n        this.logger.error('Error loading texture ', this._texture.path, e);\n      });\n\n    this.width = width;\n    this.height = height;\n  }\n\n  private _loadPixels() {\n    if (this._texture.isLoaded() && !this._pixelsLoaded) {\n      const naturalWidth = this._texture.image.naturalWidth || 0;\n      const naturalHeight = this._texture.image.naturalHeight || 0;\n\n      if (this.width > naturalWidth) {\n        this.logger.warn(`The sprite width ${this.width} exceeds the width \n                              ${naturalWidth} of the backing texture ${this._texture.path}`);\n      }\n\n      if (this.width <= 0 || naturalWidth <= 0) {\n        throw new Error(`The width of a sprite cannot be 0 or negative, sprite width: ${this.width}, original width: ${naturalWidth}`);\n      }\n\n      if (this.height > naturalHeight) {\n        this.logger.warn(`The sprite height ${this.height} exceeds the height \n                              ${naturalHeight} of the backing texture ${this._texture.path}`);\n      }\n\n      if (this.height <= 0 || naturalHeight <= 0) {\n        throw new Error(`The height of a sprite cannot be 0 or negative, sprite height: ${this.height}, original height: ${naturalHeight}`);\n      }\n\n      this._spriteCtx.drawImage(\n        this._texture.image,\n        clamp(this.x, 0, naturalWidth),\n        clamp(this.y, 0, naturalHeight),\n        clamp(this.width, 0, naturalWidth),\n        clamp(this.height, 0, naturalHeight),\n        0,\n        0,\n        this.width,\n        this.height\n      );\n\n      this._pixelsLoaded = true;\n    }\n  }\n\n  private _opacity: number = 1;\n  /**\n   * Applies the [[Opacity]] effect to a sprite, setting the alpha of all pixels to a given value\n   */\n  public opacity(value: number) {\n    this._opacity = value;\n    // this.addEffect(new Effects.Opacity(value));\n  }\n\n  /**\n   * Applies the [[Grayscale]] effect to a sprite, removing color information.\n   */\n  public grayscale() {\n    this.addEffect(new Effects.Grayscale());\n  }\n\n  /**\n   * Applies the [[Invert]] effect to a sprite, inverting the pixel colors.\n   */\n  public invert() {\n    this.addEffect(new Effects.Invert());\n  }\n\n  /**\n   * Applies the [[Fill]] effect to a sprite, changing the color channels of all non-transparent pixels to match a given color\n   */\n  public fill(color: Color) {\n    this.addEffect(new Effects.Fill(color));\n  }\n\n  /**\n   * Applies the [[Colorize]] effect to a sprite, changing the color channels of all pixels to be the average of the original color\n   * and the provided color.\n   */\n  public colorize(color: Color) {\n    this.addEffect(new Effects.Colorize(color));\n  }\n\n  /**\n   * Applies the [[Lighten]] effect to a sprite, changes the lightness of the color according to HSL\n   */\n  public lighten(factor: number = 0.1) {\n    this.addEffect(new Effects.Lighten(factor));\n  }\n\n  /**\n   * Applies the [[Darken]] effect to a sprite, changes the darkness of the color according to HSL\n   */\n  public darken(factor: number = 0.1) {\n    this.addEffect(new Effects.Darken(factor));\n  }\n\n  /**\n   * Applies the [[Saturate]] effect to a sprite, saturates the color according to HSL\n   */\n  public saturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Saturate(factor));\n  }\n\n  /**\n   * Applies the [[Desaturate]] effect to a sprite, desaturates the color according to HSL\n   */\n  public desaturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Desaturate(factor));\n  }\n\n  /**\n   * Adds a new [[SpriteEffect]] to this drawing.\n   * @param effect  Effect to add to the this drawing\n   */\n  public addEffect(effect: Effects.SpriteEffect) {\n    this.effects.push(effect);\n    // We must check if the texture and the backing sprite pixels are loaded as well before\n    // an effect can be applied\n    if (!this._texture.isLoaded() || !this._pixelsLoaded) {\n      this._dirtyEffect = true;\n    } else {\n      this._applyEffects();\n    }\n  }\n\n  /**\n   * Removes a [[SpriteEffect]] from this sprite.\n   * @param effect  Effect to remove from this sprite\n   */\n  public removeEffect(effect: Effects.SpriteEffect): void;\n\n  /**\n   * Removes an effect given the index from this sprite.\n   * @param index  Index of the effect to remove from this sprite\n   */\n  public removeEffect(index: number): void;\n  public removeEffect(param: any) {\n    let indexToRemove = -1;\n    if (typeof param === 'number') {\n      indexToRemove = param;\n    } else {\n      indexToRemove = this.effects.indexOf(param);\n    }\n\n    // bounds check\n    if (indexToRemove < 0 || indexToRemove >= this.effects.length) {\n      return;\n    }\n\n    this.effects.splice(indexToRemove, 1);\n\n    // We must check if the texture and the backing sprite pixels are loaded as well before\n    // an effect can be applied\n    if (!this._texture.isLoaded() || !this._pixelsLoaded) {\n      this._dirtyEffect = true;\n    } else {\n      this._applyEffects();\n    }\n  }\n\n  private _applyEffects() {\n    const naturalWidth = this._texture.image.naturalWidth || 0;\n    const naturalHeight = this._texture.image.naturalHeight || 0;\n\n    this._spriteCtx.clearRect(0, 0, this.width, this.height);\n    this._spriteCtx.drawImage(\n      this._texture.image,\n      clamp(this.x, 0, naturalWidth),\n      clamp(this.y, 0, naturalHeight),\n      clamp(this.width, 0, naturalWidth),\n      clamp(this.height, 0, naturalHeight),\n      0,\n      0,\n      this.width,\n      this.height\n    );\n    this._pixelData = this._spriteCtx.getImageData(0, 0, this.width, this.height);\n\n    const len = this.effects.length;\n    for (let i = 0; i < len; i++) {\n      for (let y = 0; y < this.height; y++) {\n        for (let x = 0; x < this.width; x++) {\n          this.effects[i].updatePixel(x, y, this._pixelData);\n        }\n      }\n    }\n    this._spriteCtx.clearRect(0, 0, this.width, this.height);\n    this._spriteCtx.putImageData(this._pixelData, 0, 0);\n\n    this._dirtyEffect = false;\n  }\n\n  /**\n   * Clears all effects from the drawing and return it to its original state.\n   */\n  public clearEffects() {\n    this.effects.length = 0;\n    this._applyEffects();\n  }\n\n  /**\n   * Resets the internal state of the drawing (if any)\n   */\n  public reset() {\n    // do nothing\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D, x: number, y: number) {\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate(this.rotation);\n    const xpoint = this.drawWidth * this.anchor.x;\n    const ypoint = this.drawHeight * this.anchor.y;\n\n    ctx.strokeStyle = Color.Black.toString();\n    ctx.strokeRect(-xpoint, -ypoint, this.drawWidth, this.drawHeight);\n    ctx.restore();\n  }\n\n  /**\n   * Draws the sprite appropriately to the 2D rendering context, at an x and y coordinate.\n   * @param ctx  The 2D rendering context\n   * @param x    The x coordinate of where to draw\n   * @param y    The y coordinate of where to draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\n  /**\n   * Draws the sprite with custom options to override internals without mutating them.\n   * @param options\n   */\n  public draw(options: DrawOptions): void;\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number): void {\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\n    } else {\n      this._drawWithOptions(ctxOrOptions);\n    }\n  }\n\n  private _drawWithOptions(options: DrawOptions) {\n    const { ctx, x, y, rotation, drawWidth, drawHeight, anchor, offset, opacity, flipHorizontal, flipVertical } = {\n      ...options,\n      rotation: nullish(options.rotation, this.rotation),\n      drawWidth: nullish(options.drawWidth, this.drawWidth),\n      drawHeight: nullish(options.drawHeight, this.drawHeight),\n      flipHorizontal: nullish(options.flipHorizontal, this.flipHorizontal),\n      flipVertical: nullish(options.flipVertical, this.flipVertical),\n      anchor: nullish(options.anchor, this.anchor),\n      offset: nullish(options.offset, this.offset),\n      opacity: nullish(options.opacity, this._opacity)\n    };\n\n    if (this._dirtyEffect) {\n      this._applyEffects();\n    }\n\n    // calculating current dimensions\n    ctx.save();\n    const xpoint = drawWidth * anchor.x + offset.x;\n    const ypoint = drawHeight * anchor.y + offset.y;\n    ctx.translate(x, y);\n    ctx.rotate(rotation);\n\n    // todo cache flipped sprites\n    if (flipHorizontal) {\n      ctx.translate(drawWidth, 0);\n      ctx.scale(-1, 1);\n    }\n\n    if (flipVertical) {\n      ctx.translate(0, drawHeight);\n      ctx.scale(1, -1);\n    }\n\n    if (this._dirtyEffect) {\n      this._applyEffects();\n    }\n\n    const oldAlpha = ctx.globalAlpha;\n    ctx.globalAlpha = nullish(opacity, 1);\n    ctx.drawImage(this._spriteCanvas, 0, 0, this.width, this.height, -xpoint, -ypoint, drawWidth, drawHeight);\n    ctx.globalAlpha = oldAlpha;\n\n    ctx.restore();\n  }\n\n  /**\n   * Produces a copy of the current sprite\n   */\n  public clone(): SpriteImpl {\n    const result = new Sprite(this._texture, this.x, this.y, this.width, this.height);\n    result.scale = this.scale.clone();\n    result.rotation = this.rotation;\n    result.flipHorizontal = this.flipHorizontal;\n    result.flipVertical = this.flipVertical;\n\n    const len = this.effects.length;\n    for (let i = 0; i < len; i++) {\n      result.addEffect(this.effects[i]);\n    }\n    return result;\n  }\n}\n\n/**\n * [[include:Constructors.md]]\n */\nexport interface SpriteArgs extends Partial<SpriteImpl> {\n  image?: Texture;\n  x?: number;\n  width?: number;\n  height?: number;\n  rotation?: number;\n  anchor?: Vector;\n  scale?: Vector;\n  flipVertical?: boolean;\n  flipHorizontal?: boolean;\n}\n\n/**\n * A [[Sprite]] is one of the main drawing primitives. It is responsible for drawing\n * images or parts of images from a [[Texture]] resource to the screen.\n *\n * [[include:Sprites.md]]\n */\nexport class Sprite extends Configurable(SpriteImpl) {\n  constructor(config: SpriteArgs);\n  constructor(image: Texture, x: number, y: number, width: number, height: number);\n  constructor(imageOrConfig: Texture | SpriteArgs, x?: number, y?: number, width?: number, height?: number) {\n    super(imageOrConfig, x, y, width, height);\n  }\n}\n","import { Resource } from './Resource';\nimport { Promise } from '../Promises';\nimport { Sprite } from '../Drawing/Sprite';\n/**\n * The [[Texture]] object allows games built in Excalibur to load image resources.\n * [[Texture]] is an [[Loadable]] which means it can be passed to a [[Loader]]\n * to pre-load before starting a level or game.\n *\n * [[include:Textures.md]]\n */\nexport class Texture extends Resource<HTMLImageElement> {\n  /**\n   * The width of the texture in pixels\n   */\n  public width: number;\n\n  /**\n   * The height of the texture in pixels\n   */\n  public height: number;\n\n  /**\n   * A [[Promise]] that resolves when the Texture is loaded.\n   */\n  public loaded: Promise<any> = new Promise<any>();\n\n  private _isLoaded: boolean = false;\n  private _sprite: Sprite = null;\n\n  /**\n   * Populated once loading is complete\n   */\n  public image: HTMLImageElement;\n\n  /**\n   * @param path       Path to the image resource\n   * @param bustCache  Optionally load texture with cache busting\n   */\n  constructor(public path: string, public bustCache = true) {\n    super(path, 'blob', bustCache);\n    this._sprite = new Sprite(this, 0, 0, 0, 0);\n  }\n\n  /**\n   * Returns true if the Texture is completely loaded and is ready\n   * to be drawn.\n   */\n  public isLoaded(): boolean {\n    return this._isLoaded;\n  }\n\n  /**\n   * Begins loading the texture and returns a promise to be resolved on completion\n   */\n  public load(): Promise<HTMLImageElement> {\n    const complete = new Promise<HTMLImageElement>();\n    if (this.path.indexOf('data:image/') > -1) {\n      this.image = new Image();\n      this.image.addEventListener('load', () => {\n        this.width = this._sprite.width = this.image.naturalWidth;\n        this.height = this._sprite.height = this.image.naturalHeight;\n        this._sprite = new Sprite(this, 0, 0, this.width, this.height);\n        this.loaded.resolve(this.image);\n        complete.resolve(this.image);\n      });\n      this.image.src = this.path;\n    } else {\n      const loaded = super.load();\n      loaded.then(\n        () => {\n          this.image = new Image();\n          this.image.addEventListener('load', () => {\n            this._isLoaded = true;\n            this.width = this._sprite.width = this.image.naturalWidth;\n            this.height = this._sprite.height = this.image.naturalHeight;\n            this.loaded.resolve(this.image);\n            complete.resolve(this.image);\n          });\n          this.image.src = super.getData();\n        },\n        () => {\n          complete.reject('Error loading texture.');\n        }\n      );\n    }\n    return complete;\n  }\n\n  public asSprite(): Sprite {\n    return this._sprite;\n  }\n}\n","/**\n * An enum that describes the types of collisions actors can participate in\n */\nexport enum CollisionType {\n  /**\n   * Actors with the `PreventCollision` setting do not participate in any\n   * collisions and do not raise collision events.\n   */\n  PreventCollision = 'PreventCollision',\n  /**\n   * Actors with the `Passive` setting only raise collision events, but are not\n   * influenced or moved by other actors and do not influence or move other actors.\n   */\n  Passive = 'Passive',\n  /**\n   * Actors with the `Active` setting raise collision events and participate\n   * in collisions with other actors and will be push or moved by actors sharing\n   * the `Active` or `Fixed` setting.\n   */\n  Active = 'Active',\n  /**\n   * Actors with the `Fixed` setting raise collision events and participate in\n   * collisions with other actors. Actors with the `Fixed` setting will not be\n   * pushed or moved by other actors sharing the `Fixed`. Think of Fixed\n   * actors as \"immovable/unstoppable\" objects. If two `Fixed` actors meet they will\n   * not be pushed or moved by each other, they will not interact except to throw\n   * collision events.\n   */\n  Fixed = 'Fixed'\n}\n","import { RotationType } from './RotationType';\n\nimport { Actor } from '../Actor';\nimport { Vector } from '../Algebra';\nimport { Logger } from '../Util/Log';\nimport * as Util from '../Util/Util';\nimport { obsolete } from '../Util/Decorators';\n\n/**\n * Used for implementing actions for the [[ActionContext|Action API]].\n */\nexport interface Action {\n  update(delta: number): void;\n  isComplete(actor: Actor): boolean;\n  reset(): void;\n  stop(): void;\n}\n\nexport class EaseTo implements Action {\n  private _currentLerpTime: number = 0;\n  private _lerpDuration: number = 1 * 1000; // 1 second\n  private _lerpStart: Vector = new Vector(0, 0);\n  private _lerpEnd: Vector = new Vector(0, 0);\n  private _initialized: boolean = false;\n  private _stopped: boolean = false;\n  private _distance: number = 0;\n  constructor(\n    public actor: Actor,\n    x: number,\n    y: number,\n    duration: number,\n    public easingFcn: (currentTime: number, startValue: number, endValue: number, duration: number) => number\n  ) {\n    this._lerpDuration = duration;\n    this._lerpEnd = new Vector(x, y);\n  }\n  private _initialize() {\n    this._lerpStart = new Vector(this.actor.pos.x, this.actor.pos.y);\n    this._currentLerpTime = 0;\n    this._distance = this._lerpStart.distance(this._lerpEnd);\n  }\n\n  public update(delta: number): void {\n    if (!this._initialized) {\n      this._initialize();\n      this._initialized = true;\n    }\n\n    let newX = this.actor.pos.x;\n    let newY = this.actor.pos.y;\n    if (this._currentLerpTime < this._lerpDuration) {\n      if (this._lerpEnd.x < this._lerpStart.x) {\n        newX =\n          this._lerpStart.x -\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.x, this._lerpStart.x, this._lerpDuration) - this._lerpEnd.x);\n      } else {\n        newX = this.easingFcn(this._currentLerpTime, this._lerpStart.x, this._lerpEnd.x, this._lerpDuration);\n      }\n\n      if (this._lerpEnd.y < this._lerpStart.y) {\n        newY =\n          this._lerpStart.y -\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.y, this._lerpStart.y, this._lerpDuration) - this._lerpEnd.y);\n      } else {\n        newY = this.easingFcn(this._currentLerpTime, this._lerpStart.y, this._lerpEnd.y, this._lerpDuration);\n      }\n      this.actor.pos.x = newX;\n      this.actor.pos.y = newY;\n\n      this._currentLerpTime += delta;\n    } else {\n      this.actor.pos.x = this._lerpEnd.x;\n      this.actor.pos.y = this._lerpEnd.y;\n      //this._lerpStart = null;\n      //this._lerpEnd = null;\n      //this._currentLerpTime = 0;\n    }\n  }\n  public isComplete(actor: Actor): boolean {\n    return this._stopped || new Vector(actor.pos.x, actor.pos.y).distance(this._lerpStart) >= this._distance;\n  }\n\n  public reset(): void {\n    this._initialized = false;\n  }\n  public stop(): void {\n    this._stopped = true;\n  }\n}\n\nexport class MoveTo implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _start: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _distance: number;\n  private _started = false;\n  private _stopped = false;\n  constructor(actor: Actor, destx: number, desty: number, speed: number) {\n    this._actor = actor;\n    this._end = new Vector(destx, desty);\n    this._speed = speed;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._start = new Vector(this._actor.pos.x, this._actor.pos.y);\n      this._distance = this._start.distance(this._end);\n      this._dir = this._end.sub(this._start).normalize();\n    }\n    const m = this._dir.scale(this._speed);\n    this._actor.vel.x = m.x;\n    this._actor.vel.y = m.y;\n\n    if (this.isComplete(this._actor)) {\n      this._actor.pos.x = this._end.x;\n      this._actor.pos.y = this._end.y;\n      this._actor.vel.y = 0;\n      this._actor.vel.x = 0;\n    }\n  }\n\n  public isComplete(actor: Actor): boolean {\n    return this._stopped || new Vector(actor.pos.x, actor.pos.y).distance(this._start) >= this._distance;\n  }\n\n  public stop(): void {\n    this._actor.vel.y = 0;\n    this._actor.vel.x = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class MoveBy implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _distance: number;\n  private _speed: number;\n\n  private _start: Vector;\n  private _offset: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _started = false;\n  private _stopped = false;\n\n  constructor(actor: Actor, offsetX: number, offsetY: number, speed: number) {\n    this._actor = actor;\n    this._speed = speed;\n    this._offset = new Vector(offsetX, offsetY);\n    if (speed <= 0) {\n      Logger.getInstance().error('Attempted to moveBy with speed less than or equal to zero : ' + speed);\n      throw new Error('Speed must be greater than 0 pixels per second');\n    }\n  }\n\n  public update(_delta: number) {\n    if (!this._started) {\n      this._started = true;\n      this._start = new Vector(this._actor.pos.x, this._actor.pos.y);\n      this._end = this._start.add(this._offset);\n      this._distance = this._offset.size;\n      this._dir = this._end.sub(this._start).normalize();\n    }\n\n    this._actor.vel = this._dir.scale(this._speed);\n\n    if (this.isComplete(this._actor)) {\n      this._actor.pos.x = this._end.x;\n      this._actor.pos.y = this._end.y;\n      this._actor.vel.y = 0;\n      this._actor.vel.x = 0;\n    }\n  }\n\n  public isComplete(actor: Actor): boolean {\n    return this._stopped || actor.pos.distance(this._start) >= this._distance;\n  }\n\n  public stop(): void {\n    this._actor.vel.y = 0;\n    this._actor.vel.x = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class Follow implements Action {\n  private _actor: Actor;\n  private _actorToFollow: Actor;\n  public x: number;\n  public y: number;\n  private _current: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _maximumDistance: number;\n  private _distanceBetween: number;\n  private _started = false;\n  private _stopped = false;\n\n  constructor(actor: Actor, actorToFollow: Actor, followDistance?: number) {\n    this._actor = actor;\n    this._actorToFollow = actorToFollow;\n    this._current = new Vector(this._actor.pos.x, this._actor.pos.y);\n    this._end = new Vector(actorToFollow.pos.x, actorToFollow.pos.y);\n    this._maximumDistance = followDistance !== undefined ? followDistance : this._current.distance(this._end);\n    this._speed = 0;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._distanceBetween = this._current.distance(this._end);\n      this._dir = this._end.sub(this._current).normalize();\n    }\n\n    const actorToFollowSpeed = Math.sqrt(Math.pow(this._actorToFollow.vel.x, 2) + Math.pow(this._actorToFollow.vel.y, 2));\n    if (actorToFollowSpeed !== 0) {\n      this._speed = actorToFollowSpeed;\n    }\n    this._current.x = this._actor.pos.x;\n    this._current.y = this._actor.pos.y;\n\n    this._end.x = this._actorToFollow.pos.x;\n    this._end.y = this._actorToFollow.pos.y;\n    this._distanceBetween = this._current.distance(this._end);\n    this._dir = this._end.sub(this._current).normalize();\n\n    if (this._distanceBetween >= this._maximumDistance) {\n      const m = this._dir.scale(this._speed);\n      this._actor.vel.x = m.x;\n      this._actor.vel.y = m.y;\n    } else {\n      this._actor.vel.x = 0;\n      this._actor.vel.y = 0;\n    }\n\n    if (this.isComplete()) {\n      this._actor.pos.x = this._end.x;\n      this._actor.pos.y = this._end.y;\n      this._actor.vel.y = 0;\n      this._actor.vel.x = 0;\n    }\n  }\n\n  public stop(): void {\n    this._actor.vel.y = 0;\n    this._actor.vel.x = 0;\n    this._stopped = true;\n  }\n\n  public isComplete(): boolean {\n    // the actor following should never stop unless specified to do so\n    return this._stopped;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class Meet implements Action {\n  private _actor: Actor;\n  private _actorToMeet: Actor;\n  public x: number;\n  public y: number;\n  private _current: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _distanceBetween: number;\n  private _started = false;\n  private _stopped = false;\n  private _speedWasSpecified = false;\n\n  constructor(actor: Actor, actorToMeet: Actor, speed?: number) {\n    this._actor = actor;\n    this._actorToMeet = actorToMeet;\n    this._current = new Vector(this._actor.pos.x, this._actor.pos.y);\n    this._end = new Vector(actorToMeet.pos.x, actorToMeet.pos.y);\n    this._speed = speed || 0;\n\n    if (speed !== undefined) {\n      this._speedWasSpecified = true;\n    }\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._distanceBetween = this._current.distance(this._end);\n      this._dir = this._end.sub(this._current).normalize();\n    }\n\n    const actorToMeetSpeed = Math.sqrt(Math.pow(this._actorToMeet.vel.x, 2) + Math.pow(this._actorToMeet.vel.y, 2));\n    if (actorToMeetSpeed !== 0 && !this._speedWasSpecified) {\n      this._speed = actorToMeetSpeed;\n    }\n    this._current.x = this._actor.pos.x;\n    this._current.y = this._actor.pos.y;\n\n    this._end.x = this._actorToMeet.pos.x;\n    this._end.y = this._actorToMeet.pos.y;\n    this._distanceBetween = this._current.distance(this._end);\n    this._dir = this._end.sub(this._current).normalize();\n\n    const m = this._dir.scale(this._speed);\n    this._actor.vel.x = m.x;\n    this._actor.vel.y = m.y;\n\n    if (this.isComplete()) {\n      this._actor.pos.x = this._end.x;\n      this._actor.pos.y = this._end.y;\n      this._actor.vel.y = 0;\n      this._actor.vel.x = 0;\n    }\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || this._distanceBetween <= 1;\n  }\n\n  public stop(): void {\n    this._actor.vel.y = 0;\n    this._actor.vel.x = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class RotateTo implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _start: number;\n  private _end: number;\n  private _speed: number;\n  private _rotationType: RotationType;\n  private _direction: number;\n  private _distance: number;\n  private _shortDistance: number;\n  private _longDistance: number;\n  private _shortestPathIsPositive: boolean;\n  private _started = false;\n  private _stopped = false;\n  constructor(actor: Actor, angleRadians: number, speed: number, rotationType?: RotationType) {\n    this._actor = actor;\n    this._end = angleRadians;\n    this._speed = speed;\n    this._rotationType = rotationType || RotationType.ShortestPath;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._start = this._actor.rotation;\n      const distance1 = Math.abs(this._end - this._start);\n      const distance2 = Util.TwoPI - distance1;\n      if (distance1 > distance2) {\n        this._shortDistance = distance2;\n        this._longDistance = distance1;\n      } else {\n        this._shortDistance = distance1;\n        this._longDistance = distance2;\n      }\n\n      this._shortestPathIsPositive = (this._start - this._end + Util.TwoPI) % Util.TwoPI >= Math.PI;\n\n      switch (this._rotationType) {\n        case RotationType.ShortestPath:\n          this._distance = this._shortDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = 1;\n          } else {\n            this._direction = -1;\n          }\n          break;\n        case RotationType.LongestPath:\n          this._distance = this._longDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = -1;\n          } else {\n            this._direction = 1;\n          }\n          break;\n        case RotationType.Clockwise:\n          this._direction = 1;\n          if (this._shortestPathIsPositive) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n        case RotationType.CounterClockwise:\n          this._direction = -1;\n          if (!this._shortestPathIsPositive) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n      }\n    }\n\n    this._actor.rx = this._direction * this._speed;\n\n    if (this.isComplete()) {\n      this._actor.rotation = this._end;\n      this._actor.rx = 0;\n      this._stopped = true;\n    }\n  }\n\n  public isComplete(): boolean {\n    const distanceTravelled = Math.abs(this._actor.rotation - this._start);\n    return this._stopped || distanceTravelled >= Math.abs(this._distance);\n  }\n\n  public stop(): void {\n    this._actor.rx = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class RotateBy implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _start: number;\n  private _end: number;\n  private _speed: number;\n  private _offset: number;\n\n  private _rotationType: RotationType;\n  private _direction: number;\n  private _distance: number;\n  private _shortDistance: number;\n  private _longDistance: number;\n  private _shortestPathIsPositive: boolean;\n  private _started = false;\n  private _stopped = false;\n  constructor(actor: Actor, angleRadiansOffset: number, speed: number, rotationType?: RotationType) {\n    this._actor = actor;\n    this._speed = speed;\n    this._offset = angleRadiansOffset;\n    this._rotationType = rotationType || RotationType.ShortestPath;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._start = this._actor.rotation;\n      this._end = this._start + this._offset;\n\n      const distance1 = Math.abs(this._end - this._start);\n      const distance2 = Util.TwoPI - distance1;\n      if (distance1 > distance2) {\n        this._shortDistance = distance2;\n        this._longDistance = distance1;\n      } else {\n        this._shortDistance = distance1;\n        this._longDistance = distance2;\n      }\n\n      this._shortestPathIsPositive = (this._start - this._end + Util.TwoPI) % Util.TwoPI >= Math.PI;\n\n      switch (this._rotationType) {\n        case RotationType.ShortestPath:\n          this._distance = this._shortDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = 1;\n          } else {\n            this._direction = -1;\n          }\n          break;\n        case RotationType.LongestPath:\n          this._distance = this._longDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = -1;\n          } else {\n            this._direction = 1;\n          }\n          break;\n        case RotationType.Clockwise:\n          this._direction = 1;\n          if (this._shortDistance >= 0) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n        case RotationType.CounterClockwise:\n          this._direction = -1;\n          if (this._shortDistance <= 0) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n      }\n    }\n\n    this._actor.rx = this._direction * this._speed;\n\n    if (this.isComplete()) {\n      this._actor.rotation = this._end;\n      this._actor.rx = 0;\n      this._stopped = true;\n    }\n  }\n\n  public isComplete(): boolean {\n    const distanceTravelled = Math.abs(this._actor.rotation - this._start);\n    return this._stopped || distanceTravelled >= Math.abs(this._distance);\n  }\n\n  public stop(): void {\n    this._actor.rx = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\n@obsolete({ message: 'ex.Action.ScaleTo will be removed in v0.25.0', alternateMethod: 'Set width and hight directly' })\nexport class ScaleTo implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _startX: number;\n  private _startY: number;\n  private _endX: number;\n  private _endY: number;\n  private _speedX: number;\n  private _speedY: number;\n  private _distanceX: number;\n  private _distanceY: number;\n  private _started = false;\n  private _stopped = false;\n  constructor(actor: Actor, scaleX: number, scaleY: number, speedX: number, speedY: number) {\n    this._actor = actor;\n    this._endX = scaleX;\n    this._endY = scaleY;\n    this._speedX = speedX;\n    this._speedY = speedY;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._startX = this._actor.scale.x;\n      this._startY = this._actor.scale.y;\n      this._distanceX = Math.abs(this._endX - this._startX);\n      this._distanceY = Math.abs(this._endY - this._startY);\n    }\n\n    if (!(Math.abs(this._actor.scale.x - this._startX) >= this._distanceX)) {\n      const directionX = this._endY < this._startY ? -1 : 1;\n      this._actor.sx = this._speedX * directionX;\n    } else {\n      this._actor.sx = 0;\n    }\n\n    if (!(Math.abs(this._actor.scale.y - this._startY) >= this._distanceY)) {\n      const directionY = this._endY < this._startY ? -1 : 1;\n      this._actor.sy = this._speedY * directionY;\n    } else {\n      this._actor.sy = 0;\n    }\n\n    if (this.isComplete()) {\n      this._actor.scale.x = this._endX;\n      this._actor.scale.y = this._endY;\n      this._actor.sx = 0;\n      this._actor.sy = 0;\n    }\n  }\n\n  public isComplete(): boolean {\n    return (\n      this._stopped ||\n      (Math.abs(this._actor.scale.y - this._startX) >= this._distanceX && Math.abs(this._actor.scale.y - this._startY) >= this._distanceY)\n    );\n  }\n\n  public stop(): void {\n    this._actor.sx = 0;\n    this._actor.sy = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\n@obsolete({ message: 'ex.Action.ScaleBy will be removed in v0.25.0', alternateMethod: 'Set width and hight directly' })\nexport class ScaleBy implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _startScale: Vector;\n  private _endScale: Vector;\n  private _offset: Vector;\n  private _distanceX: number;\n  private _distanceY: number;\n  private _directionX: number;\n  private _directionY: number;\n  private _started = false;\n  private _stopped = false;\n  private _speedX: number;\n  private _speedY: number;\n  constructor(actor: Actor, scaleOffsetX: number, scaleOffsetY: number, speed: number) {\n    this._actor = actor;\n    this._offset = new Vector(scaleOffsetX, scaleOffsetY);\n    this._speedX = this._speedY = speed;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._startScale = this._actor.scale.clone();\n      this._endScale = this._startScale.add(this._offset);\n      this._distanceX = Math.abs(this._endScale.x - this._startScale.x);\n      this._distanceY = Math.abs(this._endScale.y - this._startScale.y);\n      this._directionX = this._endScale.x < this._startScale.x ? -1 : 1;\n      this._directionY = this._endScale.y < this._startScale.y ? -1 : 1;\n    }\n\n    this._actor.sx = this._speedX * this._directionX;\n    this._actor.sy = this._speedY * this._directionY;\n\n    if (this.isComplete()) {\n      this._actor.scale = this._endScale;\n      this._actor.sx = 0;\n      this._actor.sy = 0;\n    }\n  }\n\n  public isComplete(): boolean {\n    return (\n      this._stopped ||\n      (Math.abs(this._actor.scale.x - this._startScale.x) >= this._distanceX &&\n        Math.abs(this._actor.scale.y - this._startScale.y) >= this._distanceY)\n    );\n  }\n\n  public stop(): void {\n    this._actor.sx = 0;\n    this._actor.sy = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class Delay implements Action {\n  public x: number;\n  public y: number;\n  private _actor: Actor;\n  private _elapsedTime: number = 0;\n  private _delay: number;\n  private _started: boolean = false;\n  private _stopped = false;\n  constructor(actor: Actor, delay: number) {\n    this._actor = actor;\n    this._delay = delay;\n  }\n\n  public update(delta: number): void {\n    if (!this._started) {\n      this._started = true;\n    }\n\n    this.x = this._actor.pos.x;\n    this.y = this._actor.pos.y;\n\n    this._elapsedTime += delta;\n  }\n\n  isComplete(): boolean {\n    return this._stopped || this._elapsedTime >= this._delay;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n  }\n\n  reset(): void {\n    this._elapsedTime = 0;\n    this._started = false;\n  }\n}\n\nexport class Blink implements Action {\n  private _timeVisible: number = 0;\n  private _timeNotVisible: number = 0;\n  private _elapsedTime: number = 0;\n  private _totalTime: number = 0;\n  private _actor: Actor;\n  private _duration: number;\n  private _stopped: boolean = false;\n  private _started: boolean = false;\n  constructor(actor: Actor, timeVisible: number, timeNotVisible: number, numBlinks: number = 1) {\n    this._actor = actor;\n    this._timeVisible = timeVisible;\n    this._timeNotVisible = timeNotVisible;\n    this._duration = (timeVisible + timeNotVisible) * numBlinks;\n  }\n\n  public update(delta: number): void {\n    if (!this._started) {\n      this._started = true;\n    }\n\n    this._elapsedTime += delta;\n    this._totalTime += delta;\n    if (this._actor.visible && this._elapsedTime >= this._timeVisible) {\n      this._actor.visible = false;\n      this._elapsedTime = 0;\n    }\n\n    if (!this._actor.visible && this._elapsedTime >= this._timeNotVisible) {\n      this._actor.visible = true;\n      this._elapsedTime = 0;\n    }\n\n    if (this.isComplete()) {\n      this._actor.visible = true;\n    }\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || this._totalTime >= this._duration;\n  }\n\n  public stop(): void {\n    this._actor.visible = true;\n    this._stopped = true;\n  }\n\n  public reset() {\n    this._started = false;\n    this._elapsedTime = 0;\n    this._totalTime = 0;\n  }\n}\n\nexport class Fade implements Action {\n  public x: number;\n  public y: number;\n\n  private _actor: Actor;\n  private _endOpacity: number;\n  private _speed: number;\n  private _multiplier: number = 1;\n  private _started = false;\n  private _stopped = false;\n\n  constructor(actor: Actor, endOpacity: number, speed: number) {\n    this._actor = actor;\n    this._endOpacity = endOpacity;\n    this._speed = speed;\n  }\n\n  public update(delta: number): void {\n    if (!this._started) {\n      this._started = true;\n\n      // determine direction when we start\n      if (this._endOpacity < this._actor.opacity) {\n        this._multiplier = -1;\n      } else {\n        this._multiplier = 1;\n      }\n    }\n\n    if (this._speed > 0) {\n      this._actor.opacity += (this._multiplier * (Math.abs(this._actor.opacity - this._endOpacity) * delta)) / this._speed;\n    }\n\n    this._speed -= delta;\n\n    if (this.isComplete()) {\n      this._actor.opacity = this._endOpacity;\n    }\n\n    Logger.getInstance().debug('[Action fade] Actor opacity:', this._actor.opacity);\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || Math.abs(this._actor.opacity - this._endOpacity) < 0.05;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class Die implements Action {\n  public x: number;\n  public y: number;\n\n  private _actor: Actor;\n  private _stopped = false;\n\n  constructor(actor: Actor) {\n    this._actor = actor;\n  }\n\n  public update(_delta: number): void {\n    this._actor.actionQueue.clearActions();\n    this._actor.kill();\n    this._stopped = true;\n  }\n\n  public isComplete(): boolean {\n    return this._stopped;\n  }\n\n  public stop(): void {\n    return;\n  }\n\n  public reset(): void {\n    return;\n  }\n}\n\nexport class CallMethod implements Action {\n  public x: number;\n  public y: number;\n  private _method: () => any = null;\n  private _actor: Actor = null;\n  private _hasBeenCalled: boolean = false;\n  constructor(actor: Actor, method: () => any) {\n    this._actor = actor;\n    this._method = method;\n  }\n\n  public update(_delta: number) {\n    this._method.call(this._actor);\n    this._hasBeenCalled = true;\n  }\n  public isComplete() {\n    return this._hasBeenCalled;\n  }\n  public reset() {\n    this._hasBeenCalled = false;\n  }\n  public stop() {\n    this._hasBeenCalled = true;\n  }\n}\n\nexport class Repeat implements Action {\n  public x: number;\n  public y: number;\n  private _actor: Actor;\n  private _actionQueue: ActionQueue;\n  private _repeat: number;\n  private _originalRepeat: number;\n  private _stopped: boolean = false;\n  constructor(actor: Actor, repeat: number, actions: Action[]) {\n    this._actor = actor;\n    this._actionQueue = new ActionQueue(actor);\n    this._repeat = repeat;\n    this._originalRepeat = repeat;\n\n    const len = actions.length;\n    for (let i = 0; i < len; i++) {\n      actions[i].reset();\n      this._actionQueue.add(actions[i]);\n    }\n  }\n\n  public update(delta: number): void {\n    this.x = this._actor.pos.x;\n    this.y = this._actor.pos.y;\n    if (!this._actionQueue.hasNext()) {\n      this._actionQueue.reset();\n      this._repeat--;\n    }\n    this._actionQueue.update(delta);\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || this._repeat <= 0;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._repeat = this._originalRepeat;\n  }\n}\n\nexport class RepeatForever implements Action {\n  public x: number;\n  public y: number;\n  private _actor: Actor;\n  private _actionQueue: ActionQueue;\n  private _stopped: boolean = false;\n  constructor(actor: Actor, actions: Action[]) {\n    this._actor = actor;\n    this._actionQueue = new ActionQueue(actor);\n\n    const len = actions.length;\n    for (let i = 0; i < len; i++) {\n      actions[i].reset();\n      this._actionQueue.add(actions[i]);\n    }\n  }\n\n  public update(delta: number): void {\n    this.x = this._actor.pos.x;\n    this.y = this._actor.pos.y;\n    if (this._stopped) {\n      return;\n    }\n\n    if (!this._actionQueue.hasNext()) {\n      this._actionQueue.reset();\n    }\n\n    this._actionQueue.update(delta);\n  }\n\n  public isComplete(): boolean {\n    return this._stopped;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n    this._actionQueue.clearActions();\n  }\n\n  public reset(): void {\n    return;\n  }\n}\n\n/**\n * Action Queues\n *\n * Action queues are part of the [[ActionContext|Action API]] and\n * store the list of actions to be executed for an [[Actor]].\n *\n * Actors implement [[Actor.actions]] which can be manipulated by\n * advanced users to adjust the actions currently being executed in the\n * queue.\n */\nexport class ActionQueue {\n  private _actor: Actor;\n  private _actions: Action[] = [];\n  private _currentAction: Action;\n  private _completedActions: Action[] = [];\n  constructor(actor: Actor) {\n    this._actor = actor;\n  }\n\n  public add(action: Action) {\n    this._actions.push(action);\n  }\n\n  public remove(action: Action) {\n    const index = this._actions.indexOf(action);\n    this._actions.splice(index, 1);\n  }\n\n  public clearActions(): void {\n    this._actions.length = 0;\n    this._completedActions.length = 0;\n    if (this._currentAction) {\n      this._currentAction.stop();\n    }\n  }\n\n  public getActions(): Action[] {\n    return this._actions.concat(this._completedActions);\n  }\n\n  public hasNext(): boolean {\n    return this._actions.length > 0;\n  }\n\n  public reset(): void {\n    this._actions = this.getActions();\n\n    const len = this._actions.length;\n    for (let i = 0; i < len; i++) {\n      this._actions[i].reset();\n    }\n    this._completedActions = [];\n  }\n\n  public update(delta: number) {\n    if (this._actions.length > 0) {\n      this._currentAction = this._actions[0];\n      this._currentAction.update(delta);\n\n      if (this._currentAction.isComplete(this._actor)) {\n        this._completedActions.push(this._actions.shift());\n      }\n    }\n  }\n}\n","import { Vector } from '../Algebra';\nimport { obsolete } from '../Util/Decorators';\n\n/**\n * A definition of an EasingFunction. See [[EasingFunctions]].\n */\n// tslint:disable-next-line\nexport interface EasingFunction {\n  (currentTime: number, startValue: number, endValue: number, duration: number): number;\n}\n\n/**\n * Standard easing functions for motion in Excalibur, defined on a domain of [0, duration] and a range from [+startValue,+endValue]\n * Given a time, the function will return a value from positive startValue to positive endValue.\n *\n * ```js\n * function Linear (t) {\n *    return t * t;\n * }\n *\n * // accelerating from zero velocity\n * function EaseInQuad (t) {\n *    return t * t;\n * }\n *\n * // decelerating to zero velocity\n * function EaseOutQuad (t) {\n *    return t * (2 - t);\n * }\n *\n * // acceleration until halfway, then deceleration\n * function EaseInOutQuad (t) {\n *    return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n * }\n *\n * // accelerating from zero velocity\n * function EaseInCubic (t) {\n *    return t * t * t;\n * }\n *\n * // decelerating to zero velocity\n * function EaseOutCubic (t) {\n *    return (--t) * t * t + 1;\n * }\n *\n * // acceleration until halfway, then deceleration\n * function EaseInOutCubic (t) {\n *    return t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n * }\n * ```\n */\nexport class EasingFunctions {\n  public static CreateReversibleEasingFunction(easing: EasingFunction) {\n    return (time: number, start: number, end: number, duration: number) => {\n      if (end < start) {\n        return start - (easing(time, end, start, duration) - end);\n      } else {\n        return easing(time, start, end, duration);\n      }\n    };\n  }\n\n  @obsolete({\n    message: 'Alias for incorrect spelling used in older versions, will be removed in v0.25.0',\n    alternateMethod: 'CreateReversibleEasingFunction'\n  })\n  public static CreateReversableEasingFunction(easing: EasingFunction) {\n    return EasingFunctions.CreateReversibleEasingFunction(easing);\n  }\n\n  public static CreateVectorEasingFunction(easing: EasingFunction) {\n    return (time: number, start: Vector, end: Vector, duration: number) => {\n      return new Vector(easing(time, start.x, end.x, duration), easing(time, start.y, end.y, duration));\n    };\n  }\n\n  public static Linear: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      return (endValue * currentTime) / duration + startValue;\n    }\n  );\n\n  public static EaseInQuad = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n\n      return endValue * currentTime * currentTime + startValue;\n    }\n  );\n\n  public static EaseOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      return -endValue * currentTime * (currentTime - 2) + startValue;\n    }\n  );\n\n  public static EaseInOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration / 2;\n\n      if (currentTime < 1) {\n        return (endValue / 2) * currentTime * currentTime + startValue;\n      }\n      currentTime--;\n\n      return (-endValue / 2) * (currentTime * (currentTime - 2) - 1) + startValue;\n    }\n  );\n\n  public static EaseInCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      return endValue * currentTime * currentTime * currentTime + startValue;\n    }\n  );\n\n  public static EaseOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      currentTime--;\n      return endValue * (currentTime * currentTime * currentTime + 1) + startValue;\n    }\n  );\n\n  public static EaseInOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration / 2;\n      if (currentTime < 1) {\n        return (endValue / 2) * currentTime * currentTime * currentTime + startValue;\n      }\n      currentTime -= 2;\n      return (endValue / 2) * (currentTime * currentTime * currentTime + 2) + startValue;\n    }\n  );\n}\n","import * as Actions from './Action';\nimport { RotationType } from './RotationType';\n\nimport { Actor } from '../Actor';\nimport { Promise } from '../Promises';\nimport { EasingFunction, EasingFunctions } from '../Util/EasingFunctions';\n\n/**\n * The fluent Action API allows you to perform \"actions\" on\n * [[Actor|Actors]] such as following, moving, rotating, and\n * more. You can implement your own actions by implementing\n * the [[Action]] interface.\n *\n * [[include:Actions.md]]\n */\nexport class ActionContext {\n  private _actors: Actor[] = [];\n  private _queues: Actions.ActionQueue[] = [];\n\n  constructor();\n  constructor(actor: Actor);\n  constructor(actors: Actor[]);\n  constructor() {\n    if (arguments !== null) {\n      this._actors = Array.prototype.slice.call(arguments, 0);\n      this._queues = this._actors.map((a) => {\n        return a.actionQueue;\n      });\n    }\n  }\n\n  /**\n   * Clears all queued actions from the Actor\n   */\n  public clearActions(): void {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].clearActions();\n    }\n  }\n\n  public addActorToContext(actor: Actor) {\n    this._actors.push(actor);\n    // if we run into problems replace the line below with:\n    this._queues.push(actor.actionQueue);\n  }\n\n  public removeActorFromContext(actor: Actor) {\n    const index = this._actors.indexOf(actor);\n    if (index > -1) {\n      this._actors.splice(index, 1);\n      this._queues.splice(index, 1);\n    }\n  }\n\n  /**\n   * This method will move an actor to the specified `x` and `y` position over the\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param x         The x location to move the actor to\n   * @param y         The y location to move the actor to\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position\n   */\n  public easeTo(x: number, y: number, duration: number, easingFcn: EasingFunction = EasingFunctions.Linear) {\n    const len = this._queues.length;\n\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.EaseTo(this._actors[i], x, y, duration, easingFcn));\n    }\n\n    return this;\n  }\n\n  /**\n   * This method will move an actor to the specified x and y position at the\n   * speed specified (in pixels per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param x      The x location to move the actor to\n   * @param y      The y location to move the actor to\n   * @param speed  The speed in pixels per second to move\n   */\n  public moveTo(x: number, y: number, speed: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.MoveTo(this._actors[i], x, y, speed));\n    }\n\n    return this;\n  }\n\n  /**\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param xOffset     The x offset to apply to this actor\n   * @param yOffset     The y location to move the actor to\n   * @param speed  The speed in pixels per second the actor should move\n   */\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.MoveBy(this._actors[i], xOffset, yOffset, speed));\n    }\n    return this;\n  }\n\n  /**\n   * This method will rotate an actor to the specified angle at the speed\n   * specified (in radians per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param angleRadians  The angle to rotate to in radians\n   * @param speed         The angular velocity of the rotation specified in radians per second\n   * @param rotationType  The [[RotationType]] to use for this rotation\n   */\n  public rotateTo(angleRadians: number, speed: number, rotationType?: RotationType): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.RotateTo(this._actors[i], angleRadians, speed, rotationType));\n    }\n    return this;\n  }\n\n  /**\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\n   * in radians/sec and return back the actor. This method is part\n   * of the actor 'Action' fluent API allowing action chaining.\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\n   * @param speed          The speed in radians/sec the actor should rotate at\n   * @param rotationType  The [[RotationType]] to use for this rotation, default is shortest path\n   */\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.RotateBy(this._actors[i], angleRadiansOffset, speed, rotationType));\n    }\n    return this;\n  }\n\n  /**\n   * This method will scale an actor to the specified size at the speed\n   * specified (in magnitude increase per second) and return back the\n   * actor. This method is part of the actor 'Action' fluent API allowing\n   * action chaining.\n   * @param sizeX   The scaling factor to apply on X axis\n   * @param sizeY   The scaling factor to apply on Y axis\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\n   */\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.ScaleTo(this._actors[i], sizeX, sizeY, speedX, speedY));\n    }\n    return this;\n  }\n\n  /**\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\n   * and return back the actor. This method is part of the\n   * actor 'Action' fluent API allowing action chaining.\n   * @param sizeOffsetX   The scaling factor to apply on X axis\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\n   * @param speed    The speed to scale at in scale units/sec\n   */\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.ScaleBy(this._actors[i], sizeOffsetX, sizeOffsetY, speed));\n    }\n    return this;\n  }\n\n  /**\n   * This method will cause an actor to blink (become visible and not\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\n   * the actor should be visible per blink, and the amount of time not visible.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\n   * @param numBlinks       The number of times to blink\n   */\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks: number = 1): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.Blink(this._actors[i], timeVisible, timeNotVisible, numBlinks));\n    }\n    return this;\n  }\n\n  /**\n   * This method will cause an actor's opacity to change from its current value\n   * to the provided value by a specified time (in milliseconds). This method is\n   * part of the actor 'Action' fluent API allowing action chaining.\n   * @param opacity  The ending opacity\n   * @param time     The time it should take to fade the actor (in milliseconds)\n   */\n  public fade(opacity: number, time: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.Fade(this._actors[i], opacity, time));\n    }\n    return this;\n  }\n\n  /**\n   * This method will delay the next action from executing for a certain\n   * amount of time (in milliseconds). This method is part of the actor\n   * 'Action' fluent API allowing action chaining.\n   * @param time  The amount of time to delay the next action in the queue from executing in milliseconds\n   */\n  public delay(time: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.Delay(this._actors[i], time));\n    }\n    return this;\n  }\n\n  /**\n   * This method will add an action to the queue that will remove the actor from the\n   * scene once it has completed its previous actions. Any actions on the\n   * action queue after this action will not be executed.\n   */\n  public die(): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.Die(this._actors[i]));\n    }\n    return this;\n  }\n\n  /**\n   * This method allows you to call an arbitrary method as the next action in the\n   * action queue. This is useful if you want to execute code in after a specific\n   * action, i.e An actor arrives at a destination after traversing a path\n   */\n  public callMethod(method: () => any): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.CallMethod(this._actors[i], method));\n    }\n    return this;\n  }\n\n  /**\n   * This method will cause the actor to repeat all of the previously\n   * called actions a certain number of times. If the number of repeats\n   * is not specified it will repeat forever. This method is part of\n   * the actor 'Action' fluent API allowing action chaining\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\n   * will repeat forever\n   */\n  public repeat(times?: number): ActionContext {\n    if (!times) {\n      this.repeatForever();\n      return this;\n    }\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.Repeat(this._actors[i], times, this._actors[i].actionQueue.getActions()));\n    }\n\n    return this;\n  }\n\n  /**\n   * This method will cause the actor to repeat all of the previously\n   * called actions forever. This method is part of the actor 'Action'\n   * fluent API allowing action chaining.\n   */\n  public repeatForever(): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.RepeatForever(this._actors[i], this._actors[i].actionQueue.getActions()));\n    }\n    return this;\n  }\n\n  /**\n   * This method will cause the actor to follow another at a specified distance\n   * @param actor           The actor to follow\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\n   */\n  public follow(actor: Actor, followDistance?: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      if (followDistance === undefined) {\n        this._queues[i].add(new Actions.Follow(this._actors[i], actor));\n      } else {\n        this._queues[i].add(new Actions.Follow(this._actors[i], actor, followDistance));\n      }\n    }\n    return this;\n  }\n\n  /**\n   * This method will cause the actor to move towards another until they\n   * collide \"meet\" at a specified speed.\n   * @param actor  The actor to meet\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\n   */\n  public meet(actor: Actor, speed?: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      if (speed === undefined) {\n        this._queues[i].add(new Actions.Meet(this._actors[i], actor));\n      } else {\n        this._queues[i].add(new Actions.Meet(this._actors[i], actor, speed));\n      }\n    }\n    return this;\n  }\n\n  /**\n   * Returns a promise that resolves when the current action queue up to now\n   * is finished.\n   */\n  public asPromise<T>(): Promise<T> {\n    const promises = this._queues.map((q, i) => {\n      const temp = new Promise<T>();\n      q.add(\n        new Actions.CallMethod(this._actors[i], () => {\n          temp.resolve();\n        })\n      );\n      return temp;\n    });\n    return Promise.join.apply(this, promises);\n  }\n}\n","import { Vector } from './Algebra';\nimport { obsolete } from './Util/Decorators';\n\n/**\n * Possible collision resolution strategies\n *\n * The default is [[CollisionResolutionStrategy.Box]] which performs simple axis aligned arcade style physics.\n *\n * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.RigidBody]] which allows for complicated\n * simulated physical interactions.\n */\nexport enum CollisionResolutionStrategy {\n  Box,\n  RigidBody\n}\n\n/**\n * Possible broadphase collision pair identification strategies\n *\n * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\n * potential collision pairs which is O(nlog(n)) faster. The other possible strategy is the [[BroadphaseStrategy.Naive]] strategy\n * which loops over every object for every object in the scene to identify collision pairs which is O(n^2) slower.\n */\nexport enum BroadphaseStrategy {\n  Naive,\n  DynamicAABBTree\n}\n\n/**\n * Possible numerical integrators for position and velocity\n */\nexport enum Integrator {\n  Euler\n}\n\n/**\n * The [[Physics]] object is the global configuration object for all Excalibur physics.\n *\n * [[include:Physics.md]]\n */\n/* istanbul ignore next */\nexport class Physics {\n  /**\n   * Global acceleration that is applied to all vanilla actors that have a [[CollisionType.Active|active]] collision type.\n   * Global acceleration won't effect [[Label|labels]], [[ScreenElement|ui actors]], or [[Trigger|triggers]] in Excalibur.\n   *\n   * This is a great way to globally simulate effects like gravity.\n   */\n  public static acc = new Vector(0, 0);\n\n  /**\n   * Globally switches all Excalibur physics behavior on or off.\n   */\n  public static enabled = true;\n\n  /**\n   * Gets or sets the number of collision passes for Excalibur to perform on physics bodies.\n   *\n   * Reducing collision passes may cause things not to collide as expected in your game, but may increase performance.\n   *\n   * More passes can improve the visual quality of collisions when many objects are on the screen. This can reduce jitter, improve the\n   * collision resolution of fast move objects, or the stability of large numbers of objects stacked together.\n   *\n   * Fewer passes will improve the performance of the game at the cost of collision quality, more passes will improve quality at the\n   * cost of performance.\n   *\n   * The default is set to 5 passes which is a good start.\n   */\n  public static collisionPasses = 5;\n\n  /**\n   * Gets or sets the broadphase pair identification strategy.\n   *\n   * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\n   * potential collision pairs which is O(nlog(n)) faster. The other possible strategy is the [[BroadphaseStrategy.Naive]] strategy\n   * which loops over every object for every object in the scene to identify collision pairs which is O(n^2) slower.\n   */\n  public static broadphaseStrategy: BroadphaseStrategy = BroadphaseStrategy.DynamicAABBTree;\n\n  /**\n   * Globally switches the debug information for the broadphase strategy\n   */\n  public static broadphaseDebug: boolean = false;\n  /**\n   * Show the normals as a result of collision on the screen.\n   */\n  public static showCollisionNormals: boolean = false;\n  /**\n   * Show the position, velocity, and acceleration as graphical vectors.\n   */\n  public static showMotionVectors: boolean = false;\n  /**\n   * Show the axis-aligned bounding boxes of the collision bodies on the screen.\n   */\n  public static showBounds: boolean = false;\n  /**\n   * Show the bounding collision area shapes\n   */\n  public static showArea: boolean = false;\n  /**\n   * Show points of collision interpreted by excalibur as a result of collision.\n   */\n  public static showContacts: boolean = false;\n  /**\n   * Show the surface normals of the collision areas.\n   */\n  public static showNormals: boolean = false;\n  /**\n   * Gets or sets the global collision resolution strategy (narrowphase).\n   *\n   * The default is [[CollisionResolutionStrategy.Box]] which performs simple axis aligned arcade style physics.\n   *\n   * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.RigidBody]] which allows for complicated\n   * simulated physical interactions.\n   */\n  public static collisionResolutionStrategy: CollisionResolutionStrategy = CollisionResolutionStrategy.Box;\n  /**\n   * The default mass to use if none is specified\n   */\n  public static defaultMass: number = 10;\n  /**\n   * Gets or sets the position and velocity positional integrator, currently only Euler is supported.\n   */\n  public static integrator: Integrator = Integrator.Euler;\n  /**\n   * Number of steps to use in integration. A higher number improves the positional accuracy over time. This can be useful to increase\n   * if you have fast moving objects in your simulation or you have a large number of objects and need to increase stability.\n   */\n  public static integrationSteps = 1;\n  /**\n   * Gets or sets whether rotation is allowed in a RigidBody collision resolution\n   */\n  public static allowRigidBodyRotation = true;\n\n  /**\n   * Configures Excalibur to use box physics. Box physics which performs simple axis aligned arcade style physics.\n   */\n  public static useBoxPhysics(): void {\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.Box;\n  }\n\n  /**\n   * Configures Excalibur to use rigid body physics. Rigid body physics allows for complicated\n   * simulated physical interactions.\n   */\n  public static useRigidBodyPhysics(): void {\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.RigidBody;\n  }\n\n  /**\n   * Small value to help collision passes settle themselves after the narrowphase.\n   */\n  public static collisionShift = 0.001;\n\n  /**\n   * Factor to add to the RigidBody BoundingBox, bounding box (dimensions += vel * dynamicTreeVelocityMultiplier);\n   */\n  public static dynamicTreeVelocityMultiplier = 2;\n\n  @obsolete({\n    message: 'Alias for incorrect spelling used in older versions, will be removed in v0.25.0',\n    alternateMethod: 'dynamicTreeVelocityMultiplier'\n  })\n  public static get dynamicTreeVelocityMultiplyer() {\n    return Physics.dynamicTreeVelocityMultiplier;\n  }\n\n  public static set dynamicTreeVelocityMultiplyer(value: number) {\n    Physics.dynamicTreeVelocityMultiplier = value;\n  }\n\n  /**\n   * Pad RigidBody BoundingBox by a constant amount\n   */\n  public static boundsPadding = 5;\n\n  /**\n   * Surface epsilon is used to help deal with surface penetration\n   */\n  public static surfaceEpsilon = 0.1;\n\n  /**\n   * Enable fast moving body checking, this enables checking for collision pairs via raycast for fast moving objects to prevent\n   * bodies from tunneling through one another.\n   */\n  public static checkForFastBodies = true;\n\n  /**\n   * Disable minimum fast moving body raycast, by default if ex.Physics.checkForFastBodies = true Excalibur will only check if the\n   * body is moving at least half of its minimum dimension in an update. If ex.Physics.disableMinimumSpeedForFastBody is set to true,\n   * Excalibur will always perform the fast body raycast regardless of speed.\n   */\n  public static disableMinimumSpeedForFastBody = false;\n}\n","import { ConvexPolygon } from './ConvexPolygon';\n\nimport { Actor } from '../Actor';\nimport { Vector, Ray } from '../Algebra';\nimport { Color } from '../Drawing/Color';\nimport { Side } from './Side';\n\nexport interface BoundingBoxOptions {\n  left: number;\n  right: number;\n  top: number;\n  bottom: number;\n}\n\n/**\n * Axis Aligned collision primitive for Excalibur.\n */\nexport class BoundingBox {\n  public top: number;\n  public right: number;\n  public bottom: number;\n  public left: number;\n\n  /**\n   * Constructor allows passing of either an object with all coordinate components,\n   * or the coordinate components passed separately.\n   * @param leftOrOptions    Either x coordinate of the left edge or an options object\n   * containing the four coordinate components.\n   * @param top     y coordinate of the top edge\n   * @param right   x coordinate of the right edge\n   * @param bottom  y coordinate of the bottom edge\n   */\n  constructor(leftOrOptions: number | BoundingBoxOptions = 0, top: number = 0, right: number = 0, bottom: number = 0) {\n    if (typeof leftOrOptions === 'object') {\n      this.left = leftOrOptions.left;\n      this.top = leftOrOptions.top;\n      this.right = leftOrOptions.right;\n      this.bottom = leftOrOptions.bottom;\n    } else if (typeof leftOrOptions === 'number') {\n      this.left = leftOrOptions;\n      this.top = top;\n      this.right = right;\n      this.bottom = bottom;\n    }\n  }\n\n  /**\n   * Given bounding box A & B, returns the side relative to A when intersection is performed.\n   * @param intersection Intersection vector between 2 bounding boxes\n   */\n  public static getSideFromIntersection(intersection: Vector): Side {\n    if (!intersection) {\n      return Side.None;\n    }\n    if (intersection) {\n      if (Math.abs(intersection.x) > Math.abs(intersection.y)) {\n        if (intersection.x < 0) {\n          return Side.Right;\n        }\n        return Side.Left;\n      } else {\n        if (intersection.y < 0) {\n          return Side.Bottom;\n        }\n        return Side.Top;\n      }\n    }\n    return Side.None;\n  }\n\n  public static fromPoints(points: Vector[]): BoundingBox {\n    let minX = Infinity;\n    let minY = Infinity;\n    let maxX = -Infinity;\n    let maxY = -Infinity;\n    for (let i = 0; i < points.length; i++) {\n      if (points[i].x < minX) {\n        minX = points[i].x;\n      }\n      if (points[i].x > maxX) {\n        maxX = points[i].x;\n      }\n      if (points[i].y < minY) {\n        minY = points[i].y;\n      }\n      if (points[i].y > maxY) {\n        maxY = points[i].y;\n      }\n    }\n    return new BoundingBox(minX, minY, maxX, maxY);\n  }\n\n  public static fromDimension(width: number, height: number, anchor: Vector = Vector.Half, pos: Vector = Vector.Zero) {\n    return new BoundingBox(\n      -width * anchor.x + pos.x,\n      -height * anchor.y + pos.y,\n      width - width * anchor.x + pos.x,\n      height - height * anchor.y + pos.y\n    );\n  }\n\n  /**\n   * Returns the calculated width of the bounding box\n   */\n  public get width() {\n    return this.right - this.left;\n  }\n\n  /**\n   * Returns the calculated height of the bounding box\n   */\n  public get height() {\n    return this.bottom - this.top;\n  }\n\n  /**\n   * Returns the center of the bounding box\n   */\n  public get center(): Vector {\n    return new Vector((this.left + this.right) / 2, (this.top + this.bottom) / 2);\n  }\n\n  public translate(pos: Vector): BoundingBox {\n    return new BoundingBox(this.left + pos.x, this.top + pos.y, this.right + pos.x, this.bottom + pos.y);\n  }\n\n  /**\n   * Rotates a bounding box by and angle and around a point, if no point is specified (0, 0) is used by default. The resulting bounding\n   * box is also axis-align. This is useful when a new axis-aligned bounding box is needed for rotated geometry.\n   */\n  public rotate(angle: number, point: Vector = Vector.Zero): BoundingBox {\n    const points = this.getPoints().map((p) => p.rotate(angle, point));\n    return BoundingBox.fromPoints(points);\n  }\n\n  public scale(scale: Vector, point: Vector = Vector.Zero): BoundingBox {\n    const shifted = this.translate(point);\n    return new BoundingBox(shifted.left * scale.x, shifted.top * scale.y, shifted.right * scale.x, shifted.bottom * scale.y);\n  }\n\n  /**\n   * Returns the perimeter of the bounding box\n   */\n  public getPerimeter(): number {\n    const wx = this.width;\n    const wy = this.height;\n    return 2 * (wx + wy);\n  }\n\n  public getPoints(): Vector[] {\n    const results = [];\n    results.push(new Vector(this.left, this.top));\n    results.push(new Vector(this.right, this.top));\n    results.push(new Vector(this.right, this.bottom));\n    results.push(new Vector(this.left, this.bottom));\n    return results;\n  }\n\n  /**\n   * Creates a Polygon collision area from the points of the bounding box\n   */\n  public toPolygon(actor?: Actor): ConvexPolygon {\n    let maybeCollider = null;\n    if (actor && actor.body && actor.body.collider) {\n      maybeCollider = actor.body.collider;\n    }\n    return new ConvexPolygon({\n      collider: maybeCollider,\n      points: this.getPoints(),\n      offset: Vector.Zero\n    });\n  }\n\n  /**\n   * Determines whether a ray intersects with a bounding box\n   */\n  public rayCast(ray: Ray, farClipDistance = Infinity): boolean {\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\n    let tmin = -Infinity;\n    let tmax = +Infinity;\n\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\n\n    const tx1 = (this.left - ray.pos.x) * xinv;\n    const tx2 = (this.right - ray.pos.x) * xinv;\n    tmin = Math.min(tx1, tx2);\n    tmax = Math.max(tx1, tx2);\n\n    const ty1 = (this.top - ray.pos.y) * yinv;\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\n\n    return tmax >= Math.max(0, tmin) && tmin < farClipDistance;\n  }\n\n  public rayCastTime(ray: Ray, farClipDistance = Infinity): number {\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\n    let tmin = -Infinity;\n    let tmax = +Infinity;\n\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\n\n    const tx1 = (this.left - ray.pos.x) * xinv;\n    const tx2 = (this.right - ray.pos.x) * xinv;\n    tmin = Math.min(tx1, tx2);\n    tmax = Math.max(tx1, tx2);\n\n    const ty1 = (this.top - ray.pos.y) * yinv;\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\n\n    if (tmax >= Math.max(0, tmin) && tmin < farClipDistance) {\n      return tmin;\n    }\n    return -1;\n  }\n\n  /**\n   * Tests whether a point is contained within the bounding box\n   * @param p  The point to test\n   */\n  public contains(p: Vector): boolean;\n\n  /**\n   * Tests whether another bounding box is totally contained in this one\n   * @param bb  The bounding box to test\n   */\n  public contains(bb: BoundingBox): boolean;\n  public contains(val: any): boolean {\n    if (val instanceof Vector) {\n      return this.left <= val.x && this.top <= val.y && this.bottom >= val.y && this.right >= val.x;\n    } else if (val instanceof BoundingBox) {\n      if (this.left < val.left && this.top < val.top && val.bottom < this.bottom && val.right < this.right) {\n        return true;\n      }\n      return false;\n    }\n    return false;\n  }\n\n  /**\n   * Combines this bounding box and another together returning a new bounding box\n   * @param other  The bounding box to combine\n   */\n  public combine(other: BoundingBox): BoundingBox {\n    const compositeBB = new BoundingBox(\n      Math.min(this.left, other.left),\n      Math.min(this.top, other.top),\n      Math.max(this.right, other.right),\n      Math.max(this.bottom, other.bottom)\n    );\n    return compositeBB;\n  }\n\n  public get dimensions(): Vector {\n    return new Vector(this.width, this.height);\n  }\n\n  /**\n   * Test wether this bounding box intersects with another returning\n   * the intersection vector that can be used to resolve the collision. If there\n   * is no intersection null is returned.\n   *\n   * @param other  Other [[BoundingBox]] to test intersection with\n   * @returns A Vector in the direction of the current BoundingBox, this <- other\n   */\n  public intersect(other: BoundingBox): Vector {\n    const totalBoundingBox = this.combine(other);\n\n    // If the total bounding box is less than or equal the sum of the 2 bounds then there is collision\n    if (\n      totalBoundingBox.width < other.width + this.width &&\n      totalBoundingBox.height < other.height + this.height &&\n      !totalBoundingBox.dimensions.equals(other.dimensions) &&\n      !totalBoundingBox.dimensions.equals(this.dimensions)\n    ) {\n      // collision\n      let overlapX = 0;\n      // right edge is between the other's left and right edge\n      /**\n       *     +-this-+\n       *     |      |\n       *     |    +-other-+\n       *     +----|-+     |\n       *          |       |\n       *          +-------+\n       *         <---\n       *          ^ overlap\n       */\n      if (this.right >= other.left && this.right <= other.right) {\n        overlapX = other.left - this.right;\n        // right edge is past the other's right edge\n        /**\n         *     +-other-+\n         *     |       |\n         *     |    +-this-+\n         *     +----|--+   |\n         *          |      |\n         *          +------+\n         *          --->\n         *          ^ overlap\n         */\n      } else {\n        overlapX = other.right - this.left;\n      }\n\n      let overlapY = 0;\n      // top edge is between the other's top and bottom edge\n      /**\n       *     +-other-+\n       *     |       |\n       *     |    +-this-+   | <- overlap\n       *     +----|--+   |   |\n       *          |      |  \\ /\n       *          +------+   '\n       */\n      if (this.top <= other.bottom && this.top >= other.top) {\n        overlapY = other.bottom - this.top;\n        // top edge is above the other top edge\n        /**\n         *     +-this-+         .\n         *     |      |        / \\\n         *     |    +-other-+   | <- overlap\n         *     +----|-+     |   |\n         *          |       |\n         *          +-------+\n         */\n      } else {\n        overlapY = other.top - this.bottom;\n      }\n\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\n        return new Vector(overlapX, 0);\n      } else {\n        return new Vector(0, overlapY);\n      }\n      // Case of total containment of one bounding box by another\n    } else if (totalBoundingBox.dimensions.equals(other.dimensions) || totalBoundingBox.dimensions.equals(this.dimensions)) {\n      let overlapX = 0;\n      // this is wider than the other\n      if (this.width - other.width >= 0) {\n        // This right edge is closest to the others right edge\n        if (this.right - other.right <= other.left - this.left) {\n          overlapX = other.left - this.right;\n          // This left edge is closest to the others left edge\n        } else {\n          overlapX = other.right - this.left;\n        }\n        // other is wider than this\n      } else {\n        // This right edge is closest to the others right edge\n        if (other.right - this.right <= this.left - other.left) {\n          overlapX = this.left - other.right;\n          // This left edge is closest to the others left edge\n        } else {\n          overlapX = this.right - other.left;\n        }\n      }\n\n      let overlapY = 0;\n      // this is taller than other\n      if (this.height - other.height >= 0) {\n        // The bottom edge is closest to the others bottom edge\n        if (this.bottom - other.bottom <= other.top - this.top) {\n          overlapY = other.top - this.bottom;\n        } else {\n          overlapY = other.bottom - this.top;\n        }\n        // other is taller than this\n      } else {\n        // The bottom edge is closest to the others bottom edge\n        if (other.bottom - this.bottom <= this.top - other.top) {\n          overlapY = this.top - other.bottom;\n        } else {\n          overlapY = this.bottom - other.top;\n        }\n      }\n\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\n        return new Vector(overlapX, 0);\n      } else {\n        return new Vector(0, overlapY);\n      }\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Test whether the bounding box has intersected with another bounding box, returns the side of the current bb that intersected.\n   * @param bb The other actor to test\n   */\n  public intersectWithSide(bb: BoundingBox): Side {\n    const intersect = this.intersect(bb);\n    return BoundingBox.getSideFromIntersection(intersect);\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Yellow) {\n    ctx.strokeStyle = color.toString();\n    ctx.strokeRect(this.left, this.top, this.width, this.height);\n  }\n}\n","import { Body } from './Body';\nimport { Vector } from '../Algebra';\nimport { Physics, CollisionResolutionStrategy } from '../Physics';\nimport { PostCollisionEvent, PreCollisionEvent } from '../Events';\nimport * as Util from '../Util/Util';\nimport { CollisionType } from './CollisionType';\nimport { Collider } from './Collider';\n\n/**\n * Collision contacts are used internally by Excalibur to resolve collision between colliders. This\n * Pair prevents collisions from being evaluated more than one time\n */\nexport class CollisionContact {\n  /**\n   * The id of this collision contact\n   */\n  id: string;\n  /**\n   * The first collider in the collision\n   */\n  colliderA: Collider;\n  /**\n   * The second collider in the collision\n   */\n  colliderB: Collider;\n  /**\n   * The minimum translation vector to resolve penetration, pointing away from colliderA\n   */\n  mtv: Vector;\n  /**\n   * The point of collision shared between colliderA and colliderB\n   */\n  point: Vector;\n  /**\n   * The collision normal, pointing away from colliderA\n   */\n  normal: Vector;\n\n  constructor(colliderA: Collider, colliderB: Collider, mtv: Vector, point: Vector, normal: Vector) {\n    this.colliderA = colliderA;\n    this.colliderB = colliderB;\n    this.mtv = mtv;\n    this.point = point;\n    this.normal = normal;\n  }\n\n  resolve(strategy: CollisionResolutionStrategy) {\n    if (strategy === CollisionResolutionStrategy.RigidBody) {\n      this._resolveRigidBodyCollision();\n    } else if (strategy === CollisionResolutionStrategy.Box) {\n      this._resolveBoxCollision();\n    } else {\n      throw new Error('Unknown collision resolution strategy');\n    }\n  }\n\n  private _applyBoxImpulse(colliderA: Collider, colliderB: Collider, mtv: Vector) {\n    if (colliderA.type === CollisionType.Active && colliderB.type !== CollisionType.Passive) {\n      // Resolve overlaps\n      if (colliderA.type === CollisionType.Active && colliderB.type === CollisionType.Active) {\n        // split overlaps if both are Active\n        mtv = mtv.scale(0.5);\n      }\n      // Apply mtv\n      colliderA.body.pos.y += mtv.y;\n      colliderA.body.pos.x += mtv.x;\n\n      const mtvDir = mtv.normalize();\n\n      // only adjust if velocity is opposite\n      if (mtvDir.dot(colliderA.body.vel) < 0) {\n        // Cancel out velocity in direction of mtv\n        const velAdj = mtvDir.scale(mtvDir.dot(colliderA.body.vel.negate()));\n\n        colliderA.body.vel = colliderA.body.vel.add(velAdj);\n      }\n\n      colliderA.emit('postcollision', new PostCollisionEvent(colliderA, colliderB, Util.getSideFromDirection(mtv), mtv));\n    }\n  }\n\n  private _resolveBoxCollision() {\n    const side = Util.getSideFromDirection(this.mtv);\n    const mtv = this.mtv.negate();\n    // Publish collision events on both participants\n    this.colliderA.emit('precollision', new PreCollisionEvent(this.colliderA, this.colliderB, side, mtv));\n    this.colliderB.emit('precollision', new PreCollisionEvent(this.colliderB, this.colliderA, Util.getOppositeSide(side), mtv.negate()));\n\n    this._applyBoxImpulse(this.colliderA, this.colliderB, mtv);\n    this._applyBoxImpulse(this.colliderB, this.colliderA, mtv.negate());\n  }\n\n  private _resolveRigidBodyCollision() {\n    // perform collision on bounding areas\n    const bodyA: Body = this.colliderA.body;\n    const bodyB: Body = this.colliderB.body;\n    const mtv = this.mtv; // normal pointing away from colliderA\n    let normal = this.normal; // normal pointing away from colliderA\n    if (bodyA === bodyB) {\n      // sanity check for existing pairs\n      return;\n    }\n\n    // Publish collision events on both participants\n    const side = Util.getSideFromDirection(this.mtv);\n    this.colliderA.emit('precollision', new PreCollisionEvent(this.colliderA, this.colliderB, side, this.mtv));\n    this.colliderB.emit(\n      'precollision',\n      new PreCollisionEvent(this.colliderB, this.colliderA, Util.getOppositeSide(side), this.mtv.negate())\n    );\n\n    // If any of the participants are passive then short circuit\n    if (this.colliderA.type === CollisionType.Passive || this.colliderB.type === CollisionType.Passive) {\n      return;\n    }\n\n    const invMassA = this.colliderA.type === CollisionType.Fixed ? 0 : 1 / this.colliderA.mass;\n    const invMassB = this.colliderB.type === CollisionType.Fixed ? 0 : 1 / this.colliderB.mass;\n\n    const invMoiA = this.colliderA.type === CollisionType.Fixed ? 0 : 1 / this.colliderA.inertia;\n    const invMoiB = this.colliderB.type === CollisionType.Fixed ? 0 : 1 / this.colliderB.inertia;\n\n    // average restitution more realistic\n    const coefRestitution = Math.min(this.colliderA.bounciness, this.colliderB.bounciness);\n\n    const coefFriction = Math.min(this.colliderA.friction, this.colliderB.friction);\n\n    normal = normal.normalize();\n    const tangent = normal.normal().normalize();\n\n    const ra = this.point.sub(this.colliderA.center); // point relative to colliderA position\n    const rb = this.point.sub(this.colliderB.center); /// point relative to colliderB\n\n    // Relative velocity in linear terms\n    // Angular to linear velocity formula -> omega = v/r\n    const rv = bodyB.vel.add(rb.cross(-bodyB.rx)).sub(bodyA.vel.sub(ra.cross(bodyA.rx)));\n    const rvNormal = rv.dot(normal);\n    const rvTangent = rv.dot(tangent);\n\n    const raTangent = ra.dot(tangent);\n    const raNormal = ra.dot(normal);\n\n    const rbTangent = rb.dot(tangent);\n    const rbNormal = rb.dot(normal);\n\n    // If objects are moving away ignore\n    if (rvNormal > 0) {\n      return;\n    }\n\n    // Collision impulse formula from Chris Hecker\n    // https://en.wikipedia.org/wiki/Collision_response\n    const impulse =\n      -((1 + coefRestitution) * rvNormal) / (invMassA + invMassB + invMoiA * raTangent * raTangent + invMoiB * rbTangent * rbTangent);\n\n    if (this.colliderA.type === CollisionType.Fixed) {\n      bodyB.vel = bodyB.vel.add(normal.scale(impulse * invMassB));\n      if (Physics.allowRigidBodyRotation) {\n        bodyB.rx -= impulse * invMoiB * -rb.cross(normal);\n      }\n      bodyB.addMtv(mtv);\n    } else if (this.colliderB.type === CollisionType.Fixed) {\n      bodyA.vel = bodyA.vel.sub(normal.scale(impulse * invMassA));\n      if (Physics.allowRigidBodyRotation) {\n        bodyA.rx += impulse * invMoiA * -ra.cross(normal);\n      }\n      bodyA.addMtv(mtv.negate());\n    } else {\n      bodyB.vel = bodyB.vel.add(normal.scale(impulse * invMassB));\n      bodyA.vel = bodyA.vel.sub(normal.scale(impulse * invMassA));\n\n      if (Physics.allowRigidBodyRotation) {\n        bodyB.rx -= impulse * invMoiB * -rb.cross(normal);\n        bodyA.rx += impulse * invMoiA * -ra.cross(normal);\n      }\n\n      // Split the mtv in half for the two bodies, potentially we could do something smarter here\n      bodyB.addMtv(mtv.scale(0.5));\n      bodyA.addMtv(mtv.scale(-0.5));\n    }\n\n    // Friction portion of impulse\n    if (coefFriction && rvTangent) {\n      // Columb model of friction, formula for impulse due to friction from\n      // https://en.wikipedia.org/wiki/Collision_response\n\n      // tangent force exerted by body on another in contact\n      const t = rv.sub(normal.scale(rv.dot(normal))).normalize();\n\n      // impulse in the direction of tangent force\n      const jt = rv.dot(t) / (invMassA + invMassB + raNormal * raNormal * invMoiA + rbNormal * rbNormal * invMoiB);\n\n      let frictionImpulse = new Vector(0, 0);\n      if (Math.abs(jt) <= impulse * coefFriction) {\n        frictionImpulse = t.scale(jt).negate();\n      } else {\n        frictionImpulse = t.scale(-impulse * coefFriction);\n      }\n\n      if (this.colliderA.type === CollisionType.Fixed) {\n        // apply frictional impulse\n        bodyB.vel = bodyB.vel.add(frictionImpulse.scale(invMassB));\n        if (Physics.allowRigidBodyRotation) {\n          bodyB.rx += frictionImpulse.dot(t) * invMoiB * rb.cross(t);\n        }\n      } else if (this.colliderB.type === CollisionType.Fixed) {\n        // apply frictional impulse\n        bodyA.vel = bodyA.vel.sub(frictionImpulse.scale(invMassA));\n        if (Physics.allowRigidBodyRotation) {\n          bodyA.rx -= frictionImpulse.dot(t) * invMoiA * ra.cross(t);\n        }\n      } else {\n        // apply frictional impulse\n        bodyB.vel = bodyB.vel.add(frictionImpulse.scale(invMassB));\n        bodyA.vel = bodyA.vel.sub(frictionImpulse.scale(invMassA));\n\n        // apply frictional impulse\n        if (Physics.allowRigidBodyRotation) {\n          bodyB.rx += frictionImpulse.dot(t) * invMoiB * rb.cross(t);\n          bodyA.rx -= frictionImpulse.dot(t) * invMoiA * ra.cross(t);\n        }\n      }\n    }\n\n    this.colliderA.emit('postcollision', new PostCollisionEvent(this.colliderA, this.colliderB, side, this.mtv));\n    this.colliderB.emit(\n      'postcollision',\n      new PostCollisionEvent(this.colliderB, this.colliderA, Util.getOppositeSide(side), this.mtv.negate())\n    );\n  }\n}\n","import { Circle } from './Circle';\nimport { CollisionContact } from './CollisionContact';\nimport { ConvexPolygon } from './ConvexPolygon';\nimport { Edge } from './Edge';\n\nimport { Vector } from '../Algebra';\n\nexport const CollisionJumpTable = {\n  CollideCircleCircle(circleA: Circle, circleB: Circle): CollisionContact {\n    const radius = circleA.radius + circleB.radius;\n    const circleAPos = circleA.worldPos;\n    const circleBPos = circleB.worldPos;\n    if (circleAPos.distance(circleBPos) > radius) {\n      return null;\n    }\n\n    const axisOfCollision = circleBPos.sub(circleAPos).normalize();\n    const mvt = axisOfCollision.scale(radius - circleBPos.distance(circleAPos));\n\n    const pointOfCollision = circleA.getFurthestPoint(axisOfCollision);\n\n    return new CollisionContact(circleA.collider, circleB.collider, mvt, pointOfCollision, axisOfCollision);\n  },\n\n  CollideCirclePolygon(circle: Circle, polygon: ConvexPolygon): CollisionContact {\n    let minAxis = circle.testSeparatingAxisTheorem(polygon);\n    if (!minAxis) {\n      return null;\n    }\n\n    // make sure that the minAxis is pointing away from circle\n    const samedir = minAxis.dot(polygon.center.sub(circle.center));\n    minAxis = samedir < 0 ? minAxis.negate() : minAxis;\n\n    const verts: Vector[] = [];\n\n    const point1 = polygon.getFurthestPoint(minAxis.negate());\n    const point2 = circle.getFurthestPoint(minAxis); //.add(cc);\n    if (circle.contains(point1)) {\n      verts.push(point1);\n    }\n    if (polygon.contains(point2)) {\n      verts.push(point2);\n    }\n    if (verts.length === 0) {\n      return null;\n    }\n\n    return new CollisionContact(\n      circle.collider,\n      polygon.collider,\n      minAxis,\n      verts.length === 2 ? verts[0].average(verts[1]) : verts[0],\n      minAxis.normalize()\n    );\n  },\n\n  CollideCircleEdge(circle: Circle, edge: Edge): CollisionContact {\n    // center of the circle\n    const cc = circle.center;\n    // vector in the direction of the edge\n    const e = edge.end.sub(edge.begin);\n\n    // amount of overlap with the circle's center along the edge direction\n    const u = e.dot(edge.end.sub(cc));\n    const v = e.dot(cc.sub(edge.begin));\n\n    // Potential region A collision (circle is on the left side of the edge, before the beginning)\n    if (v <= 0) {\n      const da = edge.begin.sub(cc);\n      const dda = da.dot(da); // quick and dirty way of calc'n distance in r^2 terms saves some sqrts\n      // save some sqrts\n      if (dda > circle.radius * circle.radius) {\n        return null; // no collision\n      }\n      return new CollisionContact(\n        circle.collider,\n        edge.collider,\n        da.normalize().scale(circle.radius - Math.sqrt(dda)),\n        edge.begin,\n        da.normalize()\n      );\n    }\n\n    // Potential region B collision (circle is on the right side of the edge, after the end)\n    if (u <= 0) {\n      const db = edge.end.sub(cc);\n      const ddb = db.dot(db);\n      if (ddb > circle.radius * circle.radius) {\n        return null;\n      }\n      return new CollisionContact(\n        circle.collider,\n        edge.collider,\n        db.normalize().scale(circle.radius - Math.sqrt(ddb)),\n        edge.end,\n        db.normalize()\n      );\n    }\n\n    // Otherwise potential region AB collision (circle is in the middle of the edge between the beginning and end)\n    const den = e.dot(e);\n    const pointOnEdge = edge.begin\n      .scale(u)\n      .add(edge.end.scale(v))\n      .scale(1 / den);\n    const d = cc.sub(pointOnEdge);\n\n    const dd = d.dot(d);\n    if (dd > circle.radius * circle.radius) {\n      return null; // no collision\n    }\n\n    let n = e.perpendicular();\n    // flip correct direction\n    if (n.dot(cc.sub(edge.begin)) < 0) {\n      n.x = -n.x;\n      n.y = -n.y;\n    }\n\n    n = n.normalize();\n\n    const mvt = n.scale(Math.abs(circle.radius - Math.sqrt(dd)));\n    return new CollisionContact(circle.collider, edge.collider, mvt.negate(), pointOnEdge, n.negate());\n  },\n\n  CollideEdgeEdge(): CollisionContact {\n    // Edge-edge collision doesn't make sense\n    return null;\n  },\n\n  CollidePolygonEdge(polygon: ConvexPolygon, edge: Edge): CollisionContact {\n    // 3 cases:\n    // (1) Polygon lands on the full face\n    // (2) Polygon lands on the right point\n    // (3) Polygon lands on the left point\n\n    const e = edge.end.sub(edge.begin);\n    let edgeNormal = e.normal();\n\n    if (polygon.contains(edge.begin)) {\n      const { distance: mtv, face } = polygon.getClosestFace(edge.begin);\n      if (mtv) {\n        return new CollisionContact(polygon.collider, edge.collider, mtv.negate(), edge.begin.add(mtv.negate()), face.normal().negate());\n      }\n    }\n\n    if (polygon.contains(edge.end)) {\n      const { distance: mtv, face } = polygon.getClosestFace(edge.end);\n      if (mtv) {\n        return new CollisionContact(polygon.collider, edge.collider, mtv.negate(), edge.end.add(mtv.negate()), face.normal().negate());\n      }\n    }\n\n    const pc = polygon.center;\n    const ec = edge.center;\n    const dir = ec.sub(pc).normalize();\n\n    // build a temporary polygon from the edge to use SAT\n    const linePoly = new ConvexPolygon({\n      collider: edge.collider,\n      points: [edge.begin, edge.end, edge.end.add(dir.scale(30)), edge.begin.add(dir.scale(30))]\n    });\n\n    let minAxis = polygon.testSeparatingAxisTheorem(linePoly);\n\n    // no minAxis, no overlap, no collision\n    if (!minAxis) {\n      return null;\n    }\n\n    // flip the normal and axis to always have positive collisions\n    edgeNormal = edgeNormal.dot(dir) < 0 ? edgeNormal.negate() : edgeNormal;\n    minAxis = minAxis.dot(dir) < 0 ? minAxis.negate() : minAxis;\n\n    return new CollisionContact(polygon.collider, edge.collider, minAxis, polygon.getFurthestPoint(edgeNormal), edgeNormal);\n  },\n\n  CollidePolygonPolygon(polyA: ConvexPolygon, polyB: ConvexPolygon): CollisionContact {\n    // do a SAT test to find a min axis if it exists\n    let minAxis = polyA.testSeparatingAxisTheorem(polyB);\n\n    // no overlap, no collision return null\n    if (!minAxis) {\n      return null;\n    }\n\n    // make sure that minAxis is pointing from A -> B\n    const sameDir = minAxis.dot(polyB.center.sub(polyA.center));\n    minAxis = sameDir < 0 ? minAxis.negate() : minAxis;\n\n    // find rough point of collision\n    // todo this could be better\n    const verts: Vector[] = [];\n    const pointA = polyA.getFurthestPoint(minAxis);\n    const pointB = polyB.getFurthestPoint(minAxis.negate());\n\n    if (polyB.contains(pointA)) {\n      verts.push(pointA);\n    }\n\n    if (polyA.contains(pointB)) {\n      verts.push(pointB);\n    }\n    // no candidates, pick something\n    if (verts.length === 0) {\n      verts.push(pointB);\n    }\n\n    const contact = verts.length === 2 ? verts[0].add(verts[1]).scale(0.5) : verts[0];\n\n    return new CollisionContact(polyA.collider, polyB.collider, minAxis, contact, minAxis.normalize());\n  }\n};\n","import { Line, Vector, Ray } from '../Algebra';\nimport { ConvexPolygon } from './ConvexPolygon';\nimport { Edge } from './Edge';\nimport { Circle } from './Circle';\n\n/**\n * Finds the closes line between 2 line segments, were the magnitude of u, v are the lengths of each segment\n * L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n * L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n * @param p0 Point where L1 begins\n * @param u Direction and length of L1\n * @param q0 Point were L2 begins\n * @param v Direction and length of L2\n */\nexport function ClosestLine(p0: Vector, u: Vector, q0: Vector, v: Vector) {\n  // Distance between 2 lines http://geomalgorithms.com/a07-_distance.html\n\n  // w(s, t) = P(s) - Q(t)\n  // The w(s, t) that has the minimum distance we will say is w(sClosest, tClosest) = wClosest\n  //\n  // wClosest is the vector that is uniquely perpendicular to the 2 line directions u & v.\n  // wClosest = w0 + sClosest * u - tClosest * v, where w0 is p0 - q0\n  //\n  // The closest point between 2 lines then satisfies this pair of equations\n  // 1: u * wClosest = 0\n  // 2: v * wClosest = 0\n  //\n  // Substituting wClosest into the equations we get\n  //\n  // 1: (u * u) * sClosest - (u * v) tClosest = -u * w0\n  // 2: (v * u) * sClosest - (v * v) tClosest = -v * w0\n\n  // simplify w0\n  const w0 = p0.sub(q0);\n\n  // simplify (u * u);\n  const a = u.dot(u);\n  // simplify (u * v);\n  const b = u.dot(v);\n  // simplify (v * v)\n  const c = v.dot(v);\n  // simplify (u * w0)\n  const d = u.dot(w0);\n  // simplify (v * w0)\n  const e = v.dot(w0);\n\n  // denominator ac - b^2\n  const denom = a * c - b * b;\n  let sDenom = denom;\n  let tDenom = denom;\n  // if denom is 0 they are parallel, use any point from either as the start in this case p0\n  if (denom === 0 || denom <= 0.01) {\n    const tClosestParallel = d / b;\n    return new Line(p0, q0.add(v.scale(tClosestParallel)));\n  }\n\n  // Solve for sClosest for infinite line\n  let sClosest = b * e - c * d; // / denom;\n\n  // Solve for tClosest for infinite line\n  let tClosest = a * e - b * d; // / denom;\n\n  // Solve for segments candidate edges, if sClosest and tClosest are outside their segments\n  if (sClosest < 0) {\n    sClosest = 0;\n    tClosest = e;\n    tDenom = c;\n  } else if (sClosest > sDenom) {\n    sClosest = sDenom;\n    tClosest = e + b;\n    tDenom = c;\n  }\n\n  if (tClosest < 0) {\n    tClosest = 0;\n    if (-d < 0) {\n      sClosest = 0;\n    } else if (-d > a) {\n      sClosest = sDenom;\n    } else {\n      sClosest = -d;\n      sDenom = a;\n    }\n  } else if (tClosest > tDenom) {\n    tClosest = tDenom;\n    if (-d + b < 0) {\n      sClosest = 0;\n    } else if (-d + b > a) {\n      sClosest = sDenom;\n    } else {\n      sClosest = -d + b;\n      sDenom = a;\n    }\n  }\n  sClosest = Math.abs(sClosest) < 0.001 ? 0 : sClosest / sDenom;\n  tClosest = Math.abs(tClosest) < 0.001 ? 0 : tClosest / tDenom;\n\n  return new Line(p0.add(u.scale(sClosest)), q0.add(v.scale(tClosest)));\n}\n\nexport const ClosestLineJumpTable = {\n  PolygonPolygonClosestLine(polygonA: ConvexPolygon, polygonB: ConvexPolygon) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = polygonB.worldPos;\n    const otherDirection = otherWorldPos.sub(polygonA.worldPos);\n    const thisDirection = otherDirection.negate();\n\n    const rayTowardsOther = new Ray(polygonA.worldPos, otherDirection);\n    const rayTowardsThis = new Ray(otherWorldPos, thisDirection);\n\n    const thisPoint = polygonA.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n    const otherPoint = polygonB.rayCast(rayTowardsThis).add(rayTowardsThis.dir.scale(0.1));\n\n    const thisFace = polygonA.getClosestFace(thisPoint);\n    const otherFace = polygonB.getClosestFace(otherPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const q0 = otherFace.face.begin;\n    const v = otherFace.face.getEdge();\n\n    return ClosestLine(p0, u, q0, v);\n  },\n\n  PolygonEdgeClosestLine(polygon: ConvexPolygon, edge: Edge) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = edge.worldPos;\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\n\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection);\n\n    const thisPoint = polygon.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n\n    const thisFace = polygon.getClosestFace(thisPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const edgeLine = edge.asLine();\n    const edgeStart = edgeLine.begin;\n    const edgeVector = edgeLine.getEdge();\n    const q0 = edgeStart;\n    const v = edgeVector;\n\n    return ClosestLine(p0, u, q0, v);\n  },\n\n  PolygonCircleClosestLine(polygon: ConvexPolygon, circle: Circle) {\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = circle.worldPos;\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\n\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection.normalize());\n\n    const thisPoint = polygon.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n\n    const thisFace = polygon.getClosestFace(thisPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // Time of minimum distance\n    let t = (u.x * (otherWorldPos.x - p0.x) + u.y * (otherWorldPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\n\n    // If time of minimum is past the edge clamp\n    if (t > 1) {\n      t = 1;\n    } else if (t < 0) {\n      t = 0;\n    }\n\n    // Minimum distance\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - otherWorldPos.x, 2) + Math.pow(p0.y + u.y * t - otherWorldPos.y, 2)) - circle.radius;\n\n    const circlex = ((p0.x + u.x * t - otherWorldPos.x) * circle.radius) / (circle.radius + d);\n    const circley = ((p0.y + u.y * t - otherWorldPos.y) * circle.radius) / (circle.radius + d);\n    return new Line(u.scale(t).add(p0), new Vector(otherWorldPos.x + circlex, otherWorldPos.y + circley));\n  },\n\n  CircleCircleClosestLine(circleA: Circle, circleB: Circle) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = circleB.worldPos;\n    const otherDirection = otherWorldPos.sub(circleA.worldPos);\n\n    const thisWorldPos = circleA.worldPos;\n    const thisDirection = thisWorldPos.sub(circleB.worldPos);\n\n    const rayTowardsOther = new Ray(circleA.worldPos, otherDirection);\n    const rayTowardsThis = new Ray(circleB.worldPos, thisDirection);\n\n    const thisPoint = circleA.rayCast(rayTowardsOther);\n    const otherPoint = circleB.rayCast(rayTowardsThis);\n\n    return new Line(thisPoint, otherPoint);\n  },\n\n  CircleEdgeClosestLine(circle: Circle, edge: Edge) {\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\n    const circleWorlPos = circle.worldPos;\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const edgeLine = edge.asLine();\n    const edgeStart = edgeLine.begin;\n    const edgeVector = edgeLine.getEdge();\n    const p0 = edgeStart;\n    const u = edgeVector;\n\n    // Time of minimum distance\n    let t = (u.x * (circleWorlPos.x - p0.x) + u.y * (circleWorlPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\n\n    // If time of minimum is past the edge clamp to edge\n    if (t > 1) {\n      t = 1;\n    } else if (t < 0) {\n      t = 0;\n    }\n\n    // Minimum distance\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - circleWorlPos.x, 2) + Math.pow(p0.y + u.y * t - circleWorlPos.y, 2)) - circle.radius;\n\n    const circlex = ((p0.x + u.x * t - circleWorlPos.x) * circle.radius) / (circle.radius + d);\n    const circley = ((p0.y + u.y * t - circleWorlPos.y) * circle.radius) / (circle.radius + d);\n    return new Line(u.scale(t).add(p0), new Vector(circleWorlPos.x + circlex, circleWorlPos.y + circley));\n  },\n\n  EdgeEdgeClosestLine(edgeA: Edge, edgeB: Edge) {\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const edgeLineA = edgeA.asLine();\n    const edgeStartA = edgeLineA.begin;\n    const edgeVectorA = edgeLineA.getEdge();\n    const p0 = edgeStartA;\n    const u = edgeVectorA;\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const edgeLineB = edgeB.asLine();\n    const edgeStartB = edgeLineB.begin;\n    const edgeVectorB = edgeLineB.getEdge();\n    const q0 = edgeStartB;\n    const v = edgeVectorB;\n\n    return ClosestLine(p0, u, q0, v);\n  }\n};\n","import { BoundingBox } from './BoundingBox';\nimport { CollisionJumpTable } from './CollisionJumpTable';\nimport { CollisionContact } from './CollisionContact';\nimport { CollisionShape } from './CollisionShape';\nimport { ConvexPolygon } from './ConvexPolygon';\nimport { Edge } from './Edge';\n\nimport { Vector, Ray, Projection, Line } from '../Algebra';\nimport { Physics } from '../Physics';\nimport { Color } from '../Drawing/Color';\nimport { Collider } from './Collider';\n\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\n\nexport interface CircleOptions {\n  /**\n   * Optional pixel offset to shift the circle relative to the collider, by default (0, 0).\n   */\n  offset?: Vector;\n  /**\n   * Required radius of the circle\n   */\n  radius: number;\n  /**\n   * Optional collider to associate with this shape\n   */\n  collider?: Collider;\n}\n\n/**\n * This is a circle collision shape for the excalibur rigid body physics simulation\n *\n * Example:\n * [[include:CircleShape.md]]\n */\nexport class Circle implements CollisionShape {\n  /**\n   * Position of the circle relative to the collider, by default (0, 0) meaning the shape is positioned on top of the collider.\n   */\n  public offset: Vector = Vector.Zero;\n\n  public get worldPos(): Vector {\n    if (this.collider && this.collider.body) {\n      return this.collider.body.pos.add(this.offset);\n    }\n    return this.offset;\n  }\n\n  /**\n   * This is the radius of the circle\n   */\n  public radius: number;\n\n  /**\n   * The collider associated for this shape, if any.\n   */\n  public collider?: Collider;\n\n  constructor(options: CircleOptions) {\n    this.offset = options.offset || Vector.Zero;\n    this.radius = options.radius || 0;\n    this.collider = options.collider || null;\n  }\n\n  /**\n   * Returns a clone of this shape, not associated with any collider\n   */\n  public clone(): Circle {\n    return new Circle({\n      offset: this.offset.clone(),\n      radius: this.radius,\n      collider: null\n    });\n  }\n\n  /**\n   * Get the center of the collision shape in world coordinates\n   */\n  public get center(): Vector {\n    if (this.collider && this.collider.body) {\n      return this.offset.add(this.collider.body.pos);\n    }\n    return this.offset;\n  }\n\n  /**\n   * Tests if a point is contained in this collision shape\n   */\n  public contains(point: Vector): boolean {\n    let pos = this.offset;\n    if (this.collider && this.collider.body) {\n      pos = this.collider.body.pos;\n    }\n    const distance = pos.distance(point);\n    if (distance <= this.radius) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Casts a ray at the Circle shape and returns the nearest point of collision\n   * @param ray\n   */\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\n    //https://en.wikipedia.org/wiki/Line%E2%80%93sphere_intersection\n    const c = this.center;\n    const dir = ray.dir;\n    const orig = ray.pos;\n\n    const discriminant = Math.sqrt(Math.pow(dir.dot(orig.sub(c)), 2) - Math.pow(orig.sub(c).distance(), 2) + Math.pow(this.radius, 2));\n\n    if (discriminant < 0) {\n      // no intersection\n      return null;\n    } else {\n      let toi = 0;\n      if (discriminant === 0) {\n        toi = -dir.dot(orig.sub(c));\n        if (toi > 0 && toi < max) {\n          return ray.getPoint(toi);\n        }\n        return null;\n      } else {\n        const toi1 = -dir.dot(orig.sub(c)) + discriminant;\n        const toi2 = -dir.dot(orig.sub(c)) - discriminant;\n\n        const positiveToi: number[] = [];\n        if (toi1 >= 0) {\n          positiveToi.push(toi1);\n        }\n\n        if (toi2 >= 0) {\n          positiveToi.push(toi2);\n        }\n\n        const mintoi = Math.min(...positiveToi);\n        if (mintoi <= max) {\n          return ray.getPoint(mintoi);\n        }\n        return null;\n      }\n    }\n  }\n\n  public getClosestLineBetween(shape: CollisionShape): Line {\n    if (shape instanceof Circle) {\n      return ClosestLineJumpTable.CircleCircleClosestLine(this, shape);\n    } else if (shape instanceof ConvexPolygon) {\n      return ClosestLineJumpTable.PolygonCircleClosestLine(shape, this).flip();\n    } else if (shape instanceof Edge) {\n      return ClosestLineJumpTable.CircleEdgeClosestLine(this, shape).flip();\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public collide(shape: CollisionShape): CollisionContact {\n    if (shape instanceof Circle) {\n      return CollisionJumpTable.CollideCircleCircle(this, shape);\n    } else if (shape instanceof ConvexPolygon) {\n      return CollisionJumpTable.CollideCirclePolygon(this, shape);\n    } else if (shape instanceof Edge) {\n      return CollisionJumpTable.CollideCircleEdge(this, shape);\n    } else {\n      throw new Error(`Circle could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * Find the point on the shape furthest in the direction specified\n   */\n  public getFurthestPoint(direction: Vector): Vector {\n    return this.center.add(direction.normalize().scale(this.radius));\n  }\n\n  /**\n   * Get the axis aligned bounding box for the circle shape in world coordinates\n   */\n  public get bounds(): BoundingBox {\n    let bodyPos = Vector.Zero;\n    if (this.collider && this.collider.body) {\n      bodyPos = this.collider.body.pos;\n    }\n    return new BoundingBox(\n      this.offset.x + bodyPos.x - this.radius,\n      this.offset.y + bodyPos.y - this.radius,\n      this.offset.x + bodyPos.x + this.radius,\n      this.offset.y + bodyPos.y + this.radius\n    );\n  }\n\n  /**\n   * Get the axis aligned bounding box for the circle shape in local coordinates\n   */\n  public get localBounds(): BoundingBox {\n    return new BoundingBox(\n      this.offset.x - this.radius,\n      this.offset.y - this.radius,\n      this.offset.x + this.radius,\n      this.offset.y + this.radius\n    );\n  }\n\n  /**\n   * Get axis not implemented on circles, since there are infinite axis in a circle\n   */\n  public get axes(): Vector[] {\n    return null;\n  }\n\n  /**\n   * Returns the moment of inertia of a circle given it's mass\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n   */\n  public get inertia(): number {\n    const mass = this.collider ? this.collider.mass : Physics.defaultMass;\n    return (mass * this.radius * this.radius) / 2;\n  }\n\n  /**\n   * Tests the separating axis theorem for circles against polygons\n   */\n  public testSeparatingAxisTheorem(polygon: ConvexPolygon): Vector {\n    const axes = polygon.axes;\n    const pc = polygon.center;\n    // Special SAT with circles\n    const closestPointOnPoly = polygon.getFurthestPoint(this.offset.sub(pc));\n    axes.push(this.offset.sub(closestPointOnPoly).normalize());\n\n    let minOverlap = Number.MAX_VALUE;\n    let minAxis = null;\n    let minIndex = -1;\n    for (let i = 0; i < axes.length; i++) {\n      const proj1 = polygon.project(axes[i]);\n      const proj2 = this.project(axes[i]);\n      const overlap = proj1.getOverlap(proj2);\n      if (overlap <= 0) {\n        return null;\n      } else {\n        if (overlap < minOverlap) {\n          minOverlap = overlap;\n          minAxis = axes[i];\n          minIndex = i;\n        }\n      }\n    }\n    if (minIndex < 0) {\n      return null;\n    }\n    return minAxis.normalize().scale(minOverlap);\n  }\n\n  /* istanbul ignore next */\n  public recalc(): void {\n    // circles don't cache\n  }\n\n  /**\n   * Project the circle along a specified axis\n   */\n  public project(axis: Vector): Projection {\n    const scalars = [];\n    const point = this.center;\n    const dotProduct = point.dot(axis);\n    scalars.push(dotProduct);\n    scalars.push(dotProduct + this.radius);\n    scalars.push(dotProduct - this.radius);\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\n    const newPos = pos.add(this.offset);\n    ctx.beginPath();\n    ctx.fillStyle = color.toString();\n    ctx.arc(newPos.x, newPos.y, this.radius, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Green) {\n    const body = this.collider.body;\n    const pos = body ? body.pos.add(this.offset) : this.offset;\n    const rotation = body ? body.rotation : 0;\n\n    ctx.beginPath();\n    ctx.strokeStyle = color.toString();\n    ctx.arc(pos.x, pos.y, this.radius, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.stroke();\n    ctx.beginPath();\n    ctx.moveTo(pos.x, pos.y);\n    ctx.lineTo(Math.cos(rotation) * this.radius + pos.x, Math.sin(rotation) * this.radius + pos.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n}\n","import { Body } from './Body';\nimport { BoundingBox } from './BoundingBox';\nimport { CollisionContact } from './CollisionContact';\nimport { CollisionJumpTable } from './CollisionJumpTable';\nimport { CollisionShape } from './CollisionShape';\nimport { Circle } from './Circle';\nimport { ConvexPolygon } from './ConvexPolygon';\n\nimport { Vector, Ray, Projection, Line } from '../Algebra';\nimport { Physics } from '../Physics';\nimport { Color } from '../Drawing/Color';\nimport { Collider } from './Collider';\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\n\nexport interface EdgeOptions {\n  /**\n   * The beginning of the edge defined in local coordinates to the collider\n   */\n  begin: Vector;\n  /**\n   * The ending of the edge defined in local coordinates to the collider\n   */\n  end: Vector;\n  /**\n   * Optionally the collider associated with this edge\n   */\n  collider?: Collider;\n}\n\n/**\n * Edge is a single line collision shape to create collisions with a single line.\n *\n * Example:\n * [[include:EdgeShape.md]]\n */\nexport class Edge implements CollisionShape {\n  body: Body;\n  collider?: Collider;\n  offset: Vector;\n  begin: Vector;\n  end: Vector;\n\n  constructor(options: EdgeOptions) {\n    this.begin = options.begin || Vector.Zero;\n    this.end = options.end || Vector.Zero;\n    this.collider = options.collider || null;\n    this.offset = this.center;\n  }\n\n  /**\n   * Returns a clone of this Edge, not associated with any collider\n   */\n  public clone(): Edge {\n    return new Edge({\n      begin: this.begin.clone(),\n      end: this.end.clone(),\n      collider: null\n    });\n  }\n\n  public get worldPos(): Vector {\n    if (this.collider && this.collider.body) {\n      return this.collider.body.pos.add(this.offset);\n    }\n    return this.offset;\n  }\n\n  /**\n   * Get the center of the collision area in world coordinates\n   */\n  public get center(): Vector {\n    const pos = this.begin.average(this.end).add(this._getBodyPos());\n    return pos;\n  }\n\n  private _getBodyPos(): Vector {\n    let bodyPos = Vector.Zero;\n    if (this.collider && this.collider.body) {\n      bodyPos = this.collider.body.pos;\n    }\n    return bodyPos;\n  }\n\n  private _getTransformedBegin(): Vector {\n    const body = this.collider ? this.collider.body : null;\n    const angle = body ? body.rotation : 0;\n    return this.begin.rotate(angle).add(this._getBodyPos());\n  }\n\n  private _getTransformedEnd(): Vector {\n    const body = this.collider ? this.collider.body : null;\n    const angle = body ? body.rotation : 0;\n    return this.end.rotate(angle).add(this._getBodyPos());\n  }\n\n  /**\n   * Returns the slope of the line in the form of a vector\n   */\n  public getSlope(): Vector {\n    const begin = this._getTransformedBegin();\n    const end = this._getTransformedEnd();\n    const distance = begin.distance(end);\n    return end.sub(begin).scale(1 / distance);\n  }\n\n  /**\n   * Returns the length of the line segment in pixels\n   */\n  public getLength(): number {\n    const begin = this._getTransformedBegin();\n    const end = this._getTransformedEnd();\n    const distance = begin.distance(end);\n    return distance;\n  }\n\n  /**\n   * Tests if a point is contained in this collision area\n   */\n  public contains(): boolean {\n    return false;\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\n    const numerator = this._getTransformedBegin().sub(ray.pos);\n\n    // Test is line and ray are parallel and non intersecting\n    if (ray.dir.cross(this.getSlope()) === 0 && numerator.cross(ray.dir) !== 0) {\n      return null;\n    }\n\n    // Lines are parallel\n    const divisor = ray.dir.cross(this.getSlope());\n    if (divisor === 0) {\n      return null;\n    }\n\n    const t = numerator.cross(this.getSlope()) / divisor;\n\n    if (t >= 0 && t <= max) {\n      const u = numerator.cross(ray.dir) / divisor / this.getLength();\n      if (u >= 0 && u <= 1) {\n        return ray.getPoint(t);\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Returns the closes line between this and another shape, from this -> shape\n   * @param shape\n   */\n  public getClosestLineBetween(shape: CollisionShape): Line {\n    if (shape instanceof Circle) {\n      return ClosestLineJumpTable.CircleEdgeClosestLine(shape, this);\n    } else if (shape instanceof ConvexPolygon) {\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(shape, this).flip();\n    } else if (shape instanceof Edge) {\n      return ClosestLineJumpTable.EdgeEdgeClosestLine(this, shape);\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public collide(shape: CollisionShape): CollisionContact {\n    if (shape instanceof Circle) {\n      return CollisionJumpTable.CollideCircleEdge(shape, this);\n    } else if (shape instanceof ConvexPolygon) {\n      return CollisionJumpTable.CollidePolygonEdge(shape, this);\n    } else if (shape instanceof Edge) {\n      return CollisionJumpTable.CollideEdgeEdge();\n    } else {\n      throw new Error(`Edge could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * Find the point on the shape furthest in the direction specified\n   */\n  public getFurthestPoint(direction: Vector): Vector {\n    const transformedBegin = this._getTransformedBegin();\n    const transformedEnd = this._getTransformedEnd();\n    if (direction.dot(transformedBegin) > 0) {\n      return transformedBegin;\n    } else {\n      return transformedEnd;\n    }\n  }\n\n  private _boundsFromBeginEnd(begin: Vector, end: Vector) {\n    return new BoundingBox(Math.min(begin.x, end.x), Math.min(begin.y, end.y), Math.max(begin.x, end.x), Math.max(begin.y, end.y));\n  }\n\n  /**\n   * Get the axis aligned bounding box for the edge shape in world space\n   */\n  public get bounds(): BoundingBox {\n    const transformedBegin = this._getTransformedBegin();\n    const transformedEnd = this._getTransformedEnd();\n    return this._boundsFromBeginEnd(transformedBegin, transformedEnd);\n  }\n\n  /**\n   * Get the axis aligned bounding box for the edge shape in local space\n   */\n  public get localBounds(): BoundingBox {\n    return this._boundsFromBeginEnd(this.begin, this.end);\n  }\n\n  /**\n   * Returns this edge represented as a line in world coordinates\n   */\n  public asLine(): Line {\n    return new Line(this._getTransformedBegin(), this._getTransformedEnd());\n  }\n\n  public asLocalLine(): Line {\n    return new Line(this.begin, this.end);\n  }\n\n  /**\n   * Get the axis associated with the edge\n   */\n  public get axes(): Vector[] {\n    const e = this._getTransformedEnd().sub(this._getTransformedBegin());\n    const edgeNormal = e.normal();\n\n    const axes = [];\n    axes.push(edgeNormal);\n    axes.push(edgeNormal.negate());\n    axes.push(edgeNormal.normal());\n    axes.push(edgeNormal.normal().negate());\n    return axes;\n  }\n\n  /**\n   * Get the moment of inertia for an edge\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n   */\n  public get inertia(): number {\n    const mass = this.collider ? this.collider.mass : Physics.defaultMass;\n    const length = this.end.sub(this.begin).distance() / 2;\n    return mass * length * length;\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public recalc(): void {\n    // edges don't have any cached data\n  }\n\n  /**\n   * Project the edge along a specified axis\n   */\n  public project(axis: Vector): Projection {\n    const scalars = [];\n\n    const points = [this._getTransformedBegin(), this._getTransformedEnd()];\n    const len = points.length;\n    for (let i = 0; i < len; i++) {\n      scalars.push(points[i].dot(axis));\n    }\n\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\n    const begin = this.begin.add(pos);\n    const end = this.end.add(pos);\n    ctx.strokeStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(begin.x, begin.y);\n    ctx.lineTo(end.x, end.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Red) {\n    const begin = this._getTransformedBegin();\n    const end = this._getTransformedEnd();\n    ctx.strokeStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(begin.x, begin.y);\n    ctx.lineTo(end.x, end.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n}\n","import { Color } from '../Drawing/Color';\nimport { Physics } from '../Physics';\nimport { BoundingBox } from './BoundingBox';\nimport { Edge } from './Edge';\nimport { CollisionJumpTable } from './CollisionJumpTable';\nimport { Circle } from './Circle';\nimport { CollisionContact } from './CollisionContact';\nimport { CollisionShape } from './CollisionShape';\nimport { Vector, Line, Ray, Projection } from '../Algebra';\nimport { Collider } from './Collider';\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\n\nexport interface ConvexPolygonOptions {\n  /**\n   * Pixel offset relative to a collider's position\n   */\n\n  offset?: Vector;\n  /**\n   * Points in the polygon in order around the perimeter in local coordinates\n   */\n  points: Vector[];\n  /**\n   * Whether points are specified in clockwise or counter clockwise order, default counter-clockwise\n   */\n  clockwiseWinding?: boolean;\n  /**\n   * Collider to associate optionally with this shape\n   */\n  collider?: Collider;\n}\n\n/**\n * Polygon collision shape for detecting collisions\n *\n * Example:\n * [[include:BoxAndPolygonShape.md]]\n */\nexport class ConvexPolygon implements CollisionShape {\n  public offset: Vector;\n  public points: Vector[];\n\n  /**\n   * Collider associated with this shape\n   */\n  public collider?: Collider;\n\n  private _transformedPoints: Vector[] = [];\n  private _axes: Vector[] = [];\n  private _sides: Line[] = [];\n\n  constructor(options: ConvexPolygonOptions) {\n    this.offset = options.offset || Vector.Zero;\n    const winding = !!options.clockwiseWinding;\n    this.points = (winding ? options.points.reverse() : options.points) || [];\n    this.collider = this.collider = options.collider || null;\n\n    // calculate initial transformation\n    this._calculateTransformation();\n  }\n\n  /**\n   * Returns a clone of this ConvexPolygon, not associated with any collider\n   */\n  public clone(): ConvexPolygon {\n    return new ConvexPolygon({\n      offset: this.offset.clone(),\n      points: this.points.map((p) => p.clone()),\n      collider: null\n    });\n  }\n\n  public get worldPos(): Vector {\n    if (this.collider && this.collider.body) {\n      return this.collider.body.pos.add(this.offset);\n    }\n    return this.offset;\n  }\n\n  /**\n   * Get the center of the collision shape in world coordinates\n   */\n  public get center(): Vector {\n    const body = this.collider ? this.collider.body : null;\n    if (body) {\n      return body.pos.add(this.offset);\n    }\n    return this.offset;\n  }\n\n  /**\n   * Calculates the underlying transformation from the body relative space to world space\n   */\n  private _calculateTransformation() {\n    const body = this.collider ? this.collider.body : null;\n    const pos = body ? body.pos.add(this.offset) : this.offset;\n    const angle = body ? body.rotation : 0;\n    const scale = body ? body.scale : Vector.One;\n\n    const len = this.points.length;\n    this._transformedPoints.length = 0; // clear out old transform\n    for (let i = 0; i < len; i++) {\n      this._transformedPoints[i] = this.points[i]\n        .scale(scale)\n        .rotate(angle)\n        .add(pos);\n    }\n  }\n\n  /**\n   * Gets the points that make up the polygon in world space, from actor relative space (if specified)\n   */\n  public getTransformedPoints(): Vector[] {\n    // only recalculate geometry if, hasn't been calculated\n    if (\n      !this._transformedPoints.length ||\n      // or the position or rotation has changed in world space\n      (this.collider &&\n        this.collider.body &&\n        (!this.collider.body.oldPos.equals(this.collider.body.pos) ||\n          this.collider.body.oldRotation !== this.collider.body.rotation ||\n          this.collider.body.oldScale !== this.collider.body.scale))\n    ) {\n      this._calculateTransformation();\n    }\n    return this._transformedPoints;\n  }\n\n  /**\n   * Gets the sides of the polygon in world space\n   */\n  public getSides(): Line[] {\n    if (this._sides.length) {\n      return this._sides;\n    }\n    const lines = [];\n    const points = this.getTransformedPoints();\n    const len = points.length;\n    for (let i = 0; i < len; i++) {\n      lines.push(new Line(points[i], points[(i - 1 + len) % len]));\n    }\n    this._sides = lines;\n    return this._sides;\n  }\n\n  public recalc(): void {\n    this._sides.length = 0;\n    this._axes.length = 0;\n    this._transformedPoints.length = 0;\n    this.getTransformedPoints();\n    this.getSides();\n  }\n\n  /**\n   * Tests if a point is contained in this collision shape in world space\n   */\n  public contains(point: Vector): boolean {\n    // Always cast to the right, as long as we cast in a consistent fixed direction we\n    // will be fine\n    const testRay = new Ray(point, new Vector(1, 0));\n    const intersectCount = this.getSides().reduce(function(accum, side) {\n      if (testRay.intersect(side) >= 0) {\n        return accum + 1;\n      }\n      return accum;\n    }, 0);\n\n    if (intersectCount % 2 === 0) {\n      return false;\n    }\n    return true;\n  }\n\n  public getClosestLineBetween(shape: CollisionShape): Line {\n    if (shape instanceof Circle) {\n      return ClosestLineJumpTable.PolygonCircleClosestLine(this, shape);\n    } else if (shape instanceof ConvexPolygon) {\n      return ClosestLineJumpTable.PolygonPolygonClosestLine(this, shape);\n    } else if (shape instanceof Edge) {\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(this, shape);\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * Returns a collision contact if the 2 collision shapes collide, otherwise collide will\n   * return null.\n   * @param shape\n   */\n  public collide(shape: CollisionShape): CollisionContact {\n    if (shape instanceof Circle) {\n      return CollisionJumpTable.CollideCirclePolygon(shape, this);\n    } else if (shape instanceof ConvexPolygon) {\n      return CollisionJumpTable.CollidePolygonPolygon(this, shape);\n    } else if (shape instanceof Edge) {\n      return CollisionJumpTable.CollidePolygonEdge(this, shape);\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * Find the point on the shape furthest in the direction specified\n   */\n  public getFurthestPoint(direction: Vector): Vector {\n    const pts = this.getTransformedPoints();\n    let furthestPoint = null;\n    let maxDistance = -Number.MAX_VALUE;\n    for (let i = 0; i < pts.length; i++) {\n      const distance = direction.dot(pts[i]);\n      if (distance > maxDistance) {\n        maxDistance = distance;\n        furthestPoint = pts[i];\n      }\n    }\n    return furthestPoint;\n  }\n\n  /**\n   * Finds the closes face to the point using perpendicular distance\n   * @param point point to test against polygon\n   */\n  public getClosestFace(point: Vector): { distance: Vector; face: Line } {\n    const sides = this.getSides();\n    let min = Number.POSITIVE_INFINITY;\n    let faceIndex = -1;\n    let distance = -1;\n    for (let i = 0; i < sides.length; i++) {\n      const dist = sides[i].distanceToPoint(point);\n      if (dist < min) {\n        min = dist;\n        faceIndex = i;\n        distance = dist;\n      }\n    }\n\n    if (faceIndex !== -1) {\n      return {\n        distance: sides[faceIndex].normal().scale(distance),\n        face: sides[faceIndex]\n      };\n    }\n\n    return null;\n  }\n\n  /**\n   * Get the axis aligned bounding box for the polygon shape in world coordinates\n   */\n  public get bounds(): BoundingBox {\n    const points = this.getTransformedPoints();\n\n    return BoundingBox.fromPoints(points);\n  }\n\n  /**\n   * Get the axis aligned bounding box for the polygon shape in local coordinates\n   */\n  public get localBounds(): BoundingBox {\n    return BoundingBox.fromPoints(this.points);\n  }\n\n  /**\n   * Get the moment of inertia for an arbitrary polygon\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n   */\n  public get inertia(): number {\n    const mass = this.collider ? this.collider.mass : Physics.defaultMass;\n    let numerator = 0;\n    let denominator = 0;\n    for (let i = 0; i < this.points.length; i++) {\n      const iplusone = (i + 1) % this.points.length;\n      const crossTerm = this.points[iplusone].cross(this.points[i]);\n      numerator +=\n        crossTerm *\n        (this.points[i].dot(this.points[i]) + this.points[i].dot(this.points[iplusone]) + this.points[iplusone].dot(this.points[iplusone]));\n      denominator += crossTerm;\n    }\n    return (mass / 6) * (numerator / denominator);\n  }\n\n  /**\n   * Casts a ray into the polygon and returns a vector representing the point of contact (in world space) or null if no collision.\n   */\n  public rayCast(ray: Ray, max: number = Infinity) {\n    // find the minimum contact time greater than 0\n    // contact times less than 0 are behind the ray and we don't want those\n    const sides = this.getSides();\n    const len = sides.length;\n    let minContactTime = Number.MAX_VALUE;\n    let contactIndex = -1;\n    for (let i = 0; i < len; i++) {\n      const contactTime = ray.intersect(sides[i]);\n      if (contactTime >= 0 && contactTime < minContactTime && contactTime <= max) {\n        minContactTime = contactTime;\n        contactIndex = i;\n      }\n    }\n\n    // contact was found\n    if (contactIndex >= 0) {\n      return ray.getPoint(minContactTime);\n    }\n\n    // no contact found\n    return null;\n  }\n\n  /**\n   * Get the axis associated with the convex polygon\n   */\n  public get axes(): Vector[] {\n    if (this._axes.length) {\n      return this._axes;\n    }\n\n    const axes = [];\n    const points = this.getTransformedPoints();\n    const len = points.length;\n    for (let i = 0; i < len; i++) {\n      axes.push(points[i].sub(points[(i + 1) % len]).normal());\n    }\n    this._axes = axes;\n    return this._axes;\n  }\n\n  /**\n   * Perform Separating Axis test against another polygon, returns null if no overlap in polys\n   * Reference http://www.dyn4j.org/2010/01/sat/\n   */\n  public testSeparatingAxisTheorem(other: ConvexPolygon): Vector {\n    const poly1 = this;\n    const poly2 = other;\n    const axes = poly1.axes.concat(poly2.axes);\n\n    let minOverlap = Number.MAX_VALUE;\n    let minAxis = null;\n    let minIndex = -1;\n    for (let i = 0; i < axes.length; i++) {\n      const proj1 = poly1.project(axes[i]);\n      const proj2 = poly2.project(axes[i]);\n      const overlap = proj1.getOverlap(proj2);\n      if (overlap <= 0) {\n        return null;\n      } else {\n        if (overlap < minOverlap) {\n          minOverlap = overlap;\n          minAxis = axes[i];\n          minIndex = i;\n        }\n      }\n    }\n\n    // Sanity check\n    if (minIndex === -1) {\n      return null;\n    }\n\n    return minAxis.normalize().scale(minOverlap);\n  }\n\n  /**\n   * Project the edges of the polygon along a specified axis\n   */\n  public project(axis: Vector): Projection {\n    const points = this.getTransformedPoints();\n    const len = points.length;\n    let min = Number.MAX_VALUE;\n    let max = -Number.MAX_VALUE;\n    for (let i = 0; i < len; i++) {\n      const scalar = points[i].dot(axis);\n      min = Math.min(min, scalar);\n      max = Math.max(max, scalar);\n    }\n\n    return new Projection(min, max);\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\n    ctx.beginPath();\n    ctx.fillStyle = color.toString();\n    const newPos = pos.add(this.offset);\n    // Iterate through the supplied points and construct a 'polygon'\n    const firstPoint = this.points[0].add(newPos);\n    ctx.moveTo(firstPoint.x, firstPoint.y);\n    this.points\n      .map((p) => p.add(newPos))\n      .forEach(function(point) {\n        ctx.lineTo(point.x, point.y);\n      });\n    ctx.lineTo(firstPoint.x, firstPoint.y);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Red) {\n    ctx.beginPath();\n    ctx.strokeStyle = color.toString();\n    // Iterate through the supplied points and construct a 'polygon'\n    const firstPoint = this.getTransformedPoints()[0];\n    ctx.moveTo(firstPoint.x, firstPoint.y);\n    this.getTransformedPoints().forEach(function(point) {\n      ctx.lineTo(point.x, point.y);\n    });\n    ctx.lineTo(firstPoint.x, firstPoint.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n}\n","import { ConvexPolygon } from './ConvexPolygon';\nimport { Circle } from './Circle';\nimport { Edge } from './Edge';\nimport { BoundingBox } from './BoundingBox';\nimport { Vector } from '../Algebra';\n\n/**\n * Excalibur shape helper for defining collision shapes quickly\n */\nexport class Shape {\n  /**\n   * Creates a box collision shape, under the hood defines a [[ConvexPolygon]] collision shape\n   * @param width Width of the box\n   * @param height Height of the box\n   * @param anchor Anchor of the box (default (.5, .5)) which positions the box relative to the center of the collider's position\n   * @param offset Optional offset relative to the collider in local coordinates\n   */\n  static Box(width: number, height: number, anchor: Vector = Vector.Half, offset: Vector = Vector.Zero): ConvexPolygon {\n    return new ConvexPolygon({\n      points: new BoundingBox(-width * anchor.x, -height * anchor.y, width - width * anchor.x, height - height * anchor.y).getPoints(),\n      offset: offset\n    });\n  }\n\n  /**\n   * Creates a new [[ConvexPolygon|arbitrary polygon]] collision shape\n   * @param points Points specified in counter clockwise\n   * @param clockwiseWinding Optionally changed the winding of points, by default false meaning counter-clockwise winding.\n   * @param offset Optional offset relative to the collider in local coordinates\n   */\n  static Polygon(points: Vector[], clockwiseWinding: boolean = false, offset: Vector = Vector.Zero): ConvexPolygon {\n    return new ConvexPolygon({\n      points: points,\n      offset: offset,\n      clockwiseWinding: clockwiseWinding\n    });\n  }\n\n  /**\n   * Creates a new [[circle|Circle]] collision shape\n   * @param radius Radius of the circle shape\n   * @param offset Optional offset relative to the collider in local coordinates\n   */\n  static Circle(radius: number, offset: Vector = Vector.Zero): Circle {\n    return new Circle({\n      radius: radius,\n      offset: offset\n    });\n  }\n\n  /**\n   * Creates a new [[Edge|edge]] collision shape\n   * @param begin Beginning of the edge in local coordinates to the collider\n   * @param end Ending of the edge in local coordinates to the collider\n   */\n  static Edge(begin: Vector, end: Vector): Edge {\n    return new Edge({\n      begin: begin,\n      end: end\n    });\n  }\n}\n","import { Vector } from '../Algebra';\nimport { Actor } from '../Actor';\nimport { Collider } from './Collider';\nimport { CollisionType } from './CollisionType';\nimport { Physics } from '../Physics';\nimport { PreCollisionEvent, PostCollisionEvent, CollisionStartEvent, CollisionEndEvent } from '../Events';\nimport { Clonable } from '../Interfaces/Clonable';\nimport { Shape } from './Shape';\n\nexport interface BodyOptions {\n  /**\n   * Optionally the actor associated with this body\n   */\n  actor?: Actor;\n  /**\n   * An optional collider to use in this body, if none is specified a default Box collider will be created.\n   */\n  collider?: Collider;\n}\n\n/**\n * Body describes all the physical properties pos, vel, acc, rotation, angular velocity\n */\nexport class Body implements Clonable<Body> {\n  private _collider: Collider;\n  public actor: Actor;\n  /**\n   * Constructs a new physics body associated with an actor\n   */\n  constructor({ actor, collider }: BodyOptions) {\n    if (!actor && !collider) {\n      throw new Error('An actor or collider are required to create a body');\n    }\n\n    this.actor = actor;\n    if (!collider && actor) {\n      this.collider = this.useBoxCollider(actor.width, actor.height, actor.anchor);\n    } else {\n      this.collider = collider;\n    }\n  }\n\n  public get id() {\n    return this.actor ? this.actor.id : -1;\n  }\n\n  /**\n   * Returns a clone of this body, not associated with any actor\n   */\n  public clone() {\n    return new Body({\n      actor: null,\n      collider: this.collider.clone()\n    });\n  }\n\n  public get active() {\n    return this.actor ? !this.actor.isKilled() : false;\n  }\n\n  public get center() {\n    return this.pos;\n  }\n\n  // TODO allow multiple colliders for a single body\n  public set collider(collider: Collider) {\n    if (collider) {\n      this._collider = collider;\n      this._collider.body = this;\n      this._wireColliderEventsToActor();\n    }\n  }\n\n  public get collider(): Collider {\n    return this._collider;\n  }\n\n  /**\n   * The (x, y) position of the actor this will be in the middle of the actor if the\n   * [[Actor.anchor]] is set to (0.5, 0.5) which is default.\n   * If you want the (x, y) position to be the top left of the actor specify an anchor of (0, 0).\n   */\n  public pos: Vector = new Vector(0, 0);\n\n  /**\n   * The position of the actor last frame (x, y) in pixels\n   */\n  public oldPos: Vector = new Vector(0, 0);\n\n  /**\n   * The current velocity vector (vx, vy) of the actor in pixels/second\n   */\n  public vel: Vector = new Vector(0, 0);\n\n  /**\n   * The velocity of the actor last frame (vx, vy) in pixels/second\n   */\n  public oldVel: Vector = new Vector(0, 0);\n\n  /**\n   * The current acceleration vector (ax, ay) of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may\n   * be useful to simulate a gravitational effect.\n   */\n  public acc: Vector = new Vector(0, 0);\n\n  /**\n   * Gets/sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\n   */\n  public oldAcc: Vector = Vector.Zero;\n\n  /**\n   * The current torque applied to the actor\n   */\n  public torque: number = 0;\n\n  /**\n   * The current \"motion\" of the actor, used to calculated sleep in the physics simulation\n   */\n  public motion: number = 10;\n\n  /**\n   * Gets/sets the rotation of the body from the last frame.\n   */\n  public oldRotation: number = 0; // radians\n\n  /**\n   * The rotation of the actor in radians\n   */\n  public rotation: number = 0; // radians\n\n  /**\n   * The scale vector of the actor\n   * @obsolete ex.Body.scale will be removed in v0.25.0\n   */\n  public scale: Vector = Vector.One;\n\n  /**\n   * The scale of the actor last frame\n   * @obsolete ex.Body.scale will be removed in v0.25.0\n   */\n  public oldScale: Vector = Vector.One;\n\n  /**\n   * The x scalar velocity of the actor in scale/second\n   * @obsolete ex.Body.scale will be removed in v0.25.0\n   */\n  public sx: number = 0; //scale/sec\n  /**\n   * The y scalar velocity of the actor in scale/second\n   * @obsolete ex.Body.scale will be removed in v0.25.0\n   */\n  public sy: number = 0; //scale/sec\n\n  /**\n   * The rotational velocity of the actor in radians/second\n   */\n  public rx: number = 0; //radians/sec\n\n  private _geometryDirty = false;\n\n  private _totalMtv: Vector = Vector.Zero;\n\n  /**\n   * Add minimum translation vectors accumulated during the current frame to resolve collisions.\n   */\n  public addMtv(mtv: Vector) {\n    this._totalMtv.addEqual(mtv);\n  }\n\n  /**\n   * Applies the accumulated translation vectors to the actors position\n   */\n  public applyMtv(): void {\n    this.pos.addEqual(this._totalMtv);\n    this._totalMtv.setTo(0, 0);\n  }\n\n  /**\n   * Flags the shape dirty and must be recalculated in world space\n   */\n  public markCollisionShapeDirty() {\n    this._geometryDirty = true;\n  }\n\n  public get isColliderShapeDirty(): boolean {\n    return this._geometryDirty;\n  }\n\n  /**\n   * Sets the old versions of pos, vel, acc, and scale.\n   */\n  public captureOldTransform() {\n    // Capture old values before integration step updates them\n    this.oldVel.setTo(this.vel.x, this.vel.y);\n    this.oldPos.setTo(this.pos.x, this.pos.y);\n    this.oldAcc.setTo(this.acc.x, this.acc.y);\n    this.oldScale.setTo(this.scale.x, this.scale.y);\n    this.oldRotation = this.rotation;\n  }\n\n  /**\n   * Perform euler integration at the specified time step\n   */\n  public integrate(delta: number) {\n    // Update placements based on linear algebra\n    const seconds = delta / 1000;\n\n    const totalAcc = this.acc.clone();\n    // Only active vanilla actors are affected by global acceleration\n    if (this.collider.type === CollisionType.Active) {\n      totalAcc.addEqual(Physics.acc);\n    }\n\n    this.vel.addEqual(totalAcc.scale(seconds));\n    this.pos.addEqual(this.vel.scale(seconds)).addEqual(totalAcc.scale(0.5 * seconds * seconds));\n\n    this.rx += this.torque * (1.0 / this.collider.inertia) * seconds;\n    this.rotation += this.rx * seconds;\n\n    this.scale.x += (this.sx * delta) / 1000;\n    this.scale.y += (this.sy * delta) / 1000;\n\n    if (!this.scale.equals(this.oldScale)) {\n      // change in scale effects the geometry\n      this._geometryDirty = true;\n    }\n\n    // Update colliders\n    this.collider.update();\n    this._geometryDirty = false;\n  }\n\n  /**\n   * Sets up a box geometry based on the current bounds of the associated actor of this physics body.\n   *\n   * If no width/height are specified the body will attempt to use the associated actor's width/height.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  public useBoxCollider(width?: number, height?: number, anchor: Vector = Vector.Half, center: Vector = Vector.Zero): Collider {\n    if (width === null || width === undefined) {\n      width = this.actor ? this.actor.width : 0;\n    }\n    if (height === null || height === undefined) {\n      height = this.actor ? this.actor.height : 0;\n    }\n\n    this.collider.shape = Shape.Box(width, height, anchor, center);\n    return this.collider;\n  }\n\n  /**\n   * Sets up a [[ConvexPolygon|convex polygon]] collision geometry based on a list of of points relative\n   *  to the anchor of the associated actor\n   * of this physics body.\n   *\n   * Only [convex polygon](https://en.wikipedia.org/wiki/Convex_polygon) definitions are supported.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  public usePolygonCollider(points: Vector[], center: Vector = Vector.Zero): Collider {\n    this.collider.shape = Shape.Polygon(points, false, center);\n    return this.collider;\n  }\n\n  /**\n   * Sets up a [[Circle|circle collision geometry]] with a specified radius in pixels.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  public useCircleCollider(radius: number, center: Vector = Vector.Zero): Collider {\n    this.collider.shape = Shape.Circle(radius, center);\n    return this.collider;\n  }\n\n  /**\n   * Sets up an [[Edge|edge collision geometry]] with a start point and an end point relative to the anchor of the associated actor\n   * of this physics body.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  public useEdgeCollider(begin: Vector, end: Vector): Collider {\n    this.collider.shape = Shape.Edge(begin, end);\n    return this.collider;\n  }\n\n  // TODO remove this, eventually events will stay local to the thing they are around\n  private _wireColliderEventsToActor() {\n    this.collider.clear();\n    this.collider.on('precollision', (evt: PreCollisionEvent<Collider>) => {\n      if (this.actor) {\n        this.actor.emit('precollision', new PreCollisionEvent(evt.target.body.actor, evt.other.body.actor, evt.side, evt.intersection));\n      }\n    });\n    this.collider.on('postcollision', (evt: PostCollisionEvent<Collider>) => {\n      if (this.actor) {\n        this.actor.emit('postcollision', new PostCollisionEvent(evt.target.body.actor, evt.other.body.actor, evt.side, evt.intersection));\n      }\n    });\n    this.collider.on('collisionstart', (evt: CollisionStartEvent<Collider>) => {\n      if (this.actor) {\n        this.actor.emit('collisionstart', new CollisionStartEvent(evt.target.body.actor, evt.other.body.actor, evt.pair));\n      }\n    });\n    this.collider.on('collisionend', (evt: CollisionEndEvent<Collider>) => {\n      if (this.actor) {\n        this.actor.emit('collisionend', new CollisionEndEvent(evt.target.body.actor, evt.other.body.actor));\n      }\n    });\n  }\n}\n","import { Trait } from '../Interfaces/Trait';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { Vector } from '../Algebra';\nimport { Side } from '../Collision/Side';\nimport { PreCollisionEvent, PostCollisionEvent } from '../Events';\nimport { CollisionType } from '../Collision/CollisionType';\nimport { BoundingBox } from '../Collision/Index';\n\nexport class TileMapCollisionDetection implements Trait {\n  public update(actor: Actor, engine: Engine) {\n    const eventDispatcher = actor.eventDispatcher;\n    if (actor.body.collider.type !== CollisionType.PreventCollision && engine.currentScene && engine.currentScene.tileMaps) {\n      for (let j = 0; j < engine.currentScene.tileMaps.length; j++) {\n        const map = engine.currentScene.tileMaps[j];\n        let intersectMap: Vector;\n        let side = Side.None;\n        let max = 2;\n        while ((intersectMap = map.collides(actor))) {\n          if (max-- < 0) {\n            break;\n          }\n          side = BoundingBox.getSideFromIntersection(intersectMap);\n          eventDispatcher.emit('precollision', new PreCollisionEvent(actor, null, side, intersectMap));\n          if (actor.body.collider.type === CollisionType.Active) {\n            actor.pos.y += intersectMap.y;\n            actor.pos.x += intersectMap.x;\n            eventDispatcher.emit('postcollision', new PostCollisionEvent(actor, null, side, intersectMap));\n          }\n        }\n      }\n    }\n  }\n}\n","import { Vector } from '../Algebra';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { Color } from '../Drawing/Color';\n\nexport class CullingBox {\n  private _topLeft: Vector = new Vector(0, 0);\n  private _topRight: Vector = new Vector(0, 0);\n  private _bottomLeft: Vector = new Vector(0, 0);\n  private _bottomRight: Vector = new Vector(0, 0);\n\n  private _xCoords: Array<number>;\n  private _yCoords: Array<number>;\n  private _xMin: number;\n  private _yMin: number;\n  private _xMax: number;\n  private _yMax: number;\n\n  private _xMinWorld: number;\n  private _yMinWorld: number;\n  private _xMaxWorld: number;\n  private _yMaxWorld: number;\n\n  public isSpriteOffScreen(actor: Actor, engine: Engine): boolean {\n    const drawingWidth = actor.currentDrawing.drawWidth;\n    const drawingHeight = actor.currentDrawing.drawHeight;\n    const rotation = actor.rotation;\n    const anchor = actor.center;\n    const worldPos = actor.getWorldPos();\n\n    this._topLeft.x = worldPos.x - drawingWidth / 2;\n    this._topLeft.y = worldPos.y - drawingHeight / 2;\n    this._topLeft = this._topLeft.rotate(rotation, anchor);\n\n    this._topRight.x = worldPos.x + drawingWidth / 2;\n    this._topRight.y = worldPos.y - drawingHeight / 2;\n    this._topRight = this._topRight.rotate(rotation, anchor);\n\n    this._bottomLeft.x = worldPos.x - drawingWidth / 2;\n    this._bottomLeft.y = worldPos.y + drawingHeight / 2;\n    this._bottomLeft = this._bottomLeft.rotate(rotation, anchor);\n\n    this._bottomRight.x = worldPos.x + drawingWidth / 2;\n    this._bottomRight.y = worldPos.y + drawingHeight / 2;\n    this._bottomRight = this._bottomRight.rotate(rotation, anchor);\n\n    ///\n\n    const topLeftScreen = engine.worldToScreenCoordinates(this._topLeft);\n    const topRightScreen = engine.worldToScreenCoordinates(this._topRight);\n    const bottomLeftScreen = engine.worldToScreenCoordinates(this._bottomLeft);\n    const bottomRightScreen = engine.worldToScreenCoordinates(this._bottomRight);\n    this._xCoords = [];\n    this._yCoords = [];\n\n    this._xCoords.push(topLeftScreen.x, topRightScreen.x, bottomLeftScreen.x, bottomRightScreen.x);\n    this._yCoords.push(topLeftScreen.y, topRightScreen.y, bottomLeftScreen.y, bottomRightScreen.y);\n\n    this._xMin = Math.min.apply(null, this._xCoords);\n    this._yMin = Math.min.apply(null, this._yCoords);\n    this._xMax = Math.max.apply(null, this._xCoords);\n    this._yMax = Math.max.apply(null, this._yCoords);\n\n    const minWorld = engine.screenToWorldCoordinates(new Vector(this._xMin, this._yMin));\n    const maxWorld = engine.screenToWorldCoordinates(new Vector(this._xMax, this._yMax));\n    this._xMinWorld = minWorld.x;\n    this._yMinWorld = minWorld.y;\n    this._xMaxWorld = maxWorld.x;\n    this._yMaxWorld = maxWorld.y;\n\n    const boundingPoints = [\n      new Vector(this._xMin, this._yMin), // top left\n      new Vector(this._xMax, this._yMin), // top right\n      new Vector(this._xMin, this._yMax), // bottom left\n      new Vector(this._xMax, this._yMax) // bottom right\n    ];\n\n    // sprite can be wider than canvas screen (and still visible within canvas)\n    // top or bottom of sprite must be within canvas\n    if (\n      boundingPoints[0].x < 0 &&\n      boundingPoints[1].x > engine.canvas.clientWidth &&\n      (boundingPoints[0].y > 0 || boundingPoints[2].y < engine.canvas.clientHeight)\n    ) {\n      return false;\n    }\n\n    // sprite can be taller than canvas screen (and still visible within canvas)\n    // left or right of sprite must be within canvas\n    if (\n      boundingPoints[0].y < 0 &&\n      boundingPoints[2].y > engine.canvas.clientHeight &&\n      (boundingPoints[1].x > 0 || boundingPoints[0].x < engine.canvas.clientWidth)\n    ) {\n      return false;\n    }\n\n    // otherwise if any corner is visible, we're not offscreen\n    for (let i = 0; i < boundingPoints.length; i++) {\n      if (\n        boundingPoints[i].x > 0 &&\n        boundingPoints[i].y > 0 &&\n        boundingPoints[i].x < engine.canvas.clientWidth &&\n        boundingPoints[i].y < engine.canvas.clientHeight\n      ) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    // bounding rectangle\n    ctx.beginPath();\n    ctx.strokeStyle = Color.White.toString();\n    ctx.rect(this._xMinWorld, this._yMinWorld, this._xMaxWorld - this._xMinWorld, this._yMaxWorld - this._yMinWorld);\n    ctx.stroke();\n\n    ctx.fillStyle = Color.Red.toString();\n    ctx.beginPath();\n    ctx.arc(this._topLeft.x, this._topLeft.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Green.toString();\n    ctx.beginPath();\n    ctx.arc(this._topRight.x, this._topRight.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Blue.toString();\n    ctx.beginPath();\n    ctx.arc(this._bottomLeft.x, this._bottomLeft.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Magenta.toString();\n    ctx.beginPath();\n    ctx.arc(this._bottomRight.x, this._bottomRight.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n  }\n}\n","import { CullingBox } from './../Util/CullingBox';\nimport { Trait } from '../Interfaces/Trait';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { ExitViewPortEvent, EnterViewPortEvent } from '../Events';\n\nexport class OffscreenCulling implements Trait {\n  public cullingBox: CullingBox = new CullingBox();\n\n  public update(actor: Actor, engine: Engine) {\n    const events = actor.eventDispatcher;\n\n    let isSpriteOffScreen = true;\n    if (actor.currentDrawing != null) {\n      isSpriteOffScreen = this.cullingBox.isSpriteOffScreen(actor, engine);\n    }\n\n    let actorBoundsOffscreen = false;\n    if (engine && engine.currentScene && engine.currentScene.camera && engine.currentScene.camera.viewport) {\n      actorBoundsOffscreen = !engine.currentScene.camera.viewport.intersect(actor.body.collider.bounds);\n    }\n\n    if (!actor.isOffScreen) {\n      if (actorBoundsOffscreen && isSpriteOffScreen) {\n        events.emit('exitviewport', new ExitViewPortEvent(actor));\n        actor.isOffScreen = true;\n      }\n    } else {\n      if (!actorBoundsOffscreen || !isSpriteOffScreen) {\n        events.emit('enterviewport', new EnterViewPortEvent(actor));\n        actor.isOffScreen = false;\n      }\n    }\n  }\n}\n","import { Trait } from '../Interfaces/Trait';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\n\nexport interface CapturePointerConfig {\n  /**\n   * Capture PointerMove events (may be expensive!)\n   */\n  captureMoveEvents: boolean;\n\n  /**\n   * Capture PointerDrag events (may be expensive!)\n   */\n  captureDragEvents: boolean;\n}\n\n/**\n * Revises pointer events path accordingly to the actor\n */\nexport class CapturePointer implements Trait {\n  public update(actor: Actor, engine: Engine) {\n    if (!actor.enableCapturePointer) {\n      return;\n    }\n    if (actor.isKilled()) {\n      return;\n    }\n\n    engine.input.pointers.checkAndUpdateActorUnderPointer(actor);\n  }\n}\n","import { Color } from '../Drawing/Color';\nimport { Vector } from '../Algebra';\n\n/**\n * A canvas linecap style. \"butt\" is the default flush style, \"round\" is a semi-circle cap with a radius half the width of\n * the line, and \"square\" is a rectangle that is an equal width and half height cap.\n */\nexport type LineCapStyle = 'butt' | 'round' | 'square';\n\n/**\n * Draw a line on canvas context\n *\n * @param ctx The canvas context\n * @param color The color of the line\n * @param x1 The start x coordinate\n * @param y1 The start y coordinate\n * @param x2 The ending x coordinate\n * @param y2 The ending y coordinate\n * @param thickness The line thickness\n * @param cap The [[LineCapStyle]] (butt, round, or square)\n */\n/* istanbul ignore next */\nexport function line(\n  ctx: CanvasRenderingContext2D,\n  color: Color = Color.Red,\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number,\n  thickness: number = 1,\n  cap: LineCapStyle = 'butt'\n) {\n  ctx.beginPath();\n  ctx.lineWidth = thickness;\n  ctx.lineCap = cap;\n  ctx.strokeStyle = color.toString();\n  ctx.moveTo(x1, y1);\n  ctx.lineTo(x2, y2);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/**\n * Draw the vector as a point onto the canvas.\n */\n/* istanbul ignore next */\nexport function point(ctx: CanvasRenderingContext2D, color: Color = Color.Red, point: Vector): void {\n  ctx.beginPath();\n  ctx.strokeStyle = color.toString();\n  ctx.arc(point.x, point.y, 5, 0, Math.PI * 2);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/**\n * Draw the vector as a line onto the canvas starting a origin point.\n */\n/* istanbul ignore next */\nexport function vector(ctx: CanvasRenderingContext2D, color: Color, origin: Vector, vector: Vector, scale: number = 1.0): void {\n  const c = color ? color.toString() : 'blue';\n  const v = vector.scale(scale);\n  ctx.beginPath();\n  ctx.strokeStyle = c;\n  ctx.moveTo(origin.x, origin.y);\n  ctx.lineTo(origin.x + v.x, origin.y + v.y);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/**\n * Represents border radius values\n */\nexport interface BorderRadius {\n  /**\n   * Top-left\n   */\n  tl: number;\n  /**\n   * Top-right\n   */\n  tr: number;\n  /**\n   * Bottom-right\n   */\n  br: number;\n  /**\n   * Bottom-left\n   */\n  bl: number;\n}\n\n/**\n * Draw a round rectangle on a canvas context\n *\n * @param ctx The canvas context\n * @param x The top-left x coordinate\n * @param y The top-left y coordinate\n * @param width The width of the rectangle\n * @param height The height of the rectangle\n * @param radius The border radius of the rectangle\n * @param fill The [[Color]] to fill rectangle with\n * @param stroke The [[Color]] to stroke rectangle with\n */\nexport function roundRect(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  radius: number | BorderRadius = 5,\n  stroke: Color = Color.White,\n  fill: Color = null\n) {\n  let br: BorderRadius;\n\n  if (typeof radius === 'number') {\n    br = { tl: radius, tr: radius, br: radius, bl: radius };\n  } else {\n    const defaultRadius: BorderRadius = { tl: 0, tr: 0, br: 0, bl: 0 };\n\n    for (const prop in defaultRadius) {\n      if (defaultRadius.hasOwnProperty(prop)) {\n        const side = <keyof BorderRadius>prop;\n        br[side] = radius[side] || defaultRadius[side];\n      }\n    }\n  }\n\n  ctx.beginPath();\n  ctx.moveTo(x + br.tl, y);\n  ctx.lineTo(x + width - br.tr, y);\n  ctx.quadraticCurveTo(x + width, y, x + width, y + br.tr);\n  ctx.lineTo(x + width, y + height - br.br);\n  ctx.quadraticCurveTo(x + width, y + height, x + width - br.br, y + height);\n  ctx.lineTo(x + br.bl, y + height);\n  ctx.quadraticCurveTo(x, y + height, x, y + height - br.bl);\n  ctx.lineTo(x, y + br.tl);\n  ctx.quadraticCurveTo(x, y, x + br.tl, y);\n  ctx.closePath();\n\n  if (fill) {\n    ctx.fillStyle = fill.toString();\n    ctx.fill();\n  }\n\n  if (stroke) {\n    ctx.strokeStyle = stroke.toString();\n    ctx.stroke();\n  }\n}\n\nexport function circle(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  radius: number,\n  stroke: Color = Color.White,\n  fill: Color = null\n) {\n  ctx.beginPath();\n  ctx.arc(x, y, radius, 0, Math.PI * 2);\n  ctx.closePath();\n\n  if (fill) {\n    ctx.fillStyle = fill.toString();\n    ctx.fill();\n  }\n\n  if (stroke) {\n    ctx.strokeStyle = stroke.toString();\n    ctx.stroke();\n  }\n}\n","/**\n * CollisionGroups indicate like members that do not collide with each other. Use [[CollisionGroupManager]] to create [[CollisionGroup]]s\n *\n * For example:\n *\n * Players have collision group \"player\"\n *\n * ![Player Collision Group](/assets/images/docs/CollisionGroupsPlayer.png)\n *\n * Enemies have collision group \"enemy\"\n *\n * ![Enemy Collision Group](/assets/images/docs/CollisionGroupsEnemy.png)\n *\n * Blocks have collision group \"ground\"\n *\n * ![Ground collision group](/assets/images/docs/CollisionGroupsGround.png)\n *\n * Players don't collide with each other, but enemies and blocks. Likewise, enemies don't collide with each other but collide\n * with players and blocks.\n *\n * This is done with bitmasking, see the following pseudo-code\n *\n * PlayerGroup = `0b001`\n * PlayerGroupMask = `0b110`\n *\n * EnemyGroup = `0b010`\n * EnemyGroupMask = `0b101`\n *\n * BlockGroup = `0b100`\n * BlockGroupMask = `0b011`\n *\n * Should Players collide? No because the bitwise mask evaluates to 0\n * `(player1.group & player2.mask) === 0`\n * `(0b001 & 0b110) === 0`\n *\n * Should Players and Enemies collide? Yes because the bitwise mask is non-zero\n * `(player1.group & enemy1.mask) === 1`\n * `(0b001 & 0b101) === 1`\n *\n * Should Players and Blocks collide? Yes because the bitwise mask is non-zero\n * `(player1.group & blocks1.mask) === 1`\n * `(0b001 & 0b011) === 1`\n */\nexport class CollisionGroup {\n  /**\n   * The `All` [[CollisionGroup]] is a special group that collides with all other groups including itself,\n   * it is the default collision group on colliders.\n   */\n  public static All = new CollisionGroup('Collide with all groups', -1, -1);\n\n  private _name: string;\n  private _category: number;\n  private _mask: number;\n\n  /**\n   * **STOP!!** It is preferred that [[CollisionGroupManager.create]] is used to create collision groups\n   *  unless you know how to construct the proper bitmasks. See https://github.com/excaliburjs/Excalibur/issues/1091 for more info.\n   * @param name Name of the collision group\n   * @param category 32 bit category for the group, should be a unique power of 2. For example `0b001` or `0b010`\n   * @param mask 32 bit mask of category, or `~category` generally. For a category of `0b001`, the mask would be `0b110`\n   */\n  constructor(name: string, category: number, mask: number) {\n    this._name = name;\n    this._category = category;\n    this._mask = mask;\n  }\n\n  /**\n   * Get the name of the collision group\n   */\n  public get name() {\n    return this._name;\n  }\n\n  /**\n   * Get the category of the collision group, a 32 bit number which should be a unique power of 2\n   */\n  public get category() {\n    return this._category;\n  }\n\n  /**\n   * Get the mask for this collision group\n   */\n  public get mask() {\n    return this._mask;\n  }\n\n  /**\n   * Evaluates whether 2 collision groups can collide\n   * @param other  CollisionGroup\n   */\n  public canCollide(other: CollisionGroup): boolean {\n    return (this.category & other.mask) !== 0 && (other.category & this.mask) !== 0;\n  }\n}\n","import { Physics } from './../Physics';\nimport { Color } from './../Drawing/Color';\nimport { CollisionContact } from './CollisionContact';\nimport { CollisionResolutionStrategy } from '../Physics';\nimport * as DrawUtil from '../Util/DrawUtil';\nimport { CollisionType } from './CollisionType';\nimport { Collider } from './Collider';\n\n/**\n * Models a potential collision between 2 bodies\n */\nexport class Pair {\n  public id: string = null;\n  public collision: CollisionContact = null;\n\n  constructor(public colliderA: Collider, public colliderB: Collider) {\n    this.id = Pair.calculatePairHash(colliderA, colliderB);\n  }\n\n  public static canCollide(colliderA: Collider, colliderB: Collider) {\n    // If both are in the same collision group short circuit\n    if (!colliderA.group.canCollide(colliderB.group)) {\n      return false;\n    }\n\n    // if both are fixed short circuit\n    if (colliderA.type === CollisionType.Fixed && colliderB.type === CollisionType.Fixed) {\n      return false;\n    }\n\n    // if the either is prevent collision short circuit\n    if (colliderB.type === CollisionType.PreventCollision || colliderA.type === CollisionType.PreventCollision) {\n      return false;\n    }\n\n    // if either is dead short circuit\n    if (!colliderA.active || !colliderB.active) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Returns whether or not it is possible for the pairs to collide\n   */\n  public get canCollide(): boolean {\n    const actorA = this.colliderA;\n    const actorB = this.colliderB;\n    return Pair.canCollide(actorA, actorB);\n  }\n\n  /**\n   * Runs the collision intersection logic on the members of this pair\n   */\n  public collide() {\n    this.collision = this.colliderA.collide(this.colliderB);\n  }\n\n  /**\n   * Resolves the collision body position and velocity if a collision occurred\n   */\n  public resolve(strategy: CollisionResolutionStrategy) {\n    if (this.collision) {\n      this.collision.resolve(strategy);\n    }\n  }\n\n  /**\n   * Calculates the unique pair hash id for this collision pair\n   */\n  public static calculatePairHash(colliderA: Collider, colliderB: Collider): string {\n    if (colliderA.id < colliderB.id) {\n      return `#${colliderA.id}+${colliderB.id}`;\n    } else {\n      return `#${colliderB.id}+${colliderA.id}`;\n    }\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    if (this.collision) {\n      if (Physics.showContacts) {\n        DrawUtil.point(ctx, Color.Red, this.collision.point);\n      }\n      if (Physics.showCollisionNormals) {\n        DrawUtil.vector(ctx, Color.Cyan, this.collision.point, this.collision.normal, 30);\n      }\n    }\n  }\n}\n","import { Color } from '../Drawing/Color';\nimport * as DrawUtil from '../Util/DrawUtil';\nimport { Eventable } from '../Interfaces/Index';\nimport { GameEvent } from '../Events';\nimport { Actor } from '../Actor';\nimport { Body } from './Body';\nimport { CollisionShape } from './CollisionShape';\nimport { Vector, Line } from '../Algebra';\nimport { Physics } from '../Physics';\nimport { BoundingBox } from './BoundingBox';\nimport { CollisionType } from './CollisionType';\nimport { CollisionGroup } from './CollisionGroup';\nimport { CollisionContact } from './CollisionContact';\nimport { EventDispatcher } from '../EventDispatcher';\nimport { Pair } from './Pair';\nimport { Clonable } from '../Interfaces/Clonable';\n\n/**\n * Type guard function to determine whether something is a Collider\n */\nexport function isCollider(x: Actor | Collider): x is Collider {\n  return x instanceof Collider;\n}\n\nexport interface ColliderOptions {\n  /**\n   * Optional [[CollisionShape|Shape]] to use with this collider, the shape defines the collidable\n   * region along with the [[BoundingBox|bounding box]]\n   */\n  shape?: CollisionShape;\n  /**\n   * Optional body to associate with this collider\n   */\n  body?: Body;\n  /**\n   * Optional pixel offset from the position of the body\n   */\n  offset?: Vector;\n  /**\n   * Optional collision group on this collider\n   */\n  group?: CollisionGroup;\n  /**\n   * Optional [[CollisionType|collision type]], if not specified the default is [[CollisionType.PreventCollision]]\n   */\n  type?: CollisionType;\n  /**\n   * Optional local bounds if other bounds are required instead of the bounding box from the shape. This overrides shape bounds.\n   */\n  localBounds?: BoundingBox;\n  /**\n   * Optional flag to indicate moment of inertia from the shape should be used, by default it is true.\n   */\n  useShapeInertia?: boolean;\n}\n\n/**\n * Collider describes material properties like shape,\n * bounds, friction of the physics object. Only **one** collider can be associated with a body at a time\n */\n\nexport class Collider implements Eventable, Clonable<Collider> {\n  private _shape: CollisionShape;\n  public useShapeInertia: boolean;\n  private _events: EventDispatcher<Collider> = new EventDispatcher<Collider>(this);\n\n  constructor({ body, type, group, shape, offset, useShapeInertia = true }: ColliderOptions) {\n    // If shape is not supplied see if the body has an existing collider with a shape\n    if (body && body.collider && !shape) {\n      this._shape = body.collider.shape;\n    } else {\n      this._shape = shape;\n      this.body = body;\n    }\n    this.useShapeInertia = useShapeInertia;\n    this._shape.collider = this;\n    this.type = type || this.type;\n    this.group = group || this.group;\n    this.offset = offset || Vector.Zero;\n  }\n\n  /**\n   * Returns a clone of the current collider, not associated with any body\n   */\n  public clone() {\n    return new Collider({\n      body: null,\n      type: this.type,\n      shape: this._shape.clone(),\n      group: this.group,\n      offset: this.offset\n    });\n  }\n\n  /**\n   * Get the unique id of the collider\n   */\n  public get id(): number {\n    return this.body ? this.body.id : -1;\n  }\n\n  /**\n   * Gets or sets the current collision type of this collider. By\n   * default it is ([[CollisionType.PreventCollision]]).\n   */\n  public type: CollisionType = CollisionType.PreventCollision;\n\n  /**\n   * Gets or sets the current [[CollisionGroup|collision group]] for the collider, colliders with like collision groups do not collide.\n   * By default, the collider will collide with [[CollisionGroup|all groups]].\n   */\n  public group: CollisionGroup = CollisionGroup.All;\n\n  /*\n   * Get the shape of the collider as a [[CollisionShape]]\n   */\n  public get shape(): CollisionShape {\n    return this._shape;\n  }\n\n  /**\n   * Set the shape of the collider as a [[CollisionShape]], if useShapeInertia is set the collider will use inertia from the shape.\n   */\n  public set shape(shape: CollisionShape) {\n    this._shape = shape;\n    this._shape.collider = this;\n    if (this.useShapeInertia) {\n      this.inertia = isNaN(this._shape.inertia) ? this.inertia : this._shape.inertia;\n    }\n  }\n\n  /**\n   * Return a reference to the body associated with this collider\n   */\n  public body: Body;\n\n  /**\n   * The center of the collider in world space\n   */\n  public get center(): Vector {\n    return this.bounds.center;\n  }\n\n  /**\n   * Is this collider active, if false it wont collide\n   */\n  public get active(): boolean {\n    return this.body.active;\n  }\n\n  /**\n   * Collide 2 colliders and product a collision contact if there is a collision, null if none\n   *\n   * Collision vector is in the direction of the other collider. Away from this collider, this -> other.\n   * @param other\n   */\n  public collide(other: Collider): CollisionContact | null {\n    return this.shape.collide(other.shape);\n  }\n\n  /**\n   * Find the closest line between 2 colliders\n   *\n   * Line is in the direction of the other collider. Away from this collider, this -> other.\n   * @param other Other collider\n   */\n  public getClosestLineBetween(other: Collider): Line {\n    return this.shape.getClosestLineBetween(other.shape);\n  }\n\n  /**\n   * Gets the current pixel offset of the collider\n   */\n  public get offset() {\n    return this.shape.offset.clone();\n  }\n\n  /**\n   * Sets the pixel offset of the collider\n   */\n  public set offset(offset: Vector) {\n    this.shape.offset = offset.clone();\n  }\n\n  /**\n   * The current mass of the actor, mass can be thought of as the resistance to acceleration.\n   */\n  public mass: number = 1.0;\n\n  /**\n   * The current moment of inertia, moment of inertia can be thought of as the resistance to rotation.\n   */\n  public inertia: number = 1000;\n\n  /**\n   * The coefficient of friction on this actor\n   */\n  public friction: number = 0.99;\n\n  /**\n   * The also known as coefficient of restitution of this actor, represents the amount of energy preserved after collision or the\n   * bounciness. If 1, it is 100% bouncy, 0 it completely absorbs.\n   */\n  public bounciness: number = 0.2;\n\n  /**\n   * Returns a boolean indicating whether this body collided with\n   * or was in stationary contact with\n   * the body of the other [[Collider]]\n   */\n  public touching(other: Collider): boolean {\n    const pair = new Pair(this, other);\n    pair.collide();\n\n    if (pair.collision) {\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Returns the collider's [[BoundingBox]] calculated for this instant in world space.\n   * If there is no shape, a point bounding box is returned\n   */\n  public get bounds(): BoundingBox {\n    if (this.shape) {\n      return this.shape.bounds;\n    }\n\n    if (this.body) {\n      return new BoundingBox().translate(this.body.pos);\n    }\n    return new BoundingBox();\n  }\n\n  /**\n   * Returns the collider's [[BoundingBox]] relative to the body's position.\n   * If there is no shape, a point bounding box is returned\n   */\n  public get localBounds(): BoundingBox {\n    if (this.shape) {\n      return this.shape.localBounds;\n    }\n    return new BoundingBox();\n  }\n\n  /**\n   * Updates the collision shapes geometry and internal caches if needed\n   */\n  public update() {\n    if (this.shape) {\n      this.shape.recalc();\n    }\n  }\n\n  emit(eventName: string, event: GameEvent<Collider>): void {\n    this._events.emit(eventName, event);\n  }\n  on(eventName: string, handler: (event: GameEvent<Collider>) => void): void {\n    this._events.on(eventName, handler);\n  }\n  off(eventName: string, handler?: (event: GameEvent<Collider>) => void): void {\n    this._events.off(eventName, handler);\n  }\n  once(eventName: string, handler: (event: GameEvent<Collider>) => void): void {\n    this._events.once(eventName, handler);\n  }\n\n  clear() {\n    this._events.clear();\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    // Draw motion vectors\n    if (Physics.showMotionVectors) {\n      DrawUtil.vector(ctx, Color.Yellow, this.body.pos, this.body.acc.add(Physics.acc));\n      DrawUtil.vector(ctx, Color.Red, this.body.pos, this.body.vel);\n      DrawUtil.point(ctx, Color.Red, this.body.pos);\n    }\n\n    if (Physics.showBounds) {\n      this.bounds.debugDraw(ctx, Color.Yellow);\n    }\n\n    if (Physics.showArea) {\n      this.shape.debugDraw(ctx, Color.Green);\n    }\n  }\n}\n","import { Class } from './Class';\nimport { Texture } from './Resources/Texture';\nimport {\n  InitializeEvent,\n  KillEvent,\n  PreUpdateEvent,\n  PostUpdateEvent,\n  PreDrawEvent,\n  PostDrawEvent,\n  PreDebugDrawEvent,\n  PostDebugDrawEvent,\n  PostCollisionEvent,\n  PreCollisionEvent,\n  CollisionStartEvent,\n  CollisionEndEvent,\n  PostKillEvent,\n  PreKillEvent,\n  GameEvent,\n  ExitTriggerEvent,\n  EnterTriggerEvent,\n  EnterViewPortEvent,\n  ExitViewPortEvent\n} from './Events';\nimport { PointerEvent, WheelEvent, PointerDragEvent, PointerEventName } from './Input/PointerEvents';\nimport { Engine } from './Engine';\nimport { Color } from './Drawing/Color';\nimport { Sprite } from './Drawing/Sprite';\nimport { Trait } from './Interfaces/Trait';\nimport { Drawable } from './Interfaces/Drawable';\nimport { CanInitialize, CanUpdate, CanDraw, CanBeKilled } from './Interfaces/LifecycleEvents';\nimport { Scene } from './Scene';\nimport { Logger } from './Util/Log';\nimport { ActionContext } from './Actions/ActionContext';\nimport { ActionQueue } from './Actions/Action';\nimport { Vector } from './Algebra';\nimport { Body } from './Collision/Body';\nimport { Eventable } from './Interfaces/Evented';\nimport { Actionable } from './Actions/Actionable';\nimport { Configurable } from './Configurable';\nimport * as Traits from './Traits/Index';\nimport * as Effects from './Drawing/SpriteEffects';\nimport * as Util from './Util/Util';\nimport * as Events from './Events';\nimport { PointerEvents } from './Interfaces/PointerEventHandlers';\nimport { CollisionType } from './Collision/CollisionType';\nimport { obsolete } from './Util/Decorators';\nimport { Collider } from './Collision/Collider';\nimport { Shape } from './Collision/Shape';\n\nexport function isActor(x: any): x is Actor {\n  return x instanceof Actor;\n}\n\n/**\n * [[include:Constructors.md]]\n */\nexport interface ActorArgs extends Partial<ActorImpl> {\n  x?: number;\n  y?: number;\n  width?: number;\n  height?: number;\n  pos?: Vector;\n  vel?: Vector;\n  acc?: Vector;\n  rotation?: number;\n  rx?: number;\n  z?: number;\n  color?: Color;\n  visible?: boolean;\n  body?: Body;\n  collisionType?: CollisionType;\n}\n\nexport interface ActorDefaults {\n  anchor: Vector;\n}\n\n/**\n * @hidden\n */\n\nexport class ActorImpl extends Class implements Actionable, Eventable, PointerEvents, CanInitialize, CanUpdate, CanDraw, CanBeKilled {\n  // #region Properties\n\n  /**\n   * Indicates the next id to be set\n   */\n  public static defaults: ActorDefaults = {\n    anchor: Vector.Half\n  };\n  /**\n   * Indicates the next id to be set\n   */\n  public static maxId = 0;\n  /**\n   * The unique identifier for the actor\n   */\n  public id: number = ActorImpl.maxId++;\n\n  /**\n   * The physics body the is associated with this actor. The body is the container for all physical properties, like position, velocity,\n   * acceleration, mass, inertia, etc.\n   */\n  public get body(): Body {\n    return this._body;\n  }\n\n  public set body(body: Body) {\n    this._body = body;\n    this._body.actor = this;\n  }\n\n  private _body: Body;\n\n  /**\n   * Gets the position vector of the actor in pixels\n   */\n  public get pos(): Vector {\n    return this.body.pos;\n  }\n\n  /**\n   * Sets the position vector of the actor in pixels\n   */\n  public set pos(thePos: Vector) {\n    this.body.pos.setTo(thePos.x, thePos.y);\n  }\n\n  /**\n   * Gets the position vector of the actor from the last frame\n   */\n  public get oldPos(): Vector {\n    return this.body.oldPos;\n  }\n\n  /**\n   * Sets the position vector of the actor in the last frame\n   */\n  public set oldPos(thePos: Vector) {\n    this.body.oldPos.setTo(thePos.x, thePos.y);\n  }\n\n  /**\n   * Gets the velocity vector of the actor in pixels/sec\n   */\n  public get vel(): Vector {\n    return this.body.vel;\n  }\n\n  /**\n   * Sets the velocity vector of the actor in pixels/sec\n   */\n  public set vel(theVel: Vector) {\n    this.body.vel.setTo(theVel.x, theVel.y);\n  }\n\n  /**\n   * Gets the velocity vector of the actor from the last frame\n   */\n  public get oldVel(): Vector {\n    return this.body.oldVel;\n  }\n\n  /**\n   * Sets the velocity vector of the actor from the last frame\n   */\n  public set oldVel(theVel: Vector) {\n    this.body.oldVel.setTo(theVel.x, theVel.y);\n  }\n\n  /**\n   * Gets the acceleration vector of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may be\n   * useful to simulate a gravitational effect.\n   */\n  public get acc(): Vector {\n    return this.body.acc;\n  }\n\n  /**\n   * Sets the acceleration vector of teh actor in pixels/second/second\n   */\n  public set acc(theAcc: Vector) {\n    this.body.acc.setTo(theAcc.x, theAcc.y);\n  }\n\n  /**\n   * Sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\n   */\n  public set oldAcc(theAcc: Vector) {\n    this.body.oldAcc.setTo(theAcc.x, theAcc.y);\n  }\n\n  /**\n   * Gets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\n   */\n  public get oldAcc(): Vector {\n    return this.body.oldAcc;\n  }\n\n  /**\n   * Gets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\n   */\n  public get rotation(): number {\n    return this.body.rotation;\n  }\n\n  /**\n   * Sets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\n   */\n  public set rotation(theAngle: number) {\n    this.body.rotation = theAngle;\n  }\n\n  /**\n   * Gets the rotational velocity of the actor in radians/second\n   */\n  public get rx(): number {\n    return this.body.rx;\n  }\n\n  /**\n   * Sets the rotational velocity of the actor in radians/sec\n   */\n  public set rx(angularVelocity: number) {\n    this.body.rx = angularVelocity;\n  }\n\n  /**\n   * The anchor to apply all actor related transformations like rotation,\n   * translation, and scaling. By default the anchor is in the center of\n   * the actor. By default it is set to the center of the actor (.5, .5)\n   *\n   * An anchor of (.5, .5) will ensure that drawings are centered.\n   *\n   * Use `anchor.setTo` to set the anchor to a different point using\n   * values between 0 and 1. For example, anchoring to the top-left would be\n   * `Actor.anchor.setTo(0, 0)` and top-right would be `Actor.anchor.setTo(0, 1)`.\n   */\n  public anchor: Vector;\n\n  private _height: number = 0;\n  private _width: number = 0;\n\n  /**\n   * Gets the scale vector of the actor\n   * @obsolete ex.Actor.scale will be removed in v0.25.0, set width and height directly in constructor\n   */\n  public get scale(): Vector {\n    return this.body.scale;\n  }\n\n  /**\n   * Sets the scale vector of the actor for\n   * @obsolete ex.Actor.scale will be removed in v0.25.0, set width and height directly in constructor\n   */\n  public set scale(scale: Vector) {\n    this.body.scale = scale;\n  }\n\n  /**\n   * Gets the old scale of the actor last frame\n   * @obsolete ex.Actor.scale will be removed in v0.25.0, set width and height directly in constructor\n   */\n  public get oldScale(): Vector {\n    return this.body.oldScale;\n  }\n\n  /**\n   * Sets the the old scale of the actor last frame\n   * @obsolete ex.Actor.scale will be removed in v0.25.0, set width and height directly in constructor\n   */\n  public set oldScale(scale: Vector) {\n    this.body.oldScale = scale;\n  }\n\n  /**\n   * Gets the x scalar velocity of the actor in scale/second\n   * @obsolete ex.Actor.sx will be removed in v0.25.0, set width and height directly in constructor\n   */\n  public get sx(): number {\n    return this.body.sx;\n  }\n\n  /**\n   * Sets the x scalar velocity of the actor in scale/second\n   * @obsolete ex.Actor.sx will be removed in v0.25.0, set width and height directly in constructor\n   */\n  @obsolete({ message: 'ex.Actor.sx will be removed in v0.25.0', alternateMethod: 'Set width and height directly in constructor' })\n  public set sx(scalePerSecondX: number) {\n    this.body.sx = scalePerSecondX;\n  }\n\n  /**\n   * Gets the y scalar velocity of the actor in scale/second\n   * @obsolete ex.Actor.sy will be removed in v0.25.0, set width and height directly in constructor\n   */\n  public get sy(): number {\n    return this.body.sy;\n  }\n\n  /**\n   * Sets the y scale velocity of the actor in scale/second\n   * @obsolete ex.Actor.sy will be removed in v0.25.0, set width and height directly in constructor\n   */\n  @obsolete({ message: 'ex.Actor.sy will be removed in v0.25.0', alternateMethod: 'Set width and height directly in constructor' })\n  public set sy(scalePerSecondY: number) {\n    this.body.sy = scalePerSecondY;\n  }\n\n  /**\n   * Indicates whether the actor is physically in the viewport\n   */\n  public isOffScreen: boolean = false;\n  /**\n   * The visibility of an actor\n   */\n  public visible: boolean = true;\n  /**\n   * The opacity of an actor. Passing in a color in the [[constructor]] will use the\n   * color's opacity.\n   */\n  public opacity: number = 1;\n  public previousOpacity: number = 1;\n\n  /**\n   * Direct access to the actor's [[ActionQueue]]. Useful if you are building custom actions.\n   */\n  public actionQueue: ActionQueue;\n\n  /**\n   * [[ActionContext|Action context]] of the actor. Useful for scripting actor behavior.\n   */\n  public actions: ActionContext;\n\n  /**\n   * Convenience reference to the global logger\n   */\n  public logger: Logger = Logger.getInstance();\n\n  /**\n   * The scene that the actor is in\n   */\n  public scene: Scene = null;\n\n  /**\n   * The parent of this actor\n   */\n  public parent: Actor = null;\n\n  /**\n   * The children of this actor\n   */\n  public children: Actor[] = [];\n\n  private _isInitialized: boolean = false;\n  public frames: { [key: string]: Drawable } = {};\n  private _effectsDirty: boolean = false;\n\n  /**\n   * Access to the current drawing for the actor, this can be\n   * an [[Animation]], [[Sprite]], or [[Polygon]].\n   * Set drawings with [[setDrawing]].\n   */\n  public currentDrawing: Drawable = null;\n\n  /**\n   * Draggable helper\n   */\n\n  private _draggable: boolean = false;\n  private _dragging: boolean = false;\n\n  private _pointerDragStartHandler = () => {\n    this._dragging = true;\n  };\n\n  private _pointerDragEndHandler = () => {\n    this._dragging = false;\n  };\n\n  private _pointerDragMoveHandler = (pe: PointerEvent) => {\n    if (this._dragging) {\n      this.pos = pe.pointer.lastWorldPos;\n    }\n  };\n\n  private _pointerDragLeaveHandler = (pe: PointerEvent) => {\n    if (this._dragging) {\n      this.pos = pe.pointer.lastWorldPos;\n    }\n  };\n\n  public get draggable(): boolean {\n    return this._draggable;\n  }\n\n  public set draggable(isDraggable: boolean) {\n    if (isDraggable) {\n      if (isDraggable && !this._draggable) {\n        this.on('pointerdragstart', this._pointerDragStartHandler);\n        this.on('pointerdragend', this._pointerDragEndHandler);\n        this.on('pointerdragmove', this._pointerDragMoveHandler);\n        this.on('pointerdragleave', this._pointerDragLeaveHandler);\n      } else if (!isDraggable && this._draggable) {\n        this.off('pointerdragstart', this._pointerDragStartHandler);\n        this.off('pointerdragend', this._pointerDragEndHandler);\n        this.off('pointerdragmove', this._pointerDragMoveHandler);\n        this.off('pointerdragleave', this._pointerDragLeaveHandler);\n      }\n\n      this._draggable = isDraggable;\n    }\n  }\n\n  /**\n   * Modify the current actor update pipeline.\n   */\n  public traits: Trait[] = [];\n\n  /**\n   * Sets the color of the actor. A rectangle of this color will be\n   * drawn if no [[Drawable]] is specified as the actors drawing.\n   *\n   * The default is `null` which prevents a rectangle from being drawn.\n   */\n  public get color(): Color {\n    return this._color;\n  }\n  public set color(v: Color) {\n    this._color = v.clone();\n  }\n  private _color: Color;\n\n  /**\n   * Whether or not to enable the [[CapturePointer]] trait that propagates\n   * pointer events to this actor\n   */\n  public enableCapturePointer: boolean = false;\n\n  /**\n   * Configuration for [[CapturePointer]] trait\n   */\n  public capturePointer: Traits.CapturePointerConfig = {\n    captureMoveEvents: false,\n    captureDragEvents: false\n  };\n\n  private _zIndex: number = 0;\n  private _isKilled: boolean = false;\n  private _opacityFx = new Effects.Opacity(this.opacity);\n\n  // #endregion\n\n  /**\n   * @param x       The starting x coordinate of the actor\n   * @param y       The starting y coordinate of the actor\n   * @param width   The starting width of the actor\n   * @param height  The starting height of the actor\n   * @param color   The starting color of the actor. Leave null to draw a transparent actor. The opacity of the color will be used as the\n   * initial [[opacity]].\n   */\n  constructor(xOrConfig?: number | ActorArgs, y?: number, width?: number, height?: number, color?: Color) {\n    super();\n\n    // initialize default options\n    this._initDefaults();\n\n    let shouldInitializeBody = true;\n    let collisionType = CollisionType.Passive;\n    if (xOrConfig && typeof xOrConfig === 'object') {\n      const config = xOrConfig;\n      if (config.pos) {\n        xOrConfig = config.pos ? config.pos.x : 0;\n        y = config.pos ? config.pos.y : 0;\n      } else {\n        xOrConfig = config.x || 0;\n        y = config.y || 0;\n      }\n      width = config.width;\n      height = config.height;\n\n      if (config.body) {\n        shouldInitializeBody = false;\n        this.body = config.body;\n      }\n\n      if (config.anchor) {\n        this.anchor = config.anchor;\n      }\n\n      if (config.collisionType) {\n        collisionType = config.collisionType;\n      }\n    }\n\n    // Body and collider bounds are still determined by actor width/height\n    this._width = width || 0;\n    this._height = height || 0;\n\n    // Initialize default collider to be a box\n    if (shouldInitializeBody) {\n      this.body = new Body({\n        collider: new Collider({\n          type: CollisionType.Passive,\n          shape: Shape.Box(this._width, this._height, this.anchor)\n        })\n      });\n    }\n\n    if (this.body && this.body.collider) {\n      this.body.collider.type = collisionType;\n    }\n\n    // Position uses body to store values must be initialized after body\n    this.pos.x = <number>xOrConfig || 0;\n    this.pos.y = y || 0;\n\n    if (color) {\n      this.color = color;\n      // set default opacity of an actor to the color\n      this.opacity = color.a;\n    }\n\n    // Build default pipeline\n    this.traits.push(new Traits.TileMapCollisionDetection());\n    this.traits.push(new Traits.OffscreenCulling());\n    this.traits.push(new Traits.CapturePointer());\n\n    // Build the action queue\n    this.actionQueue = new ActionQueue(this);\n    this.actions = new ActionContext(this);\n  }\n\n  /**\n   * `onInitialize` is called before the first update of the actor. This method is meant to be\n   * overridden. This is where initialization of child actors should take place.\n   *\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\n   */\n  public onInitialize(_engine: Engine): void {\n    // Override me\n  }\n\n  /**\n   * Gets whether the actor is Initialized\n   */\n  public get isInitialized(): boolean {\n    return this._isInitialized;\n  }\n\n  /**\n   * Initializes this actor and all it's child actors, meant to be called by the Scene before first update not by users of Excalibur.\n   *\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * @internal\n   */\n  public _initialize(engine: Engine) {\n    if (!this.isInitialized) {\n      this.onInitialize(engine);\n      super.emit('initialize', new InitializeEvent(engine, this));\n      this._isInitialized = true;\n    }\n    for (const child of this.children) {\n      child._initialize(engine);\n    }\n  }\n\n  private _initDefaults() {\n    this.anchor = Actor.defaults.anchor.clone();\n  }\n\n  // #region Events\n\n  private _capturePointerEvents: PointerEventName[] = [\n    'pointerup',\n    'pointerdown',\n    'pointermove',\n    'pointerenter',\n    'pointerleave',\n    'pointerdragstart',\n    'pointerdragend',\n    'pointerdragmove',\n    'pointerdragenter',\n    'pointerdragleave'\n  ];\n\n  private _captureMoveEvents: PointerEventName[] = [\n    'pointermove',\n    'pointerenter',\n    'pointerleave',\n    'pointerdragmove',\n    'pointerdragenter',\n    'pointerdragleave'\n  ];\n\n  private _captureDragEvents: PointerEventName[] = [\n    'pointerdragstart',\n    'pointerdragend',\n    'pointerdragmove',\n    'pointerdragenter',\n    'pointerdragleave'\n  ];\n\n  private _checkForPointerOptIn(eventName: string) {\n    if (eventName) {\n      const normalized = <PointerEventName>eventName.toLowerCase();\n\n      if (this._capturePointerEvents.indexOf(normalized) !== -1) {\n        this.enableCapturePointer = true;\n\n        if (this._captureMoveEvents.indexOf(normalized) !== -1) {\n          this.capturePointer.captureMoveEvents = true;\n        }\n\n        if (this._captureDragEvents.indexOf(normalized) !== -1) {\n          this.capturePointer.captureDragEvents = true;\n        }\n      }\n    }\n  }\n\n  public on(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\n  public on(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\n  /**\n   * The **collisionstart** event is fired when a [[Body|physics body]], usually attached to an actor,\n   *  first starts colliding with another [[Body|body]], and will not fire again while in contact until\n   *  the the pair separates and collides again.\n   * Use cases for the **collisionstart** event may be detecting when an actor has touched a surface\n   * (like landing) or if a item has been touched and needs to be picked up.\n   */\n  public on(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\n  /**\n   * The **collisionend** event is fired when two [[Body|physics bodies]] are no longer in contact.\n   * This event will not fire again until another collision and separation.\n   *\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\n   * (like jumping) or has left an area.\n   */\n  public on(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\n  /**\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\n   * bodies are intersecting.\n   *\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\n   * ricochet of the ball depending on which side of the paddle you hit.\n   */\n  public on(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\n  /**\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\n   * type collision pairs.\n   *\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\n   * tweak the default resolution.\n   */\n  public on(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\n  public on(eventName: Events.kill, handler: (event: KillEvent) => void): void;\n  public on(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\n  public on(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent) => void): void;\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent) => void): void;\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public on(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\n  public on(eventName: Events.pointerdragstart, handler: (event: PointerDragEvent) => void): void;\n  public on(eventName: Events.pointerdragend, handler: (event: PointerDragEvent) => void): void;\n  public on(eventName: Events.pointerdragenter, handler: (event: PointerDragEvent) => void): void;\n  public on(eventName: Events.pointerdragleave, handler: (event: PointerDragEvent) => void): void;\n  public on(eventName: Events.pointerdragmove, handler: (event: PointerDragEvent) => void): void;\n  public on(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\n  public on(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    this._checkForPointerOptIn(eventName);\n    super.on(eventName, handler);\n  }\n\n  public once(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\n  public once(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\n  /**\n   * The **collisionstart** event is fired when a [[Body|physics body]], usually attached to an actor,\n   *  first starts colliding with another [[Body|body]], and will not fire again while in contact until\n   *  the the pair separates and collides again.\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\n   * (like landing) or if a item has been touched and needs to be picked up.\n   */\n  public once(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\n  /**\n   * The **collisionend** event is fired when two [[Body|physics bodies]] are no longer in contact.\n   * This event will not fire again until another collision and separation.\n   *\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\n   * (like jumping) or has left an area.\n   */\n  public once(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\n  /**\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\n   * bodies are intersecting.\n   *\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\n   * ricochet of the ball depending on which side of the paddle you hit.\n   */\n  public once(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\n  /**\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\n   * type collision pairs.\n   *\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\n   * tweak the default resolution.\n   */\n  public once(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\n  public once(eventName: Events.kill, handler: (event: KillEvent) => void): void;\n  public once(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\n  public once(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent) => void): void;\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent) => void): void;\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent) => void): void;\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public once(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\n  public once(eventName: Events.pointerdragstart, handler: (event: PointerDragEvent) => void): void;\n  public once(eventName: Events.pointerdragend, handler: (event: PointerDragEvent) => void): void;\n  public once(eventName: Events.pointerdragenter, handler: (event: PointerDragEvent) => void): void;\n  public once(eventName: Events.pointerdragleave, handler: (event: PointerDragEvent) => void): void;\n  public once(eventName: Events.pointerdragmove, handler: (event: PointerDragEvent) => void): void;\n  public once(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\n  public once(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    this._checkForPointerOptIn(eventName);\n    super.once(eventName, handler);\n  }\n\n  public off(eventName: Events.exittrigger, handler?: (event: ExitTriggerEvent) => void): void;\n  public off(eventName: Events.entertrigger, handler?: (event: EnterTriggerEvent) => void): void;\n  /**\n   * The **collisionstart** event is fired when a [[Body|physics body]], usually attached to an actor,\n   *  first starts colliding with another [[Body|body]], and will not fire again while in contact until\n   *  the the pair separates and collides again.\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\n   * (like landing) or if a item has been touched and needs to be picked up.\n   */\n  public off(eventName: Events.collisionstart, handler?: (event: CollisionStartEvent) => void): void;\n  /**\n   * The **collisionend** event is fired when two [[Body|physics bodies]] are no longer in contact.\n   * This event will not fire again until another collision and separation.\n   *\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\n   * (like jumping) or has left an area.\n   */\n  public off(eventName: Events.collisionend, handler?: (event: CollisionEndEvent) => void): void;\n  /**\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\n   * bodies are intersecting.\n   *\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\n   * ricochet of the ball depending on which side of the paddle you hit.\n   */\n  public off(eventName: Events.precollision, handler?: (event: PreCollisionEvent) => void): void;\n  /**\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\n   * type collision pairs.\n   *\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\n   * tweak the default resolution.\n   */\n  public off(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\n  public off(eventName: Events.pointerup, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerdown, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerenter, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerleave, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointermove, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointercancel, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerwheel, handler?: (event: WheelEvent) => void): void;\n  public off(eventName: Events.pointerdragstart, handler?: (event: PointerDragEvent) => void): void;\n  public off(eventName: Events.pointerdragend, handler?: (event: PointerDragEvent) => void): void;\n  public off(eventName: Events.pointerdragenter, handler?: (event: PointerDragEvent) => void): void;\n  public off(eventName: Events.pointerdragleave, handler?: (event: PointerDragEvent) => void): void;\n  public off(eventName: Events.pointerdragmove, handler?: (event: PointerDragEvent) => void): void;\n  public off(eventName: Events.prekill, handler?: (event: PreKillEvent) => void): void;\n  public off(eventName: Events.postkill, handler?: (event: PostKillEvent) => void): void;\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent) => void): void;\n  public off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent) => void): void;\n  public off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent) => void): void;\n  public off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\n  public off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\n  public off(eventName: Events.enterviewport, handler?: (event: EnterViewPortEvent) => void): void;\n  public off(eventName: Events.exitviewport, handler?: (event: ExitViewPortEvent) => void): void;\n  public off(eventName: string, handler?: (event: GameEvent<Actor>) => void): void;\n  public off(eventName: string, handler?: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  // #endregion\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _prekill handler for [[onPreKill]] lifecycle event\n   * @internal\n   */\n  public _prekill(_scene: Scene) {\n    super.emit('prekill', new PreKillEvent(this));\n    this.onPreKill(_scene);\n  }\n\n  /**\n   * Safe to override onPreKill lifecycle event handler. Synonymous with `.on('prekill', (evt) =>{...})`\n   *\n   * `onPreKill` is called directly before an actor is killed and removed from its current [[Scene]].\n   */\n  public onPreKill(_scene: Scene) {\n    // Override me\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _prekill handler for [[onPostKill]] lifecycle event\n   * @internal\n   */\n  public _postkill(_scene: Scene) {\n    super.emit('postkill', new PostKillEvent(this));\n    this.onPostKill(_scene);\n  }\n\n  /**\n   * Safe to override onPostKill lifecycle event handler. Synonymous with `.on('postkill', (evt) => {...})`\n   *\n   * `onPostKill` is called directly after an actor is killed and remove from its current [[Scene]].\n   */\n  public onPostKill(_scene: Scene) {\n    // Override me\n  }\n\n  /**\n   * If the current actor is a member of the scene, this will remove\n   * it from the scene graph. It will no longer be drawn or updated.\n   */\n  public kill() {\n    if (this.scene) {\n      this._prekill(this.scene);\n      this.emit('kill', new KillEvent(this));\n      this._isKilled = true;\n      this.scene.remove(this);\n      this._postkill(this.scene);\n    } else {\n      this.logger.warn('Cannot kill actor, it was never added to the Scene');\n    }\n  }\n\n  /**\n   * If the current actor is killed, it will now not be killed.\n   */\n  public unkill() {\n    this._isKilled = false;\n  }\n\n  /**\n   * Indicates wether the actor has been killed.\n   */\n  public isKilled(): boolean {\n    return this._isKilled;\n  }\n\n  /**\n   * Adds a child actor to this actor. All movement of the child actor will be\n   * relative to the parent actor. Meaning if the parent moves the child will\n   * move with it.\n   * @param actor The child actor to add\n   */\n  public add(actor: Actor) {\n    actor.body.collider.type = CollisionType.PreventCollision;\n    if (Util.addItemToArray(actor, this.children)) {\n      actor.parent = this;\n    }\n  }\n  /**\n   * Removes a child actor from this actor.\n   * @param actor The child actor to remove\n   */\n  public remove(actor: Actor) {\n    if (Util.removeItemFromArray(actor, this.children)) {\n      actor.parent = null;\n    }\n  }\n  /**\n   * Sets the current drawing of the actor to the drawing corresponding to\n   * the key.\n   * @param key The key of the drawing\n   */\n  public setDrawing(key: string): void;\n  /**\n   * Sets the current drawing of the actor to the drawing corresponding to\n   * an `enum` key (e.g. `Animations.Left`)\n   * @param key The `enum` key of the drawing\n   */\n  public setDrawing(key: number): void;\n  public setDrawing(key: any): void {\n    key = key.toString();\n    if (this.currentDrawing !== this.frames[<string>key]) {\n      if (this.frames[key] != null) {\n        this.frames[key].reset();\n        this.currentDrawing = this.frames[key];\n      } else {\n        Logger.getInstance().error(`the specified drawing key ${key} does not exist`);\n      }\n    }\n  }\n\n  /**\n   * Adds a whole texture as the \"default\" drawing. Set a drawing using [[setDrawing]].\n   */\n  public addDrawing(texture: Texture): void;\n  /**\n   * Adds a whole sprite as the \"default\" drawing. Set a drawing using [[setDrawing]].\n   */\n  public addDrawing(sprite: Sprite): void;\n  /**\n   * Adds a drawing to the list of available drawings for an actor. Set a drawing using [[setDrawing]].\n   * @param key     The key to associate with a drawing for this actor\n   * @param drawing This can be an [[Animation]], [[Sprite]], or [[Polygon]].\n   */\n  public addDrawing(key: any, drawing: Drawable): void;\n  public addDrawing(): void {\n    if (arguments.length === 2) {\n      this.frames[<string>arguments[0]] = arguments[1];\n      if (!this.currentDrawing) {\n        this.currentDrawing = arguments[1];\n      }\n      this._effectsDirty = true;\n    } else {\n      if (arguments[0] instanceof Sprite) {\n        this.addDrawing('default', arguments[0]);\n      }\n      if (arguments[0] instanceof Texture) {\n        this.addDrawing('default', arguments[0].asSprite());\n      }\n    }\n  }\n\n  public get z(): number {\n    return this.getZIndex();\n  }\n\n  public set z(newZ: number) {\n    this.setZIndex(newZ);\n  }\n\n  /**\n   * Gets the z-index of an actor. The z-index determines the relative order an actor is drawn in.\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\n   */\n  public getZIndex(): number {\n    return this._zIndex;\n  }\n\n  /**\n   * Sets the z-index of an actor and updates it in the drawing list for the scene.\n   * The z-index determines the relative order an actor is drawn in.\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\n   * @param newIndex new z-index to assign\n   */\n  public setZIndex(newIndex: number) {\n    this.scene.cleanupDrawTree(this);\n    this._zIndex = newIndex;\n    this.scene.updateDrawTree(this);\n  }\n\n  /**\n   * Get the center point of an actor\n   */\n  public get center(): Vector {\n    return new Vector(this.pos.x + this.width / 2 - this.anchor.x * this.width, this.pos.y + this.height / 2 - this.anchor.y * this.height);\n  }\n\n  public get width() {\n    return this._width * this.getGlobalScale().x;\n  }\n\n  public set width(width: number) {\n    this._width = width / this.scale.x;\n    this.body.collider.shape = Shape.Box(this._width, this._height, this.anchor);\n    this.body.markCollisionShapeDirty();\n  }\n\n  public get height() {\n    return this._height * this.getGlobalScale().y;\n  }\n\n  public set height(height: number) {\n    this._height = height / this.scale.y;\n    this.body.collider.shape = Shape.Box(this._width, this._height, this.anchor);\n    this.body.markCollisionShapeDirty();\n  }\n\n  /**\n   * Gets this actor's rotation taking into account any parent relationships\n   *\n   * @returns Rotation angle in radians\n   */\n  public getWorldRotation(): number {\n    if (!this.parent) {\n      return this.rotation;\n    }\n\n    return this.rotation + this.parent.getWorldRotation();\n  }\n\n  /**\n   * Gets an actor's world position taking into account parent relationships, scaling, rotation, and translation\n   *\n   * @returns Position in world coordinates\n   */\n  public getWorldPos(): Vector {\n    if (!this.parent) {\n      return this.pos.clone();\n    }\n\n    // collect parents\n    const parents: Actor[] = [];\n    let root: Actor = this;\n\n    parents.push(this);\n\n    // find parents\n    while (root.parent) {\n      root = root.parent;\n      parents.push(root);\n    }\n\n    // calculate position\n    const x = parents.reduceRight((px, p) => {\n      if (p.parent) {\n        return px + p.pos.x * p.getGlobalScale().x;\n      }\n      return px + p.pos.x;\n    }, 0);\n\n    const y = parents.reduceRight((py, p) => {\n      if (p.parent) {\n        return py + p.pos.y * p.getGlobalScale().y;\n      }\n      return py + p.pos.y;\n    }, 0);\n\n    // rotate around root anchor\n    const ra = root.getWorldPos(); // 10, 10\n    const r = this.getWorldRotation();\n\n    return new Vector(x, y).rotate(r, ra);\n  }\n\n  /**\n   * Gets the global scale of the Actor\n   */\n  public getGlobalScale(): Vector {\n    if (!this.parent) {\n      return new Vector(this.scale.x, this.scale.y);\n    }\n\n    const parentScale = this.parent.getGlobalScale();\n    return new Vector(this.scale.x * parentScale.x, this.scale.y * parentScale.y);\n  }\n\n  // #region Collision\n\n  /**\n   * Tests whether the x/y specified are contained in the actor\n   * @param x  X coordinate to test (in world coordinates)\n   * @param y  Y coordinate to test (in world coordinates)\n   * @param recurse checks whether the x/y are contained in any child actors (if they exist).\n   */\n  public contains(x: number, y: number, recurse: boolean = false): boolean {\n    // These shenanigans are to handle child actor containment,\n    // the only time getWorldPos and pos are different is a child actor\n    const childShift = this.getWorldPos().sub(this.pos);\n    const containment = this.body.collider.bounds.translate(childShift).contains(new Vector(x, y));\n\n    if (recurse) {\n      return (\n        containment ||\n        this.children.some((child: Actor) => {\n          return child.contains(x, y, true);\n        })\n      );\n    }\n\n    return containment;\n  }\n\n  /**\n   * Returns true if the two actor.body.collider.shape's surfaces are less than or equal to the distance specified from each other\n   * @param actor     Actor to test\n   * @param distance  Distance in pixels to test\n   */\n  public within(actor: Actor, distance: number): boolean {\n    return this.body.collider.shape.getClosestLineBetween(actor.body.collider.shape).getLength() <= distance;\n  }\n\n  // #endregion\n\n  protected _reapplyEffects(drawing: Drawable) {\n    drawing.removeEffect(this._opacityFx);\n    drawing.addEffect(this._opacityFx);\n  }\n\n  // #region Update\n\n  /**\n   * Called by the Engine, updates the state of the actor\n   * @param engine The reference to the current game engine\n   * @param delta  The time elapsed since the last update in milliseconds\n   */\n  public update(engine: Engine, delta: number) {\n    this._initialize(engine);\n    this._preupdate(engine, delta);\n\n    // Update action queue\n    this.actionQueue.update(delta);\n\n    // Update color only opacity\n    if (this.color) {\n      this.color.a = this.opacity;\n    }\n\n    if (this.opacity === 0) {\n      this.visible = false;\n    }\n\n    // calculate changing opacity\n    if (this.previousOpacity !== this.opacity) {\n      this.previousOpacity = this.opacity;\n      this._opacityFx.opacity = this.opacity;\n      this._effectsDirty = true;\n    }\n\n    // capture old transform\n    this.body.captureOldTransform();\n\n    // Run Euler integration\n    this.body.integrate(delta);\n\n    // Update actor pipeline (movement, collision detection, event propagation, offscreen culling)\n    for (const trait of this.traits) {\n      trait.update(this, engine, delta);\n    }\n\n    // Update child actors\n    for (let i = 0; i < this.children.length; i++) {\n      this.children[i].update(engine, delta);\n    }\n\n    this._postupdate(engine, delta);\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before an actor is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after an actor is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPreUpdate(engine, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(engine: Engine, delta: number): void {\n    this.emit('postupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPostUpdate(engine, delta);\n  }\n\n  // endregion\n\n  // #region Drawing\n  /**\n   * Called by the Engine, draws the actor to the screen\n   * @param ctx   The rendering context\n   * @param delta The time since the last draw in milliseconds\n   */\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\n    ctx.save();\n    ctx.translate(this.pos.x, this.pos.y);\n    ctx.rotate(this.rotation);\n    ctx.scale(this.scale.x, this.scale.y);\n\n    // translate canvas by anchor offset\n    ctx.save();\n    ctx.translate(-(this._width * this.anchor.x), -(this._height * this.anchor.y));\n\n    this._predraw(ctx, delta);\n\n    if (this.currentDrawing) {\n      const drawing = this.currentDrawing;\n      // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\n      const offsetX = (this._width - drawing.width * drawing.scale.x) * this.anchor.x;\n      const offsetY = (this._height - drawing.height * drawing.scale.y) * this.anchor.y;\n\n      if (this._effectsDirty) {\n        this._reapplyEffects(this.currentDrawing);\n        this._effectsDirty = false;\n      }\n\n      this.currentDrawing.draw(ctx, offsetX, offsetY);\n    } else {\n      if (this.color && this.body && this.body.collider && this.body.collider.shape) {\n        this.body.collider.shape.draw(ctx, this.color, new Vector(this.width * this.anchor.x, this.height * this.anchor.y));\n      }\n    }\n    ctx.restore();\n\n    // Draw child actors\n    for (let i = 0; i < this.children.length; i++) {\n      if (this.children[i].visible) {\n        this.children[i].draw(ctx, delta);\n      }\n    }\n\n    this._postdraw(ctx, delta);\n    ctx.restore();\n  }\n\n  /**\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('predraw', (evt) =>{...})`\n   *\n   * `onPreDraw` is called directly before an actor is drawn, but after local transforms are made.\n   */\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('postdraw', (evt) =>{...})`\n   *\n   * `onPostDraw` is called directly after an actor is drawn, and before local transforms are removed.\n   */\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\n   * @internal\n   */\n  public _predraw(ctx: CanvasRenderingContext2D, delta: number): void {\n    this.emit('predraw', new PreDrawEvent(ctx, delta, this));\n    this.onPreDraw(ctx, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\n   * @internal\n   */\n  public _postdraw(ctx: CanvasRenderingContext2D, delta: number): void {\n    this.emit('postdraw', new PreDrawEvent(ctx, delta, this));\n    this.onPostDraw(ctx, delta);\n  }\n\n  /**\n   * Called by the Engine, draws the actors debugging to the screen\n   * @param ctx The rendering context\n   */\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    this.emit('predebugdraw', new PreDebugDrawEvent(ctx, this));\n\n    this.body.collider.debugDraw(ctx);\n\n    // Draw actor bounding box\n    const bb = this.body.collider.localBounds.translate(this.getWorldPos());\n    bb.debugDraw(ctx);\n\n    // Draw actor Id\n    ctx.fillText('id: ' + this.id, bb.left + 3, bb.top + 10);\n\n    // Draw actor anchor Vector\n    ctx.fillStyle = Color.Yellow.toString();\n    ctx.beginPath();\n    ctx.arc(this.getWorldPos().x, this.getWorldPos().y, 3, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    // Culling Box debug draw\n    for (let j = 0; j < this.traits.length; j++) {\n      if (this.traits[j] instanceof Traits.OffscreenCulling) {\n        (<Traits.OffscreenCulling>this.traits[j]).cullingBox.debugDraw(ctx); // eslint-disable-line\n      }\n    }\n\n    // Unit Circle debug draw\n    ctx.strokeStyle = Color.Yellow.toString();\n    ctx.beginPath();\n    const radius = Math.min(this.width, this.height);\n    ctx.arc(this.getWorldPos().x, this.getWorldPos().y, radius, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.stroke();\n    const ticks: { [key: string]: number } = {\n      '0 Pi': 0,\n      'Pi/2': Math.PI / 2,\n      Pi: Math.PI,\n      '3/2 Pi': (3 * Math.PI) / 2\n    };\n\n    const oldFont = ctx.font;\n    for (const tick in ticks) {\n      ctx.fillStyle = Color.Yellow.toString();\n      ctx.font = '14px';\n      ctx.textAlign = 'center';\n      ctx.fillText(\n        tick,\n        this.getWorldPos().x + Math.cos(ticks[tick]) * (radius + 10),\n        this.getWorldPos().y + Math.sin(ticks[tick]) * (radius + 10)\n      );\n    }\n\n    ctx.font = oldFont;\n\n    // Draw child actors\n    for (let i = 0; i < this.children.length; i++) {\n      this.children[i].debugDraw(ctx);\n    }\n\n    this.emit('postdebugdraw', new PostDebugDrawEvent(ctx, this));\n  }\n\n  /**\n   * Returns the full array of ancestors\n   */\n  public getAncestors(): Actor[] {\n    const path: Actor[] = [this];\n    let currentActor: Actor = this;\n    let parent: Actor;\n\n    while ((parent = currentActor.parent)) {\n      currentActor = parent;\n      path.push(currentActor);\n    }\n\n    return path.reverse();\n  }\n  // #endregion\n}\n\n/**\n * The most important primitive in Excalibur is an `Actor`. Anything that\n * can move on the screen, collide with another `Actor`, respond to events,\n * or interact with the current scene, must be an actor. An `Actor` **must**\n * be part of a [[Scene]] for it to be drawn to the screen.\n *\n * [[include:Actors.md]]\n *\n *\n * [[include:Constructors.md]]\n *\n */\nexport class Actor extends Configurable(ActorImpl) {\n  constructor();\n  constructor(config?: ActorArgs);\n  constructor(x?: number, y?: number, width?: number, height?: number, color?: Color);\n  constructor(xOrConfig?: number | ActorArgs, y?: number, width?: number, height?: number, color?: Color) {\n    super(xOrConfig, y, width, height, color);\n  }\n}\n","import { Vector } from './Algebra';\nimport { Engine } from './Engine';\nimport { Actor, ActorArgs } from './Actor';\nimport * as Traits from './Traits/Index';\nimport { CollisionType } from './Collision/CollisionType';\nimport { Shape } from './Collision/Shape';\nimport { obsolete } from './Util/Decorators';\n\n/**\n * Helper [[Actor]] primitive for drawing UI's, optimized for UI drawing. Does\n * not participate in collisions. Drawn on top of all other actors.\n */\nexport class ScreenElement extends Actor {\n  protected _engine: Engine;\n\n  constructor();\n  constructor(xOrConfig?: number, y?: number, width?: number, height?: number);\n  constructor(config?: ActorArgs);\n  /**\n   * @param x       The starting x coordinate of the actor\n   * @param y       The starting y coordinate of the actor\n   * @param width   The starting width of the actor\n   * @param height  The starting height of the actor\n   */\n  constructor(xOrConfig?: number | ActorArgs, y?: number, width?: number, height?: number) {\n    if (typeof xOrConfig !== 'object') {\n      super(<number>xOrConfig, y, width, height);\n    } else {\n      super(<ActorArgs>xOrConfig);\n    }\n    this.traits = [];\n    this.traits.push(new Traits.CapturePointer());\n    this.anchor.setTo(0, 0);\n    this.body.collider.type = CollisionType.PreventCollision;\n    this.body.collider.shape = Shape.Box(this.width, this.height, this.anchor);\n    this.enableCapturePointer = true;\n  }\n\n  public _initialize(engine: Engine) {\n    this._engine = engine;\n    super._initialize(engine);\n  }\n\n  public contains(x: number, y: number, useWorld: boolean = true) {\n    if (useWorld) {\n      return super.contains(x, y);\n    }\n\n    const coords = this._engine.worldToScreenCoordinates(new Vector(x, y));\n    return super.contains(coords.x, coords.y);\n  }\n}\n\n/**\n * Legacy UIActor constructor\n * @obsolete UIActor constructor will be removed in v0.25.0 use [[ScreenElement]] instead\n */\n@obsolete({ message: 'Will be removed in v0.25.0', alternateMethod: 'ScreenElement' })\nexport class UIActor extends ScreenElement {}\n","import { Scene } from './Scene';\n\nexport interface TimerOptions {\n  repeats?: boolean;\n  numberOfRepeats?: number;\n  fcn?: () => void;\n  interval: number;\n}\n\n/**\n * The Excalibur timer hooks into the internal timer and fires callbacks,\n * after a certain interval, optionally repeating.\n */\nexport class Timer {\n  public static id: number = 0;\n  public id: number = 0;\n  public interval: number = 10;\n  public repeats: boolean = false;\n  public maxNumberOfRepeats: number = -1;\n  private _elapsedTime: number = 0;\n  private _totalTimeAlive: number = 0;\n  private _paused: boolean = false;\n  private _numberOfTicks: number = 0;\n  private _callbacks: Array<() => void>;\n  public complete: boolean = false;\n  public scene: Scene = null;\n\n  /**\n   * @param options    Options - repeats, numberOfRepeats, fcn, interval\n   * @param repeats    Indicates whether this call back should be fired only once, or repeat after every interval as completed.\n   * @param numberOfRepeats Specifies a maximum number of times that this timer will execute.\n   * @param fcn        The callback to be fired after the interval is complete.\n   */\n  constructor(options: TimerOptions);\n  constructor(fcn: TimerOptions | (() => void), interval?: number, repeats?: boolean, numberOfRepeats?: number) {\n    if (typeof fcn !== 'function') {\n      const options = fcn;\n      fcn = options.fcn;\n      interval = options.interval;\n      repeats = options.repeats;\n      numberOfRepeats = options.numberOfRepeats;\n    }\n\n    if (!!numberOfRepeats && numberOfRepeats >= 0) {\n      this.maxNumberOfRepeats = numberOfRepeats;\n      if (!repeats) {\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\n      }\n    }\n\n    this.id = Timer.id++;\n    this.interval = interval || this.interval;\n    this.repeats = repeats || this.repeats;\n\n    this._callbacks = [];\n\n    if (fcn) {\n      this.on(fcn);\n    }\n  }\n\n  /**\n   * Adds a new callback to be fired after the interval is complete\n   * @param fcn The callback to be added to the callback list, to be fired after the interval is complete.\n   */\n  public on(fcn: () => void) {\n    this._callbacks.push(fcn);\n  }\n\n  /**\n   * Removes a callback from the callback list to be fired after the interval is complete.\n   * @param fcn The callback to be removed from the callback list, to be fired after the interval is complete.\n   */\n  public off(fcn: () => void) {\n    const index = this._callbacks.indexOf(fcn);\n    this._callbacks.splice(index, 1);\n  }\n\n  /**\n   * Updates the timer after a certain number of milliseconds have elapsed. This is used internally by the engine.\n   * @param delta  Number of elapsed milliseconds since the last update.\n   */\n  public update(delta: number) {\n    if (!this._paused) {\n      this._totalTimeAlive += delta;\n      this._elapsedTime += delta;\n\n      if (this.maxNumberOfRepeats > -1 && this._numberOfTicks >= this.maxNumberOfRepeats) {\n        this.complete = true;\n      }\n\n      if (!this.complete && this._elapsedTime >= this.interval) {\n        this._callbacks.forEach((c) => {\n          c.call(this);\n        });\n\n        this._numberOfTicks++;\n        if (this.repeats) {\n          this._elapsedTime = 0;\n        } else {\n          this.complete = true;\n        }\n      }\n    }\n  }\n\n  /**\n   * Resets the timer so that it can be reused, and optionally reconfigure the timers interval.\n   * @param newInterval If specified, sets a new non-negative interval in milliseconds to refire the callback\n   * @param newNumberOfRepeats If specified, sets a new non-negative upper limit to the number of time this timer executes\n   */\n  public reset(newInterval?: number, newNumberOfRepeats?: number) {\n    if (!!newInterval && newInterval >= 0) {\n      this.interval = newInterval;\n    }\n\n    if (!!this.maxNumberOfRepeats && this.maxNumberOfRepeats >= 0) {\n      this.maxNumberOfRepeats = newNumberOfRepeats;\n      if (!this.repeats) {\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\n      }\n    }\n\n    this.complete = false;\n    this._elapsedTime = 0;\n    this._numberOfTicks = 0;\n  }\n\n  public get timesRepeated(): number {\n    return this._numberOfTicks;\n  }\n\n  public getTimeRunning(): number {\n    return this._totalTimeAlive;\n  }\n\n  /**\n   * Pauses the timer so that no more time will be incremented towards the next call\n   */\n  public pause() {\n    this._paused = true;\n  }\n\n  /**\n   * Unpauses the timer. Time will now increment towards the next call\n   */\n  public unpause() {\n    this._paused = false;\n  }\n\n  /**\n   * Cancels the timer, preventing any further executions.\n   */\n  public cancel() {\n    if (this.scene) {\n      this.scene.cancelTimer(this);\n    }\n  }\n}\n","import { BoundingBox } from './Collision/BoundingBox';\nimport { Color } from './Drawing/Color';\nimport { Class } from './Class';\nimport { Engine } from './Engine';\nimport { Vector } from './Algebra';\nimport { Actor } from './Actor';\nimport { Logger } from './Util/Log';\nimport { SpriteSheet } from './Drawing/SpriteSheet';\nimport * as Events from './Events';\nimport { Configurable } from './Configurable';\n\n/**\n * @hidden\n */\nexport class TileMapImpl extends Class {\n  private _collidingX: number = -1;\n  private _collidingY: number = -1;\n  private _onScreenXStart: number = 0;\n  private _onScreenXEnd: number = 9999;\n  private _onScreenYStart: number = 0;\n  private _onScreenYEnd: number = 9999;\n  private _spriteSheets: { [key: string]: SpriteSheet } = {};\n  public logger: Logger = Logger.getInstance();\n  public data: Cell[] = [];\n  public x: number;\n  public y: number;\n  public cellWidth: number;\n  public cellHeight: number;\n  public rows: number;\n  public cols: number;\n\n  public on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent) => void): void;\n  public on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n  public on(eventName: string, handler: (event: Events.GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  /**\n   * @param x             The x coordinate to anchor the TileMap's upper left corner (should not be changed once set)\n   * @param y             The y coordinate to anchor the TileMap's upper left corner (should not be changed once set)\n   * @param cellWidth     The individual width of each cell (in pixels) (should not be changed once set)\n   * @param cellHeight    The individual height of each cell (in pixels) (should not be changed once set)\n   * @param rows          The number of rows in the TileMap (should not be changed once set)\n   * @param cols          The number of cols in the TileMap (should not be changed once set)\n   */\n  constructor(xOrConfig: number | TileMapArgs, y: number, cellWidth: number, cellHeight: number, rows: number, cols: number) {\n    super();\n    if (xOrConfig && typeof xOrConfig === 'object') {\n      const config = xOrConfig;\n      xOrConfig = config.x;\n      y = config.y;\n      cellWidth = config.cellWidth;\n      cellHeight = config.cellHeight;\n      rows = config.rows;\n      cols = config.cols;\n    }\n    this.x = <number>xOrConfig;\n    this.y = y;\n    this.cellWidth = cellWidth;\n    this.cellHeight = cellHeight;\n    this.rows = rows;\n    this.cols = cols;\n    this.data = new Array<Cell>(rows * cols);\n    for (let i = 0; i < cols; i++) {\n      for (let j = 0; j < rows; j++) {\n        (() => {\n          const cd = new Cell(i * cellWidth + <number>xOrConfig, j * cellHeight + y, cellWidth, cellHeight, i + j * cols);\n          this.data[i + j * cols] = cd;\n        })();\n      }\n    }\n  }\n\n  public registerSpriteSheet(key: string, spriteSheet: SpriteSheet) {\n    this._spriteSheets[key] = spriteSheet;\n  }\n  /**\n   * Returns the intersection vector that can be used to resolve collisions with actors. If there\n   * is no collision null is returned.\n   */\n  public collides(actor: Actor): Vector {\n    const width = actor.pos.x + actor.width;\n    const height = actor.pos.y + actor.height;\n    const actorBounds = actor.body.collider.bounds;\n    const overlaps: Vector[] = [];\n    if (actor.width <= 0 || actor.height <= 0) {\n      return null;\n    }\n    // trace points for overlap\n    for (let x = actorBounds.left; x <= width; x += Math.min(actor.width / 2, this.cellWidth / 2)) {\n      for (let y = actorBounds.top; y <= height; y += Math.min(actor.height / 2, this.cellHeight / 2)) {\n        const cell = this.getCellByPoint(x, y);\n        if (cell && cell.solid) {\n          const overlap = actorBounds.intersect(cell.bounds);\n          const dir = actor.center.sub(cell.center);\n          if (overlap && overlap.dot(dir) > 0) {\n            overlaps.push(overlap);\n          }\n        }\n      }\n    }\n    if (overlaps.length === 0) {\n      return null;\n    }\n    // Return the smallest change other than zero\n    const result = overlaps.reduce((accum, next) => {\n      let x = accum.x;\n      let y = accum.y;\n      if (Math.abs(accum.x) < Math.abs(next.x)) {\n        x = next.x;\n      }\n      if (Math.abs(accum.y) < Math.abs(next.y)) {\n        y = next.y;\n      }\n      return new Vector(x, y);\n    });\n    return result;\n  }\n\n  /**\n   * Returns the [[Cell]] by index (row major order)\n   */\n  public getCellByIndex(index: number): Cell {\n    return this.data[index];\n  }\n  /**\n   * Returns the [[Cell]] by its x and y coordinates\n   */\n  public getCell(x: number, y: number): Cell {\n    if (x < 0 || y < 0 || x >= this.cols || y >= this.rows) {\n      return null;\n    }\n    return this.data[x + y * this.cols];\n  }\n  /**\n   * Returns the [[Cell]] by testing a point in global coordinates,\n   * returns `null` if no cell was found.\n   */\n  public getCellByPoint(x: number, y: number): Cell {\n    x = Math.floor((x - this.x) / this.cellWidth);\n    y = Math.floor((y - this.y) / this.cellHeight);\n    const cell = this.getCell(x, y);\n    if (x >= 0 && y >= 0 && x < this.cols && y < this.rows && cell) {\n      return cell;\n    }\n    return null;\n  }\n\n  public update(engine: Engine, delta: number) {\n    this.emit('preupdate', new Events.PreUpdateEvent(engine, delta, this));\n\n    const worldCoordsUpperLeft = engine.screenToWorldCoordinates(new Vector(0, 0));\n    const worldCoordsLowerRight = engine.screenToWorldCoordinates(new Vector(engine.canvas.clientWidth, engine.canvas.clientHeight));\n\n    this._onScreenXStart = Math.max(Math.floor((worldCoordsUpperLeft.x - this.x) / this.cellWidth) - 2, 0);\n    this._onScreenYStart = Math.max(Math.floor((worldCoordsUpperLeft.y - this.y) / this.cellHeight) - 2, 0);\n    this._onScreenXEnd = Math.max(Math.floor((worldCoordsLowerRight.x - this.x) / this.cellWidth) + 2, 0);\n    this._onScreenYEnd = Math.max(Math.floor((worldCoordsLowerRight.y - this.y) / this.cellHeight) + 2, 0);\n\n    this.emit('postupdate', new Events.PostUpdateEvent(engine, delta, this));\n  }\n\n  /**\n   * Draws the tile map to the screen. Called by the [[Scene]].\n   * @param ctx    The current rendering context\n   * @param delta  The number of milliseconds since the last draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\n    this.emit('predraw', new Events.PreDrawEvent(ctx, delta, this));\n\n    ctx.save();\n    ctx.translate(this.x, this.y);\n\n    let x = this._onScreenXStart;\n    const xEnd = Math.min(this._onScreenXEnd, this.cols);\n    let y = this._onScreenYStart;\n    const yEnd = Math.min(this._onScreenYEnd, this.rows);\n\n    let cs: TileSprite[], csi: number, cslen: number;\n\n    for (x; x < xEnd; x++) {\n      for (y; y < yEnd; y++) {\n        // get non-negative tile sprites\n        cs = this.getCell(x, y).sprites.filter((s) => {\n          return s.spriteId > -1;\n        });\n\n        for (csi = 0, cslen = cs.length; csi < cslen; csi++) {\n          const ss = this._spriteSheets[cs[csi].spriteSheetKey];\n\n          // draw sprite, warning if sprite doesn't exist\n          if (ss) {\n            const sprite = ss.getSprite(cs[csi].spriteId);\n            if (sprite) {\n              sprite.draw(ctx, x * this.cellWidth, y * this.cellHeight);\n            } else {\n              this.logger.warn('Sprite does not exist for id', cs[csi].spriteId, 'in sprite sheet', cs[csi].spriteSheetKey, sprite, ss);\n            }\n          } else {\n            this.logger.warn('Sprite sheet', cs[csi].spriteSheetKey, 'does not exist', ss);\n          }\n        }\n      }\n      y = this._onScreenYStart;\n    }\n    ctx.restore();\n\n    this.emit('postdraw', new Events.PostDrawEvent(ctx, delta, this));\n  }\n\n  /**\n   * Draws all the tile map's debug info. Called by the [[Scene]].\n   * @param ctx  The current rendering context\n   */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    const width = this.cols * this.cellWidth;\n    const height = this.rows * this.cellHeight;\n    ctx.save();\n    ctx.strokeStyle = Color.Red.toString();\n    for (let x = 0; x < this.cols + 1; x++) {\n      ctx.beginPath();\n      ctx.moveTo(this.x + x * this.cellWidth, this.y);\n      ctx.lineTo(this.x + x * this.cellWidth, this.y + height);\n      ctx.stroke();\n    }\n    for (let y = 0; y < this.rows + 1; y++) {\n      ctx.beginPath();\n      ctx.moveTo(this.x, this.y + y * this.cellHeight);\n      ctx.lineTo(this.x + width, this.y + y * this.cellHeight);\n      ctx.stroke();\n    }\n    const solid = Color.Red;\n    solid.a = 0.3;\n    this.data\n      .filter(function (cell) {\n        return cell.solid;\n      })\n      .forEach(function (cell) {\n        ctx.fillStyle = solid.toString();\n        ctx.fillRect(cell.x, cell.y, cell.width, cell.height);\n      });\n    if (this._collidingY > -1 && this._collidingX > -1) {\n      ctx.fillStyle = Color.Cyan.toString();\n      ctx.fillRect(\n        this.x + this._collidingX * this.cellWidth,\n        this.y + this._collidingY * this.cellHeight,\n        this.cellWidth,\n        this.cellHeight\n      );\n    }\n    ctx.restore();\n  }\n}\n\n/**\n * [[include:Constructors.md]]\n */\nexport interface TileMapArgs extends Partial<TileMapImpl> {\n  x: number;\n  y: number;\n  cellWidth: number;\n  cellHeight: number;\n  rows: number;\n  cols: number;\n}\n\n/**\n * The [[TileMap]] class provides a lightweight way to do large complex scenes with collision\n * without the overhead of actors.\n *\n * [[include:TileMaps.md]]\n */\nexport class TileMap extends Configurable(TileMapImpl) {\n  constructor(config: TileMapArgs);\n  constructor(x: number, y: number, cellWidth: number, cellHeight: number, rows: number, cols: number);\n  constructor(xOrConfig: number | TileMapArgs, y?: number, cellWidth?: number, cellHeight?: number, rows?: number, cols?: number) {\n    super(xOrConfig, y, cellWidth, cellHeight, rows, cols);\n  }\n}\n\n/**\n * Tile sprites are used to render a specific sprite from a [[TileMap]]'s spritesheet(s)\n */\nexport class TileSprite {\n  /**\n   * @param spriteSheetKey  The key of the spritesheet to use\n   * @param spriteId        The index of the sprite in the [[SpriteSheet]]\n   */\n  constructor(public spriteSheetKey: string, public spriteId: number) {}\n}\n\n/**\n * @hidden\n */\nexport class CellImpl {\n  private _bounds: BoundingBox;\n  public x: number;\n  public y: number;\n  public width: number;\n  public height: number;\n  public index: number;\n  public solid: boolean = false;\n  public sprites: TileSprite[] = [];\n\n  /**\n   * @param x       Gets or sets x coordinate of the cell in world coordinates\n   * @param y       Gets or sets y coordinate of the cell in world coordinates\n   * @param width   Gets or sets the width of the cell\n   * @param height  Gets or sets the height of the cell\n   * @param index   The index of the cell in row major order\n   * @param solid   Gets or sets whether this cell is solid\n   * @param sprites The list of tile sprites to use to draw in this cell (in order)\n   */\n  constructor(\n    xOrConfig: number | CellArgs,\n    y: number,\n    width: number,\n    height: number,\n    index: number,\n    solid: boolean = false,\n    sprites: TileSprite[] = []\n  ) {\n    if (xOrConfig && typeof xOrConfig === 'object') {\n      const config = xOrConfig;\n      xOrConfig = config.x;\n      y = config.y;\n      width = config.width;\n      height = config.height;\n      index = config.index;\n      solid = config.solid;\n      sprites = config.sprites;\n    }\n    this.x = <number>xOrConfig;\n    this.y = y;\n    this.width = width;\n    this.height = height;\n    this.index = index;\n    this.solid = solid;\n    this.sprites = sprites;\n    this._bounds = new BoundingBox(this.x, this.y, this.x + this.width, this.y + this.height);\n  }\n\n  public get bounds() {\n    return this._bounds;\n  }\n\n  public get center(): Vector {\n    return new Vector(this.x + this.width / 2, this.y + this.height / 2);\n  }\n\n  /**\n   * Add another [[TileSprite]] to this cell\n   */\n  public pushSprite(tileSprite: TileSprite) {\n    this.sprites.push(tileSprite);\n  }\n  /**\n   * Remove an instance of [[TileSprite]] from this cell\n   */\n  public removeSprite(tileSprite: TileSprite) {\n    let index = -1;\n    if ((index = this.sprites.indexOf(tileSprite)) > -1) {\n      this.sprites.splice(index, 1);\n    }\n  }\n  /**\n   * Clear all sprites from this cell\n   */\n  public clearSprites() {\n    this.sprites.length = 0;\n  }\n}\n\n/**\n * [[include:Constructors.md]]\n */\nexport interface CellArgs extends Partial<CellImpl> {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  index: number;\n  solid?: boolean;\n  sprites?: TileSprite[];\n}\n\n/**\n * TileMap Cell\n *\n * A light-weight object that occupies a space in a collision map. Generally\n * created by a [[TileMap]].\n *\n * Cells can draw multiple sprites. Note that the order of drawing is the order\n * of the sprites in the array so the last one will be drawn on top. You can\n * use transparency to create layers this way.\n */\nexport class Cell extends Configurable(CellImpl) {\n  constructor(config: CellArgs);\n  constructor(x: number, y: number, width: number, height: number, index: number, solid?: boolean, sprites?: TileSprite[]);\n  constructor(\n    xOrConfig: number | CellArgs,\n    y?: number,\n    width?: number,\n    height?: number,\n    index?: number,\n    solid?: boolean,\n    sprites?: TileSprite[]\n  ) {\n    super(xOrConfig, y, width, height, index, solid, sprites);\n  }\n}\n","/**\n * Internal class used to build instances of AudioContext\n */\n/* istanbul ignore next */\nexport class AudioContextFactory {\n  private static _INSTANCE: AudioContext = null;\n\n  public static create(): AudioContext {\n    if (!this._INSTANCE) {\n      if ((<any>window).AudioContext || (<any>window).webkitAudioContext) {\n        this._INSTANCE = new (<any>window).AudioContext();\n      }\n    }\n\n    return this._INSTANCE;\n  }\n}\n","import { AudioContextFactory } from '../Resources/Sound/AudioContext';\nimport { Promise, PromiseState } from '../Promises';\nimport { Logger } from './Log';\n\nexport interface LegacyWebAudioSource {\n  playbackState: string;\n  PLAYING_STATE: 'playing';\n  FINISHED_STATE: 'finished';\n}\n\nfunction isLegacyWebAudioSource(source: any): source is LegacyWebAudioSource {\n  return !!source.playbackState;\n}\n\nexport class WebAudio {\n  private static _unlocked: boolean = false;\n\n  /**\n   * Play an empty sound to unlock Safari WebAudio context. Call this function\n   * right after a user interaction event.\n   * @source https://paulbakaus.com/tutorials/html5/web-audio-on-ios/\n   */\n  static unlock(): Promise<boolean> {\n    const promise = new Promise<boolean>();\n    if (WebAudio._unlocked || !AudioContextFactory.create()) {\n      return promise.resolve(true);\n    }\n    const unlockTimeoutTimer = setTimeout(() => {\n      Logger.getInstance().warn('Excalibur was unable to unlock the audio context, audio probably will not play in this browser.');\n      promise.resolve();\n    }, 200);\n    const audioContext = AudioContextFactory.create();\n    audioContext.resume().then(\n      () => {\n        // create empty buffer and play it\n        const buffer = audioContext.createBuffer(1, 1, 22050);\n        const source = audioContext.createBufferSource();\n        let ended = false;\n\n        source.buffer = buffer;\n        source.connect(audioContext.destination);\n        source.onended = () => (ended = true);\n\n        if ((<any>source).noteOn) {\n          // deprecated\n          (<any>source).noteOn(0);\n        } else {\n          source.start(0);\n        }\n\n        // by checking the play state after some time, we know if we're really unlocked\n        setTimeout(() => {\n          if (isLegacyWebAudioSource(source)) {\n            if (source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE) {\n              WebAudio._unlocked = true;\n            }\n          } else {\n            if (audioContext.currentTime > 0 || ended) {\n              WebAudio._unlocked = true;\n            }\n          }\n        }, 0);\n\n        clearTimeout(unlockTimeoutTimer);\n        if (promise.state() === PromiseState.Pending) {\n          promise.resolve();\n        }\n      },\n      () => {\n        if (promise.state() === PromiseState.Pending) {\n          promise.reject(false);\n        }\n      }\n    );\n\n    return promise;\n  }\n\n  static isUnlocked() {\n    return this._unlocked;\n  }\n}\n","import { Engine } from './Engine';\nimport { EasingFunction, EasingFunctions } from './Util/EasingFunctions';\nimport { PromiseLike, Promise, PromiseState } from './Promises';\nimport { Vector } from './Algebra';\nimport { Actor } from './Actor';\nimport { removeItemFromArray } from './Util/Util';\nimport { CanUpdate, CanInitialize } from './Interfaces/LifecycleEvents';\nimport { PreUpdateEvent, PostUpdateEvent, GameEvent, InitializeEvent } from './Events';\nimport { Class } from './Class';\nimport { BoundingBox } from './Collision/BoundingBox';\n\n/**\n * Interface that describes a custom camera strategy for tracking targets\n */\nexport interface CameraStrategy<T> {\n  /**\n   * Target of the camera strategy that will be passed to the action\n   */\n  target: T;\n\n  /**\n   * Camera strategies perform an action to calculate a new focus returned out of the strategy\n   * @param target The target object to apply this camera strategy (if any)\n   * @param camera The current camera implementation in excalibur running the game\n   * @param engine The current engine running the game\n   * @param delta The elapsed time in milliseconds since the last frame\n   */\n  action: (target: T, camera: Camera, engine: Engine, delta: number) => Vector;\n}\n\n/**\n * Container to house convenience strategy methods\n * @internal\n */\nexport class StrategyContainer {\n  constructor(public camera: Camera) {}\n\n  /**\n   * Creates and adds the [[LockCameraToActorStrategy]] on the current camera.\n   * @param actor The actor to lock the camera to\n   */\n  public lockToActor(actor: Actor) {\n    this.camera.addStrategy(new LockCameraToActorStrategy(actor));\n  }\n\n  /**\n   * Creates and adds the [[LockCameraToActorAxisStrategy]] on the current camera\n   * @param actor The actor to lock the camera to\n   * @param axis The axis to follow the actor on\n   */\n  public lockToActorAxis(actor: Actor, axis: Axis) {\n    this.camera.addStrategy(new LockCameraToActorAxisStrategy(actor, axis));\n  }\n\n  /**\n   * Creates and adds the [[ElasticToActorStrategy]] on the current camera\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\n   * correct and bounce around the target\n   *\n   * @param target Target actor to elastically follow\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\n   */\n  public elasticToActor(actor: Actor, cameraElasticity: number, cameraFriction: number) {\n    this.camera.addStrategy(new ElasticToActorStrategy(actor, cameraElasticity, cameraFriction));\n  }\n\n  /**\n   * Creates and adds the [[RadiusAroundActorStrategy]] on the current camera\n   * @param target Target actor to follow when it is \"radius\" pixels away\n   * @param radius Number of pixels away before the camera will follow\n   */\n  public radiusAroundActor(actor: Actor, radius: number) {\n    this.camera.addStrategy(new RadiusAroundActorStrategy(actor, radius));\n  }\n}\n\n/**\n * Camera axis enum\n */\nexport enum Axis {\n  X,\n  Y\n}\n\n/**\n * Lock a camera to the exact x/y position of an actor.\n */\nexport class LockCameraToActorStrategy implements CameraStrategy<Actor> {\n  constructor(public target: Actor) {}\n  public action = (target: Actor, _cam: Camera, _eng: Engine, _delta: number) => {\n    const center = target.center;\n    return center;\n  };\n}\n\n/**\n * Lock a camera to a specific axis around an actor.\n */\nexport class LockCameraToActorAxisStrategy implements CameraStrategy<Actor> {\n  constructor(public target: Actor, public axis: Axis) {}\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\n    const center = target.center;\n    const currentFocus = cam.getFocus();\n    if (this.axis === Axis.X) {\n      return new Vector(center.x, currentFocus.y);\n    } else {\n      return new Vector(currentFocus.x, center.y);\n    }\n  };\n}\n\n/**\n * Using [Hook's law](https://en.wikipedia.org/wiki/Hooke's_law), elastically move the camera towards the target actor.\n */\nexport class ElasticToActorStrategy implements CameraStrategy<Actor> {\n  /**\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\n   * correct and bounce around the target\n   *\n   * @param target Target actor to elastically follow\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\n   */\n  constructor(public target: Actor, public cameraElasticity: number, public cameraFriction: number) {}\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\n    const position = target.center;\n    let focus = cam.getFocus();\n    let cameraVel = cam.vel.clone();\n\n    // Calculate the stretch vector, using the spring equation\n    // F = kX\n    // https://en.wikipedia.org/wiki/Hooke's_law\n    // Apply to the current camera velocity\n    const stretch = position.sub(focus).scale(this.cameraElasticity); // stretch is X\n    cameraVel = cameraVel.add(stretch);\n\n    // Calculate the friction (-1 to apply a force in the opposition of motion)\n    // Apply to the current camera velocity\n    const friction = cameraVel.scale(-1).scale(this.cameraFriction);\n    cameraVel = cameraVel.add(friction);\n\n    // Update position by velocity deltas\n    focus = focus.add(cameraVel);\n\n    return focus;\n  };\n}\n\nexport class RadiusAroundActorStrategy implements CameraStrategy<Actor> {\n  /**\n   *\n   * @param target Target actor to follow when it is \"radius\" pixels away\n   * @param radius Number of pixels away before the camera will follow\n   */\n  constructor(public target: Actor, public radius: number) {}\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\n    const position = target.center;\n    const focus = cam.getFocus();\n\n    const direction = position.sub(focus);\n    const distance = direction.size;\n    if (distance >= this.radius) {\n      const offset = distance - this.radius;\n      return focus.add(direction.normalize().scale(offset));\n    }\n    return focus;\n  };\n}\n\n/**\n * Cameras\n *\n * [[Camera]] is the base class for all Excalibur cameras. Cameras are used\n * to move around your game and set focus. They are used to determine\n * what is \"off screen\" and can be used to scale the game.\n *\n * [[include:Cameras.md]]\n */\nexport class Camera extends Class implements CanUpdate, CanInitialize {\n  protected _follow: Actor;\n\n  private _cameraStrategies: CameraStrategy<any>[] = [];\n\n  public strategy: StrategyContainer = new StrategyContainer(this);\n\n  /**\n   * Get or set current zoom of the camera, defaults to 1\n   */\n  public z: number = 1;\n  /**\n   * Get or set rate of change in zoom, defaults to 0\n   */\n  public dz: number = 0;\n  /**\n   * Get or set zoom acceleration\n   */\n  public az: number = 0;\n\n  /**\n   * Current rotation of the camera\n   */\n  public rotation: number = 0;\n\n  /**\n   * Current angular velocity\n   */\n  public rx: number = 0;\n\n  /**\n   * Get or set the camera's angular velocity\n   */\n  public get angularVelocity(): number {\n    return this.rx;\n  }\n\n  public set angularVelocity(value: number) {\n    this.rx = value;\n  }\n\n  /**\n   * Get or set the camera's position\n   */\n  public pos: Vector = Vector.Zero;\n\n  /**\n   * Get or set the camera's velocity\n   */\n  public vel: Vector = Vector.Zero;\n\n  /**\n   * GEt or set the camera's acceleration\n   */\n  public acc: Vector = Vector.Zero;\n\n  private _cameraMoving: boolean = false;\n  private _currentLerpTime: number = 0;\n  private _lerpDuration: number = 1000; // 1 second\n  private _lerpStart: Vector = null;\n  private _lerpEnd: Vector = null;\n  private _lerpPromise: PromiseLike<Vector>;\n\n  //camera effects\n  protected _isShaking: boolean = false;\n  private _shakeMagnitudeX: number = 0;\n  private _shakeMagnitudeY: number = 0;\n  private _shakeDuration: number = 0;\n  private _elapsedShakeTime: number = 0;\n  private _xShake: number = 0;\n  private _yShake: number = 0;\n\n  protected _isZooming: boolean = false;\n  private _zoomStart: number = 1;\n  private _zoomEnd: number = 1;\n  private _currentZoomTime: number = 0;\n  private _zoomDuration: number = 0;\n\n  private _zoomPromise: Promise<boolean>;\n  private _zoomEasing: EasingFunction = EasingFunctions.EaseInOutCubic;\n  private _easing: EasingFunction = EasingFunctions.EaseInOutCubic;\n\n  /**\n   * Get the camera's x position\n   */\n  public get x() {\n    return this.pos.x;\n  }\n\n  /**\n   * Set the camera's x position (cannot be set when following an [[Actor]] or when moving)\n   */\n  public set x(value: number) {\n    if (!this._follow && !this._cameraMoving) {\n      this.pos.x = value;\n    }\n  }\n\n  /**\n   * Get the camera's y position\n   */\n  public get y() {\n    return this.pos.y;\n  }\n\n  /**\n   * Set the camera's y position (cannot be set when following an [[Actor]] or when moving)\n   */\n  public set y(value: number) {\n    if (!this._follow && !this._cameraMoving) {\n      this.pos.y = value;\n    }\n  }\n\n  /**\n   * Get or set the camera's x velocity\n   */\n  public get dx() {\n    return this.vel.x;\n  }\n\n  public set dx(value: number) {\n    this.vel.x = value;\n  }\n\n  /**\n   * Get or set the camera's y velocity\n   */\n  public get dy() {\n    return this.vel.y;\n  }\n\n  public set dy(value: number) {\n    this.vel.y = value;\n  }\n\n  /**\n   * Get or set the camera's x acceleration\n   */\n  public get ax() {\n    return this.acc.x;\n  }\n\n  public set ax(value: number) {\n    this.acc.x = value;\n  }\n\n  /**\n   * Get or set the camera's y acceleration\n   */\n  public get ay() {\n    return this.acc.y;\n  }\n\n  public set ay(value: number) {\n    this.acc.y = value;\n  }\n\n  /**\n   * Returns the focal point of the camera, a new point giving the x and y position of the camera\n   */\n  public getFocus() {\n    return this.pos;\n  }\n\n  /**\n   * This moves the camera focal point to the specified position using specified easing function. Cannot move when following an Actor.\n   *\n   * @param pos The target position to move to\n   * @param duration The duration in milliseconds the move should last\n   * @param [easingFn] An optional easing function ([[ex.EasingFunctions.EaseInOutCubic]] by default)\n   * @returns A [[Promise]] that resolves when movement is finished, including if it's interrupted.\n   *          The [[Promise]] value is the [[Vector]] of the target position. It will be rejected if a move cannot be made.\n   */\n  public move(pos: Vector, duration: number, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): PromiseLike<Vector> {\n    if (typeof easingFn !== 'function') {\n      throw 'Please specify an EasingFunction';\n    }\n\n    // cannot move when following an actor\n    if (this._follow) {\n      return new Promise<Vector>().reject(pos);\n    }\n\n    // resolve existing promise, if any\n    if (this._lerpPromise && this._lerpPromise.state() === PromiseState.Pending) {\n      this._lerpPromise.resolve(pos);\n    }\n\n    this._lerpPromise = new Promise<Vector>();\n    this._lerpStart = this.getFocus().clone();\n    this._lerpDuration = duration;\n    this._lerpEnd = pos;\n    this._currentLerpTime = 0;\n    this._cameraMoving = true;\n    this._easing = easingFn;\n\n    return this._lerpPromise;\n  }\n\n  /**\n   * Sets the camera to shake at the specified magnitudes for the specified duration\n   * @param magnitudeX  The x magnitude of the shake\n   * @param magnitudeY  The y magnitude of the shake\n   * @param duration    The duration of the shake in milliseconds\n   */\n  public shake(magnitudeX: number, magnitudeY: number, duration: number) {\n    this._isShaking = true;\n    this._shakeMagnitudeX = magnitudeX;\n    this._shakeMagnitudeY = magnitudeY;\n    this._shakeDuration = duration;\n  }\n\n  /**\n   * Zooms the camera in or out by the specified scale over the specified duration.\n   * If no duration is specified, it take effect immediately.\n   * @param scale    The scale of the zoom\n   * @param duration The duration of the zoom in milliseconds\n   */\n  public zoom(scale: number, duration: number = 0, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<boolean> {\n    this._zoomPromise = new Promise<boolean>();\n\n    if (duration) {\n      this._isZooming = true;\n      this._zoomEasing = easingFn;\n      this._currentZoomTime = 0;\n      this._zoomDuration = duration;\n      this._zoomStart = this.z;\n      this._zoomEnd = scale;\n    } else {\n      this._isZooming = false;\n      this.z = scale;\n      this._zoomPromise.resolve(true);\n    }\n\n    return this._zoomPromise;\n  }\n\n  /**\n   * Gets the current zoom scale\n   */\n  public getZoom() {\n    return this.z;\n  }\n\n  /**\n   * Gets the bounding box of the viewport of this camera in world coordinates\n   */\n  public get viewport(): BoundingBox {\n    if (this._engine) {\n      const halfWidth = this._engine.halfDrawWidth;\n      const halfHeight = this._engine.halfDrawHeight;\n\n      return new BoundingBox(this.x - halfWidth, this.y - halfHeight, this.x + halfWidth, this.y + halfHeight);\n    }\n    return new BoundingBox(0, 0, 0, 0);\n  }\n\n  /**\n   * Adds a new camera strategy to this camera\n   * @param cameraStrategy Instance of an [[CameraStrategy]]\n   */\n  public addStrategy<T>(cameraStrategy: CameraStrategy<T>) {\n    this._cameraStrategies.push(cameraStrategy);\n  }\n\n  /**\n   * Removes a camera strategy by reference\n   * @param cameraStrategy Instance of an [[CameraStrategy]]\n   */\n  public removeStrategy<T>(cameraStrategy: CameraStrategy<T>) {\n    removeItemFromArray(cameraStrategy, this._cameraStrategies);\n  }\n\n  /**\n   * Clears all camera strategies from the camera\n   */\n  public clearAllStrategies() {\n    this._cameraStrategies.length = 0;\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPreUpdate(engine, delta);\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before a scene is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // Overridable\n  }\n\n  /**\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(engine: Engine, delta: number): void {\n    this.emit('postupdate', new PostUpdateEvent(engine, delta, this));\n    this.onPostUpdate(engine, delta);\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after a scene is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // Overridable\n  }\n\n  private _engine: Engine;\n  private _isInitialized = false;\n  public get isInitialized() {\n    return this._isInitialized;\n  }\n\n  public _initialize(_engine: Engine) {\n    if (!this.isInitialized) {\n      this.onInitialize(_engine);\n      super.emit('initialize', new InitializeEvent(_engine, this));\n      this._isInitialized = true;\n      this._engine = _engine;\n    }\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after a scene is updated.\n   */\n  public onInitialize(_engine: Engine) {\n    // Overridable\n  }\n\n  public on(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\n  public on(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\n  public on(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\n  public on(eventName: any, handler: any) {\n    super.on(eventName, handler);\n  }\n\n  public off(eventName: 'initialize', handler?: (event: InitializeEvent) => void): void;\n  public off(eventName: 'preupdate', handler?: (event: PreUpdateEvent) => void): void;\n  public off(eventName: 'postupdate', handler?: (event: PostUpdateEvent) => void): void;\n  public off(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\n  public off(eventName: string, handler: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  public once(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\n  public once(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\n  public once(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public update(_engine: Engine, delta: number) {\n    this._initialize(_engine);\n    this._preupdate(_engine, delta);\n\n    // Update placements based on linear algebra\n    this.pos = this.pos.add(this.vel.scale(delta / 1000));\n    this.z += (this.dz * delta) / 1000;\n\n    this.vel = this.vel.add(this.acc.scale(delta / 1000));\n    this.dz += (this.az * delta) / 1000;\n\n    this.rotation += (this.angularVelocity * delta) / 1000;\n\n    if (this._isZooming) {\n      if (this._currentZoomTime < this._zoomDuration) {\n        const zoomEasing = this._zoomEasing;\n        const newZoom = zoomEasing(this._currentZoomTime, this._zoomStart, this._zoomEnd, this._zoomDuration);\n\n        this.z = newZoom;\n        this._currentZoomTime += delta;\n      } else {\n        this._isZooming = false;\n        this.z = this._zoomEnd;\n        this._currentZoomTime = 0;\n        this._zoomPromise.resolve(true);\n      }\n    }\n\n    if (this._cameraMoving) {\n      if (this._currentLerpTime < this._lerpDuration) {\n        const moveEasing = EasingFunctions.CreateVectorEasingFunction(this._easing);\n\n        const lerpPoint = moveEasing(this._currentLerpTime, this._lerpStart, this._lerpEnd, this._lerpDuration);\n\n        this.pos = lerpPoint;\n\n        this._currentLerpTime += delta;\n      } else {\n        this.pos = this._lerpEnd;\n        const end = this._lerpEnd.clone();\n\n        this._lerpStart = null;\n        this._lerpEnd = null;\n        this._currentLerpTime = 0;\n        this._cameraMoving = false;\n        // Order matters here, resolve should be last so any chain promises have a clean slate\n        this._lerpPromise.resolve(end);\n      }\n    }\n\n    if (this._isDoneShaking()) {\n      this._isShaking = false;\n      this._elapsedShakeTime = 0;\n      this._shakeMagnitudeX = 0;\n      this._shakeMagnitudeY = 0;\n      this._shakeDuration = 0;\n      this._xShake = 0;\n      this._yShake = 0;\n    } else {\n      this._elapsedShakeTime += delta;\n      this._xShake = ((Math.random() * this._shakeMagnitudeX) | 0) + 1;\n      this._yShake = ((Math.random() * this._shakeMagnitudeY) | 0) + 1;\n    }\n\n    for (const s of this._cameraStrategies) {\n      this.pos = s.action.call(s, s.target, this, _engine, delta);\n    }\n\n    this._postupdate(_engine, delta);\n  }\n\n  /**\n   * Applies the relevant transformations to the game canvas to \"move\" or apply effects to the Camera\n   * @param ctx    Canvas context to apply transformations\n   * @param delta  The number of milliseconds since the last update\n   */\n  public draw(ctx: CanvasRenderingContext2D) {\n    const focus = this.getFocus();\n    const canvasWidth = ctx.canvas.width;\n    const canvasHeight = ctx.canvas.height;\n    const pixelRatio = this._engine ? this._engine.pixelRatio : window.devicePixelRatio;\n    const zoom = this.getZoom();\n\n    const newCanvasWidth = canvasWidth / zoom / pixelRatio;\n    const newCanvasHeight = canvasHeight / zoom / pixelRatio;\n\n    ctx.scale(zoom, zoom);\n    ctx.translate(-focus.x + newCanvasWidth / 2 + this._xShake, -focus.y + newCanvasHeight / 2 + this._yShake);\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    const focus = this.getFocus();\n    ctx.fillStyle = 'red';\n    ctx.strokeStyle = 'white';\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    ctx.arc(focus.x, focus.y, 15, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.stroke();\n\n    ctx.beginPath();\n    ctx.arc(focus.x, focus.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.stroke();\n\n    ctx.beginPath();\n    ctx.setLineDash([5, 15]);\n    ctx.lineWidth = 5;\n    ctx.strokeStyle = 'white';\n    ctx.strokeRect(this.viewport.left, this.viewport.top, this.viewport.width, this.viewport.height);\n    ctx.closePath();\n  }\n\n  private _isDoneShaking(): boolean {\n    return !this._isShaking || this._elapsedShakeTime >= this._shakeDuration;\n  }\n}\n","import { Color } from './Drawing/Color';\nimport { WebAudio } from './Util/WebAudio';\nimport { Logger } from './Util/Log';\nimport { Promise, PromiseState } from './Promises';\nimport { Engine } from './Engine';\nimport { Loadable } from './Interfaces/Loadable';\nimport { CanLoad } from './Interfaces/Loader';\nimport { Class } from './Class';\nimport * as DrawUtil from './Util/DrawUtil';\n\nimport logoImg from './Loader.logo.png';\nimport loaderCss from './Loader.css';\n\n/**\n * Pre-loading assets\n *\n * The loader provides a mechanism to preload multiple resources at\n * one time. The loader must be passed to the engine in order to\n * trigger the loading progress bar.\n *\n * The [[Loader]] itself implements [[Loadable]] so you can load loaders.\n *\n * ## Example: Pre-loading resources for a game\n *\n * ```js\n * // create a loader\n * var loader = new ex.Loader();\n *\n * // create a resource dictionary (best practice is to keep a separate file)\n * var resources = {\n *   TextureGround: new ex.Texture(\"/images/textures/ground.png\"),\n *   SoundDeath: new ex.Sound(\"/sound/death.wav\", \"/sound/death.mp3\")\n * };\n *\n * // loop through dictionary and add to loader\n * for (var loadable in resources) {\n *   if (resources.hasOwnProperty(loadable)) {\n *     loader.addResource(resources[loadable]);\n *   }\n * }\n *\n * // start game\n * game.start(loader).then(function () {\n *   console.log(\"Game started!\");\n * });\n * ```\n *\n * ## Customize the Loader\n *\n * The loader can be customized to show different, text, logo, background color, and button.\n *\n * ```typescript\n * const loader = new ex.Loader([playerTexture]);\n *\n * // The loaders button text can simply modified using this\n * loader.playButtonText = 'Start the best game ever';\n *\n * // The logo can be changed by inserting a base64 image string here\n *\n * loader.logo = 'data:image/png;base64,iVBORw...';\n * loader.logoWidth = 15;\n * loader.logoHeight = 14;\n *\n * // The background color can be changed like so by supplying a valid CSS color string\n *\n * loader.backgroundColor = 'red'\n * loader.backgroundColor = '#176BAA'\n *\n * // To build a completely new button\n * loader.startButtonFactory = () => {\n *     let myButton = document.createElement('button');\n *     myButton.textContent = 'The best button';\n *     return myButton;\n * };\n *\n * engine.start(loader).then(() => {});\n * ```\n */\nexport class Loader extends Class implements CanLoad {\n  private _resourceList: Loadable[] = [];\n  private _index = 0;\n\n  private _playButtonShown: boolean = false;\n  private _resourceCount: number = 0;\n  private _numLoaded: number = 0;\n  private _progressCounts: { [key: string]: number } = {};\n  private _totalCounts: { [key: string]: number } = {};\n  private _engine: Engine;\n\n  // logo drawing stuff\n\n  // base64 string encoding of the excalibur logo (logo-white.png)\n  public logo = logoImg;\n  public logoWidth = 468;\n  public logoHeight = 118;\n  public backgroundColor = '#176BAA';\n\n  protected _imageElement: HTMLImageElement;\n  protected get _image() {\n    if (!this._imageElement) {\n      this._imageElement = new Image();\n      this._imageElement.src = this.logo;\n    }\n\n    return this._imageElement;\n  }\n\n  public suppressPlayButton: boolean = false;\n  protected _playButtonRootElement: HTMLElement;\n  protected _playButtonElement: HTMLButtonElement;\n  protected _styleBlock: HTMLStyleElement;\n  /** Loads the css from Loader.css */\n  protected _playButtonStyles: string = loaderCss.toString();\n  protected get _playButton() {\n    if (!this._playButtonRootElement) {\n      this._playButtonRootElement = document.createElement('div');\n      this._playButtonRootElement.style.position = 'absolute';\n      document.body.appendChild(this._playButtonRootElement);\n    }\n    if (!this._styleBlock) {\n      this._styleBlock = document.createElement('style');\n      this._styleBlock.textContent = this._playButtonStyles;\n      document.head.appendChild(this._styleBlock);\n    }\n    if (!this._playButtonElement) {\n      this._playButtonElement = this.startButtonFactory();\n      this._playButtonRootElement.appendChild(this._playButtonElement);\n    }\n    return this._playButtonElement;\n  }\n\n  /**\n   * Get/set play button text\n   */\n  public playButtonText: string = 'Play game';\n\n  /**\n   * Return a html button element for excalibur to use as a play button\n   */\n  public startButtonFactory = () => {\n    const buttonElement = document.createElement('button');\n    buttonElement.id = 'excalibur-play';\n    buttonElement.textContent = this.playButtonText;\n    buttonElement.style.display = 'none';\n    return buttonElement;\n  };\n\n  /**\n   * @param loadables  Optionally provide the list of resources you want to load at constructor time\n   */\n  constructor(loadables?: Loadable[]) {\n    super();\n\n    if (loadables) {\n      this.addResources(loadables);\n    }\n  }\n\n  public wireEngine(engine: Engine) {\n    this._engine = engine;\n  }\n\n  /**\n   * Add a resource to the loader to load\n   * @param loadable  Resource to add\n   */\n  public addResource(loadable: Loadable) {\n    const key = this._index++;\n    this._resourceList.push(loadable);\n    this._progressCounts[key] = 0;\n    this._totalCounts[key] = 1;\n    this._resourceCount++;\n  }\n\n  /**\n   * Add a list of resources to the loader to load\n   * @param loadables  The list of resources to load\n   */\n  public addResources(loadables: Loadable[]) {\n    let i = 0;\n    const len = loadables.length;\n\n    for (i; i < len; i++) {\n      this.addResource(loadables[i]);\n    }\n  }\n\n  /**\n   * Returns true if the loader has completely loaded all resources\n   */\n  public isLoaded() {\n    return this._numLoaded === this._resourceCount;\n  }\n\n  /**\n   * Shows the play button and returns a promise that resolves when clicked\n   */\n  public showPlayButton(): Promise<any> {\n    if (this.suppressPlayButton) {\n      return Promise.resolve();\n    } else {\n      this._playButtonShown = true;\n      this._playButton.style.display = 'block';\n      const promise = new Promise();\n\n      this._playButton.addEventListener('click', () => (promise.state() === PromiseState.Pending ? promise.resolve() : promise));\n      this._playButton.addEventListener('touchend', () => (promise.state() === PromiseState.Pending ? promise.resolve() : promise));\n      this._playButton.addEventListener('pointerup', () => (promise.state() === PromiseState.Pending ? promise.resolve() : promise));\n\n      return promise;\n    }\n  }\n\n  public hidePlayButton() {\n    this._playButtonShown = false;\n    this._playButton.style.display = 'none';\n  }\n\n  /**\n   * Begin loading all of the supplied resources, returning a promise\n   * that resolves when loading of all is complete\n   */\n  public load(): Promise<any> {\n    const complete = new Promise<any>();\n    const me = this;\n    if (this._resourceList.length === 0) {\n      me.showPlayButton().then(() => {\n        // Unlock audio context in chrome after user gesture\n        // https://github.com/excaliburjs/Excalibur/issues/262\n        // https://github.com/excaliburjs/Excalibur/issues/1031\n        WebAudio.unlock().then(() => {\n          me.hidePlayButton();\n          me.oncomplete.call(me);\n          complete.resolve();\n        });\n      });\n      return complete;\n    }\n\n    const progressArray = new Array<any>(this._resourceList.length);\n    const progressChunks = this._resourceList.length;\n\n    this._resourceList.forEach((r, i) => {\n      if (this._engine) {\n        r.wireEngine(this._engine);\n      }\n      r.onprogress = function(e) {\n        const total = <number>e.total;\n        const loaded = <number>e.loaded;\n        progressArray[i] = { loaded: (loaded / total) * (100 / progressChunks), total: 100 };\n\n        const progressResult: any = progressArray.reduce(\n          function(accum, next) {\n            return { loaded: accum.loaded + next.loaded, total: 100 };\n          },\n          { loaded: 0, total: 100 }\n        );\n\n        me.onprogress.call(me, progressResult);\n      };\n      r.oncomplete = r.onerror = function() {\n        me._numLoaded++;\n        if (me._numLoaded === me._resourceCount) {\n          setTimeout(() => {\n            me.showPlayButton().then(() => {\n              // Unlock audio context in chrome after user gesture\n              // https://github.com/excaliburjs/Excalibur/issues/262\n              // https://github.com/excaliburjs/Excalibur/issues/1031\n              WebAudio.unlock().then(() => {\n                me.hidePlayButton();\n                me.oncomplete.call(me);\n                complete.resolve();\n              });\n            });\n          }, 200); // short delay in showing the button for aesthetics\n        }\n      };\n    });\n\n    function loadNext(list: Loadable[], index: number) {\n      if (!list[index]) {\n        return;\n      }\n      list[index].load().then(function() {\n        loadNext(list, index + 1);\n      });\n    }\n    loadNext(this._resourceList, 0);\n\n    return complete;\n  }\n\n  /**\n   * Loader draw function. Draws the default Excalibur loading screen.\n   * Override `logo`, `logoWidth`, `logoHeight` and `backgroundColor` properties\n   * to customize the drawing, or just override entire method.\n   */\n  public draw(ctx: CanvasRenderingContext2D) {\n    const canvasHeight = this._engine.canvasHeight / this._engine.pixelRatio;\n    const canvasWidth = this._engine.canvasWidth / this._engine.pixelRatio;\n\n    if (this._playButtonRootElement) {\n      const left = ctx.canvas.offsetLeft;\n      const top = ctx.canvas.offsetTop;\n      const buttonWidth = this._playButton.clientWidth;\n      const buttonHeight = this._playButton.clientHeight;\n      this._playButtonRootElement.style.left = `${left + canvasWidth / 2 - buttonWidth / 2}px`;\n      this._playButtonRootElement.style.top = `${top + canvasHeight / 2 - buttonHeight / 2 + 100}px`;\n    }\n\n    ctx.fillStyle = this.backgroundColor;\n    ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n\n    const y = canvasHeight / 2;\n    const width = Math.min(this.logoWidth, canvasWidth * 0.75);\n    const x = canvasWidth / 2 - width / 2;\n\n    const imageHeight = Math.floor(width * (this.logoHeight / this.logoWidth)); // OG height/width factor\n    const oldAntialias = this._engine.getAntialiasing();\n    this._engine.setAntialiasing(true);\n    ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, x, y - imageHeight - 20, width, imageHeight);\n\n    // loading box\n    if (!this.suppressPlayButton && this._playButtonShown) {\n      this._engine.setAntialiasing(oldAntialias);\n      return;\n    }\n\n    ctx.lineWidth = 2;\n    DrawUtil.roundRect(ctx, x, y, width, 20, 10);\n    const progress = width * (this._numLoaded / this._resourceCount);\n    const margin = 5;\n    const progressWidth = progress - margin * 2;\n    const height = 20 - margin * 2;\n    DrawUtil.roundRect(ctx, x + margin, y + margin, progressWidth > 0 ? progressWidth : 0, height, 5, null, Color.White);\n    this._engine.setAntialiasing(oldAntialias);\n  }\n\n  /**\n   * Perform any calculations or logic in the `update` method. The default `Loader` does not\n   * do anything in this method so it is safe to override.\n   */\n  public update(_engine: Engine, _delta: number) {\n    // overridable update\n  }\n\n  public getData: () => any = () => {\n    return;\n  };\n\n  public setData: (data: any) => any = () => {\n    return;\n  };\n\n  public processData: (data: any) => any = () => {\n    return;\n  };\n\n  public onprogress: (e: any) => void = (e: any) => {\n    Logger.getInstance().debug('[ex.Loader] Loading ' + ((100 * e.loaded) / e.total).toFixed(0));\n\n    return;\n  };\n\n  public oncomplete: () => void = () => {\n    return;\n  };\n\n  public onerror: () => void = () => {\n    return;\n  };\n}\n","export default \"data:image/png;base64,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\"","import { Logger } from './Log';\n/**\n * This is the list of features that will be used to log the supported\n * features to the console when Detector.logBrowserFeatures() is called.\n */\n\nconst REPORTED_FEATURES: { [key: string]: string } = {\n  webgl: 'WebGL',\n  webaudio: 'WebAudio',\n  gamepadapi: 'Gamepad API'\n};\n\n/**\n * Interface for detected browser features matrix\n */\nexport interface DetectedFeatures {\n  readonly canvas: boolean;\n  readonly arraybuffer: boolean;\n  readonly dataurl: boolean;\n  readonly objecturl: boolean;\n  readonly rgba: boolean;\n  readonly webaudio: boolean;\n  readonly webgl: boolean;\n  readonly gamepadapi: boolean;\n}\n\ninterface CriticalTests {\n  canvasSupport(): boolean;\n  arrayBufferSupport(): boolean;\n  dataUrlSupport(): boolean;\n  objectUrlSupport(): boolean;\n  rgbaSupport(): boolean;\n}\n\ninterface WarningTests {\n  webAudioSupport(): boolean;\n  webglSupport(): boolean;\n}\n\n/**\n * Excalibur internal feature detection helper class\n */\nexport class Detector {\n  private _features: DetectedFeatures = null;\n\n  public failedTests: string[] = [];\n\n  public constructor() {\n    this._features = this._loadBrowserFeatures();\n  }\n\n  /**\n   * Returns a map of currently supported browser features. This method\n   * treats the features as a singleton and will only calculate feature\n   * support if it has not previously been done.\n   */\n  public getBrowserFeatures(): DetectedFeatures {\n    if (this._features === null) {\n      this._features = this._loadBrowserFeatures();\n    }\n    return this._features;\n  }\n\n  /**\n   * Report on non-critical browser support for debugging purposes.\n   * Use native browser console colors for visibility.\n   */\n  public logBrowserFeatures(): void {\n    let msg = '%cSUPPORTED BROWSER FEATURES\\n==========================%c\\n';\n    const args = ['font-weight: bold; color: navy', 'font-weight: normal; color: inherit'];\n\n    const supported: any = this.getBrowserFeatures();\n    for (const feature of Object.keys(REPORTED_FEATURES)) {\n      if (supported[feature]) {\n        msg += '(%c\\u2713%c)'; // (✓)\n        args.push('font-weight: bold; color: green');\n        args.push('font-weight: normal; color: inherit');\n      } else {\n        msg += '(%c\\u2717%c)'; // (✗)\n        args.push('font-weight: bold; color: red');\n        args.push('font-weight: normal; color: inherit');\n      }\n\n      msg += ' ' + REPORTED_FEATURES[feature] + '\\n';\n    }\n\n    args.unshift(msg);\n    // eslint-disable-next-line no-console\n    console.log.apply(console, args);\n  }\n\n  /**\n   * Executes several IIFE's to get a constant reference to supported\n   * features within the current execution context.\n   */\n  private _loadBrowserFeatures(): DetectedFeatures {\n    return {\n      // IIFE to check canvas support\n      canvas: (() => {\n        return this._criticalTests.canvasSupport();\n      })(),\n\n      // IIFE to check arraybuffer support\n      arraybuffer: (() => {\n        return this._criticalTests.arrayBufferSupport();\n      })(),\n\n      // IIFE to check dataurl support\n      dataurl: (() => {\n        return this._criticalTests.dataUrlSupport();\n      })(),\n\n      // IIFE to check objecturl support\n      objecturl: (() => {\n        return this._criticalTests.objectUrlSupport();\n      })(),\n\n      // IIFE to check rgba support\n      rgba: (() => {\n        return this._criticalTests.rgbaSupport();\n      })(),\n\n      // IIFE to check webaudio support\n      webaudio: (() => {\n        return this._warningTest.webAudioSupport();\n      })(),\n\n      // IIFE to check webgl support\n      webgl: (() => {\n        return this._warningTest.webglSupport();\n      })(),\n\n      // IIFE to check gamepadapi support\n      gamepadapi: (() => {\n        return !!(<any>navigator).getGamepads;\n      })()\n    };\n  }\n\n  // critical browser features required for ex to run\n  private _criticalTests: CriticalTests = {\n    // Test canvas/2d context support\n    canvasSupport: function() {\n      const elem = document.createElement('canvas');\n      return !!(elem.getContext && elem.getContext('2d'));\n    },\n\n    // Test array buffer support ex uses for downloading binary data\n    arrayBufferSupport: function() {\n      const xhr = new XMLHttpRequest();\n      xhr.open('GET', '/');\n      try {\n        xhr.responseType = 'arraybuffer';\n      } catch (e) {\n        return false;\n      }\n      return xhr.responseType === 'arraybuffer';\n    },\n\n    // Test data urls ex uses for sprites\n    dataUrlSupport: function() {\n      const canvas = document.createElement('canvas');\n      return canvas.toDataURL('image/png').indexOf('data:image/png') === 0;\n    },\n\n    // Test object url support for loading\n    objectUrlSupport: function() {\n      return 'URL' in window && 'revokeObjectURL' in URL && 'createObjectURL' in URL;\n    },\n\n    // RGBA support for colors\n    rgbaSupport: function() {\n      const style = document.createElement('a').style;\n      style.cssText = 'background-color:rgba(150,255,150,.5)';\n      return ('' + style.backgroundColor).indexOf('rgba') > -1;\n    }\n  };\n\n  // warnings excalibur performance will be degraded\n  private _warningTest: WarningTests = {\n    webAudioSupport: function() {\n      return !!(\n        (<any>window).AudioContext ||\n        (<any>window).webkitAudioContext ||\n        (<any>window).mozAudioContext ||\n        (<any>window).msAudioContext ||\n        (<any>window).oAudioContext\n      );\n    },\n    webglSupport: function() {\n      const elem = document.createElement('canvas');\n      return !!(elem.getContext && elem.getContext('webgl'));\n    }\n  };\n\n  public test(): boolean {\n    // Critical test will for ex not to run\n    let failedCritical = false;\n    for (const test in this._criticalTests) {\n      if (!this._criticalTests[<keyof CriticalTests>test].call(this)) {\n        this.failedTests.push(test);\n        Logger.getInstance().error('Critical browser feature missing, Excalibur requires:', test);\n        failedCritical = true;\n      }\n    }\n    if (failedCritical) {\n      return false;\n    }\n\n    // Warning tests do not for ex to return false to compatibility\n    for (const warning in this._warningTest) {\n      if (!this._warningTest[<keyof WarningTests>warning]()) {\n        Logger.getInstance().warn('Warning browser feature missing, Excalibur will have reduced performance:', warning);\n      }\n    }\n\n    return true;\n  }\n}\n","import { Physics } from './../Physics';\nimport { BoundingBox } from './BoundingBox';\nimport { Body } from './Body';\n\nimport { Ray } from '../Algebra';\nimport { Logger } from '../Util/Log';\n\n/**\n * Dynamic Tree Node used for tracking bounds within the tree\n */\nexport class TreeNode {\n  public left: TreeNode;\n  public right: TreeNode;\n  public bounds: BoundingBox;\n  public height: number;\n  public body: Body;\n  constructor(public parent?: TreeNode) {\n    this.parent = parent || null;\n    this.body = null;\n    this.bounds = new BoundingBox();\n    this.left = null;\n    this.right = null;\n    this.height = 0;\n  }\n\n  public isLeaf(): boolean {\n    return !this.left && !this.right;\n  }\n}\n\n/**\n * The DynamicTrees provides a spatial partitioning data structure for quickly querying for overlapping bounding boxes for\n * all tracked bodies. The worst case performance of this is O(n*log(n)) where n is the number of bodies in the tree.\n *\n * Internally the bounding boxes are organized as a balanced binary tree of bounding boxes, where the leaf nodes are tracked bodies.\n * Every non-leaf node is a bounding box that contains child bounding boxes.\n */\nexport class DynamicTree {\n  public root: TreeNode;\n  public nodes: { [key: number]: TreeNode };\n  constructor(public worldBounds: BoundingBox = new BoundingBox(-Number.MAX_VALUE, -Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE)) {\n    this.root = null;\n    this.nodes = {};\n  }\n\n  /**\n   * Inserts a node into the dynamic tree\n   */\n  private _insert(leaf: TreeNode): void {\n    // If there are no nodes in the tree, make this the root leaf\n    if (this.root === null) {\n      this.root = leaf;\n      this.root.parent = null;\n      return;\n    }\n\n    // Search the tree for a node that is not a leaf and find the best place to insert\n    const leafAABB = leaf.bounds;\n    let currentRoot = this.root;\n    while (!currentRoot.isLeaf()) {\n      const left = currentRoot.left;\n      const right = currentRoot.right;\n\n      const area = currentRoot.bounds.getPerimeter();\n      const combinedAABB = currentRoot.bounds.combine(leafAABB);\n      const combinedArea = combinedAABB.getPerimeter();\n\n      // Calculate cost heuristic for creating a new parent and leaf\n      const cost = 2 * combinedArea;\n\n      // Minimum cost of pushing the leaf down the tree\n      const inheritanceCost = 2 * (combinedArea - area);\n\n      // Cost of descending\n      let leftCost = 0;\n      const leftCombined = leafAABB.combine(left.bounds);\n      let newArea;\n      let oldArea;\n      if (left.isLeaf()) {\n        leftCost = leftCombined.getPerimeter() + inheritanceCost;\n      } else {\n        oldArea = left.bounds.getPerimeter();\n        newArea = leftCombined.getPerimeter();\n        leftCost = newArea - oldArea + inheritanceCost;\n      }\n\n      let rightCost = 0;\n      const rightCombined = leafAABB.combine(right.bounds);\n      if (right.isLeaf()) {\n        rightCost = rightCombined.getPerimeter() + inheritanceCost;\n      } else {\n        oldArea = right.bounds.getPerimeter();\n        newArea = rightCombined.getPerimeter();\n        rightCost = newArea - oldArea + inheritanceCost;\n      }\n\n      // cost is acceptable\n      if (cost < leftCost && cost < rightCost) {\n        break;\n      }\n\n      // Descend to the depths\n      if (leftCost < rightCost) {\n        currentRoot = left;\n      } else {\n        currentRoot = right;\n      }\n    }\n\n    // Create the new parent node and insert into the tree\n    const oldParent = currentRoot.parent;\n    const newParent = new TreeNode(oldParent);\n    newParent.bounds = leafAABB.combine(currentRoot.bounds);\n    newParent.height = currentRoot.height + 1;\n\n    if (oldParent !== null) {\n      // The sibling node was not the root\n      if (oldParent.left === currentRoot) {\n        oldParent.left = newParent;\n      } else {\n        oldParent.right = newParent;\n      }\n\n      newParent.left = currentRoot;\n      newParent.right = leaf;\n\n      currentRoot.parent = newParent;\n      leaf.parent = newParent;\n    } else {\n      // The sibling node was the root\n      newParent.left = currentRoot;\n      newParent.right = leaf;\n\n      currentRoot.parent = newParent;\n      leaf.parent = newParent;\n      this.root = newParent;\n    }\n\n    // Walk up the tree fixing heights and AABBs\n    let currentNode = leaf.parent;\n    while (currentNode) {\n      currentNode = this._balance(currentNode);\n\n      if (!currentNode.left) {\n        throw new Error('Parent of current leaf cannot have a null left child' + currentNode);\n      }\n      if (!currentNode.right) {\n        throw new Error('Parent of current leaf cannot have a null right child' + currentNode);\n      }\n\n      currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\n      currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\n\n      currentNode = currentNode.parent;\n    }\n  }\n\n  /**\n   * Removes a node from the dynamic tree\n   */\n  private _remove(leaf: TreeNode) {\n    if (leaf === this.root) {\n      this.root = null;\n      return;\n    }\n\n    const parent = leaf.parent;\n    const grandParent = parent.parent;\n    let sibling: TreeNode;\n    if (parent.left === leaf) {\n      sibling = parent.right;\n    } else {\n      sibling = parent.left;\n    }\n\n    if (grandParent) {\n      if (grandParent.left === parent) {\n        grandParent.left = sibling;\n      } else {\n        grandParent.right = sibling;\n      }\n      sibling.parent = grandParent;\n\n      let currentNode = grandParent;\n      while (currentNode) {\n        currentNode = this._balance(currentNode);\n        currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\n        currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\n\n        currentNode = currentNode.parent;\n      }\n    } else {\n      this.root = sibling;\n      sibling.parent = null;\n    }\n  }\n\n  /**\n   * Tracks a body in the dynamic tree\n   */\n  public trackBody(body: Body) {\n    const node = new TreeNode();\n    node.body = body;\n    node.bounds = body.collider.bounds;\n    node.bounds.left -= 2;\n    node.bounds.top -= 2;\n    node.bounds.right += 2;\n    node.bounds.bottom += 2;\n    this.nodes[body.id] = node;\n    this._insert(node);\n  }\n\n  /**\n   * Updates the dynamic tree given the current bounds of each body being tracked\n   */\n  public updateBody(body: Body) {\n    const node = this.nodes[body.id];\n    if (!node) {\n      return false;\n    }\n    const b = body.collider.bounds;\n\n    // if the body is outside the world no longer update it\n    if (!this.worldBounds.contains(b)) {\n      Logger.getInstance().warn('Collider with id ' + body.id + ' is outside the world bounds and will no longer be tracked for physics');\n      this.untrackBody(body);\n      return false;\n    }\n\n    if (node.bounds.contains(b)) {\n      return false;\n    }\n\n    this._remove(node);\n    b.left -= Physics.boundsPadding;\n    b.top -= Physics.boundsPadding;\n    b.right += Physics.boundsPadding;\n    b.bottom += Physics.boundsPadding;\n\n    const multdx = body.vel.x * Physics.dynamicTreeVelocityMultiplier;\n    const multdy = body.vel.y * Physics.dynamicTreeVelocityMultiplier;\n\n    if (multdx < 0) {\n      b.left += multdx;\n    } else {\n      b.right += multdx;\n    }\n\n    if (multdy < 0) {\n      b.top += multdy;\n    } else {\n      b.bottom += multdy;\n    }\n\n    node.bounds = b;\n    this._insert(node);\n    return true;\n  }\n\n  /**\n   * Untracks a body from the dynamic tree\n   */\n  public untrackBody(body: Body) {\n    const node = this.nodes[body.collider.id];\n    if (!node) {\n      return;\n    }\n    this._remove(node);\n    this.nodes[body.collider.id] = null;\n    delete this.nodes[body.collider.id];\n  }\n\n  /**\n   * Balances the tree about a node\n   */\n  private _balance(node: TreeNode) {\n    if (node === null) {\n      throw new Error('Cannot balance at null node');\n    }\n\n    if (node.isLeaf() || node.height < 2) {\n      return node;\n    }\n\n    const left = node.left;\n    const right = node.right;\n\n    const a = node;\n    const b = left;\n    const c = right;\n    const d = left.left;\n    const e = left.right;\n    const f = right.left;\n    const g = right.right;\n\n    const balance = c.height - b.height;\n    // Rotate c node up\n    if (balance > 1) {\n      // Swap the right node with it's parent\n      c.left = a;\n      c.parent = a.parent;\n      a.parent = c;\n\n      // The original node's old parent should point to the right node\n      // this is mega confusing\n      if (c.parent) {\n        if (c.parent.left === a) {\n          c.parent.left = c;\n        } else {\n          c.parent.right = c;\n        }\n      } else {\n        this.root = c;\n      }\n\n      // Rotate\n      if (f.height > g.height) {\n        c.right = f;\n        a.right = g;\n        g.parent = a;\n\n        a.bounds = b.bounds.combine(g.bounds);\n        c.bounds = a.bounds.combine(f.bounds);\n\n        a.height = 1 + Math.max(b.height, g.height);\n        c.height = 1 + Math.max(a.height, f.height);\n      } else {\n        c.right = g;\n        a.right = f;\n        f.parent = a;\n\n        a.bounds = b.bounds.combine(f.bounds);\n        c.bounds = a.bounds.combine(g.bounds);\n\n        a.height = 1 + Math.max(b.height, f.height);\n        c.height = 1 + Math.max(a.height, g.height);\n      }\n\n      return c;\n    }\n    // Rotate left node up\n    if (balance < -1) {\n      // swap\n      b.left = a;\n      b.parent = a.parent;\n      a.parent = b;\n\n      // node's old parent should point to b\n      if (b.parent) {\n        if (b.parent.left === a) {\n          b.parent.left = b;\n        } else {\n          if (b.parent.right !== a) {\n            throw 'Error rotating Dynamic Tree';\n          }\n          b.parent.right = b;\n        }\n      } else {\n        this.root = b;\n      }\n\n      // rotate\n      if (d.height > e.height) {\n        b.right = d;\n        a.left = e;\n        e.parent = a;\n\n        a.bounds = c.bounds.combine(e.bounds);\n        b.bounds = a.bounds.combine(d.bounds);\n\n        a.height = 1 + Math.max(c.height, e.height);\n        b.height = 1 + Math.max(a.height, d.height);\n      } else {\n        b.right = e;\n        a.left = d;\n        d.parent = a;\n\n        a.bounds = c.bounds.combine(d.bounds);\n        b.bounds = a.bounds.combine(e.bounds);\n\n        a.height = 1 + Math.max(c.height, d.height);\n        b.height = 1 + Math.max(a.height, e.height);\n      }\n      return b;\n    }\n\n    return node;\n  }\n\n  /**\n   * Returns the internal height of the tree, shorter trees are better. Performance drops as the tree grows\n   */\n  public getHeight(): number {\n    if (this.root === null) {\n      return 0;\n    }\n    return this.root.height;\n  }\n\n  /**\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be colliding with the provided body.\n   *\n   * In the query callback, it will be passed a potential collider. Returning true from this callback indicates\n   * that you are complete with your query and you do not want to continue. Returning false will continue searching\n   * the tree until all possible colliders have been returned.\n   */\n  public query(body: Body, callback: (other: Body) => boolean): void {\n    const bounds = body.collider.bounds;\n    const helper = (currentNode: TreeNode): boolean => {\n      if (currentNode && currentNode.bounds.intersect(bounds)) {\n        if (currentNode.isLeaf() && currentNode.body !== body) {\n          if (callback.call(body, currentNode.body)) {\n            return true;\n          }\n        } else {\n          return helper(currentNode.left) || helper(currentNode.right);\n        }\n      }\n      return false;\n    };\n    helper(this.root);\n  }\n\n  /**\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be intersecting. By default the raycast query uses an infinitely\n   * long ray to test the tree specified by `max`.\n   *\n   * In the query callback, it will be passed a potential body that intersects with the raycast. Returning true from this\n   * callback indicates that your are complete with your query and do not want to continue. Return false will continue searching\n   * the tree until all possible bodies that would intersect with the ray have been returned.\n   */\n  public rayCastQuery(ray: Ray, max: number = Infinity, callback: (other: Body) => boolean): void {\n    const helper = (currentNode: TreeNode): boolean => {\n      if (currentNode && currentNode.bounds.rayCast(ray, max)) {\n        if (currentNode.isLeaf()) {\n          if (callback.call(ray, currentNode.body)) {\n            // ray hit a leaf! return the body\n            return true;\n          }\n        } else {\n          // ray hit but not at a leaf, recurse deeper\n          return helper(currentNode.left) || helper(currentNode.right);\n        }\n      }\n      return false; // ray missed\n    };\n    helper(this.root);\n  }\n\n  public getNodes(): TreeNode[] {\n    const helper = (currentNode: TreeNode): TreeNode[] => {\n      if (currentNode) {\n        return [currentNode].concat(helper(currentNode.left), helper(currentNode.right));\n      } else {\n        return [];\n      }\n    };\n    return helper(this.root);\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    // draw all the nodes in the Dynamic Tree\n    const helper = (currentNode: TreeNode) => {\n      if (currentNode) {\n        if (currentNode.isLeaf()) {\n          ctx.lineWidth = 1;\n          ctx.strokeStyle = 'green';\n        } else {\n          ctx.lineWidth = 1;\n          ctx.strokeStyle = 'white';\n        }\n        currentNode.bounds.debugDraw(ctx);\n\n        if (currentNode.left) {\n          helper(currentNode.left);\n        }\n        if (currentNode.right) {\n          helper(currentNode.right);\n        }\n      }\n    };\n\n    helper(this.root);\n  }\n}\n","import { Physics } from './../Physics';\nimport { CollisionBroadphase } from './CollisionResolver';\nimport { DynamicTree } from './DynamicTree';\nimport { Pair } from './Pair';\nimport { Body } from './Body';\n\nimport { Vector, Ray } from '../Algebra';\nimport { FrameStats } from '../Debug';\nimport { CollisionResolutionStrategy } from '../Physics';\nimport { Logger } from '../Util/Log';\nimport { CollisionStartEvent, CollisionEndEvent } from '../Events';\nimport { CollisionType } from './CollisionType';\nimport { Collider } from './Collider';\n\nexport class DynamicTreeCollisionBroadphase implements CollisionBroadphase {\n  private _dynamicCollisionTree = new DynamicTree();\n  private _collisionHash: { [key: string]: boolean } = {};\n  private _collisionPairCache: Pair[] = [];\n  private _lastFramePairs: Pair[] = [];\n  private _lastFramePairsHash: { [pairId: string]: Pair } = {};\n\n  /**\n   * Tracks a physics body for collisions\n   */\n  public track(target: Body): void {\n    if (!target) {\n      Logger.getInstance().warn('Cannot track null physics body');\n      return;\n    }\n    this._dynamicCollisionTree.trackBody(target);\n  }\n\n  /**\n   * Untracks a physics body\n   */\n  public untrack(target: Body): void {\n    if (!target) {\n      Logger.getInstance().warn('Cannot untrack a null physics body');\n      return;\n    }\n    this._dynamicCollisionTree.untrackBody(target);\n  }\n\n  private _shouldGenerateCollisionPair(colliderA: Collider, colliderB: Collider) {\n    // if the collision pair has been calculated already short circuit\n    const hash = Pair.calculatePairHash(colliderA, colliderB);\n    if (this._collisionHash[hash]) {\n      return false; // pair exists easy exit return false\n    }\n\n    return Pair.canCollide(colliderA, colliderB);\n  }\n\n  /**\n   * Detects potential collision pairs in a broadphase approach with the dynamic aabb tree strategy\n   */\n  public broadphase(targets: Body[], delta: number, stats?: FrameStats): Pair[] {\n    const seconds = delta / 1000;\n\n    // Retrieve the list of potential colliders, exclude killed, prevented, and self\n    const potentialColliders = targets\n      .map((t) => t.collider)\n      .filter((other) => {\n        return other.active && other.type !== CollisionType.PreventCollision;\n      });\n\n    // clear old list of collision pairs\n    this._collisionPairCache = [];\n    this._collisionHash = {};\n\n    // check for normal collision pairs\n    let collider: Collider;\n    for (let j = 0, l = potentialColliders.length; j < l; j++) {\n      collider = potentialColliders[j];\n\n      // Query the collision tree for potential colliders\n      this._dynamicCollisionTree.query(collider.body, (other: Body) => {\n        if (this._shouldGenerateCollisionPair(collider, other.collider)) {\n          const pair = new Pair(collider, other.collider);\n          this._collisionHash[pair.id] = true;\n          this._collisionPairCache.push(pair);\n        }\n        // Always return false, to query whole tree. Returning true in the query method stops searching\n        return false;\n      });\n    }\n    if (stats) {\n      stats.physics.pairs = this._collisionPairCache.length;\n    }\n\n    // Check dynamic tree for fast moving objects\n    // Fast moving objects are those moving at least there smallest bound per frame\n    if (Physics.checkForFastBodies) {\n      for (const collider of potentialColliders) {\n        // Skip non-active objects. Does not make sense on other collision types\n        if (collider.type !== CollisionType.Active) {\n          continue;\n        }\n\n        // Maximum travel distance next frame\n        const updateDistance =\n          collider.body.vel.size * seconds + // velocity term\n          collider.body.acc.size * 0.5 * seconds * seconds; // acc term\n\n        // Find the minimum dimension\n        const minDimension = Math.min(collider.bounds.height, collider.bounds.width);\n        if (Physics.disableMinimumSpeedForFastBody || updateDistance > minDimension / 2) {\n          if (stats) {\n            stats.physics.fastBodies++;\n          }\n\n          // start with the oldPos because the integration for actors has already happened\n          // objects resting on a surface may be slightly penetrating in the current position\n          const updateVec = collider.body.pos.sub(collider.body.oldPos);\n          const centerPoint = collider.shape.center;\n          const furthestPoint = collider.shape.getFurthestPoint(collider.body.vel);\n          const origin: Vector = furthestPoint.sub(updateVec);\n\n          const ray: Ray = new Ray(origin, collider.body.vel);\n\n          // back the ray up by -2x surfaceEpsilon to account for fast moving objects starting on the surface\n          ray.pos = ray.pos.add(ray.dir.scale(-2 * Physics.surfaceEpsilon));\n          let minBody: Body;\n          let minTranslate: Vector = new Vector(Infinity, Infinity);\n          this._dynamicCollisionTree.rayCastQuery(ray, updateDistance + Physics.surfaceEpsilon * 2, (other: Body) => {\n            if (collider.body !== other && other.collider.shape && Pair.canCollide(collider, other.collider)) {\n              const hitPoint = other.collider.shape.rayCast(ray, updateDistance + Physics.surfaceEpsilon * 10);\n              if (hitPoint) {\n                const translate = hitPoint.sub(origin);\n                if (translate.size < minTranslate.size) {\n                  minTranslate = translate;\n                  minBody = other;\n                }\n              }\n            }\n            return false;\n          });\n\n          if (minBody && Vector.isValid(minTranslate)) {\n            const pair = new Pair(collider, minBody.collider);\n            if (!this._collisionHash[pair.id]) {\n              this._collisionHash[pair.id] = true;\n              this._collisionPairCache.push(pair);\n            }\n            // move the fast moving object to the other body\n            // need to push into the surface by ex.Physics.surfaceEpsilon\n            const shift = centerPoint.sub(furthestPoint);\n            collider.body.pos = origin\n              .add(shift)\n              .add(minTranslate)\n              .add(ray.dir.scale(2 * Physics.surfaceEpsilon));\n            collider.shape.recalc();\n\n            if (stats) {\n              stats.physics.fastBodyCollisions++;\n            }\n          }\n        }\n      }\n    }\n    // return cache\n    return this._collisionPairCache;\n  }\n\n  /**\n   * Applies narrow phase on collision pairs to find actual area intersections\n   * Adds actual colliding pairs to stats' Frame data\n   */\n  public narrowphase(pairs: Pair[], stats?: FrameStats): Pair[] {\n    for (let i = 0; i < pairs.length; i++) {\n      pairs[i].collide();\n      if (stats && pairs[i].collision) {\n        stats.physics.collisions++;\n        stats.physics.collidersHash[pairs[i].id] = pairs[i];\n      }\n    }\n    return pairs.filter((p) => p.collision);\n  }\n\n  /**\n   * Perform collision resolution given a strategy (rigid body or box) and move objects out of intersect.\n   */\n  public resolve(pairs: Pair[], delta: number, strategy: CollisionResolutionStrategy): Pair[] {\n    for (const pair of pairs) {\n      pair.resolve(strategy);\n\n      if (pair.collision) {\n        pair.colliderA.body.applyMtv();\n        pair.colliderB.body.applyMtv();\n        // todo still don't like this, this is a small integration step to resolve narrowphase collisions\n        pair.colliderA.body.integrate(delta * Physics.collisionShift);\n        pair.colliderB.body.integrate(delta * Physics.collisionShift);\n      }\n    }\n\n    return pairs.filter((p) => p.canCollide);\n  }\n\n  public runCollisionStartEnd(pairs: Pair[]) {\n    const currentFrameHash: { [pairId: string]: Pair } = {};\n\n    for (const p of pairs) {\n      // load currentFrameHash\n      currentFrameHash[p.id] = p;\n\n      // find all new collisions\n      if (!this._lastFramePairsHash[p.id]) {\n        const actor1 = p.colliderA;\n        const actor2 = p.colliderB;\n        actor1.emit('collisionstart', new CollisionStartEvent(actor1, actor2, p));\n        actor2.emit('collisionstart', new CollisionStartEvent(actor2, actor1, p));\n      }\n    }\n\n    // find all old collisions\n    for (const p of this._lastFramePairs) {\n      if (!currentFrameHash[p.id]) {\n        const actor1 = p.colliderA;\n        const actor2 = p.colliderB;\n        actor1.emit('collisionend', new CollisionEndEvent(actor1, actor2));\n        actor2.emit('collisionend', new CollisionEndEvent(actor2, actor1));\n      }\n    }\n\n    // reset the last frame cache\n    this._lastFramePairs = pairs;\n    this._lastFramePairsHash = currentFrameHash;\n  }\n\n  /**\n   * Update the dynamic tree positions\n   */\n  public update(targets: Body[]): number {\n    let updated = 0;\n    const len = targets.length;\n\n    for (let i = 0; i < len; i++) {\n      if (this._dynamicCollisionTree.updateBody(targets[i])) {\n        updated++;\n      }\n    }\n    return updated;\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    if (Physics.broadphaseDebug) {\n      this._dynamicCollisionTree.debugDraw(ctx);\n    }\n\n    if (Physics.showContacts || Physics.showCollisionNormals) {\n      for (const pair of this._collisionPairCache) {\n        pair.debugDraw(ctx);\n      }\n    }\n  }\n}\n","/**\n * A sorted list implementation. NOTE: this implementation is not self-balancing\n */\nexport class SortedList<T> {\n  private _getComparable: Function;\n  private _root: BinaryTreeNode;\n\n  constructor(getComparable: () => any) {\n    this._getComparable = getComparable;\n  }\n\n  public find(element: any): boolean {\n    return this._find(this._root, element);\n  }\n\n  private _find(node: BinaryTreeNode, element: any): boolean {\n    if (node == null) {\n      return false;\n    } else if (this._getComparable.call(element) === node.getKey()) {\n      if (node.getData().indexOf(element) > -1) {\n        return true;\n      } else {\n        return false;\n      }\n    } else if (this._getComparable.call(element) < node.getKey()) {\n      return this._find(node.getLeft(), element);\n    } else {\n      return this._find(node.getRight(), element);\n    }\n  }\n\n  // returns the array of elements at a specific key value\n  public get(key: number): any[] {\n    return this._get(this._root, key);\n  }\n\n  private _get(node: BinaryTreeNode, key: number): any[] {\n    if (node == null) {\n      return [];\n    } else if (key === node.getKey()) {\n      return node.getData();\n    } else if (key < node.getKey()) {\n      return this._get(node.getLeft(), key);\n    } else {\n      return this._get(node.getRight(), key);\n    }\n  }\n\n  public add(element: any): boolean {\n    if (this._root == null) {\n      this._root = new BinaryTreeNode(this._getComparable.call(element), [element], null, null);\n      return true;\n    } else {\n      return this._insert(this._root, element);\n    }\n  }\n\n  private _insert(node: BinaryTreeNode, element: any): boolean {\n    if (node != null) {\n      if (this._getComparable.call(element) === node.getKey()) {\n        if (node.getData().indexOf(element) > -1) {\n          return false; // the element we're trying to insert already exists\n        } else {\n          node.getData().push(element);\n          return true;\n        }\n      } else if (this._getComparable.call(element) < node.getKey()) {\n        if (node.getLeft() == null) {\n          node.setLeft(new BinaryTreeNode(this._getComparable.call(element), [element], null, null));\n          return true;\n        } else {\n          return this._insert(node.getLeft(), element);\n        }\n      } else {\n        if (node.getRight() == null) {\n          node.setRight(new BinaryTreeNode(this._getComparable.call(element), [element], null, null));\n          return true;\n        } else {\n          return this._insert(node.getRight(), element);\n        }\n      }\n    }\n    return false;\n  }\n\n  public removeByComparable(element: any): void {\n    this._root = this._remove(this._root, element);\n  }\n\n  private _remove(node: BinaryTreeNode, element: any): BinaryTreeNode {\n    if (node == null) {\n      return null;\n    } else if (this._getComparable.call(element) === node.getKey()) {\n      const elementIndex = node.getData().indexOf(element);\n      // if the node contains the element, remove the element\n      if (elementIndex > -1) {\n        node.getData().splice(elementIndex, 1);\n        // if we have removed the last element at this node, remove the node\n        if (node.getData().length === 0) {\n          // if the node is a leaf\n          if (node.getLeft() == null && node.getRight() == null) {\n            return null;\n          } else if (node.getLeft() == null) {\n            return node.getRight();\n          } else if (node.getRight() == null) {\n            return node.getLeft();\n          }\n          // if node has 2 children\n          const temp = this._findMinNode(node.getRight());\n          node.setKey(temp.getKey());\n          node.setData(temp.getData());\n          node.setRight(this._cleanup(node.getRight(), temp)); //\"cleanup nodes\" (move them up recursively)\n          return node;\n        } else {\n          // this prevents the node from being removed since it still contains elements\n          return node;\n        }\n      }\n    } else if (this._getComparable.call(element) < node.getKey()) {\n      node.setLeft(this._remove(node.getLeft(), element));\n      return node;\n    } else {\n      node.setRight(this._remove(node.getRight(), element));\n      return node;\n    }\n    return null;\n  }\n\n  // called once we have successfully removed the element we wanted, recursively corrects the part of the tree below the removed node\n  private _cleanup(node: BinaryTreeNode, element: BinaryTreeNode): BinaryTreeNode {\n    const comparable = element.getKey();\n    if (node == null) {\n      return null;\n    } else if (comparable === node.getKey()) {\n      // if the node is a leaf\n      if (node.getLeft() == null && node.getRight() == null) {\n        return null;\n      } else if (node.getLeft() == null) {\n        return node.getRight();\n      } else if (node.getRight() == null) {\n        return node.getLeft();\n      }\n      // if node has 2 children\n      const temp = this._findMinNode(node.getRight());\n      node.setKey(temp.getKey());\n      node.setData(temp.getData());\n\n      node.setRight(this._cleanup(node.getRight(), temp));\n      return node;\n    } else if (this._getComparable.call(element) < node.getKey()) {\n      node.setLeft(this._cleanup(node.getLeft(), element));\n      return node;\n    } else {\n      node.setRight(this._cleanup(node.getRight(), element));\n      return node;\n    }\n  }\n\n  private _findMinNode(node: BinaryTreeNode): BinaryTreeNode {\n    let current = node;\n    while (current.getLeft() != null) {\n      current = current.getLeft();\n    }\n    return current;\n  }\n\n  public list(): Array<T> {\n    const results = new Array<any>();\n    this._list(this._root, results);\n    return results;\n  }\n\n  private _list(treeNode: BinaryTreeNode, results: Array<T>): void {\n    if (treeNode != null) {\n      this._list(treeNode.getLeft(), results);\n      treeNode.getData().forEach(function(element) {\n        results.push(element);\n      });\n      this._list(treeNode.getRight(), results);\n    }\n  }\n}\n\n/**\n * A tree node part of [[SortedList]]\n */\nexport class BinaryTreeNode {\n  private _key: number;\n  private _data: Array<any>;\n  private _left: BinaryTreeNode;\n  private _right: BinaryTreeNode;\n\n  constructor(key: number, data: Array<any>, left: BinaryTreeNode, right: BinaryTreeNode) {\n    this._key = key;\n    this._data = data;\n    this._left = left;\n    this._right = right;\n  }\n\n  public getKey(): number {\n    return this._key;\n  }\n\n  public setKey(key: number) {\n    this._key = key;\n  }\n\n  public getData(): Array<any> {\n    return this._data;\n  }\n\n  public setData(data: any) {\n    this._data = data;\n  }\n\n  public getLeft(): BinaryTreeNode {\n    return this._left;\n  }\n\n  public setLeft(left: BinaryTreeNode) {\n    this._left = left;\n  }\n\n  public getRight(): BinaryTreeNode {\n    return this._right;\n  }\n\n  public setRight(right: BinaryTreeNode) {\n    this._right = right;\n  }\n}\n\n/**\n * Mock element for testing\n *\n * @internal\n */\nexport class MockedElement {\n  private _key: number = 0;\n\n  constructor(key: number) {\n    this._key = key;\n  }\n\n  public getTheKey() {\n    return this._key;\n  }\n\n  public setKey(key: number) {\n    this._key = key;\n  }\n}\n","import { Engine } from './Engine';\nimport { Color } from './Drawing/Color';\nimport { SpriteFont } from './Drawing/SpriteSheet';\nimport { Actor } from './Actor';\nimport { Configurable } from './Configurable';\nimport { Vector } from './Algebra';\nimport { CollisionType } from './Collision/CollisionType';\n/**\n * Enum representing the different font size units\n * https://developer.mozilla.org/en-US/docs/Web/CSS/font-size\n */\nexport enum FontUnit {\n  /**\n   * Em is a scalable unit, 1 em is equal to the current font size of the current element, parent elements can effect em values\n   */\n  Em,\n  /**\n   * Rem is similar to the Em, it is a scalable unit. 1 rem is equal to the font size of the root element\n   */\n  Rem,\n  /**\n   * Pixel is a unit of length in screen pixels\n   */\n  Px,\n  /**\n   * Point is a physical unit length (1/72 of an inch)\n   */\n  Pt,\n  /**\n   * Percent is a scalable unit similar to Em, the only difference is the Em units scale faster when Text-Size stuff\n   */\n  Percent\n}\n\n/**\n * Enum representing the different horizontal text alignments\n */\nexport enum TextAlign {\n  /**\n   * The text is left-aligned.\n   */\n  Left,\n  /**\n   * The text is right-aligned.\n   */\n  Right,\n  /**\n   * The text is centered.\n   */\n  Center,\n  /**\n   * The text is aligned at the normal start of the line (left-aligned for left-to-right locales,\n   * right-aligned for right-to-left locales).\n   */\n  Start,\n  /**\n   * The text is aligned at the normal end of the line (right-aligned for left-to-right locales,\n   * left-aligned for right-to-left locales).\n   */\n  End\n}\n\n/**\n * Enum representing the different baseline text alignments\n */\nexport enum BaseAlign {\n  /**\n   * The text baseline is the top of the em square.\n   */\n  Top,\n  /**\n   * The text baseline is the hanging baseline.  Currently unsupported; this will act like\n   * alphabetic.\n   */\n  Hanging,\n  /**\n   * The text baseline is the middle of the em square.\n   */\n  Middle,\n  /**\n   * The text baseline is the normal alphabetic baseline.\n   */\n  Alphabetic,\n  /**\n   * The text baseline is the ideographic baseline; this is the bottom of\n   * the body of the characters, if the main body of characters protrudes\n   * beneath the alphabetic baseline.  Currently unsupported; this will\n   * act like alphabetic.\n   */\n  Ideographic,\n  /**\n   * The text baseline is the bottom of the bounding box.  This differs\n   * from the ideographic baseline in that the ideographic baseline\n   * doesn't consider descenders.\n   */\n  Bottom\n}\n\n/**\n * Enum representing the different possible font styles\n */\nexport enum FontStyle {\n  Normal,\n  Italic,\n  Oblique\n}\n\n/**\n * [[include:Constructors.md]]\n */\nexport interface LabelArgs extends Partial<LabelImpl> {\n  x?: number;\n  y?: number;\n  text?: string;\n  bold?: boolean;\n  pos?: Vector;\n  spriteFont?: SpriteFont;\n  fontFamily?: string;\n  fontSize?: number;\n  fontStyle?: FontStyle;\n  fontUnit?: FontUnit;\n  textAlign?: TextAlign;\n  maxWidth?: number;\n}\n\n/**\n * @hidden\n */\nexport class LabelImpl extends Actor {\n  /**\n   * The text to draw.\n   */\n  public text: string;\n\n  /**\n   * Sets or gets the bold property of the label's text, by default it's false\n   */\n  public bold: boolean = false;\n\n  /**\n   * The [[SpriteFont]] to use, if any. Overrides [[fontFamily]] if present.\n   */\n  public spriteFont: SpriteFont;\n\n  /**\n   * The CSS font family string (e.g. `sans-serif`, `Droid Sans Pro`). Web fonts\n   * are supported, same as in CSS.\n   */\n  public fontFamily: string;\n\n  /**\n   * The font size in the selected units, default is 10 (default units is pixel)\n   */\n  public fontSize: number = 10;\n\n  /**\n   * The font style for this label, the default is [[FontStyle.Normal]]\n   */\n  public fontStyle: FontStyle = FontStyle.Normal;\n\n  /**\n   * The css units for a font size such as px, pt, em (SpriteFont only support px), by default is 'px';\n   */\n  public fontUnit: FontUnit = FontUnit.Px;\n\n  /**\n   * Gets or sets the horizontal text alignment property for the label.\n   */\n  public textAlign: TextAlign = TextAlign.Left;\n\n  /**\n   * Gets or sets the baseline alignment property for the label.\n   */\n  public baseAlign: BaseAlign = BaseAlign.Bottom;\n\n  /**\n   * Gets or sets the maximum width (in pixels) that the label should occupy\n   */\n  public maxWidth: number;\n\n  /**\n   * Gets or sets the letter spacing on a Label. Only supported with Sprite Fonts.\n   */\n  public letterSpacing: number = 0; //px\n\n  /**\n   * Whether or not the [[SpriteFont]] will be case-sensitive when matching characters.\n   */\n  public caseInsensitive: boolean = true;\n\n  private _textShadowOn: boolean;\n  private _shadowOffsetX: number;\n  private _shadowOffsetY: number;\n\n  /**\n   * @param text        The text of the label\n   * @param x           The x position of the label\n   * @param y           The y position of the label\n   * @param fontFamily  Use any valid CSS font string for the label's font. Web fonts are supported. Default is `10px sans-serif`.\n   * @param spriteFont  Use an Excalibur sprite font for the label's font, if a SpriteFont is provided it will take precedence\n   * over a css font.\n   */\n  constructor(textOrConfig?: string | Partial<LabelImpl>, x?: number, y?: number, fontFamily?: string, spriteFont?: SpriteFont) {\n    super(textOrConfig && typeof textOrConfig === 'object' ? textOrConfig : { pos: new Vector(x, y) });\n\n    let text = '';\n    if (textOrConfig && typeof textOrConfig === 'object') {\n      fontFamily = textOrConfig.fontFamily;\n      spriteFont = textOrConfig.spriteFont;\n      text = textOrConfig.text;\n    } else {\n      text = <string>textOrConfig;\n    }\n\n    this.text = text || '';\n    this.color = Color.Black;\n    this.spriteFont = spriteFont;\n    this.body.collider.type = CollisionType.PreventCollision;\n    this.fontFamily = fontFamily || 'sans-serif'; // coalesce to default canvas font\n\n    this._textShadowOn = false;\n    this._shadowOffsetX = 0;\n    this._shadowOffsetY = 0;\n    if (spriteFont) {\n      //this._textSprites = spriteFont.getTextSprites();\n    }\n  }\n\n  /**\n   * Returns the width of the text in the label (in pixels);\n   * @param ctx  Rendering context to measure the string with\n   */\n  public getTextWidth(ctx: CanvasRenderingContext2D): number {\n    const oldFont = ctx.font;\n    ctx.font = this._fontString;\n    const width = ctx.measureText(this.text).width;\n    ctx.font = oldFont;\n    return width;\n  }\n\n  // TypeScript doesn't support string enums :(\n  private _lookupFontUnit(fontUnit: FontUnit): string {\n    switch (fontUnit) {\n      case FontUnit.Em:\n        return 'em';\n      case FontUnit.Rem:\n        return 'rem';\n      case FontUnit.Pt:\n        return 'pt';\n      case FontUnit.Px:\n        return 'px';\n      case FontUnit.Percent:\n        return '%';\n      default:\n        return 'px';\n    }\n  }\n\n  private _lookupTextAlign(textAlign: TextAlign): CanvasTextAlign {\n    switch (textAlign) {\n      case TextAlign.Left:\n        return 'left';\n      case TextAlign.Right:\n        return 'right';\n      case TextAlign.Center:\n        return 'center';\n      case TextAlign.End:\n        return 'end';\n      case TextAlign.Start:\n        return 'start';\n      default:\n        return 'start';\n    }\n  }\n\n  private _lookupBaseAlign(baseAlign: BaseAlign): CanvasTextBaseline {\n    switch (baseAlign) {\n      case BaseAlign.Alphabetic:\n        return 'alphabetic';\n      case BaseAlign.Bottom:\n        return 'bottom';\n      case BaseAlign.Hanging:\n        return 'hanging';\n      case BaseAlign.Ideographic:\n        return 'ideographic';\n      case BaseAlign.Middle:\n        return 'middle';\n      case BaseAlign.Top:\n        return 'top';\n      default:\n        return 'alphabetic';\n    }\n  }\n\n  private _lookupFontStyle(fontStyle: FontStyle): string {\n    const boldstring = this.bold ? ' bold' : '';\n    switch (fontStyle) {\n      case FontStyle.Italic:\n        return 'italic' + boldstring;\n      case FontStyle.Normal:\n        return 'normal' + boldstring;\n      case FontStyle.Oblique:\n        return 'oblique' + boldstring;\n      default:\n        return 'normal' + boldstring;\n    }\n  }\n\n  /**\n   * Sets the text shadow for sprite fonts\n   * @param offsetX      The x offset in pixels to place the shadow\n   * @param offsetY      The y offset in pixels to place the shadow\n   * @param shadowColor  The color of the text shadow\n   */\n  public setTextShadow(offsetX: number, offsetY: number, shadowColor: Color) {\n    this.spriteFont.setTextShadow(offsetX, offsetY, shadowColor);\n  }\n\n  /**\n   * Toggles text shadows on or off, only applies when using sprite fonts\n   */\n  public useTextShadow(on: boolean) {\n    this.spriteFont.useTextShadow(on);\n  }\n\n  /**\n   * Clears the current text shadow\n   */\n  public clearTextShadow() {\n    this._textShadowOn = false;\n    this._shadowOffsetX = 0;\n    this._shadowOffsetY = 0;\n  }\n\n  public update(engine: Engine, delta: number) {\n    super.update(engine, delta);\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\n    ctx.save();\n    ctx.translate(this.pos.x, this.pos.y);\n    ctx.scale(this.scale.x, this.scale.y);\n    ctx.rotate(this.rotation);\n\n    if (this._textShadowOn) {\n      ctx.save();\n      ctx.translate(this._shadowOffsetX, this._shadowOffsetY);\n      this._fontDraw(ctx);\n      ctx.restore();\n    }\n    this._fontDraw(ctx);\n\n    super.draw(ctx, delta);\n    ctx.restore();\n  }\n\n  private _fontDraw(ctx: CanvasRenderingContext2D) {\n    if (this.spriteFont) {\n      this.spriteFont.draw(ctx, this.text, 0, 0, {\n        color: this.color.clone(),\n        baseAlign: this.baseAlign,\n        textAlign: this.textAlign,\n        fontSize: this.fontSize,\n        letterSpacing: this.letterSpacing,\n        opacity: this.opacity\n      });\n    } else {\n      const oldAlign = ctx.textAlign;\n      const oldTextBaseline = ctx.textBaseline;\n\n      ctx.textAlign = this._lookupTextAlign(this.textAlign);\n      ctx.textBaseline = this._lookupBaseAlign(this.baseAlign);\n      if (this.color) {\n        this.color.a = this.opacity;\n      }\n      ctx.fillStyle = this.color.toString();\n      ctx.font = this._fontString;\n      if (this.maxWidth) {\n        ctx.fillText(this.text, 0, 0, this.maxWidth);\n      } else {\n        ctx.fillText(this.text, 0, 0);\n      }\n\n      ctx.textAlign = oldAlign;\n      ctx.textBaseline = oldTextBaseline;\n    }\n  }\n\n  protected get _fontString() {\n    return `${this._lookupFontStyle(this.fontStyle)} ${this.fontSize}${this._lookupFontUnit(this.fontUnit)} ${this.fontFamily}`;\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    super.debugDraw(ctx);\n  }\n}\n\n/**\n * Labels are the way to draw small amounts of text to the screen. They are\n * actors and inherit all of the benefits and capabilities.\n *\n * [[include:Labels.md]]\n */\nexport class Label extends Configurable(LabelImpl) {\n  constructor();\n  constructor(config?: LabelArgs);\n  constructor(text?: string, x?: number, y?: number, fontFamily?: string, spriteFont?: SpriteFont);\n  constructor(textOrConfig?: string | LabelArgs, x?: number, y?: number, fontFamily?: string, spriteFont?: SpriteFont) {\n    super(textOrConfig, x, y, fontFamily, spriteFont);\n  }\n}\n","import { Color } from './Drawing/Color';\nimport { Engine } from './Engine';\nimport { ActionQueue } from './Actions/Action';\nimport { EventDispatcher } from './EventDispatcher';\nimport { Actor, isActor } from './Actor';\nimport { Vector } from './Algebra';\nimport { ExitTriggerEvent, EnterTriggerEvent, CollisionEndEvent, CollisionStartEvent } from './Events';\nimport * as Util from './Util/Util';\nimport { CollisionType } from './Collision/CollisionType';\n\n/**\n * ITriggerOptions\n */\nexport interface TriggerOptions {\n  // position of the trigger\n  pos: Vector;\n  // width of the trigger\n  width: number;\n  // height of the trigger\n  height: number;\n  // whether the trigger is visible or not\n  visible: boolean;\n  // action to take when triggered\n  action: () => void;\n  // if specified the trigger will only fire on a specific actor and overrides any filter\n  target: Actor;\n  // Returns true if the triggers should fire on the collided actor\n  filter: (actor: Actor) => boolean;\n  // -1 if it should repeat forever\n  repeat: number;\n}\n\nconst triggerDefaults: Partial<TriggerOptions> = {\n  pos: Vector.Zero,\n  width: 10,\n  height: 10,\n  visible: false,\n  action: () => {\n    return;\n  },\n  filter: () => true,\n  repeat: -1\n};\n\n/**\n * Triggers are a method of firing arbitrary code on collision. These are useful\n * as 'buttons', 'switches', or to trigger effects in a game. By default triggers\n * are invisible, and can only be seen when [[Trigger.visible]] is set to `true`.\n *\n * [[include:Triggers.md]]\n */\nexport class Trigger extends Actor {\n  private _target: Actor;\n  /**\n   * Action to fire when triggered by collision\n   */\n  public action: () => void = () => {\n    return;\n  };\n  /**\n   * Filter to add additional granularity to action dispatch, if a filter is specified the action will only fire when\n   * filter return true for the collided actor.\n   */\n  public filter: (actor: Actor) => boolean = () => true;\n  /**\n   * Number of times to repeat before killing the trigger,\n   */\n  public repeat: number = -1;\n\n  /**\n   *\n   * @param opts Trigger options\n   */\n  constructor(opts: Partial<TriggerOptions>) {\n    super(opts.pos.x, opts.pos.y, opts.width, opts.height);\n    opts = Util.extend({}, triggerDefaults, opts);\n\n    this.filter = opts.filter || this.filter;\n    this.repeat = opts.repeat || this.repeat;\n    this.action = opts.action || this.action;\n    if (opts.target) {\n      this.target = opts.target;\n    }\n\n    this.visible = opts.visible;\n    this.body.collider.type = CollisionType.Passive;\n    this.eventDispatcher = new EventDispatcher(this);\n    this.actionQueue = new ActionQueue(this);\n\n    this.on('collisionstart', (evt: CollisionStartEvent<Actor>) => {\n      if (isActor(evt.other) && this.filter(evt.other)) {\n        this.emit('enter', new EnterTriggerEvent(this, evt.other));\n        this._dispatchAction();\n        // remove trigger if its done, -1 repeat forever\n        if (this.repeat === 0) {\n          this.kill();\n        }\n      }\n    });\n\n    this.on('collisionend', (evt: CollisionEndEvent<Actor>) => {\n      if (isActor(evt.other) && this.filter(evt.other)) {\n        this.emit('exit', new ExitTriggerEvent(this, evt.other));\n      }\n    });\n  }\n\n  public set target(target: Actor) {\n    this._target = target;\n    this.filter = (actor: Actor) => actor === target;\n  }\n\n  public get target() {\n    return this._target;\n  }\n\n  public _initialize(engine: Engine) {\n    super._initialize(engine);\n  }\n\n  private _dispatchAction() {\n    this.action.call(this);\n    this.repeat--;\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    super.debugDraw(ctx);\n    // Meant to draw debug information about actors\n    ctx.save();\n    ctx.translate(this.pos.x, this.pos.y);\n\n    const bb = this.body.collider.bounds;\n    const wp = this.getWorldPos();\n    bb.left = bb.left - wp.x;\n    bb.right = bb.right - wp.x;\n    bb.top = bb.top - wp.y;\n    bb.bottom = bb.bottom - wp.y;\n\n    // Currently collision primitives cannot rotate\n    // ctx.rotate(this.rotation);\n    ctx.fillStyle = Color.Violet.toString();\n    ctx.strokeStyle = Color.Violet.toString();\n    ctx.fillText('Trigger', 10, 10);\n    bb.debugDraw(ctx);\n\n    ctx.restore();\n  }\n}\n","import { Actor } from '../Actor';\nimport { ScreenElement } from '../ScreenElement';\nimport { Label } from '../Label';\nimport { Trigger } from '../Trigger';\n\nexport function isVanillaActor(actor: Actor) {\n  return !(actor instanceof ScreenElement) && !(actor instanceof Trigger) && !(actor instanceof Label);\n}\n\nexport function isScreenElement(actor: Actor) {\n  return actor instanceof ScreenElement;\n}\n","import { Class } from './../Class';\nimport { GameEvent } from '../Events';\nimport * as Events from '../Events';\n\n/**\n * Enum representing input key codes\n */\nexport enum Keys {\n  Num1 = 97,\n  Num2 = 98,\n  Num3 = 99,\n  Num4 = 100,\n  Num5 = 101,\n  Num6 = 102,\n  Num7 = 103,\n  Num8 = 104,\n  Num9 = 105,\n  Num0 = 96,\n\n  Numlock = 144,\n\n  Semicolon = 186, // 59 in some browsers\n\n  A = 65,\n  B = 66,\n  C = 67,\n  D = 68,\n  E = 69,\n  F = 70,\n  G = 71,\n  H = 72,\n  I = 73,\n  J = 74,\n  K = 75,\n  L = 76,\n  M = 77,\n  N = 78,\n  O = 79,\n  P = 80,\n  Q = 81,\n  R = 82,\n  S = 83,\n  T = 84,\n  U = 85,\n  V = 86,\n  W = 87,\n  X = 88,\n  Y = 89,\n  Z = 90,\n\n  Shift = 16,\n  Alt = 18,\n  Up = 38,\n  Down = 40,\n  Left = 37,\n  Right = 39,\n  Space = 32,\n  Esc = 27\n}\n\n/**\n * Event thrown on a game object for a key event\n */\nexport class KeyEvent extends GameEvent<any> {\n  /**\n   * @param key  The key responsible for throwing the event\n   */\n  constructor(public key: Keys) {\n    super();\n  }\n}\n\n/**\n * Provides keyboard support for Excalibur.\n *\n * [[include:Keyboard.md]]\n */\nexport class Keyboard extends Class {\n  private _keys: number[] = [];\n  private _keysUp: number[] = [];\n  private _keysDown: number[] = [];\n\n  constructor() {\n    super();\n  }\n\n  public on(eventName: Events.press, handler: (event: KeyEvent) => void): void;\n  public on(eventName: Events.release, handler: (event: KeyEvent) => void): void;\n  public on(eventName: Events.hold, handler: (event: KeyEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  /**\n   * Initialize Keyboard event listeners\n   */\n  init(global?: GlobalEventHandlers): void {\n    // See https://github.com/excaliburjs/Excalibur/issues/1294\n    // window.top is for the iframe case\n    global = global || window.top || window;\n    global.addEventListener('blur', () => {\n      this._keys.length = 0; // empties array efficiently\n    });\n\n    // key up is on window because canvas cannot have focus\n    global.addEventListener('keyup', (ev: KeyboardEvent) => {\n      const code = this._normalizeKeyCode(ev.keyCode);\n      const key = this._keys.indexOf(code);\n      this._keys.splice(key, 1);\n      this._keysUp.push(code);\n      const keyEvent = new KeyEvent(code);\n\n      // alias the old api, we may want to deprecate this in the future\n      this.eventDispatcher.emit('up', keyEvent);\n      this.eventDispatcher.emit('release', keyEvent);\n    });\n\n    // key down is on window because canvas cannot have focus\n    global.addEventListener('keydown', (ev: KeyboardEvent) => {\n      const code = this._normalizeKeyCode(ev.keyCode);\n      if (this._keys.indexOf(code) === -1) {\n        this._keys.push(code);\n        this._keysDown.push(code);\n        const keyEvent = new KeyEvent(code);\n        this.eventDispatcher.emit('down', keyEvent);\n        this.eventDispatcher.emit('press', keyEvent);\n      }\n    });\n  }\n\n  public update() {\n    // Reset keysDown and keysUp after update is complete\n    this._keysDown.length = 0;\n    this._keysUp.length = 0;\n\n    // Emit synthetic \"hold\" event\n    for (let i = 0; i < this._keys.length; i++) {\n      this.eventDispatcher.emit('hold', new KeyEvent(this._keys[i]));\n    }\n  }\n\n  /**\n   * Gets list of keys being pressed down\n   */\n  public getKeys(): Keys[] {\n    return this._keys;\n  }\n\n  /**\n   * Tests if a certain key was just pressed this frame. This is cleared at the end of the update frame.\n   * @param key Test whether a key was just pressed\n   */\n  public wasPressed(key: Keys): boolean {\n    return this._keysDown.indexOf(key) > -1;\n  }\n\n  /**\n   * Tests if a certain key is held down. This is persisted between frames.\n   * @param key  Test whether a key is held down\n   */\n  public isHeld(key: Keys): boolean {\n    return this._keys.indexOf(key) > -1;\n  }\n\n  /**\n   * Tests if a certain key was just released this frame. This is cleared at the end of the update frame.\n   * @param key  Test whether a key was just released\n   */\n  public wasReleased(key: Keys): boolean {\n    return this._keysUp.indexOf(key) > -1;\n  }\n\n  /**\n   * Normalizes some browser event key codes to map to standard Excalibur key codes\n   * @param code Event keyCode\n   * @see http://unixpapa.com/js/key.html\n   */\n  private _normalizeKeyCode(code: number) {\n    switch (code) {\n      case 59: // : ; in Firefox, Opera\n        return Keys.Semicolon;\n      default:\n        return code;\n    }\n  }\n}\n","import { ScreenElement } from './ScreenElement';\nimport { Physics } from './Physics';\nimport {\n  InitializeEvent,\n  ActivateEvent,\n  DeactivateEvent,\n  PreUpdateEvent,\n  PostUpdateEvent,\n  PreDrawEvent,\n  PostDrawEvent,\n  PreDebugDrawEvent,\n  PostDebugDrawEvent,\n  GameEvent\n} from './Events';\nimport { Logger } from './Util/Log';\nimport { Timer } from './Timer';\nimport { DynamicTreeCollisionBroadphase } from './Collision/DynamicTreeCollisionBroadphase';\nimport { CollisionBroadphase } from './Collision/CollisionResolver';\nimport { SortedList } from './Util/SortedList';\nimport { Engine } from './Engine';\nimport { TileMap } from './TileMap';\nimport { Camera } from './Camera';\nimport { Actor } from './Actor';\nimport { Class } from './Class';\nimport { CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw } from './Interfaces/LifecycleEvents';\nimport * as Util from './Util/Util';\nimport * as Events from './Events';\nimport * as ActorUtils from './Util/Actors';\nimport { Trigger } from './Trigger';\nimport { Body } from './Collision/Body';\n/**\n * [[Actor|Actors]] are composed together into groupings called Scenes in\n * Excalibur. The metaphor models the same idea behind real world\n * actors in a scene. Only actors in scenes will be updated and drawn.\n *\n * Typical usages of a scene include: levels, menus, loading screens, etc.\n *\n * [[include:Scenes.md]]\n */\nexport class Scene extends Class implements CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw {\n  /**\n   * Gets or sets the current camera for the scene\n   */\n  public camera: Camera;\n\n  /**\n   * The actors in the current scene\n   */\n  public actors: Actor[] = [];\n\n  /**\n   * Physics bodies in the current scene\n   */\n  private _bodies: Body[] = [];\n\n  /**\n   * The triggers in the current scene\n   */\n  public triggers: Trigger[] = [];\n\n  /**\n   * The [[TileMap]]s in the scene, if any\n   */\n  public tileMaps: TileMap[] = [];\n\n  /**\n   * Access to the Excalibur engine\n   */\n  private _engine: Engine;\n\n  /**\n   * The [[ScreenElement]]s in a scene, if any; these are drawn last\n   */\n  public screenElements: Actor[] = [];\n\n  private _isInitialized: boolean = false;\n\n  private _sortedDrawingTree: SortedList<Actor> = new SortedList<Actor>(Actor.prototype.getZIndex);\n\n  private _broadphase: CollisionBroadphase = new DynamicTreeCollisionBroadphase();\n\n  private _killQueue: Actor[] = [];\n  private _triggerKillQueue: Trigger[] = [];\n  private _timers: Timer[] = [];\n  private _cancelQueue: Timer[] = [];\n  private _logger: Logger = Logger.getInstance();\n\n  constructor(_engine: Engine) {\n    super();\n    this.camera = new Camera();\n    this._engine = _engine;\n    if (_engine) {\n      this.camera.x = _engine.halfDrawWidth;\n      this.camera.y = _engine.halfDrawHeight;\n    }\n  }\n\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent) => void): void;\n  public on(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\n  public on(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent) => void): void;\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent) => void): void;\n  public once(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\n  public once(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent) => void): void;\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent) => void): void;\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public off(eventName: Events.initialize, handler?: (event: InitializeEvent) => void): void;\n  public off(eventName: Events.activate, handler?: (event: ActivateEvent) => void): void;\n  public off(eventName: Events.deactivate, handler?: (event: DeactivateEvent) => void): void;\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent) => void): void;\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent) => void): void;\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\n  public off(eventName: Events.predebugdraw, handler?: (event: PreDebugDrawEvent) => void): void;\n  public off(eventName: Events.postdebugdraw, handler?: (event: PostDebugDrawEvent) => void): void;\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\n  public off(eventName: string, handler?: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  /**\n   * This is called before the first update of the [[Scene]]. Initializes scene members like the camera. This method is meant to be\n   * overridden. This is where initialization of child actors should take place.\n   */\n  public onInitialize(_engine: Engine): void {\n    // will be overridden\n  }\n\n  /**\n   * This is called when the scene is made active and started. It is meant to be overridden,\n   * this is where you should setup any DOM UI or event handlers needed for the scene.\n   */\n  public onActivate(_oldScene: Scene, _newScene: Scene): void {\n    // will be overridden\n  }\n\n  /**\n   * This is called when the scene is made transitioned away from and stopped. It is meant to be overridden,\n   * this is where you should cleanup any DOM UI or event handlers needed for the scene.\n   */\n  public onDeactivate(_oldScene: Scene, _newScene: Scene): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before a scene is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after a scene is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreDraw` is called directly before a scene is drawn.\n   */\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostDraw` is called directly after a scene is drawn.\n   */\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Initializes actors in the scene\n   */\n  private _initializeChildren(): void {\n    for (const child of this.actors) {\n      child._initialize(this._engine);\n    }\n  }\n\n  /**\n   * Gets whether or not the [[Scene]] has been initialized\n   */\n  public get isInitialized(): boolean {\n    return this._isInitialized;\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Initializes the scene before the first update, meant to be called by engine not by users of\n   * Excalibur\n   * @internal\n   */\n  public _initialize(engine: Engine) {\n    if (!this.isInitialized) {\n      this._engine = engine;\n      if (this.camera) {\n        this.camera.x = engine.halfDrawWidth;\n        this.camera.y = engine.halfDrawHeight;\n      }\n\n      this._initializeChildren();\n\n      this._logger.debug('Scene.onInitialize', this, engine);\n\n      this.eventDispatcher.emit('initialize', new InitializeEvent(engine, this));\n      this.onInitialize.call(this, engine);\n      this._isInitialized = true;\n    }\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Activates the scene with the base behavior, then calls the overridable `onActivate` implementation.\n   * @internal\n   */\n  public _activate(oldScene: Scene, newScene: Scene): void {\n    this._logger.debug('Scene.onActivate', this);\n    this.onActivate(oldScene, newScene);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Deactivates the scene with the base behavior, then calls the overridable `onDeactivate` implementation.\n   * @internal\n   */\n  public _deactivate(oldScene: Scene, newScene: Scene): void {\n    this._logger.debug('Scene.onDeactivate', this);\n    this.onDeactivate(oldScene, newScene);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(_engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(_engine, delta, this));\n    this.onPreUpdate(_engine, delta);\n  }\n\n  /**\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(_engine: Engine, delta: number): void {\n    this.emit('postupdate', new PostUpdateEvent(_engine, delta, this));\n    this.onPostUpdate(_engine, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\n   *\n   * @internal\n   */\n  public _predraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    this.emit('predraw', new PreDrawEvent(_ctx, _delta, this));\n    this.onPreDraw(_ctx, _delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\n   *\n   * @internal\n   */\n  public _postdraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    this.emit('postdraw', new PostDrawEvent(_ctx, _delta, this));\n    this.onPostDraw(_ctx, _delta);\n  }\n\n  /**\n   * Updates all the actors and timers in the scene. Called by the [[Engine]].\n   * @param engine  Reference to the current Engine\n   * @param delta   The number of milliseconds since the last update\n   */\n  public update(engine: Engine, delta: number) {\n    this._preupdate(engine, delta);\n    if (this.camera) {\n      this.camera.update(engine, delta);\n    }\n\n    let i: number, len: number;\n    // Remove timers in the cancel queue before updating them\n    for (i = 0, len = this._cancelQueue.length; i < len; i++) {\n      this.removeTimer(this._cancelQueue[i]);\n    }\n    this._cancelQueue.length = 0;\n\n    // Cycle through timers updating timers\n    for (const timer of this._timers) {\n      timer.update(delta);\n    }\n\n    // Cycle through actors updating UI actors\n    for (i = 0, len = this.screenElements.length; i < len; i++) {\n      this.screenElements[i].update(engine, delta);\n    }\n\n    // Cycle through actors updating tile maps\n    for (i = 0, len = this.tileMaps.length; i < len; i++) {\n      this.tileMaps[i].update(engine, delta);\n    }\n\n    // Cycle through actors updating actors\n    for (i = 0, len = this.actors.length; i < len; i++) {\n      this.actors[i].update(engine, delta);\n      this._bodies[i] = this.actors[i].body;\n    }\n\n    // Cycle through triggers updating\n    for (i = 0, len = this.triggers.length; i < len; i++) {\n      this.triggers[i].update(engine, delta);\n    }\n\n    this._collectActorStats(engine);\n\n    engine.input.pointers.dispatchPointerEvents();\n\n    // Run the broadphase and narrowphase\n    if (this._broadphase && Physics.enabled) {\n      const beforeBroadphase = Date.now();\n      this._broadphase.update(this._bodies, delta);\n      let pairs = this._broadphase.broadphase(this._bodies, delta, engine.stats.currFrame);\n      const afterBroadphase = Date.now();\n\n      const beforeNarrowphase = Date.now();\n      let iter: number = Physics.collisionPasses;\n      const collisionDelta = delta / iter;\n      while (iter > 0) {\n        // Run the narrowphase\n        pairs = this._broadphase.narrowphase(pairs, engine.stats.currFrame);\n        // Run collision resolution strategy\n        pairs = this._broadphase.resolve(pairs, collisionDelta, Physics.collisionResolutionStrategy);\n\n        this._broadphase.runCollisionStartEnd(pairs);\n\n        iter--;\n      }\n\n      const afterNarrowphase = Date.now();\n      engine.stats.currFrame.physics.broadphase = afterBroadphase - beforeBroadphase;\n      engine.stats.currFrame.physics.narrowphase = afterNarrowphase - beforeNarrowphase;\n    }\n\n    engine.stats.currFrame.actors.killed = this._killQueue.length + this._triggerKillQueue.length;\n\n    this._processKillQueue(this._killQueue, this.actors);\n    this._processKillQueue(this._triggerKillQueue, this.triggers);\n\n    this._postupdate(engine, delta);\n  }\n\n  private _processKillQueue(killQueue: Actor[], collection: Actor[]) {\n    // Remove actors from scene graph after being killed\n    let actorIndex: number;\n    for (const killed of killQueue) {\n      //don't remove actors that were readded during the same frame they were killed\n      if (killed.isKilled()) {\n        actorIndex = collection.indexOf(killed);\n        if (actorIndex > -1) {\n          this._sortedDrawingTree.removeByComparable(killed);\n          collection.splice(actorIndex, 1);\n        }\n      }\n    }\n    killQueue.length = 0;\n  }\n\n  /**\n   * Draws all the actors in the Scene. Called by the [[Engine]].\n   * @param ctx    The current rendering context\n   * @param delta  The number of milliseconds since the last draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\n    this._predraw(ctx, delta);\n    ctx.save();\n\n    if (this.camera) {\n      this.camera.draw(ctx);\n    }\n\n    let i: number, len: number;\n\n    for (i = 0, len = this.tileMaps.length; i < len; i++) {\n      this.tileMaps[i].draw(ctx, delta);\n    }\n\n    const sortedChildren = this._sortedDrawingTree.list();\n    for (i = 0, len = sortedChildren.length; i < len; i++) {\n      // only draw actors that are visible and on screen\n      if (sortedChildren[i].visible && !sortedChildren[i].isOffScreen) {\n        sortedChildren[i].draw(ctx, delta);\n      }\n    }\n\n    if (this._engine && this._engine.isDebug) {\n      ctx.strokeStyle = 'yellow';\n      this.debugDraw(ctx);\n    }\n\n    ctx.restore();\n\n    for (i = 0, len = this.screenElements.length; i < len; i++) {\n      // only draw ui actors that are visible and on screen\n      if (this.screenElements[i].visible) {\n        this.screenElements[i].draw(ctx, delta);\n      }\n    }\n\n    if (this._engine && this._engine.isDebug) {\n      for (i = 0, len = this.screenElements.length; i < len; i++) {\n        this.screenElements[i].debugDraw(ctx);\n      }\n    }\n    this._postdraw(ctx, delta);\n  }\n\n  /**\n   * Draws all the actors' debug information in the Scene. Called by the [[Engine]].\n   * @param ctx  The current rendering context\n   */\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    this.emit('predebugdraw', new PreDebugDrawEvent(ctx, this));\n\n    let i: number, len: number;\n\n    for (i = 0, len = this.tileMaps.length; i < len; i++) {\n      this.tileMaps[i].debugDraw(ctx);\n    }\n\n    for (i = 0, len = this.actors.length; i < len; i++) {\n      this.actors[i].debugDraw(ctx);\n    }\n\n    for (i = 0, len = this.triggers.length; i < len; i++) {\n      this.triggers[i].debugDraw(ctx);\n    }\n\n    this._broadphase.debugDraw(ctx, 20);\n\n    this.camera.debugDraw(ctx);\n    this.emit('postdebugdraw', new PostDebugDrawEvent(ctx, this));\n  }\n\n  /**\n   * Checks whether an actor is contained in this scene or not\n   */\n  public contains(actor: Actor): boolean {\n    return this.actors.indexOf(actor) > -1;\n  }\n\n  /**\n   * Adds a [[Timer]] to the current [[Scene]].\n   * @param timer  The timer to add to the current [[Scene]].\n   */\n  public add(timer: Timer): void;\n\n  /**\n   * Adds a [[TileMap]] to the [[Scene]], once this is done the [[TileMap]] will be drawn and updated.\n   */\n  public add(tileMap: TileMap): void;\n\n  /**\n   * Adds a [[Trigger]] to the [[Scene]], once this is done the [[Trigger]] will listen for interactions with other actors.\n   * @param trigger\n   */\n  public add(trigger: Trigger): void;\n\n  /**\n   * Adds an actor to the scene, once this is done the [[Actor]] will be drawn and updated.\n   * @param actor  The actor to add to the current scene\n   */\n  public add(actor: Actor): void;\n\n  /**\n   * Adds a [[ScreenElement]] to the scene.\n   * @param screenElement  The ScreenElement to add to the current scene\n   */\n  public add(screenElement: ScreenElement): void;\n  public add(entity: any): void {\n    if (entity instanceof Actor) {\n      (<Actor>entity).unkill();\n    }\n    if (entity instanceof ScreenElement) {\n      if (!Util.contains(this.screenElements, entity)) {\n        this.addScreenElement(entity);\n      }\n      return;\n    }\n\n    if (entity instanceof Actor) {\n      if (!Util.contains(this.actors, entity)) {\n        this._addChild(entity);\n      }\n      return;\n    }\n    if (entity instanceof Timer) {\n      if (!Util.contains(this._timers, entity)) {\n        this.addTimer(entity);\n      }\n      return;\n    }\n    if (entity instanceof TileMap) {\n      if (!Util.contains(this.tileMaps, entity)) {\n        this.addTileMap(entity);\n      }\n    }\n  }\n\n  /**\n   * Removes a [[Timer]] from the current scene, it will no longer be updated.\n   * @param timer  The timer to remove to the current scene.\n   */\n  public remove(timer: Timer): void;\n\n  /**\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\n   * @param tileMap {TileMap}\n   */\n  public remove(tileMap: TileMap): void;\n\n  /**\n   * Removes an actor from the scene, it will no longer be drawn or updated.\n   * @param actor  The actor to remove from the current scene.\n   */\n  public remove(actor: Actor): void;\n\n  /**\n   * Removes a [[ScreenElement]] to the scene, it will no longer be drawn or updated\n   * @param screenElement  The ScreenElement to remove from the current scene\n   */\n  public remove(screenElement: ScreenElement): void;\n  public remove(entity: any): void {\n    if (entity instanceof ScreenElement) {\n      this.removeScreenElement(entity);\n      return;\n    }\n\n    if (entity instanceof Actor) {\n      this._removeChild(entity);\n    }\n    if (entity instanceof Timer) {\n      this.removeTimer(entity);\n    }\n\n    if (entity instanceof TileMap) {\n      this.removeTileMap(entity);\n    }\n  }\n\n  /**\n   * Adds (any) actor to act as a piece of UI, meaning it is always positioned\n   * in screen coordinates. UI actors do not participate in collisions.\n   * @todo Should this be `ScreenElement` only?\n   */\n  public addScreenElement(actor: Actor) {\n    this.screenElements.push(actor);\n    actor.scene = this;\n  }\n\n  /**\n   * Removes an actor as a piece of UI\n   */\n  public removeScreenElement(actor: Actor) {\n    const index = this.screenElements.indexOf(actor);\n    if (index > -1) {\n      this.screenElements.splice(index, 1);\n    }\n  }\n\n  /**\n   * Adds an actor to the scene, once this is done the actor will be drawn and updated.\n   */\n  protected _addChild(actor: Actor) {\n    this._broadphase.track(actor.body);\n    actor.scene = this;\n    if (actor instanceof Trigger) {\n      this.triggers.push(actor);\n    } else {\n      this.actors.push(actor);\n    }\n\n    this._sortedDrawingTree.add(actor);\n  }\n\n  /**\n   * Adds a [[TileMap]] to the scene, once this is done the TileMap will be drawn and updated.\n   */\n  public addTileMap(tileMap: TileMap) {\n    this.tileMaps.push(tileMap);\n  }\n\n  /**\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\n   */\n  public removeTileMap(tileMap: TileMap) {\n    const index = this.tileMaps.indexOf(tileMap);\n    if (index > -1) {\n      this.tileMaps.splice(index, 1);\n    }\n  }\n\n  /**\n   * Removes an actor from the scene, it will no longer be drawn or updated.\n   */\n  protected _removeChild(actor: Actor) {\n    if (!Util.contains(this.actors, actor)) {\n      return;\n    }\n    this._broadphase.untrack(actor.body);\n    if (actor instanceof Trigger) {\n      this._triggerKillQueue.push(actor);\n    } else {\n      if (!actor.isKilled()) {\n        actor.kill();\n      }\n      this._killQueue.push(actor);\n    }\n\n    actor.parent = null;\n  }\n\n  /**\n   * Adds a [[Timer]] to the scene\n   * @param timer  The timer to add\n   */\n  public addTimer(timer: Timer): Timer {\n    this._timers.push(timer);\n    timer.scene = this;\n    return timer;\n  }\n\n  /**\n   * Removes a [[Timer]] from the scene.\n   * @warning Can be dangerous, use [[cancelTimer]] instead\n   * @param timer  The timer to remove\n   */\n  public removeTimer(timer: Timer): Timer {\n    const i = this._timers.indexOf(timer);\n    if (i !== -1) {\n      this._timers.splice(i, 1);\n    }\n    return timer;\n  }\n\n  /**\n   * Cancels a [[Timer]], removing it from the scene nicely\n   * @param timer  The timer to cancel\n   */\n  public cancelTimer(timer: Timer): Timer {\n    this._cancelQueue.push(timer);\n    return timer;\n  }\n\n  /**\n   * Tests whether a [[Timer]] is active in the scene\n   */\n  public isTimerActive(timer: Timer): boolean {\n    return this._timers.indexOf(timer) > -1 && !timer.complete;\n  }\n\n  /**\n   * Removes the given actor from the sorted drawing tree\n   */\n  public cleanupDrawTree(actor: Actor) {\n    this._sortedDrawingTree.removeByComparable(actor);\n  }\n\n  /**\n   * Updates the given actor's position in the sorted drawing tree\n   */\n  public updateDrawTree(actor: Actor) {\n    this._sortedDrawingTree.add(actor);\n  }\n\n  /**\n   * Checks if an actor is in this scene's sorted draw tree\n   */\n  public isActorInDrawTree(actor: Actor): boolean {\n    return this._sortedDrawingTree.find(actor);\n  }\n\n  public isCurrentScene(): boolean {\n    if (this._engine) {\n      return this._engine.currentScene === this;\n    }\n    return false;\n  }\n\n  private _collectActorStats(engine: Engine) {\n    for (const _ui of this.screenElements) {\n      engine.stats.currFrame.actors.ui++;\n    }\n\n    for (const actor of this.actors) {\n      engine.stats.currFrame.actors.alive++;\n      for (const child of actor.children) {\n        if (ActorUtils.isScreenElement(child)) {\n          engine.stats.currFrame.actors.ui++;\n        } else {\n          engine.stats.currFrame.actors.alive++;\n        }\n      }\n    }\n  }\n}\n","import { DebugFlags } from './DebugFlags';\nimport { Pair } from './Collision/Pair';\n\n/**\n * Debug stats containing current and previous frame statistics\n */\nexport interface DebugStats {\n  currFrame: FrameStats;\n  prevFrame: FrameStats;\n}\n\n/**\n * Hash containing the [[Pair.id]]s of pairs that collided in a frame\n */\nexport interface CollidersHash {\n  [pairId: string]: Pair;\n}\n\n/**\n * Represents a frame's individual statistics\n */\nexport interface FrameStatistics {\n  /**\n   * The number of the frame\n   */\n  id: number;\n\n  /**\n   * Gets the frame's delta (time since last frame scaled by [[Engine.timescale]]) (in ms)\n   */\n  delta: number;\n\n  /**\n   * Gets the frame's frames-per-second (FPS)\n   */\n  fps: number;\n\n  /**\n   * Duration statistics (in ms)\n   */\n  duration: FrameDurationStats;\n\n  /**\n   * Actor statistics\n   */\n  actors: FrameActorStats;\n\n  /**\n   * Physics statistics\n   */\n  physics: PhysicsStatistics;\n}\n\n/**\n * Represents actor stats for a frame\n */\nexport interface FrameActorStats {\n  /**\n   * Gets the frame's number of actors (alive)\n   */\n  alive: number;\n\n  /**\n   * Gets the frame's number of actors (killed)\n   */\n  killed: number;\n\n  /**\n   * Gets the frame's number of remaining actors (alive - killed)\n   */\n  remaining: number;\n\n  /**\n   * Gets the frame's number of UI actors\n   */\n  ui: number;\n\n  /**\n   * Gets the frame's number of total actors (remaining + UI)\n   */\n  total: number;\n}\n\n/**\n * Represents duration stats for a frame\n */\nexport interface FrameDurationStats {\n  /**\n   * Gets the frame's total time to run the update function (in ms)\n   */\n  update: number;\n\n  /**\n   * Gets the frame's total time to run the draw function (in ms)\n   */\n  draw: number;\n\n  /**\n   * Gets the frame's total render duration (update + draw duration) (in ms)\n   */\n  total: number;\n}\n\n/**\n * Represents physics stats for the current frame\n */\nexport interface PhysicsStatistics {\n  /**\n   * Gets the number of broadphase collision pairs which\n   */\n  pairs: number;\n\n  /**\n   * Gets the number of actual collisions\n   */\n  collisions: number;\n\n  /**\n   * A Hash storing the [[Pair.id]]s of [[Pair]]s that collided in the frame\n   */\n  collidersHash: CollidersHash;\n\n  /**\n   * Gets the number of fast moving bodies using raycast continuous collisions in the scene\n   */\n  fastBodies: number;\n\n  /**\n   * Gets the number of bodies that had a fast body collision resolution\n   */\n  fastBodyCollisions: number;\n\n  /**\n   * Gets the time it took to calculate the broadphase pairs\n   */\n  broadphase: number;\n\n  /**\n   * Gets the time it took to calculate the narrowphase\n   */\n  narrowphase: number;\n}\n\n/**\n * Debug statistics and flags for Excalibur. If polling these values, it would be\n * best to do so on the `postupdate` event for [[Engine]], after all values have been\n * updated during a frame.\n */\nexport class Debug implements DebugFlags {\n  /**\n   * Performance statistics\n   */\n  public stats: DebugStats = {\n    /**\n     * Current frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\n     * Best accessed on [[postframe]] event. See [[FrameStats]]\n     */\n    currFrame: new FrameStats(),\n\n    /**\n     * Previous frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\n     * Best accessed on [[preframe]] event. Best inspected on engine event `preframe`. See [[FrameStats]]\n     */\n    prevFrame: new FrameStats()\n  };\n}\n\n/**\n * Implementation of a frame's stats. Meant to have values copied via [[FrameStats.reset]], avoid\n * creating instances of this every frame.\n */\nexport class FrameStats implements FrameStatistics {\n  private _id: number = 0;\n  private _delta: number = 0;\n  private _fps: number = 0;\n  private _actorStats: FrameActorStats = {\n    alive: 0,\n    killed: 0,\n    ui: 0,\n    get remaining(this: FrameActorStats) {\n      return this.alive - this.killed;\n    },\n    get total(this: FrameActorStats) {\n      return this.remaining + this.ui;\n    }\n  };\n  private _durationStats: FrameDurationStats = {\n    update: 0,\n    draw: 0,\n    get total(this: FrameDurationStats) {\n      return this.update + this.draw;\n    }\n  };\n\n  private _physicsStats: PhysicsStats = new PhysicsStats();\n\n  /**\n   * Zero out values or clone other IFrameStat stats. Allows instance reuse.\n   *\n   * @param [otherStats] Optional stats to clone\n   */\n  public reset(otherStats?: FrameStatistics) {\n    if (otherStats) {\n      this.id = otherStats.id;\n      this.delta = otherStats.delta;\n      this.fps = otherStats.fps;\n      this.actors.alive = otherStats.actors.alive;\n      this.actors.killed = otherStats.actors.killed;\n      this.actors.ui = otherStats.actors.ui;\n      this.duration.update = otherStats.duration.update;\n      this.duration.draw = otherStats.duration.draw;\n      this._physicsStats.reset(otherStats.physics);\n    } else {\n      this.id = this.delta = this.fps = 0;\n      this.actors.alive = this.actors.killed = this.actors.ui = 0;\n      this.duration.update = this.duration.draw = 0;\n      this._physicsStats.reset();\n    }\n  }\n\n  /**\n   * Provides a clone of this instance.\n   */\n  public clone(): FrameStats {\n    const fs = new FrameStats();\n\n    fs.reset(this);\n\n    return fs;\n  }\n\n  /**\n   * Gets the frame's id\n   */\n  public get id() {\n    return this._id;\n  }\n\n  /**\n   * Sets the frame's id\n   */\n  public set id(value: number) {\n    this._id = value;\n  }\n\n  /**\n   * Gets the frame's delta (time since last frame)\n   */\n  public get delta() {\n    return this._delta;\n  }\n\n  /**\n   * Sets the frame's delta (time since last frame). Internal use only.\n   * @internal\n   */\n  public set delta(value: number) {\n    this._delta = value;\n  }\n\n  /**\n   * Gets the frame's frames-per-second (FPS)\n   */\n  public get fps() {\n    return this._fps;\n  }\n\n  /**\n   * Sets the frame's frames-per-second (FPS). Internal use only.\n   * @internal\n   */\n  public set fps(value: number) {\n    this._fps = value;\n  }\n\n  /**\n   * Gets the frame's actor statistics\n   */\n  public get actors() {\n    return this._actorStats;\n  }\n\n  /**\n   * Gets the frame's duration statistics\n   */\n  public get duration() {\n    return this._durationStats;\n  }\n\n  /**\n   * Gets the frame's physics statistics\n   */\n  public get physics() {\n    return this._physicsStats;\n  }\n}\n\nexport class PhysicsStats implements PhysicsStatistics {\n  private _pairs: number = 0;\n  private _collisions: number = 0;\n  private _collidersHash: CollidersHash = {};\n  private _fastBodies: number = 0;\n  private _fastBodyCollisions: number = 0;\n  private _broadphase: number = 0;\n  private _narrowphase: number = 0;\n\n  /**\n   * Zero out values or clone other IPhysicsStats stats. Allows instance reuse.\n   *\n   * @param [otherStats] Optional stats to clone\n   */\n  public reset(otherStats?: PhysicsStatistics) {\n    if (otherStats) {\n      this.pairs = otherStats.pairs;\n      this.collisions = otherStats.collisions;\n      this.collidersHash = otherStats.collidersHash;\n      this.fastBodies = otherStats.fastBodies;\n      this.fastBodyCollisions = otherStats.fastBodyCollisions;\n      this.broadphase = otherStats.broadphase;\n      this.narrowphase = otherStats.narrowphase;\n    } else {\n      this.pairs = this.collisions = this.fastBodies = 0;\n      this.fastBodyCollisions = this.broadphase = this.narrowphase = 0;\n      this.collidersHash = {};\n    }\n  }\n\n  /**\n   * Provides a clone of this instance.\n   */\n  public clone(): PhysicsStatistics {\n    const ps = new PhysicsStats();\n\n    ps.reset(this);\n\n    return ps;\n  }\n\n  public get pairs(): number {\n    return this._pairs;\n  }\n\n  public set pairs(value: number) {\n    this._pairs = value;\n  }\n\n  public get collisions(): number {\n    return this._collisions;\n  }\n\n  public set collisions(value: number) {\n    this._collisions = value;\n  }\n\n  public get collidersHash(): CollidersHash {\n    return this._collidersHash;\n  }\n\n  public set collidersHash(colliders: CollidersHash) {\n    this._collidersHash = colliders;\n  }\n\n  public get fastBodies(): number {\n    return this._fastBodies;\n  }\n\n  public set fastBodies(value: number) {\n    this._fastBodies = value;\n  }\n\n  public get fastBodyCollisions(): number {\n    return this._fastBodyCollisions;\n  }\n\n  public set fastBodyCollisions(value: number) {\n    this._fastBodyCollisions = value;\n  }\n\n  public get broadphase(): number {\n    return this._broadphase;\n  }\n\n  public set broadphase(value: number) {\n    this._broadphase = value;\n  }\n\n  public get narrowphase(): number {\n    return this._narrowphase;\n  }\n\n  public set narrowphase(value: number) {\n    this._narrowphase = value;\n  }\n}\n","import { Actor } from '../Actor';\nimport { Vector } from '../Algebra';\nimport { Class } from '../Class';\nimport * as Actors from '../Util/Actors';\nimport { removeItemFromArray } from '../Util/Util';\nimport { PointerMoveEvent, PointerDownEvent, PointerUpEvent, WheelEvent } from './PointerEvents';\n\nexport interface ActorsUnderPointer {\n  [ActorId: number]: Actor;\n  length: number;\n}\n\n/**\n * The type of pointer for a [[PointerEvent]].\n */\nexport enum PointerType {\n  Touch = 'Touch',\n  Mouse = 'Mouse',\n  Pen = 'Pen',\n  Unknown = 'Unknown'\n}\n\n/**\n * Determines the scope of handling mouse/touch events. See [[Pointers]] for more information.\n */\nexport enum PointerScope {\n  /**\n   * Handle events on the `canvas` element only. Events originating outside the\n   * `canvas` will not be handled.\n   */\n  Canvas = 'Canvas',\n\n  /**\n   * Handles events on the entire document. All events will be handled by Excalibur.\n   */\n  Document = 'Document'\n}\n\n/**\n * Captures and dispatches PointerEvents\n */\nexport class Pointer extends Class {\n  private static _MAX_ID = 0;\n  public readonly id = Pointer._MAX_ID++;\n  private _isDown: boolean = false;\n  private _wasDown: boolean = false;\n\n  private _actorsUnderPointer: ActorsUnderPointer = { length: 0 };\n\n  private _actors: Actor[] = [];\n  private _actorsLastFrame: Actor[] = [];\n  private _actorsNoLongerUnderPointer: Actor[] = [];\n\n  /**\n   * Whether the Pointer is currently dragging.\n   */\n  public get isDragging(): boolean {\n    return this._isDown;\n  }\n\n  /**\n   * Whether the Pointer just started dragging.\n   */\n  public get isDragStart(): boolean {\n    return !this._wasDown && this._isDown;\n  }\n\n  /**\n   * Whether the Pointer just ended dragging.\n   */\n  public get isDragEnd(): boolean {\n    return this._wasDown && !this._isDown;\n  }\n\n  /**\n   * Returns true if pointer has any actors under\n   */\n  public get hasActorsUnderPointer(): boolean {\n    return !!this._actorsUnderPointer.length;\n  }\n\n  /**\n   * The last position on the document this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastPagePos: Vector = null;\n\n  /**\n   * The last position on the screen this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastScreenPos: Vector = null;\n\n  /**\n   * The last position in the game world coordinates this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastWorldPos: Vector = null;\n\n  /**\n   * Returns the currently dragging target or null if it isn't exist\n   */\n  public dragTarget: Actor = null;\n\n  constructor() {\n    super();\n\n    this.on('move', this._onPointerMove);\n    this.on('down', this._onPointerDown);\n    this.on('up', this._onPointerUp);\n  }\n\n  on(event: 'move', handler: (event: PointerMoveEvent) => void): void;\n  on(event: 'down', handler: (event: PointerDownEvent) => void): void;\n  on(event: 'up', handler: (event: PointerUpEvent) => void): void;\n  on(event: 'wheel', handler: (event: WheelEvent) => void): void;\n  on(event: string, handler: (event: any) => void): void {\n    super.on(event, handler);\n  }\n\n  once(event: 'move', handler: (event: PointerMoveEvent) => void): void;\n  once(event: 'down', handler: (event: PointerDownEvent) => void): void;\n  once(event: 'up', handler: (event: PointerUpEvent) => void): void;\n  once(event: 'wheel', handler: (event: WheelEvent) => void): void;\n  once(event: string, handler: (event: any) => void): void {\n    super.once(event, handler);\n  }\n\n  off(event: 'move', handler?: (event: PointerMoveEvent) => void): void;\n  off(event: 'down', handler?: (event: PointerDownEvent) => void): void;\n  off(event: 'up', handler?: (event: PointerUpEvent) => void): void;\n  off(event: 'wheel', handler?: (event: WheelEvent) => void): void;\n  off(event: string, handler?: (event: any) => void): void {\n    super.off(event, handler);\n  }\n\n  /**\n   * Update the state of current pointer, meant to be called a the end of frame\n   */\n  public update(): void {\n    if (this._wasDown && !this._isDown) {\n      this._wasDown = false;\n    } else if (!this._wasDown && this._isDown) {\n      this._wasDown = true;\n    }\n    this._actorsLastFrame = [...this._actors];\n    this._actorsNoLongerUnderPointer = [];\n  }\n\n  /**\n   * Adds an Actor to actorsUnderPointer object.\n   * @param actor An Actor to be added;\n   */\n  public addActorUnderPointer(actor: Actor): void {\n    if (!this.isActorUnderPointer(actor)) {\n      this._actorsUnderPointer[actor.id] = actor;\n      this._actorsUnderPointer.length += 1;\n      this._actors.push(actor);\n    }\n\n    // Actors under the pointer are sorted by z, ties are broken by id\n    this._actors.sort((a, b) => {\n      if (a.z === b.z) {\n        return a.id - b.id;\n      }\n      return a.z - b.z;\n    });\n  }\n\n  /**\n   * Removes an Actor from actorsUnderPointer object.\n   * @param actor An Actor to be removed;\n   */\n  public removeActorUnderPointer(actor: Actor): void {\n    if (this.isActorUnderPointer(actor)) {\n      delete this._actorsUnderPointer[actor.id];\n      this._actorsUnderPointer.length -= 1;\n      removeItemFromArray(actor, this._actors);\n      this._actorsNoLongerUnderPointer.push(actor);\n    }\n  }\n\n  /**\n   * Returns all actors under this pointer this frame\n   */\n  public getActorsUnderPointer(): Actor[] {\n    return this._actors;\n  }\n\n  /**\n   * Returns all actors that are no longer under the pointer this frame\n   */\n  public getActorsUnderPointerLastFrame(): Actor[] {\n    return this._actorsLastFrame;\n  }\n\n  /**\n   * Returns all actors relevant for events to pointer this frame\n   */\n  public getActorsForEvents(): Actor[] {\n    return this._actors.concat(this._actorsLastFrame).filter((actor, i, self) => {\n      return self.indexOf(actor) === i;\n    });\n  }\n\n  /**\n   * Checks if Pointer has a specific Actor under.\n   * @param actor An Actor for check;\n   */\n  public checkActorUnderPointer(actor: Actor): boolean {\n    if (this.lastWorldPos) {\n      return actor.contains(this.lastWorldPos.x, this.lastWorldPos.y, !Actors.isScreenElement(actor));\n    }\n    return false;\n  }\n\n  /**\n   * Checks if an actor was under the pointer last frame\n   * @param actor\n   */\n  public wasActorUnderPointer(actor: Actor): boolean {\n    return this._actorsLastFrame.indexOf(actor) > -1; // || !!this._actorsUnderPointerLastFrame.hasOwnProperty(actor.id.toString());\n  }\n\n  /**\n   * Checks if Pointer has a specific Actor in ActorsUnderPointer list.\n   * @param actor An Actor for check;\n   */\n  public isActorUnderPointer(actor: Actor): boolean {\n    return this._actorsUnderPointer.hasOwnProperty(actor.id.toString());\n  }\n\n  private _onPointerMove(ev: PointerMoveEvent): void {\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\n  }\n\n  private _onPointerDown(ev: PointerDownEvent): void {\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\n    this._isDown = true;\n  }\n\n  private _onPointerUp(_ev: PointerUpEvent): void {\n    this._isDown = false;\n    this.dragTarget = null;\n  }\n}\n","import { Actor } from '../Actor';\nimport { Vector, GlobalCoordinates } from '../Algebra';\nimport { Pointer, PointerType } from './Pointer';\nimport { GameEvent } from '../Events';\n\n/**\n * Native browser button enumeration\n */\nexport enum NativePointerButton {\n  NoButton = -1,\n  Left = 0,\n  Middle = 1,\n  Right = 2,\n  Unknown = 3\n}\n\n/**\n * The mouse button being pressed.\n */\nexport enum PointerButton {\n  Left = 'Left',\n  Middle = 'Middle',\n  Right = 'Right',\n  Unknown = 'Unknown',\n  NoButton = 'NoButton'\n}\n\nexport enum WheelDeltaMode {\n  Pixel = 'Pixel',\n  Line = 'Line',\n  Page = 'Page'\n}\n\n/**\n * Type that indicates Excalibur's valid synthetic pointer events\n */\nexport type PointerEventName =\n  | 'pointerdragstart'\n  | 'pointerdragend'\n  | 'pointerdragmove'\n  | 'pointerdragenter'\n  | 'pointerdragleave'\n  | 'pointermove'\n  | 'pointerenter'\n  | 'pointerleave'\n  | 'pointerup'\n  | 'pointerdown';\n\n/**\n * Pointer events\n *\n * Represents a mouse, touch, or stylus event. See [[Pointers]] for more information on\n * handling pointer input.\n *\n * For mouse-based events, you can inspect [[PointerEvent.button]] to see what button was pressed.\n */\nexport class PointerEvent extends GameEvent<Actor> {\n  protected _name: string;\n\n  public get name() {\n    return this._name;\n  }\n\n  /** The world coordinates of the event. */\n  public get worldPos(): Vector {\n    return this.coordinates.worldPos.clone();\n  }\n\n  /** The page coordinates of the event. */\n  public get pagePos(): Vector {\n    return this.coordinates.pagePos.clone();\n  }\n\n  /** The screen coordinates of the event. */\n  public get screenPos(): Vector {\n    return this.coordinates.screenPos.clone();\n  }\n\n  /**\n   * @param coordinates         The [[GlobalCoordinates]] of the event\n   * @param pointer             The [[Pointer]] of the event\n   * @param index               The index of the pointer (zero-based)\n   * @param pointerType         The type of pointer\n   * @param button              The button pressed (if [[PointerType.Mouse]])\n   * @param ev                  The raw DOM event being handled\n   * @param pos                 (Will be added to signature in 0.14.0 release) The position of the event (in world coordinates)\n   */\n  constructor(\n    protected coordinates: GlobalCoordinates,\n    public pointer: Pointer,\n    public index: number,\n    public pointerType: PointerType,\n    public button: PointerButton,\n    public ev: any\n  ) {\n    super();\n  }\n\n  public get pos(): Vector {\n    return this.coordinates.worldPos.clone();\n  }\n\n  public propagate(actor: Actor): void {\n    this.doAction(actor);\n\n    if (this.bubbles && actor.parent) {\n      this.propagate(actor.parent);\n    }\n  }\n\n  /**\n   * Action, that calls when event happens\n   */\n  public doAction(actor: Actor): void {\n    if (actor) {\n      this._onActionStart(actor);\n      actor.emit(this._name, this);\n      this._onActionEnd(actor);\n    }\n  }\n\n  protected _onActionStart(_actor?: Actor) {\n    // to be rewritten\n  }\n\n  protected _onActionEnd(_actor?: Actor) {\n    // to be rewritten\n  }\n}\n\nexport class PointerEventFactory<T extends PointerEvent> {\n  constructor(\n    protected _pointerEventType: new (\n      coordinates: GlobalCoordinates,\n      pointer: Pointer,\n      index: number,\n      pointerType: PointerType,\n      button: PointerButton,\n      ev: any\n    ) => T\n  ) {}\n\n  /**\n   * Create specific PointerEvent\n   */\n  public create(\n    coordinates: GlobalCoordinates,\n    pointer: Pointer,\n    index: number,\n    pointerType: PointerType,\n    button: PointerButton,\n    ev: any\n  ): T {\n    return new this._pointerEventType(coordinates, pointer, index, pointerType, button, ev);\n  }\n}\n\nexport class PointerDragEvent extends PointerEvent {}\n\nexport class PointerUpEvent extends PointerEvent {\n  protected _name = 'pointerup';\n\n  protected _onActionEnd(actor: Actor) {\n    const pointer = this.pointer;\n\n    if (pointer.isDragEnd && actor.capturePointer.captureDragEvents) {\n      actor.eventDispatcher.emit('pointerdragend', this);\n    }\n  }\n}\n\nexport class PointerDownEvent extends PointerEvent {\n  protected _name = 'pointerdown';\n\n  protected _onActionEnd(actor: Actor) {\n    if (this.pointer.isDragStart && actor.capturePointer.captureDragEvents) {\n      actor.eventDispatcher.emit('pointerdragstart', this);\n    }\n  }\n}\n\nexport class PointerMoveEvent extends PointerEvent {\n  protected _name = 'pointermove';\n\n  public propagate(actor: Actor): void {\n    // If the actor was under the pointer last frame, but not this one it left\n    // if (this.pointer.wasActorUnderPointer(actor) && !this.pointer.isActorUnderPointer(actor)) {\n    //   this._onActorLeave(actor);\n    //   return;\n    // }\n\n    if (this.pointer.isActorUnderPointer(actor)) {\n      this.doAction(actor);\n\n      if (this.bubbles && actor.parent) {\n        this.propagate(actor.parent);\n      }\n    }\n  }\n\n  protected _onActionStart(actor: Actor) {\n    if (!actor.capturePointer.captureMoveEvents) {\n      return;\n    }\n\n    // In the case this is new\n    // if (this.pointer.checkActorUnderPointer(actor) && !this.pointer.wasActorUnderPointer(actor)) {\n    //   this._onActorEnter(actor);\n    // }\n\n    if (this.pointer.isDragging && actor.capturePointer.captureDragEvents) {\n      actor.eventDispatcher.emit('pointerdragmove', this);\n    }\n  }\n\n  // private _onActorEnter(actor: Actor) {\n  //   const pe = createPointerEventByName('enter', this.coordinates, this.pointer, this.index, this.pointerType, this.button, this.ev);\n  //   pe.propagate(actor);\n  //   this.pointer.addActorUnderPointer(actor);\n\n  //   if (this.pointer.isDragging) {\n  //     this.pointer.dragTarget = actor;\n  //   }\n  // }\n\n  // private _onActorLeave(actor: Actor) {\n  //   const pe = createPointerEventByName('leave', this.coordinates, this.pointer, this.index, this.pointerType, this.button, this.ev);\n  //   pe.propagate(actor);\n  //   this.pointer.removeActorUnderPointer(actor);\n  // }\n}\n\nexport class PointerEnterEvent extends PointerEvent {\n  protected _name = 'pointerenter';\n\n  protected _onActionStart(actor: Actor) {\n    if (!actor.capturePointer.captureMoveEvents) {\n      return;\n    }\n  }\n\n  protected _onActionEnd(actor: Actor) {\n    const pointer = this.pointer;\n\n    if (pointer.isDragging && actor.capturePointer.captureDragEvents) {\n      actor.eventDispatcher.emit('pointerdragenter', this);\n    }\n  }\n}\n\nexport class PointerLeaveEvent extends PointerEvent {\n  protected _name = 'pointerleave';\n\n  protected _onActionStart(actor: Actor) {\n    if (!actor.capturePointer.captureMoveEvents) {\n      return;\n    }\n  }\n\n  protected _onActionEnd(actor: Actor) {\n    const pointer = this.pointer;\n\n    if (pointer.isDragging && actor.capturePointer.captureDragEvents) {\n      actor.eventDispatcher.emit('pointerdragleave', this);\n    }\n  }\n}\n\nexport class PointerCancelEvent extends PointerEvent {\n  protected _name = 'pointercancel';\n}\n/**\n * Wheel Events\n *\n * Represents a mouse wheel event. See [[Pointers]] for more information on\n * handling point input.\n */\nexport class WheelEvent extends GameEvent<Actor> {\n  /**\n   * @param x            The `x` coordinate of the event (in world coordinates)\n   * @param y            The `y` coordinate of the event (in world coordinates)\n   * @param pageX        The `x` coordinate of the event (in document coordinates)\n   * @param pageY        The `y` coordinate of the event (in document coordinates)\n   * @param screenX      The `x` coordinate of the event (in screen coordinates)\n   * @param screenY      The `y` coordinate of the event (in screen coordinates)\n   * @param index        The index of the pointer (zero-based)\n   * @param deltaX       The type of pointer\n   * @param deltaY       The type of pointer\n   * @param deltaZ       The type of pointer\n   * @param deltaMode    The type of movement [[WheelDeltaMode]]\n   * @param ev           The raw DOM event being handled\n   */\n  constructor(\n    public x: number,\n    public y: number,\n    public pageX: number,\n    public pageY: number,\n    public screenX: number,\n    public screenY: number,\n    public index: number,\n    public deltaX: number,\n    public deltaY: number,\n    public deltaZ: number,\n    public deltaMode: WheelDeltaMode,\n    public ev: any\n  ) {\n    super();\n  }\n}\n\nexport function createPointerEventByName(\n  eventName: string,\n  coordinates: GlobalCoordinates,\n  pointer: Pointer,\n  index: number,\n  pointerType: PointerType,\n  button: PointerButton,\n  ev: any\n) {\n  let factory: PointerEventFactory<PointerEvent>;\n\n  switch (eventName) {\n    case 'up':\n      factory = new PointerEventFactory(<any>PointerUpEvent);\n      break;\n    case 'down':\n      factory = new PointerEventFactory(<any>PointerDownEvent);\n      break;\n    case 'move':\n      factory = new PointerEventFactory(<any>PointerMoveEvent);\n      break;\n    case 'cancel':\n      factory = new PointerEventFactory(<any>PointerCancelEvent);\n      break;\n    case 'enter':\n      factory = new PointerEventFactory(<any>PointerEnterEvent);\n      break;\n    case 'leave':\n      factory = new PointerEventFactory(<any>PointerLeaveEvent);\n      break;\n  }\n\n  return factory.create(coordinates, pointer, index, pointerType, button, ev);\n}\n","import { Class } from './../Class';\nimport { GameEvent, GamepadConnectEvent, GamepadDisconnectEvent, GamepadButtonEvent, GamepadAxisEvent } from '../Events';\nimport * as Events from '../Events';\n\n/**\n * Excalibur leverages the HTML5 Gamepad API [where it is supported](http://caniuse.com/#feat=gamepad)\n * to provide controller support for your games.\n *\n * [[include:Gamepads.md]]\n */\nexport class Gamepads extends Class {\n  /**\n   * Whether or not to poll for Gamepad input (default: `false`)\n   */\n  public enabled = false;\n\n  /**\n   * Whether or not Gamepad API is supported\n   */\n  public supported = !!(<any>navigator).getGamepads;\n\n  /**\n   * The minimum value an axis has to move before considering it a change\n   */\n  public static MinAxisMoveThreshold = 0.05;\n\n  private _gamePadTimeStamps = [0, 0, 0, 0];\n  private _oldPads: Gamepad[] = [];\n  private _pads: Gamepad[] = [];\n  private _initSuccess: boolean = false;\n  private _navigator: NavigatorGamepads = <any>navigator;\n  private _minimumConfiguration: GamepadConfiguration = null;\n\n  constructor() {\n    super();\n  }\n\n  public init() {\n    if (!this.supported) {\n      return;\n    }\n    if (this._initSuccess) {\n      return;\n    }\n\n    // In Chrome, this will return 4 undefined items until a button is pressed\n    // In FF, this will not return any items until a button is pressed\n    this._oldPads = this._clonePads(this._navigator.getGamepads());\n    if (this._oldPads.length && this._oldPads[0]) {\n      this._initSuccess = true;\n    }\n  }\n\n  /**\n   * Sets the minimum gamepad configuration, for example {axis: 4, buttons: 4} means\n   * this game requires at minimum 4 axis inputs and 4 buttons, this is not restrictive\n   * all other controllers with more axis or buttons are valid as well. If no minimum\n   * configuration is set all pads are valid.\n   */\n  public setMinimumGamepadConfiguration(config: GamepadConfiguration): void {\n    this._enableAndUpdate(); // if config is used, implicitly enable\n    this._minimumConfiguration = config;\n  }\n\n  /**\n   * When implicitly enabled, set the enabled flag and run an update so information is updated\n   */\n  private _enableAndUpdate() {\n    if (!this.enabled) {\n      this.enabled = true;\n      this.update();\n    }\n  }\n\n  /**\n   * Checks a navigator gamepad against the minimum configuration if present.\n   */\n  private _isGamepadValid(pad: NavigatorGamepad): boolean {\n    if (!this._minimumConfiguration) {\n      return true;\n    }\n    if (!pad) {\n      return false;\n    }\n    const axesLength = pad.axes.filter((value) => {\n      return typeof value !== undefined;\n    }).length;\n\n    const buttonLength = pad.buttons.filter((value) => {\n      return typeof value !== undefined;\n    }).length;\n    return axesLength >= this._minimumConfiguration.axis && buttonLength >= this._minimumConfiguration.buttons && pad.connected;\n  }\n\n  public on(eventName: Events.connect, handler: (event: GamepadConnectEvent) => void): void;\n  public on(eventName: Events.disconnect, handler: (event: GamepadDisconnectEvent) => void): void;\n  public on(eventName: Events.button, handler: (event: GamepadButtonEvent) => void): void;\n  public on(eventName: Events.axis, handler: (event: GamepadAxisEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    this._enableAndUpdate(); // implicitly enable\n    super.on(eventName, handler);\n  }\n\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void) {\n    this._enableAndUpdate(); // implicitly enable\n    super.off(eventName, handler);\n  }\n\n  /**\n   * Updates Gamepad state and publishes Gamepad events\n   */\n  public update() {\n    if (!this.enabled || !this.supported) {\n      return;\n    }\n    this.init();\n\n    const gamepads = this._navigator.getGamepads();\n\n    for (let i = 0; i < gamepads.length; i++) {\n      if (!gamepads[i]) {\n        const gamepad = this.at(i);\n        // If was connected, but now isn't emit the disconnect event\n        if (gamepad.connected) {\n          this.eventDispatcher.emit('disconnect', new GamepadDisconnectEvent(i, gamepad));\n        }\n        // Reset connection status\n        gamepad.connected = false;\n        continue;\n      } else {\n        if (!this.at(i).connected && this._isGamepadValid(gamepads[i])) {\n          this.eventDispatcher.emit('connect', new GamepadConnectEvent(i, this.at(i)));\n        }\n        // Set connection status\n        this.at(i).connected = true;\n      }\n\n      // Only supported in Chrome\n      if (gamepads[i].timestamp && gamepads[i].timestamp === this._gamePadTimeStamps[i]) {\n        continue;\n      }\n\n      this._gamePadTimeStamps[i] = gamepads[i].timestamp;\n\n      // Add reference to navigator gamepad\n      this.at(i).navigatorGamepad = gamepads[i];\n\n      // Buttons\n      let b: string, bi: number, a: string, ai: number, value: number;\n\n      for (b in Buttons) {\n        bi = <any>Buttons[b];\n        if (typeof bi === 'number') {\n          if (gamepads[i].buttons[bi]) {\n            value = gamepads[i].buttons[bi].value;\n            if (value !== this._oldPads[i].getButton(bi)) {\n              if (gamepads[i].buttons[bi].pressed) {\n                this.at(i).updateButton(bi, value);\n                this.at(i).eventDispatcher.emit('button', new GamepadButtonEvent(bi, value, this.at(i)));\n              } else {\n                this.at(i).updateButton(bi, 0);\n              }\n            }\n          }\n        }\n      }\n\n      // Axes\n      for (a in Axes) {\n        ai = <any>Axes[a];\n        if (typeof ai === 'number') {\n          value = gamepads[i].axes[ai];\n          if (value !== this._oldPads[i].getAxes(ai)) {\n            this.at(i).updateAxes(ai, value);\n            this.at(i).eventDispatcher.emit('axis', new GamepadAxisEvent(ai, value, this.at(i)));\n          }\n        }\n      }\n\n      this._oldPads[i] = this._clonePad(gamepads[i]);\n    }\n  }\n\n  /**\n   * Safely retrieves a Gamepad at a specific index and creates one if it doesn't yet exist\n   */\n  public at(index: number): Gamepad {\n    this._enableAndUpdate(); // implicitly enable gamepads when at() is called\n    if (index >= this._pads.length) {\n      // Ensure there is a pad to retrieve\n      for (let i = this._pads.length - 1, max = index; i < max; i++) {\n        this._pads.push(new Gamepad());\n        this._oldPads.push(new Gamepad());\n      }\n    }\n\n    return this._pads[index];\n  }\n\n  /**\n   * Returns a list of all valid gamepads that meet the minimum configuration requirement.\n   */\n  public getValidGamepads(): Gamepad[] {\n    this._enableAndUpdate();\n    const result: Gamepad[] = [];\n    for (let i = 0; i < this._pads.length; i++) {\n      if (this._isGamepadValid(this.at(i).navigatorGamepad) && this.at(i).connected) {\n        result.push(this.at(i));\n      }\n    }\n    return result;\n  }\n\n  /**\n   * Gets the number of connected gamepads\n   */\n  public count() {\n    return this._pads.filter((p) => p.connected).length;\n  }\n\n  private _clonePads(pads: NavigatorGamepad[]): Gamepad[] {\n    const arr = [];\n    for (let i = 0, len = pads.length; i < len; i++) {\n      arr.push(this._clonePad(pads[i]));\n    }\n    return arr;\n  }\n\n  /**\n   * Fastest way to clone a known object is to do it yourself\n   */\n  private _clonePad(pad: NavigatorGamepad): Gamepad {\n    let i, len;\n    const clonedPad = new Gamepad();\n\n    if (!pad) {\n      return clonedPad;\n    }\n\n    for (i = 0, len = pad.buttons.length; i < len; i++) {\n      if (pad.buttons[i]) {\n        clonedPad.updateButton(i, pad.buttons[i].value);\n      }\n    }\n    for (i = 0, len = pad.axes.length; i < len; i++) {\n      clonedPad.updateAxes(i, pad.axes[i]);\n    }\n\n    return clonedPad;\n  }\n}\n\n/**\n * Gamepad holds state information for a connected controller. See [[Gamepads]]\n * for more information on handling controller input.\n */\nexport class Gamepad extends Class {\n  public connected = false;\n  public navigatorGamepad: NavigatorGamepad;\n  private _buttons: number[] = new Array(16);\n  private _axes: number[] = new Array(4);\n\n  constructor() {\n    super();\n\n    for (let i = 0; i < this._buttons.length; i++) {\n      this._buttons[i] = 0;\n    }\n    for (let i = 0; i < this._axes.length; i++) {\n      this._axes[i] = 0;\n    }\n  }\n\n  /**\n   * Whether or not the given button is pressed\n   * @param button     The button to query\n   * @param threshold  The threshold over which the button is considered to be pressed\n   */\n  public isButtonPressed(button: Buttons, threshold: number = 1) {\n    return this._buttons[button] >= threshold;\n  }\n\n  /**\n   * Gets the given button value between 0 and 1\n   */\n  public getButton(button: Buttons) {\n    return this._buttons[button];\n  }\n\n  /**\n   * Gets the given axis value between -1 and 1. Values below\n   * [[MinAxisMoveThreshold]] are considered 0.\n   */\n  public getAxes(axes: Axes) {\n    const value = this._axes[axes];\n\n    if (Math.abs(value) < Gamepads.MinAxisMoveThreshold) {\n      return 0;\n    } else {\n      return value;\n    }\n  }\n\n  public updateButton(buttonIndex: number, value: number) {\n    this._buttons[buttonIndex] = value;\n  }\n\n  public updateAxes(axesIndex: number, value: number) {\n    this._axes[axesIndex] = value;\n  }\n}\n\n/**\n * Gamepad Buttons enumeration\n */\nexport enum Buttons {\n  /**\n   * Face 1 button (e.g. A)\n   */\n  Face1 = 0,\n  /**\n   * Face 2 button (e.g. B)\n   */\n  Face2 = 1,\n  /**\n   * Face 3 button (e.g. X)\n   */\n  Face3 = 2,\n  /**\n   * Face 4 button (e.g. Y)\n   */\n  Face4 = 3,\n  /**\n   * Left bumper button\n   */\n  LeftBumper = 4,\n  /**\n   * Right bumper button\n   */\n  RightBumper = 5,\n  /**\n   * Left trigger button\n   */\n  LeftTrigger = 6,\n  /**\n   * Right trigger button\n   */\n  RightTrigger = 7,\n  /**\n   * Select button\n   */\n  Select = 8,\n  /**\n   * Start button\n   */\n  Start = 9,\n  /**\n   * Left analog stick press (e.g. L3)\n   */\n  LeftStick = 10,\n  /**\n   * Right analog stick press (e.g. R3)\n   */\n  RightStick = 11,\n  /**\n   * D-pad up\n   */\n  DpadUp = 12,\n  /**\n   * D-pad down\n   */\n  DpadDown = 13,\n  /**\n   * D-pad left\n   */\n  DpadLeft = 14,\n  /**\n   * D-pad right\n   */\n  DpadRight = 15\n}\n\n/**\n * Gamepad Axes enumeration\n */\nexport enum Axes {\n  /**\n   * Left analogue stick X direction\n   */\n  LeftStickX = 0,\n  /**\n   * Left analogue stick Y direction\n   */\n  LeftStickY = 1,\n  /**\n   * Right analogue stick X direction\n   */\n  RightStickX = 2,\n  /**\n   * Right analogue stick Y direction\n   */\n  RightStickY = 3\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepads {\n  getGamepads(): NavigatorGamepad[];\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepad {\n  axes: number[];\n  buttons: NavigatorGamepadButton[];\n  connected: boolean;\n  id: string;\n  index: number;\n  mapping: string;\n  timestamp: number;\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepadButton {\n  pressed: boolean;\n  value: number;\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepadEvent {\n  gamepad: NavigatorGamepad;\n}\n\n/**\n * @internal\n */\nexport interface GamepadConfiguration {\n  axis: number;\n  buttons: number;\n}\n","import { Class } from '../Class';\nimport { Engine, ScrollPreventionMode } from '../Engine';\nimport { Pointer, PointerType } from './Pointer';\nimport {\n  PointerEvent,\n  WheelEvent,\n  NativePointerButton,\n  PointerButton,\n  WheelDeltaMode,\n  createPointerEventByName,\n  PointerLeaveEvent,\n  PointerEnterEvent\n} from './PointerEvents';\nimport { GameEvent } from '../Events';\n\nimport * as Events from '../Events';\nimport * as Util from '../Util/Util';\nimport { GlobalCoordinates, Vector } from '../Algebra';\nimport { CapturePointer } from '../Traits/CapturePointer';\nimport { Actor } from '../Actor';\n\ninterface TouchEvent extends Event {\n  altKey: boolean;\n  changedTouches: Touch[];\n  ctrlKey: boolean;\n  metaKey: boolean;\n  shiftKey: boolean;\n  targetTouches: Touch[];\n  touches: Touch[];\n  type: string;\n  target: Element;\n}\n\ninterface Touch {\n  identifier: number;\n  screenX: number;\n  screenY: number;\n  clientX: number;\n  clientY: number;\n  pageX: number;\n  pageY: number;\n  radiusX: number;\n  radiusY: number;\n  rotationAngle: number;\n  force: number;\n  target: Element;\n}\n\n/**\n * A constant used to normalize wheel events across different browsers\n *\n * This normalization factor is pulled from https://developer.mozilla.org/en-US/docs/Web/Events/wheel#Listening_to_this_event_across_browser\n */\nconst ScrollWheelNormalizationFactor = -1 / 40;\n\n/**\n * Handles pointer events (mouse, touch, stylus, etc.) and normalizes to\n * [W3C Pointer Events](http://www.w3.org/TR/pointerevents/).\n *\n * [[include:Pointers.md]]\n */\nexport class Pointers extends Class {\n  private _engine: Engine;\n\n  private _pointerDown: PointerEvent[] = [];\n  private _pointerUp: PointerEvent[] = [];\n  private _pointerMove: PointerEvent[] = [];\n  private _pointerCancel: PointerEvent[] = [];\n  private _wheel: WheelEvent[] = [];\n  private _pointers: Pointer[] = [];\n  private _activePointers: number[] = [];\n\n  constructor(engine: Engine) {\n    super();\n\n    this._engine = engine;\n    this._pointers.push(new Pointer());\n    this._activePointers = [-1];\n    this.primary = this._pointers[0];\n  }\n\n  public on(eventName: Events.up, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.down, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.move, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.enter, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.leave, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.cancel, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.wheel, handler: (event: WheelEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  /**\n   * Primary pointer (mouse, 1 finger, stylus, etc.)\n   */\n  public primary: Pointer;\n\n  /**\n   * Initializes pointer event listeners\n   */\n  public init(target?: GlobalEventHandlers): void {\n    target = target || this._engine.canvas;\n\n    // Touch Events\n    target.addEventListener('touchstart', this._handleTouchEvent('down', this._pointerDown));\n    target.addEventListener('touchend', this._handleTouchEvent('up', this._pointerUp));\n    target.addEventListener('touchmove', this._handleTouchEvent('move', this._pointerMove));\n    target.addEventListener('touchcancel', this._handleTouchEvent('cancel', this._pointerCancel));\n\n    // W3C Pointer Events\n    // Current: IE11, IE10\n    if ((<any>window).PointerEvent) {\n      // IE11\n      this._engine.canvas.style.touchAction = 'none';\n      target.addEventListener('pointerdown', this._handlePointerEvent('down', this._pointerDown));\n      target.addEventListener('pointerup', this._handlePointerEvent('up', this._pointerUp));\n      target.addEventListener('pointermove', this._handlePointerEvent('move', this._pointerMove));\n      target.addEventListener('pointercancel', this._handlePointerEvent('cancel', this._pointerCancel));\n    } else if ((<any>window).MSPointerEvent) {\n      // IE10\n      this._engine.canvas.style.msTouchAction = 'none';\n      target.addEventListener('MSPointerDown', this._handlePointerEvent('down', this._pointerDown));\n      target.addEventListener('MSPointerUp', this._handlePointerEvent('up', this._pointerUp));\n      target.addEventListener('MSPointerMove', this._handlePointerEvent('move', this._pointerMove));\n      target.addEventListener('MSPointerCancel', this._handlePointerEvent('cancel', this._pointerCancel));\n    } else {\n      // Mouse Events\n      target.addEventListener('mousedown', this._handleMouseEvent('down', this._pointerDown));\n      target.addEventListener('mouseup', this._handleMouseEvent('up', this._pointerUp));\n      target.addEventListener('mousemove', this._handleMouseEvent('move', this._pointerMove));\n    }\n\n    // MDN MouseWheelEvent\n    const wheelOptions = {\n      passive: !(\n        this._engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\n        this._engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas\n      )\n    };\n    if ('onwheel' in document.createElement('div')) {\n      // Modern Browsers\n      target.addEventListener('wheel', this._handleWheelEvent('wheel', this._wheel), wheelOptions);\n    } else if (document.onmousewheel !== undefined) {\n      // Webkit and IE\n      target.addEventListener('mousewheel', this._handleWheelEvent('wheel', this._wheel), wheelOptions);\n    } else {\n      // Remaining browser and older Firefox\n      target.addEventListener('MozMousePixelScroll', this._handleWheelEvent('wheel', this._wheel), wheelOptions);\n    }\n  }\n\n  /**\n   * Synthesize a pointer event that looks like a real browser event to excalibur\n   * @param eventName\n   * @param pos\n   */\n  public triggerEvent(\n    eventName: 'up' | 'down' | 'move' | 'cancel' | 'wheel',\n    pos: Vector | GlobalCoordinates,\n    button: NativePointerButton = NativePointerButton.Left,\n    pointerType: 'mouse' | 'touch' | 'pen' = 'mouse',\n    pointerId: number = 0\n  ): void {\n    let x = 0;\n    let y = 0;\n    let coords: GlobalCoordinates;\n    if (pos instanceof GlobalCoordinates) {\n      x = pos.pagePos.x;\n      y = pos.pagePos.y;\n      coords = pos;\n    } else {\n      x = pos.x;\n      y = pos.y;\n      coords = new GlobalCoordinates(pos.clone(), pos.clone(), pos.clone());\n    }\n\n    const eventish = {\n      pageX: x,\n      pageY: y,\n      pointerId: pointerId,\n      pointerType: pointerType,\n      button: button,\n      preventDefault: () => {\n        /* do nothing */\n      }\n    };\n\n    switch (eventName) {\n      case 'move':\n        this._handlePointerEvent(eventName, this._pointerMove, coords)(eventish as MSPointerEvent);\n        break;\n      case 'down':\n        this._handlePointerEvent(eventName, this._pointerDown, coords)(eventish as MSPointerEvent);\n        break;\n      case 'up':\n        this._handlePointerEvent(eventName, this._pointerUp, coords)(eventish as MSPointerEvent);\n        break;\n      case 'cancel':\n        this._handlePointerEvent(eventName, this._pointerCancel, coords)(eventish as MSPointerEvent);\n        break;\n    }\n    for (const actor of this._engine.currentScene.actors) {\n      const capturePointer = actor.traits.filter((t) => t instanceof CapturePointer)[0];\n      if (capturePointer) {\n        capturePointer.update(actor, this._engine, 1);\n      }\n    }\n    this.dispatchPointerEvents();\n    this.update();\n  }\n\n  /**\n   * Update all pointer events and pointers, meant to be called at the end of frame\n   */\n  public update(): void {\n    this._pointerUp.length = 0;\n    this._pointerDown.length = 0;\n    this._pointerMove.length = 0;\n    this._pointerCancel.length = 0;\n    this._wheel.length = 0;\n\n    for (let i = 0; i < this._pointers.length; i++) {\n      this._pointers[i].update();\n    }\n  }\n\n  /**\n   * Safely gets a Pointer at a specific index and initializes one if it doesn't yet exist\n   * @param index  The pointer index to retrieve\n   */\n  public at(index: number): Pointer {\n    if (index >= this._pointers.length) {\n      // Ensure there is a pointer to retrieve\n      for (let i = this._pointers.length - 1, max = index; i < max; i++) {\n        this._pointers.push(new Pointer());\n        this._activePointers.push(-1);\n      }\n    }\n\n    return this._pointers[index];\n  }\n\n  /**\n   * Get number of pointers being watched\n   */\n  public count(): number {\n    return this._pointers.length;\n  }\n\n  public checkAndUpdateActorUnderPointer(actor: Actor) {\n    for (const pointer of this._pointers) {\n      if (pointer.checkActorUnderPointer(actor)) {\n        pointer.addActorUnderPointer(actor);\n      } else {\n        pointer.removeActorUnderPointer(actor);\n      }\n    }\n  }\n\n  private _dispatchWithBubble(events: PointerEvent[]) {\n    for (const evt of events) {\n      for (const actor of evt.pointer.getActorsForEvents()) {\n        evt.propagate(actor);\n        if (!evt.bubbles) {\n          // if the event stops bubbling part way stop processing\n          break;\n        }\n      }\n    }\n  }\n\n  private _dispatchPointerLeaveEvents() {\n    const lastMoveEventPerPointerPerActor: { [pointerId: string]: PointerEvent } = {};\n    const pointerLeave: PointerLeaveEvent[] = [];\n\n    for (const evt of this._pointerMove) {\n      for (const actor of evt.pointer.getActorsForEvents()) {\n        // If the actor was under the pointer last frame, but not this this frame, pointer left\n        if (\n          !lastMoveEventPerPointerPerActor[evt.pointer.id + '+' + actor.id] &&\n          evt.pointer.wasActorUnderPointer(actor) &&\n          !evt.pointer.isActorUnderPointer(actor)\n        ) {\n          lastMoveEventPerPointerPerActor[evt.pointer.id + '+' + actor.id] = evt;\n          const pe = createPointerEventByName(\n            'leave',\n            new GlobalCoordinates(evt.worldPos, evt.pagePos, evt.screenPos),\n            evt.pointer,\n            evt.index,\n            evt.pointerType,\n            evt.button,\n            evt.ev\n          );\n\n          pe.propagate(actor);\n          pointerLeave.push(<PointerLeaveEvent>pe);\n        }\n      }\n    }\n    return pointerLeave;\n  }\n\n  private _dispatchPointerEnterEvents() {\n    const lastMoveEventPerPointer: { [pointerId: number]: PointerEvent } = {};\n    const pointerEnter: PointerEnterEvent[] = [];\n\n    for (const evt of this._pointerMove) {\n      for (const actor of evt.pointer.getActorsForEvents()) {\n        // If the actor was not under the pointer last frame, but it is this frame, pointer entered\n        if (\n          !lastMoveEventPerPointer[evt.pointer.id] &&\n          !evt.pointer.wasActorUnderPointer(actor) &&\n          evt.pointer.isActorUnderPointer(actor)\n        ) {\n          lastMoveEventPerPointer[evt.pointer.id] = evt;\n          const pe = createPointerEventByName(\n            'enter',\n            new GlobalCoordinates(evt.worldPos, evt.pagePos, evt.screenPos),\n            evt.pointer,\n            evt.index,\n            evt.pointerType,\n            evt.button,\n            evt.ev\n          );\n          pe.propagate(actor);\n          pointerEnter.push(<PointerEnterEvent>pe);\n          // if pointer is dragging set the drag target\n          if (evt.pointer.isDragging) {\n            evt.pointer.dragTarget = actor;\n          }\n        }\n      }\n    }\n    return pointerEnter;\n  }\n\n  public dispatchPointerEvents() {\n    this._dispatchWithBubble(this._pointerDown);\n    this._dispatchWithBubble(this._pointerUp);\n    this._dispatchWithBubble(this._pointerMove);\n    this._dispatchPointerLeaveEvents();\n    this._dispatchPointerEnterEvents();\n    this._dispatchWithBubble(this._pointerCancel);\n\n    // TODO some duplication here\n    for (const evt of this._wheel) {\n      for (const actor of this._pointers[evt.index].getActorsUnderPointer()) {\n        this._propagateWheelPointerEvent(actor, evt);\n        if (!evt.bubbles) {\n          // if the event stops bubbling part way stop processing\n          break;\n        }\n      }\n    }\n  }\n\n  private _propagateWheelPointerEvent(actor: Actor, wheelEvent: WheelEvent) {\n    actor.emit('pointerwheel', wheelEvent);\n\n    // Recurse and propagate\n    if (wheelEvent.bubbles && actor.parent) {\n      this._propagateWheelPointerEvent(actor.parent, wheelEvent);\n    }\n  }\n\n  private _handleMouseEvent(eventName: string, eventArr: PointerEvent[]) {\n    return (e: MouseEvent) => {\n      e.preventDefault();\n\n      const pointer = this.at(0);\n      const coordinates = GlobalCoordinates.fromPagePosition(e.pageX, e.pageY, this._engine);\n      const pe = createPointerEventByName(\n        eventName,\n        coordinates,\n        pointer,\n        0,\n        PointerType.Mouse,\n        this._nativeButtonToPointerButton(e.button),\n        e\n      );\n\n      eventArr.push(pe);\n      pointer.eventDispatcher.emit(eventName, pe);\n    };\n  }\n\n  private _handleTouchEvent(eventName: string, eventArr: PointerEvent[]) {\n    return (e: TouchEvent) => {\n      e.preventDefault();\n      for (let i = 0, len = e.changedTouches.length; i < len; i++) {\n        const index = this._pointers.length > 1 ? this._getPointerIndex(e.changedTouches[i].identifier) : 0;\n        if (index === -1) {\n          continue;\n        }\n\n        const pointer = this.at(index);\n        const coordinates = GlobalCoordinates.fromPagePosition(e.changedTouches[i].pageX, e.changedTouches[i].pageY, this._engine);\n        const pe = createPointerEventByName(eventName, coordinates, pointer, index, PointerType.Touch, PointerButton.Unknown, e);\n\n        eventArr.push(pe);\n        pointer.eventDispatcher.emit(eventName, pe);\n        // only with multi-pointer\n        if (this._pointers.length > 1) {\n          if (eventName === 'up') {\n            // remove pointer ID from pool when pointer is lifted\n            this._activePointers[index] = -1;\n          } else if (eventName === 'down') {\n            // set pointer ID to given index\n            this._activePointers[index] = e.changedTouches[i].identifier;\n          }\n        }\n      }\n    };\n  }\n\n  private _handlePointerEvent(eventName: string, eventArr: PointerEvent[], coords?: GlobalCoordinates) {\n    return (e: MSPointerEvent) => {\n      e.preventDefault();\n\n      // get the index for this pointer ID if multi-pointer is asked for\n      const index = this._pointers.length > 1 ? this._getPointerIndex(e.pointerId) : 0;\n      if (index === -1) {\n        return;\n      }\n\n      const pointer = this.at(index);\n      const coordinates = coords || GlobalCoordinates.fromPagePosition(e.pageX, e.pageY, this._engine);\n      const pe = createPointerEventByName(\n        eventName,\n        coordinates,\n        pointer,\n        index,\n        this._stringToPointerType(e.pointerType),\n        this._nativeButtonToPointerButton(e.button),\n        e\n      );\n\n      eventArr.push(pe);\n      pointer.eventDispatcher.emit(eventName, pe);\n\n      // only with multi-pointer\n      if (this._pointers.length > 1) {\n        if (eventName === 'up') {\n          // remove pointer ID from pool when pointer is lifted\n          this._activePointers[index] = -1;\n        } else if (eventName === 'down') {\n          // set pointer ID to given index\n          this._activePointers[index] = e.pointerId;\n        }\n      }\n    };\n  }\n\n  private _handleWheelEvent(eventName: string, eventArr: WheelEvent[]) {\n    return (e: MouseWheelEvent) => {\n      // Should we prevent page scroll because of this event\n      if (\n        this._engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\n        (this._engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas && e.target === this._engine.canvas)\n      ) {\n        e.preventDefault();\n      }\n\n      const x: number = e.pageX - Util.getPosition(this._engine.canvas).x;\n      const y: number = e.pageY - Util.getPosition(this._engine.canvas).y;\n      const transformedPoint = this._engine.screenToWorldCoordinates(new Vector(x, y));\n\n      // deltaX, deltaY, and deltaZ are the standard modern properties\n      // wheelDeltaX, wheelDeltaY, are legacy properties in webkit browsers and older IE\n      // e.detail is only used in opera\n\n      const deltaX = e.deltaX || e.wheelDeltaX * ScrollWheelNormalizationFactor || 0;\n      const deltaY =\n        e.deltaY || e.wheelDeltaY * ScrollWheelNormalizationFactor || e.wheelDelta * ScrollWheelNormalizationFactor || e.detail || 0;\n      const deltaZ = e.deltaZ || 0;\n      let deltaMode = WheelDeltaMode.Pixel;\n\n      if (e.deltaMode) {\n        if (e.deltaMode === 1) {\n          deltaMode = WheelDeltaMode.Line;\n        } else if (e.deltaMode === 2) {\n          deltaMode = WheelDeltaMode.Page;\n        }\n      }\n\n      const we = new WheelEvent(transformedPoint.x, transformedPoint.y, e.pageX, e.pageY, x, y, 0, deltaX, deltaY, deltaZ, deltaMode, e);\n\n      eventArr.push(we);\n      this.at(0).eventDispatcher.emit(eventName, we);\n    };\n  }\n\n  /**\n   * Gets the index of the pointer specified for the given pointer ID or finds the next empty pointer slot available.\n   * This is required because IE10/11 uses incrementing pointer IDs so we need to store a mapping of ID => idx\n   */\n  private _getPointerIndex(pointerId: number) {\n    let idx;\n    if ((idx = this._activePointers.indexOf(pointerId)) > -1) {\n      return idx;\n    }\n\n    for (let i = 0; i < this._activePointers.length; i++) {\n      if (this._activePointers[i] === -1) {\n        return i;\n      }\n    }\n\n    // ignore pointer because game isn't watching\n    return -1;\n  }\n\n  private _nativeButtonToPointerButton(s: NativePointerButton): PointerButton {\n    switch (s) {\n      case NativePointerButton.NoButton:\n        return PointerButton.NoButton;\n      case NativePointerButton.Left:\n        return PointerButton.Left;\n      case NativePointerButton.Middle:\n        return PointerButton.Middle;\n      case NativePointerButton.Right:\n        return PointerButton.Right;\n      case NativePointerButton.Unknown:\n        return PointerButton.Unknown;\n      default:\n        return Util.fail(s);\n    }\n  }\n\n  private _stringToPointerType(s: string) {\n    switch (s) {\n      case 'touch':\n        return PointerType.Touch;\n      case 'mouse':\n        return PointerType.Mouse;\n      case 'pen':\n        return PointerType.Pen;\n      default:\n        return PointerType.Unknown;\n    }\n  }\n}\n","export interface NativeEventable {\n  addEventListener(name: string, handler: (...any: any[]) => any): any;\n  removeEventListener(name: string, handler: (...any: any[]) => any): any;\n}\n\nexport class BrowserComponent<T extends NativeEventable> {\n  private _paused = false;\n  private _nativeHandlers: { [key: string]: (handler: any) => void } = {};\n\n  on(eventName: string, handler: (evt: any) => void): void {\n    if (this._nativeHandlers[eventName]) {\n      this.off(eventName, this._nativeHandlers[eventName]);\n    }\n    this._nativeHandlers[eventName] = this._decorate(handler);\n    this.nativeComponent.addEventListener(eventName, this._nativeHandlers[eventName]);\n  }\n  off(eventName: string, handler?: (event: any) => void): void {\n    if (!handler) {\n      handler = this._nativeHandlers[eventName];\n    }\n    this.nativeComponent.removeEventListener(eventName, handler);\n    this._nativeHandlers[eventName] = null;\n  }\n\n  private _decorate(handler: (evt: any) => void): (evt: any) => void {\n    return (evt: any) => {\n      if (!this._paused) {\n        handler(evt);\n      }\n    };\n  }\n\n  public pause() {\n    this._paused = true;\n  }\n\n  public resume() {\n    this._paused = false;\n  }\n\n  public clear() {\n    for (const event in this._nativeHandlers) {\n      this.off(event);\n    }\n  }\n\n  constructor(public nativeComponent: T) {}\n}\n\nexport class BrowserEvents {\n  private _windowComponent: BrowserComponent<Window>;\n  private _documentComponent: BrowserComponent<Document>;\n  constructor(private _windowGlobal: Window, private _documentGlobal: Document) {\n    this._windowComponent = new BrowserComponent(this._windowGlobal);\n    this._documentComponent = new BrowserComponent(this._documentGlobal);\n  }\n\n  public get window(): BrowserComponent<Window> {\n    return this._windowComponent;\n  }\n\n  public get document(): BrowserComponent<Document> {\n    return this._documentComponent;\n  }\n\n  public pause() {\n    this.window.pause();\n    this.document.pause();\n  }\n\n  public resume() {\n    this.window.resume();\n    this.document.resume();\n  }\n\n  public clear() {\n    this.window.clear();\n    this.document.clear();\n  }\n}\n","import { EX_VERSION } from './';\nimport { polyfill } from './Polyfill';\npolyfill();\nimport { CanUpdate, CanDraw, CanInitialize } from './Interfaces/LifecycleEvents';\nimport { Loadable } from './Interfaces/Loadable';\nimport { Promise } from './Promises';\nimport { Vector } from './Algebra';\nimport { ScreenElement } from './ScreenElement';\nimport { Actor } from './Actor';\nimport { Timer } from './Timer';\nimport { TileMap } from './TileMap';\nimport { Animation } from './Drawing/Animation';\nimport { Loader } from './Loader';\nimport { Detector } from './Util/Detector';\nimport {\n  VisibleEvent,\n  HiddenEvent,\n  GameStartEvent,\n  GameStopEvent,\n  PreUpdateEvent,\n  PostUpdateEvent,\n  PreFrameEvent,\n  PostFrameEvent,\n  GameEvent,\n  DeactivateEvent,\n  ActivateEvent,\n  PreDrawEvent,\n  PostDrawEvent,\n  InitializeEvent\n} from './Events';\nimport { CanLoad } from './Interfaces/Loader';\nimport { Logger, LogLevel } from './Util/Log';\nimport { Color } from './Drawing/Color';\nimport { Scene } from './Scene';\nimport { PostProcessor } from './PostProcessing/PostProcessor';\nimport { Debug, DebugStats } from './Debug';\nimport { Class } from './Class';\nimport * as Input from './Input/Index';\nimport * as Events from './Events';\nimport { BoundingBox } from './Collision/BoundingBox';\nimport { BrowserEvents } from './Util/Browser';\n\n/**\n * Enum representing the different display modes available to Excalibur\n */\nexport enum DisplayMode {\n  /**\n   * Show the game as full screen\n   */\n  FullScreen,\n  /**\n   * Scale the game to the parent DOM container\n   */\n  Container,\n  /**\n   * Show the game as a fixed size\n   */\n  Fixed,\n\n  /**\n   * Allow the game to be positioned with the [[EngineOptions.position]] option\n   */\n  Position\n}\n\n/**\n * Enum representing the different mousewheel event bubble prevention\n */\nexport enum ScrollPreventionMode {\n  /**\n   * Do not prevent any page scrolling\n   */\n  None,\n  /**\n   * Prevent page scroll if mouse is over the game canvas\n   */\n  Canvas,\n  /**\n   * Prevent all page scrolling via mouse wheel\n   */\n  All\n}\n\n/**\n * Interface describing the absolute CSS position of the game window. For use when [[DisplayMode.Position]]\n * is specified and when the user wants to define exact pixel spacing of the window.\n * When a number is given, the value is interpreted as pixels\n */\nexport interface AbsolutePosition {\n  top?: number | string;\n  left?: number | string;\n  right?: number | string;\n  bottom?: number | string;\n}\n\n/**\n * Defines the available options to configure the Excalibur engine at constructor time.\n */\nexport interface EngineOptions {\n  /**\n   * Optionally configure the native canvas width of the game\n   */\n  width?: number;\n\n  /**\n   * Optionally configure the native canvas height of the game\n   */\n  height?: number;\n\n  /**\n   * Optionally configure the native canvas transparent backdrop\n   */\n  enableCanvasTransparency?: boolean;\n\n  /**\n   * Optionally specify the target canvas DOM element to render the game in\n   */\n  canvasElementId?: string;\n\n  /**\n   * Optionally specify the target canvas DOM element directly\n   */\n  canvasElement?: HTMLCanvasElement;\n\n  /**\n   * The [[DisplayMode]] of the game. Depending on this value, [[width]] and [[height]] may be ignored.\n   */\n  displayMode?: DisplayMode;\n\n  /**\n   * Configures the pointer scope. Pointers scoped to the 'Canvas' can only fire events within the canvas viewport; whereas, 'Document'\n   * (default) scoped will fire anywhere on the page.\n   */\n  pointerScope?: Input.PointerScope;\n\n  /**\n   * Suppress boot up console message, which contains the \"powered by Excalibur message\"\n   */\n  suppressConsoleBootMessage?: boolean;\n\n  /**\n   * Suppress minimum browser feature detection, it is not recommended users of excalibur switch this off. This feature ensures that\n   * the currently running browser meets the minimum requirements for running excalibur. This can be useful if running on non-standard\n   * browsers or if there is a bug in excalibur preventing execution.\n   */\n  suppressMinimumBrowserFeatureDetection?: boolean;\n\n  /**\n   * Suppress HiDPI auto detection and scaling, it is not recommended users of excalibur switch off this feature. This feature detects\n   * and scales the drawing canvas appropriately to accommodate HiDPI screens.\n   */\n  suppressHiDPIScaling?: boolean;\n\n  /**\n   * Suppress play button, it is not recommended users of excalibur switch this feature. Some browsers require a user gesture (like a click)\n   * for certain browser features to work like web audio.\n   */\n  suppressPlayButton?: boolean;\n\n  /**\n   * Specify how the game window is to be positioned when the [[DisplayMode.Position]] is chosen. This option MUST be specified\n   * if the DisplayMode is set as [[DisplayMode.Position]]. The position can be either a string or an [[AbsolutePosition]].\n   * String must be in the format of css style background-position. The vertical position must precede the horizontal position in strings.\n   *\n   * Valid String examples: \"top left\", \"top\", \"bottom\", \"middle\", \"middle center\", \"bottom right\"\n   * Valid [[AbsolutePosition]] examples: `{top: 5, right: 10%}`, `{bottom: 49em, left: 10px}`, `{left: 10, bottom: 40}`\n   */\n  position?: string | AbsolutePosition;\n\n  /**\n   * Scroll prevention method.\n   */\n  scrollPreventionMode?: ScrollPreventionMode;\n\n  /**\n   * Optionally set the background color\n   */\n  backgroundColor?: Color;\n}\n\n/**\n * The Excalibur Engine\n *\n * The [[Engine]] is the main driver for a game. It is responsible for\n * starting/stopping the game, maintaining state, transmitting events,\n * loading resources, and managing the scene.\n *\n * [[include:Engine.md]]\n */\nexport class Engine extends Class implements CanInitialize, CanUpdate, CanDraw {\n  /**\n   *\n   */\n  public browser: BrowserEvents;\n\n  /**\n   * Direct access to the engine's canvas element\n   */\n  public canvas: HTMLCanvasElement;\n\n  /**\n   * Direct access to the engine's 2D rendering context\n   */\n  public ctx: CanvasRenderingContext2D;\n\n  /**\n   * Direct access to the canvas element ID, if an ID exists\n   */\n  public canvasElementId: string;\n\n  /**\n   * The width of the game canvas in pixels (physical width component of the\n   * resolution of the canvas element)\n   */\n  public get canvasWidth(): number {\n    return this.canvas.width;\n  }\n\n  /**\n   * Returns half width of the game canvas in pixels (half physical width component)\n   */\n  public get halfCanvasWidth(): number {\n    return this.canvas.width / 2;\n  }\n\n  /**\n   * The height of the game canvas in pixels, (physical height component of\n   * the resolution of the canvas element)\n   */\n  public get canvasHeight(): number {\n    return this.canvas.height;\n  }\n\n  /**\n   * Returns half height of the game canvas in pixels (half physical height component)\n   */\n  public get halfCanvasHeight(): number {\n    return this.canvas.height / 2;\n  }\n\n  /**\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get drawWidth(): number {\n    if (this.currentScene && this.currentScene.camera) {\n      return this.canvasWidth / this.currentScene.camera.getZoom() / this.pixelRatio;\n    }\n    return this.canvasWidth / this.pixelRatio;\n  }\n\n  /**\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get halfDrawWidth(): number {\n    return this.drawWidth / 2;\n  }\n\n  /**\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get drawHeight(): number {\n    if (this.currentScene && this.currentScene.camera) {\n      return this.canvasHeight / this.currentScene.camera.getZoom() / this.pixelRatio;\n    }\n    return this.canvasHeight / this.pixelRatio;\n  }\n\n  /**\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get halfDrawHeight(): number {\n    return this.drawHeight / 2;\n  }\n\n  /**\n   * Returns whether excalibur detects the current screen to be HiDPI\n   */\n  public get isHiDpi(): boolean {\n    return this.pixelRatio !== 1;\n  }\n\n  /**\n   * Access engine input like pointer, keyboard, or gamepad\n   */\n  public input: Input.EngineInput;\n\n  private _hasStarted: boolean = false;\n\n  /**\n   * Access Excalibur debugging functionality.\n   */\n  public debug = new Debug();\n\n  /**\n   * Access [[stats]] that holds frame statistics.\n   */\n  public get stats(): DebugStats {\n    return this.debug.stats;\n  }\n\n  /**\n   * Gets or sets the list of post processors to apply at the end of drawing a frame (such as [[ColorBlindCorrector]])\n   */\n  public postProcessors: PostProcessor[] = [];\n\n  /**\n   * The current [[Scene]] being drawn and updated on screen\n   */\n  public currentScene: Scene;\n\n  /**\n   * The default [[Scene]] of the game, use [[Engine.goToScene]] to transition to different scenes.\n   */\n  public rootScene: Scene;\n\n  /**\n   * Contains all the scenes currently registered with Excalibur\n   */\n  public scenes: { [key: string]: Scene } = {};\n\n  private _animations: AnimationNode[] = [];\n\n  /**\n   * Indicates whether the engine is set to fullscreen or not\n   */\n  public isFullscreen: boolean = false;\n\n  /**\n   * Indicates the current [[DisplayMode]] of the engine.\n   */\n  public displayMode: DisplayMode = DisplayMode.FullScreen;\n\n  private _suppressHiDPIScaling: boolean = false;\n\n  private _suppressPlayButton: boolean = false;\n  /**\n   * Returns the calculated pixel ration for use in rendering\n   */\n  public get pixelRatio(): number {\n    if (this._suppressHiDPIScaling) {\n      return 1;\n    }\n\n    if (window.devicePixelRatio < 1) {\n      return 1;\n    }\n\n    const devicePixelRatio = window.devicePixelRatio || 1;\n\n    const pixelRatio = devicePixelRatio;\n    return pixelRatio;\n  }\n\n  /**\n   * Indicates the current position of the engine. Valid only when DisplayMode is DisplayMode.Position\n   */\n  public position: string | AbsolutePosition;\n  /**\n   * Indicates whether audio should be paused when the game is no longer visible.\n   */\n  public pauseAudioWhenHidden: boolean = true;\n\n  /**\n   * Indicates whether the engine should draw with debug information\n   */\n  public isDebug: boolean = false;\n  public debugColor: Color = new Color(255, 255, 255);\n  /**\n   * Sets the background color for the engine.\n   */\n  public backgroundColor: Color;\n\n  /**\n   * Sets the Transparency for the engine.\n   */\n  public enableCanvasTransparency: boolean = true;\n\n  /**\n   * The action to take when a fatal exception is thrown\n   */\n  public onFatalException = (e: any) => {\n    Logger.getInstance().fatal(e);\n  };\n\n  /**\n   * The mouse wheel scroll prevention mode\n   */\n  public pageScrollPreventionMode: ScrollPreventionMode;\n\n  private _logger: Logger;\n  private _isSmoothingEnabled: boolean = true;\n\n  // this is a reference to the current requestAnimationFrame return value\n  private _requestId: number;\n\n  // this determines whether excalibur is compatible with your browser\n  private _compatible: boolean;\n\n  private _timescale: number = 1.0;\n\n  // loading\n  private _loader: CanLoad;\n  private _isLoading: boolean = false;\n\n  private _isInitialized: boolean = false;\n\n  public on(eventName: Events.initialize, handler: (event: Events.InitializeEvent) => void): void;\n  public on(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\n  public on(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\n  public on(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\n  public on(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent) => void): void;\n  public on(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\n  public on(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  public once(eventName: Events.initialize, handler: (event: Events.InitializeEvent) => void): void;\n  public once(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\n  public once(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\n  public once(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\n  public once(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent) => void): void;\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent) => void): void;\n  public once(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\n  public once(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent) => void): void;\n  public off(eventName: Events.visible, handler?: (event: VisibleEvent) => void): void;\n  public off(eventName: Events.hidden, handler?: (event: HiddenEvent) => void): void;\n  public off(eventName: Events.start, handler?: (event: GameStartEvent) => void): void;\n  public off(eventName: Events.stop, handler?: (event: GameStopEvent) => void): void;\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent) => void): void;\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent) => void): void;\n  public off(eventName: Events.preframe, handler?: (event: PreFrameEvent) => void): void;\n  public off(eventName: Events.postframe, handler?: (event: PostFrameEvent) => void): void;\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\n  public off(eventName: string, handler?: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  /**\n   * Default [[EngineOptions]]\n   */\n  private static _DefaultEngineOptions: EngineOptions = {\n    width: 0,\n    height: 0,\n    enableCanvasTransparency: true,\n    canvasElementId: '',\n    canvasElement: undefined,\n    pointerScope: Input.PointerScope.Document,\n    suppressConsoleBootMessage: null,\n    suppressMinimumBrowserFeatureDetection: null,\n    suppressHiDPIScaling: null,\n    suppressPlayButton: null,\n    scrollPreventionMode: ScrollPreventionMode.Canvas,\n    backgroundColor: Color.fromHex('#2185d0') // Excalibur blue\n  };\n\n  /**\n   * Creates a new game using the given [[EngineOptions]]. By default, if no options are provided,\n   * the game will be rendered full screen (taking up all available browser window space).\n   * You can customize the game rendering through [[EngineOptions]].\n   *\n   * Example:\n   *\n   * ```js\n   * var game = new ex.Engine({\n   *   width: 0, // the width of the canvas\n   *   height: 0, // the height of the canvas\n   *   enableCanvasTransparency: true, // the transparencySection of the canvas\n   *   canvasElementId: '', // the DOM canvas element ID, if you are providing your own\n   *   displayMode: ex.DisplayMode.FullScreen, // the display mode\n   *   pointerScope: ex.Input.PointerScope.Document, // the scope of capturing pointer (mouse/touch) events\n   *   backgroundColor: ex.Color.fromHex('#2185d0') // background color of the engine\n   * });\n   *\n   * // call game.start, which is a Promise\n   * game.start().then(function () {\n   *   // ready, set, go!\n   * });\n   * ```\n   */\n  constructor(options?: EngineOptions) {\n    super();\n\n    options = { ...Engine._DefaultEngineOptions, ...options };\n\n    // Initialize browser events facade\n    this.browser = new BrowserEvents(window, document);\n\n    // Check compatibility\n    const detector = new Detector();\n    if (!options.suppressMinimumBrowserFeatureDetection && !(this._compatible = detector.test())) {\n      const message = document.createElement('div');\n      message.innerText = 'Sorry, your browser does not support all the features needed for Excalibur';\n      document.body.appendChild(message);\n\n      detector.failedTests.forEach(function(test) {\n        const testMessage = document.createElement('div');\n        testMessage.innerText = 'Browser feature missing ' + test;\n        document.body.appendChild(testMessage);\n      });\n\n      if (options.canvasElementId) {\n        const canvas = document.getElementById(options.canvasElementId);\n        if (canvas) {\n          canvas.parentElement.removeChild(canvas);\n        }\n      }\n\n      return;\n    } else {\n      this._compatible = true;\n    }\n\n    // Use native console API for color fun\n    // eslint-disable-next-line no-console\n    if (console.log && !options.suppressConsoleBootMessage) {\n      // eslint-disable-next-line no-console\n      console.log(\n        `%cPowered by Excalibur.js (v${EX_VERSION})`,\n        'background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;'\n      );\n      // eslint-disable-next-line no-console\n      console.log('\\n\\\n      /| ________________\\n\\\nO|===|* >________________>\\n\\\n      \\\\|');\n      // eslint-disable-next-line no-console\n      console.log('Visit', 'http://excaliburjs.com', 'for more information');\n    }\n\n    // Suppress play button\n    if (options.suppressPlayButton) {\n      this._suppressPlayButton = true;\n    }\n\n    this._logger = Logger.getInstance();\n\n    // If debug is enabled, let's log browser features to the console.\n    if (this._logger.defaultLevel === LogLevel.Debug) {\n      detector.logBrowserFeatures();\n    }\n\n    this._logger.debug('Building engine...');\n\n    this.canvasElementId = options.canvasElementId;\n\n    if (options.canvasElementId) {\n      this._logger.debug('Using Canvas element specified: ' + options.canvasElementId);\n      this.canvas = <HTMLCanvasElement>document.getElementById(options.canvasElementId);\n    } else if (options.canvasElement) {\n      this._logger.debug('Using Canvas element specified:', options.canvasElement);\n      this.canvas = options.canvasElement;\n    } else {\n      this._logger.debug('Using generated canvas element');\n      this.canvas = <HTMLCanvasElement>document.createElement('canvas');\n    }\n    if (options.width && options.height) {\n      if (options.displayMode === undefined) {\n        this.displayMode = DisplayMode.Fixed;\n      }\n      this._logger.debug('Engine viewport is size ' + options.width + ' x ' + options.height);\n\n      this.canvas.width = options.width;\n      this.canvas.height = options.height;\n    } else if (!options.displayMode) {\n      this._logger.debug('Engine viewport is fullscreen');\n      this.displayMode = DisplayMode.FullScreen;\n    }\n\n    if (options.backgroundColor) {\n      this.backgroundColor = options.backgroundColor.clone();\n    }\n\n    this.enableCanvasTransparency = options.enableCanvasTransparency;\n\n    this._loader = new Loader();\n\n    this._initialize(options);\n\n    this.rootScene = this.currentScene = new Scene(this);\n\n    this.addScene('root', this.rootScene);\n    this.goToScene('root');\n  }\n\n  /**\n   * Returns a BoundingBox of the top left corner of the screen\n   * and the bottom right corner of the screen.\n   */\n  public getWorldBounds() {\n    const left = this.screenToWorldCoordinates(Vector.Zero).x;\n    const top = this.screenToWorldCoordinates(Vector.Zero).y;\n    const right = left + this.drawWidth;\n    const bottom = top + this.drawHeight;\n\n    return new BoundingBox(left, top, right, bottom);\n  }\n\n  /**\n   * Gets the current engine timescale factor (default is 1.0 which is 1:1 time)\n   */\n  public get timescale() {\n    return this._timescale;\n  }\n\n  /**\n   * Sets the current engine timescale factor. Useful for creating slow-motion effects or fast-forward effects\n   * when using time-based movement.\n   */\n  public set timescale(value: number) {\n    if (value <= 0) {\n      Logger.getInstance().error('Cannot set engine.timescale to a value of 0 or less than 0.');\n      return;\n    }\n\n    this._timescale = value;\n  }\n\n  /**\n   * Plays a sprite animation on the screen at the specified `x` and `y`\n   * (in game coordinates, not screen pixels). These animations play\n   * independent of actors, and will be cleaned up internally as soon\n   * as they are complete. Note animations that loop will never be\n   * cleaned up.\n   *\n   * @param animation  Animation to play\n   * @param x          x game coordinate to play the animation\n   * @param y          y game coordinate to play the animation\n   */\n  public playAnimation(animation: Animation, x: number, y: number) {\n    this._animations.push(new AnimationNode(animation, x, y));\n  }\n\n  /**\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\n   * will be drawn and updated.\n   */\n  public addTileMap(tileMap: TileMap) {\n    this.currentScene.addTileMap(tileMap);\n  }\n\n  /**\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\n   */\n  public removeTileMap(tileMap: TileMap) {\n    this.currentScene.removeTileMap(tileMap);\n  }\n\n  /**\n   * Adds a [[Timer]] to the [[currentScene]].\n   * @param timer  The timer to add to the [[currentScene]].\n   */\n  public addTimer(timer: Timer): Timer {\n    return this.currentScene.addTimer(timer);\n  }\n\n  /**\n   * Removes a [[Timer]] from the [[currentScene]].\n   * @param timer  The timer to remove to the [[currentScene]].\n   */\n  public removeTimer(timer: Timer): Timer {\n    return this.currentScene.removeTimer(timer);\n  }\n\n  /**\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\n   * would levels or menus.\n   *\n   * @param key  The name of the scene, must be unique\n   * @param scene The scene to add to the engine\n   */\n  public addScene(key: string, scene: Scene) {\n    if (this.scenes[key]) {\n      this._logger.warn('Scene', key, 'already exists overwriting');\n    }\n    this.scenes[key] = scene;\n  }\n\n  /**\n   * Removes a [[Scene]] instance from the engine\n   * @param scene  The scene to remove\n   */\n  public removeScene(scene: Scene): void;\n  /**\n   * Removes a scene from the engine by key\n   * @param key  The scene key to remove\n   */\n  public removeScene(key: string): void;\n  /**\n   * @internal\n   */\n  public removeScene(entity: any): void {\n    if (entity instanceof Scene) {\n      // remove scene\n      for (const key in this.scenes) {\n        if (this.scenes.hasOwnProperty(key)) {\n          if (this.scenes[key] === entity) {\n            delete this.scenes[key];\n          }\n        }\n      }\n    }\n\n    if (typeof entity === 'string') {\n      // remove scene\n      delete this.scenes[entity];\n    }\n  }\n\n  /**\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\n   * would levels or menus.\n   * @param sceneKey  The key of the scene, must be unique\n   * @param scene     The scene to add to the engine\n   */\n  public add(sceneKey: string, scene: Scene): void;\n  /**\n   * Adds a [[Timer]] to the [[currentScene]].\n   * @param timer  The timer to add to the [[currentScene]].\n   */\n  public add(timer: Timer): void;\n  /**\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\n   * will be drawn and updated.\n   */\n  public add(tileMap: TileMap): void;\n  /**\n   * Adds an actor to the [[currentScene]] of the game. This is synonymous\n   * to calling `engine.currentScene.add(actor)`.\n   *\n   * Actors can only be drawn if they are a member of a scene, and only\n   * the [[currentScene]] may be drawn or updated.\n   *\n   * @param actor  The actor to add to the [[currentScene]]\n   */\n  public add(actor: Actor): void;\n\n  /**\n   * Adds a [[ScreenElement]] to the [[currentScene]] of the game,\n   * ScreenElements do not participate in collisions, instead the\n   * remain in the same place on the screen.\n   * @param screenElement  The ScreenElement to add to the [[currentScene]]\n   */\n  public add(screenElement: ScreenElement): void;\n  public add(entity: any): void {\n    if (entity instanceof ScreenElement) {\n      this.currentScene.addScreenElement(entity);\n      return;\n    }\n    if (entity instanceof Actor) {\n      this._addChild(entity);\n    }\n    if (entity instanceof Timer) {\n      this.addTimer(entity);\n    }\n\n    if (entity instanceof TileMap) {\n      this.addTileMap(entity);\n    }\n\n    if (arguments.length === 2) {\n      this.addScene(<string>arguments[0], <Scene>arguments[1]);\n    }\n  }\n\n  /**\n   * Removes a scene instance from the engine\n   * @param scene  The scene to remove\n   */\n  public remove(scene: Scene): void;\n  /**\n   * Removes a scene from the engine by key\n   * @param sceneKey  The scene to remove\n   */\n  public remove(sceneKey: string): void;\n  /**\n   * Removes a [[Timer]] from the [[currentScene]].\n   * @param timer  The timer to remove to the [[currentScene]].\n   */\n  public remove(timer: Timer): void;\n  /**\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\n   */\n  public remove(tileMap: TileMap): void;\n  /**\n   * Removes an actor from the [[currentScene]] of the game. This is synonymous\n   * to calling `engine.currentScene.removeChild(actor)`.\n   * Actors that are removed from a scene will no longer be drawn or updated.\n   *\n   * @param actor  The actor to remove from the [[currentScene]].\n   */\n  public remove(actor: Actor): void;\n  /**\n   * Removes a [[ScreenElement]] to the scene, it will no longer be drawn or updated\n   * @param screenElement  The ScreenElement to remove from the [[currentScene]]\n   */\n  public remove(screenElement: ScreenElement): void;\n  public remove(entity: any): void {\n    if (entity instanceof ScreenElement) {\n      this.currentScene.removeScreenElement(entity);\n      return;\n    }\n    if (entity instanceof Actor) {\n      this._removeChild(entity);\n    }\n    if (entity instanceof Timer) {\n      this.removeTimer(entity);\n    }\n\n    if (entity instanceof TileMap) {\n      this.removeTileMap(entity);\n    }\n\n    if (entity instanceof Scene) {\n      this.removeScene(entity);\n    }\n\n    if (typeof entity === 'string') {\n      this.removeScene(entity);\n    }\n  }\n\n  /**\n   * Adds an actor to the [[currentScene]] of the game. This is synonymous\n   * to calling `engine.currentScene.add(actor)`.\n   *\n   * Actors can only be drawn if they are a member of a scene, and only\n   * the [[currentScene]] may be drawn or updated.\n   *\n   * @param actor  The actor to add to the [[currentScene]]\n   */\n  protected _addChild(actor: Actor) {\n    this.currentScene.add(actor);\n  }\n\n  /**\n   * Removes an actor from the [[currentScene]] of the game. This is synonymous\n   * to calling `engine.currentScene.remove(actor)`.\n   * Actors that are removed from a scene will no longer be drawn or updated.\n   *\n   * @param actor  The actor to remove from the [[currentScene]].\n   */\n  protected _removeChild(actor: Actor) {\n    this.currentScene.remove(actor);\n  }\n\n  /**\n   * Changes the currently updating and drawing scene to a different,\n   * named scene. Calls the [[Scene]] lifecycle events.\n   * @param key  The key of the scene to transition to.\n   */\n  public goToScene(key: string) {\n    if (this.scenes[key]) {\n      const oldScene = this.currentScene;\n      const newScene = this.scenes[key];\n\n      this._logger.debug('Going to scene:', key);\n\n      // only deactivate when initialized\n      if (this.currentScene.isInitialized) {\n        this.currentScene._deactivate.call(this.currentScene, [oldScene, newScene]);\n        this.currentScene.eventDispatcher.emit('deactivate', new DeactivateEvent(newScene, this.currentScene));\n      }\n\n      // set current scene to new one\n      this.currentScene = newScene;\n\n      // initialize the current scene if has not been already\n      this.currentScene._initialize(this);\n\n      this.currentScene._activate.call(this.currentScene, [oldScene, newScene]);\n      this.currentScene.eventDispatcher.emit('activate', new ActivateEvent(oldScene, this.currentScene));\n    } else {\n      this._logger.error('Scene', key, 'does not exist!');\n    }\n  }\n\n  /**\n   * Transforms the current x, y from screen coordinates to world coordinates\n   * @param point  Screen coordinate to convert\n   */\n  public screenToWorldCoordinates(point: Vector): Vector {\n    let newX = point.x;\n    let newY = point.y;\n\n    // transform back to world space\n    newX = (newX / this.canvas.clientWidth) * this.drawWidth;\n    newY = (newY / this.canvas.clientHeight) * this.drawHeight;\n\n    // transform based on zoom\n    newX = newX - this.halfDrawWidth;\n    newY = newY - this.halfDrawHeight;\n\n    // shift by focus\n    if (this.currentScene && this.currentScene.camera) {\n      const focus = this.currentScene.camera.getFocus();\n      newX += focus.x;\n      newY += focus.y;\n    }\n\n    return new Vector(Math.floor(newX), Math.floor(newY));\n  }\n\n  /**\n   * Transforms a world coordinate, to a screen coordinate\n   * @param point  World coordinate to convert\n   */\n  public worldToScreenCoordinates(point: Vector): Vector {\n    let screenX = point.x;\n    let screenY = point.y;\n\n    // shift by focus\n    if (this.currentScene && this.currentScene.camera) {\n      const focus = this.currentScene.camera.getFocus();\n      screenX -= focus.x;\n      screenY -= focus.y;\n    }\n\n    // transform back on zoom\n    screenX = screenX + this.halfDrawWidth;\n    screenY = screenY + this.halfDrawHeight;\n\n    // transform back to screen space\n    screenX = (screenX * this.canvas.clientWidth) / this.drawWidth;\n    screenY = (screenY * this.canvas.clientHeight) / this.drawHeight;\n\n    return new Vector(Math.floor(screenX), Math.floor(screenY));\n  }\n\n  /**\n   * Sets the internal canvas height based on the selected display mode.\n   */\n  private _setHeightByDisplayMode(parent: HTMLElement | Window) {\n    if (this.displayMode === DisplayMode.Container) {\n      this.canvas.width = (<HTMLElement>parent).clientWidth;\n      this.canvas.height = (<HTMLElement>parent).clientHeight;\n    }\n\n    if (this.displayMode === DisplayMode.FullScreen) {\n      document.body.style.margin = '0px';\n      document.body.style.overflow = 'hidden';\n      this.canvas.width = (<Window>parent).innerWidth;\n      this.canvas.height = (<Window>parent).innerHeight;\n    }\n  }\n\n  /**\n   * Initializes the internal canvas, rendering context, display mode, and native event listeners\n   */\n  private _initialize(options?: EngineOptions) {\n    if (options.displayMode) {\n      this.displayMode = options.displayMode;\n    }\n\n    if (this.displayMode === DisplayMode.FullScreen || this.displayMode === DisplayMode.Container) {\n      const parent = <any>(this.displayMode === DisplayMode.Container ? <any>(this.canvas.parentElement || document.body) : <any>window);\n\n      this._setHeightByDisplayMode(parent);\n\n      this.browser.window.on('resize', () => {\n        this._logger.debug('View port resized');\n        this._setHeightByDisplayMode(parent);\n        this._logger.info('parent.clientHeight ' + parent.clientHeight);\n        this.setAntialiasing(this._isSmoothingEnabled);\n      });\n    } else if (this.displayMode === DisplayMode.Position) {\n      this._initializeDisplayModePosition(options);\n    }\n\n    this.pageScrollPreventionMode = options.scrollPreventionMode;\n\n    // initialize inputs\n    this.input = {\n      keyboard: new Input.Keyboard(),\n      pointers: new Input.Pointers(this),\n      gamepads: new Input.Gamepads()\n    };\n    this.input.keyboard.init();\n    this.input.pointers.init(options && options.pointerScope === Input.PointerScope.Document ? document : this.canvas);\n    this.input.gamepads.init();\n\n    // Issue #385 make use of the visibility api\n    // https://developer.mozilla.org/en-US/docs/Web/Guide/User_experience/Using_the_Page_Visibility_API\n\n    let hidden: keyof HTMLDocument, visibilityChange: string;\n    if (typeof document.hidden !== 'undefined') {\n      // Opera 12.10 and Firefox 18 and later support\n      hidden = 'hidden';\n      visibilityChange = 'visibilitychange';\n    } else if ('msHidden' in document) {\n      hidden = <keyof HTMLDocument>'msHidden';\n      visibilityChange = 'msvisibilitychange';\n    } else if ('webkitHidden' in document) {\n      hidden = <keyof HTMLDocument>'webkitHidden';\n      visibilityChange = 'webkitvisibilitychange';\n    }\n\n    this.browser.document.on(visibilityChange, () => {\n      if (document[hidden]) {\n        this.eventDispatcher.emit('hidden', new HiddenEvent(this));\n        this._logger.debug('Window hidden');\n      } else {\n        this.eventDispatcher.emit('visible', new VisibleEvent(this));\n        this._logger.debug('Window visible');\n      }\n    });\n\n    // eslint-disable-next-line\n    this.ctx = <CanvasRenderingContext2D>this.canvas.getContext('2d', { alpha: this.enableCanvasTransparency });\n\n    this._suppressHiDPIScaling = !!options.suppressHiDPIScaling;\n    if (!options.suppressHiDPIScaling) {\n      this._initializeHiDpi();\n    }\n\n    if (!this.canvasElementId && !options.canvasElement) {\n      document.body.appendChild(this.canvas);\n    }\n  }\n\n  public onInitialize(_engine: Engine) {\n    // Override me\n  }\n\n  private _initializeDisplayModePosition(options: EngineOptions) {\n    if (!options.position) {\n      throw new Error('DisplayMode of Position was selected but no position option was given');\n    } else {\n      this.canvas.style.display = 'block';\n      this.canvas.style.position = 'absolute';\n\n      if (typeof options.position === 'string') {\n        const specifiedPosition = options.position.split(' ');\n\n        switch (specifiedPosition[0]) {\n          case 'top':\n            this.canvas.style.top = '0px';\n            break;\n          case 'bottom':\n            this.canvas.style.bottom = '0px';\n            break;\n          case 'middle':\n            this.canvas.style.top = '50%';\n            const offsetY = -this.halfDrawHeight;\n            this.canvas.style.marginTop = offsetY.toString();\n            break;\n          default:\n            throw new Error('Invalid Position Given');\n        }\n\n        if (specifiedPosition[1]) {\n          switch (specifiedPosition[1]) {\n            case 'left':\n              this.canvas.style.left = '0px';\n              break;\n            case 'right':\n              this.canvas.style.right = '0px';\n              break;\n            case 'center':\n              this.canvas.style.left = '50%';\n              const offsetX = -this.halfDrawWidth;\n              this.canvas.style.marginLeft = offsetX.toString();\n              break;\n            default:\n              throw new Error('Invalid Position Given');\n          }\n        }\n      } else {\n        if (options.position.top) {\n          typeof options.position.top === 'number'\n            ? (this.canvas.style.top = options.position.top.toString() + 'px')\n            : (this.canvas.style.top = options.position.top);\n        }\n        if (options.position.right) {\n          typeof options.position.right === 'number'\n            ? (this.canvas.style.right = options.position.right.toString() + 'px')\n            : (this.canvas.style.right = options.position.right);\n        }\n        if (options.position.bottom) {\n          typeof options.position.bottom === 'number'\n            ? (this.canvas.style.bottom = options.position.bottom.toString() + 'px')\n            : (this.canvas.style.bottom = options.position.bottom);\n        }\n        if (options.position.left) {\n          typeof options.position.left === 'number'\n            ? (this.canvas.style.left = options.position.left.toString() + 'px')\n            : (this.canvas.style.left = options.position.left);\n        }\n      }\n    }\n  }\n\n  private _initializeHiDpi() {\n    // Scale the canvas if needed\n    if (this.isHiDpi) {\n      const oldWidth = this.canvas.width;\n      const oldHeight = this.canvas.height;\n\n      this.canvas.width = oldWidth * this.pixelRatio;\n      this.canvas.height = oldHeight * this.pixelRatio;\n\n      this.canvas.style.width = oldWidth + 'px';\n      this.canvas.style.height = oldHeight + 'px';\n\n      this._logger.warn(`Hi DPI screen detected, resetting canvas resolution from \n                           ${oldWidth}x${oldHeight} to ${this.canvas.width}x${this.canvas.height} \n                           css size will remain ${oldWidth}x${oldHeight}`);\n\n      this.ctx.scale(this.pixelRatio, this.pixelRatio);\n      this._logger.warn(`Canvas drawing context was scaled by ${this.pixelRatio}`);\n    }\n  }\n\n  /**\n   * If supported by the browser, this will set the antialiasing flag on the\n   * canvas. Set this to `false` if you want a 'jagged' pixel art look to your\n   * image resources.\n   * @param isSmooth  Set smoothing to true or false\n   */\n  public setAntialiasing(isSmooth: boolean) {\n    this._isSmoothingEnabled = isSmooth;\n\n    const ctx: any = this.ctx;\n    ctx.imageSmoothingEnabled = isSmooth;\n    for (const smoothing of ['webkitImageSmoothingEnabled', 'mozImageSmoothingEnabled', 'msImageSmoothingEnabled']) {\n      if (smoothing in ctx) {\n        ctx[smoothing] = isSmooth;\n      }\n    }\n  }\n\n  /**\n   * Return the current smoothing status of the canvas\n   */\n  public getAntialiasing(): boolean {\n    /*eslint-disable */\n    return (\n      (<any>this.ctx).imageSmoothingEnabled ||\n      (<any>this.ctx).webkitImageSmoothingEnabled ||\n      (<any>this.ctx).mozImageSmoothingEnabled ||\n      (<any>this.ctx).msImageSmoothingEnabled\n    );\n    /*eslint-enable */\n  }\n\n  /**\n   * Gets whether the actor is Initialized\n   */\n  public get isInitialized(): boolean {\n    return this._isInitialized;\n  }\n\n  private _overrideInitialize(engine: Engine) {\n    if (!this.isInitialized) {\n      this.onInitialize(engine);\n      super.emit('initialize', new InitializeEvent(engine, this));\n      this._isInitialized = true;\n    }\n  }\n\n  /**\n   * Updates the entire state of the game\n   * @param delta  Number of milliseconds elapsed since the last update.\n   */\n  private _update(delta: number) {\n    if (this._isLoading) {\n      // suspend updates until loading is finished\n      this._loader.update(this, delta);\n      // Update input listeners\n      this.input.keyboard.update();\n      this.input.pointers.update();\n      this.input.gamepads.update();\n      return;\n    }\n    this._overrideInitialize(this);\n    // Publish preupdate events\n    this._preupdate(delta);\n\n    // process engine level events\n    this.currentScene.update(this, delta);\n\n    // update animations\n    this._animations = this._animations.filter(function(a) {\n      return !a.animation.isDone();\n    });\n\n    // Update input listeners\n    this.input.keyboard.update();\n    this.input.pointers.update();\n    this.input.gamepads.update();\n\n    // Publish update event\n    this._postupdate(delta);\n  }\n\n  /**\n   * @internal\n   */\n  public _preupdate(delta: number) {\n    this.emit('preupdate', new PreUpdateEvent(this, delta, this));\n    this.onPreUpdate(this, delta);\n  }\n\n  public onPreUpdate(_engine: Engine, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * @internal\n   */\n  public _postupdate(delta: number) {\n    this.emit('postupdate', new PostUpdateEvent(this, delta, this));\n    this.onPostUpdate(this, delta);\n  }\n\n  public onPostUpdate(_engine: Engine, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * Draws the entire game\n   * @param delta  Number of milliseconds elapsed since the last draw.\n   */\n  private _draw(delta: number) {\n    const ctx = this.ctx;\n    this._predraw(ctx, delta);\n\n    if (this._isLoading) {\n      this._loader.draw(ctx, delta);\n      // Drawing nothing else while loading\n      return;\n    }\n\n    ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight);\n    ctx.fillStyle = this.backgroundColor.toString();\n    ctx.fillRect(0, 0, this.canvasWidth, this.canvasHeight);\n\n    this.currentScene.draw(this.ctx, delta);\n\n    // todo needs to be a better way of doing this\n    let a = 0;\n    const len = this._animations.length;\n    for (a; a < len; a++) {\n      this._animations[a].animation.draw(ctx, this._animations[a].x, this._animations[a].y);\n    }\n\n    // Draw debug information\n    if (this.isDebug) {\n      this.ctx.font = 'Consolas';\n      this.ctx.fillStyle = this.debugColor.toString();\n      const keys = this.input.keyboard.getKeys();\n      for (let j = 0; j < keys.length; j++) {\n        this.ctx.fillText(keys[j].toString() + ' : ' + (Input.Keys[keys[j]] ? Input.Keys[keys[j]] : 'Not Mapped'), 100, 10 * j + 10);\n      }\n\n      this.ctx.fillText('FPS:' + this.stats.currFrame.fps.toFixed(2).toString(), 10, 10);\n    }\n\n    // Post processing\n    for (let i = 0; i < this.postProcessors.length; i++) {\n      this.postProcessors[i].process(this.ctx.getImageData(0, 0, this.canvasWidth, this.canvasHeight), this.ctx);\n    }\n\n    this._postdraw(ctx, delta);\n  }\n\n  /**\n   * @internal\n   */\n  public _predraw(_ctx: CanvasRenderingContext2D, delta: number) {\n    this.emit('predraw', new PreDrawEvent(_ctx, delta, this));\n    this.onPreDraw(_ctx, delta);\n  }\n\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * @internal\n   */\n  public _postdraw(_ctx: CanvasRenderingContext2D, delta: number) {\n    this.emit('postdraw', new PostDrawEvent(_ctx, delta, this));\n    this.onPostDraw(_ctx, delta);\n  }\n\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * Starts the internal game loop for Excalibur after loading\n   * any provided assets.\n   * @param loader  Optional [[Loader]] to use to load resources. The default loader is [[Loader]], override to provide your own\n   * custom loader.\n   */\n  public start(loader?: CanLoad): Promise<any> {\n    if (!this._compatible) {\n      const promise = new Promise();\n      return promise.reject('Excalibur is incompatible with your browser');\n    }\n\n    let loadingComplete: Promise<any>;\n    if (loader) {\n      this._loader = loader;\n      this._loader.suppressPlayButton = this._suppressPlayButton || this._loader.suppressPlayButton;\n      this._loader.wireEngine(this);\n      loadingComplete = this.load(this._loader);\n    } else {\n      loadingComplete = Promise.resolve();\n    }\n\n    loadingComplete.then(() => {\n      this.emit('start', new GameStartEvent(this));\n    });\n\n    if (!this._hasStarted) {\n      this._hasStarted = true;\n      this._logger.debug('Starting game...');\n      this.browser.resume();\n      Engine.createMainLoop(this, window.requestAnimationFrame, Date.now)();\n\n      this._logger.debug('Game started');\n    } else {\n      // Game already started;\n    }\n    return loadingComplete;\n  }\n\n  public static createMainLoop(game: Engine, raf: (func: Function) => number, nowFn: () => number) {\n    let lastTime = nowFn();\n\n    return function mainloop() {\n      if (!game._hasStarted) {\n        return;\n      }\n      try {\n        game._requestId = raf(mainloop);\n        game.emit('preframe', new PreFrameEvent(game, game.stats.prevFrame));\n\n        // Get the time to calculate time-elapsed\n        const now = nowFn();\n        let elapsed = Math.floor(now - lastTime) || 1;\n        // Resolves issue #138 if the game has been paused, or blurred for\n        // more than a 200 milliseconds, reset elapsed time to 1. This improves reliability\n        // and provides more expected behavior when the engine comes back\n        // into focus\n        if (elapsed > 200) {\n          elapsed = 1;\n        }\n        const delta = elapsed * game.timescale;\n\n        // reset frame stats (reuse existing instances)\n        const frameId = game.stats.prevFrame.id + 1;\n        game.stats.prevFrame.reset(game.stats.currFrame);\n        game.stats.currFrame.reset();\n        game.stats.currFrame.id = frameId;\n        game.stats.currFrame.delta = delta;\n        game.stats.currFrame.fps = 1.0 / (delta / 1000);\n\n        const beforeUpdate = nowFn();\n        game._update(delta);\n        const afterUpdate = nowFn();\n        game._draw(delta);\n        const afterDraw = nowFn();\n\n        game.stats.currFrame.duration.update = afterUpdate - beforeUpdate;\n        game.stats.currFrame.duration.draw = afterDraw - afterUpdate;\n\n        lastTime = now;\n\n        game.emit('postframe', new PostFrameEvent(game, game.stats.currFrame));\n      } catch (e) {\n        window.cancelAnimationFrame(game._requestId);\n        game.stop();\n        game.onFatalException(e);\n      }\n    };\n  }\n\n  /**\n   * Stops Excalibur's main loop, useful for pausing the game.\n   */\n  public stop() {\n    if (this._hasStarted) {\n      this.emit('stop', new GameStopEvent(this));\n      this.browser.pause();\n      this._hasStarted = false;\n      this._logger.debug('Game stopped');\n    }\n  }\n\n  /**\n   * Returns the Engine's Running status, Useful for checking whether engine is running or paused.\n   */\n  public isPaused(): boolean {\n    return !this._hasStarted;\n  }\n\n  /**\n   * Takes a screen shot of the current viewport and returns it as an\n   * HTML Image Element.\n   */\n  public screenshot(): HTMLImageElement {\n    const result = new Image();\n    const raw = this.canvas.toDataURL('image/png');\n    result.src = raw;\n    return result;\n  }\n\n  /**\n   * Another option available to you to load resources into the game.\n   * Immediately after calling this the game will pause and the loading screen\n   * will appear.\n   * @param loader  Some [[Loadable]] such as a [[Loader]] collection, [[Sound]], or [[Texture]].\n   */\n  public load(loader: Loadable): Promise<any> {\n    const complete = new Promise<any>();\n\n    this._isLoading = true;\n\n    loader.load().then(() => {\n      if (this._suppressPlayButton) {\n        setTimeout(() => {\n          this._isLoading = false;\n          complete.resolve();\n          // Delay is to give the logo a chance to show, otherwise don't delay\n        }, 500);\n      } else {\n        this._isLoading = false;\n        complete.resolve();\n      }\n    });\n\n    return complete;\n  }\n}\n\n/**\n * @internal\n */\nclass AnimationNode {\n  constructor(public animation: Animation, public x: number, public y: number) {}\n}\n","import { Engine } from './Engine';\nimport { Actor } from './Actor';\nimport { Sprite } from './Drawing/Sprite';\nimport { Color } from './Drawing/Color';\nimport { Vector } from './Algebra';\nimport * as Util from './Util/Util';\nimport * as DrawUtil from './Util/DrawUtil';\nimport * as Traits from './Traits/Index';\nimport { Configurable } from './Configurable';\nimport { Random } from './Math/Random';\nimport { CollisionType } from './Collision/CollisionType';\n\n/**\n * An enum that represents the types of emitter nozzles\n */\nexport enum EmitterType {\n  /**\n   * Constant for the circular emitter type\n   */\n  Circle,\n  /**\n   * Constant for the rectangular emitter type\n   */\n  Rectangle\n}\n\n/**\n * @hidden\n */\nexport class ParticleImpl {\n  public position: Vector = new Vector(0, 0);\n  public velocity: Vector = new Vector(0, 0);\n  public acceleration: Vector = new Vector(0, 0);\n  public particleRotationalVelocity: number = 0;\n  public currentRotation: number = 0;\n\n  public focus: Vector = null;\n  public focusAccel: number = 0;\n  public opacity: number = 1;\n  public beginColor: Color = Color.White;\n  public endColor: Color = Color.White;\n\n  // Life is counted in ms\n  public life: number = 300;\n  public fadeFlag: boolean = false;\n\n  // Color transitions\n  private _rRate: number = 1;\n  private _gRate: number = 1;\n  private _bRate: number = 1;\n  private _aRate: number = 0;\n  private _currentColor: Color = Color.White;\n\n  public emitter: ParticleEmitter = null;\n  public particleSize: number = 5;\n  public particleSprite: Sprite = null;\n\n  public startSize: number;\n  public endSize: number;\n  public sizeRate: number = 0;\n  public elapsedMultiplier: number = 0;\n\n  constructor(\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  ) {\n    let emitter = emitterOrConfig;\n    if (emitter && !(emitterOrConfig instanceof ParticleEmitter)) {\n      const config = emitterOrConfig;\n      emitter = config.emitter;\n      life = config.life;\n      opacity = config.opacity;\n      endColor = config.endColor;\n      beginColor = config.beginColor;\n      position = config.position;\n      velocity = config.velocity;\n      acceleration = config.acceleration;\n      startSize = config.startSize;\n      endSize = config.endSize;\n    }\n    this.emitter = <ParticleEmitter>emitter;\n    this.life = life || this.life;\n    this.opacity = opacity || this.opacity;\n    this.endColor = endColor || this.endColor.clone();\n    this.beginColor = beginColor || this.beginColor.clone();\n    this._currentColor = this.beginColor.clone();\n    this.position = position || this.position;\n    this.velocity = velocity || this.velocity;\n    this.acceleration = acceleration || this.acceleration;\n    this._rRate = (this.endColor.r - this.beginColor.r) / this.life;\n    this._gRate = (this.endColor.g - this.beginColor.g) / this.life;\n    this._bRate = (this.endColor.b - this.beginColor.b) / this.life;\n    this._aRate = this.opacity / this.life;\n\n    this.startSize = startSize || 0;\n    this.endSize = endSize || 0;\n\n    if (this.endSize > 0 && this.startSize > 0) {\n      this.sizeRate = (this.endSize - this.startSize) / this.life;\n      this.particleSize = this.startSize;\n    }\n  }\n\n  public kill() {\n    this.emitter.removeParticle(this);\n  }\n\n  public update(delta: number) {\n    this.life = this.life - delta;\n    this.elapsedMultiplier = this.elapsedMultiplier + delta;\n\n    if (this.life < 0) {\n      this.kill();\n    }\n\n    if (this.fadeFlag) {\n      this.opacity = Util.clamp(this._aRate * this.life, 0.0001, 1);\n    }\n\n    if (this.startSize > 0 && this.endSize > 0) {\n      this.particleSize = Util.clamp(\n        this.sizeRate * delta + this.particleSize,\n        Math.min(this.startSize, this.endSize),\n        Math.max(this.startSize, this.endSize)\n      );\n    }\n\n    this._currentColor.r = Util.clamp(this._currentColor.r + this._rRate * delta, 0, 255);\n    this._currentColor.g = Util.clamp(this._currentColor.g + this._gRate * delta, 0, 255);\n    this._currentColor.b = Util.clamp(this._currentColor.b + this._bRate * delta, 0, 255);\n    this._currentColor.a = Util.clamp(this.opacity, 0.0001, 1);\n\n    if (this.focus) {\n      const accel = this.focus\n        .sub(this.position)\n        .normalize()\n        .scale(this.focusAccel)\n        .scale(delta / 1000);\n      this.velocity = this.velocity.add(accel);\n    } else {\n      this.velocity = this.velocity.add(this.acceleration.scale(delta / 1000));\n    }\n    this.position = this.position.add(this.velocity.scale(delta / 1000));\n\n    if (this.particleRotationalVelocity) {\n      this.currentRotation = (this.currentRotation + (this.particleRotationalVelocity * delta) / 1000) % (2 * Math.PI);\n    }\n  }\n\n  public draw(ctx: CanvasRenderingContext2D) {\n    if (this.particleSprite) {\n      this.particleSprite.rotation = this.currentRotation;\n      this.particleSprite.scale.setTo(this.particleSize, this.particleSize);\n      this.particleSprite.draw(ctx, this.position.x, this.position.y);\n      return;\n    }\n\n    this._currentColor.a = Util.clamp(this.opacity, 0.0001, 1);\n    ctx.fillStyle = this._currentColor.toString();\n    ctx.beginPath();\n    ctx.arc(this.position.x, this.position.y, this.particleSize, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.closePath();\n  }\n}\n\n/**\n * [[include:Constructors.md]]\n */\nexport interface ParticleArgs extends Partial<ParticleImpl> {\n  emitter: ParticleEmitter;\n  position?: Vector;\n  velocity?: Vector;\n  acceleration?: Vector;\n  particleRotationalVelocity?: number;\n  currentRotation?: number;\n  particleSize?: number;\n  particleSprite?: Sprite;\n}\n\n/**\n * Particle is used in a [[ParticleEmitter]]\n */\nexport class Particle extends Configurable(ParticleImpl) {\n  constructor(config: ParticleArgs);\n  constructor(\n    emitter: ParticleEmitter,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  );\n  constructor(\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  ) {\n    super(emitterOrConfig, life, opacity, beginColor, endColor, position, velocity, acceleration, startSize, endSize);\n  }\n}\n\n/**\n * @hidden\n */\nexport class ParticleEmitterImpl extends Actor {\n  private _particlesToEmit: number;\n\n  public numParticles: number = 0;\n\n  /**\n   * Random number generator\n   */\n  public random: Random;\n\n  /**\n   * Gets or sets the isEmitting flag\n   */\n  public isEmitting: boolean = true;\n  /**\n   * Gets or sets the backing particle collection\n   */\n  public particles: Util.Collection<Particle> = null;\n\n  /**\n   * Gets or sets the backing deadParticle collection\n   */\n  public deadParticles: Util.Collection<Particle> = null;\n\n  /**\n   * Gets or sets the minimum particle velocity\n   */\n  public minVel: number = 0;\n  /**\n   * Gets or sets the maximum particle velocity\n   */\n  public maxVel: number = 0;\n\n  /**\n   * Gets or sets the acceleration vector for all particles\n   */\n  public acceleration: Vector = new Vector(0, 0);\n\n  /**\n   * Gets or sets the minimum angle in radians\n   */\n  public minAngle: number = 0;\n  /**\n   * Gets or sets the maximum angle in radians\n   */\n  public maxAngle: number = 0;\n\n  /**\n   * Gets or sets the emission rate for particles (particles/sec)\n   */\n  public emitRate: number = 1; //particles/sec\n  /**\n   * Gets or sets the life of each particle in milliseconds\n   */\n  public particleLife: number = 2000;\n  /**\n   * Gets or sets the opacity of each particle from 0 to 1.0\n   */\n  public opacity: number = 1;\n  /**\n   * Gets or sets the fade flag which causes particles to gradually fade out over the course of their life.\n   */\n  public fadeFlag: boolean = false;\n\n  /**\n   * Gets or sets the optional focus where all particles should accelerate towards\n   */\n  public focus: Vector = null;\n  /**\n   * Gets or sets the acceleration for focusing particles if a focus has been specified\n   */\n  public focusAccel: number = 1;\n  /*\n   * Gets or sets the optional starting size for the particles\n   */\n  public startSize: number = null;\n  /*\n   * Gets or sets the optional ending size for the particles\n   */\n  public endSize: number = null;\n\n  /**\n   * Gets or sets the minimum size of all particles\n   */\n  public minSize: number = 5;\n  /**\n   * Gets or sets the maximum size of all particles\n   */\n  public maxSize: number = 5;\n\n  /**\n   * Gets or sets the beginning color of all particles\n   */\n  public beginColor: Color = Color.White;\n  /**\n   * Gets or sets the ending color of all particles\n   */\n  public endColor: Color = Color.White;\n\n  /**\n   * Gets or sets the sprite that a particle should use\n   * @warning Performance intensive\n   */\n  public particleSprite: Sprite = null;\n\n  /**\n   * Gets or sets the emitter type for the particle emitter\n   */\n  public emitterType: EmitterType = EmitterType.Rectangle;\n\n  /**\n   * Gets or sets the emitter radius, only takes effect when the [[emitterType]] is [[EmitterType.Circle]]\n   */\n  public radius: number = 0;\n\n  /**\n   * Gets or sets the particle rotational speed velocity\n   */\n  public particleRotationalVelocity: number = 0;\n\n  /**\n   * Indicates whether particles should start with a random rotation\n   */\n  public randomRotation: boolean = false;\n\n  /**\n   * @param x       The x position of the emitter\n   * @param y       The y position of the emitter\n   * @param width   The width of the emitter\n   * @param height  The height of the emitter\n   */\n  constructor(xOrConfig?: number | ParticleEmitterArgs, y?: number, width?: number, height?: number) {\n    super(typeof xOrConfig === 'number' ? { pos: new Vector(xOrConfig, y), width: width, height: height } : xOrConfig);\n    this._particlesToEmit = 0;\n    this.body.collider.type = CollisionType.PreventCollision;\n    this.particles = new Util.Collection<Particle>();\n    this.deadParticles = new Util.Collection<Particle>();\n    this.random = new Random();\n\n    // Remove offscreen culling from particle emitters\n    for (let i = 0; i < this.traits.length; i++) {\n      if (this.traits[i] instanceof Traits.OffscreenCulling) {\n        this.traits.splice(i, 1);\n      }\n    }\n  }\n\n  public removeParticle(particle: Particle) {\n    this.deadParticles.push(particle);\n  }\n\n  /**\n   * Causes the emitter to emit particles\n   * @param particleCount  Number of particles to emit right now\n   */\n  public emitParticles(particleCount: number) {\n    for (let i = 0; i < particleCount; i++) {\n      this.particles.push(this._createParticle());\n    }\n  }\n\n  public clearParticles() {\n    this.particles.clear();\n  }\n\n  // Creates a new particle given the constraints of the emitter\n  private _createParticle(): Particle {\n    // todo implement emitter constraints;\n    let ranX = 0;\n    let ranY = 0;\n\n    const angle = Util.randomInRange(this.minAngle, this.maxAngle, this.random);\n    const vel = Util.randomInRange(this.minVel, this.maxVel, this.random);\n    const size = this.startSize || Util.randomInRange(this.minSize, this.maxSize, this.random);\n    const dx = vel * Math.cos(angle);\n    const dy = vel * Math.sin(angle);\n\n    if (this.emitterType === EmitterType.Rectangle) {\n      ranX = Util.randomInRange(this.pos.x, this.pos.x + this.width, this.random);\n      ranY = Util.randomInRange(this.pos.y, this.pos.y + this.height, this.random);\n    } else if (this.emitterType === EmitterType.Circle) {\n      const radius = Util.randomInRange(0, this.radius, this.random);\n      ranX = radius * Math.cos(angle) + this.pos.x;\n      ranY = radius * Math.sin(angle) + this.pos.y;\n    }\n\n    const p = new Particle(\n      this,\n      this.particleLife,\n      this.opacity,\n      this.beginColor,\n      this.endColor,\n      new Vector(ranX, ranY),\n      new Vector(dx, dy),\n      this.acceleration,\n      this.startSize,\n      this.endSize\n    );\n    p.fadeFlag = this.fadeFlag;\n    p.particleSize = size;\n    if (this.particleSprite) {\n      p.particleSprite = this.particleSprite;\n    }\n    p.particleRotationalVelocity = this.particleRotationalVelocity;\n    if (this.randomRotation) {\n      p.currentRotation = Util.randomInRange(0, Math.PI * 2, this.random);\n    }\n    if (this.focus) {\n      p.focus = this.focus.add(new Vector(this.pos.x, this.pos.y));\n      p.focusAccel = this.focusAccel;\n    }\n    return p;\n  }\n\n  public update(engine: Engine, delta: number) {\n    super.update(engine, delta);\n\n    if (this.isEmitting) {\n      this._particlesToEmit += this.emitRate * (delta / 1000);\n      //var numParticles = Math.ceil(this.emitRate * delta / 1000);\n      if (this._particlesToEmit > 1.0) {\n        this.emitParticles(Math.floor(this._particlesToEmit));\n        this._particlesToEmit = this._particlesToEmit - Math.floor(this._particlesToEmit);\n      }\n    }\n\n    this.particles.forEach((p) => p.update(delta));\n    this.deadParticles.forEach((p) => this.particles.removeElement(p));\n    this.deadParticles.clear();\n  }\n\n  public draw(ctx: CanvasRenderingContext2D) {\n    // todo is there a more efficient to draw\n    // possibly use a webgl offscreen canvas and shaders to do particles?\n    this.particles.forEach((p) => p.draw(ctx));\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    super.debugDraw(ctx);\n    ctx.fillStyle = Color.Black.toString();\n    ctx.fillText('Particles: ' + this.particles.count(), this.pos.x, this.pos.y + 20);\n\n    if (this.focus) {\n      ctx.fillRect(this.focus.x + this.pos.x, this.focus.y + this.pos.y, 3, 3);\n      DrawUtil.line(ctx, Color.Yellow, this.focus.x + this.pos.x, this.focus.y + this.pos.y, this.center.x, this.center.y);\n      ctx.fillText('Focus', this.focus.x + this.pos.x, this.focus.y + this.pos.y);\n    }\n  }\n}\n\n/**\n * [[include:Constructors.md]]\n */\nexport interface ParticleEmitterArgs extends Partial<ParticleEmitterImpl> {\n  width?: number;\n  height?: number;\n  isEmitting?: boolean;\n  minVel?: number;\n  maxVel?: number;\n  acceleration?: Vector;\n  minAngle?: number;\n  maxAngle?: number;\n  emitRate?: number;\n  particleLife?: number;\n  opacity?: number;\n  fadeFlag?: boolean;\n  focus?: Vector;\n  focusAccel?: number;\n  startSize?: number;\n  endSize?: number;\n  minSize?: number;\n  maxSize?: number;\n  beginColor?: Color;\n  endColor?: Color;\n  particleSprite?: Sprite;\n  emitterType?: EmitterType;\n  radius?: number;\n  particleRotationalVelocity?: number;\n  randomRotation?: boolean;\n  random?: Random;\n}\n\n/**\n * Using a particle emitter is a great way to create interesting effects\n * in your game, like smoke, fire, water, explosions, etc. `ParticleEmitter`\n * extend [[Actor]] allowing you to use all of the features that come with.\n *\n * [[include:Particles.md]]\n */\nexport class ParticleEmitter extends Configurable(ParticleEmitterImpl) {\n  constructor(config?: ParticleEmitterArgs);\n  constructor(x?: number | ParticleEmitterArgs, y?: number, width?: number, height?: number);\n  constructor(xOrConfig?: number | ParticleEmitterArgs, y?: number, width?: number, height?: number) {\n    super(xOrConfig, y, width, height);\n  }\n}\n","import { GameEvent } from '../Events';\nimport { Sound } from '../Resources/Sound/Sound';\nimport { Actor } from '../Actor';\nimport { AudioInstance } from '../Resources/Sound/AudioInstance';\n\nexport class MediaEvent extends GameEvent<Sound> {\n  /**\n   * Media event cannot bubble\n   */\n  public set bubbles(_value: boolean) {\n    // stubbed\n  }\n  /**\n   * Media event cannot bubble\n   */\n  public get bubbles(): boolean {\n    return false;\n  }\n  /**\n   * Media event cannot bubble, so they have no path\n   */\n  protected get _path(): Actor[] {\n    return null;\n  }\n  /**\n   * Media event cannot bubble, so they have no path\n   */\n  protected set _path(_val: Actor[]) {\n    // stubbed\n  }\n\n  constructor(public target: Sound, protected _name: string = 'MediaEvent') {\n    super();\n  }\n\n  /**\n   * Prevents event from bubbling\n   */\n  public stopPropagation(): void {\n    /**\n     * Stub\n     */\n  }\n  /**\n   * Action, that calls when event happens\n   */\n  public action(): void {\n    /**\n     * Stub\n     */\n  }\n  /**\n   * Propagate event further through event path\n   */\n  public propagate(): void {\n    /**\n     * Stub\n     */\n  }\n\n  public layPath(_actor: Actor): void {\n    /**\n     * Stub\n     */\n  }\n}\n\nexport class NativeSoundEvent extends MediaEvent {\n  constructor(target: Sound, public track?: AudioInstance) {\n    super(target, 'NativeSoundEvent');\n  }\n}\n\nexport class NativeSoundProcessedEvent extends MediaEvent {\n  public data: string | AudioBuffer;\n\n  constructor(target: Sound, private processedData: string | AudioBuffer) {\n    super(target, 'NativeSoundProcessedEvent');\n\n    this.data = this.processedData;\n  }\n}\n","export * from './ActionContext';\nexport * from './Actionable';\nexport * from './RotationType';\n\nimport * as actions from './Action';\nexport { actions as Actions };\n\n// legacy Internal.Actions namespace support\nexport const Internal = { Actions: actions };\n","import { CollisionGroup } from './CollisionGroup';\n\n/**\n * Static class for managing collision groups in excalibur, there is a maximum of 32 collision groups possible in excalibur\n */\nexport class CollisionGroupManager {\n  // using bitmasking the maximum number of groups is 32, because that is the highest 32bit integer that JS can present.\n  private static _STARTING_BIT = 0b1 | 0;\n  private static _MAX_GROUPS = 32;\n  private static _currentGroup = 1;\n  private static _currentBit = CollisionGroupManager._STARTING_BIT;\n  private static _groups: Map<string, CollisionGroup> = new Map<string, CollisionGroup>();\n\n  /**\n   * Create a new named collision group up to a max of 32.\n   * @param name Name for the collision group\n   * @param mask Optionally provide your own 32-bit mask, if none is provide the manager will generate one\n   */\n  public static create(name: string, mask?: number) {\n    if (this._currentGroup > this._MAX_GROUPS) {\n      throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);\n    }\n    if (this._groups.get(name)) {\n      throw new Error(`Collision group ${name} already exists`);\n    }\n    const group = new CollisionGroup(name, this._currentBit, mask !== undefined ? mask : ~this._currentBit);\n    this._currentBit = (this._currentBit << 1) | 0;\n    this._currentGroup++;\n    this._groups.set(name, group);\n    return group;\n  }\n\n  /**\n   * Get all collision groups currently tracked by excalibur\n   */\n  public static get groups(): CollisionGroup[] {\n    return Array.from(this._groups.values());\n  }\n\n  /**\n   * Get a collision group by it's name\n   * @param name\n   */\n  public static groupByName(name: string) {\n    return this._groups.get(name);\n  }\n\n  /**\n   * Resets the managers internal group management state\n   */\n  public static reset() {\n    this._groups = new Map<string, CollisionGroup>();\n    this._currentBit = this._STARTING_BIT;\n    this._currentGroup = 1;\n  }\n}\n","import { Sprite } from './Sprite';\nimport * as Effects from './SpriteEffects';\nimport { Color } from './Color';\n\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\nimport { Vector } from '../Algebra';\nimport { Engine } from '../Engine';\nimport * as Util from '../Util/Util';\nimport { Configurable } from '../Configurable';\n\n/**\n * @hidden\n */\nexport class AnimationImpl implements Drawable {\n  /**\n   * The sprite frames to play, in order. See [[SpriteSheet.getAnimationForAll]] to quickly\n   * generate an [[Animation]].\n   */\n  public sprites: Sprite[] = [];\n\n  /**\n   * Duration to show each frame (in milliseconds)\n   */\n  public speed: number;\n\n  /**\n   * Current frame index being shown\n   */\n  public currentFrame: number = 0;\n\n  private _oldTime: number = Date.now();\n\n  public anchor: Vector = Vector.Zero;\n  public rotation: number = 0.0;\n  public scale: Vector = Vector.One;\n\n  /**\n   * Indicates whether the animation should loop after it is completed\n   */\n  public loop: boolean = true;\n\n  /**\n   * Indicates the frame index the animation should freeze on for a non-looping\n   * animation. By default it is the last frame.\n   */\n  public freezeFrame: number = -1;\n\n  private _engine: Engine;\n\n  /**\n   * Flip each frame vertically. Sets [[Sprite.flipVertical]].\n   */\n  public flipVertical: boolean = false;\n\n  /**\n   * Flip each frame horizontally. Sets [[Sprite.flipHorizontal]].\n   */\n  public flipHorizontal: boolean = false;\n\n  public drawWidth: number = 0;\n  public drawHeight: number = 0;\n  public width: number = 0;\n  public height: number = 0;\n\n  /**\n   * Typically you will use a [[SpriteSheet]] to generate an [[Animation]].\n   *\n   * @param engine  Reference to the current game engine\n   * @param images  An array of sprites to create the frames for the animation\n   * @param speed   The number in milliseconds to display each frame in the animation\n   * @param loop    Indicates whether the animation should loop after it is completed\n   */\n  constructor(engineOrConfig: Engine | AnimationArgs, sprites: Sprite[], speed: number, loop?: boolean) {\n    let engine = engineOrConfig;\n    if (engineOrConfig && !(engineOrConfig instanceof Engine)) {\n      const config = engineOrConfig;\n      engine = config.engine;\n      sprites = config.sprites;\n      speed = config.speed;\n      loop = config.loop;\n    }\n\n    this.sprites = sprites;\n    this.speed = speed;\n    this._engine = <Engine>engine;\n\n    if (loop != null) {\n      this.loop = loop;\n    }\n\n    if (sprites && sprites[0]) {\n      this.drawHeight = sprites[0] ? sprites[0].drawHeight : 0;\n      this.drawWidth = sprites[0] ? sprites[0].drawWidth : 0;\n\n      this.width = sprites[0] ? sprites[0].width : 0;\n      this.height = sprites[0] ? sprites[0].height : 0;\n\n      this.freezeFrame = sprites.length - 1;\n    }\n  }\n\n  /**\n   * Applies the opacity effect to a sprite, setting the alpha of all pixels to a given value\n   */\n  public opacity(value: number) {\n    this.addEffect(new Effects.Opacity(value));\n  }\n\n  /**\n   * Applies the grayscale effect to a sprite, removing color information.\n   */\n  public grayscale() {\n    this.addEffect(new Effects.Grayscale());\n  }\n\n  /**\n   * Applies the invert effect to a sprite, inverting the pixel colors.\n   */\n  public invert() {\n    this.addEffect(new Effects.Invert());\n  }\n\n  /**\n   * Applies the fill effect to a sprite, changing the color channels of all non-transparent pixels to match a given color\n   */\n  public fill(color: Color) {\n    this.addEffect(new Effects.Fill(color));\n  }\n\n  /**\n   * Applies the colorize effect to a sprite, changing the color channels of all pixels to be the average of the original color and the\n   * provided color.\n   */\n  public colorize(color: Color) {\n    this.addEffect(new Effects.Colorize(color));\n  }\n\n  /**\n   * Applies the lighten effect to a sprite, changes the lightness of the color according to hsl\n   */\n  public lighten(factor: number = 0.1) {\n    this.addEffect(new Effects.Lighten(factor));\n  }\n\n  /**\n   * Applies the darken effect to a sprite, changes the darkness of the color according to hsl\n   */\n  public darken(factor: number = 0.1) {\n    this.addEffect(new Effects.Darken(factor));\n  }\n\n  /**\n   * Applies the saturate effect to a sprite, saturates the color according to hsl\n   */\n  public saturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Saturate(factor));\n  }\n\n  /**\n   * Applies the desaturate effect to a sprite, desaturates the color according to hsl\n   */\n  public desaturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Desaturate(factor));\n  }\n\n  /**\n   * Add a [[SpriteEffect]] manually\n   */\n  public addEffect(effect: Effects.SpriteEffect) {\n    for (const i in this.sprites) {\n      this.sprites[i].addEffect(effect);\n    }\n  }\n\n  /**\n   * Removes an [[SpriteEffect]] from this animation.\n   * @param effect Effect to remove from this animation\n   */\n  public removeEffect(effect: Effects.SpriteEffect): void;\n\n  /**\n   * Removes an effect given the index from this animation.\n   * @param index  Index of the effect to remove from this animation\n   */\n  public removeEffect(index: number): void;\n  public removeEffect(param: any) {\n    for (const i in this.sprites) {\n      this.sprites[i].removeEffect(param);\n    }\n  }\n\n  /**\n   * Clear all sprite effects\n   */\n  public clearEffects() {\n    for (const i in this.sprites) {\n      this.sprites[i].clearEffects();\n    }\n  }\n\n  private _setAnchor(point: Vector) {\n    //if (!this.anchor.equals(point)) {\n    for (const i in this.sprites) {\n      this.sprites[i].anchor.setTo(point.x, point.y);\n    }\n    //}\n  }\n\n  private _setRotation(radians: number) {\n    //if (this.rotation !== radians) {\n    for (const i in this.sprites) {\n      this.sprites[i].rotation = radians;\n    }\n    //}\n  }\n\n  private _setScale(scale: Vector) {\n    //if (!this.scale.equals(scale)) {\n    for (const i in this.sprites) {\n      this.sprites[i].scale = scale;\n    }\n    //}\n  }\n\n  /**\n   * Resets the animation to first frame.\n   */\n  public reset() {\n    this.currentFrame = 0;\n  }\n\n  /**\n   * Indicates whether the animation is complete, animations that loop are never complete.\n   */\n  public isDone() {\n    return !this.loop && this.currentFrame >= this.sprites.length;\n  }\n\n  /**\n   * Not meant to be called by game developers. Ticks the animation forward internally and\n   * calculates whether to change to the frame.\n   * @internal\n   */\n  public tick() {\n    const time = Date.now();\n    if (time - this._oldTime > this.speed) {\n      this.currentFrame = this.loop ? (this.currentFrame + 1) % this.sprites.length : this.currentFrame + 1;\n      this._oldTime = time;\n    }\n  }\n\n  private _updateValues(): void {\n    this._setAnchor(this.anchor);\n    this._setRotation(this.rotation);\n    this._setScale(this.scale);\n  }\n\n  /**\n   * Skips ahead a specified number of frames in the animation\n   * @param frames  Frames to skip ahead\n   */\n  public skip(frames: number) {\n    this.currentFrame = (this.currentFrame + frames) % this.sprites.length;\n  }\n\n  /**\n   * Draws the animation appropriately to the 2D rendering context, at an x and y coordinate.\n   * @param ctx  The 2D rendering context\n   * @param x    The x coordinate of where to draw\n   * @param y    The y coordinate of where to draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\n  /**\n   * Draws the animation with custom options to override internals without mutating them.\n   * @param options\n   */\n  public draw(options: DrawOptions): void;\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number) {\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y, flipHorizontal: this.flipHorizontal, flipVertical: this.flipVertical });\n    } else {\n      this._drawWithOptions(ctxOrOptions);\n    }\n  }\n\n  private _drawWithOptions(options: DrawOptions) {\n    this.tick();\n    this._updateValues();\n    let currSprite: Sprite;\n    if (this.currentFrame < this.sprites.length) {\n      currSprite = this.sprites[this.currentFrame];\n      currSprite.draw(options);\n    }\n\n    if (this.freezeFrame !== -1 && this.currentFrame >= this.sprites.length) {\n      currSprite = this.sprites[Util.clamp(this.freezeFrame, 0, this.sprites.length - 1)];\n      currSprite.draw(options);\n    }\n\n    // add the calculated width\n    if (currSprite) {\n      this.drawWidth = currSprite.drawWidth;\n      this.drawHeight = currSprite.drawHeight;\n    }\n  }\n\n  /**\n   * Plays an animation at an arbitrary location in the game.\n   * @param x  The x position in the game to play\n   * @param y  The y position in the game to play\n   */\n  public play(x: number, y: number) {\n    this.reset();\n    this._engine.playAnimation(this, x, y);\n  }\n}\n\n/**\n * [[include:Constructors.md]]\n */\nexport interface AnimationArgs extends Partial<AnimationImpl> {\n  engine: Engine;\n  sprites: Sprite[];\n  speed: number;\n  loop?: boolean;\n  anchor?: Vector;\n  rotation?: number;\n  scale?: Vector;\n  flipVertical?: boolean;\n  flipHorizontal?: boolean;\n  width?: number;\n  height?: number;\n}\n\n/**\n * Animations allow you to display a series of images one after another,\n * creating the illusion of change. Generally these images will come from a [[SpriteSheet]] source.\n *\n * [[include:Animations.md]]\n */\nexport class Animation extends Configurable(AnimationImpl) {\n  constructor(config: AnimationArgs);\n  constructor(engine: Engine, images: Sprite[], speed: number, loop?: boolean);\n  constructor(engineOrConfig: Engine | AnimationArgs, images?: Sprite[], speed?: number, loop?: boolean) {\n    super(engineOrConfig, images, speed, loop);\n  }\n}\n","import { Color } from './Color';\nimport * as Effects from './SpriteEffects';\n\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\nimport { Vector } from '../Algebra';\nimport { nullish } from '../Util/Util';\n\n/**\n * Creates a closed polygon drawing given a list of [[Vector]]s.\n *\n * @warning Use sparingly as Polygons are performance intensive\n */\nexport class Polygon implements Drawable {\n  public flipVertical: boolean;\n  public flipHorizontal: boolean;\n  public drawWidth: number;\n  public drawHeight: number;\n\n  public width: number;\n  public height: number;\n\n  /**\n   * The color to use for the lines of the polygon\n   */\n  public lineColor: Color;\n  /**\n   * The color to use for the interior of the polygon\n   */\n  public fillColor: Color;\n  /**\n   * The width of the lines of the polygon\n   */\n  public lineWidth: number = 5;\n  /**\n   * Indicates whether the polygon is filled or not.\n   */\n  public filled: boolean = false;\n\n  private _points: Vector[] = [];\n  public anchor = Vector.Zero;\n  public offset = Vector.Zero;\n  public rotation: number = 0;\n  public scale = Vector.One;\n  public opacity: number = 1;\n\n  /**\n   * @param points  The vectors to use to build the polygon in order\n   */\n  constructor(points: Vector[]) {\n    this._points = points;\n\n    const minX = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.min(prev, curr.x);\n    }, 0);\n    const maxX = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.max(prev, curr.x);\n    }, 0);\n\n    this.drawWidth = maxX - minX;\n\n    const minY = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.min(prev, curr.y);\n    }, 0);\n    const maxY = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.max(prev, curr.y);\n    }, 0);\n\n    this.drawHeight = maxY - minY;\n\n    this.height = this.drawHeight;\n    this.width = this.drawWidth;\n  }\n\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public addEffect() {\n    // not supported on polygons\n  }\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public removeEffect(index: number): void;\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public removeEffect(effect: Effects.SpriteEffect): void;\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public removeEffect() {\n    // not supported on polygons\n  }\n\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public clearEffects() {\n    // not supported on polygons\n  }\n\n  public reset() {\n    //pass\n  }\n\n  /**\n   * Draws the sprite appropriately to the 2D rendering context, at an x and y coordinate.\n   * @param ctx  The 2D rendering context\n   * @param x    The x coordinate of where to draw\n   * @param y    The y coordinate of where to draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\n  /**\n   * Draws the sprite with custom options to override internals without mutating them.\n   * @param options\n   */\n  public draw(options: DrawOptions): void;\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number): void {\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\n    } else {\n      this._drawWithOptions(ctxOrOptions);\n    }\n  }\n\n  private _drawWithOptions(options: DrawOptions) {\n    const { ctx, x, y, rotation, drawWidth, drawHeight, anchor, offset, opacity, flipHorizontal, flipVertical } = {\n      ...options,\n      rotation: nullish(options.rotation, this.rotation),\n      drawWidth: nullish(options.drawWidth, this.drawWidth),\n      drawHeight: nullish(options.drawHeight, this.drawHeight),\n      flipHorizontal: nullish(options.flipHorizontal, this.flipHorizontal),\n      flipVertical: nullish(options.flipVertical, this.flipVertical),\n      anchor: nullish(options.anchor, this.anchor),\n      offset: nullish(options.offset, this.offset),\n      opacity: nullish(options.opacity, this.opacity)\n    };\n\n    const xpoint = drawWidth * anchor.x + offset.x + x;\n    const ypoint = drawHeight * anchor.y + offset.y + y;\n\n    ctx.save();\n    ctx.translate(xpoint, ypoint);\n    ctx.scale(this.scale.x, this.scale.y);\n    ctx.rotate(rotation);\n    ctx.beginPath();\n    ctx.lineWidth = this.lineWidth;\n\n    // Iterate through the supplied points and construct a 'polygon'\n    const firstPoint = this._points[0];\n    ctx.moveTo(firstPoint.x, firstPoint.y);\n\n    let i = 0;\n    const len = this._points.length;\n\n    for (i; i < len; i++) {\n      ctx.lineTo(this._points[i].x, this._points[i].y);\n    }\n\n    ctx.lineTo(firstPoint.x, firstPoint.y);\n    ctx.closePath();\n\n    if (this.filled) {\n      ctx.fillStyle = this.fillColor.toString();\n      ctx.fill();\n    }\n\n    ctx.strokeStyle = this.lineColor.toString();\n\n    if (flipHorizontal) {\n      ctx.translate(drawWidth, 0);\n      ctx.scale(-1, 1);\n    }\n\n    if (flipVertical) {\n      ctx.translate(0, drawHeight);\n      ctx.scale(1, -1);\n    }\n\n    const oldAlpha = ctx.globalAlpha;\n    ctx.globalAlpha = nullish(opacity, 1);\n    ctx.stroke();\n    ctx.globalAlpha = oldAlpha;\n\n    ctx.restore();\n  }\n}\n","import { Sprite, SpriteArgs } from './Sprite';\nimport { Animation } from './Animation';\nimport { Color } from './Color';\nimport * as Effects from './SpriteEffects';\n\nimport { Texture } from '../Resources/Texture';\nimport { Engine } from '../Engine';\nimport { Logger } from '../Util/Log';\nimport { TextAlign, BaseAlign } from '../Label';\nimport { Configurable } from '../Configurable';\n\n/**\n * @hidden\n */\nexport class SpriteSheetImpl {\n  public sprites: Sprite[] = [];\n  public image: Texture = null;\n  public columns: number = 0;\n  public rows: number = 0;\n  public spWidth: number = 0;\n  public spHeight: number = 0;\n  public spacing: number = 0;\n  /**\n   * @param image     The backing image texture to build the SpriteSheet\n   * @param columns   The number of columns in the image texture\n   * @param rows      The number of rows in the image texture\n   * @param spWidth   The width of each individual sprite in pixels\n   * @param spHeight  The height of each individual sprite in pixels\n   * @param spacing   The spacing between every sprite in a spritesheet\n   */\n  constructor(\n    imageOrConfigOrSprites: Texture | SpriteSheetArgs | Sprite[],\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number\n  ) {\n    let loadFromImage: boolean = false;\n    if (imageOrConfigOrSprites instanceof Array) {\n      this.sprites = imageOrConfigOrSprites;\n    } else {\n      if (imageOrConfigOrSprites && !(imageOrConfigOrSprites instanceof Texture)) {\n        this.columns = imageOrConfigOrSprites.columns;\n        this.rows = imageOrConfigOrSprites.rows;\n        this.spWidth = imageOrConfigOrSprites.spWidth;\n        this.spHeight = imageOrConfigOrSprites.spHeight;\n        this.image = imageOrConfigOrSprites.image;\n        this.spacing = imageOrConfigOrSprites.spacing || 0;\n      } else {\n        this.image = <Texture>imageOrConfigOrSprites;\n        this.columns = columns;\n        this.rows = rows;\n        this.spWidth = spWidth;\n        this.spHeight = spHeight;\n        this.spacing = spacing || 0;\n      }\n      this.sprites = new Array(this.columns * this.rows);\n      loadFromImage = true;\n    }\n\n    // Inspect actual image dimensions with preloading\n    if (this.image instanceof Texture) {\n      let isWidthError: boolean = false;\n      let isHeightError: boolean = false;\n      this.image.loaded.then((image: HTMLImageElement) => {\n        isWidthError = this.spWidth * this.columns > image.naturalWidth;\n        isHeightError = this.spHeight * this.rows > image.naturalHeight;\n      });\n      if (isWidthError) {\n        throw new RangeError(\n          `SpriteSheet specified is wider, ` +\n            `${this.columns} cols x ${this.spWidth} pixels > ${this.image.image.naturalWidth} ` +\n            `pixels than image width`\n        );\n      }\n      if (isHeightError) {\n        throw new RangeError(\n          `SpriteSheet specified is taller, ` +\n            `${this.rows} rows x ${this.spHeight} pixels > ${this.image.image.naturalHeight} ` +\n            `pixels than image height`\n        );\n      }\n    }\n\n    if (loadFromImage) {\n      for (let i = 0; i < this.rows; i++) {\n        for (let j = 0; j < this.columns; j++) {\n          this.sprites[j + i * this.columns] = new Sprite(\n            this.image,\n            j * this.spWidth + this.spacing * j + this.spacing,\n            i * this.spHeight + this.spacing * i + this.spacing,\n            this.spWidth,\n            this.spHeight\n          );\n        }\n      }\n    }\n  }\n\n  /**\n   * Create an animation from the this SpriteSheet by listing out the\n   * sprite indices. Sprites are organized in row major order in the SpriteSheet.\n   * @param engine   Reference to the current game [[Engine]]\n   * @param indices  An array of sprite indices to use in the animation\n   * @param speed    The number in milliseconds to display each frame in the animation\n   */\n  public getAnimationByIndices(engine: Engine, indices: number[], speed: number) {\n    let images: Sprite[] = indices.map((index) => {\n      return this.sprites[index];\n    });\n\n    images = images.map(function(i) {\n      return i.clone();\n    });\n    return new Animation(engine, images, speed);\n  }\n\n  /**\n   * Create an animation from the this SpriteSheet by specifying the range of\n   * images with the beginning (inclusive) and ending (exclusive) index\n   * For example `getAnimationBetween(engine, 0, 5, 200)` returns an animation with 5 frames.\n   * @param engine      Reference to the current game Engine\n   * @param beginIndex  The index to start taking frames (inclusive)\n   * @param endIndex    The index to stop taking frames (exclusive)\n   * @param speed       The number in milliseconds to display each frame in the animation\n   */\n  public getAnimationBetween(engine: Engine, beginIndex: number, endIndex: number, speed: number) {\n    let images = this.sprites.slice(beginIndex, endIndex);\n    images = images.map(function(i) {\n      return i.clone();\n    });\n    return new Animation(engine, images, speed);\n  }\n\n  /**\n   * Treat the entire SpriteSheet as one animation, organizing the frames in\n   * row major order.\n   * @param engine  Reference to the current game [[Engine]]\n   * @param speed   The number in milliseconds to display each frame the animation\n   */\n  public getAnimationForAll(engine: Engine, speed: number) {\n    const sprites = this.sprites.map(function(i) {\n      return i.clone();\n    });\n    return new Animation(engine, sprites, speed);\n  }\n\n  /**\n   * Retrieve a specific sprite from the SpriteSheet by its index. Sprites are organized\n   * in row major order in the SpriteSheet.\n   * @param index  The index of the sprite\n   */\n  public getSprite(index: number): Sprite {\n    if (index >= 0 && index < this.sprites.length) {\n      return this.sprites[index];\n    } else {\n      throw new Error('Invalid index: ' + index);\n    }\n  }\n\n  /**\n   * Get an animation with bespoke sprite coordinates. This is useful if the SpriteSheet is\n   * packed and not a uniform width or height. The resulting [[Animation]] will have the height and width of the\n   * largest dimension (width, height) from among the sprite coordinates\n   * @param engine\n   * @param spriteCoordinates\n   * @param speed\n   */\n  public getAnimationByCoords(engine: Engine, spriteCoordinates: SpriteArgs[], speed: number): Animation {\n    let maxWidth: number = 0;\n    let maxHeight: number = 0;\n    const sprites: Sprite[] = new Array(spriteCoordinates.length);\n    for (let i = 0; i < spriteCoordinates.length; i++) {\n      const coord = spriteCoordinates[i];\n      // no need to pass image again if using a spritesheet\n      coord.image = coord.image || this.image;\n      maxWidth = Math.max(maxWidth, coord.drawWidth);\n      maxHeight = Math.max(maxHeight, coord.drawHeight);\n      sprites[i] = new Sprite(coord);\n    }\n\n    const anim = new Animation(engine, sprites, speed);\n\n    anim.drawWidth = maxWidth;\n    anim.drawHeight = maxHeight;\n    return anim;\n  }\n}\n\n/**\n * [[include:Constructors.md]]\n */\nexport interface SpriteSheetArgs extends Partial<SpriteSheetImpl> {\n  image: Texture;\n  sprites?: Sprite[];\n  spWidth: number;\n  spHeight: number;\n  rows: number;\n  columns: number;\n  spacing?: number;\n}\n\n/**\n * Sprite sheets are a useful mechanism for slicing up image resources into\n * separate sprites or for generating in game animations. [[Sprite|Sprites]] are organized\n * in row major order in the [[SpriteSheet]].\n *\n * [[include:SpriteSheets.md]]\n */\nexport class SpriteSheet extends Configurable(SpriteSheetImpl) {\n  constructor(config: SpriteSheetArgs);\n  constructor(sprites: Sprite[]);\n  constructor(image: Texture, columns: number, rows: number, spWidth: number, spHeight: number);\n  constructor(\n    imageOrConfigOrSprites: Texture | SpriteSheetArgs | Sprite[],\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number\n  ) {\n    super(imageOrConfigOrSprites, columns, rows, spWidth, spHeight, spacing);\n  }\n}\n\nexport class SpriteFontImpl extends SpriteSheet {\n  private _currentColor: Color = Color.Black;\n  private _currentOpacity: Number = 1.0;\n  private _sprites: { [key: string]: Sprite } = {};\n\n  // text shadow\n  private _textShadowOn: boolean = false;\n  private _textShadowDirty: boolean = true;\n  private _textShadowColor: Color = Color.Black;\n  private _textShadowSprites: { [key: string]: Sprite } = {};\n  private _shadowOffsetX: number = 5;\n  private _shadowOffsetY: number = 5;\n  private _alphabet: string;\n  private _caseInsensitive: boolean;\n\n  /**\n   * @param image           The backing image texture to build the SpriteFont\n   * @param alphabet        A string representing all the characters in the image, in row major order.\n   * @param caseInsensitive  Indicate whether this font takes case into account\n   * @param columns         The number of columns of characters in the image\n   * @param rows            The number of rows of characters in the image\n   * @param spWidth         The width of each character in pixels\n   * @param spHeight        The height of each character in pixels\n   */\n  constructor(\n    imageOrConfig: Texture | SpriteFontArgs,\n    alphabet: string,\n    caseInsensitive: boolean,\n    columns: number,\n    rows: number,\n    spWidth: number,\n    spHeight: number,\n    spacing?: number\n  ) {\n    super(\n      imageOrConfig instanceof Texture ?\n        {\n          image: imageOrConfig,\n          spWidth: spWidth,\n          spHeight: spHeight,\n          rows: rows,\n          columns: columns,\n          spacing: spacing || 0\n        }\n        : imageOrConfig\n    );\n\n    if (imageOrConfig && !(imageOrConfig instanceof Texture)) {\n      alphabet = imageOrConfig.alphabet;\n      caseInsensitive = imageOrConfig.caseInsensitive;\n    }\n\n    this._alphabet = alphabet;\n    this._caseInsensitive = caseInsensitive;\n    this._sprites = this.getTextSprites();\n  }\n\n  /**\n   * Returns a dictionary that maps each character in the alphabet to the appropriate [[Sprite]].\n   */\n  public getTextSprites(): { [key: string]: Sprite } {\n    const lookup: { [key: string]: Sprite } = {};\n    for (let i = 0; i < this._alphabet.length; i++) {\n      let char = this._alphabet[i];\n      if (this._caseInsensitive) {\n        char = char.toLowerCase();\n      }\n      lookup[char] = this.sprites[i].clone();\n    }\n    return lookup;\n  }\n\n  /**\n   * Sets the text shadow for sprite fonts\n   * @param offsetX      The x offset in pixels to place the shadow\n   * @param offsetY      The y offset in pixels to place the shadow\n   * @param shadowColor  The color of the text shadow\n   */\n  public setTextShadow(offsetX: number, offsetY: number, shadowColor: Color) {\n    this._textShadowOn = true;\n    this._shadowOffsetX = offsetX;\n    this._shadowOffsetY = offsetY;\n    this._textShadowColor = shadowColor.clone();\n    this._textShadowDirty = true;\n    for (const character in this._sprites) {\n      this._textShadowSprites[character] = this._sprites[character].clone();\n    }\n  }\n\n  /**\n   * Toggles text shadows on or off\n   */\n  public useTextShadow(on: boolean) {\n    this._textShadowOn = on;\n    if (on) {\n      this.setTextShadow(5, 5, this._textShadowColor);\n    }\n  }\n\n  /**\n   * Draws the current sprite font\n   */\n  public draw(ctx: CanvasRenderingContext2D, text: string, x: number, y: number, options: SpriteFontOptions) {\n    options = this._parseOptions(options);\n\n    if (this._currentColor.toString() !== options.color.toString() || this._currentOpacity !== options.opacity) {\n      this._currentOpacity = options.opacity;\n      this._currentColor = options.color;\n      for (const char in this._sprites) {\n        this._sprites[char].clearEffects();\n        this._sprites[char].fill(options.color);\n        this._sprites[char].opacity(options.opacity);\n      }\n    }\n\n    if (this._textShadowOn && this._textShadowDirty && this._textShadowColor) {\n      for (const characterShadow in this._textShadowSprites) {\n        this._textShadowSprites[characterShadow].clearEffects();\n        this._textShadowSprites[characterShadow].addEffect(new Effects.Fill(this._textShadowColor.clone()));\n      }\n      this._textShadowDirty = false;\n    }\n\n    // find the current length of text in pixels\n    const sprite = this.sprites[0];\n\n    // find the current height fo the text in pixels\n    const height = sprite.drawHeight;\n\n    // calculate appropriate scale for font size\n    const scale = options.fontSize / height;\n\n    const length = text.length * sprite.drawWidth * scale + text.length * options.letterSpacing;\n\n    let currX = x;\n    if (options.textAlign === TextAlign.Left || options.textAlign === TextAlign.Start) {\n      currX = x;\n    } else if (options.textAlign === TextAlign.Right || options.textAlign === TextAlign.End) {\n      currX = x - length;\n    } else if (options.textAlign === TextAlign.Center) {\n      currX = x - length / 2;\n    }\n\n    let currY = y - height * scale;\n    if (options.baseAlign === BaseAlign.Top || options.baseAlign === BaseAlign.Hanging) {\n      currY = y;\n    } else if (\n      options.baseAlign === BaseAlign.Ideographic ||\n      options.baseAlign === BaseAlign.Bottom ||\n      options.baseAlign === BaseAlign.Alphabetic\n    ) {\n      currY = y - height * scale;\n    } else if (options.baseAlign === BaseAlign.Middle) {\n      currY = y - (height * scale) / 2;\n    }\n\n    for (let i = 0; i < text.length; i++) {\n      let character = text[i];\n      if (this._caseInsensitive) {\n        character = character.toLowerCase();\n      }\n      try {\n        // if text shadow\n        if (this._textShadowOn) {\n          this._textShadowSprites[character].scale.x = scale;\n          this._textShadowSprites[character].scale.y = scale;\n          this._textShadowSprites[character].draw(ctx, currX + this._shadowOffsetX, currY + this._shadowOffsetY);\n        }\n\n        const charSprite = this._sprites[character];\n        charSprite.scale.x = scale;\n        charSprite.scale.y = scale;\n        charSprite.draw(ctx, currX, currY);\n        currX += charSprite.drawWidth + options.letterSpacing;\n      } catch (e) {\n        Logger.getInstance().error(`SpriteFont Error drawing char ${character}`);\n      }\n    }\n  }\n\n  private _parseOptions(options: SpriteFontOptions): SpriteFontOptions {\n    return {\n      fontSize: options.fontSize || 10,\n      letterSpacing: options.letterSpacing || 0,\n      color: options.color || Color.Black,\n      textAlign: typeof options.textAlign === undefined ? TextAlign.Left : options.textAlign,\n      baseAlign: typeof options.baseAlign === undefined ? BaseAlign.Bottom : options.baseAlign,\n      maxWidth: options.maxWidth || -1,\n      opacity: options.opacity || 0\n    };\n  }\n}\n\n/**\n * Specify various font attributes for sprite fonts\n */\nexport interface SpriteFontOptions {\n  color?: Color;\n  opacity?: number;\n  fontSize?: number;\n  letterSpacing?: number;\n  textAlign?: TextAlign;\n  baseAlign?: BaseAlign;\n  maxWidth?: number;\n}\n\n/**\n * [[include:Constructors.md]]\n */\nexport interface SpriteFontArgs extends SpriteSheetArgs {\n  image: Texture;\n  columns: number;\n  rows: number;\n  spWidth: number;\n  spHeight: number;\n  alphabet: string;\n  caseInsensitive: boolean;\n}\n\n/**\n * Sprite fonts are a used in conjunction with a [[Label]] to specify\n * a particular bitmap as a font. Note that some font features are not\n * supported by Sprite fonts.\n *\n * [[include:SpriteFonts.md]]\n */\nexport class SpriteFont extends Configurable(SpriteFontImpl) {\n  constructor(config: SpriteFontArgs);\n  constructor(image: Texture, alphabet: string, caseInsensitive: boolean, columns: number, rows: number, spWidth: number, spHeight: number);\n  constructor(\n    imageOrConfig: Texture | SpriteFontArgs,\n    alphabet?: string,\n    caseInsensitive?: boolean,\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number\n  ) {\n    super(imageOrConfig, alphabet, caseInsensitive, columns, rows, spWidth, spHeight, spacing);\n  }\n}\n","import { Promise } from '../Promises';\nimport { Audio } from './Audio';\n\nexport type ExResponseType = '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text';\n\nexport interface ExResponseTypesLookup {\n  [name: string]: ExResponseType;\n}\n\nexport class ExResponse {\n  public static type: ExResponseTypesLookup = {\n    any: '',\n    blob: 'blob',\n    json: 'json',\n    text: 'text',\n    document: 'document',\n    arraybuffer: 'arraybuffer'\n  };\n}\n\n/**\n * Represents an audio implementation like [[AudioTagInstance]] or [[WebAudioInstance]]\n */\nexport interface AudioImplementation {\n  /**\n   * XHR response type\n   */\n  responseType: ExResponseType;\n\n  /**\n   * Processes raw data and transforms into sound data\n   */\n  processData(data: Blob | ArrayBuffer): Promise<string | AudioBuffer>;\n\n  /**\n   * Factory method that returns an instance of a played audio track\n   */\n  createInstance(data: string | AudioBuffer): Audio;\n}\n","import { Random } from './Random';\nimport { Color } from '../Drawing/Color';\nimport * as Util from '../Util/Util';\n\nfunction _lerp(time: number, a: number, b: number): number {\n  return a + time * (b - a);\n}\n\nfunction _fade(t: number): number {\n  return t * t * t * (t * (t * 6 - 15) + 10);\n}\n\n/**\n * Options for the perlin noise generator\n */\nexport interface PerlinOptions {\n  /**\n   * Random number seed for the Perlin noise generator\n   */\n  seed?: number;\n  /**\n   * Number of octaves to use when generating the noise, the number of octaves is the number of times the perlin\n   * noise is generated and laid on top of itself. Using higher values can increase the curviness of the noise, and\n   * make it look more natural.\n   */\n  octaves?: number;\n  /**\n   * Frequency to use when generating the noise, the higher the number the more quickly the pattern will oscillate. Another way\n   * to think about this is that it is like \"zooming\" out from an infinite pattern determined by the seed.\n   */\n  frequency?: number;\n  /**\n   * The amplitude determines the relative height of the peaks generated in the noise.\n   */\n  amplitude?: number;\n  /**\n   * The persistance determines how quickly the amplitude will drop off, a high degree of persistance results in smoother patterns,\n   * a low degree of persistance generates spiky patterns.\n   */\n  persistance?: number;\n}\n\n/**\n * Generates perlin noise based on the 2002 Siggraph paper http://mrl.nyu.edu/~perlin/noise/\n * Also https://flafla2.github.io/2014/08/09/perlinnoise.html\n */\nexport class PerlinGenerator {\n  private _perm: number[] = [\n    151,\n    160,\n    137,\n    91,\n    90,\n    15,\n    131,\n    13,\n    201,\n    95,\n    96,\n    53,\n    194,\n    233,\n    7,\n    225,\n    140,\n    36,\n    103,\n    30,\n    69,\n    142,\n    8,\n    99,\n    37,\n    240,\n    21,\n    10,\n    23,\n    190,\n    6,\n    148,\n    247,\n    120,\n    234,\n    75,\n    0,\n    26,\n    197,\n    62,\n    94,\n    252,\n    219,\n    203,\n    117,\n    35,\n    11,\n    32,\n    57,\n    177,\n    33,\n    88,\n    237,\n    149,\n    56,\n    87,\n    174,\n    20,\n    125,\n    136,\n    171,\n    168,\n    68,\n    175,\n    74,\n    165,\n    71,\n    134,\n    139,\n    48,\n    27,\n    166,\n    77,\n    146,\n    158,\n    231,\n    83,\n    111,\n    229,\n    122,\n    60,\n    211,\n    133,\n    230,\n    220,\n    105,\n    92,\n    41,\n    55,\n    46,\n    245,\n    40,\n    244,\n    102,\n    143,\n    54,\n    65,\n    25,\n    63,\n    161,\n    1,\n    216,\n    80,\n    73,\n    209,\n    76,\n    132,\n    187,\n    208,\n    89,\n    18,\n    169,\n    200,\n    196,\n    135,\n    130,\n    116,\n    188,\n    159,\n    86,\n    164,\n    100,\n    109,\n    198,\n    173,\n    186,\n    3,\n    64,\n    52,\n    217,\n    226,\n    250,\n    124,\n    123,\n    5,\n    202,\n    38,\n    147,\n    118,\n    126,\n    255,\n    82,\n    85,\n    212,\n    207,\n    206,\n    59,\n    227,\n    47,\n    16,\n    58,\n    17,\n    182,\n    189,\n    28,\n    42,\n    223,\n    183,\n    170,\n    213,\n    119,\n    248,\n    152,\n    2,\n    44,\n    154,\n    163,\n    70,\n    221,\n    153,\n    101,\n    155,\n    167,\n    43,\n    172,\n    9,\n    129,\n    22,\n    39,\n    253,\n    19,\n    98,\n    108,\n    110,\n    79,\n    113,\n    224,\n    232,\n    178,\n    185,\n    112,\n    104,\n    218,\n    246,\n    97,\n    228,\n    251,\n    34,\n    242,\n    193,\n    238,\n    210,\n    144,\n    12,\n    191,\n    179,\n    162,\n    241,\n    81,\n    51,\n    145,\n    235,\n    249,\n    14,\n    239,\n    107,\n    49,\n    192,\n    214,\n    31,\n    181,\n    199,\n    106,\n    157,\n    184,\n    84,\n    204,\n    176,\n    115,\n    121,\n    50,\n    45,\n    127,\n    4,\n    150,\n    254,\n    138,\n    236,\n    205,\n    93,\n    222,\n    114,\n    67,\n    29,\n    24,\n    72,\n    243,\n    141,\n    128,\n    195,\n    78,\n    66,\n    215,\n    61,\n    156,\n    180\n  ];\n  private _p: Uint8Array = new Uint8Array(512);\n  private _random: Random;\n\n  private _defaultPerlinOptions: PerlinOptions = {\n    octaves: 1,\n    frequency: 1,\n    amplitude: 1,\n    persistance: 0.5\n  };\n\n  /**\n   * The persistance determines how quickly the amplitude will drop off, a high degree of persistance results in smoother patterns,\n   * a low degree of persistance generates spiky patterns.\n   */\n  public persistance: number;\n\n  /**\n   * The amplitude determines the relative height of the peaks generated in the noise.\n   */\n  public amplitude: number;\n\n  /**\n   * Frequency to use when generating the noise, the higher the number the more quickly the pattern will oscillate. Another way\n   * to think about this is that it is like \"zooming\" out from an infinite pattern determined by the seed.\n   */\n  public frequency: number;\n\n  /**\n   * Number of octaves to use when generating the noise, the number of octaves is the number of times the perlin\n   * noise is generated and laid on top of itself. Using higher values can increase the curviness of the noise, and\n   * make it look more natural.\n   */\n  public octaves: number;\n\n  constructor(options?: PerlinOptions) {\n    options = Util.extend({}, this._defaultPerlinOptions, options);\n\n    this.persistance = options.persistance;\n    this.amplitude = options.amplitude;\n    this.frequency = options.frequency;\n    this.octaves = options.octaves;\n\n    if (options.seed) {\n      this._random = new Random(options.seed);\n    } else {\n      this._random = new Random();\n    }\n\n    this._perm = this._random.shuffle(this._perm);\n\n    for (let i = 0; i < 512; i++) {\n      this._p[i] = this._perm[i % 256] & 0xff;\n    }\n  }\n\n  /**\n   * Generates 1-Dimensional perlin noise given an x and generates noises values between [0, 1].\n   */\n  public noise(x: number): number;\n  /**\n   * Generates 2-Dimensional perlin noise given an (x, y) and generates noise values between [0, 1]\n   */\n  public noise(x: number, y: number): number;\n  /**\n   * Generates 3-Dimensional perlin noise given an (x, y, z) and generates noise values between [0, 1]\n   */\n  public noise(x: number, y: number, z: number): number;\n  public noise(): number {\n    let amp = this.amplitude;\n    let freq = this.frequency;\n\n    let total = 0;\n    let maxValue = 0;\n    for (let i = 0; i < this.octaves; i++) {\n      switch (arguments.length) {\n        case 1:\n          total += this._noise1d(arguments[0] * freq) * amp;\n          break;\n        case 2:\n          total += this._noise2d(arguments[0] * freq, arguments[1] * freq) * amp;\n          break;\n        case 3:\n          total += this._noise3d(arguments[0] * freq, arguments[1] * freq, arguments[2] * freq) * amp;\n          break;\n        /* istanbul ignore next */\n        default:\n          throw new Error('Invalid arguments for perlin noise');\n      }\n      maxValue += amp;\n      amp *= this.persistance;\n      freq *= 2;\n    }\n    return total / maxValue;\n  }\n\n  /**\n   * Generates a list starting at 0 and ending at 1 of continuous perlin noise, by default the step is 1/length;\n   *\n   */\n  public sequence(length: number, step?: number): number[] {\n    if (!step) {\n      step = 1 / length;\n    }\n    const array: number[] = new Array(length);\n    for (let i = 0; i < length; i++) {\n      array[i] = this.noise(i * step);\n    }\n    return array;\n  }\n\n  /**\n   * Generates a 2D grid of perlin noise given a step value packed into a 1D array i = (x + y*width),\n   * by default the step will 1/(min(dimension))\n   */\n  public grid(width: number, height: number, step?: number): number[] {\n    if (!step) {\n      step = 1 / Math.min(width, height);\n    }\n\n    const array: number[] = new Array(width * height);\n\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        array[x + y * width] = this.noise(x * step, y * step);\n      }\n    }\n\n    return array;\n  }\n\n  private _gradient3d(hash: number, x: number, y: number, z: number) {\n    const h = hash & 0xf;\n    const u = h < 8 ? x : y;\n    const v = h < 4 ? y : h === 12 || h === 14 ? x : z;\n    return ((h & 0b1) === 0 ? u : -u) + ((h & 0b10) === 0 ? v : -v);\n  }\n\n  private _gradient2d(hash: number, x: number, y: number) {\n    const value = (hash & 0b1) === 0 ? x : y;\n    return (hash & 0b10) === 0 ? -value : value;\n  }\n\n  private _gradient1d(hash: number, x: number) {\n    return (hash & 0b1) === 0 ? -x : x;\n  }\n\n  private _noise1d(x: number) {\n    const intX = Math.floor(x) & 0xff; // force 0-255 integers to lookup in permutation\n    x -= Math.floor(x);\n    const fadeX = _fade(x);\n    return (_lerp(fadeX, this._gradient1d(this._p[intX], x), this._gradient1d(this._p[intX + 1], x - 1)) + 1) / 2;\n  }\n\n  private _noise2d(x: number, y: number) {\n    const intX = Math.floor(x) & 0xff;\n    const intY = Math.floor(y) & 0xff;\n\n    x -= Math.floor(x);\n    y -= Math.floor(y);\n\n    const fadeX = _fade(x);\n    const fadeY = _fade(y);\n    const a = this._p[intX] + intY;\n    const b = this._p[intX + 1] + intY;\n    return (\n      (_lerp(\n        fadeY,\n        _lerp(fadeX, this._gradient2d(this._p[a], x, y), this._gradient2d(this._p[b], x - 1, y)),\n        _lerp(fadeX, this._gradient2d(this._p[a + 1], x, y - 1), this._gradient2d(this._p[b + 1], x - 1, y - 1))\n      ) +\n        1) /\n      2\n    );\n  }\n\n  private _noise3d(x: number, y: number, z: number) {\n    const intX = Math.floor(x) & 0xff;\n    const intY = Math.floor(y) & 0xff;\n    const intZ = Math.floor(z) & 0xff;\n\n    x -= Math.floor(x);\n    y -= Math.floor(y);\n    z -= Math.floor(z);\n\n    const fadeX = _fade(x);\n    const fadeY = _fade(y);\n    const fadeZ = _fade(z);\n\n    const a = this._p[intX] + intY;\n    const b = this._p[intX + 1] + intY;\n\n    const aa = this._p[a] + intZ;\n    const ba = this._p[b] + intZ;\n\n    const ab = this._p[a + 1] + intZ;\n    const bb = this._p[b + 1] + intZ;\n\n    return (\n      (_lerp(\n        fadeZ,\n        _lerp(\n          fadeY,\n          _lerp(fadeX, this._gradient3d(this._p[aa], x, y, z), this._gradient3d(this._p[ba], x - 1, y, z)),\n          _lerp(fadeX, this._gradient3d(this._p[ab], x, y - 1, z), this._gradient3d(this._p[bb], x - 1, y - 1, z))\n        ),\n        _lerp(\n          fadeY,\n          _lerp(fadeX, this._gradient3d(this._p[aa + 1], x, y, z - 1), this._gradient3d(this._p[ba + 1], x - 1, y, z - 1)),\n          _lerp(fadeX, this._gradient3d(this._p[ab + 1], x, y - 1, z - 1), this._gradient3d(this._p[bb + 1], x - 1, y - 1, z - 1))\n        )\n      ) +\n        1) /\n      2\n    );\n  }\n}\n\n/**\n * A helper to draw 2D perlin maps given a perlin generator and a function\n */\nexport class PerlinDrawer2D {\n  /**\n   * @param generator - An existing perlin generator\n   * @param colorFcn - A color function that takes a value between [0, 255] derived from the perlin generator, and returns a color\n   */\n  constructor(public generator: PerlinGenerator, public colorFcn?: (val: number) => Color) {\n    if (!colorFcn) {\n      this.colorFcn = (val: number) => {\n        return val < 125 ? Color.Black : Color.White;\n      };\n    }\n  }\n\n  /**\n   * Returns an image of 2D perlin noise\n   */\n  public image(width: number, height: number): HTMLImageElement {\n    const image = document.createElement('img');\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    const ctx = canvas.getContext('2d');\n    this.draw(ctx, 0, 0, width, height);\n    image.src = canvas.toDataURL();\n    return image;\n  }\n\n  /**\n   * This draws a 2D perlin grid on a canvas context, not recommended to be called every frame due to performance\n   */\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number, width: number, height: number) {\n    const grid = this.generator.grid(width, height);\n    const imageData = ctx.getImageData(x, y, width, height);\n    for (let j = 0; j < height; j++) {\n      for (let i = 0; i < width; i++) {\n        const val = grid[i + width * j];\n        const c = Math.floor(val * 255) & 0xff;\n        const pixel = (i + j * imageData.width) * 4;\n        const color = this.colorFcn(c);\n\n        imageData.data[pixel] = color.r;\n        imageData.data[pixel + 1] = color.g;\n        imageData.data[pixel + 2] = color.b;\n        imageData.data[pixel + 3] = Math.floor(color.a * 255);\n      }\n    }\n    ctx.putImageData(imageData, x, y);\n  }\n}\n","import { Logger } from './../Util/Log';\nimport { PostProcessor } from './PostProcessor';\nimport { Engine } from '../Engine';\n\nexport enum ColorBlindness {\n  Protanope,\n  Deuteranope,\n  Tritanope\n}\n\n/**\n * This post processor can correct colors and simulate color blindness.\n * It is possible to use this on every game, but the game's performance\n * will suffer measurably. It's better to use it as a helpful tool while developing your game.\n * Remember, the best practice is to design with color blindness in mind.\n *\n * [[include:ColorBlind.md]]\n */\nexport class ColorBlindCorrector implements PostProcessor {\n  /*eslint-disable */\n  private _vertexShader =\n    '' +\n    'attribute vec2 a_position;' +\n    'attribute vec2 a_texCoord;' +\n    'uniform vec2 u_resolution;' +\n    'varying vec2 v_texCoord;' +\n    'void main() {' +\n    // convert the rectangle from pixels to 0.0 to 1.0\n    'vec2 zeroToOne = a_position / u_resolution;' +\n    // convert from 0->1 to 0->2\n    'vec2 zeroToTwo = zeroToOne * 2.0;' +\n    // convert from 0->2 to -1->+1 (clipspace)\n    'vec2 clipSpace = zeroToTwo - 1.0;' +\n    'gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);' +\n    // pass the texCoord to the fragment shader\n    // The GPU will interpolate this value between points.\n    'v_texCoord = a_texCoord;' +\n    '}';\n\n  private _fragmentShader =\n    'precision mediump float;' +\n    // our texture\n    'uniform sampler2D u_image;' +\n    // the texCoords passed in from the vertex shader.\n    'varying vec2 v_texCoord;' +\n    // Color blind conversions\n    /*'mat3 m[9] =' +\n   '{' +\n      'mat3(1.0, 0.0, 0.0,  0.0, 1.0, 0.0,  0.0, 0.0, 1.0  ),' + // normal\n      'mat3(0.567, 0.433, 0.0,  0.558, 0.442, 0.0,  0.0, 0.242, 0.758),' + // protanopia\n      'mat3(0.817, 0.183, 0.0,  0.333, 0.667, 0.0,  0.0, 0.125,0.875),' + // protanomaly\n      'mat3(0.625, 0.375, 0.0,  0.7, 0.3, 0.0,  0.0, 0.3,0.7  ),' + // deuteranopia\n      'mat3(0.8, 0.2, 0.0,  0.258, 0.742, 0.0,  0.0, 0.142,0.858),' + // deuteranomaly\n      'mat3(0.95, 0.05, 0.0,  0.0, 0.433, 0.567,  0.0, 0.475,0.525),' + // tritanopia\n      'mat3(0.967, 0.033, 0.0,  0.0, 0.733, 0.267,  0.0, 0.183,0.817),' + // tritanomaly\n      'mat3(0.299, 0.587, 0.114,  0.299, 0.587, 0.114,  0.299, 0.587,0.114),' + // achromatopsia\n      'mat3(0.618, 0.320, 0.062,  0.163, 0.775, 0.062,  0.163, 0.320,0.516)' +  // achromatomaly\n   '};' +*/\n\n    'void main() {' +\n    'vec4 o =  texture2D(u_image, v_texCoord);' +\n    // RGB to LMS matrix conversion\n    'float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);' +\n    'float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);' +\n    'float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);' +\n    // Simulate color blindness\n\n    '//MODE CODE//' +\n    /* Deuteranope for testing\n      'float l = 1.0 * L + 0.0 * M + 0.0 * S;' +\n            'float m = 0.494207 * L + 0.0 * M + 1.24827 * S;' +\n            'float s = 0.0 * L + 0.0 * M + 1.0 * S;' +*/\n\n    // LMS to RGB matrix conversion\n    'vec4 error;' +\n    'error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);' +\n    'error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);' +\n    'error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);' +\n    'error.a = 1.0;' +\n    'vec4 diff = o - error;' +\n    'vec4 correction;' +\n    'correction.r = 0.0;' +\n    'correction.g =  (diff.r * 0.7) + (diff.g * 1.0);' +\n    'correction.b =  (diff.r * 0.7) + (diff.b * 1.0);' +\n    'correction = o + correction;' +\n    'correction.a = o.a;' +\n    '//SIMULATE//' +\n    '}';\n\n  /*eslint-enable */\n  private _internalCanvas: HTMLCanvasElement;\n  private _gl: WebGLRenderingContext;\n  private _program: WebGLProgram;\n\n  constructor(public engine: Engine, public simulate: boolean = false, public colorMode: ColorBlindness = ColorBlindness.Protanope) {\n    this._internalCanvas = document.createElement('canvas');\n    this._internalCanvas.width = engine.drawWidth;\n    this._internalCanvas.height = engine.drawHeight;\n\n    // eslint-disable-next-line\n    this._gl = <WebGLRenderingContext>this._internalCanvas.getContext('webgl', { preserveDrawingBuffer: true });\n\n    this._program = this._gl.createProgram();\n    const fragmentShader = this._getShader('Fragment', this._getFragmentShaderByMode(colorMode));\n    const vertextShader = this._getShader('Vertex', this._vertexShader);\n\n    this._gl.attachShader(this._program, vertextShader);\n    this._gl.attachShader(this._program, fragmentShader);\n    this._gl.linkProgram(this._program);\n\n    if (!this._gl.getProgramParameter(this._program, this._gl.LINK_STATUS)) {\n      Logger.getInstance().error('Unable to link shader program!');\n    }\n\n    this._gl.useProgram(this._program);\n  }\n\n  private _getFragmentShaderByMode(colorMode: ColorBlindness) {\n    let code = '';\n    if (colorMode === ColorBlindness.Protanope) {\n      code =\n        'float l = 0.0 * L + 2.02344 * M + -2.52581 * S;' +\n        'float m = 0.0 * L + 1.0 * M + 0.0 * S;' +\n        'float s = 0.0 * L + 0.0 * M + 1.0 * S;';\n    } else if (colorMode === ColorBlindness.Deuteranope) {\n      code =\n        'float l = 1.0 * L + 0.0 * M + 0.0 * S;' +\n        'float m = 0.494207 * L + 0.0 * M + 1.24827 * S;' +\n        'float s = 0.0 * L + 0.0 * M + 1.0 * S;';\n    } else if (colorMode === ColorBlindness.Tritanope) {\n      code =\n        'float l = 1.0 * L + 0.0 * M + 0.0 * S;' +\n        'float m = 0.0 * L + 1.0 * M + 0.0 * S;' +\n        'float s = -0.395913 * L + 0.801109 * M + 0.0 * S;';\n    }\n\n    if (this.simulate) {\n      this._fragmentShader = this._fragmentShader.replace('//SIMULATE//', 'gl_FragColor = error.rgba;');\n    } else {\n      this._fragmentShader = this._fragmentShader.replace('//SIMULATE//', 'gl_FragColor = correction.rgba;');\n    }\n\n    return this._fragmentShader.replace('//MODE CODE//', code);\n  }\n\n  private _setRectangle(x: number, y: number, width: number, height: number) {\n    const x1 = x;\n    const x2 = x + width;\n    const y1 = y;\n    const y2 = y + height;\n    this._gl.bufferData(this._gl.ARRAY_BUFFER, new Float32Array([x1, y1, x2, y1, x1, y2, x1, y2, x2, y1, x2, y2]), this._gl.STATIC_DRAW);\n  }\n\n  private _getShader(type: string, program: string): WebGLShader {\n    let shader: WebGLShader;\n    if (type === 'Fragment') {\n      shader = this._gl.createShader(this._gl.FRAGMENT_SHADER);\n    } else if (type === 'Vertex') {\n      shader = this._gl.createShader(this._gl.VERTEX_SHADER);\n    } else {\n      Logger.getInstance().error('Error unknown shader type', type);\n    }\n\n    this._gl.shaderSource(shader, program);\n    this._gl.compileShader(shader);\n\n    if (!this._gl.getShaderParameter(shader, this._gl.COMPILE_STATUS)) {\n      Logger.getInstance().error('Unable to compile shader!', this._gl.getShaderInfoLog(shader));\n      return null;\n    }\n\n    return shader;\n  }\n\n  public process(image: ImageData, out: CanvasRenderingContext2D) {\n    // look up where the vertex data needs to go.\n    const positionLocation = this._gl.getAttribLocation(this._program, 'a_position');\n    const texCoordLocation = this._gl.getAttribLocation(this._program, 'a_texCoord');\n\n    const texCoordBuffer = this._gl.createBuffer();\n    this._gl.bindBuffer(this._gl.ARRAY_BUFFER, texCoordBuffer);\n    this._gl.bufferData(\n      this._gl.ARRAY_BUFFER,\n      new Float32Array([0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0]),\n      this._gl.STATIC_DRAW\n    );\n    this._gl.enableVertexAttribArray(texCoordLocation);\n    this._gl.vertexAttribPointer(texCoordLocation, 2, this._gl.FLOAT, false, 0, 0);\n\n    // Create a texture.\n    const texture = this._gl.createTexture();\n    this._gl.bindTexture(this._gl.TEXTURE_2D, texture);\n\n    // Set the parameters so we can render any size image.\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_S, this._gl.CLAMP_TO_EDGE);\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_T, this._gl.CLAMP_TO_EDGE);\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_MIN_FILTER, this._gl.NEAREST);\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_MAG_FILTER, this._gl.NEAREST);\n    // Flip the texture when unpacking into the gl context, gl reads textures in the opposite order as everything else :/\n    this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL, 1);\n    // Upload the image into the texture.\n    this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, image);\n\n    // lookup uniforms\n    const resolutionLocation = this._gl.getUniformLocation(this._program, 'u_resolution');\n\n    // set the resolution\n    this._gl.uniform2f(resolutionLocation, this._internalCanvas.width, this._internalCanvas.height);\n\n    // Create a buffer for the position of the rectangle corners.\n    const positionBuffer = this._gl.createBuffer();\n    this._gl.bindBuffer(this._gl.ARRAY_BUFFER, positionBuffer);\n    this._gl.enableVertexAttribArray(positionLocation);\n    this._gl.vertexAttribPointer(positionLocation, 2, this._gl.FLOAT, false, 0, 0);\n\n    // Set a rectangle the same size as the image.\n    this._setRectangle(0, 0, image.width, image.height);\n\n    // Draw the rectangle.\n    this._gl.drawArrays(this._gl.TRIANGLES, 0, 6);\n\n    // Grab transformed image from internal canvas\n    const pixelData = new Uint8Array(image.width * image.height * 4);\n    this._gl.readPixels(0, 0, image.width, image.height, this._gl.RGBA, this._gl.UNSIGNED_BYTE, pixelData);\n\n    (<any>image.data).set(pixelData);\n\n    out.putImageData(image, 0, 0);\n  }\n}\n","import { Audio } from '../../Interfaces/Audio';\nimport { Promise } from '../../Promises';\nimport * as Util from '../../Util/Util';\nimport { AudioContextFactory } from './AudioContext';\n\n/**\n * Internal class for producing of AudioInstances\n */\n/* istanbul ignore next */\nexport class AudioInstanceFactory {\n  public static create(src: string | AudioBuffer): AudioInstance {\n    if (typeof src === 'string') {\n      return new AudioTagInstance(src);\n    }\n\n    if (src instanceof AudioBuffer) {\n      return new WebAudioInstance(src);\n    }\n\n    return new AudioInstance(src);\n  }\n}\n\n/**\n * Internal class representing base AudioInstance implementation\n */\n/* istanbul ignore next */\nexport class AudioInstance implements Audio {\n  public set loop(value: boolean) {\n    this._loop = value;\n\n    if (this._instance) {\n      this._instance.loop = value;\n      this._wireUpOnEnded();\n    }\n  }\n  public get loop(): boolean {\n    return this._loop;\n  }\n  public set volume(value: number) {\n    this._volume = Util.clamp(value, 0, 1.0);\n  }\n  public get volume(): number {\n    return this._volume;\n  }\n  public set duration(value: number | undefined) {\n    this._duration = value;\n  }\n\n  /**\n   * Duration of the sound, in seconds.\n   */\n  public get duration() {\n    return this._duration;\n  }\n\n  protected _volume = 1;\n  protected _duration: number | undefined = undefined;\n  protected _loop = false;\n  protected _playingPromise: Promise<boolean>;\n  protected _isPlaying = false;\n  protected _isPaused = false;\n  protected _instance: HTMLAudioElement | AudioBufferSourceNode;\n\n  constructor(protected _src: string | AudioBuffer) {}\n\n  public isPlaying() {\n    return this._isPlaying;\n  }\n\n  public pause() {\n    if (!this._isPlaying) {\n      return;\n    }\n\n    this._isPaused = true;\n    this._isPlaying = false;\n  }\n\n  public stop() {\n    if (!this._isPlaying) {\n      return;\n    }\n\n    this._isPlaying = false;\n    this._isPaused = false;\n  }\n\n  public play() {\n    if (this._isPaused) {\n      this._resumePlayBack();\n    }\n\n    if (!this._isPlaying) {\n      this._startPlayBack();\n    }\n\n    return this._playingPromise;\n  }\n\n  protected _startPlayBack() {\n    this._isPlaying = true;\n    this._isPaused = false;\n    this._playingPromise = new Promise<boolean>();\n  }\n\n  protected _resumePlayBack() {\n    if (!this._isPaused) {\n      return;\n    }\n\n    this._isPaused = false;\n    this._isPlaying = true;\n  }\n\n  protected _wireUpOnEnded() {\n    if (!this.loop) {\n      this._instance.onended = () => this._handleOnEnded();\n    }\n  }\n\n  protected _handleOnEnded() {\n    /**\n     * Override me\n     */\n  }\n}\n\n/**\n * Internal class representing a HTML5 audio instance\n */\n/* istanbul ignore next */\nexport class AudioTagInstance extends AudioInstance {\n  public set volume(value: number) {\n    value = Util.clamp(value, 0, 1.0);\n\n    this._volume = value;\n    this._instance.volume = value;\n  }\n  public get volume(): number {\n    return this._volume;\n  }\n\n  protected _src: string;\n  protected _instance: HTMLAudioElement;\n\n  constructor(src: string) {\n    super(src);\n\n    this._instance = new Audio(src);\n  }\n\n  public pause() {\n    if (!this._isPlaying) {\n      return;\n    }\n\n    this._instance.pause();\n    this._isPaused = true;\n    this._isPlaying = false;\n  }\n\n  public stop() {\n    super.stop();\n\n    this._instance.pause();\n    this._instance.currentTime = 0;\n\n    this._handleOnEnded();\n  }\n\n  protected _startPlayBack() {\n    super._startPlayBack();\n\n    this._instance.load();\n    this._instance.loop = this.loop;\n    this._instance.play();\n\n    this._wireUpOnEnded();\n  }\n\n  protected _resumePlayBack() {\n    super._resumePlayBack();\n\n    this._instance.play();\n    this._wireUpOnEnded();\n  }\n\n  protected _handleOnEnded() {\n    this._isPlaying = false;\n    this._isPaused = false;\n    this._playingPromise.resolve(true);\n  }\n}\n\n/**\n * Internal class representing a Web Audio AudioBufferSourceNode instance\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API\n */\n/* istanbul ignore next */\nexport class WebAudioInstance extends AudioInstance {\n  public set volume(value: number) {\n    value = Util.clamp(value, 0, 1.0);\n\n    this._volume = value;\n\n    if (this._isPlaying && this._volumeNode.gain.setTargetAtTime) {\n      // https://developer.mozilla.org/en-US/docs/Web/API/AudioParam/setTargetAtTime\n      // After each .1 seconds timestep, the target value will ~63.2% closer to the target value.\n      // This exponential ramp provides a more pleasant transition in gain\n      this._volumeNode.gain.setTargetAtTime(value, this._audioContext.currentTime, 0.1);\n    } else {\n      this._volumeNode.gain.value = value;\n    }\n  }\n  public get volume(): number {\n    return this._volume;\n  }\n\n  private get _playbackRate(): number {\n    return this._instance ? 1 / (this._instance.playbackRate.value || 1.0) : null;\n  }\n\n  protected _src: AudioBuffer;\n  protected _instance: AudioBufferSourceNode;\n  private _audioContext: AudioContext = AudioContextFactory.create();\n  private _volumeNode = this._audioContext.createGain();\n  private _startTime: number;\n\n  /**\n   * Current playback offset (in seconds)\n   */\n  private _currentOffset = 0;\n\n  constructor(_src: AudioBuffer) {\n    super(_src);\n\n    this._createNewBufferSource();\n  }\n\n  public pause() {\n    super.pause();\n\n    this._instance.stop(0);\n    // Playback rate will be a scale factor of how fast/slow the audio is being played\n    // default is 1.0\n    // we need to invert it to get the time scale\n\n    this._setPauseOffset();\n  }\n\n  public stop() {\n    super.stop();\n\n    this._currentOffset = 0;\n    this._instance.stop(0);\n\n    // handler will not be wired up if we were looping\n    if (!this._instance.onended) {\n      this._handleOnEnded();\n    }\n  }\n\n  protected _startPlayBack() {\n    super._startPlayBack();\n\n    if (!this._instance) {\n      this._createNewBufferSource();\n    }\n\n    this._rememberStartTime();\n\n    this._volumeNode.connect(this._audioContext.destination);\n    this._instance.start(0, 0);\n    this._currentOffset = 0;\n\n    this._playingPromise = new Promise<boolean>();\n    this._wireUpOnEnded();\n  }\n\n  protected _resumePlayBack() {\n    super._resumePlayBack();\n\n    // a buffer source can only be started once\n    // so we need to dispose of the previous instance before\n    // \"resuming\" the next one\n    this._instance.onended = null; // dispose of any previous event handler\n    this._createNewBufferSource();\n\n    const duration = this._playbackRate * this._src.duration;\n    const restartTime = this._currentOffset % duration;\n\n    this._rememberStartTime(restartTime * -1000);\n    this._instance.start(0, restartTime);\n    this._wireUpOnEnded();\n  }\n\n  protected _handleOnEnded() {\n    // pausing calls stop(0) which triggers onended event\n    // so we don't \"resolve\" yet (when we resume we'll try again)\n    if (!this._isPaused) {\n      this._isPlaying = false;\n      this._playingPromise.resolve(true);\n    }\n  }\n\n  private _rememberStartTime(amend?: number) {\n    this._startTime = new Date().getTime() + (amend | 0);\n  }\n\n  private _setPauseOffset() {\n    this._currentOffset = ((new Date().getTime() - this._startTime) * this._playbackRate) / 1000; // in seconds\n  }\n\n  private _createNewBufferSource() {\n    this._instance = this._audioContext.createBufferSource();\n    this._instance.buffer = this._src;\n    this._instance.loop = this.loop;\n    this._instance.playbackRate.setValueAtTime(1.0, 0);\n\n    this._instance.connect(this._volumeNode);\n  }\n}\n","import { Logger } from './Log';\n\n/**\n * Whether or not the browser can play this file as HTML5 Audio\n */\nexport function canPlayFile(file: string): boolean {\n  try {\n    const a = new Audio();\n    const filetype = /.*\\.([A-Za-z0-9]+)$/;\n    const type = file.match(filetype)[1];\n    if (a.canPlayType('audio/' + type)) {\n      return true;\n    } else {\n      return false;\n    }\n  } catch (e) {\n    Logger.getInstance().warn('Cannot determine audio support, assuming no support for the Audio Tag', e);\n    return false;\n  }\n}\n","import { ExResponse } from '../../Interfaces/AudioImplementation';\nimport { Audio } from '../../Interfaces/Audio';\nimport { Engine } from '../../Engine';\nimport { Resource } from '../Resource';\nimport { AudioInstance, AudioInstanceFactory } from './AudioInstance';\nimport { AudioContextFactory } from './AudioContext';\nimport { NativeSoundEvent, NativeSoundProcessedEvent } from '../../Events/MediaEvents';\nimport { Promise } from '../../Promises';\nimport { canPlayFile } from '../../Util/Sound';\n\n/**\n * The [[Sound]] object allows games built in Excalibur to load audio\n * components, from soundtracks to sound effects. [[Sound]] is an [[Loadable]]\n * which means it can be passed to a [[Loader]] to pre-load before a game or level.\n *\n * [[include:Sounds.md]]\n */\nexport class Sound extends Resource<Blob | ArrayBuffer> implements Audio {\n  /**\n   * Indicates whether the clip should loop when complete\n   * @param value  Set the looping flag\n   */\n  public set loop(value: boolean) {\n    this._loop = value;\n\n    for (const track of this._tracks) {\n      track.loop = this._loop;\n    }\n\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._loop);\n  }\n  public get loop(): boolean {\n    return this._loop;\n  }\n\n  public set volume(value: number) {\n    this._volume = value;\n\n    for (const track of this._tracks) {\n      track.volume = this._volume;\n    }\n\n    this.emit('volumechange', new NativeSoundEvent(this));\n\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._volume);\n  }\n  public get volume(): number {\n    return this._volume;\n  }\n\n  public get duration(): number | undefined {\n    return this._duration;\n  }\n\n  /**\n   * Return array of Current AudioInstances playing or being paused\n   */\n  public get instances(): AudioInstance[] {\n    return this._tracks;\n  }\n\n  public path: string;\n\n  private _loop = false;\n  private _volume = 1;\n  private _duration: number | undefined = undefined;\n  private _isStopped = false;\n  private _isPaused = false;\n  private _tracks: AudioInstance[] = [];\n  private _engine: Engine;\n  private _wasPlayingOnHidden: boolean = false;\n  private _processedData = new Promise<string | AudioBuffer>();\n  private _audioContext = AudioContextFactory.create();\n\n  /**\n   * @param paths A list of audio sources (clip.wav, clip.mp3, clip.ogg) for this audio clip. This is done for browser compatibility.\n   */\n  constructor(...paths: string[]) {\n    super('', '');\n\n    this._detectResponseType();\n    /* Chrome : MP3, WAV, Ogg\n     * Firefox : WAV, Ogg,\n     * IE : MP3, WAV coming soon\n     * Safari MP3, WAV, Ogg\n     */\n    for (const path of paths) {\n      if (canPlayFile(path)) {\n        this.path = path;\n        break;\n      }\n    }\n\n    if (!this.path) {\n      this.logger.warn('This browser does not support any of the audio files specified:', paths.join(', '));\n      this.logger.warn('Attempting to use', paths[0]);\n      this.path = paths[0]; // select the first specified\n    }\n  }\n\n  public wireEngine(engine: Engine) {\n    if (engine) {\n      this._engine = engine;\n\n      this._engine.on('hidden', () => {\n        if (engine.pauseAudioWhenHidden && this.isPlaying()) {\n          this._wasPlayingOnHidden = true;\n          this.pause();\n        }\n      });\n\n      this._engine.on('visible', () => {\n        if (engine.pauseAudioWhenHidden && this._wasPlayingOnHidden) {\n          this.play();\n          this._wasPlayingOnHidden = false;\n        }\n      });\n\n      this._engine.on('start', () => {\n        this._isStopped = false;\n      });\n\n      this._engine.on('stop', () => {\n        this.stop();\n        this._isStopped = true;\n      });\n    }\n  }\n\n  /**\n   * Returns how many instances of the sound are currently playing\n   */\n  public instanceCount(): number {\n    return this._tracks.length;\n  }\n\n  /**\n   * Whether or not the sound is playing right now\n   */\n  public isPlaying(): boolean {\n    return this._tracks.some((t) => t.isPlaying());\n  }\n\n  /**\n   * Play the sound, returns a promise that resolves when the sound is done playing\n   * An optional volume argument can be passed in to play the sound. Max volume is 1.0\n   */\n  public play(volume?: number): Promise<boolean> {\n    if (!this.isLoaded()) {\n      this.logger.warn('Cannot start playing. Resource', this.path, 'is not loaded yet');\n\n      return Promise.resolve(true);\n    }\n\n    if (this._isStopped) {\n      this.logger.warn('Cannot start playing. Engine is in a stopped state.');\n      return Promise.resolve(false);\n    }\n\n    this.volume = volume || this.volume;\n\n    if (this._isPaused) {\n      return this._resumePlayback();\n    } else {\n      return this._startPlayback();\n    }\n  }\n\n  /**\n   * Stop the sound, and do not rewind\n   */\n  public pause() {\n    if (!this.isPlaying()) {\n      return;\n    }\n\n    for (const track of this._tracks) {\n      track.pause();\n    }\n\n    this._isPaused = true;\n\n    this.emit('pause', new NativeSoundEvent(this));\n\n    this.logger.debug('Paused all instances of sound', this.path);\n  }\n\n  /**\n   * Stop the sound if it is currently playing and rewind the track. If the sound is not playing, rewinds the track.\n   */\n  public stop() {\n    for (const track of this._tracks) {\n      track.stop();\n    }\n\n    this.emit('stop', new NativeSoundEvent(this));\n\n    this._isPaused = false;\n    this._tracks.length = 0;\n    this.logger.debug('Stopped all instances of sound', this.path);\n  }\n\n  public setData(data: any) {\n    this.emit('emptied', new NativeSoundEvent(this));\n\n    this.data = data;\n    this._processedData = new Promise<string | AudioBuffer>();\n  }\n\n  public processData(data: Blob | ArrayBuffer): Promise<string | AudioBuffer> {\n    /**\n     * Processes raw arraybuffer data and decodes into WebAudio buffer (async).\n     */\n    const processPromise: Promise<string | AudioBuffer> =\n      data instanceof ArrayBuffer ? this._processArrayBufferData(data) : this._processBlobData(data);\n\n    return processPromise.then((processedData) => this._setProcessedData(processedData));\n  }\n\n  /**\n   * Get Id of provided AudioInstance in current trackList\n   * @param track [[AudioInstance]] which Id is to be given\n   */\n  public getTrackId(track: AudioInstance): number {\n    return this._tracks.indexOf(track);\n  }\n\n  private _resumePlayback(): Promise<boolean> {\n    if (this._isPaused) {\n      const resumed = [];\n      // ensure we resume *current* tracks (if paused)\n      for (const track of this._tracks) {\n        resumed.push(track.play());\n      }\n\n      this._isPaused = false;\n\n      this.emit('resume', new NativeSoundEvent(this));\n\n      this.logger.debug('Resuming paused instances for sound', this.path, this._tracks);\n      // resolve when resumed tracks are done\n      return Promise.join(resumed);\n    } else {\n      return Promise.resolve(true);\n    }\n  }\n\n  private _startPlayback(): Promise<boolean> {\n    const newTrack = this._createNewTrack();\n    const playPromise = new Promise<boolean>();\n\n    newTrack.then((track) => {\n      track.play().then((resolved) => {\n        // when done, remove track\n        this.emit('playbackend', new NativeSoundEvent(this, track));\n        this._tracks.splice(this.getTrackId(track), 1);\n\n        playPromise.resolve(resolved);\n\n        return resolved;\n      });\n\n      this.emit('playbackstart', new NativeSoundEvent(this, track));\n      this.logger.debug('Playing new instance for sound', this.path);\n    });\n\n    return playPromise;\n  }\n\n  private _processArrayBufferData(data: ArrayBuffer): Promise<AudioBuffer> {\n    const complete = new Promise<AudioBuffer>();\n\n    this._audioContext.decodeAudioData(\n      data,\n      (buffer: AudioBuffer) => {\n        complete.resolve(buffer);\n      },\n      () => {\n        this.logger.error(\n          'Unable to decode ' +\n            ' this browser may not fully support this format, or the file may be corrupt, ' +\n            'if this is an mp3 try removing id3 tags and album art from the file.'\n        );\n        complete.resolve(undefined);\n      }\n    );\n\n    return complete;\n  }\n\n  private _processBlobData(data: Blob): Promise<string> {\n    return new Promise<string>().resolve(super.processData(data));\n  }\n\n  private _setProcessedData(processedData: string | AudioBuffer): void {\n    this._processedData.resolve(processedData);\n    this._duration = typeof processedData === 'object' ? processedData.duration : undefined;\n    this.emit('processed', new NativeSoundProcessedEvent(this, processedData));\n  }\n\n  private _createNewTrack(): Promise<AudioInstance> {\n    const aiPromise = new Promise<AudioInstance>();\n\n    if (this._processedData.state() !== 0) {\n      this.processData(this.data);\n    }\n\n    this._processedData.then(\n      (processedData) => {\n        aiPromise.resolve(this._getTrackInstance(processedData));\n\n        return processedData;\n      },\n      (error) => {\n        this.logger.error(error, 'Cannot create AudioInstance due to wrong processed data.');\n      }\n    );\n\n    return aiPromise;\n  }\n\n  private _getTrackInstance(data: string | AudioBuffer): AudioInstance {\n    const newTrack = AudioInstanceFactory.create(data);\n\n    newTrack.loop = this.loop;\n    newTrack.volume = this.volume;\n    newTrack.duration = this.duration;\n\n    this._tracks.push(newTrack);\n\n    return newTrack;\n  }\n\n  private _detectResponseType() {\n    if ((<any>window).AudioContext) {\n      this.responseType = ExResponse.type.arraybuffer;\n    } else {\n      this.responseType = ExResponse.type.blob;\n    }\n  }\n}\n","import { Resource } from './Resource';\nimport { Promise } from '../Promises';\nimport { Sprite } from '../Drawing/Sprite';\nimport { Texture } from './Texture';\nimport { Color } from '../Drawing/Color';\nimport { SpriteSheet } from '../Drawing/SpriteSheet';\nimport { Animation } from '../Drawing/Animation';\nimport { Engine } from '../Engine';\n/**\n * The [[Texture]] object allows games built in Excalibur to load image resources.\n * [[Texture]] is an [[Loadable]] which means it can be passed to a [[Loader]]\n * to pre-load before starting a level or game.\n *\n * [[include:Textures.md]]\n */\nexport class Gif extends Resource<Texture[]> {\n  /**\n   * The width of the texture in pixels\n   */\n  public width: number;\n\n  /**\n   * The height of the texture in pixels\n   */\n  public height: number;\n\n  /**\n   * A [[Promise]] that resolves when the Texture is loaded.\n   */\n  public loaded: Promise<any> = new Promise<any>();\n\n  private _isLoaded: boolean = false;\n  private _stream: Stream = null;\n  private _gif: ParseGif = null;\n  private _texture: Texture[] = [];\n  private _animation: Animation = null;\n  private _transparentColor: Color = null;\n\n  /**\n   * Populated once loading is complete\n   */\n  public images: HTMLImageElement;\n\n  /**\n   * @param path       Path to the image resource\n   * @param color      Optionally set the color to treat as transparent the gif, by default [[Color.Magenta]]\n   * @param bustCache  Optionally load texture with cache busting\n   */\n  constructor(public path: string, public color: Color = Color.Magenta, public bustCache = true) {\n    super(path, 'arraybuffer', bustCache);\n    this._transparentColor = color;\n  }\n\n  /**\n   * Returns true if the Texture is completely loaded and is ready\n   * to be drawn.\n   */\n  public isLoaded(): boolean {\n    return this._isLoaded;\n  }\n\n  /**\n   * Begins loading the texture and returns a promise to be resolved on completion\n   */\n  public load(): Promise<Texture[]> {\n    const complete = new Promise<Texture[]>();\n    const loaded = super.load();\n    loaded.then(\n      () => {\n        this._stream = new Stream(this.getData());\n        this._gif = new ParseGif(this._stream, this._transparentColor);\n        const promises: Promise<HTMLImageElement>[] = [];\n        for (let imageIndex: number = 0; imageIndex < this._gif.images.length; imageIndex++) {\n          const texture = new Texture(this._gif.images[imageIndex].src, false);\n          this._texture.push(texture);\n          promises.push(texture.load());\n        }\n        Promise.join(promises).then(() => {\n          this._isLoaded = true;\n          complete.resolve(this._texture);\n        });\n      },\n      () => {\n        complete.reject('Error loading texture.');\n      }\n    );\n    return complete;\n  }\n\n  public asSprite(id: number = 0): Sprite {\n    const sprite = this._texture[id].asSprite();\n    return sprite;\n  }\n\n  public asSpriteSheet(): SpriteSheet {\n    const spriteArray: Sprite[] = this._texture.map((texture) => {\n      return texture.asSprite();\n    });\n    return new SpriteSheet(spriteArray);\n  }\n\n  public asAnimation(engine: Engine, speed: number): Animation {\n    const spriteSheet: SpriteSheet = this.asSpriteSheet();\n    this._animation = spriteSheet.getAnimationForAll(engine, speed);\n    return this._animation;\n  }\n\n  public get readCheckBytes(): number[] {\n    return this._gif.checkBytes;\n  }\n}\n\nexport interface Frame {\n  sentinel: number;\n  type: string;\n  leftPos: number;\n  topPos: number;\n  width: number;\n  height: number;\n  lctFlag: boolean;\n  interlaced: boolean;\n  sorted: boolean;\n  reserved: boolean[];\n  lctSize: number;\n  lzwMinCodeSize: number;\n  pixels: number[];\n}\n\nconst bitsToNum = (ba: any) => {\n  return ba.reduce(function(s: number, n: number) {\n    return s * 2 + n;\n  }, 0);\n};\n\nconst byteToBitArr = (bite: any) => {\n  const a = [];\n  for (let i = 7; i >= 0; i--) {\n    a.push(!!(bite & (1 << i)));\n  }\n  return a;\n};\n\nexport class Stream {\n  data: any = null;\n  len: number = 0;\n  position: number = 0;\n\n  constructor(dataArray: ArrayBuffer) {\n    this.data = new Uint8Array(dataArray);\n    this.len = this.data.byteLength;\n    if (this.len === 0) {\n      throw new Error('No data loaded from file');\n    }\n  }\n\n  public readByte = () => {\n    if (this.position >= this.data.byteLength) {\n      throw new Error('Attempted to read past end of stream.');\n    }\n    return this.data[this.position++];\n  };\n\n  public readBytes = (n: number) => {\n    const bytes = [];\n    for (let i = 0; i < n; i++) {\n      bytes.push(this.readByte());\n    }\n    return bytes;\n  };\n\n  public read = (n: number) => {\n    let s = '';\n    for (let i = 0; i < n; i++) {\n      s += String.fromCharCode(this.readByte());\n    }\n    return s;\n  };\n\n  public readUnsigned = () => {\n    // Little-endian.\n    const a = this.readBytes(2);\n    return (a[1] << 8) + a[0];\n  };\n}\n\nconst lzwDecode = function(minCodeSize: number, data: any) {\n  // TODO: Now that the GIF parser is a bit different, maybe this should get an array of bytes instead of a String?\n  let pos = 0; // Maybe this streaming thing should be merged with the Stream?\n\n  const readCode = function(size: number) {\n    let code = 0;\n    for (let i = 0; i < size; i++) {\n      if (data.charCodeAt(pos >> 3) & (1 << (pos & 7))) {\n        code |= 1 << i;\n      }\n      pos++;\n    }\n    return code;\n  };\n\n  const output: any[] = [];\n\n  const clearCode = 1 << minCodeSize;\n  const eoiCode = clearCode + 1;\n\n  let codeSize = minCodeSize + 1;\n\n  let dict: any[] = [];\n\n  const clear = function() {\n    dict = [];\n    codeSize = minCodeSize + 1;\n    for (let i = 0; i < clearCode; i++) {\n      dict[i] = [i];\n    }\n    dict[clearCode] = [];\n    dict[eoiCode] = null;\n  };\n\n  let code;\n  let last;\n\n  while (true) {\n    last = code;\n    code = readCode(codeSize);\n    if (code === clearCode) {\n      clear();\n      continue;\n    }\n    if (code === eoiCode) {\n      break;\n    }\n\n    if (code < dict.length) {\n      if (last !== clearCode) {\n        dict.push(dict[last].concat(dict[code][0]));\n      }\n    } else {\n      if (code !== dict.length) {\n        throw new Error('Invalid LZW code.');\n      }\n      dict.push(dict[last].concat(dict[last][0]));\n    }\n    output.push.apply(output, dict[code]);\n\n    if (dict.length === 1 << codeSize && codeSize < 12) {\n      // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\n      codeSize++;\n    }\n  }\n\n  // I don't know if this is technically an error, but some GIFs do it.\n  //if (Math.ceil(pos / 8) !== data.length) throw new Error('Extraneous LZW bytes.');\n  return output;\n};\n\n// The actual parsing; returns an object with properties.\nexport class ParseGif {\n  private _st: Stream = null;\n  private _handler: any = {};\n  private _transparentColor: Color = null;\n  public frames: Frame[] = [];\n  public images: HTMLImageElement[] = [];\n  public globalColorTable: any[] = [];\n  public checkBytes: number[] = [];\n\n  constructor(stream: Stream, color: Color = Color.Magenta) {\n    this._st = stream;\n    this._handler = {};\n    this._transparentColor = color;\n    this.parseHeader();\n    this.parseBlock();\n  }\n\n  // LZW (GIF-specific)\n  parseColorTable = (entries: any) => {\n    // Each entry is 3 bytes, for RGB.\n    const ct = [];\n    for (let i = 0; i < entries; i++) {\n      const rgb: number[] = this._st.readBytes(3);\n      const rgba =\n        '#' +\n        rgb\n          .map((x: any) => {\n            const hex = x.toString(16);\n            return hex.length === 1 ? '0' + hex : hex;\n          })\n          .join('');\n      ct.push(rgba);\n    }\n    return ct;\n  };\n\n  readSubBlocks = () => {\n    let size, data;\n    data = '';\n    do {\n      size = this._st.readByte();\n      data += this._st.read(size);\n    } while (size !== 0);\n    return data;\n  };\n\n  parseHeader = () => {\n    const hdr: any = {\n      sig: null,\n      ver: null,\n      width: null,\n      height: null,\n      colorRes: null,\n      globalColorTableSize: null,\n      gctFlag: null,\n      sorted: null,\n      globalColorTable: [],\n      bgColor: null,\n      pixelAspectRatio: null // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\n    };\n\n    hdr.sig = this._st.read(3);\n    hdr.ver = this._st.read(3);\n    if (hdr.sig !== 'GIF') {\n      throw new Error('Not a GIF file.'); // XXX: This should probably be handled more nicely.\n    }\n\n    hdr.width = this._st.readUnsigned();\n    hdr.height = this._st.readUnsigned();\n\n    const bits = byteToBitArr(this._st.readByte());\n    hdr.gctFlag = bits.shift();\n    hdr.colorRes = bitsToNum(bits.splice(0, 3));\n    hdr.sorted = bits.shift();\n    hdr.globalColorTableSize = bitsToNum(bits.splice(0, 3));\n\n    hdr.bgColor = this._st.readByte();\n    hdr.pixelAspectRatio = this._st.readByte(); // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\n\n    if (hdr.gctFlag) {\n      hdr.globalColorTable = this.parseColorTable(1 << (hdr.globalColorTableSize + 1));\n      this.globalColorTable = hdr.globalColorTable;\n    }\n    if (this._handler.hdr && this._handler.hdr(hdr)) {\n      this.checkBytes.push(this._handler.hdr);\n    }\n  };\n\n  parseExt = (block: any) => {\n    const parseGCExt = (block: any) => {\n      this.checkBytes.push(this._st.readByte()); // Always 4\n\n      const bits = byteToBitArr(this._st.readByte());\n      block.reserved = bits.splice(0, 3); // Reserved; should be 000.\n      block.disposalMethod = bitsToNum(bits.splice(0, 3));\n      block.userInput = bits.shift();\n      block.transparencyGiven = bits.shift();\n\n      block.delayTime = this._st.readUnsigned();\n\n      block.transparencyIndex = this._st.readByte();\n\n      block.terminator = this._st.readByte();\n\n      if (this._handler.gce && this._handler.gce(block)) {\n        this.checkBytes.push(this._handler.gce);\n      }\n    };\n\n    const parseComExt = (block: any) => {\n      block.comment = this.readSubBlocks();\n      if (this._handler.com && this._handler.com(block)) {\n        this.checkBytes.push(this._handler.com);\n      }\n    };\n\n    const parsePTExt = (block: any) => {\n      this.checkBytes.push(this._st.readByte()); // Always 12\n      block.ptHeader = this._st.readBytes(12);\n      block.ptData = this.readSubBlocks();\n      if (this._handler.pte && this._handler.pte(block)) {\n        this.checkBytes.push(this._handler.pte);\n      }\n    };\n\n    const parseAppExt = (block: any) => {\n      const parseNetscapeExt = (block: any) => {\n        this.checkBytes.push(this._st.readByte()); // Always 3\n        block.unknown = this._st.readByte(); // ??? Always 1? What is this?\n        block.iterations = this._st.readUnsigned();\n        block.terminator = this._st.readByte();\n        if (this._handler.app && this._handler.app.NETSCAPE && this._handler.app.NETSCAPE(block)) {\n          this.checkBytes.push(this._handler.app);\n        }\n      };\n\n      const parseUnknownAppExt = (block: any) => {\n        block.appData = this.readSubBlocks();\n        // FIXME: This won't work if a handler wants to match on any identifier.\n        if (this._handler.app && this._handler.app[block.identifier] && this._handler.app[block.identifier](block)) {\n          this.checkBytes.push(this._handler.app[block.identifier]);\n        }\n      };\n\n      this.checkBytes.push(this._st.readByte()); // Always 11\n      block.identifier = this._st.read(8);\n      block.authCode = this._st.read(3);\n      switch (block.identifier) {\n        case 'NETSCAPE':\n          parseNetscapeExt(block);\n          break;\n        default:\n          parseUnknownAppExt(block);\n          break;\n      }\n    };\n\n    const parseUnknownExt = (block: any) => {\n      block.data = this.readSubBlocks();\n      if (this._handler.unknown && this._handler.unknown(block)) {\n        this.checkBytes.push(this._handler.unknown);\n      }\n    };\n\n    block.label = this._st.readByte();\n    switch (block.label) {\n      case 0xf9:\n        block.extType = 'gce';\n        parseGCExt(block);\n        break;\n      case 0xfe:\n        block.extType = 'com';\n        parseComExt(block);\n        break;\n      case 0x01:\n        block.extType = 'pte';\n        parsePTExt(block);\n        break;\n      case 0xff:\n        block.extType = 'app';\n        parseAppExt(block);\n        break;\n      default:\n        block.extType = 'unknown';\n        parseUnknownExt(block);\n        break;\n    }\n  };\n\n  parseImg = (img: any) => {\n    const deinterlace = (pixels: any, width: any) => {\n      // Of course this defeats the purpose of interlacing. And it's *probably*\n      // the least efficient way it's ever been implemented. But nevertheless...\n\n      const newPixels = new Array(pixels.length);\n      const rows = pixels.length / width;\n      const cpRow = (toRow: any, fromRow: any) => {\n        const fromPixels = pixels.slice(fromRow * width, (fromRow + 1) * width);\n        newPixels.splice.apply(newPixels, [toRow * width, width].concat(fromPixels));\n      };\n\n      const offsets = [0, 4, 2, 1];\n      const steps = [8, 8, 4, 2];\n\n      let fromRow = 0;\n      for (let pass = 0; pass < 4; pass++) {\n        for (let toRow = offsets[pass]; toRow < rows; toRow += steps[pass]) {\n          cpRow(toRow, fromRow);\n          fromRow++;\n        }\n      }\n\n      return newPixels;\n    };\n\n    img.leftPos = this._st.readUnsigned();\n    img.topPos = this._st.readUnsigned();\n    img.width = this._st.readUnsigned();\n    img.height = this._st.readUnsigned();\n\n    const bits = byteToBitArr(this._st.readByte());\n    img.lctFlag = bits.shift();\n    img.interlaced = bits.shift();\n    img.sorted = bits.shift();\n    img.reserved = bits.splice(0, 2);\n    img.lctSize = bitsToNum(bits.splice(0, 3));\n\n    if (img.lctFlag) {\n      img.lct = this.parseColorTable(1 << (img.lctSize + 1));\n    }\n\n    img.lzwMinCodeSize = this._st.readByte();\n\n    const lzwData = this.readSubBlocks();\n\n    img.pixels = lzwDecode(img.lzwMinCodeSize, lzwData);\n\n    if (img.interlaced) {\n      // Move\n      img.pixels = deinterlace(img.pixels, img.width);\n    }\n\n    this.frames.push(img);\n    this.arrayToImage(img);\n    if (this._handler.img && this._handler.img(img)) {\n      this.checkBytes.push(this._handler);\n    }\n  };\n\n  public parseBlock = () => {\n    const block = {\n      sentinel: this._st.readByte(),\n      type: ''\n    };\n    const blockChar = String.fromCharCode(block.sentinel);\n    switch (blockChar) {\n      case '!':\n        block.type = 'ext';\n        this.parseExt(block);\n        break;\n      case ',':\n        block.type = 'img';\n        this.parseImg(block);\n        break;\n      case ';':\n        block.type = 'eof';\n        if (this._handler.eof && this._handler.eof(block)) {\n          this.checkBytes.push(this._handler.eof);\n        }\n        break;\n      default:\n        throw new Error('Unknown block: 0x' + block.sentinel.toString(16));\n    }\n\n    if (block.type !== 'eof') {\n      this.parseBlock();\n    }\n  };\n\n  arrayToImage = (frame: Frame) => {\n    let count = 0;\n    const c = document.createElement('canvas');\n    c.id = count.toString();\n    c.width = frame.width;\n    c.height = frame.height;\n    count++;\n    const context = c.getContext('2d');\n    const pixSize = 1;\n    let y = 0;\n    let x = 0;\n    for (let i = 0; i < frame.pixels.length; i++) {\n      if (x % frame.width === 0) {\n        y++;\n        x = 0;\n      }\n      if (this.globalColorTable[frame.pixels[i]] === this._transparentColor.toHex()) {\n        context.fillStyle = `rgba(0, 0, 0, 0)`;\n      } else {\n        context.fillStyle = this.globalColorTable[frame.pixels[i]];\n      }\n\n      context.fillRect(x, y, pixSize, pixSize);\n      x++;\n    }\n    const img = new Image();\n    img.src = c.toDataURL();\n    this.images.push(img);\n  };\n}\n","/**\n * The current Excalibur version string\n * @description `process.env.__EX_VERSION` gets replaced by Webpack on build\n */\nexport const EX_VERSION = process.env.__EX_VERSION;\nimport { polyfill } from './Polyfill';\npolyfill();\n\n// This file is used as the bundle entry point and exports everything\n// that will be exposed as the `ex` global variable.\n\nexport * from './Engine';\nexport { Actor, ActorArgs } from './Actor';\nexport { CollisionType } from './Collision/CollisionType';\nexport * from './Algebra';\nexport * from './Camera';\nexport * from './Class';\nexport * from './Configurable';\nexport * from './Debug';\nexport * from './EventDispatcher';\nexport * from './Events/MediaEvents';\nexport * from './Events';\nexport { Label, FontStyle, FontUnit, TextAlign, BaseAlign } from './Label';\nexport * from './Loader';\nexport { Particle, ParticleEmitter, ParticleArgs, ParticleEmitterArgs, EmitterType } from './Particles';\nexport * from './Physics';\nexport * from './Promises';\nexport * from './Scene';\nexport { TileMap, Cell, TileMapArgs, CellArgs, TileSprite } from './TileMap';\nexport * from './Timer';\nexport * from './Trigger';\nexport * from './ScreenElement';\n\nexport * from './Actions/Index';\nexport * from './Collision/Index';\nexport * from './Drawing/Index';\nexport * from './Interfaces/Index';\nexport * from './Math/Index';\nexport * from './PostProcessing/Index';\nexport * from './Resources/Index';\n\n// ex.Events namespace\nimport * as events from './Events';\nexport { events as Events };\n\n// ex.Input namespace\nimport * as input from './Input/Index';\nexport { input as Input };\n\n// ex.Traits namespace\nimport * as traits from './Traits/Index';\nexport { traits as Traits };\n\n// ex.Util namespaces\nimport * as util from './Util/Index';\nexport { util as Util };\n\nexport * from './Util/Browser';\nexport * from './Util/Decorators';\nexport * from './Util/Detector';\nexport * from './Util/CullingBox';\nexport * from './Util/EasingFunctions';\nexport * from './Util/Log';\nexport * from './Util/SortedList';\n\n// ex.Deprecated\n// import * as deprecated from './Deprecated';\n// export { deprecated as Deprecated };\n// export * from './Deprecated';\n"],"sourceRoot":""}