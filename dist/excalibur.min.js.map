{"version":3,"sources":["webpack://ex/webpack/universalModuleDefinition","webpack://ex/webpack/bootstrap","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/export.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/fails.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/descriptors.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/to-object.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/is-object.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/well-known-symbol.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/global.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-define-property.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/to-length.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-method-uses-to-length.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/has.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/to-indexed-object.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/an-object.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-method-is-strict.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/add-to-unscopables.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-iteration.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/create-non-enumerable-property.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-get-own-property-descriptor.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/a-function.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/create-property.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/is-array.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/to-integer.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/to-primitive.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-get-prototype-of.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/set-to-string-tag.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/create-property-descriptor.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/is-pure.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/hidden-keys.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/indexed-object.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/get-built-in.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/path.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/to-absolute-index.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-keys.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/iterators.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-species-create.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-method-has-species-support.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/internal-state.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/shared-key.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/uid.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-property-is-enumerable.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/classof-raw.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/redefine.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-create.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/function-bind-context.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/engine-v8-version.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/freezing.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-prototype-accessors-forced.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/require-object-coercible.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/shared-store.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/set-global.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/shared.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-get-own-property-names.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-includes.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/enum-bug-keys.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-get-own-property-symbols.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/native-symbol.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/to-string-tag-support.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/internal-metadata.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/inspect-source.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/ie8-dom-define.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/document-create-element.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/define-iterator.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/own-keys.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-keys-internal.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/iterators-core.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/correct-prototype-getter.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/use-symbol-as-uid.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-define-properties.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-set-prototype-of.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/iterator-close.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/is-array-iterator-method.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/get-iterator-method.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/classof.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/flatten-into-array.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-reduce.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/engine-is-node.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-get-own-property-names-external.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/well-known-symbol-wrapped.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-to-array.js","webpack://ex/./Loader.css","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/css-loader/dist/runtime/api.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/es/array/index.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.string.iterator.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/string-multibyte.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/native-weak-map.js","webpack://ex/(webpack)/buildin/global.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/copy-constructor-properties.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/is-forced.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/create-iterator-constructor.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/html.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/a-possible-prototype.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.from.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-from.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/call-with-safe-iteration-closing.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/check-correctness-of-iteration.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.is-array.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.of.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.concat.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/engine-user-agent.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.copy-within.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-copy-within.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.every.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.fill.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-fill.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.filter.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.find.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.find-index.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.flat.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.flat-map.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.for-each.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-for-each.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.includes.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.index-of.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.iterator.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.join.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.last-index-of.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/array-last-index-of.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.map.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.reduce.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.reduce-right.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.reverse.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.slice.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.some.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.sort.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.species.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/set-species.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.splice.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.unscopables.flat.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.array.unscopables.flat-map.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/es/object/index.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.symbol.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/define-well-known-symbol.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.assign.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-assign.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.create.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.define-property.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.define-properties.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.entries.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.freeze.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.from-entries.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/iterate.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.get-own-property-descriptor.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.get-own-property-descriptors.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.get-own-property-names.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.get-prototype-of.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.is.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/same-value.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.is-extensible.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.is-frozen.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.is-sealed.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.keys.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.prevent-extensions.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.seal.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.set-prototype-of.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.values.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.to-string.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/object-to-string.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.define-getter.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.define-setter.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.lookup-getter.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.object.lookup-setter.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.json.to-string-tag.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.math.to-string-tag.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.reflect.to-string-tag.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/es/function/index.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.function.bind.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/internals/function-bind.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.function.name.js","webpack://ex//home/travis/build/excaliburjs/Excalibur/node_modules/core-js/modules/es.function.has-instance.js","webpack://ex/./Polyfill.ts","webpack://ex/./Flags.ts","webpack://ex/./Math/Random.ts","webpack://ex/./Collision/Side.ts","webpack://ex/./Util/Util.ts","webpack://ex/./Util/Log.ts","webpack://ex/./Util/Decorators.ts","webpack://ex/./Algebra.ts","webpack://ex/./Drawing/Color.ts","webpack://ex/./Physics.ts","webpack://ex/./Events.ts","webpack://ex/./Collision/CollisionType.ts","webpack://ex/./Collision/CollisionContact.ts","webpack://ex/./Collision/CollisionJumpTable.ts","webpack://ex/./Collision/ClosestLineJumpTable.ts","webpack://ex/./Collision/Circle.ts","webpack://ex/./Collision/Edge.ts","webpack://ex/./Collision/ConvexPolygon.ts","webpack://ex/./Collision/BoundingBox.ts","webpack://ex/./Screen.ts","webpack://ex/./EventDispatcher.ts","webpack://ex/./Class.ts","webpack://ex/./Resources/Resource.ts","webpack://ex/./Drawing/SpriteEffects.ts","webpack://ex/./Configurable.ts","webpack://ex/./Drawing/Sprite.ts","webpack://ex/./Actions/RotationType.ts","webpack://ex/./Resources/Texture.ts","webpack://ex/./Drawing/Animation.ts","webpack://ex/./Actions/Action.ts","webpack://ex/./EntityComponentSystem/Components/TransformComponent.ts","webpack://ex/./Util/EasingFunctions.ts","webpack://ex/./Actions/ActionContext.ts","webpack://ex/./Collision/Shape.ts","webpack://ex/./Collision/Body.ts","webpack://ex/./Traits/TileMapCollisionDetection.ts","webpack://ex/./Util/CullingBox.ts","webpack://ex/./Traits/OffscreenCulling.ts","webpack://ex/./Traits/CapturePointer.ts","webpack://ex/./Util/DrawUtil.ts","webpack://ex/./Collision/CollisionGroup.ts","webpack://ex/./Collision/Pair.ts","webpack://ex/./Collision/Collider.ts","webpack://ex/./EntityComponentSystem/Component.ts","webpack://ex/./Util/Observable.ts","webpack://ex/./EntityComponentSystem/Entity.ts","webpack://ex/./Drawing/CanvasDrawComponent.ts","webpack://ex/./Actor.ts","webpack://ex/./Resources/Sound/AudioContext.ts","webpack://ex/./Util/WebAudio.ts","webpack://ex/./Loader.logo.png","webpack://ex/./Loader.ts","webpack://ex/./Util/Detector.ts","webpack://ex/./ScreenElement.ts","webpack://ex/./Timer.ts","webpack://ex/./Collision/DynamicTree.ts","webpack://ex/./Collision/DynamicTreeCollisionBroadphase.ts","webpack://ex/./TileMap.ts","webpack://ex/./Camera.ts","webpack://ex/./Label.ts","webpack://ex/./Trigger.ts","webpack://ex/./Util/Actors.ts","webpack://ex/./EntityComponentSystem/System.ts","webpack://ex/./Drawing/CanvasDrawingSystem.ts","webpack://ex/./EntityComponentSystem/EntityManager.ts","webpack://ex/./EntityComponentSystem/Util.ts","webpack://ex/./EntityComponentSystem/Query.ts","webpack://ex/./EntityComponentSystem/QueryManager.ts","webpack://ex/./EntityComponentSystem/SystemManager.ts","webpack://ex/./EntityComponentSystem/World.ts","webpack://ex/./PostProcessing/ColorBlindCorrector.ts","webpack://ex/./Input/Keyboard.ts","webpack://ex/./Input/Pointer.ts","webpack://ex/./Input/PointerEvents.ts","webpack://ex/./Scene.ts","webpack://ex/./DebugFlags.ts","webpack://ex/./Debug.ts","webpack://ex/./Input/Pointers.ts","webpack://ex/./Input/Gamepad.ts","webpack://ex/./Util/Browser.ts","webpack://ex/./Engine.ts","webpack://ex/./Events/MediaEvents.ts","webpack://ex/./Particles.ts","webpack://ex/./Actions/Index.ts","webpack://ex/./Collision/CollisionGroupManager.ts","webpack://ex/./Drawing/Polygon.ts","webpack://ex/./Drawing/SpriteSheet.ts","webpack://ex/./Interfaces/AudioImplementation.ts","webpack://ex/./Interfaces/LifecycleEvents.ts","webpack://ex/./Math/PerlinNoise.ts","webpack://ex/./Resources/Sound/WebAudioInstance.ts","webpack://ex/./Util/Sound.ts","webpack://ex/./Resources/Sound/Sound.ts","webpack://ex/./Resources/Gif.ts","webpack://ex/./Util/SortedList.ts","webpack://ex/./Promises.ts","webpack://ex/./index.ts"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","global","getOwnPropertyDescriptor","f","createNonEnumerableProperty","redefine","setGlobal","copyConstructorProperties","isForced","options","source","target","targetProperty","sourceProperty","descriptor","TARGET","GLOBAL","STATIC","stat","noTargetGet","forced","undefined","sham","exec","error","fails","requireObjectCoercible","argument","it","shared","has","uid","NATIVE_SYMBOL","USE_SYMBOL_AS_UID","WellKnownSymbolsStore","createWellKnownSymbol","withoutSetter","Math","check","globalThis","self","this","Function","DESCRIPTORS","IE8_DOM_DEFINE","anObject","toPrimitive","nativeDefineProperty","O","P","Attributes","TypeError","toInteger","min","cache","thrower","METHOD_NAME","method","ACCESSORS","argument0","argument1","length","IndexedObject","isObject","String","wellKnownSymbol","definePropertyModule","UNSCOPABLES","ArrayPrototype","Array","configurable","toObject","toLength","arraySpeciesCreate","push","createMethod","TYPE","IS_MAP","IS_FILTER","IS_SOME","IS_EVERY","IS_FIND_INDEX","IS_FILTER_OUT","NO_HOLES","$this","callbackfn","that","specificCreate","result","boundFunction","index","forEach","map","filter","some","every","find","findIndex","filterOut","createPropertyDescriptor","propertyIsEnumerableModule","toIndexedObject","nativeGetOwnPropertyDescriptor","propertyKey","classof","isArray","arg","ceil","floor","isNaN","input","PREFERRED_STRING","fn","val","toString","valueOf","sharedKey","CORRECT_PROTOTYPE_GETTER","IE_PROTO","ObjectPrototype","getPrototypeOf","constructor","TO_STRING_TAG","TAG","bitmap","writable","split","propertyIsEnumerable","path","aFunction","variable","namespace","arguments","max","integer","internalObjectKeys","enumBugKeys","keys","SPECIES","originalArray","C","V8_VERSION","array","foo","Boolean","set","NATIVE_WEAK_MAP","objectHas","hiddenKeys","WeakMap","store","state","wmget","wmhas","wmset","metadata","facade","STATE","enforce","getterFor","type","id","postfix","random","nativePropertyIsEnumerable","NASHORN_BUG","1","V","slice","inspectSource","InternalStateModule","getInternalState","enforceInternalState","TEMPLATE","unsafe","simple","join","activeXDocument","defineProperties","html","documentCreateElement","EmptyConstructor","scriptTag","content","LT","NullProtoObject","document","domain","ActiveXObject","iframeDocument","iframe","write","close","temp","parentWindow","NullProtoObjectViaActiveX","style","display","appendChild","src","contentWindow","open","F","Properties","a","b","apply","match","version","userAgent","process","versions","v8","isExtensible","preventExtensions","IS_PURE","__defineSetter__","copyright","concat","getOwnPropertyNames","toAbsoluteIndex","IS_INCLUDES","el","fromIndex","includes","indexOf","getOwnPropertySymbols","test","FREEZING","METADATA","setMetadata","objectID","weakData","meta","REQUIRED","fastKey","getWeakData","onFreeze","functionToString","createElement","EXISTS","$","createIteratorConstructor","setPrototypeOf","setToStringTag","Iterators","IteratorsCore","IteratorPrototype","BUGGY_SAFARI_ITERATORS","ITERATOR","returnThis","Iterable","NAME","IteratorConstructor","next","DEFAULT","IS_SET","FORCED","CurrentIteratorPrototype","methods","KEY","getIterationMethod","KIND","defaultIterator","IterablePrototype","INCORRECT_VALUES_NAME","nativeIterator","anyNativeIterator","entries","values","proto","getBuiltIn","getOwnPropertyNamesModule","getOwnPropertySymbolsModule","names","PrototypeOfArrayIteratorPrototype","arrayIterator","iterator","objectKeys","aPossiblePrototype","setter","CORRECT_SETTER","__proto__","returnMethod","TO_STRING_TAG_SUPPORT","classofRaw","CORRECT_ARGUMENTS","tag","tryGet","callee","flattenIntoArray","original","sourceLen","start","depth","mapper","thisArg","element","targetIndex","sourceIndex","mapFn","IS_RIGHT","argumentsLength","memo","left","right","nativeGetOwnPropertyNames","windowNames","getWindowNames","TO_ENTRIES","___CSS_LOADER_EXPORT___","useSourceMap","list","item","cssMapping","btoa","sourceMapping","sourceMap","base64","unescape","encodeURIComponent","JSON","stringify","data","sourceURLs","sources","sourceRoot","cssWithMappingToString","mediaQuery","dedupe","alreadyImportedModules","_i","charAt","defineIterator","setInternalState","iterated","string","point","done","CONVERT_TO_STRING","pos","first","second","S","position","size","charCodeAt","codeAt","g","e","ownKeys","getOwnPropertyDescriptorModule","replacement","feature","detection","normalize","POLYFILL","NATIVE","replace","toLowerCase","from","checkCorrectnessOfIteration","iterable","callWithSafeIterationClosing","isArrayIteratorMethod","createProperty","getIteratorMethod","arrayLike","step","mapfn","mapping","iteratorMethod","iteratorClose","ENTRIES","SAFE_CLOSING","called","iteratorWithReturn","SKIP_CLOSING","ITERATION_SUPPORT","of","arrayMethodHasSpeciesSupport","IS_CONCAT_SPREADABLE","IS_CONCAT_SPREADABLE_SUPPORT","SPECIES_SUPPORT","isConcatSpreadable","spreadable","k","len","E","A","copyWithin","addToUnscopables","to","end","count","inc","$every","arrayMethodIsStrict","arrayMethodUsesToLength","STRICT_METHOD","USES_TO_LENGTH","fill","endPos","$filter","HAS_SPECIES_SUPPORT","$find","SKIPS_HOLES","$findIndex","flat","depthArg","flatMap","$forEach","$includes","$indexOf","nativeIndexOf","NEGATIVE_ZERO","searchElement","kind","Arguments","nativeJoin","ES3_STRINGS","separator","lastIndexOf","nativeLastIndexOf","$map","$reduce","CHROME_VERSION","IS_NODE","reduce","$reduceRight","reduceRight","nativeReverse","reverse","0","nativeSlice","Constructor","fin","$some","nativeSort","sort","FAILS_ON_UNDEFINED","FAILS_ON_NULL","comparefn","setSpecies","CONSTRUCTOR_NAME","splice","deleteCount","insertCount","actualDeleteCount","actualStart","nativeObjectCreate","getOwnPropertyNamesExternal","wrappedWellKnownSymbolModule","defineWellKnownSymbol","HIDDEN","TO_PRIMITIVE","$Symbol","$stringify","AllSymbols","ObjectPrototypeSymbols","StringToSymbolRegistry","SymbolToStringRegistry","QObject","USE_SETTER","findChild","setSymbolDescriptor","ObjectPrototypeDescriptor","wrap","description","symbol","isSymbol","$defineProperty","$defineProperties","properties","$getOwnPropertySymbols","$propertyIsEnumerable","$getOwnPropertyDescriptor","$getOwnPropertyNames","IS_OBJECT_PROTOTYPE","keyFor","sym","useSetter","useSimple","replacer","space","$replacer","args","assign","nativeAssign","B","chr","T","j","$entries","nativeFreeze","freeze","iterate","fromEntries","obj","v","AS_ENTRIES","Result","stopped","unboundFunction","iterFn","IS_ITERATOR","INTERRUPTED","stop","condition","callFn","FAILS_ON_PRIMITIVES","getOwnPropertyDescriptors","nativeGetPrototypeOf","is","x","y","nativeIsExtensible","nativeIsFrozen","isFrozen","nativeIsSealed","isSealed","nativeKeys","nativePreventExtensions","nativeSeal","seal","$values","__defineGetter__","__lookupGetter__","desc","__lookupSetter__","Reflect","factories","construct","argsLength","partArgs","FunctionPrototype","FunctionPrototypeToString","nameRE","HAS_INSTANCE","polyfill","audioContext","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","callback","setInterval","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","AudioContext","webkitAudioContext","mozAudioContext","msAudioContext","oAudioContext","devicePixelRatio","Flags","_FROZEN","_FLAGS","flagName","Error","Random","seed","_lowerMask","_upperMask","_w","_n","_m","_a","_u","_s","_b","_t","_c","_l","_f","_mt","Date","now","_index","mag01","_twist","nextInt","likelihood","numPicks","allowDuplicates","_pickSetWithDuplicates","_pickSetWithoutDuplicates","currentPick","tempArray","pickOne","swap","randomIndex","Side","TwoPI","PI","extend","extended","deep","assignExists","merge","prop","base64Encode","inputStr","b64","outputStr","byte1","byte2","byte3","enc1","enc2","enc3","enc4","nullish","nullishVal","defaultVal","clamp","randomInRange","floating","randomIntInRange","round","canonicalizeAngle","angle","tmpAngle","toDegrees","radians","toRadians","degrees","getPosition","oLeft","oTop","calcOffsetLeft","parent","offsetLeft","offsetParent","calcOffsetTop","offsetTop","Vector","addItemToArray","removeItemFromArray","contains","getOppositeSide","side","Top","Bottom","Left","Right","None","getSideFromDirection","direction","directions","Up","Down","directionEnum","Number","MAX_VALUE","maxIndex","dot","Collection","initialSize","DefaultSize","_internalArray","_endPointer","newSize","newArray","_resize","removed","remove","func","fail","message","LogLevel","Logger","_appenders","defaultLevel","Info","_INSTANCE","addAppender","ConsoleAppender","appender","level","log","_log","Debug","Warn","Fatal","console","warn","consoleArgs","unshift","ScreenAppender","width","height","_messages","_canvas","innerWidth","innerHeight","_ctx","getContext","body","clearRect","opacity","fillStyle","toFixed","fillText","maxMessages","obsoleteMessage","resetObsoleteCounter","logMessage","suppressObsoleteMessages","isEnabled","getInstance","trace","showStackTrace","obsolete","alternateMethod","showStackTrack","SyntaxError","DecoratedClass","super","cos","sin","vec","Infinity","vec1","vec2","sqrt","pow","vector","tolerance","abs","Zero","distance","newLength","scale","add","sizeOrScale","perpendicular","atan2","anchor","sinAngle","cosAngle","Ray","dir","line","numerator","begin","sub","cross","getSlope","divisor","u","getLength","time","Line","slope","normal","x0","y0","dy","dx","aMinusP","intercept","currPoint","threshold","dxc","dyc","dx1","dy1","Projection","projection","overlaps","worldPos","pagePos","screenPos","xOrPos","yOrEngine","engineOrUndefined","pageX","pageY","engine","screenX","canvas","screenY","screenToWorldCoordinates","Color","parseInt","parseFloat","hex","h","HSLColor","toRGBA","factor","fromRGBA","color","newR","newG","newB","newA","multiply","color1","invert","color2","format","toHSLA","toHex","_componentToHex","fromHex","Vermilion","q","hue2rgb","CollisionResolutionStrategy","BroadphaseStrategy","Integrator","EventTypes","CollisionType","Physics","collisionResolutionStrategy","Box","RigidBody","dynamicTreeVelocityMultiplier","acc","enabled","collisionPasses","broadphaseStrategy","DynamicAABBTree","broadphaseDebug","showCollisionNormals","showMotionVectors","showBounds","showArea","showContacts","showNormals","defaultMass","integrator","Euler","integrationSteps","allowRigidBodyRotation","collisionShift","boundsPadding","surfaceEpsilon","checkForFastBodies","disableMinimumSpeedForFastBody","GameEvent","_bubbles","bubbles","KillEvent","PreKillEvent","PostKillEvent","GameStartEvent","GameStopEvent","PreDrawEvent","ctx","delta","PostDrawEvent","PreDebugDrawEvent","PostDebugDrawEvent","PreUpdateEvent","PostUpdateEvent","PreFrameEvent","prevStats","PostFrameEvent","stats","GamepadConnectEvent","gamepad","GamepadDisconnectEvent","GamepadButtonEvent","button","GamepadAxisEvent","axis","SubscribeEvent","topic","handler","UnsubscribeEvent","VisibleEvent","HiddenEvent","PreCollisionEvent","actor","other","intersection","PostCollisionEvent","CollisionStartEvent","pair","CollisionEndEvent","InitializeEvent","ActivateEvent","oldScene","DeactivateEvent","newScene","ExitViewPortEvent","EnterViewPortEvent","EnterTriggerEvent","ExitTriggerEvent","colliderA","colliderB","mtv","strategy","_resolveRigidBodyCollision","_resolveBoxCollision","Active","Passive","mtvDir","vel","velAdj","negate","emit","_applyBoxImpulse","bodyA","bodyB","invMassA","Fixed","mass","invMassB","invMoiA","inertia","invMoiB","coefRestitution","bounciness","coefFriction","friction","tangent","ra","center","rb","rv","rx","rvNormal","rvTangent","raTangent","raNormal","rbTangent","rbNormal","impulse","addMtv","jt","frictionImpulse","CollisionJumpTable","circleA","circleB","radius","circleAPos","circleBPos","axisOfCollision","mvt","pointOfCollision","getFurthestPoint","collider","circle","polygon","minAxis","testSeparatingAxisTheorem","samedir","verts","point1","point2","average","edge","cc","da","dda","db","ddb","den","pointOnEdge","dd","CollideEdgeEdge","edgeNormal","face","getClosestFace","pc","linePoly","points","polyA","polyB","sameDir","pointA","pointB","contact","ClosestLine","p0","q0","w0","denom","sDenom","tDenom","tClosestParallel","sClosest","tClosest","ClosestLineJumpTable","polygonA","polygonB","otherWorldPos","otherDirection","thisDirection","rayTowardsOther","rayTowardsThis","thisPoint","rayCast","otherPoint","thisFace","otherFace","getEdge","edgeLine","asLine","circlex","circley","circleWorlPos","edgeA","edgeB","edgeLineA","edgeLineB","offset","clone","ray","orig","discriminant","toi","getPoint","toi1","toi2","positiveToi","mintoi","shape","CircleCircleClosestLine","PolygonCircleClosestLine","flip","CircleEdgeClosestLine","CollideCircleCircle","CollideCirclePolygon","CollideCircleEdge","bodyPos","axes","closestPointOnPoly","minOverlap","minIndex","proj1","project","proj2","overlap","getOverlap","scalars","dotProduct","Green","newPos","beginPath","arc","closePath","rotation","strokeStyle","stroke","moveTo","lineTo","_getBodyPos","rotate","_getTransformedBegin","_getTransformedEnd","PolygonEdgeClosestLine","EdgeEdgeClosestLine","CollidePolygonEdge","transformedBegin","transformedEnd","_boundsFromBeginEnd","Red","_transformedPoints","_axes","_sides","winding","clockwiseWinding","_calculateTransformation","One","oldPos","equals","oldRotation","oldScale","lines","getTransformedPoints","getSides","testRay","accum","intersect","PolygonPolygonClosestLine","CollidePolygonPolygon","pts","furthestPoint","maxDistance","sides","POSITIVE_INFINITY","faceIndex","dist","distanceToPoint","fromPoints","denominator","iplusone","crossTerm","minContactTime","contactIndex","contactTime","poly1","poly2","scalar","basePos","diffToBase","firstPoint","leftOrOptions","top","bottom","minX","minY","maxX","maxY","Half","getPoints","shifted","translate","results","maybeCollider","farClipDistance","tmin","tmax","xinv","yinv","tx1","tx2","ty1","ty2","totalBoundingBox","combine","dimensions","overlapX","overlapY","bb","getSideFromIntersection","Yellow","strokeRect","DisplayMode","Resolution","_antialiasing","_resolutionStack","_viewportStack","_pixelRatio","_isFullScreen","_isDisposed","_logger","_pixelRatioChangeHandler","debug","applyResolutionAndViewport","_windowResizeHandler","displayMode","Container","parentElement","_setHeightByDisplayMode","info","clientHeight","viewport","resolution","_displayMode","context","antialiasing","_browser","browser","_position","pixelRatio","_applyDisplayMode","_mediaQueryList","nativeComponent","matchMedia","addEventListener","off","removeEventListener","_resolution","_viewport","camera","_camera","pop","scaledWidth","scaledHeight","imageRendering","resetTransform","imageSmoothingEnabled","isSmooth","requestFullscreen","then","exitFullscreen","newX","newY","drawWidth","drawHeight","halfDrawWidth","halfDrawHeight","z","FullScreen","on","Position","_initializeDisplayModePosition","clientWidth","margin","overflow","specifiedPosition","offsetY","marginTop","offsetX","marginLeft","_handlers","_wiredEventDispatchers","_target","eventName","event","eventHandlers","ev","eventDispatcher","eventObject","once","responseType","bustCache","logger","onprogress","oncomplete","onerror","_engine","uri","Promise","resolve","reject","request","XMLHttpRequest","_cacheBust","onloadstart","_start","onload","status","response","processData","send","URL","createObjectURL","Grayscale","imageData","firstPixel","pixel","avg","Invert","Opacity","Colorize","fromRGB","lighten","darken","saturate","desaturate","Fill","Configurable","base","props","imageOrConfig","flipVertical","flipHorizontal","effects","_spriteCanvas","_spriteCtx","_pixelData","_pixelsLoaded","_dirtyEffect","_opacity","image","_texture","_initPixelsFromTexture","loaded","naturalWidth","naturalHeight","_loadPixels","isLoaded","_flushTexture","drawImage","addEffect","effect","_applyEffects","param","indexToRemove","getImageData","updatePixel","putImageData","save","xpoint","ypoint","Black","restore","ctxOrOptions","CanvasRenderingContext2D","_drawWithOptions","oldAlpha","globalAlpha","RotationType","_loadedResolve","_isLoaded","_sprite","Image","load","engineOrConfig","sprites","speed","loop","currentFrame","_timeLeftInFrame","_idempotencyToken","freezeFrame","config","removeEffect","clearEffects","setTo","elapsed","idempotencyToken","_updateValues","current","_setAnchor","_setRotation","_setScale","frames","animOptions","currSprite","draw","reset","playAnimation","images","duration","easingFcn","_currentLerpTime","_lerpDuration","_lerpStart","_lerpEnd","_initialized","_stopped","_distance","_initialize","destx","desty","_started","_actor","_end","_speed","_delta","_dir","isComplete","_offset","actorToFollow","followDistance","_actorToFollow","_current","_maximumDistance","_distanceBetween","actorToFollowSpeed","actorToMeet","_speedWasSpecified","_actorToMeet","actorToMeetSpeed","angleRadians","rotationType","_rotationType","ShortestPath","distance1","distance2","_shortDistance","_longDistance","_shortestPathIsPositive","_direction","LongestPath","Clockwise","CounterClockwise","distanceTravelled","angleRadiansOffset","ScaleTo","scaleX","scaleY","speedX","speedY","_endX","_endY","_speedX","_speedY","_startX","_startY","_distanceX","_distanceY","sx","directionX","sy","directionY","scaleOffsetX","scaleOffsetY","_startScale","_endScale","_directionX","_directionY","Delay","delay","_elapsedTime","_delay","Blink","timeVisible","timeNotVisible","numBlinks","_timeVisible","_timeNotVisible","_totalTime","_duration","visible","endOpacity","_multiplier","_endOpacity","Die","actionQueue","clearActions","kill","CallMethod","_method","_hasBeenCalled","Repeat","repeat","actions","_actionQueue","ActionQueue","_repeat","_originalRepeat","hasNext","update","RepeatForever","_actions","_completedActions","action","_currentAction","getActions","shift","CoordPlane","easing","CreateReversibleEasingFunction","Linear","currentTime","startValue","endValue","EaseInQuad","EaseOutQuad","EaseInOutQuad","EaseInCubic","EaseOutCubic","EaseInOutCubic","_actors","_queues","xOffset","yOffset","sizeX","sizeY","sizeOffsetX","sizeOffsetY","times","repeatForever","promises","all","oldVel","oldAcc","torque","motion","_geometryDirty","_totalMtv","useBoxCollider","isKilled","_collider","_wireColliderEventsToActor","components","transform","addEqual","seconds","totalAcc","Polygon","Circle","Edge","clear","evt","PreventCollision","currentScene","tileMaps","intersectMap","collides","_topLeft","_topRight","_bottomLeft","_bottomRight","drawingWidth","currentDrawing","drawingHeight","getWorldPos","topLeftScreen","worldToScreenCoordinates","topRightScreen","bottomLeftScreen","bottomRightScreen","_xCoords","_yCoords","_xMin","_yMin","_xMax","_yMax","minWorld","maxWorld","_xMinWorld","_yMinWorld","_xMaxWorld","_yMaxWorld","boundingPoints","White","rect","Blue","Magenta","cullingBox","events","isSpriteOffScreen","actorBoundsOffscreen","bounds","isOffScreen","CapturePointer","enableCapturePointer","pointers","checkAndUpdateActorUnderPointer","x1","y1","x2","y2","thickness","cap","lineWidth","lineCap","origin","roundRect","br","tl","tr","bl","defaultRadius","quadraticCurveTo","CollisionGroup","category","mask","_name","_category","_mask","All","collision","calculatePairHash","group","canCollide","active","actorA","actorB","collide","Cyan","isCollider","useShapeInertia","_events","_shape","getClosestLineBetween","localBounds","recalc","debugDraw","Component","owner","newComponent","TagComponent","Observable","observers","observer","notify","AddedComponent","isAddedComponent","RemovedComponent","isRemovedComponent","_ID","_tagsMemo","_typesMemo","_componentsToRemove","_handleChanges","_rebuildMemos","changes","notifyAll","component","entity","deleteProperty","Proxy","_isInitialized","tags","newEntity","types","addComponent","componentOrEntity","force","removeComponent","dependencies","ctor","onAdd","componentOrType","_removeComponentByType","onRemove","isInitialized","onInitialize","onPreUpdate","onPostUpdate","coordPlane","World","isActor","xOrConfig","_height","_width","previousOpacity","scene","children","_draggable","_dragging","_pointerDragStartHandler","_pointerDragEndHandler","_pointerDragMoveHandler","pe","pointer","lastWorldPos","_pointerDragLeaveHandler","traits","capturePointer","captureMoveEvents","captureDragEvents","_isKilled","_capturePointerEvents","_captureMoveEvents","_captureDragEvents","_initDefaults","shouldInitializeBody","collisionType","_body","thePos","theVel","theAcc","theAngle","angularVelocity","scalePerSecondX","scalePerSecondY","isDraggable","_color","child","defaults","normalized","_checkForPointerOptIn","_scene","onPreKill","onPostKill","_prekill","_postkill","world","tick","addDrawing","asSprite","getZIndex","newZ","setZIndex","newIndex","getGlobalScale","markCollisionShapeDirty","getWorldRotation","parents","px","py","parentScale","recurse","childShift","containment","_preupdate","drawing","currFrame","captureOldTransform","integrate","trait","_postupdate","_predraw","_postdraw","onPreDraw","onPostDraw","ticks","Pi","oldFont","font","textAlign","currentActor","AudioContextFactory","_UNLOCKED","unlockTimeoutTimer","setTimeout","resume","buffer","createBuffer","createBufferSource","ended","connect","destination","onended","playbackState","isLegacyWebAudioSource","PLAYING_STATE","FINISHED_STATE","clearTimeout","loadables","_resourceList","_playButtonShown","_resourceCount","_numLoaded","_progressCounts","_totalCounts","logo","logoWidth","logoHeight","loadingBarColor","backgroundColor","suppressPlayButton","_playButtonStyles","playButtonText","startButtonFactory","buttonElement","textContent","getData","setData","total","addResources","_imageElement","_playButtonRootElement","_playButtonElement","_styleBlock","head","loadable","addResource","_playButton","removeChild","me","showPlayButton","unlock","hidePlayButton","progressArray","progressChunks","resource","wireEngine","progressResult","loadNext","loadedBytes","totalBytes","totalProgress","progress","canvasHeight","canvasWidth","buttonWidth","buttonHeight","playButtonPosition","fillRect","logoY","logoX","logoPosition","imageHeight","oldAntialias","getAntialiasing","setAntialiasing","_image","loadingX","loadingY","loadingBarPosition","progressWidth","REPORTED_FEATURES","webgl","webaudio","gamepadapi","_features","failedTests","_criticalTests","canvasSupport","elem","arrayBufferSupport","xhr","dataUrlSupport","toDataURL","objectUrlSupport","rgbaSupport","cssText","_warningTest","webAudioSupport","webglSupport","_loadBrowserFeatures","msg","supported","getBrowserFeatures","arraybuffer","dataurl","objecturl","rgba","navigator","getGamepads","failedCritical","warning","Screen","useWorld","coords","Timer","fcn","interval","repeats","numberOfRepeats","maxNumberOfRepeats","_totalTimeAlive","_paused","_numberOfTicks","complete","_callbacks","newInterval","newNumberOfRepeats","cancelTimer","worldBounds","nodes","leaf","leafAABB","currentRoot","isLeaf","area","getPerimeter","combinedArea","cost","inheritanceCost","leftCost","leftCombined","newArea","oldArea","rightCost","rightCombined","oldParent","newParent","currentNode","_balance","grandParent","sibling","node","_insert","untrackBody","_remove","multdx","multdy","balance","helper","_dynamicCollisionTree","_collisionHash","_collisionPairCache","_lastFramePairs","_lastFramePairsHash","trackBody","hash","targets","potentialColliders","query","_shouldGenerateCollisionPair","physics","pairs","updateDistance","minDimension","fastBodies","updateVec","centerPoint","minBody","minTranslate","rayCastQuery","hitPoint","isValid","fastBodyCollisions","collisions","collidersHash","applyMtv","currentFrameHash","actor1","actor2","updated","updateBody","cellWidth","cellHeight","rows","cols","_collidingX","_collidingY","_onScreenXStart","_onScreenXEnd","_onScreenYStart","_onScreenYEnd","_spriteSheets","isOffscreen","cd","spriteSheet","actorBounds","cell","getCellByPoint","solid","getCell","worldCoordsUpperLeft","worldCoordsLowerRight","xEnd","yEnd","cs","csi","cslen","spriteId","ss","spriteSheetKey","sprite","getSprite","TileSprite","_bounds","tileSprite","StrategyContainer","addStrategy","LockCameraToActorStrategy","cameraElasticity","cameraFriction","ElasticToActorStrategy","RadiusAroundActorStrategy","box","Axis","FontUnit","TextAlign","BaseAlign","FontStyle","_cam","_eng","cam","currentFocus","getFocus","X","focus","cameraVel","stretch","boundSizeChecked","_cameraStrategies","dz","az","_cameraMoving","_isShaking","_shakeMagnitudeX","_shakeMagnitudeY","_shakeDuration","_elapsedShakeTime","_xShake","_yShake","_isZooming","_zoomStart","_zoomEnd","_currentZoomTime","_zoomDuration","_zoomEasing","_easing","_follow","easingFn","_lerpPromise","_lerpResolve","magnitudeX","magnitudeY","_zoomPromise","_zoomResolve","halfWidth","halfHeight","cameraStrategy","newZoom","zoomEasing","lerpPoint","CreateVectorEasingFunction","moveEasing","_isDoneShaking","zoom","getZoom","newCanvasWidth","newCanvasHeight","setLineDash","textOrConfig","fontFamily","spriteFont","bold","fontSize","fontStyle","Normal","fontUnit","Px","baseAlign","letterSpacing","caseInsensitive","text","_textShadowOn","_shadowOffsetX","_shadowOffsetY","_fontString","measureText","Em","Rem","Pt","Percent","Center","End","Start","Alphabetic","Hanging","Ideographic","Middle","boldstring","Italic","Oblique","shadowColor","setTextShadow","useTextShadow","_fontDraw","oldAlign","oldTextBaseline","textBaseline","_lookupTextAlign","_lookupBaseAlign","maxWidth","_lookupFontStyle","_lookupFontUnit","triggerDefaults","opts","_dispatchAction","wp","Violet","isScreenElement","SystemType","System","priority","_entityAddedOrRemoved","AddedEntity","isAddedSystemEntity","RemovedEntity","isRemoveSystemEntity","systemType","Draw","entities","canvasdraw","_clearScreen","_pushCameraTransform","_applyTransform","_popCameraTransform","isDebug","_world","_entityIndex","queryManager","addEntity","register","idOrEntity","removeEntity","unregister","processComponentRemoval","buildTypeKey","localeCompare","_entities","_key","matches","typesOrEntity","_queries","entityManager","queryType","maybeExistingQuery","getQuery","_addQuery","systems","system","createQuery","initialize","maybeRemoveQuery","preupdate","getEntities","postupdate","removeSystem","systemManager","updateSystems","processComponentRemovals","entityOrSystem","addSystem","ColorBlindness","Keys","PointerType","PointerScope","NativePointerButton","PointerButton","WheelDeltaMode","actors","_bodies","triggers","_broadphase","_killQueue","_triggerKillQueue","_timers","_cancelQueue","_oldScene","_newScene","_initializeChildren","onActivate","onDeactivate","Update","removeTimer","timer","_collectActorStats","dispatchPointerEvents","beforeBroadphase","broadphase","afterBroadphase","beforeNarrowphase","iter","collisionDelta","narrowphase","runCollisionStartEnd","afterNarrowphase","killed","_processKillQueue","killQueue","collection","actorIndex","unkill","track","addTimer","addTileMap","untrack","removeTileMap","tileMap","_ui","screenElements","ui","alive","simulate","colorMode","Protanope","_vertexShader","_fragmentShader","_internalCanvas","_gl","preserveDrawingBuffer","_program","createProgram","fragmentShader","_getShader","_getFragmentShaderByMode","vertextShader","attachShader","linkProgram","getProgramParameter","LINK_STATUS","useProgram","code","Deuteranope","Tritanope","bufferData","ARRAY_BUFFER","Float32Array","STATIC_DRAW","program","shader","createShader","FRAGMENT_SHADER","VERTEX_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","out","positionLocation","getAttribLocation","texCoordLocation","texCoordBuffer","bindBuffer","enableVertexAttribArray","vertexAttribPointer","FLOAT","texture","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","pixelStorei","UNPACK_FLIP_Y_WEBGL","texImage2D","RGBA","UNSIGNED_BYTE","resolutionLocation","getUniformLocation","uniform2f","positionBuffer","_setRectangle","drawArrays","TRIANGLES","pixelData","Uint8Array","readPixels","colorBlindness","postProcessors","FrameStats","prevFrame","colorBlindMode","_id","_fps","_actorStats","remaining","_durationStats","_physicsStats","PhysicsStats","otherStats","fps","fs","_pairs","_collisions","_collidersHash","_fastBodies","_fastBodyCollisions","_narrowphase","ps","colliders","_keys","_keysUp","_keysDown","noop","keyEvent","_MAX_ID","_isDown","_wasDown","_actorsUnderPointer","_actorsLastFrame","_actorsNoLongerUnderPointer","lastPagePos","lastScreenPos","dragTarget","_onPointerMove","_onPointerDown","_onPointerUp","isActorAliveUnderPointer","_ev","coordinates","pointerType","doAction","propagate","_onActionStart","_onActionEnd","PointerEventFactory","_pointerEventType","PointerDragEvent","PointerUpEvent","isDragEnd","PointerDownEvent","isDragStart","PointerMoveEvent","isDragging","PointerEnterEvent","PointerLeaveEvent","PointerCancelEvent","deltaX","deltaY","deltaZ","deltaMode","createPointerEventByName","_pointerDown","_pointerUp","_pointerMove","_pointerCancel","_wheel","_pointers","_activePointers","primary","_handleTouchEvent","PointerEvent","touchAction","_handlePointerEvent","MSPointerEvent","msTouchAction","_handleMouseEvent","wheelOptions","passive","pageScrollPreventionMode","ScrollPreventionMode","Canvas","_handleWheelEvent","onmousewheel","pointerId","eventish","preventDefault","checkActorUnderPointer","addActorUnderPointer","removeActorUnderPointer","getActorsForEvents","lastMoveEventPerPointerPerActor","pointerLeave","wasActorUnderPointer","lastMoveEventPerPointer","pointerEnter","_dispatchWithBubble","_dispatchPointerLeaveEvents","_dispatchPointerEnterEvents","getActorsUnderPointer","_propagateWheelPointerEvent","wheelEvent","eventArr","at","fromPagePosition","Mouse","_nativeButtonToPointerButton","changedTouches","_getPointerIndex","identifier","Touch","Unknown","_stringToPointerType","transformedPoint","wheelDeltaX","wheelDeltaY","wheelDelta","detail","Pixel","Page","we","idx","NoButton","Pen","_gamePadTimeStamps","_oldPads","_pads","_initSuccess","_navigator","_minimumConfiguration","_clonePads","_enableAndUpdate","pad","axesLength","buttonLength","buttons","connected","init","gamepads","_isGamepadValid","timestamp","bi","ai","navigatorGamepad","Buttons","getButton","pressed","updateButton","Axes","getAxes","updateAxes","_clonePad","pads","arr","clonedPad","MinAxisMoveThreshold","_buttons","buttonIndex","axesIndex","BrowserComponent","_nativeHandlers","_decorate","BrowserEvents","_windowGlobal","_documentGlobal","_windowComponent","_documentComponent","pause","_hasStarted","scenes","_animations","_suppressPlayButton","pauseAudioWhenHidden","_isDebug","debugColor","enableCanvasTransparency","onFatalException","fatal","_timescale","_isLoading","_DEFAULT_ENGINE_OPTIONS","detector","suppressMinimumBrowserFeatureDetection","_compatible","innerText","testMessage","canvasElementId","getElementById","suppressConsoleBootMessage","EX_VERSION","logBrowserFeatures","canvasElement","alpha","screen","suppressHiDPIScaling","_loader","rootScene","addScene","goToScene","halfCanvasWidth","halfCanvasHeight","isHiDpi","isFullScreen","getWorldBounds","animation","AnimationNode","removeScene","_deactivate","setCurrentCamera","_activate","hidden","visibilityChange","scrollPreventionMode","keyboard","pointerScope","Document","_overrideInitialize","isDone","getKeys","toggle","loader","loadingComplete","pushResolutionAndViewport","popResolutionAndViewport","createMainLoop","game","raf","nowFn","lastTime","mainloop","_requestId","timescale","frameId","beforeUpdate","_update","afterUpdate","_draw","afterDraw","raw","_value","_val","NativeSoundEvent","NativeSoundProcessedEvent","_processedData","EmitterType","emitterOrConfig","life","beginColor","endColor","velocity","acceleration","startSize","endSize","particleRotationalVelocity","currentRotation","focusAccel","fadeFlag","_rRate","_gRate","_bRate","_aRate","_currentColor","emitter","particleSize","particleSprite","sizeRate","elapsedMultiplier","removeParticle","accel","numParticles","isEmitting","particles","deadParticles","minVel","maxVel","minAngle","maxAngle","emitRate","particleLife","minSize","maxSize","emitterType","Rectangle","randomRotation","_particlesToEmit","particle","particleCount","_createParticle","ranX","ranY","emitParticles","removeElement","Internal","Actions","_CURRENT_GROUP","_MAX_GROUPS","_GROUPS","_CURRENT_BIT","Map","_STARTING_BIT","filled","_points","prev","curr","fillColor","lineColor","imageOrConfigOrSprites","columns","spWidth","spHeight","spacing","loadFromImage","isWidthError","isHeightError","RangeError","indices","beginIndex","endIndex","spriteCoordinates","maxHeight","coord","anim","alphabet","_currentOpacity","_sprites","_textShadowDirty","_textShadowColor","_textShadowSprites","_alphabet","_caseInsensitive","getTextSprites","lookup","char","character","_parseOptions","characterShadow","currX","currY","charSprite","ExResponse","has_initialize","hasOnInitialize","has_preupdate","hasOnPreUpdate","has_postupdate","hasOnPostUpdate","hasPreDraw","hasPostDraw","_lerp","_fade","any","blob","json","_perm","_p","_defaultPerlinOptions","octaves","frequency","amplitude","persistance","_random","shuffle","amp","freq","maxValue","_noise1d","_noise2d","_noise3d","noise","intX","_gradient1d","intY","fadeX","fadeY","_gradient2d","intZ","fadeZ","aa","ba","ab","_gradient3d","generator","colorFcn","grid","_src","_volume","_loop","_isPlaying","_isPaused","_audioContext","_volumeNode","createGain","_currentOffset","_createNewBufferSource","_instance","_wireUpOnEnded","gain","setTargetAtTime","playbackRate","playStarted","_resumePlayBack","_startPlayBack","_playingPromise","_setPauseOffset","_handleOnEnded","_playingResolve","_rememberStartTime","_playbackRate","restartTime","amend","_startTime","getTime","setValueAtTime","canPlayFile","file","Audio","filetype","canPlayType","paths","_isStopped","_tracks","_wasPlayingOnHidden","_processedDataResolve","volume","isPlaying","play","_resumePlayback","_startPlayback","audioBuffer","_processArrayBufferData","_setProcessedData","resumed","_createNewTrack","getTrackId","decodeAudioData","processedData","_getTrackInstance","newTrack","_stream","_gif","_textures","_animation","_transparentColor","Stream","imageIndex","spriteArray","asSpriteSheet","getAnimationForAll","checkBytes","bitsToNum","byteToBitArr","bite","dataArray","readByte","byteLength","readBytes","bytes","read","fromCharCode","readUnsigned","stream","_st","_handler","globalColorTable","parseColorTable","ct","readSubBlocks","parseHeader","hdr","sig","ver","colorRes","globalColorTableSize","gctFlag","sorted","bgColor","pixelAspectRatio","bits","parseExt","block","parseGCExt","reserved","disposalMethod","userInput","transparencyGiven","delayTime","transparencyIndex","terminator","gce","parseComExt","comment","com","parsePTExt","ptHeader","ptData","pte","parseAppExt","parseNetscapeExt","unknown","iterations","app","NETSCAPE","parseUnknownAppExt","appData","authCode","parseUnknownExt","label","extType","parseImg","img","leftPos","topPos","lctFlag","interlaced","lctSize","lct","lzwMinCodeSize","lzwData","pixels","minCodeSize","readCode","output","clearCode","eoiCode","codeSize","dict","last","lzwDecode","newPixels","cpRow","toRow","fromRow","fromPixels","offsets","steps","pass","deinterlace","arrayToImage","parseBlock","sentinel","eof","frame","SortedList","getComparable","_getComparable","_find","_root","getKey","getLeft","getRight","_get","BinaryTreeNode","setLeft","setRight","elementIndex","_findMinNode","setKey","_cleanup","comparable","_list","treeNode","_data","_left","_right","MockedElement","PromiseState","_state","Pending","_successCallbacks","_rejectCallback","joinedPromise","successes","rejects","errors","successCallback","rejectCallback","Resolved","_handleError","Rejected","errorCallback","_errorCallback","cb"],"mappings":"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KAAM,OACNtjB,KAAM,OACNtwD,SAAU,WACVikD,YAAa,eE2CV,MAAM,GAqSX,YAAYlvD,GApSJ,KAAA8+E,MAAkB,CACxB,IACA,IACA,IACA,GACA,GACA,GACA,IACA,GACA,IACA,GACA,GACA,GACA,IACA,IACA,EACA,IACA,IACA,GACA,IACA,GACA,GACA,IACA,EACA,GACA,GACA,IACA,GACA,GACA,GACA,IACA,EACA,IACA,IACA,IACA,IACA,GACA,EACA,GACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,GACA,GACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,IACA,GACA,IACA,GACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,EACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,EACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,EACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,GACA,IACA,GACA,GACA,GACA,GACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,EACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,EACA,IACA,GACA,GACA,IACA,GACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,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","file":"excalibur.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ex\"] = factory();\n\telse\n\t\troot[\"ex\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 182);\n","var global = require('../internals/global');\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar redefine = require('../internals/redefine');\nvar setGlobal = require('../internals/set-global');\nvar copyConstructorProperties = require('../internals/copy-constructor-properties');\nvar isForced = require('../internals/is-forced');\n\n/*\n  options.target      - name of the target object\n  options.global      - target is the global object\n  options.stat        - export as static methods of target\n  options.proto       - export as prototype methods of target\n  options.real        - real prototype method for the `pure` version\n  options.forced      - export even if the native feature is available\n  options.bind        - bind methods to the target, required for the `pure` version\n  options.wrap        - wrap constructors to preventing global pollution, required for the `pure` version\n  options.unsafe      - use the simple assignment of property instead of delete + defineProperty\n  options.sham        - add a flag to not completely full polyfills\n  options.enumerable  - export as enumerable property\n  options.noTargetGet - prevent calling a getter on target\n*/\nmodule.exports = function (options, source) {\n  var TARGET = options.target;\n  var GLOBAL = options.global;\n  var STATIC = options.stat;\n  var FORCED, target, key, targetProperty, sourceProperty, descriptor;\n  if (GLOBAL) {\n    target = global;\n  } else if (STATIC) {\n    target = global[TARGET] || setGlobal(TARGET, {});\n  } else {\n    target = (global[TARGET] || {}).prototype;\n  }\n  if (target) for (key in source) {\n    sourceProperty = source[key];\n    if (options.noTargetGet) {\n      descriptor = getOwnPropertyDescriptor(target, key);\n      targetProperty = descriptor && descriptor.value;\n    } else targetProperty = target[key];\n    FORCED = isForced(GLOBAL ? key : TARGET + (STATIC ? '.' : '#') + key, options.forced);\n    // contained in target\n    if (!FORCED && targetProperty !== undefined) {\n      if (typeof sourceProperty === typeof targetProperty) continue;\n      copyConstructorProperties(sourceProperty, targetProperty);\n    }\n    // add a flag to not completely full polyfills\n    if (options.sham || (targetProperty && targetProperty.sham)) {\n      createNonEnumerableProperty(sourceProperty, 'sham', true);\n    }\n    // extend global\n    redefine(target, key, sourceProperty, options);\n  }\n};\n","module.exports = function (exec) {\n  try {\n    return !!exec();\n  } catch (error) {\n    return true;\n  }\n};\n","var fails = require('../internals/fails');\n\n// Thank's IE8 for his funny defineProperty\nmodule.exports = !fails(function () {\n  return Object.defineProperty({}, 1, { get: function () { return 7; } })[1] != 7;\n});\n","var requireObjectCoercible = require('../internals/require-object-coercible');\n\n// `ToObject` abstract operation\n// https://tc39.github.io/ecma262/#sec-toobject\nmodule.exports = function (argument) {\n  return Object(requireObjectCoercible(argument));\n};\n","module.exports = function (it) {\n  return typeof it === 'object' ? it !== null : typeof it === 'function';\n};\n","var global = require('../internals/global');\nvar shared = require('../internals/shared');\nvar has = require('../internals/has');\nvar uid = require('../internals/uid');\nvar NATIVE_SYMBOL = require('../internals/native-symbol');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nvar WellKnownSymbolsStore = shared('wks');\nvar Symbol = global.Symbol;\nvar createWellKnownSymbol = USE_SYMBOL_AS_UID ? Symbol : Symbol && Symbol.withoutSetter || uid;\n\nmodule.exports = function (name) {\n  if (!has(WellKnownSymbolsStore, name)) {\n    if (NATIVE_SYMBOL && has(Symbol, name)) WellKnownSymbolsStore[name] = Symbol[name];\n    else WellKnownSymbolsStore[name] = createWellKnownSymbol('Symbol.' + name);\n  } return WellKnownSymbolsStore[name];\n};\n","var check = function (it) {\n  return it && it.Math == Math && it;\n};\n\n// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nmodule.exports =\n  // eslint-disable-next-line no-undef\n  check(typeof globalThis == 'object' && globalThis) ||\n  check(typeof window == 'object' && window) ||\n  check(typeof self == 'object' && self) ||\n  check(typeof global == 'object' && global) ||\n  // eslint-disable-next-line no-new-func\n  (function () { return this; })() || Function('return this')();\n","var DESCRIPTORS = require('../internals/descriptors');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\nvar anObject = require('../internals/an-object');\nvar toPrimitive = require('../internals/to-primitive');\n\nvar nativeDefineProperty = Object.defineProperty;\n\n// `Object.defineProperty` method\n// https://tc39.github.io/ecma262/#sec-object.defineproperty\nexports.f = DESCRIPTORS ? nativeDefineProperty : function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPrimitive(P, true);\n  anObject(Attributes);\n  if (IE8_DOM_DEFINE) try {\n    return nativeDefineProperty(O, P, Attributes);\n  } catch (error) { /* empty */ }\n  if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported');\n  if ('value' in Attributes) O[P] = Attributes.value;\n  return O;\n};\n","var toInteger = require('../internals/to-integer');\n\nvar min = Math.min;\n\n// `ToLength` abstract operation\n// https://tc39.github.io/ecma262/#sec-tolength\nmodule.exports = function (argument) {\n  return argument > 0 ? min(toInteger(argument), 0x1FFFFFFFFFFFFF) : 0; // 2 ** 53 - 1 == 9007199254740991\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\nvar has = require('../internals/has');\n\nvar defineProperty = Object.defineProperty;\nvar cache = {};\n\nvar thrower = function (it) { throw it; };\n\nmodule.exports = function (METHOD_NAME, options) {\n  if (has(cache, METHOD_NAME)) return cache[METHOD_NAME];\n  if (!options) options = {};\n  var method = [][METHOD_NAME];\n  var ACCESSORS = has(options, 'ACCESSORS') ? options.ACCESSORS : false;\n  var argument0 = has(options, 0) ? options[0] : thrower;\n  var argument1 = has(options, 1) ? options[1] : undefined;\n\n  return cache[METHOD_NAME] = !!method && !fails(function () {\n    if (ACCESSORS && !DESCRIPTORS) return true;\n    var O = { length: -1 };\n\n    if (ACCESSORS) defineProperty(O, 1, { enumerable: true, get: thrower });\n    else O[1] = 1;\n\n    method.call(O, argument0, argument1);\n  });\n};\n","var hasOwnProperty = {}.hasOwnProperty;\n\nmodule.exports = function (it, key) {\n  return hasOwnProperty.call(it, key);\n};\n","// toObject with fallback for non-array-like ES3 strings\nvar IndexedObject = require('../internals/indexed-object');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\nmodule.exports = function (it) {\n  return IndexedObject(requireObjectCoercible(it));\n};\n","var isObject = require('../internals/is-object');\n\nmodule.exports = function (it) {\n  if (!isObject(it)) {\n    throw TypeError(String(it) + ' is not an object');\n  } return it;\n};\n","'use strict';\nvar fails = require('../internals/fails');\n\nmodule.exports = function (METHOD_NAME, argument) {\n  var method = [][METHOD_NAME];\n  return !!method && fails(function () {\n    // eslint-disable-next-line no-useless-call,no-throw-literal\n    method.call(null, argument || function () { throw 1; }, 1);\n  });\n};\n","var wellKnownSymbol = require('../internals/well-known-symbol');\nvar create = require('../internals/object-create');\nvar definePropertyModule = require('../internals/object-define-property');\n\nvar UNSCOPABLES = wellKnownSymbol('unscopables');\nvar ArrayPrototype = Array.prototype;\n\n// Array.prototype[@@unscopables]\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables\nif (ArrayPrototype[UNSCOPABLES] == undefined) {\n  definePropertyModule.f(ArrayPrototype, UNSCOPABLES, {\n    configurable: true,\n    value: create(null)\n  });\n}\n\n// add a key to Array.prototype[@@unscopables]\nmodule.exports = function (key) {\n  ArrayPrototype[UNSCOPABLES][key] = true;\n};\n","var bind = require('../internals/function-bind-context');\nvar IndexedObject = require('../internals/indexed-object');\nvar toObject = require('../internals/to-object');\nvar toLength = require('../internals/to-length');\nvar arraySpeciesCreate = require('../internals/array-species-create');\n\nvar push = [].push;\n\n// `Array.prototype.{ forEach, map, filter, some, every, find, findIndex, filterOut }` methods implementation\nvar createMethod = function (TYPE) {\n  var IS_MAP = TYPE == 1;\n  var IS_FILTER = TYPE == 2;\n  var IS_SOME = TYPE == 3;\n  var IS_EVERY = TYPE == 4;\n  var IS_FIND_INDEX = TYPE == 6;\n  var IS_FILTER_OUT = TYPE == 7;\n  var NO_HOLES = TYPE == 5 || IS_FIND_INDEX;\n  return function ($this, callbackfn, that, specificCreate) {\n    var O = toObject($this);\n    var self = IndexedObject(O);\n    var boundFunction = bind(callbackfn, that, 3);\n    var length = toLength(self.length);\n    var index = 0;\n    var create = specificCreate || arraySpeciesCreate;\n    var target = IS_MAP ? create($this, length) : IS_FILTER || IS_FILTER_OUT ? create($this, 0) : undefined;\n    var value, result;\n    for (;length > index; index++) if (NO_HOLES || index in self) {\n      value = self[index];\n      result = boundFunction(value, index, O);\n      if (TYPE) {\n        if (IS_MAP) target[index] = result; // map\n        else if (result) switch (TYPE) {\n          case 3: return true;              // some\n          case 5: return value;             // find\n          case 6: return index;             // findIndex\n          case 2: push.call(target, value); // filter\n        } else switch (TYPE) {\n          case 4: return false;             // every\n          case 7: push.call(target, value); // filterOut\n        }\n      }\n    }\n    return IS_FIND_INDEX ? -1 : IS_SOME || IS_EVERY ? IS_EVERY : target;\n  };\n};\n\nmodule.exports = {\n  // `Array.prototype.forEach` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.foreach\n  forEach: createMethod(0),\n  // `Array.prototype.map` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.map\n  map: createMethod(1),\n  // `Array.prototype.filter` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.filter\n  filter: createMethod(2),\n  // `Array.prototype.some` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.some\n  some: createMethod(3),\n  // `Array.prototype.every` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.every\n  every: createMethod(4),\n  // `Array.prototype.find` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.find\n  find: createMethod(5),\n  // `Array.prototype.findIndex` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.findIndex\n  findIndex: createMethod(6),\n  // `Array.prototype.filterOut` method\n  // https://github.com/tc39/proposal-array-filtering\n  filterOut: createMethod(7)\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar definePropertyModule = require('../internals/object-define-property');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\n\nmodule.exports = DESCRIPTORS ? function (object, key, value) {\n  return definePropertyModule.f(object, key, createPropertyDescriptor(1, value));\n} : function (object, key, value) {\n  object[key] = value;\n  return object;\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar propertyIsEnumerableModule = require('../internals/object-property-is-enumerable');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar toPrimitive = require('../internals/to-primitive');\nvar has = require('../internals/has');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\n\nvar nativeGetOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// `Object.getOwnPropertyDescriptor` method\n// https://tc39.github.io/ecma262/#sec-object.getownpropertydescriptor\nexports.f = DESCRIPTORS ? nativeGetOwnPropertyDescriptor : function getOwnPropertyDescriptor(O, P) {\n  O = toIndexedObject(O);\n  P = toPrimitive(P, true);\n  if (IE8_DOM_DEFINE) try {\n    return nativeGetOwnPropertyDescriptor(O, P);\n  } catch (error) { /* empty */ }\n  if (has(O, P)) return createPropertyDescriptor(!propertyIsEnumerableModule.f.call(O, P), O[P]);\n};\n","module.exports = function (it) {\n  if (typeof it != 'function') {\n    throw TypeError(String(it) + ' is not a function');\n  } return it;\n};\n","'use strict';\nvar toPrimitive = require('../internals/to-primitive');\nvar definePropertyModule = require('../internals/object-define-property');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\n\nmodule.exports = function (object, key, value) {\n  var propertyKey = toPrimitive(key);\n  if (propertyKey in object) definePropertyModule.f(object, propertyKey, createPropertyDescriptor(0, value));\n  else object[propertyKey] = value;\n};\n","var classof = require('../internals/classof-raw');\n\n// `IsArray` abstract operation\n// https://tc39.github.io/ecma262/#sec-isarray\nmodule.exports = Array.isArray || function isArray(arg) {\n  return classof(arg) == 'Array';\n};\n","var ceil = Math.ceil;\nvar floor = Math.floor;\n\n// `ToInteger` abstract operation\n// https://tc39.github.io/ecma262/#sec-tointeger\nmodule.exports = function (argument) {\n  return isNaN(argument = +argument) ? 0 : (argument > 0 ? floor : ceil)(argument);\n};\n","var isObject = require('../internals/is-object');\n\n// `ToPrimitive` abstract operation\n// https://tc39.github.io/ecma262/#sec-toprimitive\n// instead of the ES6 spec version, we didn't implement @@toPrimitive case\n// and the second argument - flag - preferred type is a string\nmodule.exports = function (input, PREFERRED_STRING) {\n  if (!isObject(input)) return input;\n  var fn, val;\n  if (PREFERRED_STRING && typeof (fn = input.toString) == 'function' && !isObject(val = fn.call(input))) return val;\n  if (typeof (fn = input.valueOf) == 'function' && !isObject(val = fn.call(input))) return val;\n  if (!PREFERRED_STRING && typeof (fn = input.toString) == 'function' && !isObject(val = fn.call(input))) return val;\n  throw TypeError(\"Can't convert object to primitive value\");\n};\n","var has = require('../internals/has');\nvar toObject = require('../internals/to-object');\nvar sharedKey = require('../internals/shared-key');\nvar CORRECT_PROTOTYPE_GETTER = require('../internals/correct-prototype-getter');\n\nvar IE_PROTO = sharedKey('IE_PROTO');\nvar ObjectPrototype = Object.prototype;\n\n// `Object.getPrototypeOf` method\n// https://tc39.github.io/ecma262/#sec-object.getprototypeof\nmodule.exports = CORRECT_PROTOTYPE_GETTER ? Object.getPrototypeOf : function (O) {\n  O = toObject(O);\n  if (has(O, IE_PROTO)) return O[IE_PROTO];\n  if (typeof O.constructor == 'function' && O instanceof O.constructor) {\n    return O.constructor.prototype;\n  } return O instanceof Object ? ObjectPrototype : null;\n};\n","var defineProperty = require('../internals/object-define-property').f;\nvar has = require('../internals/has');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\n\nmodule.exports = function (it, TAG, STATIC) {\n  if (it && !has(it = STATIC ? it : it.prototype, TO_STRING_TAG)) {\n    defineProperty(it, TO_STRING_TAG, { configurable: true, value: TAG });\n  }\n};\n","module.exports = function (bitmap, value) {\n  return {\n    enumerable: !(bitmap & 1),\n    configurable: !(bitmap & 2),\n    writable: !(bitmap & 4),\n    value: value\n  };\n};\n","module.exports = false;\n","module.exports = {};\n","var fails = require('../internals/fails');\nvar classof = require('../internals/classof-raw');\n\nvar split = ''.split;\n\n// fallback for non-array-like ES3 and non-enumerable old V8 strings\nmodule.exports = fails(function () {\n  // throws an error in rhino, see https://github.com/mozilla/rhino/issues/346\n  // eslint-disable-next-line no-prototype-builtins\n  return !Object('z').propertyIsEnumerable(0);\n}) ? function (it) {\n  return classof(it) == 'String' ? split.call(it, '') : Object(it);\n} : Object;\n","var path = require('../internals/path');\nvar global = require('../internals/global');\n\nvar aFunction = function (variable) {\n  return typeof variable == 'function' ? variable : undefined;\n};\n\nmodule.exports = function (namespace, method) {\n  return arguments.length < 2 ? aFunction(path[namespace]) || aFunction(global[namespace])\n    : path[namespace] && path[namespace][method] || global[namespace] && global[namespace][method];\n};\n","var global = require('../internals/global');\n\nmodule.exports = global;\n","var toInteger = require('../internals/to-integer');\n\nvar max = Math.max;\nvar min = Math.min;\n\n// Helper for a popular repeating case of the spec:\n// Let integer be ? ToInteger(index).\n// If integer < 0, let result be max((length + integer), 0); else let result be min(integer, length).\nmodule.exports = function (index, length) {\n  var integer = toInteger(index);\n  return integer < 0 ? max(integer + length, 0) : min(integer, length);\n};\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\n// `Object.keys` method\n// https://tc39.github.io/ecma262/#sec-object.keys\nmodule.exports = Object.keys || function keys(O) {\n  return internalObjectKeys(O, enumBugKeys);\n};\n","module.exports = {};\n","var isObject = require('../internals/is-object');\nvar isArray = require('../internals/is-array');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar SPECIES = wellKnownSymbol('species');\n\n// `ArraySpeciesCreate` abstract operation\n// https://tc39.github.io/ecma262/#sec-arrayspeciescreate\nmodule.exports = function (originalArray, length) {\n  var C;\n  if (isArray(originalArray)) {\n    C = originalArray.constructor;\n    // cross-realm fallback\n    if (typeof C == 'function' && (C === Array || isArray(C.prototype))) C = undefined;\n    else if (isObject(C)) {\n      C = C[SPECIES];\n      if (C === null) C = undefined;\n    }\n  } return new (C === undefined ? Array : C)(length === 0 ? 0 : length);\n};\n","var fails = require('../internals/fails');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar V8_VERSION = require('../internals/engine-v8-version');\n\nvar SPECIES = wellKnownSymbol('species');\n\nmodule.exports = function (METHOD_NAME) {\n  // We can't use this feature detection in V8 since it causes\n  // deoptimization and serious performance degradation\n  // https://github.com/zloirock/core-js/issues/677\n  return V8_VERSION >= 51 || !fails(function () {\n    var array = [];\n    var constructor = array.constructor = {};\n    constructor[SPECIES] = function () {\n      return { foo: 1 };\n    };\n    return array[METHOD_NAME](Boolean).foo !== 1;\n  });\n};\n","var NATIVE_WEAK_MAP = require('../internals/native-weak-map');\nvar global = require('../internals/global');\nvar isObject = require('../internals/is-object');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar objectHas = require('../internals/has');\nvar shared = require('../internals/shared-store');\nvar sharedKey = require('../internals/shared-key');\nvar hiddenKeys = require('../internals/hidden-keys');\n\nvar WeakMap = global.WeakMap;\nvar set, get, has;\n\nvar enforce = function (it) {\n  return has(it) ? get(it) : set(it, {});\n};\n\nvar getterFor = function (TYPE) {\n  return function (it) {\n    var state;\n    if (!isObject(it) || (state = get(it)).type !== TYPE) {\n      throw TypeError('Incompatible receiver, ' + TYPE + ' required');\n    } return state;\n  };\n};\n\nif (NATIVE_WEAK_MAP) {\n  var store = shared.state || (shared.state = new WeakMap());\n  var wmget = store.get;\n  var wmhas = store.has;\n  var wmset = store.set;\n  set = function (it, metadata) {\n    metadata.facade = it;\n    wmset.call(store, it, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return wmget.call(store, it) || {};\n  };\n  has = function (it) {\n    return wmhas.call(store, it);\n  };\n} else {\n  var STATE = sharedKey('state');\n  hiddenKeys[STATE] = true;\n  set = function (it, metadata) {\n    metadata.facade = it;\n    createNonEnumerableProperty(it, STATE, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return objectHas(it, STATE) ? it[STATE] : {};\n  };\n  has = function (it) {\n    return objectHas(it, STATE);\n  };\n}\n\nmodule.exports = {\n  set: set,\n  get: get,\n  has: has,\n  enforce: enforce,\n  getterFor: getterFor\n};\n","var shared = require('../internals/shared');\nvar uid = require('../internals/uid');\n\nvar keys = shared('keys');\n\nmodule.exports = function (key) {\n  return keys[key] || (keys[key] = uid(key));\n};\n","var id = 0;\nvar postfix = Math.random();\n\nmodule.exports = function (key) {\n  return 'Symbol(' + String(key === undefined ? '' : key) + ')_' + (++id + postfix).toString(36);\n};\n","'use strict';\nvar nativePropertyIsEnumerable = {}.propertyIsEnumerable;\nvar getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// Nashorn ~ JDK8 bug\nvar NASHORN_BUG = getOwnPropertyDescriptor && !nativePropertyIsEnumerable.call({ 1: 2 }, 1);\n\n// `Object.prototype.propertyIsEnumerable` method implementation\n// https://tc39.github.io/ecma262/#sec-object.prototype.propertyisenumerable\nexports.f = NASHORN_BUG ? function propertyIsEnumerable(V) {\n  var descriptor = getOwnPropertyDescriptor(this, V);\n  return !!descriptor && descriptor.enumerable;\n} : nativePropertyIsEnumerable;\n","var toString = {}.toString;\n\nmodule.exports = function (it) {\n  return toString.call(it).slice(8, -1);\n};\n","var global = require('../internals/global');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar has = require('../internals/has');\nvar setGlobal = require('../internals/set-global');\nvar inspectSource = require('../internals/inspect-source');\nvar InternalStateModule = require('../internals/internal-state');\n\nvar getInternalState = InternalStateModule.get;\nvar enforceInternalState = InternalStateModule.enforce;\nvar TEMPLATE = String(String).split('String');\n\n(module.exports = function (O, key, value, options) {\n  var unsafe = options ? !!options.unsafe : false;\n  var simple = options ? !!options.enumerable : false;\n  var noTargetGet = options ? !!options.noTargetGet : false;\n  var state;\n  if (typeof value == 'function') {\n    if (typeof key == 'string' && !has(value, 'name')) {\n      createNonEnumerableProperty(value, 'name', key);\n    }\n    state = enforceInternalState(value);\n    if (!state.source) {\n      state.source = TEMPLATE.join(typeof key == 'string' ? key : '');\n    }\n  }\n  if (O === global) {\n    if (simple) O[key] = value;\n    else setGlobal(key, value);\n    return;\n  } else if (!unsafe) {\n    delete O[key];\n  } else if (!noTargetGet && O[key]) {\n    simple = true;\n  }\n  if (simple) O[key] = value;\n  else createNonEnumerableProperty(O, key, value);\n// add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative\n})(Function.prototype, 'toString', function toString() {\n  return typeof this == 'function' && getInternalState(this).source || inspectSource(this);\n});\n","var anObject = require('../internals/an-object');\nvar defineProperties = require('../internals/object-define-properties');\nvar enumBugKeys = require('../internals/enum-bug-keys');\nvar hiddenKeys = require('../internals/hidden-keys');\nvar html = require('../internals/html');\nvar documentCreateElement = require('../internals/document-create-element');\nvar sharedKey = require('../internals/shared-key');\n\nvar GT = '>';\nvar LT = '<';\nvar PROTOTYPE = 'prototype';\nvar SCRIPT = 'script';\nvar IE_PROTO = sharedKey('IE_PROTO');\n\nvar EmptyConstructor = function () { /* empty */ };\n\nvar scriptTag = function (content) {\n  return LT + SCRIPT + GT + content + LT + '/' + SCRIPT + GT;\n};\n\n// Create object with fake `null` prototype: use ActiveX Object with cleared prototype\nvar NullProtoObjectViaActiveX = function (activeXDocument) {\n  activeXDocument.write(scriptTag(''));\n  activeXDocument.close();\n  var temp = activeXDocument.parentWindow.Object;\n  activeXDocument = null; // avoid memory leak\n  return temp;\n};\n\n// Create object with fake `null` prototype: use iframe Object with cleared prototype\nvar NullProtoObjectViaIFrame = function () {\n  // Thrash, waste and sodomy: IE GC bug\n  var iframe = documentCreateElement('iframe');\n  var JS = 'java' + SCRIPT + ':';\n  var iframeDocument;\n  iframe.style.display = 'none';\n  html.appendChild(iframe);\n  // https://github.com/zloirock/core-js/issues/475\n  iframe.src = String(JS);\n  iframeDocument = iframe.contentWindow.document;\n  iframeDocument.open();\n  iframeDocument.write(scriptTag('document.F=Object'));\n  iframeDocument.close();\n  return iframeDocument.F;\n};\n\n// Check for document.domain and active x support\n// No need to use active x approach when document.domain is not set\n// see https://github.com/es-shims/es5-shim/issues/150\n// variation of https://github.com/kitcambridge/es5-shim/commit/4f738ac066346\n// avoid IE GC bug\nvar activeXDocument;\nvar NullProtoObject = function () {\n  try {\n    /* global ActiveXObject */\n    activeXDocument = document.domain && new ActiveXObject('htmlfile');\n  } catch (error) { /* ignore */ }\n  NullProtoObject = activeXDocument ? NullProtoObjectViaActiveX(activeXDocument) : NullProtoObjectViaIFrame();\n  var length = enumBugKeys.length;\n  while (length--) delete NullProtoObject[PROTOTYPE][enumBugKeys[length]];\n  return NullProtoObject();\n};\n\nhiddenKeys[IE_PROTO] = true;\n\n// `Object.create` method\n// https://tc39.github.io/ecma262/#sec-object.create\nmodule.exports = Object.create || function create(O, Properties) {\n  var result;\n  if (O !== null) {\n    EmptyConstructor[PROTOTYPE] = anObject(O);\n    result = new EmptyConstructor();\n    EmptyConstructor[PROTOTYPE] = null;\n    // add \"__proto__\" for Object.getPrototypeOf polyfill\n    result[IE_PROTO] = O;\n  } else result = NullProtoObject();\n  return Properties === undefined ? result : defineProperties(result, Properties);\n};\n","var aFunction = require('../internals/a-function');\n\n// optional / simple context binding\nmodule.exports = function (fn, that, length) {\n  aFunction(fn);\n  if (that === undefined) return fn;\n  switch (length) {\n    case 0: return function () {\n      return fn.call(that);\n    };\n    case 1: return function (a) {\n      return fn.call(that, a);\n    };\n    case 2: return function (a, b) {\n      return fn.call(that, a, b);\n    };\n    case 3: return function (a, b, c) {\n      return fn.call(that, a, b, c);\n    };\n  }\n  return function (/* ...args */) {\n    return fn.apply(that, arguments);\n  };\n};\n","var global = require('../internals/global');\nvar userAgent = require('../internals/engine-user-agent');\n\nvar process = global.process;\nvar versions = process && process.versions;\nvar v8 = versions && versions.v8;\nvar match, version;\n\nif (v8) {\n  match = v8.split('.');\n  version = match[0] + match[1];\n} else if (userAgent) {\n  match = userAgent.match(/Edge\\/(\\d+)/);\n  if (!match || match[1] >= 74) {\n    match = userAgent.match(/Chrome\\/(\\d+)/);\n    if (match) version = match[1];\n  }\n}\n\nmodule.exports = version && +version;\n","var fails = require('../internals/fails');\n\nmodule.exports = !fails(function () {\n  return Object.isExtensible(Object.preventExtensions({}));\n});\n","'use strict';\nvar IS_PURE = require('../internals/is-pure');\nvar global = require('../internals/global');\nvar fails = require('../internals/fails');\n\n// Forced replacement object prototype accessors methods\nmodule.exports = IS_PURE || !fails(function () {\n  var key = Math.random();\n  // In FF throws only define methods\n  // eslint-disable-next-line no-undef, no-useless-call\n  __defineSetter__.call(null, key, function () { /* empty */ });\n  delete global[key];\n});\n","// `RequireObjectCoercible` abstract operation\n// https://tc39.github.io/ecma262/#sec-requireobjectcoercible\nmodule.exports = function (it) {\n  if (it == undefined) throw TypeError(\"Can't call method on \" + it);\n  return it;\n};\n","var global = require('../internals/global');\nvar setGlobal = require('../internals/set-global');\n\nvar SHARED = '__core-js_shared__';\nvar store = global[SHARED] || setGlobal(SHARED, {});\n\nmodule.exports = store;\n","var global = require('../internals/global');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\n\nmodule.exports = function (key, value) {\n  try {\n    createNonEnumerableProperty(global, key, value);\n  } catch (error) {\n    global[key] = value;\n  } return value;\n};\n","var IS_PURE = require('../internals/is-pure');\nvar store = require('../internals/shared-store');\n\n(module.exports = function (key, value) {\n  return store[key] || (store[key] = value !== undefined ? value : {});\n})('versions', []).push({\n  version: '3.8.0',\n  mode: IS_PURE ? 'pure' : 'global',\n  copyright: '© 2020 Denis Pushkarev (zloirock.ru)'\n});\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\nvar hiddenKeys = enumBugKeys.concat('length', 'prototype');\n\n// `Object.getOwnPropertyNames` method\n// https://tc39.github.io/ecma262/#sec-object.getownpropertynames\nexports.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {\n  return internalObjectKeys(O, hiddenKeys);\n};\n","var toIndexedObject = require('../internals/to-indexed-object');\nvar toLength = require('../internals/to-length');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\n\n// `Array.prototype.{ indexOf, includes }` methods implementation\nvar createMethod = function (IS_INCLUDES) {\n  return function ($this, el, fromIndex) {\n    var O = toIndexedObject($this);\n    var length = toLength(O.length);\n    var index = toAbsoluteIndex(fromIndex, length);\n    var value;\n    // Array#includes uses SameValueZero equality algorithm\n    // eslint-disable-next-line no-self-compare\n    if (IS_INCLUDES && el != el) while (length > index) {\n      value = O[index++];\n      // eslint-disable-next-line no-self-compare\n      if (value != value) return true;\n    // Array#indexOf ignores holes, Array#includes - not\n    } else for (;length > index; index++) {\n      if ((IS_INCLUDES || index in O) && O[index] === el) return IS_INCLUDES || index || 0;\n    } return !IS_INCLUDES && -1;\n  };\n};\n\nmodule.exports = {\n  // `Array.prototype.includes` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.includes\n  includes: createMethod(true),\n  // `Array.prototype.indexOf` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.indexof\n  indexOf: createMethod(false)\n};\n","// IE8- don't enum bug keys\nmodule.exports = [\n  'constructor',\n  'hasOwnProperty',\n  'isPrototypeOf',\n  'propertyIsEnumerable',\n  'toLocaleString',\n  'toString',\n  'valueOf'\n];\n","exports.f = Object.getOwnPropertySymbols;\n","var fails = require('../internals/fails');\n\nmodule.exports = !!Object.getOwnPropertySymbols && !fails(function () {\n  // Chrome 38 Symbol has incorrect toString conversion\n  // eslint-disable-next-line no-undef\n  return !String(Symbol());\n});\n","var wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\nvar test = {};\n\ntest[TO_STRING_TAG] = 'z';\n\nmodule.exports = String(test) === '[object z]';\n","var hiddenKeys = require('../internals/hidden-keys');\nvar isObject = require('../internals/is-object');\nvar has = require('../internals/has');\nvar defineProperty = require('../internals/object-define-property').f;\nvar uid = require('../internals/uid');\nvar FREEZING = require('../internals/freezing');\n\nvar METADATA = uid('meta');\nvar id = 0;\n\nvar isExtensible = Object.isExtensible || function () {\n  return true;\n};\n\nvar setMetadata = function (it) {\n  defineProperty(it, METADATA, { value: {\n    objectID: 'O' + ++id, // object ID\n    weakData: {}          // weak collections IDs\n  } });\n};\n\nvar fastKey = function (it, create) {\n  // return a primitive with prefix\n  if (!isObject(it)) return typeof it == 'symbol' ? it : (typeof it == 'string' ? 'S' : 'P') + it;\n  if (!has(it, METADATA)) {\n    // can't set metadata to uncaught frozen object\n    if (!isExtensible(it)) return 'F';\n    // not necessary to add metadata\n    if (!create) return 'E';\n    // add missing metadata\n    setMetadata(it);\n  // return object ID\n  } return it[METADATA].objectID;\n};\n\nvar getWeakData = function (it, create) {\n  if (!has(it, METADATA)) {\n    // can't set metadata to uncaught frozen object\n    if (!isExtensible(it)) return true;\n    // not necessary to add metadata\n    if (!create) return false;\n    // add missing metadata\n    setMetadata(it);\n  // return the store of weak collections IDs\n  } return it[METADATA].weakData;\n};\n\n// add metadata on freeze-family methods calling\nvar onFreeze = function (it) {\n  if (FREEZING && meta.REQUIRED && isExtensible(it) && !has(it, METADATA)) setMetadata(it);\n  return it;\n};\n\nvar meta = module.exports = {\n  REQUIRED: false,\n  fastKey: fastKey,\n  getWeakData: getWeakData,\n  onFreeze: onFreeze\n};\n\nhiddenKeys[METADATA] = true;\n","var store = require('../internals/shared-store');\n\nvar functionToString = Function.toString;\n\n// this helper broken in `3.4.1-3.4.4`, so we can't use `shared` helper\nif (typeof store.inspectSource != 'function') {\n  store.inspectSource = function (it) {\n    return functionToString.call(it);\n  };\n}\n\nmodule.exports = store.inspectSource;\n","var DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\nvar createElement = require('../internals/document-create-element');\n\n// Thank's IE8 for his funny defineProperty\nmodule.exports = !DESCRIPTORS && !fails(function () {\n  return Object.defineProperty(createElement('div'), 'a', {\n    get: function () { return 7; }\n  }).a != 7;\n});\n","var global = require('../internals/global');\nvar isObject = require('../internals/is-object');\n\nvar document = global.document;\n// typeof document.createElement is 'object' in old IE\nvar EXISTS = isObject(document) && isObject(document.createElement);\n\nmodule.exports = function (it) {\n  return EXISTS ? document.createElement(it) : {};\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar createIteratorConstructor = require('../internals/create-iterator-constructor');\nvar getPrototypeOf = require('../internals/object-get-prototype-of');\nvar setPrototypeOf = require('../internals/object-set-prototype-of');\nvar setToStringTag = require('../internals/set-to-string-tag');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar redefine = require('../internals/redefine');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar IS_PURE = require('../internals/is-pure');\nvar Iterators = require('../internals/iterators');\nvar IteratorsCore = require('../internals/iterators-core');\n\nvar IteratorPrototype = IteratorsCore.IteratorPrototype;\nvar BUGGY_SAFARI_ITERATORS = IteratorsCore.BUGGY_SAFARI_ITERATORS;\nvar ITERATOR = wellKnownSymbol('iterator');\nvar KEYS = 'keys';\nvar VALUES = 'values';\nvar ENTRIES = 'entries';\n\nvar returnThis = function () { return this; };\n\nmodule.exports = function (Iterable, NAME, IteratorConstructor, next, DEFAULT, IS_SET, FORCED) {\n  createIteratorConstructor(IteratorConstructor, NAME, next);\n\n  var getIterationMethod = function (KIND) {\n    if (KIND === DEFAULT && defaultIterator) return defaultIterator;\n    if (!BUGGY_SAFARI_ITERATORS && KIND in IterablePrototype) return IterablePrototype[KIND];\n    switch (KIND) {\n      case KEYS: return function keys() { return new IteratorConstructor(this, KIND); };\n      case VALUES: return function values() { return new IteratorConstructor(this, KIND); };\n      case ENTRIES: return function entries() { return new IteratorConstructor(this, KIND); };\n    } return function () { return new IteratorConstructor(this); };\n  };\n\n  var TO_STRING_TAG = NAME + ' Iterator';\n  var INCORRECT_VALUES_NAME = false;\n  var IterablePrototype = Iterable.prototype;\n  var nativeIterator = IterablePrototype[ITERATOR]\n    || IterablePrototype['@@iterator']\n    || DEFAULT && IterablePrototype[DEFAULT];\n  var defaultIterator = !BUGGY_SAFARI_ITERATORS && nativeIterator || getIterationMethod(DEFAULT);\n  var anyNativeIterator = NAME == 'Array' ? IterablePrototype.entries || nativeIterator : nativeIterator;\n  var CurrentIteratorPrototype, methods, KEY;\n\n  // fix native\n  if (anyNativeIterator) {\n    CurrentIteratorPrototype = getPrototypeOf(anyNativeIterator.call(new Iterable()));\n    if (IteratorPrototype !== Object.prototype && CurrentIteratorPrototype.next) {\n      if (!IS_PURE && getPrototypeOf(CurrentIteratorPrototype) !== IteratorPrototype) {\n        if (setPrototypeOf) {\n          setPrototypeOf(CurrentIteratorPrototype, IteratorPrototype);\n        } else if (typeof CurrentIteratorPrototype[ITERATOR] != 'function') {\n          createNonEnumerableProperty(CurrentIteratorPrototype, ITERATOR, returnThis);\n        }\n      }\n      // Set @@toStringTag to native iterators\n      setToStringTag(CurrentIteratorPrototype, TO_STRING_TAG, true, true);\n      if (IS_PURE) Iterators[TO_STRING_TAG] = returnThis;\n    }\n  }\n\n  // fix Array#{values, @@iterator}.name in V8 / FF\n  if (DEFAULT == VALUES && nativeIterator && nativeIterator.name !== VALUES) {\n    INCORRECT_VALUES_NAME = true;\n    defaultIterator = function values() { return nativeIterator.call(this); };\n  }\n\n  // define iterator\n  if ((!IS_PURE || FORCED) && IterablePrototype[ITERATOR] !== defaultIterator) {\n    createNonEnumerableProperty(IterablePrototype, ITERATOR, defaultIterator);\n  }\n  Iterators[NAME] = defaultIterator;\n\n  // export additional methods\n  if (DEFAULT) {\n    methods = {\n      values: getIterationMethod(VALUES),\n      keys: IS_SET ? defaultIterator : getIterationMethod(KEYS),\n      entries: getIterationMethod(ENTRIES)\n    };\n    if (FORCED) for (KEY in methods) {\n      if (BUGGY_SAFARI_ITERATORS || INCORRECT_VALUES_NAME || !(KEY in IterablePrototype)) {\n        redefine(IterablePrototype, KEY, methods[KEY]);\n      }\n    } else $({ target: NAME, proto: true, forced: BUGGY_SAFARI_ITERATORS || INCORRECT_VALUES_NAME }, methods);\n  }\n\n  return methods;\n};\n","var getBuiltIn = require('../internals/get-built-in');\nvar getOwnPropertyNamesModule = require('../internals/object-get-own-property-names');\nvar getOwnPropertySymbolsModule = require('../internals/object-get-own-property-symbols');\nvar anObject = require('../internals/an-object');\n\n// all object keys, includes non-enumerable and symbols\nmodule.exports = getBuiltIn('Reflect', 'ownKeys') || function ownKeys(it) {\n  var keys = getOwnPropertyNamesModule.f(anObject(it));\n  var getOwnPropertySymbols = getOwnPropertySymbolsModule.f;\n  return getOwnPropertySymbols ? keys.concat(getOwnPropertySymbols(it)) : keys;\n};\n","var has = require('../internals/has');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar indexOf = require('../internals/array-includes').indexOf;\nvar hiddenKeys = require('../internals/hidden-keys');\n\nmodule.exports = function (object, names) {\n  var O = toIndexedObject(object);\n  var i = 0;\n  var result = [];\n  var key;\n  for (key in O) !has(hiddenKeys, key) && has(O, key) && result.push(key);\n  // Don't enum bug & hidden keys\n  while (names.length > i) if (has(O, key = names[i++])) {\n    ~indexOf(result, key) || result.push(key);\n  }\n  return result;\n};\n","'use strict';\nvar getPrototypeOf = require('../internals/object-get-prototype-of');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar has = require('../internals/has');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar IS_PURE = require('../internals/is-pure');\n\nvar ITERATOR = wellKnownSymbol('iterator');\nvar BUGGY_SAFARI_ITERATORS = false;\n\nvar returnThis = function () { return this; };\n\n// `%IteratorPrototype%` object\n// https://tc39.github.io/ecma262/#sec-%iteratorprototype%-object\nvar IteratorPrototype, PrototypeOfArrayIteratorPrototype, arrayIterator;\n\nif ([].keys) {\n  arrayIterator = [].keys();\n  // Safari 8 has buggy iterators w/o `next`\n  if (!('next' in arrayIterator)) BUGGY_SAFARI_ITERATORS = true;\n  else {\n    PrototypeOfArrayIteratorPrototype = getPrototypeOf(getPrototypeOf(arrayIterator));\n    if (PrototypeOfArrayIteratorPrototype !== Object.prototype) IteratorPrototype = PrototypeOfArrayIteratorPrototype;\n  }\n}\n\nif (IteratorPrototype == undefined) IteratorPrototype = {};\n\n// 25.1.2.1.1 %IteratorPrototype%[@@iterator]()\nif (!IS_PURE && !has(IteratorPrototype, ITERATOR)) {\n  createNonEnumerableProperty(IteratorPrototype, ITERATOR, returnThis);\n}\n\nmodule.exports = {\n  IteratorPrototype: IteratorPrototype,\n  BUGGY_SAFARI_ITERATORS: BUGGY_SAFARI_ITERATORS\n};\n","var fails = require('../internals/fails');\n\nmodule.exports = !fails(function () {\n  function F() { /* empty */ }\n  F.prototype.constructor = null;\n  return Object.getPrototypeOf(new F()) !== F.prototype;\n});\n","var NATIVE_SYMBOL = require('../internals/native-symbol');\n\nmodule.exports = NATIVE_SYMBOL\n  // eslint-disable-next-line no-undef\n  && !Symbol.sham\n  // eslint-disable-next-line no-undef\n  && typeof Symbol.iterator == 'symbol';\n","var DESCRIPTORS = require('../internals/descriptors');\nvar definePropertyModule = require('../internals/object-define-property');\nvar anObject = require('../internals/an-object');\nvar objectKeys = require('../internals/object-keys');\n\n// `Object.defineProperties` method\n// https://tc39.github.io/ecma262/#sec-object.defineproperties\nmodule.exports = DESCRIPTORS ? Object.defineProperties : function defineProperties(O, Properties) {\n  anObject(O);\n  var keys = objectKeys(Properties);\n  var length = keys.length;\n  var index = 0;\n  var key;\n  while (length > index) definePropertyModule.f(O, key = keys[index++], Properties[key]);\n  return O;\n};\n","var anObject = require('../internals/an-object');\nvar aPossiblePrototype = require('../internals/a-possible-prototype');\n\n// `Object.setPrototypeOf` method\n// https://tc39.github.io/ecma262/#sec-object.setprototypeof\n// Works with __proto__ only. Old v8 can't work with null proto objects.\n/* eslint-disable no-proto */\nmodule.exports = Object.setPrototypeOf || ('__proto__' in {} ? function () {\n  var CORRECT_SETTER = false;\n  var test = {};\n  var setter;\n  try {\n    setter = Object.getOwnPropertyDescriptor(Object.prototype, '__proto__').set;\n    setter.call(test, []);\n    CORRECT_SETTER = test instanceof Array;\n  } catch (error) { /* empty */ }\n  return function setPrototypeOf(O, proto) {\n    anObject(O);\n    aPossiblePrototype(proto);\n    if (CORRECT_SETTER) setter.call(O, proto);\n    else O.__proto__ = proto;\n    return O;\n  };\n}() : undefined);\n","var anObject = require('../internals/an-object');\n\nmodule.exports = function (iterator) {\n  var returnMethod = iterator['return'];\n  if (returnMethod !== undefined) {\n    return anObject(returnMethod.call(iterator)).value;\n  }\n};\n","var wellKnownSymbol = require('../internals/well-known-symbol');\nvar Iterators = require('../internals/iterators');\n\nvar ITERATOR = wellKnownSymbol('iterator');\nvar ArrayPrototype = Array.prototype;\n\n// check on default Array iterator\nmodule.exports = function (it) {\n  return it !== undefined && (Iterators.Array === it || ArrayPrototype[ITERATOR] === it);\n};\n","var classof = require('../internals/classof');\nvar Iterators = require('../internals/iterators');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar ITERATOR = wellKnownSymbol('iterator');\n\nmodule.exports = function (it) {\n  if (it != undefined) return it[ITERATOR]\n    || it['@@iterator']\n    || Iterators[classof(it)];\n};\n","var TO_STRING_TAG_SUPPORT = require('../internals/to-string-tag-support');\nvar classofRaw = require('../internals/classof-raw');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\n// ES3 wrong here\nvar CORRECT_ARGUMENTS = classofRaw(function () { return arguments; }()) == 'Arguments';\n\n// fallback for IE11 Script Access Denied error\nvar tryGet = function (it, key) {\n  try {\n    return it[key];\n  } catch (error) { /* empty */ }\n};\n\n// getting tag from ES6+ `Object.prototype.toString`\nmodule.exports = TO_STRING_TAG_SUPPORT ? classofRaw : function (it) {\n  var O, tag, result;\n  return it === undefined ? 'Undefined' : it === null ? 'Null'\n    // @@toStringTag case\n    : typeof (tag = tryGet(O = Object(it), TO_STRING_TAG)) == 'string' ? tag\n    // builtinTag case\n    : CORRECT_ARGUMENTS ? classofRaw(O)\n    // ES3 arguments fallback\n    : (result = classofRaw(O)) == 'Object' && typeof O.callee == 'function' ? 'Arguments' : result;\n};\n","'use strict';\nvar isArray = require('../internals/is-array');\nvar toLength = require('../internals/to-length');\nvar bind = require('../internals/function-bind-context');\n\n// `FlattenIntoArray` abstract operation\n// https://tc39.github.io/proposal-flatMap/#sec-FlattenIntoArray\nvar flattenIntoArray = function (target, original, source, sourceLen, start, depth, mapper, thisArg) {\n  var targetIndex = start;\n  var sourceIndex = 0;\n  var mapFn = mapper ? bind(mapper, thisArg, 3) : false;\n  var element;\n\n  while (sourceIndex < sourceLen) {\n    if (sourceIndex in source) {\n      element = mapFn ? mapFn(source[sourceIndex], sourceIndex, original) : source[sourceIndex];\n\n      if (depth > 0 && isArray(element)) {\n        targetIndex = flattenIntoArray(target, original, element, toLength(element.length), targetIndex, depth - 1) - 1;\n      } else {\n        if (targetIndex >= 0x1FFFFFFFFFFFFF) throw TypeError('Exceed the acceptable array length');\n        target[targetIndex] = element;\n      }\n\n      targetIndex++;\n    }\n    sourceIndex++;\n  }\n  return targetIndex;\n};\n\nmodule.exports = flattenIntoArray;\n","var aFunction = require('../internals/a-function');\nvar toObject = require('../internals/to-object');\nvar IndexedObject = require('../internals/indexed-object');\nvar toLength = require('../internals/to-length');\n\n// `Array.prototype.{ reduce, reduceRight }` methods implementation\nvar createMethod = function (IS_RIGHT) {\n  return function (that, callbackfn, argumentsLength, memo) {\n    aFunction(callbackfn);\n    var O = toObject(that);\n    var self = IndexedObject(O);\n    var length = toLength(O.length);\n    var index = IS_RIGHT ? length - 1 : 0;\n    var i = IS_RIGHT ? -1 : 1;\n    if (argumentsLength < 2) while (true) {\n      if (index in self) {\n        memo = self[index];\n        index += i;\n        break;\n      }\n      index += i;\n      if (IS_RIGHT ? index < 0 : length <= index) {\n        throw TypeError('Reduce of empty array with no initial value');\n      }\n    }\n    for (;IS_RIGHT ? index >= 0 : length > index; index += i) if (index in self) {\n      memo = callbackfn(memo, self[index], index, O);\n    }\n    return memo;\n  };\n};\n\nmodule.exports = {\n  // `Array.prototype.reduce` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.reduce\n  left: createMethod(false),\n  // `Array.prototype.reduceRight` method\n  // https://tc39.github.io/ecma262/#sec-array.prototype.reduceright\n  right: createMethod(true)\n};\n","var classof = require('../internals/classof-raw');\nvar global = require('../internals/global');\n\nmodule.exports = classof(global.process) == 'process';\n","var toIndexedObject = require('../internals/to-indexed-object');\nvar nativeGetOwnPropertyNames = require('../internals/object-get-own-property-names').f;\n\nvar toString = {}.toString;\n\nvar windowNames = typeof window == 'object' && window && Object.getOwnPropertyNames\n  ? Object.getOwnPropertyNames(window) : [];\n\nvar getWindowNames = function (it) {\n  try {\n    return nativeGetOwnPropertyNames(it);\n  } catch (error) {\n    return windowNames.slice();\n  }\n};\n\n// fallback for IE11 buggy Object.getOwnPropertyNames with iframe and window\nmodule.exports.f = function getOwnPropertyNames(it) {\n  return windowNames && toString.call(it) == '[object Window]'\n    ? getWindowNames(it)\n    : nativeGetOwnPropertyNames(toIndexedObject(it));\n};\n","var wellKnownSymbol = require('../internals/well-known-symbol');\n\nexports.f = wellKnownSymbol;\n","var DESCRIPTORS = require('../internals/descriptors');\nvar objectKeys = require('../internals/object-keys');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar propertyIsEnumerable = require('../internals/object-property-is-enumerable').f;\n\n// `Object.{ entries, values }` methods implementation\nvar createMethod = function (TO_ENTRIES) {\n  return function (it) {\n    var O = toIndexedObject(it);\n    var keys = objectKeys(O);\n    var length = keys.length;\n    var i = 0;\n    var result = [];\n    var key;\n    while (length > i) {\n      key = keys[i++];\n      if (!DESCRIPTORS || propertyIsEnumerable.call(O, key)) {\n        result.push(TO_ENTRIES ? [key, O[key]] : O[key]);\n      }\n    }\n    return result;\n  };\n};\n\nmodule.exports = {\n  // `Object.entries` method\n  // https://tc39.github.io/ecma262/#sec-object.entries\n  entries: createMethod(true),\n  // `Object.values` method\n  // https://tc39.github.io/ecma262/#sec-object.values\n  values: createMethod(false)\n};\n","// Imports\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(true);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"/* Buttons styles start */\\n\\nbutton#excalibur-play {\\n  display: inline-block;\\n  position: relative;\\n  z-index: 999;\\n  border-radius: 6px;\\n  border: none;\\n  /*border: 3px solid;\\n    border-color: white;\\n    box-shadow: 0 0 10px #ccc;*/\\n  padding: 1rem 1.5rem 1rem 4rem;\\n  margin: 0;\\n  text-decoration: none;\\n  background: #00b233;\\n  color: #ffffff;\\n  font-family: sans-serif;\\n  font-size: 2rem;\\n  line-height: 1;\\n  cursor: pointer;\\n  text-align: center;\\n  transition: background 250ms ease-in-out, transform 150ms ease;\\n  -webkit-appearance: none;\\n  -moz-appearance: none;\\n\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\n  animation: excalibur-button-fadein 200ms;\\n}\\n\\n/*\\nbutton#excalibur-play {\\n  display: none;\\n}*/\\n\\nbutton#excalibur-play:after {\\n  position: absolute;\\n  content: '';\\n  border: 8px solid;\\n  border-color: transparent transparent transparent white;\\n  left: 35px;\\n  top: 24px;\\n  width: 0;\\n  height: 0;\\n}\\n\\nbutton#excalibur-play:before {\\n  position: absolute;\\n  content: '';\\n  border: 3px solid;\\n  left: 19px;\\n  top: 14px;\\n  border-radius: 20px;\\n  width: 30px;\\n  height: 30px;\\n}\\n\\nbutton#excalibur-play:hover,\\nbutton#excalibur-play:focus {\\n  background: #00982c;\\n}\\n\\nbutton#excalibur-play:focus {\\n  outline: 1px solid #fff;\\n  outline-offset: -4px;\\n}\\n\\nbutton#excalibur-play:active {\\n  transform: scale(0.99);\\n}\\n\\n@keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Firefox < 16 */\\n@-moz-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Safari, Chrome and Opera > 12.1 */\\n@-webkit-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Internet Explorer */\\n@-ms-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Opera < 12.1 */\\n@-o-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://Loader.css\"],\"names\":[],\"mappings\":\"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB,8DAA8D;EAC9D,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF\",\"sourcesContent\":[\"/* Buttons styles start */\\n\\nbutton#excalibur-play {\\n  display: inline-block;\\n  position: relative;\\n  z-index: 999;\\n  border-radius: 6px;\\n  border: none;\\n  /*border: 3px solid;\\n    border-color: white;\\n    box-shadow: 0 0 10px #ccc;*/\\n  padding: 1rem 1.5rem 1rem 4rem;\\n  margin: 0;\\n  text-decoration: none;\\n  background: #00b233;\\n  color: #ffffff;\\n  font-family: sans-serif;\\n  font-size: 2rem;\\n  line-height: 1;\\n  cursor: pointer;\\n  text-align: center;\\n  transition: background 250ms ease-in-out, transform 150ms ease;\\n  -webkit-appearance: none;\\n  -moz-appearance: none;\\n\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\n  animation: excalibur-button-fadein 200ms;\\n}\\n\\n/*\\nbutton#excalibur-play {\\n  display: none;\\n}*/\\n\\nbutton#excalibur-play:after {\\n  position: absolute;\\n  content: '';\\n  border: 8px solid;\\n  border-color: transparent transparent transparent white;\\n  left: 35px;\\n  top: 24px;\\n  width: 0;\\n  height: 0;\\n}\\n\\nbutton#excalibur-play:before {\\n  position: absolute;\\n  content: '';\\n  border: 3px solid;\\n  left: 19px;\\n  top: 14px;\\n  border-radius: 20px;\\n  width: 30px;\\n  height: 30px;\\n}\\n\\nbutton#excalibur-play:hover,\\nbutton#excalibur-play:focus {\\n  background: #00982c;\\n}\\n\\nbutton#excalibur-play:focus {\\n  outline: 1px solid #fff;\\n  outline-offset: -4px;\\n}\\n\\nbutton#excalibur-play:active {\\n  transform: scale(0.99);\\n}\\n\\n@keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Firefox < 16 */\\n@-moz-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Safari, Chrome and Opera > 12.1 */\\n@-webkit-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Internet Explorer */\\n@-ms-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\\n/* Opera < 12.1 */\\n@-o-keyframes excalibur-button-fadein {\\n  from {\\n    opacity: 0;\\n  }\\n  to {\\n    opacity: 1;\\n  }\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\n// eslint-disable-next-line func-names\nmodule.exports = function (useSourceMap) {\n  var list = []; // return the list of modules as css string\n\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = cssWithMappingToString(item, useSourceMap);\n\n      if (item[2]) {\n        return \"@media \".concat(item[2], \" {\").concat(content, \"}\");\n      }\n\n      return content;\n    }).join('');\n  }; // import a list of modules into the list\n  // eslint-disable-next-line func-names\n\n\n  list.i = function (modules, mediaQuery, dedupe) {\n    if (typeof modules === 'string') {\n      // eslint-disable-next-line no-param-reassign\n      modules = [[null, modules, '']];\n    }\n\n    var alreadyImportedModules = {};\n\n    if (dedupe) {\n      for (var i = 0; i < this.length; i++) {\n        // eslint-disable-next-line prefer-destructuring\n        var id = this[i][0];\n\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n\n    for (var _i = 0; _i < modules.length; _i++) {\n      var item = [].concat(modules[_i]);\n\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        // eslint-disable-next-line no-continue\n        continue;\n      }\n\n      if (mediaQuery) {\n        if (!item[2]) {\n          item[2] = mediaQuery;\n        } else {\n          item[2] = \"\".concat(mediaQuery, \" and \").concat(item[2]);\n        }\n      }\n\n      list.push(item);\n    }\n  };\n\n  return list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n  var content = item[1] || ''; // eslint-disable-next-line prefer-destructuring\n\n  var cssMapping = item[3];\n\n  if (!cssMapping) {\n    return content;\n  }\n\n  if (useSourceMap && typeof btoa === 'function') {\n    var sourceMapping = toComment(cssMapping);\n    var sourceURLs = cssMapping.sources.map(function (source) {\n      return \"/*# sourceURL=\".concat(cssMapping.sourceRoot || '').concat(source, \" */\");\n    });\n    return [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n  }\n\n  return [content].join('\\n');\n} // Adapted from convert-source-map (MIT)\n\n\nfunction toComment(sourceMap) {\n  // eslint-disable-next-line no-undef\n  var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n  var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n  return \"/*# \".concat(data, \" */\");\n}","require('../../modules/es.string.iterator');\nrequire('../../modules/es.array.from');\nrequire('../../modules/es.array.is-array');\nrequire('../../modules/es.array.of');\nrequire('../../modules/es.array.concat');\nrequire('../../modules/es.array.copy-within');\nrequire('../../modules/es.array.every');\nrequire('../../modules/es.array.fill');\nrequire('../../modules/es.array.filter');\nrequire('../../modules/es.array.find');\nrequire('../../modules/es.array.find-index');\nrequire('../../modules/es.array.flat');\nrequire('../../modules/es.array.flat-map');\nrequire('../../modules/es.array.for-each');\nrequire('../../modules/es.array.includes');\nrequire('../../modules/es.array.index-of');\nrequire('../../modules/es.array.iterator');\nrequire('../../modules/es.array.join');\nrequire('../../modules/es.array.last-index-of');\nrequire('../../modules/es.array.map');\nrequire('../../modules/es.array.reduce');\nrequire('../../modules/es.array.reduce-right');\nrequire('../../modules/es.array.reverse');\nrequire('../../modules/es.array.slice');\nrequire('../../modules/es.array.some');\nrequire('../../modules/es.array.sort');\nrequire('../../modules/es.array.species');\nrequire('../../modules/es.array.splice');\nrequire('../../modules/es.array.unscopables.flat');\nrequire('../../modules/es.array.unscopables.flat-map');\nvar path = require('../../internals/path');\n\nmodule.exports = path.Array;\n","'use strict';\nvar charAt = require('../internals/string-multibyte').charAt;\nvar InternalStateModule = require('../internals/internal-state');\nvar defineIterator = require('../internals/define-iterator');\n\nvar STRING_ITERATOR = 'String Iterator';\nvar setInternalState = InternalStateModule.set;\nvar getInternalState = InternalStateModule.getterFor(STRING_ITERATOR);\n\n// `String.prototype[@@iterator]` method\n// https://tc39.github.io/ecma262/#sec-string.prototype-@@iterator\ndefineIterator(String, 'String', function (iterated) {\n  setInternalState(this, {\n    type: STRING_ITERATOR,\n    string: String(iterated),\n    index: 0\n  });\n// `%StringIteratorPrototype%.next` method\n// https://tc39.github.io/ecma262/#sec-%stringiteratorprototype%.next\n}, function next() {\n  var state = getInternalState(this);\n  var string = state.string;\n  var index = state.index;\n  var point;\n  if (index >= string.length) return { value: undefined, done: true };\n  point = charAt(string, index);\n  state.index += point.length;\n  return { value: point, done: false };\n});\n","var toInteger = require('../internals/to-integer');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\n// `String.prototype.{ codePointAt, at }` methods implementation\nvar createMethod = function (CONVERT_TO_STRING) {\n  return function ($this, pos) {\n    var S = String(requireObjectCoercible($this));\n    var position = toInteger(pos);\n    var size = S.length;\n    var first, second;\n    if (position < 0 || position >= size) return CONVERT_TO_STRING ? '' : undefined;\n    first = S.charCodeAt(position);\n    return first < 0xD800 || first > 0xDBFF || position + 1 === size\n      || (second = S.charCodeAt(position + 1)) < 0xDC00 || second > 0xDFFF\n        ? CONVERT_TO_STRING ? S.charAt(position) : first\n        : CONVERT_TO_STRING ? S.slice(position, position + 2) : (first - 0xD800 << 10) + (second - 0xDC00) + 0x10000;\n  };\n};\n\nmodule.exports = {\n  // `String.prototype.codePointAt` method\n  // https://tc39.github.io/ecma262/#sec-string.prototype.codepointat\n  codeAt: createMethod(false),\n  // `String.prototype.at` method\n  // https://github.com/mathiasbynens/String.prototype.at\n  charAt: createMethod(true)\n};\n","var global = require('../internals/global');\nvar inspectSource = require('../internals/inspect-source');\n\nvar WeakMap = global.WeakMap;\n\nmodule.exports = typeof WeakMap === 'function' && /native code/.test(inspectSource(WeakMap));\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","var has = require('../internals/has');\nvar ownKeys = require('../internals/own-keys');\nvar getOwnPropertyDescriptorModule = require('../internals/object-get-own-property-descriptor');\nvar definePropertyModule = require('../internals/object-define-property');\n\nmodule.exports = function (target, source) {\n  var keys = ownKeys(source);\n  var defineProperty = definePropertyModule.f;\n  var getOwnPropertyDescriptor = getOwnPropertyDescriptorModule.f;\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    if (!has(target, key)) defineProperty(target, key, getOwnPropertyDescriptor(source, key));\n  }\n};\n","var fails = require('../internals/fails');\n\nvar replacement = /#|\\.prototype\\./;\n\nvar isForced = function (feature, detection) {\n  var value = data[normalize(feature)];\n  return value == POLYFILL ? true\n    : value == NATIVE ? false\n    : typeof detection == 'function' ? fails(detection)\n    : !!detection;\n};\n\nvar normalize = isForced.normalize = function (string) {\n  return String(string).replace(replacement, '.').toLowerCase();\n};\n\nvar data = isForced.data = {};\nvar NATIVE = isForced.NATIVE = 'N';\nvar POLYFILL = isForced.POLYFILL = 'P';\n\nmodule.exports = isForced;\n","'use strict';\nvar IteratorPrototype = require('../internals/iterators-core').IteratorPrototype;\nvar create = require('../internals/object-create');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\nvar setToStringTag = require('../internals/set-to-string-tag');\nvar Iterators = require('../internals/iterators');\n\nvar returnThis = function () { return this; };\n\nmodule.exports = function (IteratorConstructor, NAME, next) {\n  var TO_STRING_TAG = NAME + ' Iterator';\n  IteratorConstructor.prototype = create(IteratorPrototype, { next: createPropertyDescriptor(1, next) });\n  setToStringTag(IteratorConstructor, TO_STRING_TAG, false, true);\n  Iterators[TO_STRING_TAG] = returnThis;\n  return IteratorConstructor;\n};\n","var getBuiltIn = require('../internals/get-built-in');\n\nmodule.exports = getBuiltIn('document', 'documentElement');\n","var isObject = require('../internals/is-object');\n\nmodule.exports = function (it) {\n  if (!isObject(it) && it !== null) {\n    throw TypeError(\"Can't set \" + String(it) + ' as a prototype');\n  } return it;\n};\n","var $ = require('../internals/export');\nvar from = require('../internals/array-from');\nvar checkCorrectnessOfIteration = require('../internals/check-correctness-of-iteration');\n\nvar INCORRECT_ITERATION = !checkCorrectnessOfIteration(function (iterable) {\n  Array.from(iterable);\n});\n\n// `Array.from` method\n// https://tc39.github.io/ecma262/#sec-array.from\n$({ target: 'Array', stat: true, forced: INCORRECT_ITERATION }, {\n  from: from\n});\n","'use strict';\nvar bind = require('../internals/function-bind-context');\nvar toObject = require('../internals/to-object');\nvar callWithSafeIterationClosing = require('../internals/call-with-safe-iteration-closing');\nvar isArrayIteratorMethod = require('../internals/is-array-iterator-method');\nvar toLength = require('../internals/to-length');\nvar createProperty = require('../internals/create-property');\nvar getIteratorMethod = require('../internals/get-iterator-method');\n\n// `Array.from` method implementation\n// https://tc39.github.io/ecma262/#sec-array.from\nmodule.exports = function from(arrayLike /* , mapfn = undefined, thisArg = undefined */) {\n  var O = toObject(arrayLike);\n  var C = typeof this == 'function' ? this : Array;\n  var argumentsLength = arguments.length;\n  var mapfn = argumentsLength > 1 ? arguments[1] : undefined;\n  var mapping = mapfn !== undefined;\n  var iteratorMethod = getIteratorMethod(O);\n  var index = 0;\n  var length, result, step, iterator, next, value;\n  if (mapping) mapfn = bind(mapfn, argumentsLength > 2 ? arguments[2] : undefined, 2);\n  // if the target is not iterable or it's an array with the default iterator - use a simple case\n  if (iteratorMethod != undefined && !(C == Array && isArrayIteratorMethod(iteratorMethod))) {\n    iterator = iteratorMethod.call(O);\n    next = iterator.next;\n    result = new C();\n    for (;!(step = next.call(iterator)).done; index++) {\n      value = mapping ? callWithSafeIterationClosing(iterator, mapfn, [step.value, index], true) : step.value;\n      createProperty(result, index, value);\n    }\n  } else {\n    length = toLength(O.length);\n    result = new C(length);\n    for (;length > index; index++) {\n      value = mapping ? mapfn(O[index], index) : O[index];\n      createProperty(result, index, value);\n    }\n  }\n  result.length = index;\n  return result;\n};\n","var anObject = require('../internals/an-object');\nvar iteratorClose = require('../internals/iterator-close');\n\n// call something on iterator step with safe closing on error\nmodule.exports = function (iterator, fn, value, ENTRIES) {\n  try {\n    return ENTRIES ? fn(anObject(value)[0], value[1]) : fn(value);\n  // 7.4.6 IteratorClose(iterator, completion)\n  } catch (error) {\n    iteratorClose(iterator);\n    throw error;\n  }\n};\n","var wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar ITERATOR = wellKnownSymbol('iterator');\nvar SAFE_CLOSING = false;\n\ntry {\n  var called = 0;\n  var iteratorWithReturn = {\n    next: function () {\n      return { done: !!called++ };\n    },\n    'return': function () {\n      SAFE_CLOSING = true;\n    }\n  };\n  iteratorWithReturn[ITERATOR] = function () {\n    return this;\n  };\n  // eslint-disable-next-line no-throw-literal\n  Array.from(iteratorWithReturn, function () { throw 2; });\n} catch (error) { /* empty */ }\n\nmodule.exports = function (exec, SKIP_CLOSING) {\n  if (!SKIP_CLOSING && !SAFE_CLOSING) return false;\n  var ITERATION_SUPPORT = false;\n  try {\n    var object = {};\n    object[ITERATOR] = function () {\n      return {\n        next: function () {\n          return { done: ITERATION_SUPPORT = true };\n        }\n      };\n    };\n    exec(object);\n  } catch (error) { /* empty */ }\n  return ITERATION_SUPPORT;\n};\n","var $ = require('../internals/export');\nvar isArray = require('../internals/is-array');\n\n// `Array.isArray` method\n// https://tc39.github.io/ecma262/#sec-array.isarray\n$({ target: 'Array', stat: true }, {\n  isArray: isArray\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar fails = require('../internals/fails');\nvar createProperty = require('../internals/create-property');\n\nvar ISNT_GENERIC = fails(function () {\n  function F() { /* empty */ }\n  return !(Array.of.call(F) instanceof F);\n});\n\n// `Array.of` method\n// https://tc39.github.io/ecma262/#sec-array.of\n// WebKit Array.of isn't generic\n$({ target: 'Array', stat: true, forced: ISNT_GENERIC }, {\n  of: function of(/* ...args */) {\n    var index = 0;\n    var argumentsLength = arguments.length;\n    var result = new (typeof this == 'function' ? this : Array)(argumentsLength);\n    while (argumentsLength > index) createProperty(result, index, arguments[index++]);\n    result.length = argumentsLength;\n    return result;\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar fails = require('../internals/fails');\nvar isArray = require('../internals/is-array');\nvar isObject = require('../internals/is-object');\nvar toObject = require('../internals/to-object');\nvar toLength = require('../internals/to-length');\nvar createProperty = require('../internals/create-property');\nvar arraySpeciesCreate = require('../internals/array-species-create');\nvar arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar V8_VERSION = require('../internals/engine-v8-version');\n\nvar IS_CONCAT_SPREADABLE = wellKnownSymbol('isConcatSpreadable');\nvar MAX_SAFE_INTEGER = 0x1FFFFFFFFFFFFF;\nvar MAXIMUM_ALLOWED_INDEX_EXCEEDED = 'Maximum allowed index exceeded';\n\n// We can't use this feature detection in V8 since it causes\n// deoptimization and serious performance degradation\n// https://github.com/zloirock/core-js/issues/679\nvar IS_CONCAT_SPREADABLE_SUPPORT = V8_VERSION >= 51 || !fails(function () {\n  var array = [];\n  array[IS_CONCAT_SPREADABLE] = false;\n  return array.concat()[0] !== array;\n});\n\nvar SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('concat');\n\nvar isConcatSpreadable = function (O) {\n  if (!isObject(O)) return false;\n  var spreadable = O[IS_CONCAT_SPREADABLE];\n  return spreadable !== undefined ? !!spreadable : isArray(O);\n};\n\nvar FORCED = !IS_CONCAT_SPREADABLE_SUPPORT || !SPECIES_SUPPORT;\n\n// `Array.prototype.concat` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.concat\n// with adding support of @@isConcatSpreadable and @@species\n$({ target: 'Array', proto: true, forced: FORCED }, {\n  concat: function concat(arg) { // eslint-disable-line no-unused-vars\n    var O = toObject(this);\n    var A = arraySpeciesCreate(O, 0);\n    var n = 0;\n    var i, k, length, len, E;\n    for (i = -1, length = arguments.length; i < length; i++) {\n      E = i === -1 ? O : arguments[i];\n      if (isConcatSpreadable(E)) {\n        len = toLength(E.length);\n        if (n + len > MAX_SAFE_INTEGER) throw TypeError(MAXIMUM_ALLOWED_INDEX_EXCEEDED);\n        for (k = 0; k < len; k++, n++) if (k in E) createProperty(A, n, E[k]);\n      } else {\n        if (n >= MAX_SAFE_INTEGER) throw TypeError(MAXIMUM_ALLOWED_INDEX_EXCEEDED);\n        createProperty(A, n++, E);\n      }\n    }\n    A.length = n;\n    return A;\n  }\n});\n","var getBuiltIn = require('../internals/get-built-in');\n\nmodule.exports = getBuiltIn('navigator', 'userAgent') || '';\n","var $ = require('../internals/export');\nvar copyWithin = require('../internals/array-copy-within');\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\n// `Array.prototype.copyWithin` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.copywithin\n$({ target: 'Array', proto: true }, {\n  copyWithin: copyWithin\n});\n\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables('copyWithin');\n","'use strict';\nvar toObject = require('../internals/to-object');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar toLength = require('../internals/to-length');\n\nvar min = Math.min;\n\n// `Array.prototype.copyWithin` method implementation\n// https://tc39.github.io/ecma262/#sec-array.prototype.copywithin\nmodule.exports = [].copyWithin || function copyWithin(target /* = 0 */, start /* = 0, end = @length */) {\n  var O = toObject(this);\n  var len = toLength(O.length);\n  var to = toAbsoluteIndex(target, len);\n  var from = toAbsoluteIndex(start, len);\n  var end = arguments.length > 2 ? arguments[2] : undefined;\n  var count = min((end === undefined ? len : toAbsoluteIndex(end, len)) - from, len - to);\n  var inc = 1;\n  if (from < to && to < from + count) {\n    inc = -1;\n    from += count - 1;\n    to += count - 1;\n  }\n  while (count-- > 0) {\n    if (from in O) O[to] = O[from];\n    else delete O[to];\n    to += inc;\n    from += inc;\n  } return O;\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar $every = require('../internals/array-iteration').every;\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar STRICT_METHOD = arrayMethodIsStrict('every');\nvar USES_TO_LENGTH = arrayMethodUsesToLength('every');\n\n// `Array.prototype.every` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.every\n$({ target: 'Array', proto: true, forced: !STRICT_METHOD || !USES_TO_LENGTH }, {\n  every: function every(callbackfn /* , thisArg */) {\n    return $every(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n","var $ = require('../internals/export');\nvar fill = require('../internals/array-fill');\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\n// `Array.prototype.fill` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.fill\n$({ target: 'Array', proto: true }, {\n  fill: fill\n});\n\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables('fill');\n","'use strict';\nvar toObject = require('../internals/to-object');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar toLength = require('../internals/to-length');\n\n// `Array.prototype.fill` method implementation\n// https://tc39.github.io/ecma262/#sec-array.prototype.fill\nmodule.exports = function fill(value /* , start = 0, end = @length */) {\n  var O = toObject(this);\n  var length = toLength(O.length);\n  var argumentsLength = arguments.length;\n  var index = toAbsoluteIndex(argumentsLength > 1 ? arguments[1] : undefined, length);\n  var end = argumentsLength > 2 ? arguments[2] : undefined;\n  var endPos = end === undefined ? length : toAbsoluteIndex(end, length);\n  while (endPos > index) O[index++] = value;\n  return O;\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar $filter = require('../internals/array-iteration').filter;\nvar arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('filter');\n// Edge 14- issue\nvar USES_TO_LENGTH = arrayMethodUsesToLength('filter');\n\n// `Array.prototype.filter` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.filter\n// with adding support of @@species\n$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT || !USES_TO_LENGTH }, {\n  filter: function filter(callbackfn /* , thisArg */) {\n    return $filter(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar $find = require('../internals/array-iteration').find;\nvar addToUnscopables = require('../internals/add-to-unscopables');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar FIND = 'find';\nvar SKIPS_HOLES = true;\n\nvar USES_TO_LENGTH = arrayMethodUsesToLength(FIND);\n\n// Shouldn't skip holes\nif (FIND in []) Array(1)[FIND](function () { SKIPS_HOLES = false; });\n\n// `Array.prototype.find` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.find\n$({ target: 'Array', proto: true, forced: SKIPS_HOLES || !USES_TO_LENGTH }, {\n  find: function find(callbackfn /* , that = undefined */) {\n    return $find(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables(FIND);\n","'use strict';\nvar $ = require('../internals/export');\nvar $findIndex = require('../internals/array-iteration').findIndex;\nvar addToUnscopables = require('../internals/add-to-unscopables');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar FIND_INDEX = 'findIndex';\nvar SKIPS_HOLES = true;\n\nvar USES_TO_LENGTH = arrayMethodUsesToLength(FIND_INDEX);\n\n// Shouldn't skip holes\nif (FIND_INDEX in []) Array(1)[FIND_INDEX](function () { SKIPS_HOLES = false; });\n\n// `Array.prototype.findIndex` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.findindex\n$({ target: 'Array', proto: true, forced: SKIPS_HOLES || !USES_TO_LENGTH }, {\n  findIndex: function findIndex(callbackfn /* , that = undefined */) {\n    return $findIndex(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables(FIND_INDEX);\n","'use strict';\nvar $ = require('../internals/export');\nvar flattenIntoArray = require('../internals/flatten-into-array');\nvar toObject = require('../internals/to-object');\nvar toLength = require('../internals/to-length');\nvar toInteger = require('../internals/to-integer');\nvar arraySpeciesCreate = require('../internals/array-species-create');\n\n// `Array.prototype.flat` method\n// https://github.com/tc39/proposal-flatMap\n$({ target: 'Array', proto: true }, {\n  flat: function flat(/* depthArg = 1 */) {\n    var depthArg = arguments.length ? arguments[0] : undefined;\n    var O = toObject(this);\n    var sourceLen = toLength(O.length);\n    var A = arraySpeciesCreate(O, 0);\n    A.length = flattenIntoArray(A, O, O, sourceLen, 0, depthArg === undefined ? 1 : toInteger(depthArg));\n    return A;\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar flattenIntoArray = require('../internals/flatten-into-array');\nvar toObject = require('../internals/to-object');\nvar toLength = require('../internals/to-length');\nvar aFunction = require('../internals/a-function');\nvar arraySpeciesCreate = require('../internals/array-species-create');\n\n// `Array.prototype.flatMap` method\n// https://github.com/tc39/proposal-flatMap\n$({ target: 'Array', proto: true }, {\n  flatMap: function flatMap(callbackfn /* , thisArg */) {\n    var O = toObject(this);\n    var sourceLen = toLength(O.length);\n    var A;\n    aFunction(callbackfn);\n    A = arraySpeciesCreate(O, 0);\n    A.length = flattenIntoArray(A, O, O, sourceLen, 0, 1, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n    return A;\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar forEach = require('../internals/array-for-each');\n\n// `Array.prototype.forEach` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.foreach\n$({ target: 'Array', proto: true, forced: [].forEach != forEach }, {\n  forEach: forEach\n});\n","'use strict';\nvar $forEach = require('../internals/array-iteration').forEach;\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar STRICT_METHOD = arrayMethodIsStrict('forEach');\nvar USES_TO_LENGTH = arrayMethodUsesToLength('forEach');\n\n// `Array.prototype.forEach` method implementation\n// https://tc39.github.io/ecma262/#sec-array.prototype.foreach\nmodule.exports = (!STRICT_METHOD || !USES_TO_LENGTH) ? function forEach(callbackfn /* , thisArg */) {\n  return $forEach(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n} : [].forEach;\n","'use strict';\nvar $ = require('../internals/export');\nvar $includes = require('../internals/array-includes').includes;\nvar addToUnscopables = require('../internals/add-to-unscopables');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar USES_TO_LENGTH = arrayMethodUsesToLength('indexOf', { ACCESSORS: true, 1: 0 });\n\n// `Array.prototype.includes` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.includes\n$({ target: 'Array', proto: true, forced: !USES_TO_LENGTH }, {\n  includes: function includes(el /* , fromIndex = 0 */) {\n    return $includes(this, el, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables('includes');\n","'use strict';\nvar $ = require('../internals/export');\nvar $indexOf = require('../internals/array-includes').indexOf;\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar nativeIndexOf = [].indexOf;\n\nvar NEGATIVE_ZERO = !!nativeIndexOf && 1 / [1].indexOf(1, -0) < 0;\nvar STRICT_METHOD = arrayMethodIsStrict('indexOf');\nvar USES_TO_LENGTH = arrayMethodUsesToLength('indexOf', { ACCESSORS: true, 1: 0 });\n\n// `Array.prototype.indexOf` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.indexof\n$({ target: 'Array', proto: true, forced: NEGATIVE_ZERO || !STRICT_METHOD || !USES_TO_LENGTH }, {\n  indexOf: function indexOf(searchElement /* , fromIndex = 0 */) {\n    return NEGATIVE_ZERO\n      // convert -0 to +0\n      ? nativeIndexOf.apply(this, arguments) || 0\n      : $indexOf(this, searchElement, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n","'use strict';\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar addToUnscopables = require('../internals/add-to-unscopables');\nvar Iterators = require('../internals/iterators');\nvar InternalStateModule = require('../internals/internal-state');\nvar defineIterator = require('../internals/define-iterator');\n\nvar ARRAY_ITERATOR = 'Array Iterator';\nvar setInternalState = InternalStateModule.set;\nvar getInternalState = InternalStateModule.getterFor(ARRAY_ITERATOR);\n\n// `Array.prototype.entries` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.entries\n// `Array.prototype.keys` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.keys\n// `Array.prototype.values` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.values\n// `Array.prototype[@@iterator]` method\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@iterator\n// `CreateArrayIterator` internal method\n// https://tc39.github.io/ecma262/#sec-createarrayiterator\nmodule.exports = defineIterator(Array, 'Array', function (iterated, kind) {\n  setInternalState(this, {\n    type: ARRAY_ITERATOR,\n    target: toIndexedObject(iterated), // target\n    index: 0,                          // next index\n    kind: kind                         // kind\n  });\n// `%ArrayIteratorPrototype%.next` method\n// https://tc39.github.io/ecma262/#sec-%arrayiteratorprototype%.next\n}, function () {\n  var state = getInternalState(this);\n  var target = state.target;\n  var kind = state.kind;\n  var index = state.index++;\n  if (!target || index >= target.length) {\n    state.target = undefined;\n    return { value: undefined, done: true };\n  }\n  if (kind == 'keys') return { value: index, done: false };\n  if (kind == 'values') return { value: target[index], done: false };\n  return { value: [index, target[index]], done: false };\n}, 'values');\n\n// argumentsList[@@iterator] is %ArrayProto_values%\n// https://tc39.github.io/ecma262/#sec-createunmappedargumentsobject\n// https://tc39.github.io/ecma262/#sec-createmappedargumentsobject\nIterators.Arguments = Iterators.Array;\n\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables('keys');\naddToUnscopables('values');\naddToUnscopables('entries');\n","'use strict';\nvar $ = require('../internals/export');\nvar IndexedObject = require('../internals/indexed-object');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\n\nvar nativeJoin = [].join;\n\nvar ES3_STRINGS = IndexedObject != Object;\nvar STRICT_METHOD = arrayMethodIsStrict('join', ',');\n\n// `Array.prototype.join` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.join\n$({ target: 'Array', proto: true, forced: ES3_STRINGS || !STRICT_METHOD }, {\n  join: function join(separator) {\n    return nativeJoin.call(toIndexedObject(this), separator === undefined ? ',' : separator);\n  }\n});\n","var $ = require('../internals/export');\nvar lastIndexOf = require('../internals/array-last-index-of');\n\n// `Array.prototype.lastIndexOf` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.lastindexof\n$({ target: 'Array', proto: true, forced: lastIndexOf !== [].lastIndexOf }, {\n  lastIndexOf: lastIndexOf\n});\n","'use strict';\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar toInteger = require('../internals/to-integer');\nvar toLength = require('../internals/to-length');\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar min = Math.min;\nvar nativeLastIndexOf = [].lastIndexOf;\nvar NEGATIVE_ZERO = !!nativeLastIndexOf && 1 / [1].lastIndexOf(1, -0) < 0;\nvar STRICT_METHOD = arrayMethodIsStrict('lastIndexOf');\n// For preventing possible almost infinite loop in non-standard implementations, test the forward version of the method\nvar USES_TO_LENGTH = arrayMethodUsesToLength('indexOf', { ACCESSORS: true, 1: 0 });\nvar FORCED = NEGATIVE_ZERO || !STRICT_METHOD || !USES_TO_LENGTH;\n\n// `Array.prototype.lastIndexOf` method implementation\n// https://tc39.github.io/ecma262/#sec-array.prototype.lastindexof\nmodule.exports = FORCED ? function lastIndexOf(searchElement /* , fromIndex = @[*-1] */) {\n  // convert -0 to +0\n  if (NEGATIVE_ZERO) return nativeLastIndexOf.apply(this, arguments) || 0;\n  var O = toIndexedObject(this);\n  var length = toLength(O.length);\n  var index = length - 1;\n  if (arguments.length > 1) index = min(index, toInteger(arguments[1]));\n  if (index < 0) index = length + index;\n  for (;index >= 0; index--) if (index in O && O[index] === searchElement) return index || 0;\n  return -1;\n} : nativeLastIndexOf;\n","'use strict';\nvar $ = require('../internals/export');\nvar $map = require('../internals/array-iteration').map;\nvar arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('map');\n// FF49- issue\nvar USES_TO_LENGTH = arrayMethodUsesToLength('map');\n\n// `Array.prototype.map` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.map\n// with adding support of @@species\n$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT || !USES_TO_LENGTH }, {\n  map: function map(callbackfn /* , thisArg */) {\n    return $map(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar $reduce = require('../internals/array-reduce').left;\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\nvar CHROME_VERSION = require('../internals/engine-v8-version');\nvar IS_NODE = require('../internals/engine-is-node');\n\nvar STRICT_METHOD = arrayMethodIsStrict('reduce');\nvar USES_TO_LENGTH = arrayMethodUsesToLength('reduce', { 1: 0 });\n// Chrome 80-82 has a critical bug\n// https://bugs.chromium.org/p/chromium/issues/detail?id=1049982\nvar CHROME_BUG = !IS_NODE && CHROME_VERSION > 79 && CHROME_VERSION < 83;\n\n// `Array.prototype.reduce` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.reduce\n$({ target: 'Array', proto: true, forced: !STRICT_METHOD || !USES_TO_LENGTH || CHROME_BUG }, {\n  reduce: function reduce(callbackfn /* , initialValue */) {\n    return $reduce(this, callbackfn, arguments.length, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar $reduceRight = require('../internals/array-reduce').right;\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\nvar CHROME_VERSION = require('../internals/engine-v8-version');\nvar IS_NODE = require('../internals/engine-is-node');\n\nvar STRICT_METHOD = arrayMethodIsStrict('reduceRight');\n// For preventing possible almost infinite loop in non-standard implementations, test the forward version of the method\nvar USES_TO_LENGTH = arrayMethodUsesToLength('reduce', { 1: 0 });\n// Chrome 80-82 has a critical bug\n// https://bugs.chromium.org/p/chromium/issues/detail?id=1049982\nvar CHROME_BUG = !IS_NODE && CHROME_VERSION > 79 && CHROME_VERSION < 83;\n\n// `Array.prototype.reduceRight` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.reduceright\n$({ target: 'Array', proto: true, forced: !STRICT_METHOD || !USES_TO_LENGTH || CHROME_BUG }, {\n  reduceRight: function reduceRight(callbackfn /* , initialValue */) {\n    return $reduceRight(this, callbackfn, arguments.length, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar isArray = require('../internals/is-array');\n\nvar nativeReverse = [].reverse;\nvar test = [1, 2];\n\n// `Array.prototype.reverse` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.reverse\n// fix for Safari 12.0 bug\n// https://bugs.webkit.org/show_bug.cgi?id=188794\n$({ target: 'Array', proto: true, forced: String(test) === String(test.reverse()) }, {\n  reverse: function reverse() {\n    // eslint-disable-next-line no-self-assign\n    if (isArray(this)) this.length = this.length;\n    return nativeReverse.call(this);\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar isObject = require('../internals/is-object');\nvar isArray = require('../internals/is-array');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar toLength = require('../internals/to-length');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar createProperty = require('../internals/create-property');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('slice');\nvar USES_TO_LENGTH = arrayMethodUsesToLength('slice', { ACCESSORS: true, 0: 0, 1: 2 });\n\nvar SPECIES = wellKnownSymbol('species');\nvar nativeSlice = [].slice;\nvar max = Math.max;\n\n// `Array.prototype.slice` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.slice\n// fallback for not array-like ES3 strings and DOM objects\n$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT || !USES_TO_LENGTH }, {\n  slice: function slice(start, end) {\n    var O = toIndexedObject(this);\n    var length = toLength(O.length);\n    var k = toAbsoluteIndex(start, length);\n    var fin = toAbsoluteIndex(end === undefined ? length : end, length);\n    // inline `ArraySpeciesCreate` for usage native `Array#slice` where it's possible\n    var Constructor, result, n;\n    if (isArray(O)) {\n      Constructor = O.constructor;\n      // cross-realm fallback\n      if (typeof Constructor == 'function' && (Constructor === Array || isArray(Constructor.prototype))) {\n        Constructor = undefined;\n      } else if (isObject(Constructor)) {\n        Constructor = Constructor[SPECIES];\n        if (Constructor === null) Constructor = undefined;\n      }\n      if (Constructor === Array || Constructor === undefined) {\n        return nativeSlice.call(O, k, fin);\n      }\n    }\n    result = new (Constructor === undefined ? Array : Constructor)(max(fin - k, 0));\n    for (n = 0; k < fin; k++, n++) if (k in O) createProperty(result, n, O[k]);\n    result.length = n;\n    return result;\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar $some = require('../internals/array-iteration').some;\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar STRICT_METHOD = arrayMethodIsStrict('some');\nvar USES_TO_LENGTH = arrayMethodUsesToLength('some');\n\n// `Array.prototype.some` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.some\n$({ target: 'Array', proto: true, forced: !STRICT_METHOD || !USES_TO_LENGTH }, {\n  some: function some(callbackfn /* , thisArg */) {\n    return $some(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar aFunction = require('../internals/a-function');\nvar toObject = require('../internals/to-object');\nvar fails = require('../internals/fails');\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\n\nvar test = [];\nvar nativeSort = test.sort;\n\n// IE8-\nvar FAILS_ON_UNDEFINED = fails(function () {\n  test.sort(undefined);\n});\n// V8 bug\nvar FAILS_ON_NULL = fails(function () {\n  test.sort(null);\n});\n// Old WebKit\nvar STRICT_METHOD = arrayMethodIsStrict('sort');\n\nvar FORCED = FAILS_ON_UNDEFINED || !FAILS_ON_NULL || !STRICT_METHOD;\n\n// `Array.prototype.sort` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.sort\n$({ target: 'Array', proto: true, forced: FORCED }, {\n  sort: function sort(comparefn) {\n    return comparefn === undefined\n      ? nativeSort.call(toObject(this))\n      : nativeSort.call(toObject(this), aFunction(comparefn));\n  }\n});\n","var setSpecies = require('../internals/set-species');\n\n// `Array[@@species]` getter\n// https://tc39.github.io/ecma262/#sec-get-array-@@species\nsetSpecies('Array');\n","'use strict';\nvar getBuiltIn = require('../internals/get-built-in');\nvar definePropertyModule = require('../internals/object-define-property');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar DESCRIPTORS = require('../internals/descriptors');\n\nvar SPECIES = wellKnownSymbol('species');\n\nmodule.exports = function (CONSTRUCTOR_NAME) {\n  var Constructor = getBuiltIn(CONSTRUCTOR_NAME);\n  var defineProperty = definePropertyModule.f;\n\n  if (DESCRIPTORS && Constructor && !Constructor[SPECIES]) {\n    defineProperty(Constructor, SPECIES, {\n      configurable: true,\n      get: function () { return this; }\n    });\n  }\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar toInteger = require('../internals/to-integer');\nvar toLength = require('../internals/to-length');\nvar toObject = require('../internals/to-object');\nvar arraySpeciesCreate = require('../internals/array-species-create');\nvar createProperty = require('../internals/create-property');\nvar arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('splice');\nvar USES_TO_LENGTH = arrayMethodUsesToLength('splice', { ACCESSORS: true, 0: 0, 1: 2 });\n\nvar max = Math.max;\nvar min = Math.min;\nvar MAX_SAFE_INTEGER = 0x1FFFFFFFFFFFFF;\nvar MAXIMUM_ALLOWED_LENGTH_EXCEEDED = 'Maximum allowed length exceeded';\n\n// `Array.prototype.splice` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.splice\n// with adding support of @@species\n$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT || !USES_TO_LENGTH }, {\n  splice: function splice(start, deleteCount /* , ...items */) {\n    var O = toObject(this);\n    var len = toLength(O.length);\n    var actualStart = toAbsoluteIndex(start, len);\n    var argumentsLength = arguments.length;\n    var insertCount, actualDeleteCount, A, k, from, to;\n    if (argumentsLength === 0) {\n      insertCount = actualDeleteCount = 0;\n    } else if (argumentsLength === 1) {\n      insertCount = 0;\n      actualDeleteCount = len - actualStart;\n    } else {\n      insertCount = argumentsLength - 2;\n      actualDeleteCount = min(max(toInteger(deleteCount), 0), len - actualStart);\n    }\n    if (len + insertCount - actualDeleteCount > MAX_SAFE_INTEGER) {\n      throw TypeError(MAXIMUM_ALLOWED_LENGTH_EXCEEDED);\n    }\n    A = arraySpeciesCreate(O, actualDeleteCount);\n    for (k = 0; k < actualDeleteCount; k++) {\n      from = actualStart + k;\n      if (from in O) createProperty(A, k, O[from]);\n    }\n    A.length = actualDeleteCount;\n    if (insertCount < actualDeleteCount) {\n      for (k = actualStart; k < len - actualDeleteCount; k++) {\n        from = k + actualDeleteCount;\n        to = k + insertCount;\n        if (from in O) O[to] = O[from];\n        else delete O[to];\n      }\n      for (k = len; k > len - actualDeleteCount + insertCount; k--) delete O[k - 1];\n    } else if (insertCount > actualDeleteCount) {\n      for (k = len - actualDeleteCount; k > actualStart; k--) {\n        from = k + actualDeleteCount - 1;\n        to = k + insertCount - 1;\n        if (from in O) O[to] = O[from];\n        else delete O[to];\n      }\n    }\n    for (k = 0; k < insertCount; k++) {\n      O[k + actualStart] = arguments[k + 2];\n    }\n    O.length = len - actualDeleteCount + insertCount;\n    return A;\n  }\n});\n","// this method was added to unscopables after implementation\n// in popular engines, so it's moved to a separate module\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\naddToUnscopables('flat');\n","// this method was added to unscopables after implementation\n// in popular engines, so it's moved to a separate module\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\naddToUnscopables('flatMap');\n","require('../../modules/es.symbol');\nrequire('../../modules/es.object.assign');\nrequire('../../modules/es.object.create');\nrequire('../../modules/es.object.define-property');\nrequire('../../modules/es.object.define-properties');\nrequire('../../modules/es.object.entries');\nrequire('../../modules/es.object.freeze');\nrequire('../../modules/es.object.from-entries');\nrequire('../../modules/es.object.get-own-property-descriptor');\nrequire('../../modules/es.object.get-own-property-descriptors');\nrequire('../../modules/es.object.get-own-property-names');\nrequire('../../modules/es.object.get-prototype-of');\nrequire('../../modules/es.object.is');\nrequire('../../modules/es.object.is-extensible');\nrequire('../../modules/es.object.is-frozen');\nrequire('../../modules/es.object.is-sealed');\nrequire('../../modules/es.object.keys');\nrequire('../../modules/es.object.prevent-extensions');\nrequire('../../modules/es.object.seal');\nrequire('../../modules/es.object.set-prototype-of');\nrequire('../../modules/es.object.values');\nrequire('../../modules/es.object.to-string');\nrequire('../../modules/es.object.define-getter');\nrequire('../../modules/es.object.define-setter');\nrequire('../../modules/es.object.lookup-getter');\nrequire('../../modules/es.object.lookup-setter');\nrequire('../../modules/es.json.to-string-tag');\nrequire('../../modules/es.math.to-string-tag');\nrequire('../../modules/es.reflect.to-string-tag');\nvar path = require('../../internals/path');\n\nmodule.exports = path.Object;\n","'use strict';\nvar $ = require('../internals/export');\nvar global = require('../internals/global');\nvar getBuiltIn = require('../internals/get-built-in');\nvar IS_PURE = require('../internals/is-pure');\nvar DESCRIPTORS = require('../internals/descriptors');\nvar NATIVE_SYMBOL = require('../internals/native-symbol');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\nvar fails = require('../internals/fails');\nvar has = require('../internals/has');\nvar isArray = require('../internals/is-array');\nvar isObject = require('../internals/is-object');\nvar anObject = require('../internals/an-object');\nvar toObject = require('../internals/to-object');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar toPrimitive = require('../internals/to-primitive');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\nvar nativeObjectCreate = require('../internals/object-create');\nvar objectKeys = require('../internals/object-keys');\nvar getOwnPropertyNamesModule = require('../internals/object-get-own-property-names');\nvar getOwnPropertyNamesExternal = require('../internals/object-get-own-property-names-external');\nvar getOwnPropertySymbolsModule = require('../internals/object-get-own-property-symbols');\nvar getOwnPropertyDescriptorModule = require('../internals/object-get-own-property-descriptor');\nvar definePropertyModule = require('../internals/object-define-property');\nvar propertyIsEnumerableModule = require('../internals/object-property-is-enumerable');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar redefine = require('../internals/redefine');\nvar shared = require('../internals/shared');\nvar sharedKey = require('../internals/shared-key');\nvar hiddenKeys = require('../internals/hidden-keys');\nvar uid = require('../internals/uid');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\nvar wrappedWellKnownSymbolModule = require('../internals/well-known-symbol-wrapped');\nvar defineWellKnownSymbol = require('../internals/define-well-known-symbol');\nvar setToStringTag = require('../internals/set-to-string-tag');\nvar InternalStateModule = require('../internals/internal-state');\nvar $forEach = require('../internals/array-iteration').forEach;\n\nvar HIDDEN = sharedKey('hidden');\nvar SYMBOL = 'Symbol';\nvar PROTOTYPE = 'prototype';\nvar TO_PRIMITIVE = wellKnownSymbol('toPrimitive');\nvar setInternalState = InternalStateModule.set;\nvar getInternalState = InternalStateModule.getterFor(SYMBOL);\nvar ObjectPrototype = Object[PROTOTYPE];\nvar $Symbol = global.Symbol;\nvar $stringify = getBuiltIn('JSON', 'stringify');\nvar nativeGetOwnPropertyDescriptor = getOwnPropertyDescriptorModule.f;\nvar nativeDefineProperty = definePropertyModule.f;\nvar nativeGetOwnPropertyNames = getOwnPropertyNamesExternal.f;\nvar nativePropertyIsEnumerable = propertyIsEnumerableModule.f;\nvar AllSymbols = shared('symbols');\nvar ObjectPrototypeSymbols = shared('op-symbols');\nvar StringToSymbolRegistry = shared('string-to-symbol-registry');\nvar SymbolToStringRegistry = shared('symbol-to-string-registry');\nvar WellKnownSymbolsStore = shared('wks');\nvar QObject = global.QObject;\n// Don't use setters in Qt Script, https://github.com/zloirock/core-js/issues/173\nvar USE_SETTER = !QObject || !QObject[PROTOTYPE] || !QObject[PROTOTYPE].findChild;\n\n// fallback for old Android, https://code.google.com/p/v8/issues/detail?id=687\nvar setSymbolDescriptor = DESCRIPTORS && fails(function () {\n  return nativeObjectCreate(nativeDefineProperty({}, 'a', {\n    get: function () { return nativeDefineProperty(this, 'a', { value: 7 }).a; }\n  })).a != 7;\n}) ? function (O, P, Attributes) {\n  var ObjectPrototypeDescriptor = nativeGetOwnPropertyDescriptor(ObjectPrototype, P);\n  if (ObjectPrototypeDescriptor) delete ObjectPrototype[P];\n  nativeDefineProperty(O, P, Attributes);\n  if (ObjectPrototypeDescriptor && O !== ObjectPrototype) {\n    nativeDefineProperty(ObjectPrototype, P, ObjectPrototypeDescriptor);\n  }\n} : nativeDefineProperty;\n\nvar wrap = function (tag, description) {\n  var symbol = AllSymbols[tag] = nativeObjectCreate($Symbol[PROTOTYPE]);\n  setInternalState(symbol, {\n    type: SYMBOL,\n    tag: tag,\n    description: description\n  });\n  if (!DESCRIPTORS) symbol.description = description;\n  return symbol;\n};\n\nvar isSymbol = USE_SYMBOL_AS_UID ? function (it) {\n  return typeof it == 'symbol';\n} : function (it) {\n  return Object(it) instanceof $Symbol;\n};\n\nvar $defineProperty = function defineProperty(O, P, Attributes) {\n  if (O === ObjectPrototype) $defineProperty(ObjectPrototypeSymbols, P, Attributes);\n  anObject(O);\n  var key = toPrimitive(P, true);\n  anObject(Attributes);\n  if (has(AllSymbols, key)) {\n    if (!Attributes.enumerable) {\n      if (!has(O, HIDDEN)) nativeDefineProperty(O, HIDDEN, createPropertyDescriptor(1, {}));\n      O[HIDDEN][key] = true;\n    } else {\n      if (has(O, HIDDEN) && O[HIDDEN][key]) O[HIDDEN][key] = false;\n      Attributes = nativeObjectCreate(Attributes, { enumerable: createPropertyDescriptor(0, false) });\n    } return setSymbolDescriptor(O, key, Attributes);\n  } return nativeDefineProperty(O, key, Attributes);\n};\n\nvar $defineProperties = function defineProperties(O, Properties) {\n  anObject(O);\n  var properties = toIndexedObject(Properties);\n  var keys = objectKeys(properties).concat($getOwnPropertySymbols(properties));\n  $forEach(keys, function (key) {\n    if (!DESCRIPTORS || $propertyIsEnumerable.call(properties, key)) $defineProperty(O, key, properties[key]);\n  });\n  return O;\n};\n\nvar $create = function create(O, Properties) {\n  return Properties === undefined ? nativeObjectCreate(O) : $defineProperties(nativeObjectCreate(O), Properties);\n};\n\nvar $propertyIsEnumerable = function propertyIsEnumerable(V) {\n  var P = toPrimitive(V, true);\n  var enumerable = nativePropertyIsEnumerable.call(this, P);\n  if (this === ObjectPrototype && has(AllSymbols, P) && !has(ObjectPrototypeSymbols, P)) return false;\n  return enumerable || !has(this, P) || !has(AllSymbols, P) || has(this, HIDDEN) && this[HIDDEN][P] ? enumerable : true;\n};\n\nvar $getOwnPropertyDescriptor = function getOwnPropertyDescriptor(O, P) {\n  var it = toIndexedObject(O);\n  var key = toPrimitive(P, true);\n  if (it === ObjectPrototype && has(AllSymbols, key) && !has(ObjectPrototypeSymbols, key)) return;\n  var descriptor = nativeGetOwnPropertyDescriptor(it, key);\n  if (descriptor && has(AllSymbols, key) && !(has(it, HIDDEN) && it[HIDDEN][key])) {\n    descriptor.enumerable = true;\n  }\n  return descriptor;\n};\n\nvar $getOwnPropertyNames = function getOwnPropertyNames(O) {\n  var names = nativeGetOwnPropertyNames(toIndexedObject(O));\n  var result = [];\n  $forEach(names, function (key) {\n    if (!has(AllSymbols, key) && !has(hiddenKeys, key)) result.push(key);\n  });\n  return result;\n};\n\nvar $getOwnPropertySymbols = function getOwnPropertySymbols(O) {\n  var IS_OBJECT_PROTOTYPE = O === ObjectPrototype;\n  var names = nativeGetOwnPropertyNames(IS_OBJECT_PROTOTYPE ? ObjectPrototypeSymbols : toIndexedObject(O));\n  var result = [];\n  $forEach(names, function (key) {\n    if (has(AllSymbols, key) && (!IS_OBJECT_PROTOTYPE || has(ObjectPrototype, key))) {\n      result.push(AllSymbols[key]);\n    }\n  });\n  return result;\n};\n\n// `Symbol` constructor\n// https://tc39.github.io/ecma262/#sec-symbol-constructor\nif (!NATIVE_SYMBOL) {\n  $Symbol = function Symbol() {\n    if (this instanceof $Symbol) throw TypeError('Symbol is not a constructor');\n    var description = !arguments.length || arguments[0] === undefined ? undefined : String(arguments[0]);\n    var tag = uid(description);\n    var setter = function (value) {\n      if (this === ObjectPrototype) setter.call(ObjectPrototypeSymbols, value);\n      if (has(this, HIDDEN) && has(this[HIDDEN], tag)) this[HIDDEN][tag] = false;\n      setSymbolDescriptor(this, tag, createPropertyDescriptor(1, value));\n    };\n    if (DESCRIPTORS && USE_SETTER) setSymbolDescriptor(ObjectPrototype, tag, { configurable: true, set: setter });\n    return wrap(tag, description);\n  };\n\n  redefine($Symbol[PROTOTYPE], 'toString', function toString() {\n    return getInternalState(this).tag;\n  });\n\n  redefine($Symbol, 'withoutSetter', function (description) {\n    return wrap(uid(description), description);\n  });\n\n  propertyIsEnumerableModule.f = $propertyIsEnumerable;\n  definePropertyModule.f = $defineProperty;\n  getOwnPropertyDescriptorModule.f = $getOwnPropertyDescriptor;\n  getOwnPropertyNamesModule.f = getOwnPropertyNamesExternal.f = $getOwnPropertyNames;\n  getOwnPropertySymbolsModule.f = $getOwnPropertySymbols;\n\n  wrappedWellKnownSymbolModule.f = function (name) {\n    return wrap(wellKnownSymbol(name), name);\n  };\n\n  if (DESCRIPTORS) {\n    // https://github.com/tc39/proposal-Symbol-description\n    nativeDefineProperty($Symbol[PROTOTYPE], 'description', {\n      configurable: true,\n      get: function description() {\n        return getInternalState(this).description;\n      }\n    });\n    if (!IS_PURE) {\n      redefine(ObjectPrototype, 'propertyIsEnumerable', $propertyIsEnumerable, { unsafe: true });\n    }\n  }\n}\n\n$({ global: true, wrap: true, forced: !NATIVE_SYMBOL, sham: !NATIVE_SYMBOL }, {\n  Symbol: $Symbol\n});\n\n$forEach(objectKeys(WellKnownSymbolsStore), function (name) {\n  defineWellKnownSymbol(name);\n});\n\n$({ target: SYMBOL, stat: true, forced: !NATIVE_SYMBOL }, {\n  // `Symbol.for` method\n  // https://tc39.github.io/ecma262/#sec-symbol.for\n  'for': function (key) {\n    var string = String(key);\n    if (has(StringToSymbolRegistry, string)) return StringToSymbolRegistry[string];\n    var symbol = $Symbol(string);\n    StringToSymbolRegistry[string] = symbol;\n    SymbolToStringRegistry[symbol] = string;\n    return symbol;\n  },\n  // `Symbol.keyFor` method\n  // https://tc39.github.io/ecma262/#sec-symbol.keyfor\n  keyFor: function keyFor(sym) {\n    if (!isSymbol(sym)) throw TypeError(sym + ' is not a symbol');\n    if (has(SymbolToStringRegistry, sym)) return SymbolToStringRegistry[sym];\n  },\n  useSetter: function () { USE_SETTER = true; },\n  useSimple: function () { USE_SETTER = false; }\n});\n\n$({ target: 'Object', stat: true, forced: !NATIVE_SYMBOL, sham: !DESCRIPTORS }, {\n  // `Object.create` method\n  // https://tc39.github.io/ecma262/#sec-object.create\n  create: $create,\n  // `Object.defineProperty` method\n  // https://tc39.github.io/ecma262/#sec-object.defineproperty\n  defineProperty: $defineProperty,\n  // `Object.defineProperties` method\n  // https://tc39.github.io/ecma262/#sec-object.defineproperties\n  defineProperties: $defineProperties,\n  // `Object.getOwnPropertyDescriptor` method\n  // https://tc39.github.io/ecma262/#sec-object.getownpropertydescriptors\n  getOwnPropertyDescriptor: $getOwnPropertyDescriptor\n});\n\n$({ target: 'Object', stat: true, forced: !NATIVE_SYMBOL }, {\n  // `Object.getOwnPropertyNames` method\n  // https://tc39.github.io/ecma262/#sec-object.getownpropertynames\n  getOwnPropertyNames: $getOwnPropertyNames,\n  // `Object.getOwnPropertySymbols` method\n  // https://tc39.github.io/ecma262/#sec-object.getownpropertysymbols\n  getOwnPropertySymbols: $getOwnPropertySymbols\n});\n\n// Chrome 38 and 39 `Object.getOwnPropertySymbols` fails on primitives\n// https://bugs.chromium.org/p/v8/issues/detail?id=3443\n$({ target: 'Object', stat: true, forced: fails(function () { getOwnPropertySymbolsModule.f(1); }) }, {\n  getOwnPropertySymbols: function getOwnPropertySymbols(it) {\n    return getOwnPropertySymbolsModule.f(toObject(it));\n  }\n});\n\n// `JSON.stringify` method behavior with symbols\n// https://tc39.github.io/ecma262/#sec-json.stringify\nif ($stringify) {\n  var FORCED_JSON_STRINGIFY = !NATIVE_SYMBOL || fails(function () {\n    var symbol = $Symbol();\n    // MS Edge converts symbol values to JSON as {}\n    return $stringify([symbol]) != '[null]'\n      // WebKit converts symbol values to JSON as null\n      || $stringify({ a: symbol }) != '{}'\n      // V8 throws on boxed symbols\n      || $stringify(Object(symbol)) != '{}';\n  });\n\n  $({ target: 'JSON', stat: true, forced: FORCED_JSON_STRINGIFY }, {\n    // eslint-disable-next-line no-unused-vars\n    stringify: function stringify(it, replacer, space) {\n      var args = [it];\n      var index = 1;\n      var $replacer;\n      while (arguments.length > index) args.push(arguments[index++]);\n      $replacer = replacer;\n      if (!isObject(replacer) && it === undefined || isSymbol(it)) return; // IE8 returns string on undefined\n      if (!isArray(replacer)) replacer = function (key, value) {\n        if (typeof $replacer == 'function') value = $replacer.call(this, key, value);\n        if (!isSymbol(value)) return value;\n      };\n      args[1] = replacer;\n      return $stringify.apply(null, args);\n    }\n  });\n}\n\n// `Symbol.prototype[@@toPrimitive]` method\n// https://tc39.github.io/ecma262/#sec-symbol.prototype-@@toprimitive\nif (!$Symbol[PROTOTYPE][TO_PRIMITIVE]) {\n  createNonEnumerableProperty($Symbol[PROTOTYPE], TO_PRIMITIVE, $Symbol[PROTOTYPE].valueOf);\n}\n// `Symbol.prototype[@@toStringTag]` property\n// https://tc39.github.io/ecma262/#sec-symbol.prototype-@@tostringtag\nsetToStringTag($Symbol, SYMBOL);\n\nhiddenKeys[HIDDEN] = true;\n","var path = require('../internals/path');\nvar has = require('../internals/has');\nvar wrappedWellKnownSymbolModule = require('../internals/well-known-symbol-wrapped');\nvar defineProperty = require('../internals/object-define-property').f;\n\nmodule.exports = function (NAME) {\n  var Symbol = path.Symbol || (path.Symbol = {});\n  if (!has(Symbol, NAME)) defineProperty(Symbol, NAME, {\n    value: wrappedWellKnownSymbolModule.f(NAME)\n  });\n};\n","var $ = require('../internals/export');\nvar assign = require('../internals/object-assign');\n\n// `Object.assign` method\n// https://tc39.github.io/ecma262/#sec-object.assign\n$({ target: 'Object', stat: true, forced: Object.assign !== assign }, {\n  assign: assign\n});\n","'use strict';\nvar DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\nvar objectKeys = require('../internals/object-keys');\nvar getOwnPropertySymbolsModule = require('../internals/object-get-own-property-symbols');\nvar propertyIsEnumerableModule = require('../internals/object-property-is-enumerable');\nvar toObject = require('../internals/to-object');\nvar IndexedObject = require('../internals/indexed-object');\n\nvar nativeAssign = Object.assign;\nvar defineProperty = Object.defineProperty;\n\n// `Object.assign` method\n// https://tc39.github.io/ecma262/#sec-object.assign\nmodule.exports = !nativeAssign || fails(function () {\n  // should have correct order of operations (Edge bug)\n  if (DESCRIPTORS && nativeAssign({ b: 1 }, nativeAssign(defineProperty({}, 'a', {\n    enumerable: true,\n    get: function () {\n      defineProperty(this, 'b', {\n        value: 3,\n        enumerable: false\n      });\n    }\n  }), { b: 2 })).b !== 1) return true;\n  // should work with symbols and should have deterministic property order (V8 bug)\n  var A = {};\n  var B = {};\n  // eslint-disable-next-line no-undef\n  var symbol = Symbol();\n  var alphabet = 'abcdefghijklmnopqrst';\n  A[symbol] = 7;\n  alphabet.split('').forEach(function (chr) { B[chr] = chr; });\n  return nativeAssign({}, A)[symbol] != 7 || objectKeys(nativeAssign({}, B)).join('') != alphabet;\n}) ? function assign(target, source) { // eslint-disable-line no-unused-vars\n  var T = toObject(target);\n  var argumentsLength = arguments.length;\n  var index = 1;\n  var getOwnPropertySymbols = getOwnPropertySymbolsModule.f;\n  var propertyIsEnumerable = propertyIsEnumerableModule.f;\n  while (argumentsLength > index) {\n    var S = IndexedObject(arguments[index++]);\n    var keys = getOwnPropertySymbols ? objectKeys(S).concat(getOwnPropertySymbols(S)) : objectKeys(S);\n    var length = keys.length;\n    var j = 0;\n    var key;\n    while (length > j) {\n      key = keys[j++];\n      if (!DESCRIPTORS || propertyIsEnumerable.call(S, key)) T[key] = S[key];\n    }\n  } return T;\n} : nativeAssign;\n","var $ = require('../internals/export');\nvar DESCRIPTORS = require('../internals/descriptors');\nvar create = require('../internals/object-create');\n\n// `Object.create` method\n// https://tc39.github.io/ecma262/#sec-object.create\n$({ target: 'Object', stat: true, sham: !DESCRIPTORS }, {\n  create: create\n});\n","var $ = require('../internals/export');\nvar DESCRIPTORS = require('../internals/descriptors');\nvar objectDefinePropertyModile = require('../internals/object-define-property');\n\n// `Object.defineProperty` method\n// https://tc39.github.io/ecma262/#sec-object.defineproperty\n$({ target: 'Object', stat: true, forced: !DESCRIPTORS, sham: !DESCRIPTORS }, {\n  defineProperty: objectDefinePropertyModile.f\n});\n","var $ = require('../internals/export');\nvar DESCRIPTORS = require('../internals/descriptors');\nvar defineProperties = require('../internals/object-define-properties');\n\n// `Object.defineProperties` method\n// https://tc39.github.io/ecma262/#sec-object.defineproperties\n$({ target: 'Object', stat: true, forced: !DESCRIPTORS, sham: !DESCRIPTORS }, {\n  defineProperties: defineProperties\n});\n","var $ = require('../internals/export');\nvar $entries = require('../internals/object-to-array').entries;\n\n// `Object.entries` method\n// https://tc39.github.io/ecma262/#sec-object.entries\n$({ target: 'Object', stat: true }, {\n  entries: function entries(O) {\n    return $entries(O);\n  }\n});\n","var $ = require('../internals/export');\nvar FREEZING = require('../internals/freezing');\nvar fails = require('../internals/fails');\nvar isObject = require('../internals/is-object');\nvar onFreeze = require('../internals/internal-metadata').onFreeze;\n\nvar nativeFreeze = Object.freeze;\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeFreeze(1); });\n\n// `Object.freeze` method\n// https://tc39.github.io/ecma262/#sec-object.freeze\n$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES, sham: !FREEZING }, {\n  freeze: function freeze(it) {\n    return nativeFreeze && isObject(it) ? nativeFreeze(onFreeze(it)) : it;\n  }\n});\n","var $ = require('../internals/export');\nvar iterate = require('../internals/iterate');\nvar createProperty = require('../internals/create-property');\n\n// `Object.fromEntries` method\n// https://github.com/tc39/proposal-object-from-entries\n$({ target: 'Object', stat: true }, {\n  fromEntries: function fromEntries(iterable) {\n    var obj = {};\n    iterate(iterable, function (k, v) {\n      createProperty(obj, k, v);\n    }, { AS_ENTRIES: true });\n    return obj;\n  }\n});\n","var anObject = require('../internals/an-object');\nvar isArrayIteratorMethod = require('../internals/is-array-iterator-method');\nvar toLength = require('../internals/to-length');\nvar bind = require('../internals/function-bind-context');\nvar getIteratorMethod = require('../internals/get-iterator-method');\nvar iteratorClose = require('../internals/iterator-close');\n\nvar Result = function (stopped, result) {\n  this.stopped = stopped;\n  this.result = result;\n};\n\nmodule.exports = function (iterable, unboundFunction, options) {\n  var that = options && options.that;\n  var AS_ENTRIES = !!(options && options.AS_ENTRIES);\n  var IS_ITERATOR = !!(options && options.IS_ITERATOR);\n  var INTERRUPTED = !!(options && options.INTERRUPTED);\n  var fn = bind(unboundFunction, that, 1 + AS_ENTRIES + INTERRUPTED);\n  var iterator, iterFn, index, length, result, next, step;\n\n  var stop = function (condition) {\n    if (iterator) iteratorClose(iterator);\n    return new Result(true, condition);\n  };\n\n  var callFn = function (value) {\n    if (AS_ENTRIES) {\n      anObject(value);\n      return INTERRUPTED ? fn(value[0], value[1], stop) : fn(value[0], value[1]);\n    } return INTERRUPTED ? fn(value, stop) : fn(value);\n  };\n\n  if (IS_ITERATOR) {\n    iterator = iterable;\n  } else {\n    iterFn = getIteratorMethod(iterable);\n    if (typeof iterFn != 'function') throw TypeError('Target is not iterable');\n    // optimisation for array iterators\n    if (isArrayIteratorMethod(iterFn)) {\n      for (index = 0, length = toLength(iterable.length); length > index; index++) {\n        result = callFn(iterable[index]);\n        if (result && result instanceof Result) return result;\n      } return new Result(false);\n    }\n    iterator = iterFn.call(iterable);\n  }\n\n  next = iterator.next;\n  while (!(step = next.call(iterator)).done) {\n    try {\n      result = callFn(step.value);\n    } catch (error) {\n      iteratorClose(iterator);\n      throw error;\n    }\n    if (typeof result == 'object' && result && result instanceof Result) return result;\n  } return new Result(false);\n};\n","var $ = require('../internals/export');\nvar fails = require('../internals/fails');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar nativeGetOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar DESCRIPTORS = require('../internals/descriptors');\n\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeGetOwnPropertyDescriptor(1); });\nvar FORCED = !DESCRIPTORS || FAILS_ON_PRIMITIVES;\n\n// `Object.getOwnPropertyDescriptor` method\n// https://tc39.github.io/ecma262/#sec-object.getownpropertydescriptor\n$({ target: 'Object', stat: true, forced: FORCED, sham: !DESCRIPTORS }, {\n  getOwnPropertyDescriptor: function getOwnPropertyDescriptor(it, key) {\n    return nativeGetOwnPropertyDescriptor(toIndexedObject(it), key);\n  }\n});\n","var $ = require('../internals/export');\nvar DESCRIPTORS = require('../internals/descriptors');\nvar ownKeys = require('../internals/own-keys');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar getOwnPropertyDescriptorModule = require('../internals/object-get-own-property-descriptor');\nvar createProperty = require('../internals/create-property');\n\n// `Object.getOwnPropertyDescriptors` method\n// https://tc39.github.io/ecma262/#sec-object.getownpropertydescriptors\n$({ target: 'Object', stat: true, sham: !DESCRIPTORS }, {\n  getOwnPropertyDescriptors: function getOwnPropertyDescriptors(object) {\n    var O = toIndexedObject(object);\n    var getOwnPropertyDescriptor = getOwnPropertyDescriptorModule.f;\n    var keys = ownKeys(O);\n    var result = {};\n    var index = 0;\n    var key, descriptor;\n    while (keys.length > index) {\n      descriptor = getOwnPropertyDescriptor(O, key = keys[index++]);\n      if (descriptor !== undefined) createProperty(result, key, descriptor);\n    }\n    return result;\n  }\n});\n","var $ = require('../internals/export');\nvar fails = require('../internals/fails');\nvar nativeGetOwnPropertyNames = require('../internals/object-get-own-property-names-external').f;\n\nvar FAILS_ON_PRIMITIVES = fails(function () { return !Object.getOwnPropertyNames(1); });\n\n// `Object.getOwnPropertyNames` method\n// https://tc39.github.io/ecma262/#sec-object.getownpropertynames\n$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES }, {\n  getOwnPropertyNames: nativeGetOwnPropertyNames\n});\n","var $ = require('../internals/export');\nvar fails = require('../internals/fails');\nvar toObject = require('../internals/to-object');\nvar nativeGetPrototypeOf = require('../internals/object-get-prototype-of');\nvar CORRECT_PROTOTYPE_GETTER = require('../internals/correct-prototype-getter');\n\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeGetPrototypeOf(1); });\n\n// `Object.getPrototypeOf` method\n// https://tc39.github.io/ecma262/#sec-object.getprototypeof\n$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES, sham: !CORRECT_PROTOTYPE_GETTER }, {\n  getPrototypeOf: function getPrototypeOf(it) {\n    return nativeGetPrototypeOf(toObject(it));\n  }\n});\n\n","var $ = require('../internals/export');\nvar is = require('../internals/same-value');\n\n// `Object.is` method\n// https://tc39.github.io/ecma262/#sec-object.is\n$({ target: 'Object', stat: true }, {\n  is: is\n});\n","// `SameValue` abstract operation\n// https://tc39.github.io/ecma262/#sec-samevalue\nmodule.exports = Object.is || function is(x, y) {\n  // eslint-disable-next-line no-self-compare\n  return x === y ? x !== 0 || 1 / x === 1 / y : x != x && y != y;\n};\n","var $ = require('../internals/export');\nvar fails = require('../internals/fails');\nvar isObject = require('../internals/is-object');\n\nvar nativeIsExtensible = Object.isExtensible;\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeIsExtensible(1); });\n\n// `Object.isExtensible` method\n// https://tc39.github.io/ecma262/#sec-object.isextensible\n$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES }, {\n  isExtensible: function isExtensible(it) {\n    return isObject(it) ? nativeIsExtensible ? nativeIsExtensible(it) : true : false;\n  }\n});\n","var $ = require('../internals/export');\nvar fails = require('../internals/fails');\nvar isObject = require('../internals/is-object');\n\nvar nativeIsFrozen = Object.isFrozen;\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeIsFrozen(1); });\n\n// `Object.isFrozen` method\n// https://tc39.github.io/ecma262/#sec-object.isfrozen\n$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES }, {\n  isFrozen: function isFrozen(it) {\n    return isObject(it) ? nativeIsFrozen ? nativeIsFrozen(it) : false : true;\n  }\n});\n","var $ = require('../internals/export');\nvar fails = require('../internals/fails');\nvar isObject = require('../internals/is-object');\n\nvar nativeIsSealed = Object.isSealed;\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeIsSealed(1); });\n\n// `Object.isSealed` method\n// https://tc39.github.io/ecma262/#sec-object.issealed\n$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES }, {\n  isSealed: function isSealed(it) {\n    return isObject(it) ? nativeIsSealed ? nativeIsSealed(it) : false : true;\n  }\n});\n","var $ = require('../internals/export');\nvar toObject = require('../internals/to-object');\nvar nativeKeys = require('../internals/object-keys');\nvar fails = require('../internals/fails');\n\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeKeys(1); });\n\n// `Object.keys` method\n// https://tc39.github.io/ecma262/#sec-object.keys\n$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES }, {\n  keys: function keys(it) {\n    return nativeKeys(toObject(it));\n  }\n});\n","var $ = require('../internals/export');\nvar isObject = require('../internals/is-object');\nvar onFreeze = require('../internals/internal-metadata').onFreeze;\nvar FREEZING = require('../internals/freezing');\nvar fails = require('../internals/fails');\n\nvar nativePreventExtensions = Object.preventExtensions;\nvar FAILS_ON_PRIMITIVES = fails(function () { nativePreventExtensions(1); });\n\n// `Object.preventExtensions` method\n// https://tc39.github.io/ecma262/#sec-object.preventextensions\n$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES, sham: !FREEZING }, {\n  preventExtensions: function preventExtensions(it) {\n    return nativePreventExtensions && isObject(it) ? nativePreventExtensions(onFreeze(it)) : it;\n  }\n});\n","var $ = require('../internals/export');\nvar isObject = require('../internals/is-object');\nvar onFreeze = require('../internals/internal-metadata').onFreeze;\nvar FREEZING = require('../internals/freezing');\nvar fails = require('../internals/fails');\n\nvar nativeSeal = Object.seal;\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeSeal(1); });\n\n// `Object.seal` method\n// https://tc39.github.io/ecma262/#sec-object.seal\n$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES, sham: !FREEZING }, {\n  seal: function seal(it) {\n    return nativeSeal && isObject(it) ? nativeSeal(onFreeze(it)) : it;\n  }\n});\n","var $ = require('../internals/export');\nvar setPrototypeOf = require('../internals/object-set-prototype-of');\n\n// `Object.setPrototypeOf` method\n// https://tc39.github.io/ecma262/#sec-object.setprototypeof\n$({ target: 'Object', stat: true }, {\n  setPrototypeOf: setPrototypeOf\n});\n","var $ = require('../internals/export');\nvar $values = require('../internals/object-to-array').values;\n\n// `Object.values` method\n// https://tc39.github.io/ecma262/#sec-object.values\n$({ target: 'Object', stat: true }, {\n  values: function values(O) {\n    return $values(O);\n  }\n});\n","var TO_STRING_TAG_SUPPORT = require('../internals/to-string-tag-support');\nvar redefine = require('../internals/redefine');\nvar toString = require('../internals/object-to-string');\n\n// `Object.prototype.toString` method\n// https://tc39.github.io/ecma262/#sec-object.prototype.tostring\nif (!TO_STRING_TAG_SUPPORT) {\n  redefine(Object.prototype, 'toString', toString, { unsafe: true });\n}\n","'use strict';\nvar TO_STRING_TAG_SUPPORT = require('../internals/to-string-tag-support');\nvar classof = require('../internals/classof');\n\n// `Object.prototype.toString` method implementation\n// https://tc39.github.io/ecma262/#sec-object.prototype.tostring\nmodule.exports = TO_STRING_TAG_SUPPORT ? {}.toString : function toString() {\n  return '[object ' + classof(this) + ']';\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar DESCRIPTORS = require('../internals/descriptors');\nvar FORCED = require('../internals/object-prototype-accessors-forced');\nvar toObject = require('../internals/to-object');\nvar aFunction = require('../internals/a-function');\nvar definePropertyModule = require('../internals/object-define-property');\n\n// `Object.prototype.__defineGetter__` method\n// https://tc39.github.io/ecma262/#sec-object.prototype.__defineGetter__\nif (DESCRIPTORS) {\n  $({ target: 'Object', proto: true, forced: FORCED }, {\n    __defineGetter__: function __defineGetter__(P, getter) {\n      definePropertyModule.f(toObject(this), P, { get: aFunction(getter), enumerable: true, configurable: true });\n    }\n  });\n}\n","'use strict';\nvar $ = require('../internals/export');\nvar DESCRIPTORS = require('../internals/descriptors');\nvar FORCED = require('../internals/object-prototype-accessors-forced');\nvar toObject = require('../internals/to-object');\nvar aFunction = require('../internals/a-function');\nvar definePropertyModule = require('../internals/object-define-property');\n\n// `Object.prototype.__defineSetter__` method\n// https://tc39.github.io/ecma262/#sec-object.prototype.__defineSetter__\nif (DESCRIPTORS) {\n  $({ target: 'Object', proto: true, forced: FORCED }, {\n    __defineSetter__: function __defineSetter__(P, setter) {\n      definePropertyModule.f(toObject(this), P, { set: aFunction(setter), enumerable: true, configurable: true });\n    }\n  });\n}\n","'use strict';\nvar $ = require('../internals/export');\nvar DESCRIPTORS = require('../internals/descriptors');\nvar FORCED = require('../internals/object-prototype-accessors-forced');\nvar toObject = require('../internals/to-object');\nvar toPrimitive = require('../internals/to-primitive');\nvar getPrototypeOf = require('../internals/object-get-prototype-of');\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\n\n// `Object.prototype.__lookupGetter__` method\n// https://tc39.github.io/ecma262/#sec-object.prototype.__lookupGetter__\nif (DESCRIPTORS) {\n  $({ target: 'Object', proto: true, forced: FORCED }, {\n    __lookupGetter__: function __lookupGetter__(P) {\n      var O = toObject(this);\n      var key = toPrimitive(P, true);\n      var desc;\n      do {\n        if (desc = getOwnPropertyDescriptor(O, key)) return desc.get;\n      } while (O = getPrototypeOf(O));\n    }\n  });\n}\n","'use strict';\nvar $ = require('../internals/export');\nvar DESCRIPTORS = require('../internals/descriptors');\nvar FORCED = require('../internals/object-prototype-accessors-forced');\nvar toObject = require('../internals/to-object');\nvar toPrimitive = require('../internals/to-primitive');\nvar getPrototypeOf = require('../internals/object-get-prototype-of');\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\n\n// `Object.prototype.__lookupSetter__` method\n// https://tc39.github.io/ecma262/#sec-object.prototype.__lookupSetter__\nif (DESCRIPTORS) {\n  $({ target: 'Object', proto: true, forced: FORCED }, {\n    __lookupSetter__: function __lookupSetter__(P) {\n      var O = toObject(this);\n      var key = toPrimitive(P, true);\n      var desc;\n      do {\n        if (desc = getOwnPropertyDescriptor(O, key)) return desc.set;\n      } while (O = getPrototypeOf(O));\n    }\n  });\n}\n","var global = require('../internals/global');\nvar setToStringTag = require('../internals/set-to-string-tag');\n\n// JSON[@@toStringTag] property\n// https://tc39.github.io/ecma262/#sec-json-@@tostringtag\nsetToStringTag(global.JSON, 'JSON', true);\n","var setToStringTag = require('../internals/set-to-string-tag');\n\n// Math[@@toStringTag] property\n// https://tc39.github.io/ecma262/#sec-math-@@tostringtag\nsetToStringTag(Math, 'Math', true);\n","var $ = require('../internals/export');\nvar global = require('../internals/global');\nvar setToStringTag = require('../internals/set-to-string-tag');\n\n$({ global: true }, { Reflect: {} });\n\n// Reflect[@@toStringTag] property\n// https://tc39.es/ecma262/#sec-reflect-@@tostringtag\nsetToStringTag(global.Reflect, 'Reflect', true);\n","require('../../modules/es.function.bind');\nrequire('../../modules/es.function.name');\nrequire('../../modules/es.function.has-instance');\nvar path = require('../../internals/path');\n\nmodule.exports = path.Function;\n","var $ = require('../internals/export');\nvar bind = require('../internals/function-bind');\n\n// `Function.prototype.bind` method\n// https://tc39.github.io/ecma262/#sec-function.prototype.bind\n$({ target: 'Function', proto: true }, {\n  bind: bind\n});\n","'use strict';\nvar aFunction = require('../internals/a-function');\nvar isObject = require('../internals/is-object');\n\nvar slice = [].slice;\nvar factories = {};\n\nvar construct = function (C, argsLength, args) {\n  if (!(argsLength in factories)) {\n    for (var list = [], i = 0; i < argsLength; i++) list[i] = 'a[' + i + ']';\n    // eslint-disable-next-line no-new-func\n    factories[argsLength] = Function('C,a', 'return new C(' + list.join(',') + ')');\n  } return factories[argsLength](C, args);\n};\n\n// `Function.prototype.bind` method implementation\n// https://tc39.github.io/ecma262/#sec-function.prototype.bind\nmodule.exports = Function.bind || function bind(that /* , ...args */) {\n  var fn = aFunction(this);\n  var partArgs = slice.call(arguments, 1);\n  var boundFunction = function bound(/* args... */) {\n    var args = partArgs.concat(slice.call(arguments));\n    return this instanceof boundFunction ? construct(fn, args.length, args) : fn.apply(that, args);\n  };\n  if (isObject(fn.prototype)) boundFunction.prototype = fn.prototype;\n  return boundFunction;\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar defineProperty = require('../internals/object-define-property').f;\n\nvar FunctionPrototype = Function.prototype;\nvar FunctionPrototypeToString = FunctionPrototype.toString;\nvar nameRE = /^\\s*function ([^ (]*)/;\nvar NAME = 'name';\n\n// Function instances `.name` property\n// https://tc39.github.io/ecma262/#sec-function-instances-name\nif (DESCRIPTORS && !(NAME in FunctionPrototype)) {\n  defineProperty(FunctionPrototype, NAME, {\n    configurable: true,\n    get: function () {\n      try {\n        return FunctionPrototypeToString.call(this).match(nameRE)[1];\n      } catch (error) {\n        return '';\n      }\n    }\n  });\n}\n","'use strict';\nvar isObject = require('../internals/is-object');\nvar definePropertyModule = require('../internals/object-define-property');\nvar getPrototypeOf = require('../internals/object-get-prototype-of');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar HAS_INSTANCE = wellKnownSymbol('hasInstance');\nvar FunctionPrototype = Function.prototype;\n\n// `Function.prototype[@@hasInstance]` method\n// https://tc39.github.io/ecma262/#sec-function.prototype-@@hasinstance\nif (!(HAS_INSTANCE in FunctionPrototype)) {\n  definePropertyModule.f(FunctionPrototype, HAS_INSTANCE, { value: function (O) {\n    if (typeof this != 'function' || !isObject(O)) return false;\n    if (!isObject(this.prototype)) return O instanceof this;\n    // for environment w/o native `@@hasInstance` logic enough `instanceof`, but add this:\n    while (O = getPrototypeOf(O)) if (this.prototype === O) return true;\n    return false;\n  } });\n}\n","import 'core-js/es/array';\nimport 'core-js/es/object';\nimport 'core-js/es/function';\n\n/**\n * Polyfill adding function\n */\nexport function polyfill() {\n  /* istanbul ignore next */\n  if (typeof window === 'undefined') {\n    window = <any>{\n      audioContext: function () {\n        return;\n      }\n    };\n  }\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !window.requestAnimationFrame) {\n    (<any>window).requestAnimationFrame =\n      (<any>window).webkitRequestAnimationFrame ||\n      (<any>window).mozRequestAnimationFrame ||\n      function (callback: Function) {\n        window.setInterval(callback, 1000 / 60);\n      };\n  }\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !window.cancelAnimationFrame) {\n    (<any>window).cancelAnimationFrame =\n      (<any>window).webkitCancelAnimationFrame ||\n      (<any>window).mozCancelAnimationFrame ||\n      function () {\n        return;\n      };\n  }\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !(<any>window).AudioContext) {\n    (<any>window).AudioContext =\n      (<any>window).AudioContext ||\n      (<any>window).webkitAudioContext ||\n      (<any>window).mozAudioContext ||\n      (<any>window).msAudioContext ||\n      (<any>window).oAudioContext;\n  }\n\n  /* istanbul ignore next */\n  if (typeof window !== 'undefined' && !(<any>window).devicePixelRatio) {\n    (<any>window).devicePixelRatio = window.devicePixelRatio || 1;\n  }\n}\n","/**\n * Flags is a feature flag implementation for Excalibur. They can only be operated **before [[Engine]] construction**\n * after which they are frozen and are read-only.\n *\n * Flags are used to enable experimental or preview features in Excalibur.\n */\nexport class Flags {\n  private static _FROZEN = false;\n  private static _FLAGS: Record<string, boolean> = {};\n\n  /**\n   * Freeze all flag modifications making them readonly\n   */\n  public static freeze() {\n    Flags._FROZEN = true;\n  }\n\n  /**\n   * Resets internal flag state, not meant to be called by users. Only used for testing.\n   *\n   * Calling this in your game is UNSUPPORTED\n   * @internal\n   */\n  public static _reset() {\n    Flags._FROZEN = false;\n    Flags._FLAGS = {};\n  }\n\n  /**\n   * Enable a specific feature flag by name. **Note: can only be set before [[Engine]] constructor time**\n   * @param flagName\n   */\n  public static enable(flagName: string): void {\n    if (this._FROZEN) {\n      throw Error('Feature flags can only be enabled before Engine constructor time');\n    }\n    Flags._FLAGS[flagName] = true;\n  }\n\n  /**\n   * Disable a specific feature flag by name. **Note: can only be set before [[Engine]] constructor time**\n   * @param flagName\n   */\n  public static disable(flagName: string): void {\n    if (this._FROZEN) {\n      throw Error('Feature flags can only be disabled before Engine constructor time');\n    }\n    Flags._FLAGS[flagName] = false;\n  }\n\n  /**\n   * Check if a flag is enabled. If the flag is disabled or does not exist `false` is returned\n   * @param flagName\n   */\n  public static isEnabled(flagName: string): boolean {\n    return !!Flags._FLAGS[flagName];\n  }\n\n  /**\n   * Show a list of currently known flags\n   */\n  public static show(): string[] {\n    return Object.keys(Flags._FLAGS);\n  }\n}\n","/**\n * Pseudo-Random Utility\n *\n * A pseudo-random utility to add seeded random support for help in\n * generating things like terrain or reproducible randomness. Uses the\n * [Mersenne Twister](https://en.wikipedia.org/wiki/Mersenne_Twister) algorithm.\n */\n\n/**\n * 32-bit mask\n */\nconst BITMASK32: number = 0xffffffff;\n\n/**\n * Pseudo-random number generator following the Mersenne_Twister algorithm. Given a seed this generator will produce the same sequence\n * of numbers each time it is called.\n * See https://en.wikipedia.org/wiki/Mersenne_Twister for more details.\n * Uses the MT19937-32 (2002) implementation documented here http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/MT2002/emt19937ar.html\n *\n * Api inspired by http://chancejs.com/# https://github.com/chancejs/chancejs\n */\nexport class Random {\n  // Separation point of one one word, the number of bits in the lower bitmask 0 <= r <= w-1\n  private _lowerMask: number = 0x7fffffff; // 31 bits same as _r\n  private _upperMask: number = 0x80000000; // 34 high bits\n\n  // Word size, 64 bits\n  private _w: number = 32;\n\n  // Degree of recurrence\n  private _n: number = 624;\n\n  // Middle word, an offset used in the recurrence defining the series x, 1<=m<n\n  private _m: number = 397;\n  // coefficients of teh rational normal form twist matrix\n  private _a: number = 0x9908b0df;\n\n  // tempering bit shifts and masks\n  private _u: number = 11;\n  private _s: number = 7;\n  private _b: number = 0x9d2c5680;\n  private _t: number = 15;\n  private _c: number = 0xefc60000;\n  private _l: number = 18;\n  private _f: number = 1812433253;\n\n  private _mt: number[];\n\n  private _index: number;\n\n  /**\n   * If no seed is specified, the Date.now() is used\n   */\n  constructor(public seed?: number) {\n    this._mt = new Array<number>(this._n);\n    // need to mask to support higher bit machines\n    this._mt[0] = (seed || Date.now()) >>> 0;\n\n    for (let i = 1; i < this._n; i++) {\n      const s = this._mt[i - 1] ^ (this._mt[i - 1] >>> (this._w - 2));\n      // numbers are bigger than the JS max safe int, add in 16-bit chunks to prevent IEEE rounding errors on high bits\n      this._mt[i] = (((this._f * ((s & 0xffff0000) >>> 16)) << 16) + this._f * (s & 0xffff) + i) >>> 0;\n    }\n    this._index = this._n;\n  }\n\n  /**\n   * Apply the twist\n   */\n  private _twist(): void {\n    const mag01 = [0x0, this._a];\n    let y = 0,\n      i = 0;\n    for (; i < this._n - this._m; i++) {\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\n      this._mt[i] = this._mt[i + this._m] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n    }\n    for (; i < this._n - 1; i++) {\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\n      this._mt[i] = this._mt[i + (this._m - this._n)] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n    }\n    y = (this._mt[this._n - 1] & this._upperMask) | (this._mt[0] & this._lowerMask);\n    this._mt[this._n - 1] = this._mt[this._m - 1] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\n\n    this._index = 0;\n  }\n\n  /**\n   * Return next 32 bit integer number in sequence\n   */\n  public nextInt(): number {\n    if (this._index >= this._n) {\n      this._twist();\n    }\n\n    let y = this._mt[this._index++];\n\n    y ^= y >>> this._u;\n    y ^= (y << this._s) & this._b;\n    y ^= (y << this._t) & this._c;\n    y ^= y >>> this._l;\n\n    return y >>> 0;\n  }\n\n  /**\n   * Return a random floating point number between [0, 1)\n   */\n  public next(): number {\n    return this.nextInt() * (1.0 / 4294967296.0); // divided by 2^32\n  }\n\n  /**\n   * Return a random floating point in range [min, max) min is included, max is not included\n   */\n  public floating(min: number, max: number): number {\n    return (max - min) * this.next() + min;\n  }\n\n  /**\n   * Return a random integer in range [min, max] min is included, max is included.\n   * Implemented with rejection sampling, see https://medium.com/@betable/tifu-by-using-math-random-f1c308c4fd9d#.i13tdiu5a\n   */\n  public integer(min: number, max: number): number {\n    return Math.floor((max - min + 1) * this.next() + min);\n  }\n\n  /**\n   * Returns true or false randomly with 50/50 odds by default.\n   * By default the likelihood of returning a true is .5 (50%).\n   * @param likelihood takes values between [0, 1]\n   */\n  public bool(likelihood: number = 0.5): boolean {\n    return this.next() <= likelihood;\n  }\n\n  /**\n   * Returns one element from an array at random\n   */\n  public pickOne<T>(array: Array<T>): T {\n    return array[this.integer(0, array.length - 1)];\n  }\n\n  /**\n   * Returns a new array random picking elements from the original\n   * @param array Original array to pick from\n   * @param numPicks can be any positive number\n   * @param allowDuplicates indicates whether the returned set is allowed duplicates (it does not mean there will always be duplicates\n   * just that it is possible)\n   */\n  public pickSet<T>(array: Array<T>, numPicks: number, allowDuplicates: boolean = false): Array<T> {\n    if (allowDuplicates) {\n      return this._pickSetWithDuplicates(array, numPicks);\n    } else {\n      return this._pickSetWithoutDuplicates(array, numPicks);\n    }\n  }\n\n  /**\n   * Returns a new array randomly picking elements in the original (not reused)\n   * @param array Array to pick elements out of\n   * @param numPicks must be less than or equal to the number of elements in the array.\n   */\n  private _pickSetWithoutDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\n    if (numPicks > array.length || numPicks < 0) {\n      throw new Error('Invalid number of elements to pick, must pick a value 0 < n <= length');\n    }\n    if (numPicks === array.length) {\n      return array;\n    }\n\n    const result: Array<T> = new Array<T>(numPicks);\n    let currentPick = 0;\n    const tempArray = array.slice(0);\n    while (currentPick < numPicks) {\n      const index = this.integer(0, tempArray.length - 1);\n      result[currentPick++] = tempArray[index];\n      tempArray.splice(index, 1);\n    }\n\n    return result;\n  }\n\n  /**\n   * Returns a new array random picking elements from the original allowing duplicates\n   * @param array Array to pick elements out of\n   * @param numPicks can be any positive number\n   */\n  private _pickSetWithDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\n    // Typescript numbers are all floating point, so do we add check for int? (or floor the input?)\n    if (numPicks < 0) {\n      throw new Error('Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT');\n    }\n    const result = new Array<T>(numPicks);\n    for (let i = 0; i < numPicks; i++) {\n      result[i] = this.pickOne(array);\n    }\n    return result;\n  }\n\n  /**\n   * Returns a new array that has its elements shuffled. Using the Fisher/Yates method\n   * https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\n   */\n  public shuffle<T>(array: Array<T>): Array<T> {\n    const tempArray = array.slice(0);\n    let swap: T = null;\n    for (let i = 0; i < tempArray.length - 2; i++) {\n      const randomIndex = this.integer(i, tempArray.length - 1);\n      swap = tempArray[i];\n      tempArray[i] = tempArray[randomIndex];\n      tempArray[randomIndex] = swap;\n    }\n\n    return tempArray;\n  }\n\n  /**\n   * Generate a list of random integer numbers\n   * @param length the length of the final array\n   * @param min the minimum integer number to generate inclusive\n   * @param max the maximum integer number to generate inclusive\n   */\n  public range(length: number, min: number, max: number): Array<number> {\n    const result: Array<number> = new Array(length);\n    for (let i = 0; i < length; i++) {\n      result[i] = this.integer(min, max);\n    }\n    return result;\n  }\n\n  /**\n   * Returns the result of a d4 dice roll\n   */\n  public d4() {\n    return this.integer(1, 4);\n  }\n\n  /**\n   * Returns the result of a d6 dice roll\n   */\n  public d6() {\n    return this.integer(1, 6);\n  }\n\n  /**\n   * Returns the result of a d8 dice roll\n   */\n  public d8() {\n    return this.integer(1, 8);\n  }\n\n  /**\n   * Returns the result of a d10 dice roll\n   */\n  public d10() {\n    return this.integer(1, 10);\n  }\n\n  /**\n   * Returns the result of a d12 dice roll\n   */\n  public d12() {\n    return this.integer(1, 12);\n  }\n\n  /**\n   * Returns the result of a d20 dice roll\n   */\n  public d20() {\n    return this.integer(1, 20);\n  }\n}\n","/**\n * An enum that describes the sides of an Actor for collision\n */\nexport enum Side {\n  None = 'None',\n  Top = 'Top',\n  Bottom = 'Bottom',\n  Left = 'Left',\n  Right = 'Right'\n}\n","import { Vector } from '../Algebra';\nimport { Random } from '../Math/Random';\nimport { Side } from '../Collision/Side';\n\n/**\n * Two PI constant\n */\nexport const TwoPI: number = Math.PI * 2;\n\n/**\n * Merges one or more objects into a single target object\n *\n * @param deep Whether or not to do a deep clone\n * @param target The target object to attach properties on\n * @param objects The objects whose properties to merge\n * @returns Merged object with properties from other objects\n */\nexport function extend(deep: boolean, target: any, ...objects: any[]): any;\n\n/**\n * Merges one or more objects into a single target object\n *\n * @param target The target object to attach properties on\n * @param object2 The second object whose properties to merge\n * @returns Merged object with properties from other objects\n */\nexport function extend<T1, T2>(target: T1, object2: T2): T1 & T2;\n\n/**\n * Merges one or more objects into a single target object\n *\n * @param target The target object to attach properties on\n * @param object2 The second object whose properties to merge\n * @param object3 The third object whose properties to merge\n * @returns Merged object with properties from other objects\n */\nexport function extend<T1, T2, T3>(target: T1, object2: T2, object3: T3): T1 & T2 & T3;\n\n/**\n * Merges one or more objects into a single target object\n *\n * @param target The target object to attach properties on\n * @param objects The objects whose properties to merge\n * @returns Merged object with properties from other objects\n */\nexport function extend(target: any, ...objects: any[]): any;\n\n/**\n * Merges one or more objects into a single target object\n *\n * @returns Merged object with properties from other objects\n * @credit https://gomakethings.com/vanilla-javascript-version-of-jquery-extend/\n */\nexport function extend() {\n  const extended: { [key: string]: any } = {};\n  let deep = false;\n  let i = 0;\n  const length = arguments.length;\n\n  // Check if a deep merge\n  if (Object.prototype.toString.call(arguments[0]) === '[object Boolean]') {\n    deep = arguments[0];\n    i++;\n  }\n\n  // Merge the object into the extended object\n  const assignExists = typeof (<any>Object).assign === 'function';\n  let merge = null;\n  if (!assignExists) {\n    merge = function (obj: any) {\n      for (const prop in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, prop)) {\n          // If deep merge and property is an object, merge properties\n          if (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') {\n            extended[prop] = extend(true, extended[prop], obj[prop]);\n          } else {\n            extended[prop] = obj[prop];\n          }\n        }\n      }\n    };\n  } else {\n    merge = (<any>Object).assign;\n  }\n\n  // Loop through each object and conduct a merge\n  for (; i < length; i++) {\n    const obj = arguments[i];\n    if (!assignExists) {\n      merge(obj);\n    } else {\n      merge(extended, obj);\n    }\n  }\n\n  return extended;\n}\n\n/**\n * Encode a string in base64\n * @deprecated This method is marked for removal\n */\nexport function base64Encode(inputStr: string) {\n  const b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n  let outputStr = '';\n  let i = 0;\n\n  while (i < inputStr.length) {\n    //all three \"& 0xff\" added below are there to fix a known bug\n    //with bytes returned by xhr.responseText\n    const byte1 = inputStr.charCodeAt(i++) & 0xff;\n    const byte2 = inputStr.charCodeAt(i++) & 0xff;\n    const byte3 = inputStr.charCodeAt(i++) & 0xff;\n\n    const enc1 = byte1 >> 2;\n    const enc2 = ((byte1 & 3) << 4) | (byte2 >> 4);\n\n    let enc3, enc4;\n    if (isNaN(byte2)) {\n      enc3 = enc4 = 64;\n    } else {\n      enc3 = ((byte2 & 15) << 2) | (byte3 >> 6);\n      if (isNaN(byte3)) {\n        enc4 = 64;\n      } else {\n        enc4 = byte3 & 63;\n      }\n    }\n\n    outputStr += b64.charAt(enc1) + b64.charAt(enc2) + b64.charAt(enc3) + b64.charAt(enc4);\n  }\n\n  return outputStr;\n}\n\n/**\n * Sugar that will use `nullishVal` if it's not null or undefined. Simulates the `??` operator\n * @param nullishVal\n * @param defaultVal\n */\nexport function nullish<T>(nullishVal: T | undefined | null, defaultVal: T): T {\n  return nullishVal !== null && nullishVal !== undefined ? nullishVal : defaultVal;\n}\n\n/**\n * Clamps a value between a min and max inclusive\n */\nexport function clamp(val: number, min: number, max: number) {\n  return Math.min(Math.max(min, val), max);\n}\n\n/**\n * Find a random floating point number in range\n */\nexport function randomInRange(min: number, max: number, random: Random = new Random()): number {\n  return random ? random.floating(min, max) : min + Math.random() * (max - min);\n}\n\n/**\n * Find a random integer in a range\n */\nexport function randomIntInRange(min: number, max: number, random: Random = new Random()): number {\n  return random ? random.integer(min, max) : Math.round(randomInRange(min, max));\n}\n\n/**\n * Convert an angle to be the equivalent in the range [0, 2PI]\n */\nexport function canonicalizeAngle(angle: number): number {\n  let tmpAngle = angle;\n  if (angle > TwoPI) {\n    while (tmpAngle > TwoPI) {\n      tmpAngle -= TwoPI;\n    }\n  }\n\n  if (angle < 0) {\n    while (tmpAngle < 0) {\n      tmpAngle += TwoPI;\n    }\n  }\n  return tmpAngle;\n}\n\n/**\n * Convert radians to degrees\n */\nexport function toDegrees(radians: number): number {\n  return (180 / Math.PI) * radians;\n}\n\n/**\n * Convert degrees to radians\n */\nexport function toRadians(degrees: number): number {\n  return (degrees / 180) * Math.PI;\n}\n\n/**\n * Find the screen position of an HTML element\n */\nexport function getPosition(el: HTMLElement): Vector {\n  let oLeft: number = 0,\n    oTop: number = 0;\n\n  const calcOffsetLeft = (parent: HTMLElement) => {\n    oLeft += parent.offsetLeft;\n\n    if (parent.offsetParent) {\n      calcOffsetLeft(<HTMLElement>parent.offsetParent);\n    }\n  };\n  const calcOffsetTop = (parent: HTMLElement) => {\n    oTop += parent.offsetTop;\n    if (parent.offsetParent) {\n      calcOffsetTop(<HTMLElement>parent.offsetParent);\n    }\n  };\n\n  calcOffsetLeft(el);\n  calcOffsetTop(el);\n\n  return new Vector(oLeft, oTop);\n}\n\n/**\n * Add an item to an array list if it doesn't already exist. Returns true if added, false if not and already exists in the array.\n * @deprecated\n */\nexport function addItemToArray<T>(item: T, array: T[]): boolean {\n  if (array.indexOf(item) === -1) {\n    array.push(item);\n    return true;\n  }\n  return false;\n}\n\n/**\n * Remove an item from an list\n */\nexport function removeItemFromArray<T>(item: T, array: T[]): boolean {\n  let index = -1;\n  if ((index = array.indexOf(item)) > -1) {\n    array.splice(index, 1);\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * See if an array contains something\n */\nexport function contains(array: Array<any>, obj: any): boolean {\n  for (let i = 0; i < array.length; i++) {\n    if (array[i] === obj) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Get the opposit side\n * TODO: Move to Side type\n * @deprecated\n */\nexport function getOppositeSide(side: Side) {\n  if (side === Side.Top) {\n    return Side.Bottom;\n  }\n  if (side === Side.Bottom) {\n    return Side.Top;\n  }\n  if (side === Side.Left) {\n    return Side.Right;\n  }\n  if (side === Side.Right) {\n    return Side.Left;\n  }\n\n  return Side.None;\n}\n\n/**\n * Returns the side in the direction of the vector supplied\n * @param direction Vector to check\n * TODO: Move to Side type\n */\nexport function getSideFromDirection(direction: Vector) {\n  const directions = [Vector.Left, Vector.Right, Vector.Up, Vector.Down];\n  const directionEnum = [Side.Left, Side.Right, Side.Top, Side.Bottom];\n\n  let max = -Number.MAX_VALUE;\n  let maxIndex = -1;\n  for (let i = 0; i < directions.length; i++) {\n    if (directions[i].dot(direction) > max) {\n      max = directions[i].dot(direction);\n      maxIndex = i;\n    }\n  }\n  return directionEnum[maxIndex];\n}\n\n/**\n * Excalibur's dynamically resizing collection\n * @deprecated Will be removed in future releases\n */\nexport class Collection<T> {\n  /**\n   * Default collection size\n   */\n  public static DefaultSize = 200;\n  private _internalArray: T[] = null;\n  private _endPointer: number = 0;\n\n  /**\n   * @param initialSize  Initial size of the internal backing array\n   */\n  constructor(initialSize: number = Collection.DefaultSize) {\n    this._internalArray = new Array<T>(initialSize);\n  }\n\n  private _resize() {\n    const newSize = this._internalArray.length * 2;\n    const newArray = new Array<T>(newSize);\n    const count = this.count();\n    for (let i = 0; i < count; i++) {\n      newArray[i] = this._internalArray[i];\n    }\n\n    delete this._internalArray;\n    this._internalArray = newArray;\n  }\n\n  /**\n   * Push elements to the end of the collection\n   */\n  public push(element: T): T {\n    if (this._endPointer === this._internalArray.length) {\n      this._resize();\n    }\n    return (this._internalArray[this._endPointer++] = element);\n  }\n\n  /**\n   * Removes elements from the end of the collection\n   */\n  public pop(): T {\n    this._endPointer = this._endPointer - 1 < 0 ? 0 : this._endPointer - 1;\n    return this._internalArray[this._endPointer];\n  }\n\n  /**\n   * Returns the count of the collection\n   */\n  public count(): number {\n    return this._endPointer;\n  }\n\n  /**\n   * Empties the collection\n   */\n  public clear() {\n    this._endPointer = 0;\n  }\n\n  /**\n   * Returns the size of the internal backing array\n   */\n  public internalSize(): number {\n    return this._internalArray.length;\n  }\n\n  /**\n   * Returns an element at a specific index\n   * @param index  Index of element to retrieve\n   */\n  public elementAt(index: number): T {\n    if (index >= this.count()) {\n      //Logger.getInstance().error('Invalid parameter: ' + index);\n      throw new Error('Invalid index ' + index);\n    }\n    return this._internalArray[index];\n  }\n\n  /**\n   * Inserts an element at a specific index\n   * @param index  Index to insert the element\n   * @param value  Element to insert\n   */\n  public insert(index: number, value: T): T {\n    if (index >= this.count()) {\n      this._resize();\n    }\n    return (this._internalArray[index] = value);\n  }\n\n  /**\n   * Removes an element at a specific index\n   * @param index  Index of element to remove\n   */\n  public remove(index: number): T {\n    const count = this.count();\n    if (count === 0) {\n      //Logger.getInstance().error('Invalid parameter: ' + index);\n      throw new Error('Invalid parameter ' + index);\n    }\n    // O(n) Shift\n    const removed = this._internalArray[index];\n    for (let i = index; i < count; i++) {\n      this._internalArray[i] = this._internalArray[i + 1];\n    }\n    this._endPointer--;\n    return removed;\n  }\n\n  /**\n   * Removes an element by reference\n   * @param element  Element to retrieve\n   */\n  public removeElement(element: T) {\n    const index = this._internalArray.indexOf(element);\n    this.remove(index);\n  }\n\n  /**\n   * Returns a array representing the collection\n   */\n  public toArray(): T[] {\n    return this._internalArray.slice(0, this._endPointer);\n  }\n\n  /**\n   * Iterate over every element in the collection\n   * @param func  Callback to call for each element passing a reference to the element and its index, returned values are ignored\n   */\n  public forEach(func: (element: T, index: number) => any) {\n    let i = 0;\n    const count = this.count();\n    for (i; i < count; i++) {\n      func.call(this, this._internalArray[i], i);\n    }\n  }\n\n  /**\n   * Mutate every element in the collection\n   * @param func  Callback to call for each element passing a reference to the element and its index, any values returned mutate\n   * the collection\n   */\n  public map(func: (element: T, index: number) => any) {\n    const count = this.count();\n    for (let i = 0; i < count; i++) {\n      this._internalArray[i] = func.call(this, this._internalArray[i], i);\n    }\n  }\n}\n\n/**\n * Used for exhaustive checks at compile time\n */\nexport function fail(message: never): never {\n  throw new Error(message);\n}\n","/* eslint-disable no-console */\n/**\n * Logging level that Excalibur will tag\n */\nexport enum LogLevel {\n  Debug,\n  Info,\n  Warn,\n  Error,\n  Fatal\n}\n\n/**\n * Static singleton that represents the logging facility for Excalibur.\n * Excalibur comes built-in with a [[ConsoleAppender]] and [[ScreenAppender]].\n * Derive from [[Appender]] to create your own logging appenders.\n */\nexport class Logger {\n  private static _INSTANCE: Logger = null;\n  private _appenders: Appender[] = [];\n\n  constructor() {\n    if (Logger._INSTANCE) {\n      throw new Error('Logger is a singleton');\n    }\n    Logger._INSTANCE = this;\n    // Default console appender\n    Logger._INSTANCE.addAppender(new ConsoleAppender());\n    return Logger._INSTANCE;\n  }\n\n  /**\n   * Gets or sets the default logging level. Excalibur will only log\n   * messages if equal to or above this level. Default: [[LogLevel.Info]]\n   */\n  public defaultLevel: LogLevel = LogLevel.Info;\n\n  /**\n   * Gets the current static instance of Logger\n   */\n  public static getInstance(): Logger {\n    if (Logger._INSTANCE == null) {\n      Logger._INSTANCE = new Logger();\n    }\n    return Logger._INSTANCE;\n  }\n\n  /**\n   * Adds a new [[Appender]] to the list of appenders to write to\n   */\n  public addAppender(appender: Appender): void {\n    this._appenders.push(appender);\n  }\n\n  /**\n   * Clears all appenders from the logger\n   */\n  public clearAppenders(): void {\n    this._appenders.length = 0;\n  }\n\n  /**\n   * Logs a message at a given LogLevel\n   * @param level  The LogLevel`to log the message at\n   * @param args   An array of arguments to write to an appender\n   */\n  private _log(level: LogLevel, args: any[]): void {\n    if (level == null) {\n      level = this.defaultLevel;\n    }\n\n    const len = this._appenders.length;\n\n    for (let i = 0; i < len; i++) {\n      if (level >= this.defaultLevel) {\n        this._appenders[i].log(level, args);\n      }\n    }\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Debug]] level\n   * @param args  Accepts any number of arguments\n   */\n  public debug(...args: any[]): void {\n    this._log(LogLevel.Debug, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Info]] level\n   * @param args  Accepts any number of arguments\n   */\n  public info(...args: any[]): void {\n    this._log(LogLevel.Info, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Warn]] level\n   * @param args  Accepts any number of arguments\n   */\n  public warn(...args: any[]): void {\n    this._log(LogLevel.Warn, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Error]] level\n   * @param args  Accepts any number of arguments\n   */\n  public error(...args: any[]): void {\n    this._log(LogLevel.Error, args);\n  }\n\n  /**\n   * Writes a log message at the [[LogLevel.Fatal]] level\n   * @param args  Accepts any number of arguments\n   */\n  public fatal(...args: any[]): void {\n    this._log(LogLevel.Fatal, args);\n  }\n}\n\n/**\n * Contract for any log appender (such as console/screen)\n */\nexport interface Appender {\n  /**\n   * Logs a message at the given [[LogLevel]]\n   * @param level  Level to log at\n   * @param args   Arguments to log\n   */\n  log(level: LogLevel, args: any[]): void;\n}\n\n/**\n * Console appender for browsers (i.e. `console.log`)\n */\nexport class ConsoleAppender implements Appender {\n  /**\n   * Logs a message at the given [[LogLevel]]\n   * @param level  Level to log at\n   * @param args   Arguments to log\n   */\n  public log(level: LogLevel, args: any[]): void {\n    // Check for console support\n    if (!console && !console.log && console.warn && console.error) {\n      // todo maybe do something better than nothing\n      return;\n    }\n\n    // Create a new console args array\n    const consoleArgs: any[] = [];\n    consoleArgs.unshift.apply(consoleArgs, args);\n    consoleArgs.unshift('[' + LogLevel[level] + '] : ');\n\n    if (level < LogLevel.Warn) {\n      // Call .log for Debug/Info\n      if (console.log.apply) {\n        // this is required on some older browsers that don't support apply on console.log :(\n        console.log.apply(console, consoleArgs);\n      } else {\n        console.log(consoleArgs.join(' '));\n      }\n    } else if (level < LogLevel.Error) {\n      // Call .warn for Warn\n      if (console.warn.apply) {\n        console.warn.apply(console, consoleArgs);\n      } else {\n        console.warn(consoleArgs.join(' '));\n      }\n    } else {\n      // Call .error for Error/Fatal\n      if (console.error.apply) {\n        console.error.apply(console, consoleArgs);\n      } else {\n        console.error(consoleArgs.join(' '));\n      }\n    }\n  }\n}\n\n/**\n * On-screen (canvas) appender\n */\nexport class ScreenAppender implements Appender {\n  // @todo Clean this up\n\n  private _messages: string[] = [];\n  private _canvas: HTMLCanvasElement;\n  private _ctx: CanvasRenderingContext2D;\n\n  /**\n   * @param width   Width of the screen appender in pixels\n   * @param height  Height of the screen appender in pixels\n   */\n  constructor(width?: number, height?: number) {\n    this._canvas = <HTMLCanvasElement>document.createElement('canvas');\n    this._canvas.width = width || window.innerWidth;\n    this._canvas.height = height || window.innerHeight;\n    this._canvas.style.position = 'absolute';\n    // eslint-disable-next-line\n    this._ctx = <CanvasRenderingContext2D>this._canvas.getContext('2d'); // eslint-disable-line\n    document.body.appendChild(this._canvas);\n  }\n\n  /**\n   * Logs a message at the given [[LogLevel]]\n   * @param level  Level to log at\n   * @param args   Arguments to log\n   */\n  public log(level: LogLevel, args: any[]): void {\n    const message = args.join(',');\n\n    this._ctx.clearRect(0, 0, this._canvas.width, this._canvas.height);\n\n    this._messages.unshift('[' + LogLevel[level] + '] : ' + message);\n\n    let pos = 10;\n    let opacity = 1.0;\n    for (let i = 0; i < this._messages.length; i++) {\n      this._ctx.fillStyle = 'rgba(255,255,255,' + opacity.toFixed(2) + ')';\n      this._ctx.fillText(this._messages[i], 200, pos);\n      pos += 10;\n      opacity = opacity > 0 ? opacity - 0.05 : 0;\n    }\n  }\n}\n","import { Flags } from '../Flags';\nimport { Logger } from './Log';\nimport { extend } from './Util';\n\n/**\n * Obsolete decorator options\n */\nexport interface ObsoleteOptions {\n  // Optionally specify a custom message\n  message?: string;\n  // Optionally indicate that an alternate method to the obsolete one exists\n  alternateMethod?: string;\n  // Optional show stack trace, by default off\n  showStackTrace?: boolean;\n}\n\nexport const maxMessages = 5;\nconst obsoleteMessage: { [messageCount: string]: number } = {};\nexport const resetObsoleteCounter = () => {\n  for (const message in obsoleteMessage) {\n    obsoleteMessage[message] = 0;\n  }\n};\n\nconst logMessage = (message: string, options: ObsoleteOptions) => {\n  const suppressObsoleteMessages = Flags.isEnabled('suppress-obsolete-message');\n  if (obsoleteMessage[message] < maxMessages && !suppressObsoleteMessages) {\n    Logger.getInstance().warn(message);\n\n    // tslint:disable-next-line: no-console\n    if (console.trace && options.showStackTrace) {\n      // tslint:disable-next-line: no-console\n      console.trace();\n    }\n  }\n  obsoleteMessage[message]++;\n};\n\n/**\n * Obsolete decorator for marking Excalibur methods obsolete, you can optionally specify a custom message and/or alternate replacement\n * method do the deprecated one. Inspired by https://github.com/jayphelps/core-decorators.js\n */\nexport function obsolete(options?: ObsoleteOptions): any {\n  options = extend(\n    {},\n    {\n      message: 'This feature will be removed in future versions of Excalibur.',\n      alternateMethod: null,\n      showStackTrack: false\n    },\n    options\n  );\n\n  return function (target: any, property: string, descriptor: PropertyDescriptor): any {\n    if (\n      descriptor &&\n      !(typeof descriptor.value === 'function' || typeof descriptor.get === 'function' || typeof descriptor.set === 'function')\n    ) {\n      throw new SyntaxError('Only classes/functions/getters/setters can be marked as obsolete');\n    }\n    const methodSignature = `${target.name || ''}${target.name && property ? '.' : ''}${property ? property : ''}`;\n\n    const message =\n      `${methodSignature} is marked obsolete: ${options.message}` +\n      (options.alternateMethod ? ` Use ${options.alternateMethod} instead` : '');\n\n    if (!obsoleteMessage[message]) {\n      obsoleteMessage[message] = 0;\n    }\n\n    // If descriptor is null it is a class\n    const method = descriptor ? { ...descriptor } : target;\n    if (!descriptor) {\n      // with es2015 classes we need to change our decoration tactic\n      class DecoratedClass extends method {\n        constructor(...args: any) {\n          logMessage(message, options);\n          super(...args);\n        }\n      }\n      return DecoratedClass;\n    }\n\n    if (descriptor && descriptor.value) {\n      method.value = function (this: any) {\n        logMessage(message, options);\n        return descriptor.value.apply(this, arguments);\n      };\n      return method;\n    }\n\n    if (descriptor && descriptor.get) {\n      method.get = function (this: any) {\n        logMessage(message, options);\n        return descriptor.get.apply(this, arguments);\n      };\n    }\n\n    if (descriptor && descriptor.set) {\n      method.set = function (this: any) {\n        logMessage(message, options);\n        return descriptor.set.apply(this, arguments);\n      };\n    }\n    return method;\n  };\n}\n","import { Engine } from './Engine';\nimport * as Util from './Util/Util';\nimport { Clonable } from './Interfaces/Clonable';\nimport { obsolete } from './Util/Decorators';\n\n/**\n * A 2D vector on a plane.\n */\nexport class Vector implements Clonable<Vector> {\n  /**\n   * A (0, 0) vector\n   */\n  public static get Zero() {\n    return new Vector(0, 0);\n  }\n\n  /**\n   * A (1, 1) vector\n   */\n  public static get One() {\n    return new Vector(1, 1);\n  }\n\n  /**\n   * A (0.5, 0.5) vector\n   */\n  public static get Half() {\n    return new Vector(0.5, 0.5);\n  }\n\n  /**\n   * A unit vector pointing up (0, -1)\n   */\n  public static get Up() {\n    return new Vector(0, -1);\n  }\n\n  /**\n   * A unit vector pointing down (0, 1)\n   */\n  public static get Down() {\n    return new Vector(0, 1);\n  }\n\n  /**\n   * A unit vector pointing left (-1, 0)\n   */\n  public static get Left() {\n    return new Vector(-1, 0);\n  }\n  /**\n   * A unit vector pointing right (1, 0)\n   */\n  public static get Right() {\n    return new Vector(1, 0);\n  }\n\n  /**\n   * Returns a vector of unit length in the direction of the specified angle in Radians.\n   * @param angle The angle to generate the vector\n   */\n  public static fromAngle(angle: number) {\n    return new Vector(Math.cos(angle), Math.sin(angle));\n  }\n\n  /**\n   * Checks if vector is not null, undefined, or if any of its components are NaN or Infinity.\n   */\n  public static isValid(vec: Vector) {\n    if (vec === null || vec === undefined) {\n      return false;\n    }\n    if (isNaN(vec.x) || isNaN(vec.y)) {\n      return false;\n    }\n\n    if (vec.x === Infinity || vec.y === Infinity || vec.x === -Infinity || vec.y === -Infinity) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Calculates distance between two Vectors\n   * @param vec1\n   * @param vec2\n   */\n  public static distance(vec1: Vector, vec2: Vector) {\n    return Math.sqrt(Math.pow(vec1.x - vec2.x, 2) + Math.pow(vec1.y - vec2.y, 2));\n  }\n\n  /**\n   * @param x  X component of the Vector\n   * @param y  Y component of the Vector\n   */\n  constructor(public x: number, public y: number) {}\n\n  /**\n   * Sets the x and y components at once\n   */\n  public setTo(x: number, y: number) {\n    this.x = x;\n    this.y = y;\n  }\n\n  /**\n   * Compares this point against another and tests for equality\n   * @param vector The other point to compare to\n   * @param tolerance Amount of euclidean distance off we are willing to tolerate\n   */\n  public equals(vector: Vector, tolerance: number = 0.001): boolean {\n    return Math.abs(this.x - vector.x) <= tolerance && Math.abs(this.y - vector.y) <= tolerance;\n  }\n\n  /**\n   * The distance to another vector. If no other Vector is specified, this will return the [[magnitude]].\n   * @param v  The other vector. Leave blank to use origin vector.\n   */\n  public distance(v?: Vector): number {\n    if (!v) {\n      v = Vector.Zero;\n    }\n    return Math.sqrt(Math.pow(this.x - v.x, 2) + Math.pow(this.y - v.y, 2));\n  }\n\n  /**\n   * The magnitude (size) of the Vector\n   * @obsolete magnitude will be removed in favour of '.size' in version 0.25.0\n   */\n  @obsolete({ message: 'will be removed in favour of `.size` in version 0.25.0' })\n  public magnitude(): number {\n    return this.distance();\n  }\n\n  /**\n   * The size(magnitude) of the Vector\n   */\n  public get size(): number {\n    return this.distance();\n  }\n\n  public set size(newLength: number) {\n    const v = this.normalize().scale(newLength);\n    this.x = v.x;\n    this.y = v.y;\n  }\n\n  /**\n   * Normalizes a vector to have a magnitude of 1.\n   */\n  public normalize(): Vector {\n    const d = this.distance();\n    if (d > 0) {\n      return new Vector(this.x / d, this.y / d);\n    } else {\n      return new Vector(0, 1);\n    }\n  }\n\n  /**\n   * Returns the average (midpoint) between the current point and the specified\n   */\n  public average(vec: Vector): Vector {\n    return this.add(vec).scale(0.5);\n  }\n\n  /**\n   * Scales a vector's by a factor of size\n   * @param size  The factor to scale the magnitude by\n   */\n  public scale(scale: Vector): Vector;\n  public scale(size: number): Vector;\n  public scale(sizeOrScale: number | Vector): Vector {\n    if (sizeOrScale instanceof Vector) {\n      return new Vector(this.x * sizeOrScale.x, this.y * sizeOrScale.y);\n    } else {\n      return new Vector(this.x * sizeOrScale, this.y * sizeOrScale);\n    }\n  }\n\n  /**\n   * Adds one vector to another\n   * @param v The vector to add\n   */\n  public add(v: Vector): Vector {\n    return new Vector(this.x + v.x, this.y + v.y);\n  }\n\n  /**\n   * Subtracts a vector from another, if you subtract vector `B.sub(A)` the resulting vector points from A -> B\n   * @param v The vector to subtract\n   */\n  public sub(v: Vector): Vector {\n    return new Vector(this.x - v.x, this.y - v.y);\n  }\n\n  /**\n   * Adds one vector to this one modifying the original\n   * @param v The vector to add\n   */\n  public addEqual(v: Vector): Vector {\n    this.x += v.x;\n    this.y += v.y;\n    return this;\n  }\n\n  /**\n   * Subtracts a vector from this one modifying the original\n   * @param v The vector to subtract\n   */\n  public subEqual(v: Vector): Vector {\n    this.x -= v.x;\n    this.y -= v.y;\n    return this;\n  }\n\n  /**\n   * Scales this vector by a factor of size and modifies the original\n   */\n  public scaleEqual(size: number): Vector {\n    this.x *= size;\n    this.y *= size;\n    return this;\n  }\n\n  /**\n   * Performs a dot product with another vector\n   * @param v  The vector to dot\n   */\n  public dot(v: Vector): number {\n    return this.x * v.x + this.y * v.y;\n  }\n\n  /**\n   * Performs a 2D cross product with scalar. 2D cross products with a scalar return a vector.\n   * @param v  The scalar to cross\n   */\n  public cross(v: number): Vector;\n  /**\n   * Performs a 2D cross product with another vector. 2D cross products return a scalar value not a vector.\n   * @param v  The vector to cross\n   */\n  public cross(v: Vector): number;\n  public cross(v: any): any {\n    if (v instanceof Vector) {\n      return this.x * v.y - this.y * v.x;\n    } else if (typeof v === 'number') {\n      return new Vector(v * this.y, -v * this.x);\n    }\n  }\n\n  /**\n   * Returns the perpendicular vector to this one\n   */\n  public perpendicular(): Vector {\n    return new Vector(this.y, -this.x);\n  }\n\n  /**\n   * Returns the normal vector to this one, same as the perpendicular of length 1\n   */\n  public normal(): Vector {\n    return this.perpendicular().normalize();\n  }\n\n  /**\n   * Negate the current vector\n   */\n  public negate(): Vector {\n    return this.scale(-1);\n  }\n\n  /**\n   * Returns the angle of this vector.\n   */\n  public toAngle(): number {\n    return Math.atan2(this.y, this.x);\n  }\n\n  /**\n   * Rotates the current vector around a point by a certain number of\n   * degrees in radians\n   */\n  public rotate(angle: number, anchor?: Vector): Vector {\n    if (!anchor) {\n      anchor = new Vector(0, 0);\n    }\n    const sinAngle = Math.sin(angle);\n    const cosAngle = Math.cos(angle);\n    const x = cosAngle * (this.x - anchor.x) - sinAngle * (this.y - anchor.y) + anchor.x;\n    const y = sinAngle * (this.x - anchor.x) + cosAngle * (this.y - anchor.y) + anchor.y;\n    return new Vector(x, y);\n  }\n\n  /**\n   * Creates new vector that has the same values as the previous.\n   */\n  public clone(): Vector {\n    return new Vector(this.x, this.y);\n  }\n\n  /**\n   * Returns a string representation of the vector.\n   */\n  public toString(): string {\n    return `(${this.x}, ${this.y})`;\n  }\n}\n\n/**\n * A 2D ray that can be cast into the scene to do collision detection\n */\nexport class Ray {\n  public pos: Vector;\n  public dir: Vector;\n\n  /**\n   * @param pos The starting position for the ray\n   * @param dir The vector indicating the direction of the ray\n   */\n  constructor(pos: Vector, dir: Vector) {\n    this.pos = pos;\n    this.dir = dir.normalize();\n  }\n\n  /**\n   * Tests a whether this ray intersects with a line segment. Returns a number greater than or equal to 0 on success.\n   * This number indicates the mathematical intersection time.\n   * @param line  The line to test\n   */\n  public intersect(line: Line): number {\n    const numerator = line.begin.sub(this.pos);\n\n    // Test is line and ray are parallel and non intersecting\n    if (this.dir.cross(line.getSlope()) === 0 && numerator.cross(this.dir) !== 0) {\n      return -1;\n    }\n\n    // Lines are parallel\n    const divisor = this.dir.cross(line.getSlope());\n    if (divisor === 0) {\n      return -1;\n    }\n\n    const t = numerator.cross(line.getSlope()) / divisor;\n\n    if (t >= 0) {\n      const u = numerator.cross(this.dir) / divisor / line.getLength();\n      if (u >= 0 && u <= 1) {\n        return t;\n      }\n    }\n    return -1;\n  }\n\n  /**\n   * Returns the point of intersection given the intersection time\n   */\n  public getPoint(time: number): Vector {\n    return this.pos.add(this.dir.scale(time));\n  }\n}\n\n/**\n * A 2D line segment\n */\nexport class Line {\n  /**\n   * @param begin  The starting point of the line segment\n   * @param end  The ending point of the line segment\n   */\n  constructor(public begin: Vector, public end: Vector) {}\n\n  /**\n   * Gets the raw slope (m) of the line. Will return (+/-)Infinity for vertical lines.\n   */\n  public get slope() {\n    return (this.end.y - this.begin.y) / (this.end.x - this.begin.x);\n  }\n\n  /**\n   * Gets the Y-intercept (b) of the line. Will return (+/-)Infinity if there is no intercept.\n   */\n  public get intercept() {\n    return this.begin.y - this.slope * this.begin.x;\n  }\n\n  /**\n   * Gets the normal of the line\n   */\n  public normal(): Vector {\n    return this.end.sub(this.begin).normal();\n  }\n\n  /**\n   * Returns the slope of the line in the form of a vector of length 1\n   */\n  public getSlope(): Vector {\n    const begin = this.begin;\n    const end = this.end;\n    const distance = begin.distance(end);\n    return end.sub(begin).scale(1 / distance);\n  }\n\n  /**\n   * Returns the edge of the line as vector, the length of the vector is the length of the edge\n   */\n  public getEdge(): Vector {\n    const begin = this.begin;\n    const end = this.end;\n    return end.sub(begin);\n  }\n\n  /**\n   * Returns the length of the line segment in pixels\n   */\n  public getLength(): number {\n    const begin = this.begin;\n    const end = this.end;\n    const distance = begin.distance(end);\n    return distance;\n  }\n\n  /**\n   * Returns the midpoint of the edge\n   */\n  public get midpoint(): Vector {\n    return this.begin.add(this.end).scale(0.5);\n  }\n\n  /**\n   * Flips the direction of the line segment\n   */\n  public flip(): Line {\n    return new Line(this.end, this.begin);\n  }\n\n  /**\n   * Find the perpendicular distance from the line to a point\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\n   * @param point\n   */\n  public distanceToPoint(point: Vector) {\n    const x0 = point.x;\n    const y0 = point.y;\n\n    const l = this.getLength();\n\n    const dy = this.end.y - this.begin.y;\n    const dx = this.end.x - this.begin.x;\n    const distance = Math.abs(dy * x0 - dx * y0 + this.end.x * this.begin.y - this.end.y * this.begin.x) / l;\n    return distance;\n  }\n\n  /**\n   * Find the perpendicular line from the line to a point\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\n   * (a - p) - ((a - p) * n)n\n   * a is a point on the line\n   * p is the arbitrary point above the line\n   * n is a unit vector in direction of the line\n   * @param point\n   */\n  public findVectorToPoint(point: Vector): Vector {\n    const aMinusP = this.begin.sub(point);\n    const n = this.getSlope();\n\n    return aMinusP.sub(n.scale(aMinusP.dot(n)));\n  }\n\n  /**\n   * Finds a point on the line given only an X or a Y value. Given an X value, the function returns\n   * a new point with the calculated Y value and vice-versa.\n   *\n   * @param x The known X value of the target point\n   * @param y The known Y value of the target point\n   * @returns A new point with the other calculated axis value\n   */\n  public findPoint(x: number = null, y: number = null): Vector {\n    const m = this.slope;\n    const b = this.intercept;\n\n    if (x !== null) {\n      return new Vector(x, m * x + b);\n    } else if (y !== null) {\n      return new Vector((y - b) / m, y);\n    } else {\n      throw new Error('You must provide an X or a Y value');\n    }\n  }\n\n  /**\n   * Whether or not the given point lies on this line. This method is precise by default\n   * meaning the point must lie exactly on the line. Adjust threshold to\n   * loosen the strictness of the check for floating-point calculations.\n   */\n  public hasPoint(x: number, y: number, threshold?: number): boolean;\n\n  /**\n   * Whether or not the given point lies on this line. This method is precise by default\n   * meaning the point must lie exactly on the line. Adjust threshold to\n   * loosen the strictness of the check for floating-point calculations.\n   */\n  public hasPoint(v: Vector, threshold?: number): boolean;\n\n  /**\n   * @see http://stackoverflow.com/a/11908158/109458\n   */\n  public hasPoint(): boolean {\n    let currPoint: Vector;\n    let threshold = 0;\n\n    if (typeof arguments[0] === 'number' && typeof arguments[1] === 'number') {\n      currPoint = new Vector(arguments[0], arguments[1]);\n      threshold = arguments[2] || 0;\n    } else if (arguments[0] instanceof Vector) {\n      currPoint = arguments[0];\n      threshold = arguments[1] || 0;\n    } else {\n      throw 'Could not determine the arguments for Vector.hasPoint';\n    }\n\n    const dxc = currPoint.x - this.begin.x;\n    const dyc = currPoint.y - this.begin.y;\n\n    const dx1 = this.end.x - this.begin.x;\n    const dy1 = this.end.y - this.begin.y;\n\n    const cross = dxc * dy1 - dyc * dx1;\n\n    // check whether point lines on the line\n    if (Math.abs(cross) > threshold) {\n      return false;\n    }\n\n    // check whether point lies in-between start and end\n    if (Math.abs(dx1) >= Math.abs(dy1)) {\n      return dx1 > 0 ? this.begin.x <= currPoint.x && currPoint.x <= this.end.x : this.end.x <= currPoint.x && currPoint.x <= this.begin.x;\n    } else {\n      return dy1 > 0 ? this.begin.y <= currPoint.y && currPoint.y <= this.end.y : this.end.y <= currPoint.y && currPoint.y <= this.begin.y;\n    }\n  }\n}\n\n/**\n * A 1 dimensional projection on an axis, used to test overlaps\n */\nexport class Projection {\n  constructor(public min: number, public max: number) {}\n  public overlaps(projection: Projection): boolean {\n    return this.max > projection.min && projection.max > this.min;\n  }\n\n  public getOverlap(projection: Projection): number {\n    if (this.overlaps(projection)) {\n      if (this.max > projection.max) {\n        return projection.max - this.min;\n      } else {\n        return this.max - projection.min;\n      }\n    }\n    return 0;\n  }\n}\n\nexport class GlobalCoordinates {\n  public static fromPagePosition(x: number, y: number, engine: Engine): GlobalCoordinates;\n  public static fromPagePosition(pos: Vector, engine: Engine): GlobalCoordinates;\n  public static fromPagePosition(xOrPos: number | Vector, yOrEngine: number | Engine, engineOrUndefined?: Engine): GlobalCoordinates {\n    let pageX: number;\n    let pageY: number;\n    let pagePos: Vector;\n    let engine: Engine;\n\n    if (arguments.length === 3) {\n      pageX = <number>xOrPos;\n      pageY = <number>yOrEngine;\n      pagePos = new Vector(pageX, pageY);\n      engine = engineOrUndefined;\n    } else {\n      pagePos = <Vector>xOrPos;\n      pageX = pagePos.x;\n      pageY = pagePos.y;\n      engine = <Engine>yOrEngine;\n    }\n\n    const screenX: number = pageX - Util.getPosition(engine.canvas).x;\n    const screenY: number = pageY - Util.getPosition(engine.canvas).y;\n    const screenPos = new Vector(screenX, screenY);\n    const worldPos = engine.screenToWorldCoordinates(screenPos);\n\n    return new GlobalCoordinates(worldPos, pagePos, screenPos);\n  }\n\n  constructor(public worldPos: Vector, public pagePos: Vector, public screenPos: Vector) {}\n}\n\n/**\n * Shorthand for creating new Vectors - returns a new Vector instance with the\n * provided X and Y components.\n *\n * @param x  X component of the Vector\n * @param y  Y component of the Vector\n */\nexport function vec(x: number, y: number): Vector {\n  return new Vector(x, y);\n}\n","import { obsolete } from '../Util/Decorators';\n\n/**\n * Provides standard colors (e.g. [[Color.Black]])\n * but you can also create custom colors using RGB, HSL, or Hex. Also provides\n * useful color operations like [[Color.lighten]], [[Color.darken]], and more.\n */\nexport class Color {\n  /**\n   * Red channel\n   */\n  public r: number;\n  /**\n   * Green channel\n   */\n  public g: number;\n  /**\n   * Blue channel\n   */\n  public b: number;\n  /**\n   * Alpha channel (between 0 and 1)\n   */\n  public a: number;\n\n  /**\n   * Hue\n   */\n  public h: number;\n  /**\n   * Saturation\n   */\n  public s: number;\n  /**\n   * Lightness\n   */\n  public l: number;\n\n  /**\n   * Creates a new instance of Color from an r, g, b, a\n   *\n   * @param r  The red component of color (0-255)\n   * @param g  The green component of color (0-255)\n   * @param b  The blue component of color (0-255)\n   * @param a  The alpha component of color (0-1.0)\n   */\n  constructor(r: number, g: number, b: number, a?: number) {\n    this.r = r;\n    this.g = g;\n    this.b = b;\n    this.a = a != null ? a : 1;\n  }\n\n  /**\n   * Creates a new instance of Color from an r, g, b, a\n   *\n   * @param r  The red component of color (0-255)\n   * @param g  The green component of color (0-255)\n   * @param b  The blue component of color (0-255)\n   * @param a  The alpha component of color (0-1.0)\n   */\n  public static fromRGB(r: number, g: number, b: number, a?: number): Color {\n    return new Color(r, g, b, a);\n  }\n\n  /**\n   * Creates a new instance of Color from a rgb string\n   *\n   * @param string  CSS color string of the form rgba(255, 255, 255, 1) or rgb(255, 255, 255)\n   */\n  public static fromRGBString(string: string): Color {\n    const rgbaRegEx: RegExp = /^rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*(\\d+(?:\\.\\d+)?))?\\)/i;\n    let match = null;\n    if ((match = string.match(rgbaRegEx))) {\n      const r = parseInt(match[1], 10);\n      const g = parseInt(match[2], 10);\n      const b = parseInt(match[3], 10);\n      let a = 1;\n      if (match[4]) {\n        a = parseFloat(match[4]);\n      }\n      return new Color(r, g, b, a);\n    } else {\n      throw new Error('Invalid rgb/a string: ' + string);\n    }\n  }\n\n  /**\n   * Creates a new instance of Color from a hex string\n   *\n   * @param hex  CSS color string of the form #ffffff, the alpha component is optional\n   */\n  public static fromHex(hex: string): Color {\n    const hexRegEx: RegExp = /^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;\n    let match = null;\n    if ((match = hex.match(hexRegEx))) {\n      const r = parseInt(match[1], 16);\n      const g = parseInt(match[2], 16);\n      const b = parseInt(match[3], 16);\n      let a = 1;\n      if (match[4]) {\n        a = parseInt(match[4], 16) / 255;\n      }\n      return new Color(r, g, b, a);\n    } else {\n      throw new Error('Invalid hex string: ' + hex);\n    }\n  }\n\n  /**\n   * Creates a new instance of Color from hsla values\n   *\n   * @param h  Hue is represented [0-1]\n   * @param s  Saturation is represented [0-1]\n   * @param l  Luminance is represented [0-1]\n   * @param a  Alpha is represented [0-1]\n   */\n  public static fromHSL(h: number, s: number, l: number, a: number = 1.0): Color {\n    const temp = new HSLColor(h, s, l, a);\n    return temp.toRGBA();\n  }\n\n  /**\n   * Lightens the current color by a specified amount\n   *\n   * @param factor  The amount to lighten by [0-1]\n   */\n  public lighten(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.l += (1 - temp.l) * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Darkens the current color by a specified amount\n   *\n   * @param factor  The amount to darken by [0-1]\n   */\n  public darken(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.l -= temp.l * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Saturates the current color by a specified amount\n   *\n   * @param factor  The amount to saturate by [0-1]\n   */\n  public saturate(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.s += temp.s * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Desaturates the current color by a specified amount\n   *\n   * @param factor  The amount to desaturate by [0-1]\n   */\n  public desaturate(factor: number = 0.1): Color {\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\n    temp.s -= temp.s * factor;\n    return temp.toRGBA();\n  }\n\n  /**\n   * Multiplies a color by another, results in a darker color\n   *\n   * @param color  The other color\n   */\n  public multiply(color: Color): Color {\n    const newR = (((color.r / 255) * this.r) / 255) * 255;\n    const newG = (((color.g / 255) * this.g) / 255) * 255;\n    const newB = (((color.b / 255) * this.b) / 255) * 255;\n    const newA = color.a * this.a;\n    return new Color(newR, newG, newB, newA);\n  }\n\n  /**\n   * Multiplies a color by another, results in a darker color\n   * @param color\n   * @obsolete Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0\n   */\n  @obsolete({ message: 'Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0' })\n  public mulitiply(color: Color): Color {\n    return this.multiply(color);\n  }\n\n  /**\n   * Screens a color by another, results in a lighter color\n   *\n   * @param color  The other color\n   */\n  public screen(color: Color): Color {\n    const color1 = color.invert();\n    const color2 = color.invert();\n    return color1.multiply(color2).invert();\n  }\n\n  /**\n   * Inverts the current color\n   */\n  public invert(): Color {\n    return new Color(255 - this.r, 255 - this.g, 255 - this.b, 1.0 - this.a);\n  }\n\n  /**\n   * Averages the current color with another\n   *\n   * @param color  The other color\n   */\n  public average(color: Color): Color {\n    const newR = (color.r + this.r) / 2;\n    const newG = (color.g + this.g) / 2;\n    const newB = (color.b + this.b) / 2;\n    const newA = (color.a + this.a) / 2;\n    return new Color(newR, newG, newB, newA);\n  }\n\n  /**\n   * Returns a CSS string representation of a color.\n   *\n   * @param format Color representation, accepts: rgb, hsl, or hex\n   */\n  public toString(format: 'rgb' | 'hsl' | 'hex' = 'rgb') {\n    switch (format) {\n      case 'rgb':\n        return this.toRGBA();\n      case 'hsl':\n        return this.toHSLA();\n      case 'hex':\n        return this.toHex();\n      default:\n        throw new Error('Invalid Color format');\n    }\n  }\n\n  /**\n   * Returns Hex Value of a color component\n   * @param c color component\n   * @see https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb\n   */\n  private _componentToHex(c: number) {\n    const hex = c.toString(16);\n    return hex.length === 1 ? '0' + hex : hex;\n  }\n\n  /**\n   * Return Hex representation of a color.\n   */\n  public toHex() {\n    return '#' + this._componentToHex(this.r) + this._componentToHex(this.g) + this._componentToHex(this.b);\n  }\n\n  /**\n   * Return RGBA representation of a color.\n   */\n  public toRGBA() {\n    const result = String(this.r.toFixed(0)) + ', ' + String(this.g.toFixed(0)) + ', ' + String(this.b.toFixed(0));\n    if (this.a !== undefined || this.a !== null) {\n      return 'rgba(' + result + ', ' + String(this.a) + ')';\n    }\n    return 'rgb(' + result + ')';\n  }\n\n  /**\n   * Return HSLA representation of a color.\n   */\n  public toHSLA() {\n    return HSLColor.fromRGBA(this.r, this.g, this.b, this.a).toString();\n  }\n\n  /**\n   * Returns a CSS string representation of a color.\n   */\n  public fillStyle() {\n    return this.toString();\n  }\n\n  /**\n   * Returns a clone of the current color.\n   */\n  public clone(): Color {\n    return new Color(this.r, this.g, this.b, this.a);\n  }\n\n  /**\n   * Black (#000000)\n   */\n  public static get Black(): Color {\n    return Color.fromHex('#000000');\n  }\n\n  /**\n   * White (#FFFFFF)\n   */\n  public static get White(): Color {\n    return Color.fromHex('#FFFFFF');\n  }\n\n  /**\n   * Gray (#808080)\n   */\n  public static get Gray(): Color {\n    return Color.fromHex('#808080');\n  }\n\n  /**\n   * Light gray (#D3D3D3)\n   */\n  public static get LightGray(): Color {\n    return Color.fromHex('#D3D3D3');\n  }\n\n  /**\n   * Dark gray (#A9A9A9)\n   */\n  public static get DarkGray(): Color {\n    return Color.fromHex('#A9A9A9');\n  }\n\n  /**\n   * Yellow (#FFFF00)\n   */\n  public static get Yellow(): Color {\n    return Color.fromHex('#FFFF00');\n  }\n\n  /**\n   * Orange (#FFA500)\n   */\n  public static get Orange(): Color {\n    return Color.fromHex('#FFA500');\n  }\n\n  /**\n   * Red (#FF0000)\n   */\n  public static get Red(): Color {\n    return Color.fromHex('#FF0000');\n  }\n\n  /**\n   * Vermilion (#FF5B31)\n   */\n  public static get Vermilion(): Color {\n    return Color.fromHex('#FF5B31');\n  }\n\n  /**\n   * Vermilion (#FF5B31)\n   * @obsolete Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0\n   */\n  @obsolete({\n    message: 'Alias for incorrect spelling used in older versions',\n    alternateMethod: 'Vermilion'\n  })\n  public static get Vermillion(): Color {\n    return Color.Vermilion;\n  }\n\n  /**\n   * Rose (#FF007F)\n   */\n  public static get Rose(): Color {\n    return Color.fromHex('#FF007F');\n  }\n\n  /**\n   * Magenta (#FF00FF)\n   */\n  public static get Magenta(): Color {\n    return Color.fromHex('#FF00FF');\n  }\n\n  /**\n   * Violet (#7F00FF)\n   */\n  public static get Violet(): Color {\n    return Color.fromHex('#7F00FF');\n  }\n\n  /**\n   * Blue (#0000FF)\n   */\n  public static get Blue(): Color {\n    return Color.fromHex('#0000FF');\n  }\n\n  /**\n   * Azure (#007FFF)\n   */\n  public static get Azure(): Color {\n    return Color.fromHex('#007FFF');\n  }\n\n  /**\n   * Cyan (#00FFFF)\n   */\n  public static get Cyan(): Color {\n    return Color.fromHex('#00FFFF');\n  }\n\n  /**\n   * Viridian (#59978F)\n   */\n  public static get Viridian(): Color {\n    return Color.fromHex('#59978F');\n  }\n\n  /**\n   * Green (#00FF00)\n   */\n  public static get Green(): Color {\n    return Color.fromHex('#00FF00');\n  }\n\n  /**\n   * Chartreuse (#7FFF00)\n   */\n  public static get Chartreuse(): Color {\n    return Color.fromHex('#7FFF00');\n  }\n\n  /**\n   * Transparent (#FFFFFF00)\n   */\n  public static get Transparent(): Color {\n    return Color.fromHex('#FFFFFF00');\n  }\n}\n\n/**\n * Internal HSL Color representation\n *\n * http://en.wikipedia.org/wiki/HSL_and_HSV\n * http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c\n */\nclass HSLColor {\n  constructor(public h: number, public s: number, public l: number, public a: number) {}\n\n  public static hue2rgb(p: number, q: number, t: number): number {\n    if (t < 0) {\n      t += 1;\n    }\n    if (t > 1) {\n      t -= 1;\n    }\n    if (t < 1 / 6) {\n      return p + (q - p) * 6 * t;\n    }\n    if (t < 1 / 2) {\n      return q;\n    }\n    if (t < 2 / 3) {\n      return p + (q - p) * (2 / 3 - t) * 6;\n    }\n    return p;\n  }\n\n  public static fromRGBA(r: number, g: number, b: number, a: number): HSLColor {\n    r /= 255;\n    g /= 255;\n    b /= 255;\n    const max = Math.max(r, g, b),\n      min = Math.min(r, g, b);\n    let h, s;\n    const l = (max + min) / 2;\n\n    if (max === min) {\n      h = s = 0; // achromatic\n    } else {\n      const d = max - min;\n      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n      switch (max) {\n        case r:\n          h = (g - b) / d + (g < b ? 6 : 0);\n          break;\n        case g:\n          h = (b - r) / d + 2;\n          break;\n        case b:\n          h = (r - g) / d + 4;\n          break;\n      }\n      h /= 6;\n    }\n\n    return new HSLColor(h, s, l, a);\n  }\n\n  public toRGBA(): Color {\n    let r: number, g: number, b: number;\n\n    if (this.s === 0) {\n      r = g = b = this.l; // achromatic\n    } else {\n      const q = this.l < 0.5 ? this.l * (1 + this.s) : this.l + this.s - this.l * this.s;\n      const p = 2 * this.l - q;\n      r = HSLColor.hue2rgb(p, q, this.h + 1 / 3);\n      g = HSLColor.hue2rgb(p, q, this.h);\n      b = HSLColor.hue2rgb(p, q, this.h - 1 / 3);\n    }\n\n    return new Color(r * 255, g * 255, b * 255, this.a);\n  }\n\n  public toString(): string {\n    const h = this.h.toFixed(0),\n      s = this.s.toFixed(0),\n      l = this.l.toFixed(0),\n      a = this.a.toFixed(0);\n    return `hsla(${h}, ${s}, ${l}, ${a})`;\n  }\n}\n","import { Vector } from './Algebra';\nimport { obsolete } from './Util/Decorators';\n\n/**\n * Possible collision resolution strategies\n *\n * The default is [[CollisionResolutionStrategy.Box]] which performs simple axis aligned arcade style physics.\n *\n * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.RigidBody]] which allows for complicated\n * simulated physical interactions.\n */\nexport enum CollisionResolutionStrategy {\n  Box,\n  RigidBody\n}\n\n/**\n * Possible broadphase collision pair identification strategies\n *\n * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\n * potential collision pairs which is O(nlog(n)) faster. The other possible strategy is the [[BroadphaseStrategy.Naive]] strategy\n * which loops over every object for every object in the scene to identify collision pairs which is O(n^2) slower.\n */\nexport enum BroadphaseStrategy {\n  Naive,\n  DynamicAABBTree\n}\n\n/**\n * Possible numerical integrators for position and velocity\n */\nexport enum Integrator {\n  Euler\n}\n\n/**\n * The [[Physics]] object is the global configuration object for all Excalibur physics.\n */\n/* istanbul ignore next */\nexport class Physics {\n  /**\n   * Global acceleration that is applied to all vanilla actors that have a [[CollisionType.Active|active]] collision type.\n   * Global acceleration won't effect [[Label|labels]], [[ScreenElement|ui actors]], or [[Trigger|triggers]] in Excalibur.\n   *\n   * This is a great way to globally simulate effects like gravity.\n   */\n  public static acc = new Vector(0, 0);\n\n  /**\n   * Globally switches all Excalibur physics behavior on or off.\n   */\n  public static enabled = true;\n\n  /**\n   * Gets or sets the number of collision passes for Excalibur to perform on physics bodies.\n   *\n   * Reducing collision passes may cause things not to collide as expected in your game, but may increase performance.\n   *\n   * More passes can improve the visual quality of collisions when many objects are on the screen. This can reduce jitter, improve the\n   * collision resolution of fast move objects, or the stability of large numbers of objects stacked together.\n   *\n   * Fewer passes will improve the performance of the game at the cost of collision quality, more passes will improve quality at the\n   * cost of performance.\n   *\n   * The default is set to 5 passes which is a good start.\n   */\n  public static collisionPasses = 5;\n\n  /**\n   * Gets or sets the broadphase pair identification strategy.\n   *\n   * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\n   * potential collision pairs which is O(nlog(n)) faster. The other possible strategy is the [[BroadphaseStrategy.Naive]] strategy\n   * which loops over every object for every object in the scene to identify collision pairs which is O(n^2) slower.\n   */\n  public static broadphaseStrategy: BroadphaseStrategy = BroadphaseStrategy.DynamicAABBTree;\n\n  /**\n   * Globally switches the debug information for the broadphase strategy\n   */\n  public static broadphaseDebug: boolean = false;\n  /**\n   * Show the normals as a result of collision on the screen.\n   */\n  public static showCollisionNormals: boolean = false;\n  /**\n   * Show the position, velocity, and acceleration as graphical vectors.\n   */\n  public static showMotionVectors: boolean = false;\n  /**\n   * Show the axis-aligned bounding boxes of the collision bodies on the screen.\n   */\n  public static showBounds: boolean = false;\n  /**\n   * Show the bounding collision area shapes\n   */\n  public static showArea: boolean = false;\n  /**\n   * Show points of collision interpreted by excalibur as a result of collision.\n   */\n  public static showContacts: boolean = false;\n  /**\n   * Show the surface normals of the collision areas.\n   */\n  public static showNormals: boolean = false;\n  /**\n   * Gets or sets the global collision resolution strategy (narrowphase).\n   *\n   * The default is [[CollisionResolutionStrategy.Box]] which performs simple axis aligned arcade style physics.\n   *\n   * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.RigidBody]] which allows for complicated\n   * simulated physical interactions.\n   */\n  public static collisionResolutionStrategy: CollisionResolutionStrategy = CollisionResolutionStrategy.Box;\n  /**\n   * The default mass to use if none is specified\n   */\n  public static defaultMass: number = 10;\n  /**\n   * Gets or sets the position and velocity positional integrator, currently only Euler is supported.\n   */\n  public static integrator: Integrator = Integrator.Euler;\n  /**\n   * Number of steps to use in integration. A higher number improves the positional accuracy over time. This can be useful to increase\n   * if you have fast moving objects in your simulation or you have a large number of objects and need to increase stability.\n   */\n  public static integrationSteps = 1;\n  /**\n   * Gets or sets whether rotation is allowed in a RigidBody collision resolution\n   */\n  public static allowRigidBodyRotation = true;\n\n  /**\n   * Configures Excalibur to use box physics. Box physics which performs simple axis aligned arcade style physics.\n   */\n  public static useBoxPhysics(): void {\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.Box;\n  }\n\n  /**\n   * Configures Excalibur to use rigid body physics. Rigid body physics allows for complicated\n   * simulated physical interactions.\n   */\n  public static useRigidBodyPhysics(): void {\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.RigidBody;\n  }\n\n  /**\n   * Small value to help collision passes settle themselves after the narrowphase.\n   */\n  public static collisionShift = 0.001;\n\n  /**\n   * Factor to add to the RigidBody BoundingBox, bounding box (dimensions += vel * dynamicTreeVelocityMultiplier);\n   */\n  public static dynamicTreeVelocityMultiplier = 2;\n\n  @obsolete({\n    message: 'Alias for incorrect spelling used in older versions, will be removed in v0.25.0',\n    alternateMethod: 'dynamicTreeVelocityMultiplier'\n  })\n  public static get dynamicTreeVelocityMultiplyer() {\n    return Physics.dynamicTreeVelocityMultiplier;\n  }\n\n  public static set dynamicTreeVelocityMultiplyer(value: number) {\n    Physics.dynamicTreeVelocityMultiplier = value;\n  }\n\n  /**\n   * Pad RigidBody BoundingBox by a constant amount\n   */\n  public static boundsPadding = 5;\n\n  /**\n   * Surface epsilon is used to help deal with surface penetration\n   */\n  public static surfaceEpsilon = 0.1;\n\n  /**\n   * Enable fast moving body checking, this enables checking for collision pairs via raycast for fast moving objects to prevent\n   * bodies from tunneling through one another.\n   */\n  public static checkForFastBodies = true;\n\n  /**\n   * Disable minimum fast moving body raycast, by default if ex.Physics.checkForFastBodies = true Excalibur will only check if the\n   * body is moving at least half of its minimum dimension in an update. If ex.Physics.disableMinimumSpeedForFastBody is set to true,\n   * Excalibur will always perform the fast body raycast regardless of speed.\n   */\n  public static disableMinimumSpeedForFastBody = false;\n}\n","import { Scene } from './Scene';\nimport { Vector } from './Algebra';\nimport { Actor } from './Actor';\nimport { Trigger } from './Trigger';\nimport { FrameStats } from './Debug';\nimport { Engine } from './Engine';\nimport { TileMap } from './TileMap';\nimport { Side } from './Collision/Side';\nimport * as Input from './Input/Index';\nimport { Pair } from './index';\nimport { Collider } from './Collision/Collider';\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { OnInitialize, OnPreUpdate, OnPostUpdate } from './Interfaces/LifecycleEvents';\n\nexport enum EventTypes {\n  Kill = 'kill',\n  PreKill = 'prekill',\n  PostKill = 'postkill',\n\n  PreDraw = 'predraw',\n  PostDraw = 'postdraw',\n\n  PreDebugDraw = 'predebugdraw',\n  PostDebugDraw = 'postdebugdraw',\n\n  PreUpdate = 'preupdate',\n  PostUpdate = 'postupdate',\n\n  PreFrame = 'preframe',\n  PostFrame = 'postframe',\n\n  PreCollision = 'precollision',\n  CollisionStart = 'collisionstart',\n  CollisionEnd = 'collisionend',\n  PostCollision = 'postcollision',\n\n  Initialize = 'initialize',\n  Activate = 'activate',\n  Deactivate = 'deactivate',\n\n  ExitViewport = 'exitviewport',\n  EnterViewport = 'enterviewport',\n\n  ExitTrigger = 'exit',\n  EnterTrigger = 'enter',\n\n  Connect = 'connect',\n  Disconnect = 'disconnect',\n  Button = 'button',\n  Axis = 'axis',\n\n  Subscribe = 'subscribe',\n  Unsubscribe = 'unsubscribe',\n\n  Visible = 'visible',\n  Hidden = 'hidden',\n  Start = 'start',\n  Stop = 'stop',\n\n  PointerUp = 'pointerup',\n  PointerDown = 'pointerdown',\n  PointerMove = 'pointermove',\n  PointerEnter = 'pointerenter',\n  PointerLeave = 'pointerleave',\n  PointerCancel = 'pointercancel',\n  PointerWheel = 'pointerwheel',\n\n  Up = 'up',\n  Down = 'down',\n  Move = 'move',\n  Enter = 'enter',\n  Leave = 'leave',\n  Cancel = 'cancel',\n  Wheel = 'wheel',\n\n  Press = 'press',\n  Release = 'release',\n  Hold = 'hold',\n\n  PointerDragStart = 'pointerdragstart',\n  PointerDragEnd = 'pointerdragend',\n  PointerDragEnter = 'pointerdragenter',\n  PointerDragLeave = 'pointerdragleave',\n  PointerDragMove = 'pointerdragmove'\n}\n\n/* istanbul ignore next */\n/* compiler only: these are internal to lib */\nexport type kill = 'kill';\nexport type prekill = 'prekill';\nexport type postkill = 'postkill';\n\nexport type predraw = 'predraw';\nexport type postdraw = 'postdraw';\n\nexport type predebugdraw = 'predebugdraw';\nexport type postdebugdraw = 'postdebugdraw';\n\nexport type preupdate = 'preupdate';\nexport type postupdate = 'postupdate';\n\nexport type preframe = 'preframe';\nexport type postframe = 'postframe';\n\nexport type precollision = 'precollision';\nexport type collisionstart = 'collisionstart';\nexport type collisionend = 'collisionend';\nexport type postcollision = 'postcollision';\n\nexport type initialize = 'initialize';\nexport type activate = 'activate';\nexport type deactivate = 'deactivate';\n\nexport type exitviewport = 'exitviewport';\nexport type enterviewport = 'enterviewport';\n\nexport type exittrigger = 'exit';\nexport type entertrigger = 'enter';\n\nexport type connect = 'connect';\nexport type disconnect = 'disconnect';\nexport type button = 'button';\nexport type axis = 'axis';\n\nexport type subscribe = 'subscribe';\nexport type unsubscribe = 'unsubscribe';\n\nexport type visible = 'visible';\nexport type hidden = 'hidden';\nexport type start = 'start';\nexport type stop = 'stop';\n\nexport type pointerup = 'pointerup';\nexport type pointerdown = 'pointerdown';\nexport type pointermove = 'pointermove';\nexport type pointerenter = 'pointerenter';\nexport type pointerleave = 'pointerleave';\nexport type pointercancel = 'pointercancel';\nexport type pointerwheel = 'pointerwheel';\n\nexport type up = 'up';\nexport type down = 'down';\nexport type move = 'move';\nexport type enter = 'enter';\nexport type leave = 'leave';\nexport type cancel = 'cancel';\nexport type wheel = 'wheel';\n\nexport type press = 'press';\nexport type release = 'release';\nexport type hold = 'hold';\n\nexport type pointerdragstart = 'pointerdragstart';\nexport type pointerdragend = 'pointerdragend';\nexport type pointerdragenter = 'pointerdragenter';\nexport type pointerdragleave = 'pointerdragleave';\nexport type pointerdragmove = 'pointerdragmove';\n\n/**\n * Base event type in Excalibur that all other event types derive from. Not all event types are thrown on all Excalibur game objects,\n * some events are unique to a type, others are not.\n *\n */\nexport class GameEvent<T, U = T> {\n  /**\n   * Target object for this event.\n   */\n  public target: T;\n\n  /**\n   * Other target object for this event\n   */\n  public other: U | null;\n\n  /**\n   * If set to false, prevents event from propagating to other actors. If true it will be propagated\n   * to all actors that apply.\n   */\n  public get bubbles(): boolean {\n    return this._bubbles;\n  }\n\n  public set bubbles(value: boolean) {\n    this._bubbles = value;\n  }\n\n  private _bubbles: boolean = true;\n  /**\n   * Prevents event from bubbling\n   */\n  public stopPropagation() {\n    this.bubbles = false;\n  }\n}\n\n/**\n * The 'kill' event is emitted on actors when it is killed. The target is the actor that was killed.\n */\nexport class KillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'prekill' event is emitted directly before an actor is killed.\n */\nexport class PreKillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'postkill' event is emitted directly after the actor is killed.\n */\nexport class PostKillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'start' event is emitted on engine when has started and is ready for interaction.\n */\nexport class GameStartEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * The 'stop' event is emitted on engine when has been stopped and will no longer take input, update or draw.\n */\nexport class GameStopEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * The 'predraw' event is emitted on actors, scenes, and engine before drawing starts. Actors' predraw happens inside their graphics\n * transform so that all drawing takes place with the actor as the origin.\n *\n */\nexport class PreDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\n  constructor(public ctx: CanvasRenderingContext2D, public delta: number, public target: Entity | Scene | Engine | TileMap) {\n    super();\n  }\n}\n\n/**\n * The 'postdraw' event is emitted on actors, scenes, and engine after drawing finishes. Actors' postdraw happens inside their graphics\n * transform so that all drawing takes place with the actor as the origin.\n *\n */\nexport class PostDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\n  constructor(public ctx: CanvasRenderingContext2D, public delta: number, public target: Entity | Scene | Engine | TileMap) {\n    super();\n  }\n}\n\n/**\n * The 'predebugdraw' event is emitted on actors, scenes, and engine before debug drawing starts.\n */\nexport class PreDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\n  constructor(public ctx: CanvasRenderingContext2D, public target: Entity | Actor | Scene | Engine) {\n    super();\n  }\n}\n\n/**\n * The 'postdebugdraw' event is emitted on actors, scenes, and engine after debug drawing starts.\n */\nexport class PostDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\n  constructor(public ctx: CanvasRenderingContext2D, public target: Entity | Actor | Scene | Engine) {\n    super();\n  }\n}\n\n/**\n * The 'preupdate' event is emitted on actors, scenes, camera, and engine before the update starts.\n */\nexport class PreUpdateEvent<T extends OnPreUpdate = Entity> extends GameEvent<T> {\n  constructor(public engine: Engine, public delta: number, public target: T) {\n    super();\n  }\n}\n\n/**\n * The 'postupdate' event is emitted on actors, scenes, camera, and engine after the update ends.\n */\nexport class PostUpdateEvent<T extends OnPostUpdate = Entity> extends GameEvent<T> {\n  constructor(public engine: Engine, public delta: number, public target: T) {\n    super();\n  }\n}\n\n/**\n * The 'preframe' event is emitted on the engine, before the frame begins.\n */\nexport class PreFrameEvent extends GameEvent<Engine> {\n  constructor(public engine: Engine, public prevStats: FrameStats) {\n    super();\n    this.target = engine;\n  }\n}\n\n/**\n * The 'postframe' event is emitted on the engine, after a frame ends.\n */\nexport class PostFrameEvent extends GameEvent<Engine> {\n  constructor(public engine: Engine, public stats: FrameStats) {\n    super();\n    this.target = engine;\n  }\n}\n\n/**\n * Event received when a gamepad is connected to Excalibur. [[Gamepads]] receives this event.\n */\nexport class GamepadConnectEvent extends GameEvent<Input.Gamepad> {\n  constructor(public index: number, public gamepad: Input.Gamepad) {\n    super();\n    this.target = gamepad;\n  }\n}\n\n/**\n * Event received when a gamepad is disconnected from Excalibur. [[Gamepads]] receives this event.\n */\nexport class GamepadDisconnectEvent extends GameEvent<Input.Gamepad> {\n  constructor(public index: number, public gamepad: Input.Gamepad) {\n    super();\n    this.target = gamepad;\n  }\n}\n\n/**\n * Gamepad button event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\n */\nexport class GamepadButtonEvent extends GameEvent<Input.Gamepad> {\n  /**\n   * @param button  The Gamepad button\n   * @param value   A numeric value between 0 and 1\n   */\n  constructor(public button: Input.Buttons, public value: number, public target: Input.Gamepad) {\n    super();\n  }\n}\n\n/**\n * Gamepad axis event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\n */\nexport class GamepadAxisEvent extends GameEvent<Input.Gamepad> {\n  /**\n   * @param axis  The Gamepad axis\n   * @param value A numeric value between -1 and 1\n   */\n  constructor(public axis: Input.Axes, public value: number, public target: Input.Gamepad) {\n    super();\n  }\n}\n\n/**\n * Subscribe event thrown when handlers for events other than subscribe are added. Meta event that is received by\n * [[EventDispatcher|event dispatchers]].\n */\nexport class SubscribeEvent<T> extends GameEvent<T> {\n  constructor(public topic: string, public handler: (event: GameEvent<T>) => void) {\n    super();\n  }\n}\n\n/**\n * Unsubscribe event thrown when handlers for events other than unsubscribe are removed. Meta event that is received by\n * [[EventDispatcher|event dispatchers]].\n */\nexport class UnsubscribeEvent<T> extends GameEvent<T> {\n  constructor(public topic: string, public handler: (event: GameEvent<T>) => void) {\n    super();\n  }\n}\n\n/**\n * Event received by the [[Engine]] when the browser window is visible on a screen.\n */\nexport class VisibleEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * Event received by the [[Engine]] when the browser window is hidden from all screens.\n */\nexport class HiddenEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor|actor]] when a collision will occur this frame if it resolves\n */\nexport class PreCollisionEvent<T extends Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   * @param actor         The actor the event was thrown on\n   * @param other         The actor that will collided with the current actor\n   * @param side          The side that will be collided with the current actor\n   * @param intersection  Intersection vector\n   */\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown on an [[Actor|actor]] when a collision has been resolved (body reacted) this frame\n */\nexport class PostCollisionEvent<T extends Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   * @param actor         The actor the event was thrown on\n   * @param other         The actor that did collide with the current actor\n   * @param side          The side that did collide with the current actor\n   * @param intersection  Intersection vector\n   */\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown the first time an [[Actor|actor]] collides with another, after an actor is in contact normal collision events are fired.\n */\nexport class CollisionStartEvent<T extends Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   *\n   * @param actor\n   * @param other\n   * @param pair\n   */\n  constructor(actor: T, public other: T, public pair: Pair) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown when the [[Actor|actor]] is no longer colliding with another\n */\nexport class CollisionEndEvent<T extends Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   *\n   */\n  constructor(actor: T, public other: T) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] and a [[Scene]] only once before the first update call\n */\nexport class InitializeEvent<T extends OnInitialize = Entity> extends GameEvent<T> {\n  /**\n   * @param engine  The reference to the current engine\n   */\n  constructor(public engine: Engine, public target: T) {\n    super();\n  }\n}\n\n/**\n * Event thrown on a [[Scene]] on activation\n */\nexport class ActivateEvent extends GameEvent<Scene> {\n  /**\n   * @param oldScene  The reference to the old scene\n   */\n  constructor(public oldScene: Scene, public target: Scene) {\n    super();\n  }\n}\n\n/**\n * Event thrown on a [[Scene]] on deactivation\n */\nexport class DeactivateEvent extends GameEvent<Scene> {\n  /**\n   * @param newScene  The reference to the new scene\n   */\n  constructor(public newScene: Scene, public target: Scene) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] when it completely leaves the screen.\n */\nexport class ExitViewPortEvent extends GameEvent<Entity> {\n  constructor(public target: Entity) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] when it completely leaves the screen.\n */\nexport class EnterViewPortEvent extends GameEvent<Entity> {\n  constructor(public target: Entity) {\n    super();\n  }\n}\n\nexport class EnterTriggerEvent extends GameEvent<Actor> {\n  constructor(public target: Trigger, public actor: Actor) {\n    super();\n  }\n}\n\nexport class ExitTriggerEvent extends GameEvent<Actor> {\n  constructor(public target: Trigger, public actor: Actor) {\n    super();\n  }\n}\n","/**\n * An enum that describes the types of collisions actors can participate in\n */\nexport enum CollisionType {\n  /**\n   * Actors with the `PreventCollision` setting do not participate in any\n   * collisions and do not raise collision events.\n   */\n  PreventCollision = 'PreventCollision',\n  /**\n   * Actors with the `Passive` setting only raise collision events, but are not\n   * influenced or moved by other actors and do not influence or move other actors.\n   */\n  Passive = 'Passive',\n  /**\n   * Actors with the `Active` setting raise collision events and participate\n   * in collisions with other actors and will be push or moved by actors sharing\n   * the `Active` or `Fixed` setting.\n   */\n  Active = 'Active',\n  /**\n   * Actors with the `Fixed` setting raise collision events and participate in\n   * collisions with other actors. Actors with the `Fixed` setting will not be\n   * pushed or moved by other actors sharing the `Fixed`. Think of Fixed\n   * actors as \"immovable/unstoppable\" objects. If two `Fixed` actors meet they will\n   * not be pushed or moved by each other, they will not interact except to throw\n   * collision events.\n   */\n  Fixed = 'Fixed'\n}\n","import { Body } from './Body';\nimport { Vector } from '../Algebra';\nimport { Physics, CollisionResolutionStrategy } from '../Physics';\nimport { PostCollisionEvent, PreCollisionEvent } from '../Events';\nimport * as Util from '../Util/Util';\nimport { CollisionType } from './CollisionType';\nimport { Collider } from './Collider';\n\n/**\n * Collision contacts are used internally by Excalibur to resolve collision between colliders. This\n * Pair prevents collisions from being evaluated more than one time\n */\nexport class CollisionContact {\n  /**\n   * The id of this collision contact\n   */\n  id: string;\n  /**\n   * The first collider in the collision\n   */\n  colliderA: Collider;\n  /**\n   * The second collider in the collision\n   */\n  colliderB: Collider;\n  /**\n   * The minimum translation vector to resolve penetration, pointing away from colliderA\n   */\n  mtv: Vector;\n  /**\n   * The point of collision shared between colliderA and colliderB\n   */\n  point: Vector;\n  /**\n   * The collision normal, pointing away from colliderA\n   */\n  normal: Vector;\n\n  constructor(colliderA: Collider, colliderB: Collider, mtv: Vector, point: Vector, normal: Vector) {\n    this.colliderA = colliderA;\n    this.colliderB = colliderB;\n    this.mtv = mtv;\n    this.point = point;\n    this.normal = normal;\n  }\n\n  resolve(strategy: CollisionResolutionStrategy) {\n    if (strategy === CollisionResolutionStrategy.RigidBody) {\n      this._resolveRigidBodyCollision();\n    } else if (strategy === CollisionResolutionStrategy.Box) {\n      this._resolveBoxCollision();\n    } else {\n      throw new Error('Unknown collision resolution strategy');\n    }\n  }\n\n  private _applyBoxImpulse(colliderA: Collider, colliderB: Collider, mtv: Vector) {\n    if (colliderA.type === CollisionType.Active && colliderB.type !== CollisionType.Passive) {\n      // Resolve overlaps\n      if (colliderA.type === CollisionType.Active && colliderB.type === CollisionType.Active) {\n        // split overlaps if both are Active\n        mtv = mtv.scale(0.5);\n      }\n      // Apply mtv\n      colliderA.body.pos.y += mtv.y;\n      colliderA.body.pos.x += mtv.x;\n\n      const mtvDir = mtv.normalize();\n\n      // only adjust if velocity is opposite\n      if (mtvDir.dot(colliderA.body.vel) < 0) {\n        // Cancel out velocity in direction of mtv\n        const velAdj = mtvDir.scale(mtvDir.dot(colliderA.body.vel.negate()));\n\n        colliderA.body.vel = colliderA.body.vel.add(velAdj);\n      }\n\n      colliderA.emit('postcollision', new PostCollisionEvent(colliderA, colliderB, Util.getSideFromDirection(mtv), mtv));\n    }\n  }\n\n  private _resolveBoxCollision() {\n    const side = Util.getSideFromDirection(this.mtv);\n    const mtv = this.mtv.negate();\n    // Publish collision events on both participants\n    this.colliderA.emit('precollision', new PreCollisionEvent(this.colliderA, this.colliderB, side, mtv));\n    this.colliderB.emit('precollision', new PreCollisionEvent(this.colliderB, this.colliderA, Util.getOppositeSide(side), mtv.negate()));\n\n    this._applyBoxImpulse(this.colliderA, this.colliderB, mtv);\n    this._applyBoxImpulse(this.colliderB, this.colliderA, mtv.negate());\n  }\n\n  private _resolveRigidBodyCollision() {\n    // perform collision on bounding areas\n    const bodyA: Body = this.colliderA.body;\n    const bodyB: Body = this.colliderB.body;\n    const mtv = this.mtv; // normal pointing away from colliderA\n    let normal = this.normal; // normal pointing away from colliderA\n    if (bodyA === bodyB) {\n      // sanity check for existing pairs\n      return;\n    }\n\n    // Publish collision events on both participants\n    const side = Util.getSideFromDirection(this.mtv);\n    this.colliderA.emit('precollision', new PreCollisionEvent(this.colliderA, this.colliderB, side, this.mtv));\n    this.colliderB.emit(\n      'precollision',\n      new PreCollisionEvent(this.colliderB, this.colliderA, Util.getOppositeSide(side), this.mtv.negate())\n    );\n\n    // If any of the participants are passive then short circuit\n    if (this.colliderA.type === CollisionType.Passive || this.colliderB.type === CollisionType.Passive) {\n      return;\n    }\n\n    const invMassA = this.colliderA.type === CollisionType.Fixed ? 0 : 1 / this.colliderA.mass;\n    const invMassB = this.colliderB.type === CollisionType.Fixed ? 0 : 1 / this.colliderB.mass;\n\n    const invMoiA = this.colliderA.type === CollisionType.Fixed ? 0 : 1 / this.colliderA.inertia;\n    const invMoiB = this.colliderB.type === CollisionType.Fixed ? 0 : 1 / this.colliderB.inertia;\n\n    // average restitution more realistic\n    const coefRestitution = Math.min(this.colliderA.bounciness, this.colliderB.bounciness);\n\n    const coefFriction = Math.min(this.colliderA.friction, this.colliderB.friction);\n\n    normal = normal.normalize();\n    const tangent = normal.normal().normalize();\n\n    const ra = this.point.sub(this.colliderA.center); // point relative to colliderA position\n    const rb = this.point.sub(this.colliderB.center); /// point relative to colliderB\n\n    // Relative velocity in linear terms\n    // Angular to linear velocity formula -> omega = v/r\n    const rv = bodyB.vel.add(rb.cross(-bodyB.rx)).sub(bodyA.vel.sub(ra.cross(bodyA.rx)));\n    const rvNormal = rv.dot(normal);\n    const rvTangent = rv.dot(tangent);\n\n    const raTangent = ra.dot(tangent);\n    const raNormal = ra.dot(normal);\n\n    const rbTangent = rb.dot(tangent);\n    const rbNormal = rb.dot(normal);\n\n    // If objects are moving away ignore\n    if (rvNormal > 0) {\n      return;\n    }\n\n    // Collision impulse formula from Chris Hecker\n    // https://en.wikipedia.org/wiki/Collision_response\n    const impulse =\n      -((1 + coefRestitution) * rvNormal) / (invMassA + invMassB + invMoiA * raTangent * raTangent + invMoiB * rbTangent * rbTangent);\n\n    if (this.colliderA.type === CollisionType.Fixed) {\n      bodyB.vel = bodyB.vel.add(normal.scale(impulse * invMassB));\n      if (Physics.allowRigidBodyRotation) {\n        bodyB.rx -= impulse * invMoiB * -rb.cross(normal);\n      }\n      bodyB.addMtv(mtv);\n    } else if (this.colliderB.type === CollisionType.Fixed) {\n      bodyA.vel = bodyA.vel.sub(normal.scale(impulse * invMassA));\n      if (Physics.allowRigidBodyRotation) {\n        bodyA.rx += impulse * invMoiA * -ra.cross(normal);\n      }\n      bodyA.addMtv(mtv.negate());\n    } else {\n      bodyB.vel = bodyB.vel.add(normal.scale(impulse * invMassB));\n      bodyA.vel = bodyA.vel.sub(normal.scale(impulse * invMassA));\n\n      if (Physics.allowRigidBodyRotation) {\n        bodyB.rx -= impulse * invMoiB * -rb.cross(normal);\n        bodyA.rx += impulse * invMoiA * -ra.cross(normal);\n      }\n\n      // Split the mtv in half for the two bodies, potentially we could do something smarter here\n      bodyB.addMtv(mtv.scale(0.5));\n      bodyA.addMtv(mtv.scale(-0.5));\n    }\n\n    // Friction portion of impulse\n    if (coefFriction && rvTangent) {\n      // Columb model of friction, formula for impulse due to friction from\n      // https://en.wikipedia.org/wiki/Collision_response\n\n      // tangent force exerted by body on another in contact\n      const t = rv.sub(normal.scale(rv.dot(normal))).normalize();\n\n      // impulse in the direction of tangent force\n      const jt = rv.dot(t) / (invMassA + invMassB + raNormal * raNormal * invMoiA + rbNormal * rbNormal * invMoiB);\n\n      let frictionImpulse = new Vector(0, 0);\n      if (Math.abs(jt) <= impulse * coefFriction) {\n        frictionImpulse = t.scale(jt).negate();\n      } else {\n        frictionImpulse = t.scale(-impulse * coefFriction);\n      }\n\n      if (this.colliderA.type === CollisionType.Fixed) {\n        // apply frictional impulse\n        bodyB.vel = bodyB.vel.add(frictionImpulse.scale(invMassB));\n        if (Physics.allowRigidBodyRotation) {\n          bodyB.rx += frictionImpulse.dot(t) * invMoiB * rb.cross(t);\n        }\n      } else if (this.colliderB.type === CollisionType.Fixed) {\n        // apply frictional impulse\n        bodyA.vel = bodyA.vel.sub(frictionImpulse.scale(invMassA));\n        if (Physics.allowRigidBodyRotation) {\n          bodyA.rx -= frictionImpulse.dot(t) * invMoiA * ra.cross(t);\n        }\n      } else {\n        // apply frictional impulse\n        bodyB.vel = bodyB.vel.add(frictionImpulse.scale(invMassB));\n        bodyA.vel = bodyA.vel.sub(frictionImpulse.scale(invMassA));\n\n        // apply frictional impulse\n        if (Physics.allowRigidBodyRotation) {\n          bodyB.rx += frictionImpulse.dot(t) * invMoiB * rb.cross(t);\n          bodyA.rx -= frictionImpulse.dot(t) * invMoiA * ra.cross(t);\n        }\n      }\n    }\n\n    this.colliderA.emit('postcollision', new PostCollisionEvent(this.colliderA, this.colliderB, side, this.mtv));\n    this.colliderB.emit(\n      'postcollision',\n      new PostCollisionEvent(this.colliderB, this.colliderA, Util.getOppositeSide(side), this.mtv.negate())\n    );\n  }\n}\n","import { Circle } from './Circle';\nimport { CollisionContact } from './CollisionContact';\nimport { ConvexPolygon } from './ConvexPolygon';\nimport { Edge } from './Edge';\n\nimport { Vector } from '../Algebra';\n\nexport const CollisionJumpTable = {\n  CollideCircleCircle(circleA: Circle, circleB: Circle): CollisionContact {\n    const radius = circleA.radius + circleB.radius;\n    const circleAPos = circleA.worldPos;\n    const circleBPos = circleB.worldPos;\n    if (circleAPos.distance(circleBPos) > radius) {\n      return null;\n    }\n\n    const axisOfCollision = circleBPos.sub(circleAPos).normalize();\n    const mvt = axisOfCollision.scale(radius - circleBPos.distance(circleAPos));\n\n    const pointOfCollision = circleA.getFurthestPoint(axisOfCollision);\n\n    return new CollisionContact(circleA.collider, circleB.collider, mvt, pointOfCollision, axisOfCollision);\n  },\n\n  CollideCirclePolygon(circle: Circle, polygon: ConvexPolygon): CollisionContact {\n    let minAxis = circle.testSeparatingAxisTheorem(polygon);\n    if (!minAxis) {\n      return null;\n    }\n\n    // make sure that the minAxis is pointing away from circle\n    const samedir = minAxis.dot(polygon.center.sub(circle.center));\n    minAxis = samedir < 0 ? minAxis.negate() : minAxis;\n\n    const verts: Vector[] = [];\n\n    const point1 = polygon.getFurthestPoint(minAxis.negate());\n    const point2 = circle.getFurthestPoint(minAxis); //.add(cc);\n    if (circle.contains(point1)) {\n      verts.push(point1);\n    }\n    if (polygon.contains(point2)) {\n      verts.push(point2);\n    }\n    if (verts.length === 0) {\n      return null;\n    }\n\n    return new CollisionContact(\n      circle.collider,\n      polygon.collider,\n      minAxis,\n      verts.length === 2 ? verts[0].average(verts[1]) : verts[0],\n      minAxis.normalize()\n    );\n  },\n\n  CollideCircleEdge(circle: Circle, edge: Edge): CollisionContact {\n    // center of the circle\n    const cc = circle.center;\n    // vector in the direction of the edge\n    const e = edge.end.sub(edge.begin);\n\n    // amount of overlap with the circle's center along the edge direction\n    const u = e.dot(edge.end.sub(cc));\n    const v = e.dot(cc.sub(edge.begin));\n\n    // Potential region A collision (circle is on the left side of the edge, before the beginning)\n    if (v <= 0) {\n      const da = edge.begin.sub(cc);\n      const dda = da.dot(da); // quick and dirty way of calc'n distance in r^2 terms saves some sqrts\n      // save some sqrts\n      if (dda > circle.radius * circle.radius) {\n        return null; // no collision\n      }\n      return new CollisionContact(\n        circle.collider,\n        edge.collider,\n        da.normalize().scale(circle.radius - Math.sqrt(dda)),\n        edge.begin,\n        da.normalize()\n      );\n    }\n\n    // Potential region B collision (circle is on the right side of the edge, after the end)\n    if (u <= 0) {\n      const db = edge.end.sub(cc);\n      const ddb = db.dot(db);\n      if (ddb > circle.radius * circle.radius) {\n        return null;\n      }\n      return new CollisionContact(\n        circle.collider,\n        edge.collider,\n        db.normalize().scale(circle.radius - Math.sqrt(ddb)),\n        edge.end,\n        db.normalize()\n      );\n    }\n\n    // Otherwise potential region AB collision (circle is in the middle of the edge between the beginning and end)\n    const den = e.dot(e);\n    const pointOnEdge = edge.begin\n      .scale(u)\n      .add(edge.end.scale(v))\n      .scale(1 / den);\n    const d = cc.sub(pointOnEdge);\n\n    const dd = d.dot(d);\n    if (dd > circle.radius * circle.radius) {\n      return null; // no collision\n    }\n\n    let n = e.perpendicular();\n    // flip correct direction\n    if (n.dot(cc.sub(edge.begin)) < 0) {\n      n.x = -n.x;\n      n.y = -n.y;\n    }\n\n    n = n.normalize();\n\n    const mvt = n.scale(Math.abs(circle.radius - Math.sqrt(dd)));\n    return new CollisionContact(circle.collider, edge.collider, mvt.negate(), pointOnEdge, n.negate());\n  },\n\n  CollideEdgeEdge(): CollisionContact {\n    // Edge-edge collision doesn't make sense\n    return null;\n  },\n\n  CollidePolygonEdge(polygon: ConvexPolygon, edge: Edge): CollisionContact {\n    // 3 cases:\n    // (1) Polygon lands on the full face\n    // (2) Polygon lands on the right point\n    // (3) Polygon lands on the left point\n\n    const e = edge.end.sub(edge.begin);\n    let edgeNormal = e.normal();\n\n    if (polygon.contains(edge.begin)) {\n      const { distance: mtv, face } = polygon.getClosestFace(edge.begin);\n      if (mtv) {\n        return new CollisionContact(polygon.collider, edge.collider, mtv.negate(), edge.begin.add(mtv.negate()), face.normal().negate());\n      }\n    }\n\n    if (polygon.contains(edge.end)) {\n      const { distance: mtv, face } = polygon.getClosestFace(edge.end);\n      if (mtv) {\n        return new CollisionContact(polygon.collider, edge.collider, mtv.negate(), edge.end.add(mtv.negate()), face.normal().negate());\n      }\n    }\n\n    const pc = polygon.center;\n    const ec = edge.center;\n    const dir = ec.sub(pc).normalize();\n\n    // build a temporary polygon from the edge to use SAT\n    const linePoly = new ConvexPolygon({\n      collider: edge.collider,\n      points: [edge.begin, edge.end, edge.end.add(dir.scale(30)), edge.begin.add(dir.scale(30))]\n    });\n\n    let minAxis = polygon.testSeparatingAxisTheorem(linePoly);\n\n    // no minAxis, no overlap, no collision\n    if (!minAxis) {\n      return null;\n    }\n\n    // flip the normal and axis to always have positive collisions\n    edgeNormal = edgeNormal.dot(dir) < 0 ? edgeNormal.negate() : edgeNormal;\n    minAxis = minAxis.dot(dir) < 0 ? minAxis.negate() : minAxis;\n\n    return new CollisionContact(polygon.collider, edge.collider, minAxis, polygon.getFurthestPoint(edgeNormal), edgeNormal);\n  },\n\n  CollidePolygonPolygon(polyA: ConvexPolygon, polyB: ConvexPolygon): CollisionContact {\n    // do a SAT test to find a min axis if it exists\n    let minAxis = polyA.testSeparatingAxisTheorem(polyB);\n\n    // no overlap, no collision return null\n    if (!minAxis) {\n      return null;\n    }\n\n    // make sure that minAxis is pointing from A -> B\n    const sameDir = minAxis.dot(polyB.center.sub(polyA.center));\n    minAxis = sameDir < 0 ? minAxis.negate() : minAxis;\n\n    // find rough point of collision\n    // todo this could be better\n    const verts: Vector[] = [];\n    const pointA = polyA.getFurthestPoint(minAxis);\n    const pointB = polyB.getFurthestPoint(minAxis.negate());\n\n    if (polyB.contains(pointA)) {\n      verts.push(pointA);\n    }\n\n    if (polyA.contains(pointB)) {\n      verts.push(pointB);\n    }\n    // no candidates, pick something\n    if (verts.length === 0) {\n      verts.push(pointB);\n    }\n\n    const contact = verts.length === 2 ? verts[0].add(verts[1]).scale(0.5) : verts[0];\n\n    return new CollisionContact(polyA.collider, polyB.collider, minAxis, contact, minAxis.normalize());\n  }\n};\n","import { Line, Vector, Ray } from '../Algebra';\nimport { ConvexPolygon } from './ConvexPolygon';\nimport { Edge } from './Edge';\nimport { Circle } from './Circle';\n\n/**\n * Finds the closes line between 2 line segments, were the magnitude of u, v are the lengths of each segment\n * L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n * L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n * @param p0 Point where L1 begins\n * @param u Direction and length of L1\n * @param q0 Point were L2 begins\n * @param v Direction and length of L2\n */\nexport function ClosestLine(p0: Vector, u: Vector, q0: Vector, v: Vector) {\n  // Distance between 2 lines http://geomalgorithms.com/a07-_distance.html\n\n  // w(s, t) = P(s) - Q(t)\n  // The w(s, t) that has the minimum distance we will say is w(sClosest, tClosest) = wClosest\n  //\n  // wClosest is the vector that is uniquely perpendicular to the 2 line directions u & v.\n  // wClosest = w0 + sClosest * u - tClosest * v, where w0 is p0 - q0\n  //\n  // The closest point between 2 lines then satisfies this pair of equations\n  // 1: u * wClosest = 0\n  // 2: v * wClosest = 0\n  //\n  // Substituting wClosest into the equations we get\n  //\n  // 1: (u * u) * sClosest - (u * v) tClosest = -u * w0\n  // 2: (v * u) * sClosest - (v * v) tClosest = -v * w0\n\n  // simplify w0\n  const w0 = p0.sub(q0);\n\n  // simplify (u * u);\n  const a = u.dot(u);\n  // simplify (u * v);\n  const b = u.dot(v);\n  // simplify (v * v)\n  const c = v.dot(v);\n  // simplify (u * w0)\n  const d = u.dot(w0);\n  // simplify (v * w0)\n  const e = v.dot(w0);\n\n  // denominator ac - b^2\n  const denom = a * c - b * b;\n  let sDenom = denom;\n  let tDenom = denom;\n  // if denom is 0 they are parallel, use any point from either as the start in this case p0\n  if (denom === 0 || denom <= 0.01) {\n    const tClosestParallel = d / b;\n    return new Line(p0, q0.add(v.scale(tClosestParallel)));\n  }\n\n  // Solve for sClosest for infinite line\n  let sClosest = b * e - c * d; // / denom;\n\n  // Solve for tClosest for infinite line\n  let tClosest = a * e - b * d; // / denom;\n\n  // Solve for segments candidate edges, if sClosest and tClosest are outside their segments\n  if (sClosest < 0) {\n    sClosest = 0;\n    tClosest = e;\n    tDenom = c;\n  } else if (sClosest > sDenom) {\n    sClosest = sDenom;\n    tClosest = e + b;\n    tDenom = c;\n  }\n\n  if (tClosest < 0) {\n    tClosest = 0;\n    if (-d < 0) {\n      sClosest = 0;\n    } else if (-d > a) {\n      sClosest = sDenom;\n    } else {\n      sClosest = -d;\n      sDenom = a;\n    }\n  } else if (tClosest > tDenom) {\n    tClosest = tDenom;\n    if (-d + b < 0) {\n      sClosest = 0;\n    } else if (-d + b > a) {\n      sClosest = sDenom;\n    } else {\n      sClosest = -d + b;\n      sDenom = a;\n    }\n  }\n  sClosest = Math.abs(sClosest) < 0.001 ? 0 : sClosest / sDenom;\n  tClosest = Math.abs(tClosest) < 0.001 ? 0 : tClosest / tDenom;\n\n  return new Line(p0.add(u.scale(sClosest)), q0.add(v.scale(tClosest)));\n}\n\nexport const ClosestLineJumpTable = {\n  PolygonPolygonClosestLine(polygonA: ConvexPolygon, polygonB: ConvexPolygon) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = polygonB.worldPos;\n    const otherDirection = otherWorldPos.sub(polygonA.worldPos);\n    const thisDirection = otherDirection.negate();\n\n    const rayTowardsOther = new Ray(polygonA.worldPos, otherDirection);\n    const rayTowardsThis = new Ray(otherWorldPos, thisDirection);\n\n    const thisPoint = polygonA.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n    const otherPoint = polygonB.rayCast(rayTowardsThis).add(rayTowardsThis.dir.scale(0.1));\n\n    const thisFace = polygonA.getClosestFace(thisPoint);\n    const otherFace = polygonB.getClosestFace(otherPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const q0 = otherFace.face.begin;\n    const v = otherFace.face.getEdge();\n\n    return ClosestLine(p0, u, q0, v);\n  },\n\n  PolygonEdgeClosestLine(polygon: ConvexPolygon, edge: Edge) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = edge.worldPos;\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\n\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection);\n\n    const thisPoint = polygon.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n\n    const thisFace = polygon.getClosestFace(thisPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const edgeLine = edge.asLine();\n    const edgeStart = edgeLine.begin;\n    const edgeVector = edgeLine.getEdge();\n    const q0 = edgeStart;\n    const v = edgeVector;\n\n    return ClosestLine(p0, u, q0, v);\n  },\n\n  PolygonCircleClosestLine(polygon: ConvexPolygon, circle: Circle) {\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = circle.worldPos;\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\n\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection.normalize());\n\n    const thisPoint = polygon.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n\n    const thisFace = polygon.getClosestFace(thisPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // Time of minimum distance\n    let t = (u.x * (otherWorldPos.x - p0.x) + u.y * (otherWorldPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\n\n    // If time of minimum is past the edge clamp\n    if (t > 1) {\n      t = 1;\n    } else if (t < 0) {\n      t = 0;\n    }\n\n    // Minimum distance\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - otherWorldPos.x, 2) + Math.pow(p0.y + u.y * t - otherWorldPos.y, 2)) - circle.radius;\n\n    const circlex = ((p0.x + u.x * t - otherWorldPos.x) * circle.radius) / (circle.radius + d);\n    const circley = ((p0.y + u.y * t - otherWorldPos.y) * circle.radius) / (circle.radius + d);\n    return new Line(u.scale(t).add(p0), new Vector(otherWorldPos.x + circlex, otherWorldPos.y + circley));\n  },\n\n  CircleCircleClosestLine(circleA: Circle, circleB: Circle) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = circleB.worldPos;\n    const otherDirection = otherWorldPos.sub(circleA.worldPos);\n\n    const thisWorldPos = circleA.worldPos;\n    const thisDirection = thisWorldPos.sub(circleB.worldPos);\n\n    const rayTowardsOther = new Ray(circleA.worldPos, otherDirection);\n    const rayTowardsThis = new Ray(circleB.worldPos, thisDirection);\n\n    const thisPoint = circleA.rayCast(rayTowardsOther);\n    const otherPoint = circleB.rayCast(rayTowardsThis);\n\n    return new Line(thisPoint, otherPoint);\n  },\n\n  CircleEdgeClosestLine(circle: Circle, edge: Edge) {\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\n    const circleWorlPos = circle.worldPos;\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const edgeLine = edge.asLine();\n    const edgeStart = edgeLine.begin;\n    const edgeVector = edgeLine.getEdge();\n    const p0 = edgeStart;\n    const u = edgeVector;\n\n    // Time of minimum distance\n    let t = (u.x * (circleWorlPos.x - p0.x) + u.y * (circleWorlPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\n\n    // If time of minimum is past the edge clamp to edge\n    if (t > 1) {\n      t = 1;\n    } else if (t < 0) {\n      t = 0;\n    }\n\n    // Minimum distance\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - circleWorlPos.x, 2) + Math.pow(p0.y + u.y * t - circleWorlPos.y, 2)) - circle.radius;\n\n    const circlex = ((p0.x + u.x * t - circleWorlPos.x) * circle.radius) / (circle.radius + d);\n    const circley = ((p0.y + u.y * t - circleWorlPos.y) * circle.radius) / (circle.radius + d);\n    return new Line(u.scale(t).add(p0), new Vector(circleWorlPos.x + circlex, circleWorlPos.y + circley));\n  },\n\n  EdgeEdgeClosestLine(edgeA: Edge, edgeB: Edge) {\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const edgeLineA = edgeA.asLine();\n    const edgeStartA = edgeLineA.begin;\n    const edgeVectorA = edgeLineA.getEdge();\n    const p0 = edgeStartA;\n    const u = edgeVectorA;\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const edgeLineB = edgeB.asLine();\n    const edgeStartB = edgeLineB.begin;\n    const edgeVectorB = edgeLineB.getEdge();\n    const q0 = edgeStartB;\n    const v = edgeVectorB;\n\n    return ClosestLine(p0, u, q0, v);\n  }\n};\n","import { BoundingBox } from './BoundingBox';\nimport { CollisionJumpTable } from './CollisionJumpTable';\nimport { CollisionContact } from './CollisionContact';\nimport { CollisionShape } from './CollisionShape';\nimport { ConvexPolygon } from './ConvexPolygon';\nimport { Edge } from './Edge';\n\nimport { Vector, Ray, Projection, Line } from '../Algebra';\nimport { Physics } from '../Physics';\nimport { Color } from '../Drawing/Color';\nimport { Collider } from './Collider';\n\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\n\nexport interface CircleOptions {\n  /**\n   * Optional pixel offset to shift the circle relative to the collider, by default (0, 0).\n   */\n  offset?: Vector;\n  /**\n   * Required radius of the circle\n   */\n  radius: number;\n  /**\n   * Optional collider to associate with this shape\n   */\n  collider?: Collider;\n}\n\n/**\n * This is a circle collision shape for the excalibur rigid body physics simulation\n */\nexport class Circle implements CollisionShape {\n  /**\n   * Position of the circle relative to the collider, by default (0, 0) meaning the shape is positioned on top of the collider.\n   */\n  public offset: Vector = Vector.Zero;\n\n  public get worldPos(): Vector {\n    if (this.collider && this.collider.body) {\n      return this.collider.body.pos.add(this.offset);\n    }\n    return this.offset;\n  }\n\n  /**\n   * This is the radius of the circle\n   */\n  public radius: number;\n\n  /**\n   * The collider associated for this shape, if any.\n   */\n  public collider?: Collider;\n\n  constructor(options: CircleOptions) {\n    this.offset = options.offset || Vector.Zero;\n    this.radius = options.radius || 0;\n    this.collider = options.collider || null;\n  }\n\n  /**\n   * Returns a clone of this shape, not associated with any collider\n   */\n  public clone(): Circle {\n    return new Circle({\n      offset: this.offset.clone(),\n      radius: this.radius,\n      collider: null\n    });\n  }\n\n  /**\n   * Get the center of the collision shape in world coordinates\n   */\n  public get center(): Vector {\n    if (this.collider && this.collider.body) {\n      return this.offset.add(this.collider.body.pos);\n    }\n    return this.offset;\n  }\n\n  /**\n   * Tests if a point is contained in this collision shape\n   */\n  public contains(point: Vector): boolean {\n    let pos = this.offset;\n    if (this.collider && this.collider.body) {\n      pos = this.collider.body.pos;\n    }\n    const distance = pos.distance(point);\n    if (distance <= this.radius) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Casts a ray at the Circle shape and returns the nearest point of collision\n   * @param ray\n   */\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\n    //https://en.wikipedia.org/wiki/Line%E2%80%93sphere_intersection\n    const c = this.center;\n    const dir = ray.dir;\n    const orig = ray.pos;\n\n    const discriminant = Math.sqrt(Math.pow(dir.dot(orig.sub(c)), 2) - Math.pow(orig.sub(c).distance(), 2) + Math.pow(this.radius, 2));\n\n    if (discriminant < 0) {\n      // no intersection\n      return null;\n    } else {\n      let toi = 0;\n      if (discriminant === 0) {\n        toi = -dir.dot(orig.sub(c));\n        if (toi > 0 && toi < max) {\n          return ray.getPoint(toi);\n        }\n        return null;\n      } else {\n        const toi1 = -dir.dot(orig.sub(c)) + discriminant;\n        const toi2 = -dir.dot(orig.sub(c)) - discriminant;\n\n        const positiveToi: number[] = [];\n        if (toi1 >= 0) {\n          positiveToi.push(toi1);\n        }\n\n        if (toi2 >= 0) {\n          positiveToi.push(toi2);\n        }\n\n        const mintoi = Math.min(...positiveToi);\n        if (mintoi <= max) {\n          return ray.getPoint(mintoi);\n        }\n        return null;\n      }\n    }\n  }\n\n  public getClosestLineBetween(shape: CollisionShape): Line {\n    if (shape instanceof Circle) {\n      return ClosestLineJumpTable.CircleCircleClosestLine(this, shape);\n    } else if (shape instanceof ConvexPolygon) {\n      return ClosestLineJumpTable.PolygonCircleClosestLine(shape, this).flip();\n    } else if (shape instanceof Edge) {\n      return ClosestLineJumpTable.CircleEdgeClosestLine(this, shape).flip();\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public collide(shape: CollisionShape): CollisionContact {\n    if (shape instanceof Circle) {\n      return CollisionJumpTable.CollideCircleCircle(this, shape);\n    } else if (shape instanceof ConvexPolygon) {\n      return CollisionJumpTable.CollideCirclePolygon(this, shape);\n    } else if (shape instanceof Edge) {\n      return CollisionJumpTable.CollideCircleEdge(this, shape);\n    } else {\n      throw new Error(`Circle could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * Find the point on the shape furthest in the direction specified\n   */\n  public getFurthestPoint(direction: Vector): Vector {\n    return this.center.add(direction.normalize().scale(this.radius));\n  }\n\n  /**\n   * Get the axis aligned bounding box for the circle shape in world coordinates\n   */\n  public get bounds(): BoundingBox {\n    let bodyPos = Vector.Zero;\n    if (this.collider && this.collider.body) {\n      bodyPos = this.collider.body.pos;\n    }\n    return new BoundingBox(\n      this.offset.x + bodyPos.x - this.radius,\n      this.offset.y + bodyPos.y - this.radius,\n      this.offset.x + bodyPos.x + this.radius,\n      this.offset.y + bodyPos.y + this.radius\n    );\n  }\n\n  /**\n   * Get the axis aligned bounding box for the circle shape in local coordinates\n   */\n  public get localBounds(): BoundingBox {\n    return new BoundingBox(\n      this.offset.x - this.radius,\n      this.offset.y - this.radius,\n      this.offset.x + this.radius,\n      this.offset.y + this.radius\n    );\n  }\n\n  /**\n   * Get axis not implemented on circles, since there are infinite axis in a circle\n   */\n  public get axes(): Vector[] {\n    return null;\n  }\n\n  /**\n   * Returns the moment of inertia of a circle given it's mass\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n   */\n  public get inertia(): number {\n    const mass = this.collider ? this.collider.mass : Physics.defaultMass;\n    return (mass * this.radius * this.radius) / 2;\n  }\n\n  /**\n   * Tests the separating axis theorem for circles against polygons\n   */\n  public testSeparatingAxisTheorem(polygon: ConvexPolygon): Vector {\n    const axes = polygon.axes;\n    const pc = polygon.center;\n    // Special SAT with circles\n    const closestPointOnPoly = polygon.getFurthestPoint(this.offset.sub(pc));\n    axes.push(this.offset.sub(closestPointOnPoly).normalize());\n\n    let minOverlap = Number.MAX_VALUE;\n    let minAxis = null;\n    let minIndex = -1;\n    for (let i = 0; i < axes.length; i++) {\n      const proj1 = polygon.project(axes[i]);\n      const proj2 = this.project(axes[i]);\n      const overlap = proj1.getOverlap(proj2);\n      if (overlap <= 0) {\n        return null;\n      } else {\n        if (overlap < minOverlap) {\n          minOverlap = overlap;\n          minAxis = axes[i];\n          minIndex = i;\n        }\n      }\n    }\n    if (minIndex < 0) {\n      return null;\n    }\n    return minAxis.normalize().scale(minOverlap);\n  }\n\n  /* istanbul ignore next */\n  public recalc(): void {\n    // circles don't cache\n  }\n\n  /**\n   * Project the circle along a specified axis\n   */\n  public project(axis: Vector): Projection {\n    const scalars = [];\n    const point = this.center;\n    const dotProduct = point.dot(axis);\n    scalars.push(dotProduct);\n    scalars.push(dotProduct + this.radius);\n    scalars.push(dotProduct - this.radius);\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\n    const newPos = pos.add(this.offset);\n    ctx.beginPath();\n    ctx.fillStyle = color.toString();\n    ctx.arc(newPos.x, newPos.y, this.radius, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Green) {\n    const body = this.collider.body;\n    const pos = body ? body.pos.add(this.offset) : this.offset;\n    const rotation = body ? body.rotation : 0;\n\n    ctx.beginPath();\n    ctx.strokeStyle = color.toString();\n    ctx.arc(pos.x, pos.y, this.radius, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.stroke();\n    ctx.beginPath();\n    ctx.moveTo(pos.x, pos.y);\n    ctx.lineTo(Math.cos(rotation) * this.radius + pos.x, Math.sin(rotation) * this.radius + pos.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n}\n","import { Body } from './Body';\nimport { BoundingBox } from './BoundingBox';\nimport { CollisionContact } from './CollisionContact';\nimport { CollisionJumpTable } from './CollisionJumpTable';\nimport { CollisionShape } from './CollisionShape';\nimport { Circle } from './Circle';\nimport { ConvexPolygon } from './ConvexPolygon';\n\nimport { Vector, Ray, Projection, Line } from '../Algebra';\nimport { Physics } from '../Physics';\nimport { Color } from '../Drawing/Color';\nimport { Collider } from './Collider';\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\n\nexport interface EdgeOptions {\n  /**\n   * The beginning of the edge defined in local coordinates to the collider\n   */\n  begin: Vector;\n  /**\n   * The ending of the edge defined in local coordinates to the collider\n   */\n  end: Vector;\n  /**\n   * Optionally the collider associated with this edge\n   */\n  collider?: Collider;\n}\n\n/**\n * Edge is a single line collision shape to create collisions with a single line.\n */\nexport class Edge implements CollisionShape {\n  body: Body;\n  collider?: Collider;\n  offset: Vector;\n  begin: Vector;\n  end: Vector;\n\n  constructor(options: EdgeOptions) {\n    this.begin = options.begin || Vector.Zero;\n    this.end = options.end || Vector.Zero;\n    this.collider = options.collider || null;\n    this.offset = this.center;\n  }\n\n  /**\n   * Returns a clone of this Edge, not associated with any collider\n   */\n  public clone(): Edge {\n    return new Edge({\n      begin: this.begin.clone(),\n      end: this.end.clone(),\n      collider: null\n    });\n  }\n\n  public get worldPos(): Vector {\n    if (this.collider && this.collider.body) {\n      return this.collider.body.pos.add(this.offset);\n    }\n    return this.offset;\n  }\n\n  /**\n   * Get the center of the collision area in world coordinates\n   */\n  public get center(): Vector {\n    const pos = this.begin.average(this.end).add(this._getBodyPos());\n    return pos;\n  }\n\n  private _getBodyPos(): Vector {\n    let bodyPos = Vector.Zero;\n    if (this.collider && this.collider.body) {\n      bodyPos = this.collider.body.pos;\n    }\n    return bodyPos;\n  }\n\n  private _getTransformedBegin(): Vector {\n    const body = this.collider ? this.collider.body : null;\n    const angle = body ? body.rotation : 0;\n    return this.begin.rotate(angle).add(this._getBodyPos());\n  }\n\n  private _getTransformedEnd(): Vector {\n    const body = this.collider ? this.collider.body : null;\n    const angle = body ? body.rotation : 0;\n    return this.end.rotate(angle).add(this._getBodyPos());\n  }\n\n  /**\n   * Returns the slope of the line in the form of a vector\n   */\n  public getSlope(): Vector {\n    const begin = this._getTransformedBegin();\n    const end = this._getTransformedEnd();\n    const distance = begin.distance(end);\n    return end.sub(begin).scale(1 / distance);\n  }\n\n  /**\n   * Returns the length of the line segment in pixels\n   */\n  public getLength(): number {\n    const begin = this._getTransformedBegin();\n    const end = this._getTransformedEnd();\n    const distance = begin.distance(end);\n    return distance;\n  }\n\n  /**\n   * Tests if a point is contained in this collision area\n   */\n  public contains(): boolean {\n    return false;\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\n    const numerator = this._getTransformedBegin().sub(ray.pos);\n\n    // Test is line and ray are parallel and non intersecting\n    if (ray.dir.cross(this.getSlope()) === 0 && numerator.cross(ray.dir) !== 0) {\n      return null;\n    }\n\n    // Lines are parallel\n    const divisor = ray.dir.cross(this.getSlope());\n    if (divisor === 0) {\n      return null;\n    }\n\n    const t = numerator.cross(this.getSlope()) / divisor;\n\n    if (t >= 0 && t <= max) {\n      const u = numerator.cross(ray.dir) / divisor / this.getLength();\n      if (u >= 0 && u <= 1) {\n        return ray.getPoint(t);\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Returns the closes line between this and another shape, from this -> shape\n   * @param shape\n   */\n  public getClosestLineBetween(shape: CollisionShape): Line {\n    if (shape instanceof Circle) {\n      return ClosestLineJumpTable.CircleEdgeClosestLine(shape, this);\n    } else if (shape instanceof ConvexPolygon) {\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(shape, this).flip();\n    } else if (shape instanceof Edge) {\n      return ClosestLineJumpTable.EdgeEdgeClosestLine(this, shape);\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public collide(shape: CollisionShape): CollisionContact {\n    if (shape instanceof Circle) {\n      return CollisionJumpTable.CollideCircleEdge(shape, this);\n    } else if (shape instanceof ConvexPolygon) {\n      return CollisionJumpTable.CollidePolygonEdge(shape, this);\n    } else if (shape instanceof Edge) {\n      return CollisionJumpTable.CollideEdgeEdge();\n    } else {\n      throw new Error(`Edge could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * Find the point on the shape furthest in the direction specified\n   */\n  public getFurthestPoint(direction: Vector): Vector {\n    const transformedBegin = this._getTransformedBegin();\n    const transformedEnd = this._getTransformedEnd();\n    if (direction.dot(transformedBegin) > 0) {\n      return transformedBegin;\n    } else {\n      return transformedEnd;\n    }\n  }\n\n  private _boundsFromBeginEnd(begin: Vector, end: Vector) {\n    return new BoundingBox(Math.min(begin.x, end.x), Math.min(begin.y, end.y), Math.max(begin.x, end.x), Math.max(begin.y, end.y));\n  }\n\n  /**\n   * Get the axis aligned bounding box for the edge shape in world space\n   */\n  public get bounds(): BoundingBox {\n    const transformedBegin = this._getTransformedBegin();\n    const transformedEnd = this._getTransformedEnd();\n    return this._boundsFromBeginEnd(transformedBegin, transformedEnd);\n  }\n\n  /**\n   * Get the axis aligned bounding box for the edge shape in local space\n   */\n  public get localBounds(): BoundingBox {\n    return this._boundsFromBeginEnd(this.begin, this.end);\n  }\n\n  /**\n   * Returns this edge represented as a line in world coordinates\n   */\n  public asLine(): Line {\n    return new Line(this._getTransformedBegin(), this._getTransformedEnd());\n  }\n\n  public asLocalLine(): Line {\n    return new Line(this.begin, this.end);\n  }\n\n  /**\n   * Get the axis associated with the edge\n   */\n  public get axes(): Vector[] {\n    const e = this._getTransformedEnd().sub(this._getTransformedBegin());\n    const edgeNormal = e.normal();\n\n    const axes = [];\n    axes.push(edgeNormal);\n    axes.push(edgeNormal.negate());\n    axes.push(edgeNormal.normal());\n    axes.push(edgeNormal.normal().negate());\n    return axes;\n  }\n\n  /**\n   * Get the moment of inertia for an edge\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n   */\n  public get inertia(): number {\n    const mass = this.collider ? this.collider.mass : Physics.defaultMass;\n    const length = this.end.sub(this.begin).distance() / 2;\n    return mass * length * length;\n  }\n\n  /**\n   * @inheritdoc\n   */\n  public recalc(): void {\n    // edges don't have any cached data\n  }\n\n  /**\n   * Project the edge along a specified axis\n   */\n  public project(axis: Vector): Projection {\n    const scalars = [];\n\n    const points = [this._getTransformedBegin(), this._getTransformedEnd()];\n    const len = points.length;\n    for (let i = 0; i < len; i++) {\n      scalars.push(points[i].dot(axis));\n    }\n\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\n    const begin = this.begin.add(pos);\n    const end = this.end.add(pos);\n    ctx.strokeStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(begin.x, begin.y);\n    ctx.lineTo(end.x, end.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Red) {\n    const begin = this._getTransformedBegin();\n    const end = this._getTransformedEnd();\n    ctx.strokeStyle = color.toString();\n    ctx.beginPath();\n    ctx.moveTo(begin.x, begin.y);\n    ctx.lineTo(end.x, end.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n}\n","import { Color } from '../Drawing/Color';\nimport { Physics } from '../Physics';\nimport { BoundingBox } from './BoundingBox';\nimport { Edge } from './Edge';\nimport { CollisionJumpTable } from './CollisionJumpTable';\nimport { Circle } from './Circle';\nimport { CollisionContact } from './CollisionContact';\nimport { CollisionShape } from './CollisionShape';\nimport { Vector, Line, Ray, Projection } from '../Algebra';\nimport { Collider } from './Collider';\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\n\nexport interface ConvexPolygonOptions {\n  /**\n   * Pixel offset relative to a collider's position\n   */\n\n  offset?: Vector;\n  /**\n   * Points in the polygon in order around the perimeter in local coordinates\n   */\n  points: Vector[];\n  /**\n   * Whether points are specified in clockwise or counter clockwise order, default counter-clockwise\n   */\n  clockwiseWinding?: boolean;\n  /**\n   * Collider to associate optionally with this shape\n   */\n  collider?: Collider;\n}\n\n/**\n * Polygon collision shape for detecting collisions\n */\nexport class ConvexPolygon implements CollisionShape {\n  public offset: Vector;\n  public points: Vector[];\n\n  /**\n   * Collider associated with this shape\n   */\n  public collider?: Collider;\n\n  private _transformedPoints: Vector[] = [];\n  private _axes: Vector[] = [];\n  private _sides: Line[] = [];\n\n  constructor(options: ConvexPolygonOptions) {\n    this.offset = options.offset || Vector.Zero;\n    const winding = !!options.clockwiseWinding;\n    this.points = (winding ? options.points.reverse() : options.points) || [];\n    this.collider = this.collider = options.collider || null;\n\n    // calculate initial transformation\n    this._calculateTransformation();\n  }\n\n  /**\n   * Returns a clone of this ConvexPolygon, not associated with any collider\n   */\n  public clone(): ConvexPolygon {\n    return new ConvexPolygon({\n      offset: this.offset.clone(),\n      points: this.points.map((p) => p.clone()),\n      collider: null\n    });\n  }\n\n  public get worldPos(): Vector {\n    if (this.collider && this.collider.body) {\n      return this.collider.body.pos.add(this.offset);\n    }\n    return this.offset;\n  }\n\n  /**\n   * Get the center of the collision shape in world coordinates\n   */\n  public get center(): Vector {\n    const body = this.collider ? this.collider.body : null;\n    if (body) {\n      return body.pos.add(this.offset);\n    }\n    return this.offset;\n  }\n\n  /**\n   * Calculates the underlying transformation from the body relative space to world space\n   */\n  private _calculateTransformation() {\n    const body = this.collider ? this.collider.body : null;\n    const pos = body ? body.pos.add(this.offset) : this.offset;\n    const angle = body ? body.rotation : 0;\n    const scale = body ? body.scale : Vector.One;\n\n    const len = this.points.length;\n    this._transformedPoints.length = 0; // clear out old transform\n    for (let i = 0; i < len; i++) {\n      this._transformedPoints[i] = this.points[i].scale(scale).rotate(angle).add(pos);\n    }\n  }\n\n  /**\n   * Gets the points that make up the polygon in world space, from actor relative space (if specified)\n   */\n  public getTransformedPoints(): Vector[] {\n    // only recalculate geometry if, hasn't been calculated\n    if (\n      !this._transformedPoints.length ||\n      // or the position or rotation has changed in world space\n      (this.collider &&\n        this.collider.body &&\n        (!this.collider.body.oldPos.equals(this.collider.body.pos) ||\n          this.collider.body.oldRotation !== this.collider.body.rotation ||\n          this.collider.body.oldScale !== this.collider.body.scale))\n    ) {\n      this._calculateTransformation();\n    }\n    return this._transformedPoints;\n  }\n\n  /**\n   * Gets the sides of the polygon in world space\n   */\n  public getSides(): Line[] {\n    if (this._sides.length) {\n      return this._sides;\n    }\n    const lines = [];\n    const points = this.getTransformedPoints();\n    const len = points.length;\n    for (let i = 0; i < len; i++) {\n      lines.push(new Line(points[i], points[(i - 1 + len) % len]));\n    }\n    this._sides = lines;\n    return this._sides;\n  }\n\n  public recalc(): void {\n    this._sides.length = 0;\n    this._axes.length = 0;\n    this._transformedPoints.length = 0;\n    this.getTransformedPoints();\n    this.getSides();\n  }\n\n  /**\n   * Tests if a point is contained in this collision shape in world space\n   */\n  public contains(point: Vector): boolean {\n    // Always cast to the right, as long as we cast in a consistent fixed direction we\n    // will be fine\n    const testRay = new Ray(point, new Vector(1, 0));\n    const intersectCount = this.getSides().reduce(function (accum, side) {\n      if (testRay.intersect(side) >= 0) {\n        return accum + 1;\n      }\n      return accum;\n    }, 0);\n\n    if (intersectCount % 2 === 0) {\n      return false;\n    }\n    return true;\n  }\n\n  public getClosestLineBetween(shape: CollisionShape): Line {\n    if (shape instanceof Circle) {\n      return ClosestLineJumpTable.PolygonCircleClosestLine(this, shape);\n    } else if (shape instanceof ConvexPolygon) {\n      return ClosestLineJumpTable.PolygonPolygonClosestLine(this, shape);\n    } else if (shape instanceof Edge) {\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(this, shape);\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * Returns a collision contact if the 2 collision shapes collide, otherwise collide will\n   * return null.\n   * @param shape\n   */\n  public collide(shape: CollisionShape): CollisionContact {\n    if (shape instanceof Circle) {\n      return CollisionJumpTable.CollideCirclePolygon(shape, this);\n    } else if (shape instanceof ConvexPolygon) {\n      return CollisionJumpTable.CollidePolygonPolygon(this, shape);\n    } else if (shape instanceof Edge) {\n      return CollisionJumpTable.CollidePolygonEdge(this, shape);\n    } else {\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\n    }\n  }\n\n  /**\n   * Find the point on the shape furthest in the direction specified\n   */\n  public getFurthestPoint(direction: Vector): Vector {\n    const pts = this.getTransformedPoints();\n    let furthestPoint = null;\n    let maxDistance = -Number.MAX_VALUE;\n    for (let i = 0; i < pts.length; i++) {\n      const distance = direction.dot(pts[i]);\n      if (distance > maxDistance) {\n        maxDistance = distance;\n        furthestPoint = pts[i];\n      }\n    }\n    return furthestPoint;\n  }\n\n  /**\n   * Finds the closes face to the point using perpendicular distance\n   * @param point point to test against polygon\n   */\n  public getClosestFace(point: Vector): { distance: Vector; face: Line } {\n    const sides = this.getSides();\n    let min = Number.POSITIVE_INFINITY;\n    let faceIndex = -1;\n    let distance = -1;\n    for (let i = 0; i < sides.length; i++) {\n      const dist = sides[i].distanceToPoint(point);\n      if (dist < min) {\n        min = dist;\n        faceIndex = i;\n        distance = dist;\n      }\n    }\n\n    if (faceIndex !== -1) {\n      return {\n        distance: sides[faceIndex].normal().scale(distance),\n        face: sides[faceIndex]\n      };\n    }\n\n    return null;\n  }\n\n  /**\n   * Get the axis aligned bounding box for the polygon shape in world coordinates\n   */\n  public get bounds(): BoundingBox {\n    const points = this.getTransformedPoints();\n\n    return BoundingBox.fromPoints(points);\n  }\n\n  /**\n   * Get the axis aligned bounding box for the polygon shape in local coordinates\n   */\n  public get localBounds(): BoundingBox {\n    return BoundingBox.fromPoints(this.points);\n  }\n\n  /**\n   * Get the moment of inertia for an arbitrary polygon\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\n   */\n  public get inertia(): number {\n    const mass = this.collider ? this.collider.mass : Physics.defaultMass;\n    let numerator = 0;\n    let denominator = 0;\n    for (let i = 0; i < this.points.length; i++) {\n      const iplusone = (i + 1) % this.points.length;\n      const crossTerm = this.points[iplusone].cross(this.points[i]);\n      numerator +=\n        crossTerm *\n        (this.points[i].dot(this.points[i]) + this.points[i].dot(this.points[iplusone]) + this.points[iplusone].dot(this.points[iplusone]));\n      denominator += crossTerm;\n    }\n    return (mass / 6) * (numerator / denominator);\n  }\n\n  /**\n   * Casts a ray into the polygon and returns a vector representing the point of contact (in world space) or null if no collision.\n   */\n  public rayCast(ray: Ray, max: number = Infinity) {\n    // find the minimum contact time greater than 0\n    // contact times less than 0 are behind the ray and we don't want those\n    const sides = this.getSides();\n    const len = sides.length;\n    let minContactTime = Number.MAX_VALUE;\n    let contactIndex = -1;\n    for (let i = 0; i < len; i++) {\n      const contactTime = ray.intersect(sides[i]);\n      if (contactTime >= 0 && contactTime < minContactTime && contactTime <= max) {\n        minContactTime = contactTime;\n        contactIndex = i;\n      }\n    }\n\n    // contact was found\n    if (contactIndex >= 0) {\n      return ray.getPoint(minContactTime);\n    }\n\n    // no contact found\n    return null;\n  }\n\n  /**\n   * Get the axis associated with the convex polygon\n   */\n  public get axes(): Vector[] {\n    if (this._axes.length) {\n      return this._axes;\n    }\n\n    const axes = [];\n    const points = this.getTransformedPoints();\n    const len = points.length;\n    for (let i = 0; i < len; i++) {\n      axes.push(points[i].sub(points[(i + 1) % len]).normal());\n    }\n    this._axes = axes;\n    return this._axes;\n  }\n\n  /**\n   * Perform Separating Axis test against another polygon, returns null if no overlap in polys\n   * Reference http://www.dyn4j.org/2010/01/sat/\n   */\n  public testSeparatingAxisTheorem(other: ConvexPolygon): Vector {\n    const poly1 = this;\n    const poly2 = other;\n    const axes = poly1.axes.concat(poly2.axes);\n\n    let minOverlap = Number.MAX_VALUE;\n    let minAxis = null;\n    let minIndex = -1;\n    for (let i = 0; i < axes.length; i++) {\n      const proj1 = poly1.project(axes[i]);\n      const proj2 = poly2.project(axes[i]);\n      const overlap = proj1.getOverlap(proj2);\n      if (overlap <= 0) {\n        return null;\n      } else {\n        if (overlap < minOverlap) {\n          minOverlap = overlap;\n          minAxis = axes[i];\n          minIndex = i;\n        }\n      }\n    }\n\n    // Sanity check\n    if (minIndex === -1) {\n      return null;\n    }\n\n    return minAxis.normalize().scale(minOverlap);\n  }\n\n  /**\n   * Project the edges of the polygon along a specified axis\n   */\n  public project(axis: Vector): Projection {\n    const points = this.getTransformedPoints();\n    const len = points.length;\n    let min = Number.MAX_VALUE;\n    let max = -Number.MAX_VALUE;\n    for (let i = 0; i < len; i++) {\n      const scalar = points[i].dot(axis);\n      min = Math.min(min, scalar);\n      max = Math.max(max, scalar);\n    }\n\n    return new Projection(min, max);\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\n    const basePos = pos.add(this.offset);\n    ctx.beginPath();\n    ctx.fillStyle = color.toString();\n    ctx.moveTo(basePos.x, basePos.y);\n    const diffToBase = this.points[0].sub(basePos);\n    this.points\n      .map((p) => p.sub(diffToBase))\n      .forEach(function (point) {\n        ctx.lineTo(point.x, point.y);\n      });\n    ctx.lineTo(basePos.x, basePos.y);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Red) {\n    ctx.beginPath();\n    ctx.strokeStyle = color.toString();\n    // Iterate through the supplied points and construct a 'polygon'\n    const firstPoint = this.getTransformedPoints()[0];\n    ctx.moveTo(firstPoint.x, firstPoint.y);\n    this.getTransformedPoints().forEach(function (point) {\n      ctx.lineTo(point.x, point.y);\n    });\n    ctx.lineTo(firstPoint.x, firstPoint.y);\n    ctx.closePath();\n    ctx.stroke();\n  }\n}\n","import { ConvexPolygon } from './ConvexPolygon';\n\nimport { Actor } from '../Actor';\nimport { Vector, Ray } from '../Algebra';\nimport { Color } from '../Drawing/Color';\nimport { Side } from './Side';\n\nexport interface BoundingBoxOptions {\n  left: number;\n  right: number;\n  top: number;\n  bottom: number;\n}\n\n/**\n * Axis Aligned collision primitive for Excalibur.\n */\nexport class BoundingBox {\n  public top: number;\n  public right: number;\n  public bottom: number;\n  public left: number;\n\n  /**\n   * Constructor allows passing of either an object with all coordinate components,\n   * or the coordinate components passed separately.\n   * @param leftOrOptions    Either x coordinate of the left edge or an options object\n   * containing the four coordinate components.\n   * @param top     y coordinate of the top edge\n   * @param right   x coordinate of the right edge\n   * @param bottom  y coordinate of the bottom edge\n   */\n  constructor(leftOrOptions: number | BoundingBoxOptions = 0, top: number = 0, right: number = 0, bottom: number = 0) {\n    if (typeof leftOrOptions === 'object') {\n      this.left = leftOrOptions.left;\n      this.top = leftOrOptions.top;\n      this.right = leftOrOptions.right;\n      this.bottom = leftOrOptions.bottom;\n    } else if (typeof leftOrOptions === 'number') {\n      this.left = leftOrOptions;\n      this.top = top;\n      this.right = right;\n      this.bottom = bottom;\n    }\n  }\n\n  /**\n   * Given bounding box A & B, returns the side relative to A when intersection is performed.\n   * @param intersection Intersection vector between 2 bounding boxes\n   */\n  public static getSideFromIntersection(intersection: Vector): Side {\n    if (!intersection) {\n      return Side.None;\n    }\n    if (intersection) {\n      if (Math.abs(intersection.x) > Math.abs(intersection.y)) {\n        if (intersection.x < 0) {\n          return Side.Right;\n        }\n        return Side.Left;\n      } else {\n        if (intersection.y < 0) {\n          return Side.Bottom;\n        }\n        return Side.Top;\n      }\n    }\n    return Side.None;\n  }\n\n  public static fromPoints(points: Vector[]): BoundingBox {\n    let minX = Infinity;\n    let minY = Infinity;\n    let maxX = -Infinity;\n    let maxY = -Infinity;\n    for (let i = 0; i < points.length; i++) {\n      if (points[i].x < minX) {\n        minX = points[i].x;\n      }\n      if (points[i].x > maxX) {\n        maxX = points[i].x;\n      }\n      if (points[i].y < minY) {\n        minY = points[i].y;\n      }\n      if (points[i].y > maxY) {\n        maxY = points[i].y;\n      }\n    }\n    return new BoundingBox(minX, minY, maxX, maxY);\n  }\n\n  public static fromDimension(width: number, height: number, anchor: Vector = Vector.Half, pos: Vector = Vector.Zero) {\n    return new BoundingBox(\n      -width * anchor.x + pos.x,\n      -height * anchor.y + pos.y,\n      width - width * anchor.x + pos.x,\n      height - height * anchor.y + pos.y\n    );\n  }\n\n  /**\n   * Returns the calculated width of the bounding box\n   */\n  public get width() {\n    return this.right - this.left;\n  }\n\n  /**\n   * Returns the calculated height of the bounding box\n   */\n  public get height() {\n    return this.bottom - this.top;\n  }\n\n  /**\n   * Returns the center of the bounding box\n   */\n  public get center(): Vector {\n    return new Vector((this.left + this.right) / 2, (this.top + this.bottom) / 2);\n  }\n\n  public translate(pos: Vector): BoundingBox {\n    return new BoundingBox(this.left + pos.x, this.top + pos.y, this.right + pos.x, this.bottom + pos.y);\n  }\n\n  /**\n   * Rotates a bounding box by and angle and around a point, if no point is specified (0, 0) is used by default. The resulting bounding\n   * box is also axis-align. This is useful when a new axis-aligned bounding box is needed for rotated geometry.\n   */\n  public rotate(angle: number, point: Vector = Vector.Zero): BoundingBox {\n    const points = this.getPoints().map((p) => p.rotate(angle, point));\n    return BoundingBox.fromPoints(points);\n  }\n\n  public scale(scale: Vector, point: Vector = Vector.Zero): BoundingBox {\n    const shifted = this.translate(point);\n    return new BoundingBox(shifted.left * scale.x, shifted.top * scale.y, shifted.right * scale.x, shifted.bottom * scale.y);\n  }\n\n  /**\n   * Returns the perimeter of the bounding box\n   */\n  public getPerimeter(): number {\n    const wx = this.width;\n    const wy = this.height;\n    return 2 * (wx + wy);\n  }\n\n  public getPoints(): Vector[] {\n    const results = [];\n    results.push(new Vector(this.left, this.top));\n    results.push(new Vector(this.right, this.top));\n    results.push(new Vector(this.right, this.bottom));\n    results.push(new Vector(this.left, this.bottom));\n    return results;\n  }\n\n  /**\n   * Creates a Polygon collision area from the points of the bounding box\n   */\n  public toPolygon(actor?: Actor): ConvexPolygon {\n    let maybeCollider = null;\n    if (actor && actor.body && actor.body.collider) {\n      maybeCollider = actor.body.collider;\n    }\n    return new ConvexPolygon({\n      collider: maybeCollider,\n      points: this.getPoints(),\n      offset: Vector.Zero\n    });\n  }\n\n  /**\n   * Determines whether a ray intersects with a bounding box\n   */\n  public rayCast(ray: Ray, farClipDistance = Infinity): boolean {\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\n    let tmin = -Infinity;\n    let tmax = +Infinity;\n\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\n\n    const tx1 = (this.left - ray.pos.x) * xinv;\n    const tx2 = (this.right - ray.pos.x) * xinv;\n    tmin = Math.min(tx1, tx2);\n    tmax = Math.max(tx1, tx2);\n\n    const ty1 = (this.top - ray.pos.y) * yinv;\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\n\n    return tmax >= Math.max(0, tmin) && tmin < farClipDistance;\n  }\n\n  public rayCastTime(ray: Ray, farClipDistance = Infinity): number {\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\n    let tmin = -Infinity;\n    let tmax = +Infinity;\n\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\n\n    const tx1 = (this.left - ray.pos.x) * xinv;\n    const tx2 = (this.right - ray.pos.x) * xinv;\n    tmin = Math.min(tx1, tx2);\n    tmax = Math.max(tx1, tx2);\n\n    const ty1 = (this.top - ray.pos.y) * yinv;\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\n\n    if (tmax >= Math.max(0, tmin) && tmin < farClipDistance) {\n      return tmin;\n    }\n    return -1;\n  }\n\n  /**\n   * Tests whether a point is contained within the bounding box\n   * @param p  The point to test\n   */\n  public contains(p: Vector): boolean;\n\n  /**\n   * Tests whether another bounding box is totally contained in this one\n   * @param bb  The bounding box to test\n   */\n  public contains(bb: BoundingBox): boolean;\n  public contains(val: any): boolean {\n    if (val instanceof Vector) {\n      return this.left <= val.x && this.top <= val.y && this.bottom >= val.y && this.right >= val.x;\n    } else if (val instanceof BoundingBox) {\n      if (this.left < val.left && this.top < val.top && val.bottom < this.bottom && val.right < this.right) {\n        return true;\n      }\n      return false;\n    }\n    return false;\n  }\n\n  /**\n   * Combines this bounding box and another together returning a new bounding box\n   * @param other  The bounding box to combine\n   */\n  public combine(other: BoundingBox): BoundingBox {\n    const compositeBB = new BoundingBox(\n      Math.min(this.left, other.left),\n      Math.min(this.top, other.top),\n      Math.max(this.right, other.right),\n      Math.max(this.bottom, other.bottom)\n    );\n    return compositeBB;\n  }\n\n  public get dimensions(): Vector {\n    return new Vector(this.width, this.height);\n  }\n\n  /**\n   * Test wether this bounding box intersects with another returning\n   * the intersection vector that can be used to resolve the collision. If there\n   * is no intersection null is returned.\n   *\n   * @param other  Other [[BoundingBox]] to test intersection with\n   * @returns A Vector in the direction of the current BoundingBox, this <- other\n   */\n  public intersect(other: BoundingBox): Vector {\n    const totalBoundingBox = this.combine(other);\n\n    // If the total bounding box is less than or equal the sum of the 2 bounds then there is collision\n    if (\n      totalBoundingBox.width < other.width + this.width &&\n      totalBoundingBox.height < other.height + this.height &&\n      !totalBoundingBox.dimensions.equals(other.dimensions) &&\n      !totalBoundingBox.dimensions.equals(this.dimensions)\n    ) {\n      // collision\n      let overlapX = 0;\n      // right edge is between the other's left and right edge\n      /**\n       *     +-this-+\n       *     |      |\n       *     |    +-other-+\n       *     +----|-+     |\n       *          |       |\n       *          +-------+\n       *         <---\n       *          ^ overlap\n       */\n      if (this.right >= other.left && this.right <= other.right) {\n        overlapX = other.left - this.right;\n        // right edge is past the other's right edge\n        /**\n         *     +-other-+\n         *     |       |\n         *     |    +-this-+\n         *     +----|--+   |\n         *          |      |\n         *          +------+\n         *          --->\n         *          ^ overlap\n         */\n      } else {\n        overlapX = other.right - this.left;\n      }\n\n      let overlapY = 0;\n      // top edge is between the other's top and bottom edge\n      /**\n       *     +-other-+\n       *     |       |\n       *     |    +-this-+   | <- overlap\n       *     +----|--+   |   |\n       *          |      |  \\ /\n       *          +------+   '\n       */\n      if (this.top <= other.bottom && this.top >= other.top) {\n        overlapY = other.bottom - this.top;\n        // top edge is above the other top edge\n        /**\n         *     +-this-+         .\n         *     |      |        / \\\n         *     |    +-other-+   | <- overlap\n         *     +----|-+     |   |\n         *          |       |\n         *          +-------+\n         */\n      } else {\n        overlapY = other.top - this.bottom;\n      }\n\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\n        return new Vector(overlapX, 0);\n      } else {\n        return new Vector(0, overlapY);\n      }\n      // Case of total containment of one bounding box by another\n    } else if (totalBoundingBox.dimensions.equals(other.dimensions) || totalBoundingBox.dimensions.equals(this.dimensions)) {\n      let overlapX = 0;\n      // this is wider than the other\n      if (this.width - other.width >= 0) {\n        // This right edge is closest to the others right edge\n        if (this.right - other.right <= other.left - this.left) {\n          overlapX = other.left - this.right;\n          // This left edge is closest to the others left edge\n        } else {\n          overlapX = other.right - this.left;\n        }\n        // other is wider than this\n      } else {\n        // This right edge is closest to the others right edge\n        if (other.right - this.right <= this.left - other.left) {\n          overlapX = this.left - other.right;\n          // This left edge is closest to the others left edge\n        } else {\n          overlapX = this.right - other.left;\n        }\n      }\n\n      let overlapY = 0;\n      // this is taller than other\n      if (this.height - other.height >= 0) {\n        // The bottom edge is closest to the others bottom edge\n        if (this.bottom - other.bottom <= other.top - this.top) {\n          overlapY = other.top - this.bottom;\n        } else {\n          overlapY = other.bottom - this.top;\n        }\n        // other is taller than this\n      } else {\n        // The bottom edge is closest to the others bottom edge\n        if (other.bottom - this.bottom <= this.top - other.top) {\n          overlapY = this.top - other.bottom;\n        } else {\n          overlapY = this.bottom - other.top;\n        }\n      }\n\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\n        return new Vector(overlapX, 0);\n      } else {\n        return new Vector(0, overlapY);\n      }\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Test whether the bounding box has intersected with another bounding box, returns the side of the current bb that intersected.\n   * @param bb The other actor to test\n   */\n  public intersectWithSide(bb: BoundingBox): Side {\n    const intersect = this.intersect(bb);\n    return BoundingBox.getSideFromIntersection(intersect);\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Yellow) {\n    ctx.strokeStyle = color.toString();\n    ctx.strokeRect(this.left, this.top, this.width, this.height);\n  }\n}\n","import { Vector } from './Algebra';\nimport { Logger } from './Util/Log';\nimport { Camera } from './Camera';\nimport { BrowserEvents } from './Util/Browser';\nimport { BoundingBox } from './Collision/Index';\n\n/**\n * Enum representing the different display modes available to Excalibur.\n */\nexport enum DisplayMode {\n  /**\n   * Use the entire screen's css width/height for the game resolution dynamically. This is not the same as [[Screen.goFullScreen]]\n   */\n  FullScreen = 'FullScreen',\n\n  /**\n   * Use the parent DOM container's css width/height for the game resolution dynamically\n   */\n  Container = 'Container',\n\n  /**\n   * Default, use a specified resolution for the game\n   */\n  Fixed = 'Fixed',\n\n  /**\n   * Allow the game to be positioned with the [[EngineOptions.position]] option\n   */\n  Position = 'Position'\n}\n\n/**\n * Convenience class for quick resolutions\n * Mostly sourced from https://emulation.gametechwiki.com/index.php/Resolution\n */\nexport class Resolution {\n  /* istanbul ignore next */\n  public static get SVGA(): ScreenDimension {\n    return { width: 800, height: 600 };\n  }\n\n  /* istanbul ignore next */\n  public static get Standard(): ScreenDimension {\n    return { width: 1920, height: 1080 };\n  }\n\n  /* istanbul ignore next */\n  public static get Atari2600(): ScreenDimension {\n    return { width: 160, height: 192 };\n  }\n\n  /* istanbul ignore next */\n  public static get GameBoy(): ScreenDimension {\n    return { width: 160, height: 144 };\n  }\n\n  /* istanbul ignore next */\n  public static get GameBoyAdvance(): ScreenDimension {\n    return { width: 240, height: 160 };\n  }\n\n  /* istanbul ignore next */\n  public static get NintendoDS(): ScreenDimension {\n    return { width: 256, height: 192 };\n  }\n\n  /* istanbul ignore next */\n  public static get NES(): ScreenDimension {\n    return { width: 256, height: 224 };\n  }\n\n  /* istanbul ignore next */\n  public static get SNES(): ScreenDimension {\n    return { width: 256, height: 244 };\n  }\n}\n\n/**\n * Interface describing the absolute CSS position of the game window. For use when [[DisplayMode.Position]]\n * is specified and when the user wants to define exact pixel spacing of the window.\n * When a number is given, the value is interpreted as pixels\n */\nexport interface AbsolutePosition {\n  top?: number | string;\n  left?: number | string;\n  right?: number | string;\n  bottom?: number | string;\n}\n\nexport type CanvasPosition = string | AbsolutePosition;\n\nexport interface ScreenDimension {\n  width: number;\n  height: number;\n}\n\nexport interface ExcaliburGraphicsContext {\n  save(): void;\n  resetTransform(): void;\n  scale(x: number, y: number): void;\n  imageSmoothingEnabled: boolean;\n  restore(): void;\n}\n\nexport interface ScreenOptions {\n  /**\n   * Canvas element to build a screen on\n   */\n  canvas: HTMLCanvasElement;\n  /**\n   * Graphics context for the screen\n   */\n  context: ExcaliburGraphicsContext;\n\n  /**\n   * Browser abstraction\n   */\n  browser: BrowserEvents;\n  /**\n   * Optionally set antialiasing, defaults to true. If set to true, images will be smoothed\n   */\n  antialiasing?: boolean;\n  /**\n   * Optionally override the pixel ratio to use for the screen, otherwise calculated automatically from the browser\n   */\n  pixelRatio?: number;\n  /**\n   * Optionally specify the actual pixel resolution in width/height pixels (also known as logical resolution), by default the\n   * resolution will be the same as the viewport. Resolution will be overridden by DisplayMode.Container and DisplayMode.FullScreen.\n   */\n  resolution?: ScreenDimension;\n  /**\n   * Visual viewport size in css pixel, if resolution is not specified it will be the same as the viewport\n   */\n  viewport: ScreenDimension;\n  /**\n   * Set the display mode of the screen, by default DisplayMode.Fixed.\n   */\n  displayMode?: DisplayMode;\n  /**\n   * Specify how the game window is to be positioned when the [[DisplayMode.Position]] is chosen. This option MUST be specified\n   * if the DisplayMode is set as [[DisplayMode.Position]]. The position can be either a string or an [[AbsolutePosition]].\n   * String must be in the format of css style background-position. The vertical position must precede the horizontal position in strings.\n   *\n   * Valid String examples: \"top left\", \"top\", \"bottom\", \"middle\", \"middle center\", \"bottom right\"\n   * Valid [[AbsolutePosition]] examples: `{top: 5, right: 10%}`, `{bottom: 49em, left: 10px}`, `{left: 10, bottom: 40}`\n   */\n  position?: CanvasPosition;\n}\n\n/**\n * The Screen handles all aspects of interacting with the screen for Excalibur.\n */\nexport class Screen {\n  private _canvas: HTMLCanvasElement;\n  private _ctx: ExcaliburGraphicsContext;\n  private _antialiasing: boolean = true;\n  private _browser: BrowserEvents;\n  private _camera: Camera;\n  private _resolution: ScreenDimension;\n  private _resolutionStack: ScreenDimension[] = [];\n  private _viewport: ScreenDimension;\n  private _viewportStack: ScreenDimension[] = [];\n  private _pixelRatio: number | null = null;\n  private _position: CanvasPosition;\n  private _displayMode: DisplayMode;\n  private _isFullScreen = false;\n  private _mediaQueryList: MediaQueryList;\n  private _isDisposed = false;\n  private _logger = Logger.getInstance();\n\n  constructor(options: ScreenOptions) {\n    this.viewport = options.viewport;\n    this.resolution = options.resolution ?? { ...this.viewport };\n    this._displayMode = options.displayMode ?? DisplayMode.Fixed;\n    this._canvas = options.canvas;\n    this._ctx = options.context;\n    this._antialiasing = options.antialiasing ?? this._antialiasing;\n    this._browser = options.browser;\n    this._position = options.position;\n    this._pixelRatio = options.pixelRatio;\n    this._applyDisplayMode();\n\n    this._mediaQueryList = this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);\n    this._mediaQueryList.addEventListener('change', this._pixelRatioChangeHandler);\n  }\n\n  public dispose(): void {\n    if (!this._isDisposed) {\n      // Clean up handlers\n      this._isDisposed = true;\n      this._browser.window.off('resize', this._windowResizeHandler);\n      this._mediaQueryList.removeEventListener('change', this._pixelRatioChangeHandler);\n    }\n  }\n\n  private _pixelRatioChangeHandler = () => {\n    this._logger.debug('Pixel Ratio Change', window.devicePixelRatio);\n    this.applyResolutionAndViewport();\n  };\n\n  private _windowResizeHandler = () => {\n    const parent = <any>(this.displayMode === DisplayMode.Container ? <any>(this.canvas.parentElement || document.body) : <any>window);\n    this._logger.debug('View port resized');\n    this._setHeightByDisplayMode(parent);\n    this._logger.info('parent.clientHeight ' + parent.clientHeight);\n    this.applyResolutionAndViewport();\n  };\n\n  public get pixelRatio(): number {\n    if (this._pixelRatio) {\n      return this._pixelRatio;\n    }\n\n    if (window.devicePixelRatio < 1) {\n      return 1;\n    }\n\n    const devicePixelRatio = window.devicePixelRatio || 1;\n\n    return devicePixelRatio;\n  }\n\n  public get isHiDpi() {\n    return this.pixelRatio !== 1;\n  }\n\n  public get displayMode(): DisplayMode {\n    return this._displayMode;\n  }\n\n  public get canvas(): HTMLCanvasElement {\n    return this._canvas;\n  }\n\n  public get resolution(): ScreenDimension {\n    return this._resolution;\n  }\n\n  public set resolution(resolution: ScreenDimension) {\n    this._resolution = resolution;\n  }\n\n  public get viewport(): ScreenDimension {\n    if (this._viewport) {\n      return this._viewport;\n    }\n    return this._resolution;\n  }\n\n  public set viewport(viewport: ScreenDimension) {\n    this._viewport = viewport;\n  }\n\n  public get scaledWidth() {\n    return this._resolution.width * this.pixelRatio;\n  }\n\n  public get scaledHeight() {\n    return this._resolution.height * this.pixelRatio;\n  }\n\n  public setCurrentCamera(camera: Camera) {\n    this._camera = camera;\n  }\n\n  public pushResolutionAndViewport() {\n    this._resolutionStack.push(this.resolution);\n    this._viewportStack.push(this.viewport);\n\n    this.resolution = { ...this.resolution };\n    this.viewport = { ...this.viewport };\n  }\n\n  public popResolutionAndViewport() {\n    this.resolution = this._resolutionStack.pop();\n    this.viewport = this._viewportStack.pop();\n  }\n\n  public applyResolutionAndViewport() {\n    this._canvas.width = this.scaledWidth;\n    this._canvas.height = this.scaledHeight;\n\n    if (this._antialiasing) {\n      this._canvas.style.imageRendering = 'auto';\n    } else {\n      this._canvas.style.imageRendering = 'pixelated';\n      // Fall back to 'crisp-edges' if 'pixelated' is not supported\n      // Currently for firefox https://developer.mozilla.org/en-US/docs/Web/CSS/image-rendering\n      if (this._canvas.style.imageRendering === '') {\n        this._canvas.style.imageRendering = 'crisp-edges';\n      }\n    }\n    this._canvas.style.width = this.viewport.width + 'px';\n    this._canvas.style.height = this.viewport.height + 'px';\n\n    // After messing with the canvas width/height the graphics context is invalidated and needs to have some properties reset\n    this._ctx.resetTransform();\n    this._ctx.scale(this.pixelRatio, this.pixelRatio);\n    this._ctx.imageSmoothingEnabled = this._antialiasing;\n  }\n\n  public get antialiasing() {\n    return this._antialiasing;\n  }\n\n  public set antialiasing(isSmooth: boolean) {\n    this._antialiasing = isSmooth;\n    this._ctx.imageSmoothingEnabled = this._antialiasing;\n  }\n\n  /**\n   * Returns true if excalibur is fullscreened using the browser fullscreen api\n   */\n  public get isFullScreen() {\n    return this._isFullScreen;\n  }\n\n  /**\n   * Requests to go fullscreen using the browser fullscreen api\n   */\n  public goFullScreen(): Promise<void> {\n    return this._canvas.requestFullscreen().then(() => {\n      this._isFullScreen = true;\n    });\n  }\n\n  /**\n   * Requests to exit fullscreen using the browser fullscreen api\n   */\n  public exitFullScreen(): Promise<void> {\n    return document.exitFullscreen().then(() => {\n      this._isFullScreen = false;\n    });\n  }\n\n  /**\n   * Transforms the current x, y from screen coordinates to world coordinates\n   * @param point  Screen coordinate to convert\n   */\n  public screenToWorldCoordinates(point: Vector): Vector {\n    let newX = point.x;\n    let newY = point.y;\n\n    // transform back to world space\n    newX = (newX / this.viewport.width) * this.drawWidth;\n    newY = (newY / this.viewport.height) * this.drawHeight;\n\n    // transform based on zoom\n    newX = newX - this.halfDrawWidth;\n    newY = newY - this.halfDrawHeight;\n\n    // shift by focus\n    newX += this._camera?.x ?? 0;\n    newY += this._camera?.y ?? 0;\n\n    return new Vector(Math.floor(newX), Math.floor(newY));\n  }\n\n  /**\n   * Transforms a world coordinate, to a screen coordinate\n   * @param point  World coordinate to convert\n   */\n  public worldToScreenCoordinates(point: Vector): Vector {\n    let screenX = point.x;\n    let screenY = point.y;\n\n    // shift by focus\n    screenX -= this._camera?.x ?? 0;\n    screenY -= this._camera?.y ?? 0;\n\n    // transform back on zoom\n    screenX = screenX + this.halfDrawWidth;\n    screenY = screenY + this.halfDrawHeight;\n\n    // transform back to screen space\n    screenX = (screenX * this.viewport.width) / this.drawWidth;\n    screenY = (screenY * this.viewport.height) / this.drawHeight;\n\n    return new Vector(Math.floor(screenX), Math.floor(screenY));\n  }\n\n  /**\n   * Returns a BoundingBox of the top left corner of the screen\n   * and the bottom right corner of the screen.\n   */\n  public getWorldBounds(): BoundingBox {\n    const left = this.screenToWorldCoordinates(Vector.Zero).x;\n    const top = this.screenToWorldCoordinates(Vector.Zero).y;\n    const right = left + this.drawWidth;\n    const bottom = top + this.drawHeight;\n\n    return new BoundingBox(left, top, right, bottom);\n  }\n\n  /**\n   * The width of the game canvas in pixels (physical width component of the\n   * resolution of the canvas element)\n   */\n  public get canvasWidth(): number {\n    return this.canvas.width;\n  }\n\n  /**\n   * Returns half width of the game canvas in pixels (half physical width component)\n   */\n  public get halfCanvasWidth(): number {\n    return this.canvas.width / 2;\n  }\n\n  /**\n   * The height of the game canvas in pixels, (physical height component of\n   * the resolution of the canvas element)\n   */\n  public get canvasHeight(): number {\n    return this.canvas.height;\n  }\n\n  /**\n   * Returns half height of the game canvas in pixels (half physical height component)\n   */\n  public get halfCanvasHeight(): number {\n    return this.canvas.height / 2;\n  }\n\n  /**\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get drawWidth(): number {\n    if (this._camera) {\n      return this.scaledWidth / this._camera.z / this.pixelRatio;\n    }\n    return this.scaledWidth / this.pixelRatio;\n  }\n\n  /**\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get halfDrawWidth(): number {\n    return this.drawWidth / 2;\n  }\n\n  /**\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get drawHeight(): number {\n    if (this._camera) {\n      return this.scaledHeight / this._camera.z / this.pixelRatio;\n    }\n    return this.scaledHeight / this.pixelRatio;\n  }\n\n  /**\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get halfDrawHeight(): number {\n    return this.drawHeight / 2;\n  }\n\n  private _applyDisplayMode() {\n    if (this.displayMode === DisplayMode.FullScreen || this.displayMode === DisplayMode.Container) {\n      const parent = <any>(this.displayMode === DisplayMode.Container ? <any>(this.canvas.parentElement || document.body) : <any>window);\n\n      this._setHeightByDisplayMode(parent);\n\n      this._browser.window.on('resize', this._windowResizeHandler);\n    } else if (this.displayMode === DisplayMode.Position) {\n      this._initializeDisplayModePosition(this._position);\n    }\n  }\n\n  /**\n   * Sets the internal canvas height based on the selected display mode.\n   */\n  private _setHeightByDisplayMode(parent: HTMLElement | Window) {\n    if (this.displayMode === DisplayMode.Container) {\n      this.resolution = {\n        width: (<HTMLElement>parent).clientWidth,\n        height: (<HTMLElement>parent).clientHeight\n      };\n\n      this.viewport = this.resolution;\n    }\n\n    if (this.displayMode === DisplayMode.FullScreen) {\n      document.body.style.margin = '0px';\n      document.body.style.overflow = 'hidden';\n      this.resolution = {\n        width: (<Window>parent).innerWidth,\n        height: (<Window>parent).innerHeight\n      };\n\n      this.viewport = this.resolution;\n    }\n  }\n\n  private _initializeDisplayModePosition(position: CanvasPosition) {\n    if (!position) {\n      throw new Error('DisplayMode of Position was selected but no position option was given');\n    } else {\n      this.canvas.style.display = 'block';\n      this.canvas.style.position = 'absolute';\n\n      if (typeof position === 'string') {\n        const specifiedPosition = position.split(' ');\n\n        switch (specifiedPosition[0]) {\n          case 'top':\n            this.canvas.style.top = '0px';\n            break;\n          case 'bottom':\n            this.canvas.style.bottom = '0px';\n            break;\n          case 'middle':\n            this.canvas.style.top = '50%';\n            const offsetY = -this.halfDrawHeight;\n            this.canvas.style.marginTop = offsetY.toString();\n            break;\n          default:\n            throw new Error('Invalid Position Given');\n        }\n\n        if (specifiedPosition[1]) {\n          switch (specifiedPosition[1]) {\n            case 'left':\n              this.canvas.style.left = '0px';\n              break;\n            case 'right':\n              this.canvas.style.right = '0px';\n              break;\n            case 'center':\n              this.canvas.style.left = '50%';\n              const offsetX = -this.halfDrawWidth;\n              this.canvas.style.marginLeft = offsetX.toString();\n              break;\n            default:\n              throw new Error('Invalid Position Given');\n          }\n        }\n      } else {\n        if (position.top) {\n          typeof position.top === 'number'\n            ? (this.canvas.style.top = position.top.toString() + 'px')\n            : (this.canvas.style.top = position.top);\n        }\n        if (position.right) {\n          typeof position.right === 'number'\n            ? (this.canvas.style.right = position.right.toString() + 'px')\n            : (this.canvas.style.right = position.right);\n        }\n        if (position.bottom) {\n          typeof position.bottom === 'number'\n            ? (this.canvas.style.bottom = position.bottom.toString() + 'px')\n            : (this.canvas.style.bottom = position.bottom);\n        }\n        if (position.left) {\n          typeof position.left === 'number'\n            ? (this.canvas.style.left = position.left.toString() + 'px')\n            : (this.canvas.style.left = position.left);\n        }\n      }\n    }\n  }\n}\n","import { GameEvent, SubscribeEvent, UnsubscribeEvent } from './Events';\nimport { Eventable } from './Interfaces/Evented';\n\nexport class EventDispatcher<T = any> implements Eventable {\n  private _handlers: { [key: string]: { (event: GameEvent<T>): void }[] } = {};\n  private _wiredEventDispatchers: Eventable[] = [];\n\n  private _target: T;\n\n  /**\n   * @param target  The object that will be the recipient of events from this event dispatcher\n   */\n  constructor(target: T) {\n    this._target = target;\n  }\n\n  /**\n   * Clears any existing handlers or wired event dispatchers on this event dispatcher\n   */\n  public clear() {\n    this._handlers = {};\n    this._wiredEventDispatchers = [];\n  }\n\n  /**\n   * Emits an event for target\n   * @param eventName  The name of the event to publish\n   * @param event      Optionally pass an event data object to the handler\n   */\n  public emit(eventName: string, event: GameEvent<T>) {\n    if (!eventName) {\n      // key not mapped\n      return;\n    }\n    eventName = eventName.toLowerCase();\n    const target = this._target;\n    if (!event) {\n      event = new GameEvent();\n    }\n    event.target = target;\n\n    let i: number, len: number;\n\n    if (this._handlers[eventName]) {\n      i = 0;\n      len = this._handlers[eventName].length;\n\n      for (i; i < len; i++) {\n        this._handlers[eventName][i].call(target, event);\n      }\n    }\n\n    i = 0;\n    len = this._wiredEventDispatchers.length;\n\n    for (i; i < len; i++) {\n      this._wiredEventDispatchers[i].emit(eventName, event);\n    }\n  }\n\n  /**\n   * Subscribe an event handler to a particular event name, multiple handlers per event name are allowed.\n   * @param eventName  The name of the event to subscribe to\n   * @param handler    The handler callback to fire on this event\n   */\n  public on(eventName: string, handler: (event: GameEvent<T>) => void) {\n    eventName = eventName.toLowerCase();\n    if (!this._handlers[eventName]) {\n      this._handlers[eventName] = [];\n    }\n    this._handlers[eventName].push(handler);\n\n    // meta event handlers\n    if (eventName !== 'unsubscribe' && eventName !== 'subscribe') {\n      this.emit('subscribe', new SubscribeEvent(eventName, handler));\n    }\n  }\n\n  /**\n   * Unsubscribe an event handler(s) from an event. If a specific handler\n   * is specified for an event, only that handler will be unsubscribed.\n   * Otherwise all handlers will be unsubscribed for that event.\n   *\n   * @param eventName  The name of the event to unsubscribe\n   * @param handler    Optionally the specific handler to unsubscribe\n   *\n   */\n  public off(eventName: string, handler?: (event: GameEvent<T>) => void) {\n    eventName = eventName.toLowerCase();\n    const eventHandlers = this._handlers[eventName];\n\n    if (eventHandlers) {\n      // if no explicit handler is give with the event name clear all handlers\n      if (!handler) {\n        this._handlers[eventName].length = 0;\n      } else {\n        const index = eventHandlers.indexOf(handler);\n        this._handlers[eventName].splice(index, 1);\n      }\n    }\n    // meta event handlers\n    if (eventName !== 'unsubscribe' && eventName !== 'subscribe') {\n      this.emit('unsubscribe', new UnsubscribeEvent(eventName, handler));\n    }\n  }\n\n  /**\n   * Once listens to an event one time, then unsubscribes from that event\n   *\n   * @param eventName The name of the event to subscribe to once\n   * @param handler   The handler of the event that will be auto unsubscribed\n   */\n  public once(eventName: string, handler: (event: GameEvent<T>) => void) {\n    const metaHandler = (event: GameEvent<T>) => {\n      const ev = event || new GameEvent();\n      ev.target = ev.target || this._target;\n\n      this.off(eventName, handler);\n      handler.call(ev.target, ev);\n    };\n\n    this.on(eventName, metaHandler);\n  }\n\n  /**\n   * Wires this event dispatcher to also receive events from another\n   */\n  public wire(eventDispatcher: EventDispatcher): void {\n    eventDispatcher._wiredEventDispatchers.push(this);\n  }\n\n  /**\n   * Unwires this event dispatcher from another\n   */\n  public unwire(eventDispatcher: EventDispatcher): void {\n    const index = eventDispatcher._wiredEventDispatchers.indexOf(this);\n    if (index > -1) {\n      eventDispatcher._wiredEventDispatchers.splice(index, 1);\n    }\n  }\n}\n","import { GameEvent } from './Events';\nimport { EventDispatcher } from './EventDispatcher';\nimport { Eventable } from './Interfaces/Evented';\n\n/**\n * Excalibur base class that provides basic functionality such as [[EventDispatcher]]\n * and extending abilities for vanilla Javascript projects\n */\nexport class Class implements Eventable {\n  /**\n   * Direct access to the game object event dispatcher.\n   */\n  public eventDispatcher: EventDispatcher;\n\n  constructor() {\n    this.eventDispatcher = new EventDispatcher(this);\n  }\n\n  /**\n   * Alias for `addEventListener`. You can listen for a variety of\n   * events off of the engine; see the events section below for a complete list.\n   * @param eventName  Name of the event to listen for\n   * @param handler    Event handler for the thrown event\n   */\n  public on(eventName: string, handler: (event: GameEvent<any>) => void) {\n    this.eventDispatcher.on(eventName, handler);\n  }\n\n  /**\n   * Alias for `removeEventListener`. If only the eventName is specified\n   * it will remove all handlers registered for that specific event. If the eventName\n   * and the handler instance are specified only that handler will be removed.\n   *\n   * @param eventName  Name of the event to listen for\n   * @param handler    Event handler for the thrown event\n   */\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void) {\n    this.eventDispatcher.off(eventName, handler);\n  }\n\n  /**\n   * Emits a new event\n   * @param eventName   Name of the event to emit\n   * @param eventObject Data associated with this event\n   */\n  public emit(eventName: string, eventObject: GameEvent<any>) {\n    this.eventDispatcher.emit(eventName, eventObject);\n  }\n\n  /**\n   * Once listens to an event one time, then unsubscribes from that event\n   *\n   * @param eventName The name of the event to subscribe to once\n   * @param handler   The handler of the event that will be auto unsubscribed\n   */\n  public once(eventName: string, handler: (event: GameEvent<any>) => void) {\n    this.eventDispatcher.once(eventName, handler);\n  }\n}\n","import { Loadable } from '../Interfaces/Loadable';\nimport { Class } from '../Class';\nimport { Engine } from '../Engine';\nimport { Logger } from '../Util/Log';\n\n/**\n * The [[Resource]] type allows games built in Excalibur to load generic resources.\n * For any type of remote resource it is recommended to use [[Resource]] for preloading.\n */\nexport class Resource<T> extends Class implements Loadable<T> {\n  public data: T = null;\n  public logger: Logger = Logger.getInstance();\n\n  /**\n   * @param path          Path to the remote resource\n   * @param responseType  The type to expect as a response: \"\" | \"arraybuffer\" | \"blob\" | \"document\" | \"json\" | \"text\";\n   * @param bustCache     Whether or not to cache-bust requests\n   */\n  constructor(\n    public path: string,\n    public responseType: '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text',\n    public bustCache: boolean = true\n  ) {\n    super();\n  }\n\n  /**\n   * Returns true if the Resource is completely loaded and is ready\n   * to be drawn.\n   */\n  public isLoaded(): boolean {\n    return this.data !== null;\n  }\n\n  public wireEngine(_engine: Engine) {\n    // override me\n  }\n\n  private _cacheBust(uri: string): string {\n    const query: RegExp = /\\?\\w*=\\w*/;\n    if (query.test(uri)) {\n      uri += '&__=' + Date.now();\n    } else {\n      uri += '?__=' + Date.now();\n    }\n    return uri;\n  }\n\n  private _start() {\n    this.logger.debug('Started loading resource ' + this.path);\n  }\n\n  /**\n   * Begin loading the resource and returns a promise to be resolved on completion\n   */\n  public load(): Promise<any> {\n    return new Promise((resolve, reject) => {\n      // Exit early if we already have data\n      if (this.data !== null) {\n        this.logger.debug('Already have data for resource', this.path);\n        resolve(this.data);\n        this.oncomplete();\n        return;\n      }\n\n      const request = new XMLHttpRequest();\n      request.open('GET', this.bustCache ? this._cacheBust(this.path) : this.path, true);\n      request.responseType = this.responseType;\n      request.onloadstart = () => {\n        this._start();\n      };\n      request.onprogress = this.onprogress;\n      request.onerror = this.onerror;\n      request.onload = () => {\n        // XHR on file:// success status is 0, such as with PhantomJS\n        if (request.status !== 0 && request.status !== 200) {\n          this.logger.error('Failed to load resource ', this.path, ' server responded with error code', request.status);\n          this.onerror(request.response);\n          reject(request.response);\n          return;\n        }\n\n        this.data = this.processData(request.response);\n\n        this.oncomplete();\n        this.logger.debug('Completed loading resource', this.path);\n        resolve(this.data);\n      };\n      request.send();\n    });\n  }\n\n  /**\n   * Returns the loaded data once the resource is loaded\n   */\n  public getData(): any {\n    return this.data;\n  }\n\n  /**\n   * Sets the data for this resource directly\n   */\n  public setData(data: any) {\n    this.data = this.processData(data);\n  }\n\n  /**\n   * This method is meant to be overridden to handle any additional\n   * processing. Such as decoding downloaded audio bits.\n   */\n  public processData(data: T): any {\n    // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseType\n    // Blob requires an object url\n    if (this.responseType === 'blob') {\n      return URL.createObjectURL(data);\n    }\n    return data;\n  }\n\n  public onprogress: (e: any) => void = () => {\n    return;\n  };\n\n  public oncomplete: () => void = () => {\n    return;\n  };\n\n  public onerror: (e: any) => void = () => {\n    return;\n  };\n}\n","/**\n * These effects can be applied to any bitmap image but are mainly used\n * for [[Sprite]] effects or [[Animation]] effects.\n */\n\n/**\n * @typedoc\n */\n\nimport { Color } from './Color';\n\n/**\n * The interface that all sprite effects must implement\n */\nexport interface SpriteEffect {\n  /**\n   * Should update individual pixels values\n   * @param x          The pixel's x coordinate\n   * @param y          The pixel's y coordinate\n   * @param imageData  The sprite's raw pixel data\n   */\n  updatePixel(x: number, y: number, imageData: ImageData): void;\n}\n\n/**\n * Applies the \"Grayscale\" effect to a sprite, removing color information.\n */\nexport class Grayscale implements SpriteEffect {\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const avg = (pixel[firstPixel + 0] + pixel[firstPixel + 1] + pixel[firstPixel + 2]) / 3;\n    pixel[firstPixel + 0] = avg;\n    pixel[firstPixel + 1] = avg;\n    pixel[firstPixel + 2] = avg;\n  }\n}\n\n/**\n * Applies the \"Invert\" effect to a sprite, inverting the pixel colors.\n */\nexport class Invert implements SpriteEffect {\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    pixel[firstPixel + 0] = 255 - pixel[firstPixel + 0];\n    pixel[firstPixel + 1] = 255 - pixel[firstPixel + 1];\n    pixel[firstPixel + 2] = 255 - pixel[firstPixel + 2];\n  }\n}\n\n/**\n * Applies the \"Opacity\" effect to a sprite, setting the alpha of all pixels to a given value.\n */\nexport class Opacity implements SpriteEffect {\n  /**\n   * @param opacity  The new opacity of the sprite from 0-1.0\n   */\n  constructor(public opacity: number) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    if (pixel[firstPixel + 3] !== 0) {\n      pixel[firstPixel + 3] = Math.round(this.opacity * pixel[firstPixel + 3]);\n    }\n  }\n}\n\n/**\n * Applies the \"Colorize\" effect to a sprite, changing the color channels of all the pixels to an\n * average of the original color and the provided color\n */\nexport class Colorize implements SpriteEffect {\n  /**\n   * @param color  The color to apply to the sprite\n   */\n  constructor(public color: Color) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    if (pixel[firstPixel + 3] !== 0) {\n      pixel[firstPixel + 0] = (pixel[firstPixel + 0] + this.color.r) / 2;\n      pixel[firstPixel + 1] = (pixel[firstPixel + 1] + this.color.g) / 2;\n      pixel[firstPixel + 2] = (pixel[firstPixel + 2] + this.color.b) / 2;\n    }\n  }\n}\n\n/**\n * Applies the \"Lighten\" effect to a sprite, changes the lightness of the color according to HSL\n */\nexport class Lighten implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).lighten(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Darken\" effect to a sprite, changes the darkness of the color according to HSL\n */\nexport class Darken implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).darken(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Saturate\" effect to a sprite, saturates the color according to HSL\n */\nexport class Saturate implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).saturate(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Desaturate\" effect to a sprite, desaturates the color according to HSL\n */\nexport class Desaturate implements SpriteEffect {\n  /**\n   * @param factor  The factor of the effect between 0-1\n   */\n  constructor(public factor: number = 0.1) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).desaturate(\n      this.factor\n    );\n    pixel[firstPixel + 0] = color.r;\n    pixel[firstPixel + 1] = color.g;\n    pixel[firstPixel + 2] = color.b;\n    pixel[firstPixel + 3] = color.a;\n  }\n}\n\n/**\n * Applies the \"Fill\" effect to a sprite, changing the color channels of all non-transparent pixels to match\n * a given color\n */\nexport class Fill implements SpriteEffect {\n  /**\n   * @param color  The color to apply to the sprite\n   */\n  constructor(public color: Color) {}\n  updatePixel(x: number, y: number, imageData: ImageData): void {\n    const firstPixel = (x + y * imageData.width) * 4;\n    const pixel = imageData.data;\n    if (pixel[firstPixel + 3] !== 0) {\n      pixel[firstPixel + 0] = this.color.r;\n      pixel[firstPixel + 1] = this.color.g;\n      pixel[firstPixel + 2] = this.color.b;\n    }\n  }\n}\n","export type Constructor<T> = {\n  new (...args: any[]): T;\n};\n/**\n * Configurable helper extends base type and makes all properties available as option bag arguments\n * @internal\n * @param base\n */\nexport function Configurable<T extends Constructor<{}>>(base: T): T {\n  return class extends base {\n    public assign(props: Partial<T>) {\n      //set the value of every property that was passed in,\n      //if the constructor previously set this value, it will be overridden here\n      for (const k in props) {\n        // eslint-disable-next-line\n        if (typeof (<any>this)[k] !== 'function') {\n          // eslint-disable-next-line\n          (<any>this)[k] = (<any>props)[k];\n        }\n      }\n    }\n\n    constructor(...args: any[]) {\n      super(...args);\n      //get the number of arguments that aren't undefined. TS passes a value to all parameters\n      //of whatever ctor is the implementation, so args.length doesn't work here.\n      const size = args.filter(function(value) {\n        return value !== undefined;\n      }).length;\n      if (size === 1 && args[0] && typeof args[0] === 'object' && !(args[0] instanceof Array)) {\n        this.assign(args[0]);\n      }\n    }\n  };\n}\n","import * as Effects from './SpriteEffects';\nimport { Color } from './Color';\n\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\nimport { Texture } from '../Resources/Texture';\nimport { Vector } from '../Algebra';\nimport { Logger } from '../Util/Log';\nimport { clamp } from '../Util/Util';\nimport { Configurable } from '../Configurable';\n\n/**\n * @hidden\n */\nexport class SpriteImpl implements Drawable {\n  private _texture: Texture;\n\n  public x: number = 0;\n  public y: number = 0;\n\n  public get drawWidth(): number {\n    return this.width * this.scale.x;\n  }\n\n  public get drawHeight(): number {\n    return this.height * this.scale.y;\n  }\n\n  public rotation: number = 0.0;\n  public anchor: Vector = new Vector(0.0, 0.0);\n  public offset: Vector = Vector.Zero;\n  public scale: Vector = Vector.One;\n\n  public logger: Logger = Logger.getInstance();\n\n  /**\n   * Draws the sprite flipped vertically\n   */\n  public flipVertical: boolean = false;\n\n  /**\n   * Draws the sprite flipped horizontally\n   */\n  public flipHorizontal: boolean = false;\n\n  public effects: Effects.SpriteEffect[] = [];\n\n  public width: number = 0;\n  public height: number = 0;\n\n  private _spriteCanvas: HTMLCanvasElement = null;\n  private _spriteCtx: CanvasRenderingContext2D = null;\n  private _pixelData: ImageData = null;\n  private _pixelsLoaded: boolean = false;\n  private _dirtyEffect: boolean = true;\n\n  /**\n   * @param imageOrConfig  The backing image texture to build the Sprite, or Sprite option bag\n   * @param x      The x position of the sprite\n   * @param y      The y position of the sprite\n   * @param width  The width of the sprite in pixels\n   * @param height The height of the sprite in pixels\n   */\n  constructor(imageOrConfig: Texture | SpriteArgs, x: number, y: number, width: number, height: number) {\n    let image = imageOrConfig;\n    if (imageOrConfig && !(imageOrConfig instanceof Texture)) {\n      x = imageOrConfig.x | 0;\n      y = imageOrConfig.y | 0;\n      width = imageOrConfig.width | 0;\n      height = imageOrConfig.height | 0;\n      image = imageOrConfig.image;\n      if (!image) {\n        const message = 'An image texture is required to construct a sprite';\n        throw new Error(message);\n      }\n    }\n\n    this.x = x || 0;\n    this.y = y || 0;\n\n    this._texture = image as Texture;\n    this._spriteCanvas = document.createElement('canvas');\n    this._spriteCanvas.width = width;\n    this._spriteCanvas.height = height;\n    this._spriteCtx = this._spriteCanvas.getContext('2d');\n    this._initPixelsFromTexture();\n\n    this.width = width;\n    this.height = height;\n  }\n\n  private async _initPixelsFromTexture() {\n    try {\n      const image = await this._texture.loaded;\n      this.width = this.width || image.naturalWidth;\n      this.height = this.height || image.naturalHeight;\n      this._spriteCanvas.width = this._spriteCanvas.width || image.naturalWidth;\n      this._spriteCanvas.height = this._spriteCanvas.height || image.naturalHeight;\n      this._loadPixels();\n      this._dirtyEffect = true;\n    } catch (e) {\n      this.logger.error('Error loading texture ', this._texture.path, e);\n    }\n  }\n\n  private _loadPixels() {\n    if (this._texture.isLoaded() && !this._pixelsLoaded) {\n      const naturalWidth = this._texture.image.naturalWidth || 0;\n      const naturalHeight = this._texture.image.naturalHeight || 0;\n\n      if (this.width > naturalWidth) {\n        this.logger.warn(`The sprite width ${this.width} exceeds the width \n                              ${naturalWidth} of the backing texture ${this._texture.path}`);\n      }\n\n      if (this.width <= 0 || naturalWidth <= 0) {\n        throw new Error(`The width of a sprite cannot be 0 or negative, sprite width: ${this.width}, original width: ${naturalWidth}`);\n      }\n\n      if (this.height > naturalHeight) {\n        this.logger.warn(`The sprite height ${this.height} exceeds the height \n                              ${naturalHeight} of the backing texture ${this._texture.path}`);\n      }\n\n      if (this.height <= 0 || naturalHeight <= 0) {\n        throw new Error(`The height of a sprite cannot be 0 or negative, sprite height: ${this.height}, original height: ${naturalHeight}`);\n      }\n\n      this._flushTexture();\n\n      this._pixelsLoaded = true;\n    }\n  }\n\n  private _flushTexture() {\n    const naturalWidth = this._texture.image.naturalWidth || 0;\n    const naturalHeight = this._texture.image.naturalHeight || 0;\n\n    this._spriteCtx.clearRect(0, 0, this.width, this.height);\n    this._spriteCtx.drawImage(\n      this._texture.image,\n      clamp(this.x, 0, naturalWidth),\n      clamp(this.y, 0, naturalHeight),\n      clamp(this.width, 0, naturalWidth),\n      clamp(this.height, 0, naturalHeight),\n      0,\n      0,\n      this.width,\n      this.height\n    );\n  }\n\n  private _opacity: number = 1;\n  /**\n   * Applies the [[Opacity]] effect to a sprite, setting the alpha of all pixels to a given value\n   */\n  public opacity(value: number) {\n    this._opacity = value;\n  }\n\n  /**\n   * Applies the [[Grayscale]] effect to a sprite, removing color information.\n   */\n  public grayscale() {\n    this.addEffect(new Effects.Grayscale());\n  }\n\n  /**\n   * Applies the [[Invert]] effect to a sprite, inverting the pixel colors.\n   */\n  public invert() {\n    this.addEffect(new Effects.Invert());\n  }\n\n  /**\n   * Applies the [[Fill]] effect to a sprite, changing the color channels of all non-transparent pixels to match a given color\n   */\n  public fill(color: Color) {\n    this.addEffect(new Effects.Fill(color));\n  }\n\n  /**\n   * Applies the [[Colorize]] effect to a sprite, changing the color channels of all pixels to be the average of the original color\n   * and the provided color.\n   */\n  public colorize(color: Color) {\n    this.addEffect(new Effects.Colorize(color));\n  }\n\n  /**\n   * Applies the [[Lighten]] effect to a sprite, changes the lightness of the color according to HSL\n   */\n  public lighten(factor: number = 0.1) {\n    this.addEffect(new Effects.Lighten(factor));\n  }\n\n  /**\n   * Applies the [[Darken]] effect to a sprite, changes the darkness of the color according to HSL\n   */\n  public darken(factor: number = 0.1) {\n    this.addEffect(new Effects.Darken(factor));\n  }\n\n  /**\n   * Applies the [[Saturate]] effect to a sprite, saturates the color according to HSL\n   */\n  public saturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Saturate(factor));\n  }\n\n  /**\n   * Applies the [[Desaturate]] effect to a sprite, desaturates the color according to HSL\n   */\n  public desaturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Desaturate(factor));\n  }\n\n  /**\n   * Adds a new [[SpriteEffect]] to this drawing.\n   * @param effect  Effect to add to the this drawing\n   */\n  public addEffect(effect: Effects.SpriteEffect) {\n    this.effects.push(effect);\n    // We must check if the texture and the backing sprite pixels are loaded as well before\n    // an effect can be applied\n    if (!this._texture.isLoaded() || !this._pixelsLoaded) {\n      this._dirtyEffect = true;\n    } else {\n      this._applyEffects();\n    }\n  }\n\n  /**\n   * Removes a [[SpriteEffect]] from this sprite.\n   * @param effect  Effect to remove from this sprite\n   */\n  public removeEffect(effect: Effects.SpriteEffect): void;\n\n  /**\n   * Removes an effect given the index from this sprite.\n   * @param index  Index of the effect to remove from this sprite\n   */\n  public removeEffect(index: number): void;\n  public removeEffect(param: any) {\n    let indexToRemove = -1;\n    if (typeof param === 'number') {\n      indexToRemove = param;\n    } else {\n      indexToRemove = this.effects.indexOf(param);\n    }\n\n    // bounds check\n    if (indexToRemove < 0 || indexToRemove >= this.effects.length) {\n      return;\n    }\n\n    this.effects.splice(indexToRemove, 1);\n\n    // We must check if the texture and the backing sprite pixels are loaded as well before\n    // an effect can be applied\n    if (!this._texture.isLoaded() || !this._pixelsLoaded) {\n      this._dirtyEffect = true;\n    } else {\n      this._applyEffects();\n    }\n  }\n\n  private _applyEffects() {\n\n    this._flushTexture();\n\n    if (this.effects.length > 0) {\n      this._pixelData = this._spriteCtx.getImageData(0, 0, this.width, this.height);\n\n      const len = this.effects.length;\n      for (let i = 0; i < len; i++) {\n        for (let y = 0; y < this.height; y++) {\n          for (let x = 0; x < this.width; x++) {\n            this.effects[i].updatePixel(x, y, this._pixelData);\n          }\n        }\n      }\n      this._spriteCtx.clearRect(0, 0, this.width, this.height);\n      this._spriteCtx.putImageData(this._pixelData, 0, 0);\n    }\n\n    this._dirtyEffect = false;\n  }\n\n  /**\n   * Clears all effects from the drawing and return it to its original state.\n   */\n  public clearEffects() {\n    this.effects.length = 0;\n    this._applyEffects();\n  }\n\n  /**\n   * Resets the internal state of the drawing (if any)\n   */\n  public reset() {\n    // do nothing\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D, x: number, y: number) {\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate(this.rotation);\n    const xpoint = this.drawWidth * this.anchor.x;\n    const ypoint = this.drawHeight * this.anchor.y;\n\n    ctx.strokeStyle = Color.Black.toString();\n    ctx.strokeRect(-xpoint, -ypoint, this.drawWidth, this.drawHeight);\n    ctx.restore();\n  }\n\n  /**\n   * Draws the sprite appropriately to the 2D rendering context, at an x and y coordinate.\n   * @param ctx  The 2D rendering context\n   * @param x    The x coordinate of where to draw\n   * @param y    The y coordinate of where to draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\n  /**\n   * Draws the sprite with custom options to override internals without mutating them.\n   * @param options\n   */\n  public draw(options: DrawOptions): void;\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number): void {\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\n    } else {\n      this._drawWithOptions(ctxOrOptions);\n    }\n  }\n\n  private _drawWithOptions(options: DrawOptions) {\n    const { ctx, x, y, rotation, drawWidth, drawHeight, anchor, offset, opacity, flipHorizontal, flipVertical } = {\n      ...options,\n      rotation: options.rotation ?? this.rotation,\n      drawWidth: options.drawWidth ?? this.drawWidth,\n      drawHeight: options.drawHeight ?? this.drawHeight,\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\n      flipVertical: options.flipVertical ?? this.flipVertical,\n      anchor: options.anchor ?? this.anchor,\n      offset: options.offset ?? this.offset,\n      opacity: options.opacity ?? this._opacity\n    };\n\n    if (this._dirtyEffect) {\n      this._applyEffects();\n    }\n\n    // calculating current dimensions\n    ctx.save();\n    const xpoint = drawWidth * anchor.x + offset.x;\n    const ypoint = drawHeight * anchor.y + offset.y;\n    ctx.translate(x, y);\n    ctx.rotate(rotation);\n\n    if (flipHorizontal) {\n      ctx.translate(drawWidth, 0);\n      ctx.scale(-1, 1);\n    }\n\n    if (flipVertical) {\n      ctx.translate(0, drawHeight);\n      ctx.scale(1, -1);\n    }\n\n    const oldAlpha = ctx.globalAlpha;\n    ctx.globalAlpha = opacity ?? 1;\n    ctx.drawImage(this._spriteCanvas, 0, 0, this.width, this.height, -xpoint, -ypoint, drawWidth, drawHeight);\n    ctx.globalAlpha = oldAlpha;\n\n    ctx.restore();\n  }\n\n  /**\n   * Produces a copy of the current sprite\n   */\n  public clone(): SpriteImpl {\n    const result = new Sprite(this._texture, this.x, this.y, this.width, this.height);\n    result.scale = this.scale.clone();\n    result.rotation = this.rotation;\n    result.flipHorizontal = this.flipHorizontal;\n    result.flipVertical = this.flipVertical;\n\n    const len = this.effects.length;\n    for (let i = 0; i < len; i++) {\n      result.addEffect(this.effects[i]);\n    }\n    return result;\n  }\n}\n\nexport interface SpriteArgs extends Partial<SpriteImpl> {\n  image?: Texture;\n  x?: number;\n  width?: number;\n  height?: number;\n  rotation?: number;\n  anchor?: Vector;\n  scale?: Vector;\n  flipVertical?: boolean;\n  flipHorizontal?: boolean;\n}\n\n/**\n * A [[Sprite]] is one of the main drawing primitives. It is responsible for drawing\n * images or parts of images from a [[Texture]] resource to the screen.\n */\nexport class Sprite extends Configurable(SpriteImpl) {\n  constructor(config: SpriteArgs);\n  constructor(image: Texture, x: number, y: number, width: number, height: number);\n  constructor(imageOrConfig: Texture | SpriteArgs, x?: number, y?: number, width?: number, height?: number) {\n    super(imageOrConfig, x, y, width, height);\n  }\n}\n","/**\n * An enum that describes the strategies that rotation actions can use\n */\nexport enum RotationType {\n  /**\n   * Rotation via `ShortestPath` will use the smallest angle\n   * between the starting and ending points. This strategy is the default behavior.\n   */\n  ShortestPath = 0,\n  /**\n   * Rotation via `LongestPath` will use the largest angle\n   * between the starting and ending points.\n   */\n  LongestPath = 1,\n  /**\n   * Rotation via `Clockwise` will travel in a clockwise direction,\n   * regardless of the starting and ending points.\n   */\n  Clockwise = 2,\n  /**\n   * Rotation via `CounterClockwise` will travel in a counterclockwise direction,\n   * regardless of the starting and ending points.\n   */\n  CounterClockwise = 3\n}\n","import { Resource } from './Resource';\nimport { Sprite } from '../Drawing/Sprite';\n/**\n * The [[Texture]] object allows games built in Excalibur to load image resources.\n * [[Texture]] is an [[Loadable]] which means it can be passed to a [[Loader]]\n * to pre-load before starting a level or game.\n */\nexport class Texture extends Resource<string> {\n  /**\n   * The width of the texture in pixels\n   */\n  public width: number;\n\n  /**\n   * The height of the texture in pixels\n   */\n  public height: number;\n\n  /**\n   * A [[Promise]] that resolves when the Texture is loaded.\n   */\n  private _loadedResolve: (value?: HTMLImageElement) => void;\n  public loaded: Promise<HTMLImageElement> = new Promise<HTMLImageElement>((resolve) => {\n    this._loadedResolve = resolve;\n  });\n\n  private _isLoaded: boolean = false;\n  private _sprite: Sprite = null;\n\n  /**\n   * Populated once loading is complete\n   */\n  public image: HTMLImageElement;\n\n  /**\n   * @param path       Path to the image resource or a base64 string representing an image \"data:image/png;base64,iVB...\"\n   * @param bustCache  Optionally load texture with cache busting\n   */\n  constructor(public path: string, public bustCache = true) {\n    super(path, 'blob', bustCache);\n    this._sprite = new Sprite(this, 0, 0, 0, 0);\n  }\n\n  /**\n   * Returns true if the Texture is completely loaded and is ready\n   * to be drawn.\n   */\n  public isLoaded(): boolean {\n    return this._isLoaded;\n  }\n\n  /**\n   * Begins loading the texture and returns a promise to be resolved on completion\n   */\n  public async load(): Promise<HTMLImageElement> {\n    const complete = new Promise<HTMLImageElement>(async (resolve, reject) => {\n      this.image = new Image();\n      this.image.addEventListener('load', () => {\n        this._isLoaded = true;\n        this.width = this._sprite.width = this.image.naturalWidth;\n        this.height = this._sprite.height = this.image.naturalHeight;\n        this._sprite = new Sprite(this, 0, 0, this.width, this.height);\n        this._loadedResolve(this.image);\n        resolve(this.image);\n      });\n      if (this.path.indexOf('data:image/') > -1) {\n        this.image.src = this.path;\n        this.oncomplete();\n      } else {\n        try {\n          this.image.src = await super.load();\n        } catch (e) {\n          reject('Error loading texture');\n        }\n      }\n    });\n    return complete;\n  }\n\n  public asSprite(): Sprite {\n    return this._sprite;\n  }\n}\n","import { Sprite } from './Sprite';\nimport * as Effects from './SpriteEffects';\nimport { Color } from './Color';\n\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\nimport { Vector } from '../Algebra';\nimport { Engine } from '../Engine';\nimport * as Util from '../Util/Util';\nimport { Configurable } from '../Configurable';\n\nexport interface HasTick {\n  /**\n   *\n   * @param elapsedMilliseconds The amount of real world time in milliseconds that has elapsed that must be updated in the animation\n   */\n  tick(elapsedMilliseconds: number, idempotencyToken?: number): void;\n}\n\n/**\n * @hidden\n */\nexport class AnimationImpl implements Drawable, HasTick {\n  /**\n   * The sprite frames to play, in order. See [[SpriteSheet.getAnimationForAll]] to quickly\n   * generate an [[Animation]].\n   */\n  public sprites: Sprite[] = [];\n\n  /**\n   * Duration to show each frame (in milliseconds)\n   */\n  public speed: number;\n\n  /**\n   * Current frame index being shown\n   */\n  public currentFrame: number = 0;\n\n  private _timeLeftInFrame: number = 0;\n  private _idempotencyToken: number = -1;\n\n  public anchor: Vector = Vector.Zero;\n  public rotation: number = 0.0;\n  public scale: Vector = Vector.One;\n\n  /**\n   * Indicates whether the animation should loop after it is completed\n   */\n  public loop: boolean = true;\n\n  /**\n   * Indicates the frame index the animation should freeze on for a non-looping\n   * animation. By default it is the last frame.\n   */\n  public freezeFrame: number = -1;\n\n  private _engine: Engine;\n\n  /**\n   * Flip each frame vertically. Sets [[Sprite.flipVertical]].\n   */\n  public flipVertical: boolean = false;\n\n  /**\n   * Flip each frame horizontally. Sets [[Sprite.flipHorizontal]].\n   */\n  public flipHorizontal: boolean = false;\n\n  public drawWidth: number = 0;\n  public drawHeight: number = 0;\n  public width: number = 0;\n  public height: number = 0;\n\n  private _opacity = 1;\n\n  /**\n   * Typically you will use a [[SpriteSheet]] to generate an [[Animation]].\n   *\n   * @param engineOrConfig  Reference to the current game engine\n   * @param sprites  An array of sprites to create the frames for the animation\n   * @param speed   The number in milliseconds to display each frame in the animation\n   * @param loop    Indicates whether the animation should loop after it is completed\n   */\n  constructor(engineOrConfig: Engine | AnimationArgs, sprites: Sprite[], speed: number, loop?: boolean) {\n    let engine = engineOrConfig;\n    if (engineOrConfig && !(engineOrConfig instanceof Engine)) {\n      const config = engineOrConfig;\n      engine = config.engine;\n      sprites = config.sprites;\n      speed = config.speed;\n      loop = config.loop;\n    }\n\n    this.sprites = sprites;\n    this.speed = speed;\n    this._engine = <Engine>engine;\n    this._timeLeftInFrame = this.speed;\n\n    if (loop != null) {\n      this.loop = loop;\n    }\n\n    if (sprites && sprites[0]) {\n      this.drawHeight = sprites[0] ? sprites[0].drawHeight : 0;\n      this.drawWidth = sprites[0] ? sprites[0].drawWidth : 0;\n\n      this.width = sprites[0] ? sprites[0].width : 0;\n      this.height = sprites[0] ? sprites[0].height : 0;\n\n      this.freezeFrame = sprites.length - 1;\n    }\n  }\n\n  /**\n   * Applies the opacity effect to a sprite, setting the alpha of all pixels to a given value\n   */\n  public opacity(value: number) {\n    this._opacity = value;\n  }\n\n  /**\n   * Applies the grayscale effect to a sprite, removing color information.\n   */\n  public grayscale() {\n    this.addEffect(new Effects.Grayscale());\n  }\n\n  /**\n   * Applies the invert effect to a sprite, inverting the pixel colors.\n   */\n  public invert() {\n    this.addEffect(new Effects.Invert());\n  }\n\n  /**\n   * Applies the fill effect to a sprite, changing the color channels of all non-transparent pixels to match a given color\n   */\n  public fill(color: Color) {\n    this.addEffect(new Effects.Fill(color));\n  }\n\n  /**\n   * Applies the colorize effect to a sprite, changing the color channels of all pixels to be the average of the original color and the\n   * provided color.\n   */\n  public colorize(color: Color) {\n    this.addEffect(new Effects.Colorize(color));\n  }\n\n  /**\n   * Applies the lighten effect to a sprite, changes the lightness of the color according to hsl\n   */\n  public lighten(factor: number = 0.1) {\n    this.addEffect(new Effects.Lighten(factor));\n  }\n\n  /**\n   * Applies the darken effect to a sprite, changes the darkness of the color according to hsl\n   */\n  public darken(factor: number = 0.1) {\n    this.addEffect(new Effects.Darken(factor));\n  }\n\n  /**\n   * Applies the saturate effect to a sprite, saturates the color according to hsl\n   */\n  public saturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Saturate(factor));\n  }\n\n  /**\n   * Applies the desaturate effect to a sprite, desaturates the color according to hsl\n   */\n  public desaturate(factor: number = 0.1) {\n    this.addEffect(new Effects.Desaturate(factor));\n  }\n\n  /**\n   * Add a [[SpriteEffect]] manually\n   */\n  public addEffect(effect: Effects.SpriteEffect) {\n    for (const i in this.sprites) {\n      this.sprites[i].addEffect(effect);\n    }\n  }\n\n  /**\n   * Removes an [[SpriteEffect]] from this animation.\n   * @param effect Effect to remove from this animation\n   */\n  public removeEffect(effect: Effects.SpriteEffect): void;\n\n  /**\n   * Removes an effect given the index from this animation.\n   * @param index  Index of the effect to remove from this animation\n   */\n  public removeEffect(index: number): void;\n  public removeEffect(param: any) {\n    for (const i in this.sprites) {\n      this.sprites[i].removeEffect(param);\n    }\n  }\n\n  /**\n   * Clear all sprite effects\n   */\n  public clearEffects() {\n    for (const i in this.sprites) {\n      this.sprites[i].clearEffects();\n    }\n  }\n\n  private _setAnchor(point: Vector) {\n    //if (!this.anchor.equals(point)) {\n    for (const i in this.sprites) {\n      this.sprites[i].anchor.setTo(point.x, point.y);\n    }\n    //}\n  }\n\n  private _setRotation(radians: number) {\n    //if (this.rotation !== radians) {\n    for (const i in this.sprites) {\n      this.sprites[i].rotation = radians;\n    }\n    //}\n  }\n\n  private _setScale(scale: Vector) {\n    //if (!this.scale.equals(scale)) {\n    for (const i in this.sprites) {\n      this.sprites[i].scale = scale;\n    }\n    //}\n  }\n\n  /**\n   * Resets the animation to first frame.\n   */\n  public reset() {\n    this.currentFrame = 0;\n  }\n\n  /**\n   * Indicates whether the animation is complete, animations that loop are never complete.\n   */\n  public isDone() {\n    return !this.loop && this.currentFrame >= this.sprites.length;\n  }\n\n  /**\n   * Not meant to be called by game developers. Ticks the animation forward internally and\n   * calculates whether to change to the frame.\n   * @internal\n   */\n  public tick(elapsed: number, idempotencyToken?: number) {\n    if (this._idempotencyToken === idempotencyToken) {\n      return;\n    }\n    this._idempotencyToken = idempotencyToken;\n    this._timeLeftInFrame -= elapsed;\n    if (this._timeLeftInFrame <= 0) {\n      this.currentFrame = this.loop ? (this.currentFrame + 1) % this.sprites.length : this.currentFrame + 1;\n      this._timeLeftInFrame = this.speed;\n    }\n\n    this._updateValues();\n    const current = this.sprites[this.currentFrame];\n    if (current) {\n      this.width = current.width;\n      this.height = current.height;\n      this.drawWidth = current.drawWidth;\n      this.drawHeight = current.drawHeight;\n    }\n  }\n\n  private _updateValues(): void {\n    this._setAnchor(this.anchor);\n    this._setRotation(this.rotation);\n    this._setScale(this.scale);\n  }\n\n  /**\n   * Skips ahead a specified number of frames in the animation\n   * @param frames  Frames to skip ahead\n   */\n  public skip(frames: number) {\n    this.currentFrame = (this.currentFrame + frames) % this.sprites.length;\n  }\n\n  /**\n   * Draws the animation appropriately to the 2D rendering context, at an x and y coordinate.\n   * @param ctx  The 2D rendering context\n   * @param x    The x coordinate of where to draw\n   * @param y    The y coordinate of where to draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\n  /**\n   * Draws the animation with custom options to override internals without mutating them.\n   * @param options\n   */\n  public draw(options: DrawOptions): void;\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number) {\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\n    } else {\n      this._drawWithOptions(ctxOrOptions);\n    }\n  }\n\n  private _drawWithOptions(options: DrawOptions) {\n    const animOptions = {\n      ...options,\n      rotation: options.rotation ?? this.rotation,\n      drawWidth: options.drawWidth ?? this.drawWidth,\n      drawHeight: options.drawHeight ?? this.drawHeight,\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\n      flipVertical: options.flipVertical ?? this.flipVertical,\n      anchor: options.anchor ?? this.anchor,\n      opacity: options.opacity ?? this._opacity\n    };\n\n    this._updateValues();\n    let currSprite: Sprite;\n    if (this.currentFrame < this.sprites.length) {\n      currSprite = this.sprites[this.currentFrame];\n      currSprite.draw(animOptions);\n    }\n\n    if (this.freezeFrame !== -1 && this.currentFrame >= this.sprites.length) {\n      currSprite = this.sprites[Util.clamp(this.freezeFrame, 0, this.sprites.length - 1)];\n      currSprite.draw(animOptions);\n    }\n\n    // add the calculated width\n    if (currSprite) {\n      this.drawWidth = currSprite.drawWidth;\n      this.drawHeight = currSprite.drawHeight;\n    }\n  }\n\n  /**\n   * Plays an animation at an arbitrary location in the game.\n   * @param x  The x position in the game to play\n   * @param y  The y position in the game to play\n   */\n  public play(x: number, y: number) {\n    this.reset();\n    this._engine.playAnimation(this, x, y);\n  }\n}\n\nexport interface AnimationArgs extends Partial<AnimationImpl> {\n  engine: Engine;\n  sprites: Sprite[];\n  speed: number;\n  loop?: boolean;\n  anchor?: Vector;\n  rotation?: number;\n  scale?: Vector;\n  flipVertical?: boolean;\n  flipHorizontal?: boolean;\n  width?: number;\n  height?: number;\n}\n\n/**\n * Animations allow you to display a series of images one after another,\n * creating the illusion of change. Generally these images will come from a [[SpriteSheet]] source.\n */\nexport class Animation extends Configurable(AnimationImpl) {\n  constructor(config: AnimationArgs);\n  constructor(engine: Engine, images: Sprite[], speed: number, loop?: boolean);\n  constructor(engineOrConfig: Engine | AnimationArgs, images?: Sprite[], speed?: number, loop?: boolean) {\n    super(engineOrConfig, images, speed, loop);\n  }\n}\n","import { RotationType } from './RotationType';\n\nimport { Actor } from '../Actor';\nimport { Vector } from '../Algebra';\nimport { Logger } from '../Util/Log';\nimport * as Util from '../Util/Util';\nimport { obsolete } from '../Util/Decorators';\n\n/**\n * Used for implementing actions for the [[ActionContext|Action API]].\n */\nexport interface Action {\n  update(delta: number): void;\n  isComplete(actor: Actor): boolean;\n  reset(): void;\n  stop(): void;\n}\n\nexport class EaseTo implements Action {\n  private _currentLerpTime: number = 0;\n  private _lerpDuration: number = 1 * 1000; // 1 second\n  private _lerpStart: Vector = new Vector(0, 0);\n  private _lerpEnd: Vector = new Vector(0, 0);\n  private _initialized: boolean = false;\n  private _stopped: boolean = false;\n  private _distance: number = 0;\n  constructor(\n    public actor: Actor,\n    x: number,\n    y: number,\n    duration: number,\n    public easingFcn: (currentTime: number, startValue: number, endValue: number, duration: number) => number\n  ) {\n    this._lerpDuration = duration;\n    this._lerpEnd = new Vector(x, y);\n  }\n  private _initialize() {\n    this._lerpStart = new Vector(this.actor.pos.x, this.actor.pos.y);\n    this._currentLerpTime = 0;\n    this._distance = this._lerpStart.distance(this._lerpEnd);\n  }\n\n  public update(delta: number): void {\n    if (!this._initialized) {\n      this._initialize();\n      this._initialized = true;\n    }\n\n    // Need to update lerp time first, otherwise the first update will always be zero\n    this._currentLerpTime += delta;\n    let newX = this.actor.pos.x;\n    let newY = this.actor.pos.y;\n    if (this._currentLerpTime < this._lerpDuration) {\n      if (this._lerpEnd.x < this._lerpStart.x) {\n        newX =\n          this._lerpStart.x -\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.x, this._lerpStart.x, this._lerpDuration) - this._lerpEnd.x);\n      } else {\n        newX = this.easingFcn(this._currentLerpTime, this._lerpStart.x, this._lerpEnd.x, this._lerpDuration);\n      }\n\n      if (this._lerpEnd.y < this._lerpStart.y) {\n        newY =\n          this._lerpStart.y -\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.y, this._lerpStart.y, this._lerpDuration) - this._lerpEnd.y);\n      } else {\n        newY = this.easingFcn(this._currentLerpTime, this._lerpStart.y, this._lerpEnd.y, this._lerpDuration);\n      }\n      // Given the lerp position figure out the velocity in pixels per second\n      this.actor.vel.x = (newX - this.actor.pos.x) / (delta / 1000);\n      this.actor.vel.y = (newY - this.actor.pos.y) / (delta / 1000);\n    } else {\n      this.actor.pos.x = this._lerpEnd.x;\n      this.actor.pos.y = this._lerpEnd.y;\n      this.actor.vel = Vector.Zero;\n      //this._lerpStart = null;\n      //this._lerpEnd = null;\n      //this._currentLerpTime = 0;\n    }\n  }\n  public isComplete(actor: Actor): boolean {\n    return this._stopped || new Vector(actor.pos.x, actor.pos.y).distance(this._lerpStart) >= this._distance;\n  }\n\n  public reset(): void {\n    this._initialized = false;\n  }\n  public stop(): void {\n    this.actor.vel.y = 0;\n    this.actor.vel.x = 0;\n    this._stopped = true;\n  }\n}\n\nexport class MoveTo implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _start: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _distance: number;\n  private _started = false;\n  private _stopped = false;\n  constructor(actor: Actor, destx: number, desty: number, speed: number) {\n    this._actor = actor;\n    this._end = new Vector(destx, desty);\n    this._speed = speed;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._start = new Vector(this._actor.pos.x, this._actor.pos.y);\n      this._distance = this._start.distance(this._end);\n      this._dir = this._end.sub(this._start).normalize();\n    }\n    const m = this._dir.scale(this._speed);\n    this._actor.vel.x = m.x;\n    this._actor.vel.y = m.y;\n\n    if (this.isComplete(this._actor)) {\n      this._actor.pos.x = this._end.x;\n      this._actor.pos.y = this._end.y;\n      this._actor.vel.y = 0;\n      this._actor.vel.x = 0;\n    }\n  }\n\n  public isComplete(actor: Actor): boolean {\n    return this._stopped || new Vector(actor.pos.x, actor.pos.y).distance(this._start) >= this._distance;\n  }\n\n  public stop(): void {\n    this._actor.vel.y = 0;\n    this._actor.vel.x = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class MoveBy implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _distance: number;\n  private _speed: number;\n\n  private _start: Vector;\n  private _offset: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _started = false;\n  private _stopped = false;\n\n  constructor(actor: Actor, offsetX: number, offsetY: number, speed: number) {\n    this._actor = actor;\n    this._speed = speed;\n    this._offset = new Vector(offsetX, offsetY);\n    if (speed <= 0) {\n      Logger.getInstance().error('Attempted to moveBy with speed less than or equal to zero : ' + speed);\n      throw new Error('Speed must be greater than 0 pixels per second');\n    }\n  }\n\n  public update(_delta: number) {\n    if (!this._started) {\n      this._started = true;\n      this._start = new Vector(this._actor.pos.x, this._actor.pos.y);\n      this._end = this._start.add(this._offset);\n      this._distance = this._offset.size;\n      this._dir = this._end.sub(this._start).normalize();\n    }\n\n    this._actor.vel = this._dir.scale(this._speed);\n\n    if (this.isComplete(this._actor)) {\n      this._actor.pos.x = this._end.x;\n      this._actor.pos.y = this._end.y;\n      this._actor.vel.y = 0;\n      this._actor.vel.x = 0;\n    }\n  }\n\n  public isComplete(actor: Actor): boolean {\n    return this._stopped || actor.pos.distance(this._start) >= this._distance;\n  }\n\n  public stop(): void {\n    this._actor.vel.y = 0;\n    this._actor.vel.x = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class Follow implements Action {\n  private _actor: Actor;\n  private _actorToFollow: Actor;\n  public x: number;\n  public y: number;\n  private _current: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _maximumDistance: number;\n  private _distanceBetween: number;\n  private _started = false;\n  private _stopped = false;\n\n  constructor(actor: Actor, actorToFollow: Actor, followDistance?: number) {\n    this._actor = actor;\n    this._actorToFollow = actorToFollow;\n    this._current = new Vector(this._actor.pos.x, this._actor.pos.y);\n    this._end = new Vector(actorToFollow.pos.x, actorToFollow.pos.y);\n    this._maximumDistance = followDistance !== undefined ? followDistance : this._current.distance(this._end);\n    this._speed = 0;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._distanceBetween = this._current.distance(this._end);\n      this._dir = this._end.sub(this._current).normalize();\n    }\n\n    const actorToFollowSpeed = Math.sqrt(Math.pow(this._actorToFollow.vel.x, 2) + Math.pow(this._actorToFollow.vel.y, 2));\n    if (actorToFollowSpeed !== 0) {\n      this._speed = actorToFollowSpeed;\n    }\n    this._current.x = this._actor.pos.x;\n    this._current.y = this._actor.pos.y;\n\n    this._end.x = this._actorToFollow.pos.x;\n    this._end.y = this._actorToFollow.pos.y;\n    this._distanceBetween = this._current.distance(this._end);\n    this._dir = this._end.sub(this._current).normalize();\n\n    if (this._distanceBetween >= this._maximumDistance) {\n      const m = this._dir.scale(this._speed);\n      this._actor.vel.x = m.x;\n      this._actor.vel.y = m.y;\n    } else {\n      this._actor.vel.x = 0;\n      this._actor.vel.y = 0;\n    }\n\n    if (this.isComplete()) {\n      this._actor.pos.x = this._end.x;\n      this._actor.pos.y = this._end.y;\n      this._actor.vel.y = 0;\n      this._actor.vel.x = 0;\n    }\n  }\n\n  public stop(): void {\n    this._actor.vel.y = 0;\n    this._actor.vel.x = 0;\n    this._stopped = true;\n  }\n\n  public isComplete(): boolean {\n    // the actor following should never stop unless specified to do so\n    return this._stopped;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class Meet implements Action {\n  private _actor: Actor;\n  private _actorToMeet: Actor;\n  public x: number;\n  public y: number;\n  private _current: Vector;\n  private _end: Vector;\n  private _dir: Vector;\n  private _speed: number;\n  private _distanceBetween: number;\n  private _started = false;\n  private _stopped = false;\n  private _speedWasSpecified = false;\n\n  constructor(actor: Actor, actorToMeet: Actor, speed?: number) {\n    this._actor = actor;\n    this._actorToMeet = actorToMeet;\n    this._current = new Vector(this._actor.pos.x, this._actor.pos.y);\n    this._end = new Vector(actorToMeet.pos.x, actorToMeet.pos.y);\n    this._speed = speed || 0;\n\n    if (speed !== undefined) {\n      this._speedWasSpecified = true;\n    }\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._distanceBetween = this._current.distance(this._end);\n      this._dir = this._end.sub(this._current).normalize();\n    }\n\n    const actorToMeetSpeed = Math.sqrt(Math.pow(this._actorToMeet.vel.x, 2) + Math.pow(this._actorToMeet.vel.y, 2));\n    if (actorToMeetSpeed !== 0 && !this._speedWasSpecified) {\n      this._speed = actorToMeetSpeed;\n    }\n    this._current.x = this._actor.pos.x;\n    this._current.y = this._actor.pos.y;\n\n    this._end.x = this._actorToMeet.pos.x;\n    this._end.y = this._actorToMeet.pos.y;\n    this._distanceBetween = this._current.distance(this._end);\n    this._dir = this._end.sub(this._current).normalize();\n\n    const m = this._dir.scale(this._speed);\n    this._actor.vel.x = m.x;\n    this._actor.vel.y = m.y;\n\n    if (this.isComplete()) {\n      this._actor.pos.x = this._end.x;\n      this._actor.pos.y = this._end.y;\n      this._actor.vel.y = 0;\n      this._actor.vel.x = 0;\n    }\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || this._distanceBetween <= 1;\n  }\n\n  public stop(): void {\n    this._actor.vel.y = 0;\n    this._actor.vel.x = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class RotateTo implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _start: number;\n  private _end: number;\n  private _speed: number;\n  private _rotationType: RotationType;\n  private _direction: number;\n  private _distance: number;\n  private _shortDistance: number;\n  private _longDistance: number;\n  private _shortestPathIsPositive: boolean;\n  private _started = false;\n  private _stopped = false;\n  constructor(actor: Actor, angleRadians: number, speed: number, rotationType?: RotationType) {\n    this._actor = actor;\n    this._end = angleRadians;\n    this._speed = speed;\n    this._rotationType = rotationType || RotationType.ShortestPath;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._start = this._actor.rotation;\n      const distance1 = Math.abs(this._end - this._start);\n      const distance2 = Util.TwoPI - distance1;\n      if (distance1 > distance2) {\n        this._shortDistance = distance2;\n        this._longDistance = distance1;\n      } else {\n        this._shortDistance = distance1;\n        this._longDistance = distance2;\n      }\n\n      this._shortestPathIsPositive = (this._start - this._end + Util.TwoPI) % Util.TwoPI >= Math.PI;\n\n      switch (this._rotationType) {\n        case RotationType.ShortestPath:\n          this._distance = this._shortDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = 1;\n          } else {\n            this._direction = -1;\n          }\n          break;\n        case RotationType.LongestPath:\n          this._distance = this._longDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = -1;\n          } else {\n            this._direction = 1;\n          }\n          break;\n        case RotationType.Clockwise:\n          this._direction = 1;\n          if (this._shortestPathIsPositive) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n        case RotationType.CounterClockwise:\n          this._direction = -1;\n          if (!this._shortestPathIsPositive) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n      }\n    }\n\n    this._actor.rx = this._direction * this._speed;\n\n    if (this.isComplete()) {\n      this._actor.rotation = this._end;\n      this._actor.rx = 0;\n      this._stopped = true;\n    }\n  }\n\n  public isComplete(): boolean {\n    const distanceTravelled = Math.abs(this._actor.rotation - this._start);\n    return this._stopped || distanceTravelled >= Math.abs(this._distance);\n  }\n\n  public stop(): void {\n    this._actor.rx = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class RotateBy implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _start: number;\n  private _end: number;\n  private _speed: number;\n  private _offset: number;\n\n  private _rotationType: RotationType;\n  private _direction: number;\n  private _distance: number;\n  private _shortDistance: number;\n  private _longDistance: number;\n  private _shortestPathIsPositive: boolean;\n  private _started = false;\n  private _stopped = false;\n  constructor(actor: Actor, angleRadiansOffset: number, speed: number, rotationType?: RotationType) {\n    this._actor = actor;\n    this._speed = speed;\n    this._offset = angleRadiansOffset;\n    this._rotationType = rotationType || RotationType.ShortestPath;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._start = this._actor.rotation;\n      this._end = this._start + this._offset;\n\n      const distance1 = Math.abs(this._end - this._start);\n      const distance2 = Util.TwoPI - distance1;\n      if (distance1 > distance2) {\n        this._shortDistance = distance2;\n        this._longDistance = distance1;\n      } else {\n        this._shortDistance = distance1;\n        this._longDistance = distance2;\n      }\n\n      this._shortestPathIsPositive = (this._start - this._end + Util.TwoPI) % Util.TwoPI >= Math.PI;\n\n      switch (this._rotationType) {\n        case RotationType.ShortestPath:\n          this._distance = this._shortDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = 1;\n          } else {\n            this._direction = -1;\n          }\n          break;\n        case RotationType.LongestPath:\n          this._distance = this._longDistance;\n          if (this._shortestPathIsPositive) {\n            this._direction = -1;\n          } else {\n            this._direction = 1;\n          }\n          break;\n        case RotationType.Clockwise:\n          this._direction = 1;\n          if (this._shortDistance >= 0) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n        case RotationType.CounterClockwise:\n          this._direction = -1;\n          if (this._shortDistance <= 0) {\n            this._distance = this._shortDistance;\n          } else {\n            this._distance = this._longDistance;\n          }\n          break;\n      }\n    }\n\n    this._actor.rx = this._direction * this._speed;\n\n    if (this.isComplete()) {\n      this._actor.rotation = this._end;\n      this._actor.rx = 0;\n      this._stopped = true;\n    }\n  }\n\n  public isComplete(): boolean {\n    const distanceTravelled = Math.abs(this._actor.rotation - this._start);\n    return this._stopped || distanceTravelled >= Math.abs(this._distance);\n  }\n\n  public stop(): void {\n    this._actor.rx = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\n@obsolete({ message: 'ex.Action.ScaleTo will be removed in v0.25.0', alternateMethod: 'Set width and hight directly' })\nexport class ScaleTo implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _startX: number;\n  private _startY: number;\n  private _endX: number;\n  private _endY: number;\n  private _speedX: number;\n  private _speedY: number;\n  private _distanceX: number;\n  private _distanceY: number;\n  private _started = false;\n  private _stopped = false;\n  constructor(actor: Actor, scaleX: number, scaleY: number, speedX: number, speedY: number) {\n    this._actor = actor;\n    this._endX = scaleX;\n    this._endY = scaleY;\n    this._speedX = speedX;\n    this._speedY = speedY;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._startX = this._actor.scale.x;\n      this._startY = this._actor.scale.y;\n      this._distanceX = Math.abs(this._endX - this._startX);\n      this._distanceY = Math.abs(this._endY - this._startY);\n    }\n\n    if (!(Math.abs(this._actor.scale.x - this._startX) >= this._distanceX)) {\n      const directionX = this._endY < this._startY ? -1 : 1;\n      this._actor.sx = this._speedX * directionX;\n    } else {\n      this._actor.sx = 0;\n    }\n\n    if (!(Math.abs(this._actor.scale.y - this._startY) >= this._distanceY)) {\n      const directionY = this._endY < this._startY ? -1 : 1;\n      this._actor.sy = this._speedY * directionY;\n    } else {\n      this._actor.sy = 0;\n    }\n\n    if (this.isComplete()) {\n      this._actor.scale.x = this._endX;\n      this._actor.scale.y = this._endY;\n      this._actor.sx = 0;\n      this._actor.sy = 0;\n    }\n  }\n\n  public isComplete(): boolean {\n    return (\n      this._stopped ||\n      (Math.abs(this._actor.scale.y - this._startX) >= this._distanceX && Math.abs(this._actor.scale.y - this._startY) >= this._distanceY)\n    );\n  }\n\n  public stop(): void {\n    this._actor.sx = 0;\n    this._actor.sy = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\n@obsolete({ message: 'ex.Action.ScaleBy will be removed in v0.25.0', alternateMethod: 'Set width and hight directly' })\nexport class ScaleBy implements Action {\n  private _actor: Actor;\n  public x: number;\n  public y: number;\n  private _startScale: Vector;\n  private _endScale: Vector;\n  private _offset: Vector;\n  private _distanceX: number;\n  private _distanceY: number;\n  private _directionX: number;\n  private _directionY: number;\n  private _started = false;\n  private _stopped = false;\n  private _speedX: number;\n  private _speedY: number;\n  constructor(actor: Actor, scaleOffsetX: number, scaleOffsetY: number, speed: number) {\n    this._actor = actor;\n    this._offset = new Vector(scaleOffsetX, scaleOffsetY);\n    this._speedX = this._speedY = speed;\n  }\n\n  public update(_delta: number): void {\n    if (!this._started) {\n      this._started = true;\n      this._startScale = this._actor.scale.clone();\n      this._endScale = this._startScale.add(this._offset);\n      this._distanceX = Math.abs(this._endScale.x - this._startScale.x);\n      this._distanceY = Math.abs(this._endScale.y - this._startScale.y);\n      this._directionX = this._endScale.x < this._startScale.x ? -1 : 1;\n      this._directionY = this._endScale.y < this._startScale.y ? -1 : 1;\n    }\n\n    this._actor.sx = this._speedX * this._directionX;\n    this._actor.sy = this._speedY * this._directionY;\n\n    if (this.isComplete()) {\n      this._actor.scale = this._endScale;\n      this._actor.sx = 0;\n      this._actor.sy = 0;\n    }\n  }\n\n  public isComplete(): boolean {\n    return (\n      this._stopped ||\n      (Math.abs(this._actor.scale.x - this._startScale.x) >= this._distanceX &&\n        Math.abs(this._actor.scale.y - this._startScale.y) >= this._distanceY)\n    );\n  }\n\n  public stop(): void {\n    this._actor.sx = 0;\n    this._actor.sy = 0;\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class Delay implements Action {\n  public x: number;\n  public y: number;\n  private _actor: Actor;\n  private _elapsedTime: number = 0;\n  private _delay: number;\n  private _started: boolean = false;\n  private _stopped = false;\n  constructor(actor: Actor, delay: number) {\n    this._actor = actor;\n    this._delay = delay;\n  }\n\n  public update(delta: number): void {\n    if (!this._started) {\n      this._started = true;\n    }\n\n    this.x = this._actor.pos.x;\n    this.y = this._actor.pos.y;\n\n    this._elapsedTime += delta;\n  }\n\n  isComplete(): boolean {\n    return this._stopped || this._elapsedTime >= this._delay;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n  }\n\n  reset(): void {\n    this._elapsedTime = 0;\n    this._started = false;\n  }\n}\n\nexport class Blink implements Action {\n  private _timeVisible: number = 0;\n  private _timeNotVisible: number = 0;\n  private _elapsedTime: number = 0;\n  private _totalTime: number = 0;\n  private _actor: Actor;\n  private _duration: number;\n  private _stopped: boolean = false;\n  private _started: boolean = false;\n  constructor(actor: Actor, timeVisible: number, timeNotVisible: number, numBlinks: number = 1) {\n    this._actor = actor;\n    this._timeVisible = timeVisible;\n    this._timeNotVisible = timeNotVisible;\n    this._duration = (timeVisible + timeNotVisible) * numBlinks;\n  }\n\n  public update(delta: number): void {\n    if (!this._started) {\n      this._started = true;\n    }\n\n    this._elapsedTime += delta;\n    this._totalTime += delta;\n    if (this._actor.visible && this._elapsedTime >= this._timeVisible) {\n      this._actor.visible = false;\n      this._elapsedTime = 0;\n    }\n\n    if (!this._actor.visible && this._elapsedTime >= this._timeNotVisible) {\n      this._actor.visible = true;\n      this._elapsedTime = 0;\n    }\n\n    if (this.isComplete()) {\n      this._actor.visible = true;\n    }\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || this._totalTime >= this._duration;\n  }\n\n  public stop(): void {\n    this._actor.visible = true;\n    this._stopped = true;\n  }\n\n  public reset() {\n    this._started = false;\n    this._elapsedTime = 0;\n    this._totalTime = 0;\n  }\n}\n\nexport class Fade implements Action {\n  public x: number;\n  public y: number;\n\n  private _actor: Actor;\n  private _endOpacity: number;\n  private _speed: number;\n  private _multiplier: number = 1;\n  private _started = false;\n  private _stopped = false;\n\n  constructor(actor: Actor, endOpacity: number, speed: number) {\n    this._actor = actor;\n    this._endOpacity = endOpacity;\n    this._speed = speed;\n  }\n\n  public update(delta: number): void {\n    if (!this._started) {\n      this._started = true;\n\n      // determine direction when we start\n      if (this._endOpacity < this._actor.opacity) {\n        this._multiplier = -1;\n      } else {\n        this._multiplier = 1;\n      }\n    }\n\n    if (this._speed > 0) {\n      this._actor.opacity += (this._multiplier * (Math.abs(this._actor.opacity - this._endOpacity) * delta)) / this._speed;\n    }\n\n    this._speed -= delta;\n\n    if (this.isComplete()) {\n      this._actor.opacity = this._endOpacity;\n    }\n\n    Logger.getInstance().debug('[Action fade] Actor opacity:', this._actor.opacity);\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || Math.abs(this._actor.opacity - this._endOpacity) < 0.05;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._started = false;\n  }\n}\n\nexport class Die implements Action {\n  public x: number;\n  public y: number;\n\n  private _actor: Actor;\n  private _stopped = false;\n\n  constructor(actor: Actor) {\n    this._actor = actor;\n  }\n\n  public update(_delta: number): void {\n    this._actor.actionQueue.clearActions();\n    this._actor.kill();\n    this._stopped = true;\n  }\n\n  public isComplete(): boolean {\n    return this._stopped;\n  }\n\n  public stop(): void {\n    return;\n  }\n\n  public reset(): void {\n    return;\n  }\n}\n\nexport class CallMethod implements Action {\n  public x: number;\n  public y: number;\n  private _method: () => any = null;\n  private _actor: Actor = null;\n  private _hasBeenCalled: boolean = false;\n  constructor(actor: Actor, method: () => any) {\n    this._actor = actor;\n    this._method = method;\n  }\n\n  public update(_delta: number) {\n    this._method.call(this._actor);\n    this._hasBeenCalled = true;\n  }\n  public isComplete() {\n    return this._hasBeenCalled;\n  }\n  public reset() {\n    this._hasBeenCalled = false;\n  }\n  public stop() {\n    this._hasBeenCalled = true;\n  }\n}\n\nexport class Repeat implements Action {\n  public x: number;\n  public y: number;\n  private _actor: Actor;\n  private _actionQueue: ActionQueue;\n  private _repeat: number;\n  private _originalRepeat: number;\n  private _stopped: boolean = false;\n  constructor(actor: Actor, repeat: number, actions: Action[]) {\n    this._actor = actor;\n    this._actionQueue = new ActionQueue(actor);\n    this._repeat = repeat;\n    this._originalRepeat = repeat;\n\n    const len = actions.length;\n    for (let i = 0; i < len; i++) {\n      actions[i].reset();\n      this._actionQueue.add(actions[i]);\n    }\n  }\n\n  public update(delta: number): void {\n    this.x = this._actor.pos.x;\n    this.y = this._actor.pos.y;\n    if (!this._actionQueue.hasNext()) {\n      this._actionQueue.reset();\n      this._repeat--;\n    }\n    this._actionQueue.update(delta);\n  }\n\n  public isComplete(): boolean {\n    return this._stopped || this._repeat <= 0;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n  }\n\n  public reset(): void {\n    this._repeat = this._originalRepeat;\n  }\n}\n\nexport class RepeatForever implements Action {\n  public x: number;\n  public y: number;\n  private _actor: Actor;\n  private _actionQueue: ActionQueue;\n  private _stopped: boolean = false;\n  constructor(actor: Actor, actions: Action[]) {\n    this._actor = actor;\n    this._actionQueue = new ActionQueue(actor);\n\n    const len = actions.length;\n    for (let i = 0; i < len; i++) {\n      actions[i].reset();\n      this._actionQueue.add(actions[i]);\n    }\n  }\n\n  public update(delta: number): void {\n    this.x = this._actor.pos.x;\n    this.y = this._actor.pos.y;\n    if (this._stopped) {\n      return;\n    }\n\n    if (!this._actionQueue.hasNext()) {\n      this._actionQueue.reset();\n    }\n\n    this._actionQueue.update(delta);\n  }\n\n  public isComplete(): boolean {\n    return this._stopped;\n  }\n\n  public stop(): void {\n    this._stopped = true;\n    this._actionQueue.clearActions();\n  }\n\n  public reset(): void {\n    return;\n  }\n}\n\n/**\n * Action Queues\n *\n * Action queues are part of the [[ActionContext|Action API]] and\n * store the list of actions to be executed for an [[Actor]].\n *\n * Actors implement [[Actor.actions]] which can be manipulated by\n * advanced users to adjust the actions currently being executed in the\n * queue.\n */\nexport class ActionQueue {\n  private _actor: Actor;\n  private _actions: Action[] = [];\n  private _currentAction: Action;\n  private _completedActions: Action[] = [];\n  constructor(actor: Actor) {\n    this._actor = actor;\n  }\n\n  public add(action: Action) {\n    this._actions.push(action);\n  }\n\n  public remove(action: Action) {\n    const index = this._actions.indexOf(action);\n    this._actions.splice(index, 1);\n  }\n\n  public clearActions(): void {\n    this._actions.length = 0;\n    this._completedActions.length = 0;\n    if (this._currentAction) {\n      this._currentAction.stop();\n    }\n  }\n\n  public getActions(): Action[] {\n    return this._actions.concat(this._completedActions);\n  }\n\n  public hasNext(): boolean {\n    return this._actions.length > 0;\n  }\n\n  public reset(): void {\n    this._actions = this.getActions();\n\n    const len = this._actions.length;\n    for (let i = 0; i < len; i++) {\n      this._actions[i].reset();\n    }\n    this._completedActions = [];\n  }\n\n  public update(delta: number) {\n    if (this._actions.length > 0) {\n      this._currentAction = this._actions[0];\n      this._currentAction.update(delta);\n\n      if (this._currentAction.isComplete(this._actor)) {\n        this._completedActions.push(this._actions.shift());\n      }\n    }\n  }\n}\n","import { Vector } from '../../Algebra';\nimport { Component } from '../Component';\n\n/**\n * Enum representing the coordinate plane for the position 2D vector in the [[TransformComponent]]\n */\nexport enum CoordPlane {\n  /**\n   * The world coordinate plane (default) represents world space, any entities drawn with world\n   * space move when the camera moves.\n   */\n  World = 'world',\n  /**\n   * The screen coordinate plane represents screen space, entities drawn in screen space are pinned\n   * to screen coordinates ignoring the camera.\n   */\n  Screen = 'screen'\n}\n\nexport class TransformComponent extends Component<'transform'> {\n  public readonly type = 'transform';\n\n  /**\n   * The [[coordinate plane|CoordPlane]] for this transform for the entity.\n   */\n  public coordPlane = CoordPlane.World;\n\n  /**\n   * The current position of the entity in world space or in screen space depending on the the [[coordinate plan|CoordPlane]]\n   */\n  public pos: Vector = Vector.Zero;\n\n  /**\n   * The z-index ordering of the entity, a higher values are drawn on top of lower values.\n   * For example z=99 would be drawn on top of z=0.\n   */\n  public z: number = 0;\n\n  /**\n   * The rotation of the entity in radians. For example `Math.PI` radians is the same as 180 degrees.\n   */\n  public rotation: number = 0;\n\n  /**\n   * The scale of the entity.\n   */\n  public scale: Vector = Vector.One;\n}\n","import { Vector } from '../Algebra';\nimport { obsolete } from '../Util/Decorators';\n\n/**\n * A definition of an EasingFunction. See [[EasingFunctions]].\n */\n// tslint:disable-next-line\nexport interface EasingFunction {\n  (currentTime: number, startValue: number, endValue: number, duration: number): number;\n}\n\n/**\n * Standard easing functions for motion in Excalibur, defined on a domain of [0, duration] and a range from [+startValue,+endValue]\n * Given a time, the function will return a value from positive startValue to positive endValue.\n *\n * ```js\n * function Linear (t) {\n *    return t * t;\n * }\n *\n * // accelerating from zero velocity\n * function EaseInQuad (t) {\n *    return t * t;\n * }\n *\n * // decelerating to zero velocity\n * function EaseOutQuad (t) {\n *    return t * (2 - t);\n * }\n *\n * // acceleration until halfway, then deceleration\n * function EaseInOutQuad (t) {\n *    return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n * }\n *\n * // accelerating from zero velocity\n * function EaseInCubic (t) {\n *    return t * t * t;\n * }\n *\n * // decelerating to zero velocity\n * function EaseOutCubic (t) {\n *    return (--t) * t * t + 1;\n * }\n *\n * // acceleration until halfway, then deceleration\n * function EaseInOutCubic (t) {\n *    return t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n * }\n * ```\n */\nexport class EasingFunctions {\n  public static CreateReversibleEasingFunction(easing: EasingFunction) {\n    return (time: number, start: number, end: number, duration: number) => {\n      if (end < start) {\n        return start - (easing(time, end, start, duration) - end);\n      } else {\n        return easing(time, start, end, duration);\n      }\n    };\n  }\n\n  @obsolete({\n    message: 'Alias for incorrect spelling used in older versions, will be removed in v0.25.0',\n    alternateMethod: 'CreateReversibleEasingFunction'\n  })\n  public static CreateReversableEasingFunction(easing: EasingFunction) {\n    return EasingFunctions.CreateReversibleEasingFunction(easing);\n  }\n\n  public static CreateVectorEasingFunction(easing: EasingFunction) {\n    return (time: number, start: Vector, end: Vector, duration: number) => {\n      return new Vector(easing(time, start.x, end.x, duration), easing(time, start.y, end.y, duration));\n    };\n  }\n\n  public static Linear: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      return (endValue * currentTime) / duration + startValue;\n    }\n  );\n\n  public static EaseInQuad = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n\n      return endValue * currentTime * currentTime + startValue;\n    }\n  );\n\n  public static EaseOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      return -endValue * currentTime * (currentTime - 2) + startValue;\n    }\n  );\n\n  public static EaseInOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration / 2;\n\n      if (currentTime < 1) {\n        return (endValue / 2) * currentTime * currentTime + startValue;\n      }\n      currentTime--;\n\n      return (-endValue / 2) * (currentTime * (currentTime - 2) - 1) + startValue;\n    }\n  );\n\n  public static EaseInCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      return endValue * currentTime * currentTime * currentTime + startValue;\n    }\n  );\n\n  public static EaseOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      currentTime--;\n      return endValue * (currentTime * currentTime * currentTime + 1) + startValue;\n    }\n  );\n\n  public static EaseInOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration / 2;\n      if (currentTime < 1) {\n        return (endValue / 2) * currentTime * currentTime * currentTime + startValue;\n      }\n      currentTime -= 2;\n      return (endValue / 2) * (currentTime * currentTime * currentTime + 2) + startValue;\n    }\n  );\n}\n","import * as Actions from './Action';\nimport { RotationType } from './RotationType';\n\nimport { Actor } from '../Actor';\nimport { EasingFunction, EasingFunctions } from '../Util/EasingFunctions';\n\n/**\n * The fluent Action API allows you to perform \"actions\" on\n * [[Actor|Actors]] such as following, moving, rotating, and\n * more. You can implement your own actions by implementing\n * the [[Action]] interface.\n */\nexport class ActionContext {\n  private _actors: Actor[] = [];\n  private _queues: Actions.ActionQueue[] = [];\n\n  constructor();\n  constructor(actor: Actor);\n  constructor(actors: Actor[]);\n  constructor() {\n    if (arguments !== null) {\n      this._actors = Array.prototype.slice.call(arguments, 0);\n      this._queues = this._actors.map((a) => {\n        return a.actionQueue;\n      });\n    }\n  }\n\n  /**\n   * Clears all queued actions from the Actor\n   */\n  public clearActions(): void {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].clearActions();\n    }\n  }\n\n  public addActorToContext(actor: Actor) {\n    this._actors.push(actor);\n    // if we run into problems replace the line below with:\n    this._queues.push(actor.actionQueue);\n  }\n\n  public removeActorFromContext(actor: Actor) {\n    const index = this._actors.indexOf(actor);\n    if (index > -1) {\n      this._actors.splice(index, 1);\n      this._queues.splice(index, 1);\n    }\n  }\n\n  /**\n   * This method will move an actor to the specified `x` and `y` position over the\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param x         The x location to move the actor to\n   * @param y         The y location to move the actor to\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position\n   */\n  public easeTo(x: number, y: number, duration: number, easingFcn: EasingFunction = EasingFunctions.Linear) {\n    const len = this._queues.length;\n\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.EaseTo(this._actors[i], x, y, duration, easingFcn));\n    }\n\n    return this;\n  }\n\n  /**\n   * This method will move an actor to the specified x and y position at the\n   * speed specified (in pixels per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param x      The x location to move the actor to\n   * @param y      The y location to move the actor to\n   * @param speed  The speed in pixels per second to move\n   */\n  public moveTo(x: number, y: number, speed: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.MoveTo(this._actors[i], x, y, speed));\n    }\n\n    return this;\n  }\n\n  /**\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param xOffset     The x offset to apply to this actor\n   * @param yOffset     The y location to move the actor to\n   * @param speed  The speed in pixels per second the actor should move\n   */\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.MoveBy(this._actors[i], xOffset, yOffset, speed));\n    }\n    return this;\n  }\n\n  /**\n   * This method will rotate an actor to the specified angle at the speed\n   * specified (in radians per second) and return back the actor. This\n   * method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param angleRadians  The angle to rotate to in radians\n   * @param speed         The angular velocity of the rotation specified in radians per second\n   * @param rotationType  The [[RotationType]] to use for this rotation\n   */\n  public rotateTo(angleRadians: number, speed: number, rotationType?: RotationType): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.RotateTo(this._actors[i], angleRadians, speed, rotationType));\n    }\n    return this;\n  }\n\n  /**\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\n   * in radians/sec and return back the actor. This method is part\n   * of the actor 'Action' fluent API allowing action chaining.\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\n   * @param speed          The speed in radians/sec the actor should rotate at\n   * @param rotationType  The [[RotationType]] to use for this rotation, default is shortest path\n   */\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.RotateBy(this._actors[i], angleRadiansOffset, speed, rotationType));\n    }\n    return this;\n  }\n\n  /**\n   * This method will scale an actor to the specified size at the speed\n   * specified (in magnitude increase per second) and return back the\n   * actor. This method is part of the actor 'Action' fluent API allowing\n   * action chaining.\n   * @param sizeX   The scaling factor to apply on X axis\n   * @param sizeY   The scaling factor to apply on Y axis\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\n   */\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.ScaleTo(this._actors[i], sizeX, sizeY, speedX, speedY));\n    }\n    return this;\n  }\n\n  /**\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\n   * and return back the actor. This method is part of the\n   * actor 'Action' fluent API allowing action chaining.\n   * @param sizeOffsetX   The scaling factor to apply on X axis\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\n   * @param speed    The speed to scale at in scale units/sec\n   */\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.ScaleBy(this._actors[i], sizeOffsetX, sizeOffsetY, speed));\n    }\n    return this;\n  }\n\n  /**\n   * This method will cause an actor to blink (become visible and not\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\n   * the actor should be visible per blink, and the amount of time not visible.\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\n   * @param numBlinks       The number of times to blink\n   */\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks: number = 1): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.Blink(this._actors[i], timeVisible, timeNotVisible, numBlinks));\n    }\n    return this;\n  }\n\n  /**\n   * This method will cause an actor's opacity to change from its current value\n   * to the provided value by a specified time (in milliseconds). This method is\n   * part of the actor 'Action' fluent API allowing action chaining.\n   * @param opacity  The ending opacity\n   * @param time     The time it should take to fade the actor (in milliseconds)\n   */\n  public fade(opacity: number, time: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.Fade(this._actors[i], opacity, time));\n    }\n    return this;\n  }\n\n  /**\n   * This method will delay the next action from executing for a certain\n   * amount of time (in milliseconds). This method is part of the actor\n   * 'Action' fluent API allowing action chaining.\n   * @param time  The amount of time to delay the next action in the queue from executing in milliseconds\n   */\n  public delay(time: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.Delay(this._actors[i], time));\n    }\n    return this;\n  }\n\n  /**\n   * This method will add an action to the queue that will remove the actor from the\n   * scene once it has completed its previous actions. Any actions on the\n   * action queue after this action will not be executed.\n   */\n  public die(): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.Die(this._actors[i]));\n    }\n    return this;\n  }\n\n  /**\n   * This method allows you to call an arbitrary method as the next action in the\n   * action queue. This is useful if you want to execute code in after a specific\n   * action, i.e An actor arrives at a destination after traversing a path\n   */\n  public callMethod(method: () => any): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.CallMethod(this._actors[i], method));\n    }\n    return this;\n  }\n\n  /**\n   * This method will cause the actor to repeat all of the previously\n   * called actions a certain number of times. If the number of repeats\n   * is not specified it will repeat forever. This method is part of\n   * the actor 'Action' fluent API allowing action chaining\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\n   * will repeat forever\n   */\n  public repeat(times?: number): ActionContext {\n    if (!times) {\n      this.repeatForever();\n      return this;\n    }\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.Repeat(this._actors[i], times, this._actors[i].actionQueue.getActions()));\n    }\n\n    return this;\n  }\n\n  /**\n   * This method will cause the actor to repeat all of the previously\n   * called actions forever. This method is part of the actor 'Action'\n   * fluent API allowing action chaining.\n   */\n  public repeatForever(): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      this._queues[i].add(new Actions.RepeatForever(this._actors[i], this._actors[i].actionQueue.getActions()));\n    }\n    return this;\n  }\n\n  /**\n   * This method will cause the actor to follow another at a specified distance\n   * @param actor           The actor to follow\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\n   */\n  public follow(actor: Actor, followDistance?: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      if (followDistance === undefined) {\n        this._queues[i].add(new Actions.Follow(this._actors[i], actor));\n      } else {\n        this._queues[i].add(new Actions.Follow(this._actors[i], actor, followDistance));\n      }\n    }\n    return this;\n  }\n\n  /**\n   * This method will cause the actor to move towards another until they\n   * collide \"meet\" at a specified speed.\n   * @param actor  The actor to meet\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\n   */\n  public meet(actor: Actor, speed?: number): ActionContext {\n    const len = this._queues.length;\n    for (let i = 0; i < len; i++) {\n      if (speed === undefined) {\n        this._queues[i].add(new Actions.Meet(this._actors[i], actor));\n      } else {\n        this._queues[i].add(new Actions.Meet(this._actors[i], actor, speed));\n      }\n    }\n    return this;\n  }\n\n  /**\n   * Returns a promise that resolves when the current action queue up to now\n   * is finished.\n   */\n  public asPromise<T>(): Promise<T[]> {\n    const promises = this._queues.map((q, i) => {\n      const temp = new Promise<T>((resolve) => {\n        q.add(\n          new Actions.CallMethod(this._actors[i], () => {\n            resolve();\n          })\n        );\n      });\n      return temp;\n    });\n    return Promise.all(promises);\n  }\n}\n","import { ConvexPolygon } from './ConvexPolygon';\nimport { Circle } from './Circle';\nimport { Edge } from './Edge';\nimport { BoundingBox } from './BoundingBox';\nimport { Vector } from '../Algebra';\n\n/**\n * Excalibur shape helper for defining collision shapes quickly\n */\nexport class Shape {\n  /**\n   * Creates a box collision shape, under the hood defines a [[ConvexPolygon]] collision shape\n   * @param width Width of the box\n   * @param height Height of the box\n   * @param anchor Anchor of the box (default (.5, .5)) which positions the box relative to the center of the collider's position\n   * @param offset Optional offset relative to the collider in local coordinates\n   */\n  static Box(width: number, height: number, anchor: Vector = Vector.Half, offset: Vector = Vector.Zero): ConvexPolygon {\n    return new ConvexPolygon({\n      points: new BoundingBox(-width * anchor.x, -height * anchor.y, width - width * anchor.x, height - height * anchor.y).getPoints(),\n      offset: offset\n    });\n  }\n\n  /**\n   * Creates a new [[ConvexPolygon|arbitrary polygon]] collision shape\n   * @param points Points specified in counter clockwise\n   * @param clockwiseWinding Optionally changed the winding of points, by default false meaning counter-clockwise winding.\n   * @param offset Optional offset relative to the collider in local coordinates\n   */\n  static Polygon(points: Vector[], clockwiseWinding: boolean = false, offset: Vector = Vector.Zero): ConvexPolygon {\n    return new ConvexPolygon({\n      points: points,\n      offset: offset,\n      clockwiseWinding: clockwiseWinding\n    });\n  }\n\n  /**\n   * Creates a new [[circle|Circle]] collision shape\n   * @param radius Radius of the circle shape\n   * @param offset Optional offset relative to the collider in local coordinates\n   */\n  static Circle(radius: number, offset: Vector = Vector.Zero): Circle {\n    return new Circle({\n      radius: radius,\n      offset: offset\n    });\n  }\n\n  /**\n   * Creates a new [[Edge|edge]] collision shape\n   * @param begin Beginning of the edge in local coordinates to the collider\n   * @param end Ending of the edge in local coordinates to the collider\n   */\n  static Edge(begin: Vector, end: Vector): Edge {\n    return new Edge({\n      begin: begin,\n      end: end\n    });\n  }\n}\n","import { Vector } from '../Algebra';\nimport { Actor } from '../Actor';\nimport { Collider } from './Collider';\nimport { CollisionType } from './CollisionType';\nimport { Physics } from '../Physics';\nimport { PreCollisionEvent, PostCollisionEvent, CollisionStartEvent, CollisionEndEvent } from '../Events';\nimport { Clonable } from '../Interfaces/Clonable';\nimport { Shape } from './Shape';\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\n\nexport interface BodyOptions {\n  /**\n   * Optionally the actor associated with this body\n   */\n  actor?: Actor;\n  /**\n   * An optional collider to use in this body, if none is specified a default Box collider will be created.\n   */\n  collider?: Collider;\n}\n\n/**\n * Body describes all the physical properties pos, vel, acc, rotation, angular velocity\n */\nexport class Body implements Clonable<Body> {\n  private _collider: Collider;\n  public actor: Actor;\n  /**\n   * Constructs a new physics body associated with an actor\n   */\n  constructor({ actor, collider }: BodyOptions) {\n    if (!actor && !collider) {\n      throw new Error('An actor or collider are required to create a body');\n    }\n\n    this.actor = actor;\n    if (!collider && actor) {\n      this.collider = this.useBoxCollider(actor.width, actor.height, actor.anchor);\n    } else {\n      this.collider = collider;\n    }\n  }\n\n  public get id() {\n    return this.actor ? this.actor.id : -1;\n  }\n\n  /**\n   * Returns a clone of this body, not associated with any actor\n   */\n  public clone() {\n    return new Body({\n      actor: null,\n      collider: this.collider.clone()\n    });\n  }\n\n  public get active() {\n    return this.actor ? !this.actor.isKilled() : false;\n  }\n\n  public get center() {\n    return this.pos;\n  }\n\n  // TODO allow multiple colliders for a single body\n  public set collider(collider: Collider) {\n    if (collider) {\n      this._collider = collider;\n      this._collider.body = this;\n      this._wireColliderEventsToActor();\n    }\n  }\n\n  public get collider(): Collider {\n    return this._collider;\n  }\n\n  public get transform(): TransformComponent {\n    return this.actor.components.transform;\n  }\n\n  /**\n   * The (x, y) position of the actor this will be in the middle of the actor if the\n   * [[Actor.anchor]] is set to (0.5, 0.5) which is default.\n   * If you want the (x, y) position to be the top left of the actor specify an anchor of (0, 0).\n   */\n  public get pos(): Vector {\n    return this.transform.pos;\n  }\n\n  public set pos(val: Vector) {\n    this.transform.pos = val;\n  }\n\n  /**\n   * The position of the actor last frame (x, y) in pixels\n   */\n  public oldPos: Vector = new Vector(0, 0);\n\n  /**\n   * The current velocity vector (vx, vy) of the actor in pixels/second\n   */\n  public vel: Vector = new Vector(0, 0);\n\n  /**\n   * The velocity of the actor last frame (vx, vy) in pixels/second\n   */\n  public oldVel: Vector = new Vector(0, 0);\n\n  /**\n   * The current acceleration vector (ax, ay) of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may\n   * be useful to simulate a gravitational effect.\n   */\n  public acc: Vector = new Vector(0, 0);\n\n  /**\n   * Gets/sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\n   */\n  public oldAcc: Vector = Vector.Zero;\n\n  /**\n   * The current torque applied to the actor\n   */\n  public torque: number = 0;\n\n  /**\n   * The current \"motion\" of the actor, used to calculated sleep in the physics simulation\n   */\n  public motion: number = 10;\n\n  /**\n   * Gets/sets the rotation of the body from the last frame.\n   */\n  public oldRotation: number = 0; // radians\n\n  /**\n   * The rotation of the actor in radians\n   */\n  public get rotation() {\n    return this.transform.rotation;\n  }\n\n  public set rotation(val: number) {\n    this.transform.rotation = val;\n  }\n\n  /**\n   * The scale vector of the actor\n   * @obsolete ex.Body.scale will be removed in v0.25.0\n   */\n  public scale: Vector = Vector.One;\n\n  /**\n   * The scale of the actor last frame\n   * @obsolete ex.Body.scale will be removed in v0.25.0\n   */\n  public oldScale: Vector = Vector.One;\n\n  /**\n   * The x scalar velocity of the actor in scale/second\n   * @obsolete ex.Body.scale will be removed in v0.25.0\n   */\n  public sx: number = 0; //scale/sec\n  /**\n   * The y scalar velocity of the actor in scale/second\n   * @obsolete ex.Body.scale will be removed in v0.25.0\n   */\n  public sy: number = 0; //scale/sec\n\n  /**\n   * The rotational velocity of the actor in radians/second\n   */\n  public rx: number = 0; //radians/sec\n\n  private _geometryDirty = false;\n\n  private _totalMtv: Vector = Vector.Zero;\n\n  /**\n   * Add minimum translation vectors accumulated during the current frame to resolve collisions.\n   */\n  public addMtv(mtv: Vector) {\n    this._totalMtv.addEqual(mtv);\n  }\n\n  /**\n   * Applies the accumulated translation vectors to the actors position\n   */\n  public applyMtv(): void {\n    this.pos.addEqual(this._totalMtv);\n    this._totalMtv.setTo(0, 0);\n  }\n\n  /**\n   * Flags the shape dirty and must be recalculated in world space\n   */\n  public markCollisionShapeDirty() {\n    this._geometryDirty = true;\n  }\n\n  public get isColliderShapeDirty(): boolean {\n    return this._geometryDirty;\n  }\n\n  /**\n   * Sets the old versions of pos, vel, acc, and scale.\n   */\n  public captureOldTransform() {\n    // Capture old values before integration step updates them\n    this.oldVel.setTo(this.vel.x, this.vel.y);\n    this.oldPos.setTo(this.pos.x, this.pos.y);\n    this.oldAcc.setTo(this.acc.x, this.acc.y);\n    this.oldScale.setTo(this.scale.x, this.scale.y);\n    this.oldRotation = this.rotation;\n  }\n\n  /**\n   * Perform euler integration at the specified time step\n   */\n  public integrate(delta: number) {\n    // Update placements based on linear algebra\n    const seconds = delta / 1000;\n\n    const totalAcc = this.acc.clone();\n    // Only active vanilla actors are affected by global acceleration\n    if (this.collider.type === CollisionType.Active) {\n      totalAcc.addEqual(Physics.acc);\n    }\n\n    this.vel.addEqual(totalAcc.scale(seconds));\n    this.pos.addEqual(this.vel.scale(seconds)).addEqual(totalAcc.scale(0.5 * seconds * seconds));\n\n    this.rx += this.torque * (1.0 / this.collider.inertia) * seconds;\n    this.rotation += this.rx * seconds;\n\n    this.scale.x += (this.sx * delta) / 1000;\n    this.scale.y += (this.sy * delta) / 1000;\n\n    if (!this.scale.equals(this.oldScale)) {\n      // change in scale effects the geometry\n      this._geometryDirty = true;\n    }\n\n    // Update colliders\n    this.collider.update();\n    this._geometryDirty = false;\n  }\n\n  /**\n   * Sets up a box geometry based on the current bounds of the associated actor of this physics body.\n   *\n   * If no width/height are specified the body will attempt to use the associated actor's width/height.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  public useBoxCollider(width?: number, height?: number, anchor: Vector = Vector.Half, center: Vector = Vector.Zero): Collider {\n    if (width === null || width === undefined) {\n      width = this.actor ? this.actor.width : 0;\n    }\n    if (height === null || height === undefined) {\n      height = this.actor ? this.actor.height : 0;\n    }\n\n    this.collider.shape = Shape.Box(width, height, anchor, center);\n    return this.collider;\n  }\n\n  /**\n   * Sets up a [[ConvexPolygon|convex polygon]] collision geometry based on a list of of points relative\n   *  to the anchor of the associated actor\n   * of this physics body.\n   *\n   * Only [convex polygon](https://en.wikipedia.org/wiki/Convex_polygon) definitions are supported.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  public usePolygonCollider(points: Vector[], center: Vector = Vector.Zero): Collider {\n    this.collider.shape = Shape.Polygon(points, false, center);\n    return this.collider;\n  }\n\n  /**\n   * Sets up a [[Circle|circle collision geometry]] with a specified radius in pixels.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  public useCircleCollider(radius: number, center: Vector = Vector.Zero): Collider {\n    this.collider.shape = Shape.Circle(radius, center);\n    return this.collider;\n  }\n\n  /**\n   * Sets up an [[Edge|edge collision geometry]] with a start point and an end point relative to the anchor of the associated actor\n   * of this physics body.\n   *\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\n   */\n  public useEdgeCollider(begin: Vector, end: Vector): Collider {\n    this.collider.shape = Shape.Edge(begin, end);\n    return this.collider;\n  }\n\n  // TODO remove this, eventually events will stay local to the thing they are around\n  private _wireColliderEventsToActor() {\n    this.collider.clear();\n    this.collider.on('precollision', (evt: PreCollisionEvent<Collider>) => {\n      if (this.actor) {\n        this.actor.emit('precollision', new PreCollisionEvent(evt.target.body.actor, evt.other.body.actor, evt.side, evt.intersection));\n      }\n    });\n    this.collider.on('postcollision', (evt: PostCollisionEvent<Collider>) => {\n      if (this.actor) {\n        this.actor.emit('postcollision', new PostCollisionEvent(evt.target.body.actor, evt.other.body.actor, evt.side, evt.intersection));\n      }\n    });\n    this.collider.on('collisionstart', (evt: CollisionStartEvent<Collider>) => {\n      if (this.actor) {\n        this.actor.emit('collisionstart', new CollisionStartEvent(evt.target.body.actor, evt.other.body.actor, evt.pair));\n      }\n    });\n    this.collider.on('collisionend', (evt: CollisionEndEvent<Collider>) => {\n      if (this.actor) {\n        this.actor.emit('collisionend', new CollisionEndEvent(evt.target.body.actor, evt.other.body.actor));\n      }\n    });\n  }\n}\n","import { Trait } from '../Interfaces/Trait';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { Vector } from '../Algebra';\nimport { Side } from '../Collision/Side';\nimport { PreCollisionEvent, PostCollisionEvent } from '../Events';\nimport { CollisionType } from '../Collision/CollisionType';\nimport { BoundingBox } from '../Collision/Index';\n\nexport class TileMapCollisionDetection implements Trait {\n  public update(actor: Actor, engine: Engine) {\n    const eventDispatcher = actor.eventDispatcher;\n    if (actor.body.collider.type !== CollisionType.PreventCollision && engine.currentScene && engine.currentScene.tileMaps) {\n      for (let j = 0; j < engine.currentScene.tileMaps.length; j++) {\n        const map = engine.currentScene.tileMaps[j];\n        let intersectMap: Vector;\n        let side = Side.None;\n        let max = 2;\n        while ((intersectMap = map.collides(actor))) {\n          if (max-- < 0) {\n            break;\n          }\n          side = BoundingBox.getSideFromIntersection(intersectMap);\n          eventDispatcher.emit('precollision', new PreCollisionEvent(actor, null, side, intersectMap));\n          if (actor.body.collider.type === CollisionType.Active) {\n            actor.pos.y += intersectMap.y;\n            actor.pos.x += intersectMap.x;\n            eventDispatcher.emit('postcollision', new PostCollisionEvent(actor, null, side, intersectMap));\n          }\n        }\n      }\n    }\n  }\n}\n","import { Vector } from '../Algebra';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { Color } from '../Drawing/Color';\n\nexport class CullingBox {\n  private _topLeft: Vector = new Vector(0, 0);\n  private _topRight: Vector = new Vector(0, 0);\n  private _bottomLeft: Vector = new Vector(0, 0);\n  private _bottomRight: Vector = new Vector(0, 0);\n\n  private _xCoords: Array<number>;\n  private _yCoords: Array<number>;\n  private _xMin: number;\n  private _yMin: number;\n  private _xMax: number;\n  private _yMax: number;\n\n  private _xMinWorld: number;\n  private _yMinWorld: number;\n  private _xMaxWorld: number;\n  private _yMaxWorld: number;\n\n  public isSpriteOffScreen(actor: Actor, engine: Engine): boolean {\n    const drawingWidth = actor.currentDrawing.drawWidth;\n    const drawingHeight = actor.currentDrawing.drawHeight;\n    const rotation = actor.rotation;\n    const anchor = actor.center;\n    const worldPos = actor.getWorldPos();\n\n    this._topLeft.x = worldPos.x - drawingWidth / 2;\n    this._topLeft.y = worldPos.y - drawingHeight / 2;\n    this._topLeft = this._topLeft.rotate(rotation, anchor);\n\n    this._topRight.x = worldPos.x + drawingWidth / 2;\n    this._topRight.y = worldPos.y - drawingHeight / 2;\n    this._topRight = this._topRight.rotate(rotation, anchor);\n\n    this._bottomLeft.x = worldPos.x - drawingWidth / 2;\n    this._bottomLeft.y = worldPos.y + drawingHeight / 2;\n    this._bottomLeft = this._bottomLeft.rotate(rotation, anchor);\n\n    this._bottomRight.x = worldPos.x + drawingWidth / 2;\n    this._bottomRight.y = worldPos.y + drawingHeight / 2;\n    this._bottomRight = this._bottomRight.rotate(rotation, anchor);\n\n    ///\n\n    const topLeftScreen = engine.worldToScreenCoordinates(this._topLeft);\n    const topRightScreen = engine.worldToScreenCoordinates(this._topRight);\n    const bottomLeftScreen = engine.worldToScreenCoordinates(this._bottomLeft);\n    const bottomRightScreen = engine.worldToScreenCoordinates(this._bottomRight);\n    this._xCoords = [];\n    this._yCoords = [];\n\n    this._xCoords.push(topLeftScreen.x, topRightScreen.x, bottomLeftScreen.x, bottomRightScreen.x);\n    this._yCoords.push(topLeftScreen.y, topRightScreen.y, bottomLeftScreen.y, bottomRightScreen.y);\n\n    this._xMin = Math.min.apply(null, this._xCoords);\n    this._yMin = Math.min.apply(null, this._yCoords);\n    this._xMax = Math.max.apply(null, this._xCoords);\n    this._yMax = Math.max.apply(null, this._yCoords);\n\n    const minWorld = engine.screenToWorldCoordinates(new Vector(this._xMin, this._yMin));\n    const maxWorld = engine.screenToWorldCoordinates(new Vector(this._xMax, this._yMax));\n    this._xMinWorld = minWorld.x;\n    this._yMinWorld = minWorld.y;\n    this._xMaxWorld = maxWorld.x;\n    this._yMaxWorld = maxWorld.y;\n\n    const boundingPoints = [\n      new Vector(this._xMin, this._yMin), // top left\n      new Vector(this._xMax, this._yMin), // top right\n      new Vector(this._xMin, this._yMax), // bottom left\n      new Vector(this._xMax, this._yMax) // bottom right\n    ];\n\n    // sprite can be wider than canvas screen (and still visible within canvas)\n    // top or bottom of sprite must be within canvas\n    if (\n      boundingPoints[0].x < 0 &&\n      boundingPoints[1].x > engine.canvas.clientWidth &&\n      (boundingPoints[0].y > 0 || boundingPoints[2].y < engine.canvas.clientHeight)\n    ) {\n      return false;\n    }\n\n    // sprite can be taller than canvas screen (and still visible within canvas)\n    // left or right of sprite must be within canvas\n    if (\n      boundingPoints[0].y < 0 &&\n      boundingPoints[2].y > engine.canvas.clientHeight &&\n      (boundingPoints[1].x > 0 || boundingPoints[0].x < engine.canvas.clientWidth)\n    ) {\n      return false;\n    }\n\n    // otherwise if any corner is visible, we're not offscreen\n    for (let i = 0; i < boundingPoints.length; i++) {\n      if (\n        boundingPoints[i].x > 0 &&\n        boundingPoints[i].y > 0 &&\n        boundingPoints[i].x < engine.canvas.clientWidth &&\n        boundingPoints[i].y < engine.canvas.clientHeight\n      ) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    // bounding rectangle\n    ctx.beginPath();\n    ctx.strokeStyle = Color.White.toString();\n    ctx.rect(this._xMinWorld, this._yMinWorld, this._xMaxWorld - this._xMinWorld, this._yMaxWorld - this._yMinWorld);\n    ctx.stroke();\n\n    ctx.fillStyle = Color.Red.toString();\n    ctx.beginPath();\n    ctx.arc(this._topLeft.x, this._topLeft.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Green.toString();\n    ctx.beginPath();\n    ctx.arc(this._topRight.x, this._topRight.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Blue.toString();\n    ctx.beginPath();\n    ctx.arc(this._bottomLeft.x, this._bottomLeft.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Magenta.toString();\n    ctx.beginPath();\n    ctx.arc(this._bottomRight.x, this._bottomRight.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n  }\n}\n","import { CullingBox } from './../Util/CullingBox';\nimport { Trait } from '../Interfaces/Trait';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { ExitViewPortEvent, EnterViewPortEvent } from '../Events';\n\nexport class OffscreenCulling implements Trait {\n  public cullingBox: CullingBox = new CullingBox();\n\n  public update(actor: Actor, engine: Engine) {\n    const events = actor.eventDispatcher;\n\n    let isSpriteOffScreen = true;\n    if (actor.currentDrawing != null) {\n      isSpriteOffScreen = this.cullingBox.isSpriteOffScreen(actor, engine);\n    }\n\n    let actorBoundsOffscreen = false;\n    if (engine && engine.currentScene && engine.currentScene.camera && engine.currentScene.camera.viewport && !actor.parent) {\n      actorBoundsOffscreen = !engine.currentScene.camera.viewport.intersect(actor.body.collider.bounds);\n    }\n\n    if (!actor.isOffScreen) {\n      if (actorBoundsOffscreen && isSpriteOffScreen) {\n        events.emit('exitviewport', new ExitViewPortEvent(actor));\n        actor.isOffScreen = true;\n      }\n    } else {\n      if (!actorBoundsOffscreen || !isSpriteOffScreen) {\n        events.emit('enterviewport', new EnterViewPortEvent(actor));\n        actor.isOffScreen = false;\n      }\n    }\n  }\n}\n","import { Trait } from '../Interfaces/Trait';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\n\nexport interface CapturePointerConfig {\n  /**\n   * Capture PointerMove events (may be expensive!)\n   */\n  captureMoveEvents: boolean;\n\n  /**\n   * Capture PointerDrag events (may be expensive!)\n   */\n  captureDragEvents: boolean;\n}\n\n/**\n * Revises pointer events path accordingly to the actor\n */\nexport class CapturePointer implements Trait {\n  public update(actor: Actor, engine: Engine) {\n    if (!actor.enableCapturePointer) {\n      return;\n    }\n    if (actor.isKilled()) {\n      return;\n    }\n\n    engine.input.pointers.checkAndUpdateActorUnderPointer(actor);\n  }\n}\n","import { Color } from '../Drawing/Color';\nimport { Vector } from '../Algebra';\n\n/**\n * A canvas linecap style. \"butt\" is the default flush style, \"round\" is a semi-circle cap with a radius half the width of\n * the line, and \"square\" is a rectangle that is an equal width and half height cap.\n */\nexport type LineCapStyle = 'butt' | 'round' | 'square';\n\n/* istanbul ignore next */\n/**\n * Draw a line on canvas context\n *\n * @param ctx The canvas context\n * @param color The color of the line\n * @param x1 The start x coordinate\n * @param y1 The start y coordinate\n * @param x2 The ending x coordinate\n * @param y2 The ending y coordinate\n * @param thickness The line thickness\n * @param cap The [[LineCapStyle]] (butt, round, or square)\n */\nexport function line(\n  ctx: CanvasRenderingContext2D,\n  color: Color = Color.Red,\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number,\n  thickness: number = 1,\n  cap: LineCapStyle = 'butt'\n) {\n  ctx.beginPath();\n  ctx.lineWidth = thickness;\n  ctx.lineCap = cap;\n  ctx.strokeStyle = color.toString();\n  ctx.moveTo(x1, y1);\n  ctx.lineTo(x2, y2);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/* istanbul ignore next */\n/**\n * Draw the vector as a point onto the canvas.\n */\nexport function point(ctx: CanvasRenderingContext2D, color: Color = Color.Red, point: Vector): void {\n  ctx.beginPath();\n  ctx.strokeStyle = color.toString();\n  ctx.arc(point.x, point.y, 5, 0, Math.PI * 2);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/**\n * Draw the vector as a line onto the canvas starting a origin point.\n */\n/* istanbul ignore next */\n/**\n *\n */\nexport function vector(ctx: CanvasRenderingContext2D, color: Color, origin: Vector, vector: Vector, scale: number = 1.0): void {\n  const c = color ? color.toString() : 'blue';\n  const v = vector.scale(scale);\n  ctx.beginPath();\n  ctx.strokeStyle = c;\n  ctx.moveTo(origin.x, origin.y);\n  ctx.lineTo(origin.x + v.x, origin.y + v.y);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/**\n * Represents border radius values\n */\nexport interface BorderRadius {\n  /**\n   * Top-left\n   */\n  tl: number;\n  /**\n   * Top-right\n   */\n  tr: number;\n  /**\n   * Bottom-right\n   */\n  br: number;\n  /**\n   * Bottom-left\n   */\n  bl: number;\n}\n\n/**\n * Draw a round rectangle on a canvas context\n *\n * @param ctx The canvas context\n * @param x The top-left x coordinate\n * @param y The top-left y coordinate\n * @param width The width of the rectangle\n * @param height The height of the rectangle\n * @param radius The border radius of the rectangle\n * @param stroke The [[Color]] to stroke rectangle with\n * @param fill The [[Color]] to fill rectangle with\n */\nexport function roundRect(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  radius: number | BorderRadius = 5,\n  stroke: Color = Color.White,\n  fill: Color = null\n) {\n  let br: BorderRadius;\n\n  if (typeof radius === 'number') {\n    br = { tl: radius, tr: radius, br: radius, bl: radius };\n  } else {\n    const defaultRadius: BorderRadius = { tl: 0, tr: 0, br: 0, bl: 0 };\n\n    for (const prop in defaultRadius) {\n      if (defaultRadius.hasOwnProperty(prop)) {\n        const side = <keyof BorderRadius>prop;\n        br[side] = radius[side] || defaultRadius[side];\n      }\n    }\n  }\n\n  ctx.beginPath();\n  ctx.moveTo(x + br.tl, y);\n  ctx.lineTo(x + width - br.tr, y);\n  ctx.quadraticCurveTo(x + width, y, x + width, y + br.tr);\n  ctx.lineTo(x + width, y + height - br.br);\n  ctx.quadraticCurveTo(x + width, y + height, x + width - br.br, y + height);\n  ctx.lineTo(x + br.bl, y + height);\n  ctx.quadraticCurveTo(x, y + height, x, y + height - br.bl);\n  ctx.lineTo(x, y + br.tl);\n  ctx.quadraticCurveTo(x, y, x + br.tl, y);\n  ctx.closePath();\n\n  if (fill) {\n    ctx.fillStyle = fill.toString();\n    ctx.fill();\n  }\n\n  if (stroke) {\n    ctx.strokeStyle = stroke.toString();\n    ctx.stroke();\n  }\n}\n\n/**\n *\n */\nexport function circle(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  radius: number,\n  stroke: Color = Color.White,\n  fill: Color = null\n) {\n  ctx.beginPath();\n  ctx.arc(x, y, radius, 0, Math.PI * 2);\n  ctx.closePath();\n\n  if (fill) {\n    ctx.fillStyle = fill.toString();\n    ctx.fill();\n  }\n\n  if (stroke) {\n    ctx.strokeStyle = stroke.toString();\n    ctx.stroke();\n  }\n}\n","/**\n * CollisionGroups indicate like members that do not collide with each other. Use [[CollisionGroupManager]] to create [[CollisionGroup]]s\n *\n * For example:\n *\n * Players have collision group \"player\"\n *\n * ![Player Collision Group](/assets/images/docs/CollisionGroupsPlayer.png)\n *\n * Enemies have collision group \"enemy\"\n *\n * ![Enemy Collision Group](/assets/images/docs/CollisionGroupsEnemy.png)\n *\n * Blocks have collision group \"ground\"\n *\n * ![Ground collision group](/assets/images/docs/CollisionGroupsGround.png)\n *\n * Players don't collide with each other, but enemies and blocks. Likewise, enemies don't collide with each other but collide\n * with players and blocks.\n *\n * This is done with bitmasking, see the following pseudo-code\n *\n * PlayerGroup = `0b001`\n * PlayerGroupMask = `0b110`\n *\n * EnemyGroup = `0b010`\n * EnemyGroupMask = `0b101`\n *\n * BlockGroup = `0b100`\n * BlockGroupMask = `0b011`\n *\n * Should Players collide? No because the bitwise mask evaluates to 0\n * `(player1.group & player2.mask) === 0`\n * `(0b001 & 0b110) === 0`\n *\n * Should Players and Enemies collide? Yes because the bitwise mask is non-zero\n * `(player1.group & enemy1.mask) === 1`\n * `(0b001 & 0b101) === 1`\n *\n * Should Players and Blocks collide? Yes because the bitwise mask is non-zero\n * `(player1.group & blocks1.mask) === 1`\n * `(0b001 & 0b011) === 1`\n */\nexport class CollisionGroup {\n  /**\n   * The `All` [[CollisionGroup]] is a special group that collides with all other groups including itself,\n   * it is the default collision group on colliders.\n   */\n  public static All = new CollisionGroup('Collide with all groups', -1, -1);\n\n  private _name: string;\n  private _category: number;\n  private _mask: number;\n\n  /**\n   * **STOP!!** It is preferred that [[CollisionGroupManager.create]] is used to create collision groups\n   *  unless you know how to construct the proper bitmasks. See https://github.com/excaliburjs/Excalibur/issues/1091 for more info.\n   * @param name Name of the collision group\n   * @param category 32 bit category for the group, should be a unique power of 2. For example `0b001` or `0b010`\n   * @param mask 32 bit mask of category, or `~category` generally. For a category of `0b001`, the mask would be `0b110`\n   */\n  constructor(name: string, category: number, mask: number) {\n    this._name = name;\n    this._category = category;\n    this._mask = mask;\n  }\n\n  /**\n   * Get the name of the collision group\n   */\n  public get name() {\n    return this._name;\n  }\n\n  /**\n   * Get the category of the collision group, a 32 bit number which should be a unique power of 2\n   */\n  public get category() {\n    return this._category;\n  }\n\n  /**\n   * Get the mask for this collision group\n   */\n  public get mask() {\n    return this._mask;\n  }\n\n  /**\n   * Evaluates whether 2 collision groups can collide\n   * @param other  CollisionGroup\n   */\n  public canCollide(other: CollisionGroup): boolean {\n    return (this.category & other.mask) !== 0 && (other.category & this.mask) !== 0;\n  }\n}\n","import { Physics } from './../Physics';\nimport { Color } from './../Drawing/Color';\nimport { CollisionContact } from './CollisionContact';\nimport { CollisionResolutionStrategy } from '../Physics';\nimport * as DrawUtil from '../Util/DrawUtil';\nimport { CollisionType } from './CollisionType';\nimport { Collider } from './Collider';\n\n/**\n * Models a potential collision between 2 bodies\n */\nexport class Pair {\n  public id: string = null;\n  public collision: CollisionContact = null;\n\n  constructor(public colliderA: Collider, public colliderB: Collider) {\n    this.id = Pair.calculatePairHash(colliderA, colliderB);\n  }\n\n  public static canCollide(colliderA: Collider, colliderB: Collider) {\n    // If both are in the same collision group short circuit\n    if (!colliderA.group.canCollide(colliderB.group)) {\n      return false;\n    }\n\n    // if both are fixed short circuit\n    if (colliderA.type === CollisionType.Fixed && colliderB.type === CollisionType.Fixed) {\n      return false;\n    }\n\n    // if the either is prevent collision short circuit\n    if (colliderB.type === CollisionType.PreventCollision || colliderA.type === CollisionType.PreventCollision) {\n      return false;\n    }\n\n    // if either is dead short circuit\n    if (!colliderA.active || !colliderB.active) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Returns whether or not it is possible for the pairs to collide\n   */\n  public get canCollide(): boolean {\n    const actorA = this.colliderA;\n    const actorB = this.colliderB;\n    return Pair.canCollide(actorA, actorB);\n  }\n\n  /**\n   * Runs the collision intersection logic on the members of this pair\n   */\n  public collide() {\n    this.collision = this.colliderA.collide(this.colliderB);\n  }\n\n  /**\n   * Resolves the collision body position and velocity if a collision occurred\n   */\n  public resolve(strategy: CollisionResolutionStrategy) {\n    if (this.collision) {\n      this.collision.resolve(strategy);\n    }\n  }\n\n  /**\n   * Calculates the unique pair hash id for this collision pair\n   */\n  public static calculatePairHash(colliderA: Collider, colliderB: Collider): string {\n    if (colliderA.id < colliderB.id) {\n      return `#${colliderA.id}+${colliderB.id}`;\n    } else {\n      return `#${colliderB.id}+${colliderA.id}`;\n    }\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    if (this.collision) {\n      if (Physics.showContacts) {\n        DrawUtil.point(ctx, Color.Red, this.collision.point);\n      }\n      if (Physics.showCollisionNormals) {\n        DrawUtil.vector(ctx, Color.Cyan, this.collision.point, this.collision.normal, 30);\n      }\n    }\n  }\n}\n","import { Color } from '../Drawing/Color';\nimport * as DrawUtil from '../Util/DrawUtil';\nimport { Eventable } from '../Interfaces/Index';\nimport { GameEvent } from '../Events';\nimport { Actor } from '../Actor';\nimport { Body } from './Body';\nimport { CollisionShape } from './CollisionShape';\nimport { Vector, Line } from '../Algebra';\nimport { Physics } from '../Physics';\nimport { BoundingBox } from './BoundingBox';\nimport { CollisionType } from './CollisionType';\nimport { CollisionGroup } from './CollisionGroup';\nimport { CollisionContact } from './CollisionContact';\nimport { EventDispatcher } from '../EventDispatcher';\nimport { Pair } from './Pair';\nimport { Clonable } from '../Interfaces/Clonable';\n\n/**\n * Type guard function to determine whether something is a Collider\n */\nexport function isCollider(x: Actor | Collider): x is Collider {\n  return x instanceof Collider;\n}\n\nexport interface ColliderOptions {\n  /**\n   * Optional [[CollisionShape|Shape]] to use with this collider, the shape defines the collidable\n   * region along with the [[BoundingBox|bounding box]]\n   */\n  shape?: CollisionShape;\n  /**\n   * Optional body to associate with this collider\n   */\n  body?: Body;\n  /**\n   * Optional pixel offset from the position of the body\n   */\n  offset?: Vector;\n  /**\n   * Optional collision group on this collider\n   */\n  group?: CollisionGroup;\n  /**\n   * Optional [[CollisionType|collision type]], if not specified the default is [[CollisionType.PreventCollision]]\n   */\n  type?: CollisionType;\n  /**\n   * Optional local bounds if other bounds are required instead of the bounding box from the shape. This overrides shape bounds.\n   */\n  localBounds?: BoundingBox;\n  /**\n   * Optional flag to indicate moment of inertia from the shape should be used, by default it is true.\n   */\n  useShapeInertia?: boolean;\n}\n\n/**\n * Collider describes material properties like shape,\n * bounds, friction of the physics object. Only **one** collider can be associated with a body at a time\n */\n\nexport class Collider implements Eventable, Clonable<Collider> {\n  private _shape: CollisionShape;\n  public useShapeInertia: boolean;\n  private _events: EventDispatcher<Collider> = new EventDispatcher<Collider>(this);\n\n  constructor({ body, type, group, shape, offset, useShapeInertia = true }: ColliderOptions) {\n    // If shape is not supplied see if the body has an existing collider with a shape\n    if (body && body.collider && !shape) {\n      this._shape = body.collider.shape;\n    } else {\n      this._shape = shape;\n      this.body = body;\n    }\n    this.useShapeInertia = useShapeInertia;\n    this._shape.collider = this;\n    this.type = type || this.type;\n    this.group = group || this.group;\n    this.offset = offset || Vector.Zero;\n  }\n\n  /**\n   * Returns a clone of the current collider, not associated with any body\n   */\n  public clone() {\n    return new Collider({\n      body: null,\n      type: this.type,\n      shape: this._shape.clone(),\n      group: this.group,\n      offset: this.offset\n    });\n  }\n\n  /**\n   * Get the unique id of the collider\n   */\n  public get id(): number {\n    return this.body ? this.body.id : -1;\n  }\n\n  /**\n   * Gets or sets the current collision type of this collider. By\n   * default it is ([[CollisionType.PreventCollision]]).\n   */\n  public type: CollisionType = CollisionType.PreventCollision;\n\n  /**\n   * Gets or sets the current [[CollisionGroup|collision group]] for the collider, colliders with like collision groups do not collide.\n   * By default, the collider will collide with [[CollisionGroup|all groups]].\n   */\n  public group: CollisionGroup = CollisionGroup.All;\n\n  /*\n   * Get the shape of the collider as a [[CollisionShape]]\n   */\n  public get shape(): CollisionShape {\n    return this._shape;\n  }\n\n  /**\n   * Set the shape of the collider as a [[CollisionShape]], if useShapeInertia is set the collider will use inertia from the shape.\n   */\n  public set shape(shape: CollisionShape) {\n    this._shape = shape;\n    this._shape.collider = this;\n    if (this.useShapeInertia) {\n      this.inertia = isNaN(this._shape.inertia) ? this.inertia : this._shape.inertia;\n    }\n  }\n\n  /**\n   * Return a reference to the body associated with this collider\n   */\n  public body: Body;\n\n  /**\n   * The center of the collider in world space\n   */\n  public get center(): Vector {\n    return this.bounds.center;\n  }\n\n  /**\n   * Is this collider active, if false it wont collide\n   */\n  public get active(): boolean {\n    return this.body.active;\n  }\n\n  /**\n   * Collide 2 colliders and product a collision contact if there is a collision, null if none\n   *\n   * Collision vector is in the direction of the other collider. Away from this collider, this -> other.\n   * @param other\n   */\n  public collide(other: Collider): CollisionContact | null {\n    return this.shape.collide(other.shape);\n  }\n\n  /**\n   * Find the closest line between 2 colliders\n   *\n   * Line is in the direction of the other collider. Away from this collider, this -> other.\n   * @param other Other collider\n   */\n  public getClosestLineBetween(other: Collider): Line {\n    return this.shape.getClosestLineBetween(other.shape);\n  }\n\n  /**\n   * Gets the current pixel offset of the collider\n   */\n  public get offset() {\n    return this.shape.offset.clone();\n  }\n\n  /**\n   * Sets the pixel offset of the collider\n   */\n  public set offset(offset: Vector) {\n    this.shape.offset = offset.clone();\n  }\n\n  /**\n   * The current mass of the actor, mass can be thought of as the resistance to acceleration.\n   */\n  public mass: number = 1.0;\n\n  /**\n   * The current moment of inertia, moment of inertia can be thought of as the resistance to rotation.\n   */\n  public inertia: number = 1000;\n\n  /**\n   * The coefficient of friction on this actor\n   */\n  public friction: number = 0.99;\n\n  /**\n   * The also known as coefficient of restitution of this actor, represents the amount of energy preserved after collision or the\n   * bounciness. If 1, it is 100% bouncy, 0 it completely absorbs.\n   */\n  public bounciness: number = 0.2;\n\n  /**\n   * Returns a boolean indicating whether this body collided with\n   * or was in stationary contact with\n   * the body of the other [[Collider]]\n   */\n  public touching(other: Collider): boolean {\n    const pair = new Pair(this, other);\n    pair.collide();\n\n    if (pair.collision) {\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Returns the collider's [[BoundingBox]] calculated for this instant in world space.\n   * If there is no shape, a point bounding box is returned\n   */\n  public get bounds(): BoundingBox {\n    if (this.shape) {\n      return this.shape.bounds;\n    }\n\n    if (this.body) {\n      return new BoundingBox().translate(this.body.pos);\n    }\n    return new BoundingBox();\n  }\n\n  /**\n   * Returns the collider's [[BoundingBox]] relative to the body's position.\n   * If there is no shape, a point bounding box is returned\n   */\n  public get localBounds(): BoundingBox {\n    if (this.shape) {\n      return this.shape.localBounds;\n    }\n    return new BoundingBox();\n  }\n\n  /**\n   * Updates the collision shapes geometry and internal caches if needed\n   */\n  public update() {\n    if (this.shape) {\n      this.shape.recalc();\n    }\n  }\n\n  emit(eventName: string, event: GameEvent<Collider>): void {\n    this._events.emit(eventName, event);\n  }\n  on(eventName: string, handler: (event: GameEvent<Collider>) => void): void {\n    this._events.on(eventName, handler);\n  }\n  off(eventName: string, handler?: (event: GameEvent<Collider>) => void): void {\n    this._events.off(eventName, handler);\n  }\n  once(eventName: string, handler: (event: GameEvent<Collider>) => void): void {\n    this._events.once(eventName, handler);\n  }\n\n  clear() {\n    this._events.clear();\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    // Draw motion vectors\n    if (Physics.showMotionVectors) {\n      DrawUtil.vector(ctx, Color.Yellow, this.body.pos, this.body.acc.add(Physics.acc));\n      DrawUtil.vector(ctx, Color.Red, this.body.pos, this.body.vel);\n      DrawUtil.point(ctx, Color.Red, this.body.pos);\n    }\n\n    if (Physics.showBounds) {\n      this.bounds.debugDraw(ctx, Color.Yellow);\n    }\n\n    if (Physics.showArea) {\n      this.shape.debugDraw(ctx, Color.Green);\n    }\n  }\n}\n","import { Entity } from './Entity';\n\nexport interface ComponentCtor {\n  new (): Component;\n}\n\n/**\n * Type guard to check if a component implements clone\n * @param x\n */\nfunction hasClone(x: any): x is { clone(): any } {\n  return !!x?.clone;\n}\n\n/**\n * Components are containers for state in Excalibur, the are meant to convey capabilities that an Entity posesses\n *\n * Implementations of Component must have a zero-arg constructor to support dependecies\n *\n * ```typescript\n * class MyComponent extends ex.Component<'my'> {\n *   public readonly type = 'my';\n *   // zero arg support required if you want to use component dependencies\n *   constructor(public optionalPos?: ex.Vector) {}\n * }\n * ```\n */\nexport abstract class Component<TypeName extends string = string> {\n  /**\n   * Optionally list any component types this component depends on\n   * If the owner entity does not have these components, new components will be added to the entity\n   *\n   * Only components with zero-arg constructors are supported as automatic component dependencies\n   */\n  readonly dependencies?: ComponentCtor[];\n\n  /**\n   * Type of this component, must be a unique type among component types in you game.\n   */\n  abstract readonly type: TypeName;\n\n  /**\n   * Current owning [[Entity]], if any, of this component. Null if not added to any [[Entity]]\n   */\n  owner?: Entity = null;\n\n  /**\n   * Clones any properties on this component, if that property value has a `clone()` method it will be called\n   */\n  clone(): this {\n    const newComponent = new (this.constructor as any)();\n    for (const prop in this) {\n      if (this.hasOwnProperty(prop)) {\n        const val = this[prop];\n        if (hasClone(val) && prop !== 'owner' && prop !== 'clone') {\n          newComponent[prop] = val.clone();\n        } else {\n          newComponent[prop] = val;\n        }\n      }\n    }\n    return newComponent;\n  }\n\n  /**\n   * Optional callback called when a component is added to an entity\n   */\n  onAdd?: (owner: Entity) => void;\n\n  /**\n   * Opitonal callback called when acomponent is added to an entity\n   */\n  onRemove?: (previousOwner: Entity) => void;\n}\n\n/**\n * Tag components are a way of tagging a component with label and a simple value\n *\n * For example:\n *\n * ```typescript\n * const isOffscreen = new TagComponent('offscreen');\n * entity.addComponent(isOffscreen);\n * entity.tags.includes\n * ```\n */\nexport class TagComponent<TypeName extends string, MaybeValueType extends string | symbol | number | boolean = never> extends Component<\nTypeName\n> {\n  constructor(public readonly type: TypeName, public readonly value?: MaybeValueType) {\n    super();\n  }\n}\n","export interface Message<T> {\n  type: string;\n  data: T;\n}\n\nexport interface Observer<T> {\n  notify(message: T): void;\n}\n\nexport type MaybeObserver<T> = Partial<Observer<T>>;\n\nexport class Observable<T> {\n  public observers: Observer<T>[] = [];\n\n  register(observer: Observer<T>) {\n    this.observers.push(observer);\n  }\n\n  unregister(observer: Observer<T>) {\n    const i = this.observers.indexOf(observer);\n    if (i !== -1) {\n      this.observers.splice(i, 1);\n    }\n  }\n\n  notifyAll(message: T) {\n    this.observers.forEach((o) => o.notify(message));\n  }\n}\n","import { Component, TagComponent } from './Component';\n\nimport { Observable, Message } from '../Util/Observable';\nimport { Class } from '../Class';\nimport { OnInitialize, OnPreUpdate, OnPostUpdate } from '../Interfaces/LifecycleEvents';\nimport { Engine } from '../Engine';\nimport { InitializeEvent, PreUpdateEvent, PostUpdateEvent } from '../Events';\n\n/**\n * Interface holding an entity component pair\n */\nexport interface EntityComponent {\n  component: Component;\n  entity: Entity;\n}\n\n/**\n * AddedComponent message\n */\nexport class AddedComponent implements Message<EntityComponent> {\n  readonly type: 'Component Added' = 'Component Added';\n  constructor(public data: EntityComponent) {}\n}\n\n/**\n * Type guard to know if message is f an Added Component\n */\nexport function isAddedComponent(x: Message<EntityComponent>): x is AddedComponent {\n  return !!x && x.type === 'Component Added';\n}\n\n/**\n * RemovedComponent message\n */\nexport class RemovedComponent implements Message<EntityComponent> {\n  readonly type: 'Component Removed' = 'Component Removed';\n  constructor(public data: EntityComponent) {}\n}\n\n/**\n * Type guard to know if message is for a Removed Component\n */\nexport function isRemovedComponent(x: Message<EntityComponent>): x is RemovedComponent {\n  return !!x && x.type === 'Component Removed';\n}\n\nexport type ComponentMap = { [type: string]: Component };\n\n// Given a TypeName string (Component.type), find the ComponentType that goes with that type name\nexport type MapTypeNameToComponent<TypeName extends string, ComponentType extends Component> =\n  // If the ComponentType is a Component with type = TypeName then that's the type we are looking for\n  ComponentType extends Component<TypeName> ? ComponentType : never;\n\n// Given a type union of PossibleComponentTypes, create a dictionary that maps that type name string to those individual types\nexport type ComponentMapper<PossibleComponentTypes extends Component> = {\n  [TypeName in PossibleComponentTypes['type']]: MapTypeNameToComponent<TypeName, PossibleComponentTypes>;\n} &\nComponentMap;\n\nexport type ExcludeType<TypeUnion, TypeNameOrType> = TypeNameOrType extends string\n  ? Exclude<TypeUnion, Component<TypeNameOrType>>\n  : Exclude<TypeUnion, TypeNameOrType>;\n\n/**\n * An Entity is the base type of anything that can have behavior in Excalibur, they are part of the built in entity component system\n *\n * Entities can be strongly typed with the components they contain\n *\n * ```typescript\n * const entity = new Entity<ComponentA | ComponentB>();\n * entity.components.a; // Type ComponentA\n * entity.components.b; // Type ComponentB\n * ```\n */\nexport class Entity<KnownComponents extends Component = never> extends Class implements OnInitialize, OnPreUpdate, OnPostUpdate {\n  private static _ID = 0;\n\n  /**\n   * The unique identifier for the entity\n   */\n  public id: number = Entity._ID++;\n\n  /**\n   * Whether this entity is active, if set to false it will be reclaimed\n   */\n  public active: boolean = true;\n\n  /**\n   * Kill the entity, means it will no longer be updated. Kills are deferred to the end of the update.\n   */\n  public kill() {\n    this.active = false;\n  }\n\n  public isKilled() {\n    return !this.active;\n  }\n\n  /**\n   * Specifically get the tags on the entity from [[TagComponent]]\n   */\n  public get tags(): string[] {\n    return this._tagsMemo;\n  }\n\n  /**\n   * Check if a tag exists on the entity\n   * @param tag name to check for\n   */\n  public hasTag(tag: string): boolean {\n    return this.tags.includes(tag);\n  }\n\n  /**\n   * The types of the components on the Entity\n   */\n  public get types(): string[] {\n    return this._typesMemo;\n  }\n\n  private _tagsMemo: string[] = [];\n  private _typesMemo: string[] = [];\n  private _rebuildMemos() {\n    this._tagsMemo = Object.values(this.components)\n      .filter((c) => c instanceof TagComponent)\n      .map((c) => c.type);\n    this._typesMemo = Object.keys(this.components);\n  }\n\n  /**\n   * Bucket to hold on to deferred removals\n   */\n  private _componentsToRemove: (Component | string)[] = [];\n\n  /**\n   * Proxy handler for component changes, responsible for notifying observers\n   */\n  private _handleChanges = {\n    defineProperty: (obj: any, prop: any, descriptor: PropertyDescriptor) => {\n      obj[prop] = descriptor.value;\n      this._rebuildMemos();\n      this.changes.notifyAll(\n        new AddedComponent({\n          component: descriptor.value as Component,\n          entity: this\n        })\n      );\n      return true;\n    },\n    deleteProperty: (obj: any, prop: any) => {\n      if (prop in obj) {\n        this.changes.notifyAll(\n          new RemovedComponent({\n            component: obj[prop] as Component,\n            entity: this\n          })\n        );\n        delete obj[prop];\n        this._rebuildMemos();\n        return true;\n      }\n      return false;\n    }\n  };\n\n  /**\n   * Dictionary that holds entity components\n   */\n  public components = new Proxy<ComponentMapper<KnownComponents>>({} as any, this._handleChanges);\n\n  /**\n   * Observable that keeps track of component add or remove changes on the entity\n   */\n  public changes = new Observable<AddedComponent | RemovedComponent>();\n\n  /**\n   * Creates a deep copy of the entity and a copy of all its components\n   */\n  public clone(): Entity {\n    const newEntity = new Entity();\n    for (const c of this.types) {\n      newEntity.addComponent(this.components[c].clone());\n    }\n    return newEntity;\n  }\n\n  /**\n   * Adds a component to the entity, or adds a copy of all the components from another entity as a \"prefab\"\n   * @param componentOrEntity Component or Entity to add copy of components from\n   * @param force Optionally overwrite any existing components of the same type\n   */\n  public addComponent<T extends Component>(componentOrEntity: T | Entity<T>, force: boolean = false): Entity<KnownComponents | T> {\n    // If you use an entity as a \"prefab\" or template\n    if (componentOrEntity instanceof Entity) {\n      for (const c in componentOrEntity.components) {\n        this.addComponent(componentOrEntity.components[c].clone(), force);\n      }\n      // Normal component case\n    } else {\n      // if component already exists, skip if not forced\n      if (this.components[componentOrEntity.type] && !force) {\n        return this as Entity<KnownComponents | T>;\n      }\n\n      // Remove existing component type if exists when forced\n      if (this.components[componentOrEntity.type] && force) {\n        this.removeComponent(componentOrEntity);\n      }\n\n      // todo circular dependencies will be a problem\n      if (componentOrEntity.dependencies && componentOrEntity.dependencies.length) {\n        for (const ctor of componentOrEntity.dependencies) {\n          this.addComponent(new ctor());\n        }\n      }\n\n      componentOrEntity.owner = this;\n      (this.components as ComponentMap)[componentOrEntity.type] = componentOrEntity;\n      if (componentOrEntity.onAdd) {\n        componentOrEntity.onAdd(this);\n      }\n    }\n    return this as Entity<KnownComponents | T>;\n  }\n\n  /**\n   * Removes a component from the entity, by default removals are deferred to the end of entity processing to avoid consistency issues\n   *\n   * Components can be force removed with the `force` flag, the removal is not deferred and happens immediately\n   * @param componentOrType\n   * @param force\n   */\n  public removeComponent<ComponentOrType extends string | Component>(\n    componentOrType: ComponentOrType,\n    force = false\n  ): Entity<ExcludeType<KnownComponents, ComponentOrType>> {\n    if (force) {\n      if (typeof componentOrType === 'string') {\n        this._removeComponentByType(componentOrType);\n      } else if (componentOrType instanceof Component) {\n        this._removeComponentByType(componentOrType.type);\n      }\n    } else {\n      this._componentsToRemove.push(componentOrType);\n    }\n\n    return this as any;\n  }\n\n  private _removeComponentByType(type: string) {\n    if (this.components[type]) {\n      this.components[type].owner = null;\n      if (this.components[type].onRemove) {\n        this.components[type].onRemove(this);\n      }\n      delete this.components[type];\n    }\n  }\n\n  /**\n   * @hidden\n   * @internal\n   */\n  public processComponentRemoval() {\n    for (const componentOrType of this._componentsToRemove) {\n      const type = typeof componentOrType === 'string' ? componentOrType : componentOrType.type;\n      this._removeComponentByType(type);\n    }\n    this._componentsToRemove.length = 0;\n  }\n\n  /**\n   * Check if a component type exists\n   * @param type\n   */\n  public has(type: string): boolean {\n    return !!this.components[type];\n  }\n\n  private _isInitialized = false;\n\n  /**\n   * Gets whether the actor is Initialized\n   */\n  public get isInitialized(): boolean {\n    return this._isInitialized;\n  }\n\n  /**\n   * Initializes this entity, meant to be called by the Scene before first update not by users of Excalibur.\n   *\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\n   *\n   * @internal\n   */\n  public _initialize(engine: Engine) {\n    if (!this.isInitialized) {\n      this.onInitialize(engine);\n      super.emit('initialize', new InitializeEvent(engine, this));\n      this._isInitialized = true;\n    }\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPreUpdate(engine, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(engine: Engine, delta: number): void {\n    this.emit('postupdate', new PostUpdateEvent(engine, delta, this));\n    this.onPostUpdate(engine, delta);\n  }\n\n  /**\n   * `onInitialize` is called before the first update of the entity. This method is meant to be\n   * overridden.\n   *\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\n   */\n  public onInitialize(_engine: Engine): void {\n    // Override me\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before an entity is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after an entity is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // Override me\n  }\n}\n","import { Component } from '../EntityComponentSystem';\n\nexport class CanvasDrawComponent extends Component<'canvas'> {\n  public readonly type = 'canvas';\n\n  constructor(public draw?: (ctx: CanvasRenderingContext2D, delta: number) => void) {\n    super();\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    this.draw = this.draw ?? (() => {});\n  }\n}\n","import { Texture } from './Resources/Texture';\nimport {\n  InitializeEvent,\n  KillEvent,\n  PreUpdateEvent,\n  PostUpdateEvent,\n  PreDrawEvent,\n  PostDrawEvent,\n  PreDebugDrawEvent,\n  PostDebugDrawEvent,\n  PostCollisionEvent,\n  PreCollisionEvent,\n  CollisionStartEvent,\n  CollisionEndEvent,\n  PostKillEvent,\n  PreKillEvent,\n  GameEvent,\n  ExitTriggerEvent,\n  EnterTriggerEvent,\n  EnterViewPortEvent,\n  ExitViewPortEvent\n} from './Events';\nimport { PointerEvent, WheelEvent, PointerDragEvent, PointerEventName } from './Input/PointerEvents';\nimport { Engine } from './Engine';\nimport { Color } from './Drawing/Color';\nimport { Sprite } from './Drawing/Sprite';\nimport { Animation } from './Drawing/Animation';\nimport { Trait } from './Interfaces/Trait';\nimport { Drawable } from './Interfaces/Drawable';\nimport { CanInitialize, CanUpdate, CanDraw, CanBeKilled } from './Interfaces/LifecycleEvents';\nimport { Scene } from './Scene';\nimport { Logger } from './Util/Log';\nimport { ActionContext } from './Actions/ActionContext';\nimport { ActionQueue } from './Actions/Action';\nimport { Vector } from './Algebra';\nimport { Body } from './Collision/Body';\nimport { Eventable } from './Interfaces/Evented';\nimport { Actionable } from './Actions/Actionable';\nimport { Configurable } from './Configurable';\nimport * as Traits from './Traits/Index';\nimport * as Util from './Util/Util';\nimport * as Events from './Events';\nimport { PointerEvents } from './Interfaces/PointerEventHandlers';\nimport { CollisionType } from './Collision/CollisionType';\nimport { obsolete } from './Util/Decorators';\nimport { Collider } from './Collision/Collider';\nimport { Shape } from './Collision/Shape';\n\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { CanvasDrawComponent } from './Drawing/CanvasDrawComponent';\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\n\n/**\n * Type guard for checking if something is an Actor\n * @param x\n */\nexport function isActor(x: any): x is Actor {\n  return x instanceof Actor;\n}\n\nexport interface ActorArgs extends Partial<ActorImpl> {\n  x?: number;\n  y?: number;\n  width?: number;\n  height?: number;\n  pos?: Vector;\n  vel?: Vector;\n  acc?: Vector;\n  rotation?: number;\n  rx?: number;\n  z?: number;\n  color?: Color;\n  visible?: boolean;\n  body?: Body;\n  collisionType?: CollisionType;\n}\n\nexport interface ActorDefaults {\n  anchor: Vector;\n}\n\n/**\n * @hidden\n */\n\nexport class ActorImpl\n  extends Entity<TransformComponent | CanvasDrawComponent>\n  implements Actionable, Eventable, PointerEvents, CanInitialize, CanUpdate, CanDraw, CanBeKilled {\n  // #region Properties\n\n  /**\n   * Indicates the next id to be set\n   */\n  public static defaults: ActorDefaults = {\n    anchor: Vector.Half\n  };\n\n  /**\n   * The physics body the is associated with this actor. The body is the container for all physical properties, like position, velocity,\n   * acceleration, mass, inertia, etc.\n   */\n  public get body(): Body {\n    return this._body;\n  }\n\n  public set body(body: Body) {\n    this._body = body;\n    this._body.actor = this;\n  }\n\n  private _body: Body;\n\n  /**\n   * Gets the position vector of the actor in pixels\n   */\n  public get pos(): Vector {\n    return this.body.pos;\n  }\n\n  /**\n   * Sets the position vector of the actor in pixels\n   */\n  public set pos(thePos: Vector) {\n    this.body.pos.setTo(thePos.x, thePos.y);\n  }\n\n  /**\n   * Gets the position vector of the actor from the last frame\n   */\n  public get oldPos(): Vector {\n    return this.body.oldPos;\n  }\n\n  /**\n   * Sets the position vector of the actor in the last frame\n   */\n  public set oldPos(thePos: Vector) {\n    this.body.oldPos.setTo(thePos.x, thePos.y);\n  }\n\n  /**\n   * Gets the velocity vector of the actor in pixels/sec\n   */\n  public get vel(): Vector {\n    return this.body.vel;\n  }\n\n  /**\n   * Sets the velocity vector of the actor in pixels/sec\n   */\n  public set vel(theVel: Vector) {\n    this.body.vel.setTo(theVel.x, theVel.y);\n  }\n\n  /**\n   * Gets the velocity vector of the actor from the last frame\n   */\n  public get oldVel(): Vector {\n    return this.body.oldVel;\n  }\n\n  /**\n   * Sets the velocity vector of the actor from the last frame\n   */\n  public set oldVel(theVel: Vector) {\n    this.body.oldVel.setTo(theVel.x, theVel.y);\n  }\n\n  /**\n   * Gets the acceleration vector of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may be\n   * useful to simulate a gravitational effect.\n   */\n  public get acc(): Vector {\n    return this.body.acc;\n  }\n\n  /**\n   * Sets the acceleration vector of teh actor in pixels/second/second\n   */\n  public set acc(theAcc: Vector) {\n    this.body.acc.setTo(theAcc.x, theAcc.y);\n  }\n\n  /**\n   * Sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\n   */\n  public set oldAcc(theAcc: Vector) {\n    this.body.oldAcc.setTo(theAcc.x, theAcc.y);\n  }\n\n  /**\n   * Gets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\n   */\n  public get oldAcc(): Vector {\n    return this.body.oldAcc;\n  }\n\n  /**\n   * Gets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\n   */\n  public get rotation(): number {\n    return this.body.rotation;\n  }\n\n  /**\n   * Sets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\n   */\n  public set rotation(theAngle: number) {\n    this.body.rotation = theAngle;\n  }\n\n  /**\n   * Gets the rotational velocity of the actor in radians/second\n   */\n  public get rx(): number {\n    return this.body.rx;\n  }\n\n  /**\n   * Sets the rotational velocity of the actor in radians/sec\n   */\n  public set rx(angularVelocity: number) {\n    this.body.rx = angularVelocity;\n  }\n\n  /**\n   * The anchor to apply all actor related transformations like rotation,\n   * translation, and scaling. By default the anchor is in the center of\n   * the actor. By default it is set to the center of the actor (.5, .5)\n   *\n   * An anchor of (.5, .5) will ensure that drawings are centered.\n   *\n   * Use `anchor.setTo` to set the anchor to a different point using\n   * values between 0 and 1. For example, anchoring to the top-left would be\n   * `Actor.anchor.setTo(0, 0)` and top-right would be `Actor.anchor.setTo(0, 1)`.\n   */\n  public anchor: Vector;\n\n  private _height: number = 0;\n  private _width: number = 0;\n\n  /**\n   * Gets the scale vector of the actor\n   * @obsolete ex.Actor.scale will be removed in v0.25.0, set width and height directly in constructor\n   */\n  public get scale(): Vector {\n    return this.body.scale;\n  }\n\n  /**\n   * Sets the scale vector of the actor for\n   * @obsolete ex.Actor.scale will be removed in v0.25.0, set width and height directly in constructor\n   */\n  public set scale(scale: Vector) {\n    this.body.scale = scale;\n  }\n\n  /**\n   * Gets the old scale of the actor last frame\n   * @obsolete ex.Actor.scale will be removed in v0.25.0, set width and height directly in constructor\n   */\n  public get oldScale(): Vector {\n    return this.body.oldScale;\n  }\n\n  /**\n   * Sets the the old scale of the actor last frame\n   * @obsolete ex.Actor.scale will be removed in v0.25.0, set width and height directly in constructor\n   */\n  public set oldScale(scale: Vector) {\n    this.body.oldScale = scale;\n  }\n\n  /**\n   * Gets the x scalar velocity of the actor in scale/second\n   * @obsolete ex.Actor.sx will be removed in v0.25.0, set width and height directly in constructor\n   */\n  public get sx(): number {\n    return this.body.sx;\n  }\n\n  /**\n   * Sets the x scalar velocity of the actor in scale/second\n   * @obsolete ex.Actor.sx will be removed in v0.25.0, set width and height directly in constructor\n   */\n  @obsolete({ message: 'ex.Actor.sx will be removed in v0.25.0', alternateMethod: 'Set width and height directly in constructor' })\n  public set sx(scalePerSecondX: number) {\n    this.body.sx = scalePerSecondX;\n  }\n\n  /**\n   * Gets the y scalar velocity of the actor in scale/second\n   * @obsolete ex.Actor.sy will be removed in v0.25.0, set width and height directly in constructor\n   */\n  public get sy(): number {\n    return this.body.sy;\n  }\n\n  /**\n   * Sets the y scale velocity of the actor in scale/second\n   * @obsolete ex.Actor.sy will be removed in v0.25.0, set width and height directly in constructor\n   */\n  @obsolete({ message: 'ex.Actor.sy will be removed in v0.25.0', alternateMethod: 'Set width and height directly in constructor' })\n  public set sy(scalePerSecondY: number) {\n    this.body.sy = scalePerSecondY;\n  }\n\n  /**\n   * Indicates whether the actor is physically in the viewport\n   */\n  public isOffScreen: boolean = false;\n  /**\n   * The visibility of an actor\n   */\n  public visible: boolean = true;\n  /**\n   * The opacity of an actor. Passing in a color in the [[constructor]] will use the\n   * color's opacity.\n   */\n  public opacity: number = 1;\n  public previousOpacity: number = 1;\n\n  /**\n   * Direct access to the actor's [[ActionQueue]]. Useful if you are building custom actions.\n   */\n  public actionQueue: ActionQueue;\n\n  /**\n   * [[ActionContext|Action context]] of the actor. Useful for scripting actor behavior.\n   */\n  public actions: ActionContext;\n\n  /**\n   * Convenience reference to the global logger\n   */\n  public logger: Logger = Logger.getInstance();\n\n  /**\n   * The scene that the actor is in\n   */\n  public scene: Scene = null;\n\n  /**\n   * The parent of this actor\n   */\n  public parent: Actor = null;\n\n  /**\n   * The children of this actor\n   */\n  public children: Actor[] = [];\n\n  public frames: { [key: string]: Drawable } = {};\n\n  /**\n   * Access to the current drawing for the actor, this can be\n   * an [[Animation]], [[Sprite]], or [[Polygon]].\n   * Set drawings with [[setDrawing]].\n   */\n  public currentDrawing: Drawable = null;\n\n  /**\n   * Draggable helper\n   */\n\n  private _draggable: boolean = false;\n  private _dragging: boolean = false;\n\n  private _pointerDragStartHandler = () => {\n    this._dragging = true;\n  };\n\n  private _pointerDragEndHandler = () => {\n    this._dragging = false;\n  };\n\n  private _pointerDragMoveHandler = (pe: PointerEvent) => {\n    if (this._dragging) {\n      this.pos = pe.pointer.lastWorldPos;\n    }\n  };\n\n  private _pointerDragLeaveHandler = (pe: PointerEvent) => {\n    if (this._dragging) {\n      this.pos = pe.pointer.lastWorldPos;\n    }\n  };\n\n  public get draggable(): boolean {\n    return this._draggable;\n  }\n\n  public set draggable(isDraggable: boolean) {\n    if (isDraggable) {\n      if (isDraggable && !this._draggable) {\n        this.on('pointerdragstart', this._pointerDragStartHandler);\n        this.on('pointerdragend', this._pointerDragEndHandler);\n        this.on('pointerdragmove', this._pointerDragMoveHandler);\n        this.on('pointerdragleave', this._pointerDragLeaveHandler);\n      } else if (!isDraggable && this._draggable) {\n        this.off('pointerdragstart', this._pointerDragStartHandler);\n        this.off('pointerdragend', this._pointerDragEndHandler);\n        this.off('pointerdragmove', this._pointerDragMoveHandler);\n        this.off('pointerdragleave', this._pointerDragLeaveHandler);\n      }\n\n      this._draggable = isDraggable;\n    }\n  }\n\n  /**\n   * Modify the current actor update pipeline.\n   */\n  public traits: Trait[] = [];\n\n  /**\n   * Sets the color of the actor. A rectangle of this color will be\n   * drawn if no [[Drawable]] is specified as the actors drawing.\n   *\n   * The default is `null` which prevents a rectangle from being drawn.\n   */\n  public get color(): Color {\n    return this._color;\n  }\n  public set color(v: Color) {\n    this._color = v.clone();\n  }\n  private _color: Color;\n\n  /**\n   * Whether or not to enable the [[CapturePointer]] trait that propagates\n   * pointer events to this actor\n   */\n  public enableCapturePointer: boolean = false;\n\n  /**\n   * Configuration for [[CapturePointer]] trait\n   */\n  public capturePointer: Traits.CapturePointerConfig = {\n    captureMoveEvents: false,\n    captureDragEvents: false\n  };\n\n  private _isKilled: boolean = false;\n\n  // #endregion\n\n  /**\n   * @param xOrConfig The starting x coordinate of the actor, or an option bag of [[ActorArgs]]\n   * @param y         The starting y coordinate of the actor\n   * @param width     The starting width of the actor\n   * @param height    The starting height of the actor\n   * @param color     The starting color of the actor. Leave null to draw a transparent actor. The opacity of the color will be used as the\n   * initial [[opacity]].\n   */\n  constructor(xOrConfig?: number | ActorArgs, y?: number, width?: number, height?: number, color?: Color) {\n    super();\n\n    // initialize default options\n    this._initDefaults();\n\n    this.addComponent(new TransformComponent());\n    this.addComponent(new CanvasDrawComponent((ctx, delta) => this.draw(ctx, delta)));\n\n    let shouldInitializeBody = true;\n    let collisionType = CollisionType.Passive;\n    if (xOrConfig && typeof xOrConfig === 'object') {\n      const config = xOrConfig;\n      if (config.pos) {\n        xOrConfig = config.pos ? config.pos.x : 0;\n        y = config.pos ? config.pos.y : 0;\n      } else {\n        xOrConfig = config.x || 0;\n        y = config.y || 0;\n      }\n      width = config.width;\n      height = config.height;\n\n      if (config.body) {\n        shouldInitializeBody = false;\n        this.body = config.body;\n      }\n\n      if (config.anchor) {\n        this.anchor = config.anchor;\n      }\n\n      if (config.collisionType) {\n        collisionType = config.collisionType;\n      }\n    }\n\n    // Body and collider bounds are still determined by actor width/height\n    this._width = width || 0;\n    this._height = height || 0;\n\n    // Initialize default collider to be a box\n    if (shouldInitializeBody) {\n      this.body = new Body({\n        collider: new Collider({\n          type: collisionType,\n          shape: Shape.Box(this._width, this._height, this.anchor)\n        })\n      });\n    }\n\n    // Position uses body to store values must be initialized after body\n    this.pos.x = <number>xOrConfig || 0;\n    this.pos.y = y || 0;\n\n    if (color) {\n      this.color = color;\n      // set default opacity of an actor to the color\n      this.opacity = color.a;\n    }\n\n    // Build default pipeline\n    this.traits.push(new Traits.TileMapCollisionDetection());\n    this.traits.push(new Traits.OffscreenCulling());\n    this.traits.push(new Traits.CapturePointer());\n\n    // Build the action queue\n    this.actionQueue = new ActionQueue(this);\n    this.actions = new ActionContext(this);\n  }\n\n  /**\n   * `onInitialize` is called before the first update of the actor. This method is meant to be\n   * overridden. This is where initialization of child actors should take place.\n   *\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\n   */\n  public onInitialize(_engine: Engine): void {\n    // Override me\n  }\n\n  /**\n   * Initializes this actor and all it's child actors, meant to be called by the Scene before first update not by users of Excalibur.\n   *\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * @internal\n   */\n  public _initialize(engine: Engine) {\n    super._initialize(engine);\n    for (const child of this.children) {\n      child._initialize(engine);\n    }\n  }\n\n  private _initDefaults() {\n    this.anchor = Actor.defaults.anchor.clone();\n  }\n\n  // #region Events\n\n  private _capturePointerEvents: PointerEventName[] = [\n    'pointerup',\n    'pointerdown',\n    'pointermove',\n    'pointerenter',\n    'pointerleave',\n    'pointerdragstart',\n    'pointerdragend',\n    'pointerdragmove',\n    'pointerdragenter',\n    'pointerdragleave'\n  ];\n\n  private _captureMoveEvents: PointerEventName[] = [\n    'pointermove',\n    'pointerenter',\n    'pointerleave',\n    'pointerdragmove',\n    'pointerdragenter',\n    'pointerdragleave'\n  ];\n\n  private _captureDragEvents: PointerEventName[] = [\n    'pointerdragstart',\n    'pointerdragend',\n    'pointerdragmove',\n    'pointerdragenter',\n    'pointerdragleave'\n  ];\n\n  private _checkForPointerOptIn(eventName: string) {\n    if (eventName) {\n      const normalized = <PointerEventName>eventName.toLowerCase();\n\n      if (this._capturePointerEvents.indexOf(normalized) !== -1) {\n        this.enableCapturePointer = true;\n\n        if (this._captureMoveEvents.indexOf(normalized) !== -1) {\n          this.capturePointer.captureMoveEvents = true;\n        }\n\n        if (this._captureDragEvents.indexOf(normalized) !== -1) {\n          this.capturePointer.captureDragEvents = true;\n        }\n      }\n    }\n  }\n\n  public on(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\n  public on(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\n  /**\n   * The **collisionstart** event is fired when a [[Body|physics body]], usually attached to an actor,\n   *  first starts colliding with another [[Body|body]], and will not fire again while in contact until\n   *  the the pair separates and collides again.\n   * Use cases for the **collisionstart** event may be detecting when an actor has touched a surface\n   * (like landing) or if a item has been touched and needs to be picked up.\n   */\n  public on(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\n  /**\n   * The **collisionend** event is fired when two [[Body|physics bodies]] are no longer in contact.\n   * This event will not fire again until another collision and separation.\n   *\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\n   * (like jumping) or has left an area.\n   */\n  public on(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\n  /**\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\n   * bodies are intersecting.\n   *\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\n   * ricochet of the ball depending on which side of the paddle you hit.\n   */\n  public on(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\n  /**\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\n   * type collision pairs.\n   *\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\n   * tweak the default resolution.\n   */\n  public on(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\n  public on(eventName: Events.kill, handler: (event: KillEvent) => void): void;\n  public on(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\n  public on(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent<Actor>) => void): void;\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Actor>) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Actor>) => void): void;\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public on(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\n  public on(eventName: Events.pointerdragstart, handler: (event: PointerDragEvent) => void): void;\n  public on(eventName: Events.pointerdragend, handler: (event: PointerDragEvent) => void): void;\n  public on(eventName: Events.pointerdragenter, handler: (event: PointerDragEvent) => void): void;\n  public on(eventName: Events.pointerdragleave, handler: (event: PointerDragEvent) => void): void;\n  public on(eventName: Events.pointerdragmove, handler: (event: PointerDragEvent) => void): void;\n  public on(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\n  public on(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    this._checkForPointerOptIn(eventName);\n    super.on(eventName, handler);\n  }\n\n  public once(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\n  public once(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\n  /**\n   * The **collisionstart** event is fired when a [[Body|physics body]], usually attached to an actor,\n   *  first starts colliding with another [[Body|body]], and will not fire again while in contact until\n   *  the the pair separates and collides again.\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\n   * (like landing) or if a item has been touched and needs to be picked up.\n   */\n  public once(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\n  /**\n   * The **collisionend** event is fired when two [[Body|physics bodies]] are no longer in contact.\n   * This event will not fire again until another collision and separation.\n   *\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\n   * (like jumping) or has left an area.\n   */\n  public once(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\n  /**\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\n   * bodies are intersecting.\n   *\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\n   * ricochet of the ball depending on which side of the paddle you hit.\n   */\n  public once(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\n  /**\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\n   * type collision pairs.\n   *\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\n   * tweak the default resolution.\n   */\n  public once(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\n  public once(eventName: Events.kill, handler: (event: KillEvent) => void): void;\n  public once(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\n  public once(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent<Actor>) => void): void;\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Actor>) => void): void;\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Actor>) => void): void;\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public once(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\n  public once(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\n  public once(eventName: Events.pointerdragstart, handler: (event: PointerDragEvent) => void): void;\n  public once(eventName: Events.pointerdragend, handler: (event: PointerDragEvent) => void): void;\n  public once(eventName: Events.pointerdragenter, handler: (event: PointerDragEvent) => void): void;\n  public once(eventName: Events.pointerdragleave, handler: (event: PointerDragEvent) => void): void;\n  public once(eventName: Events.pointerdragmove, handler: (event: PointerDragEvent) => void): void;\n  public once(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\n  public once(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    this._checkForPointerOptIn(eventName);\n    super.once(eventName, handler);\n  }\n\n  public off(eventName: Events.exittrigger, handler?: (event: ExitTriggerEvent) => void): void;\n  public off(eventName: Events.entertrigger, handler?: (event: EnterTriggerEvent) => void): void;\n  /**\n   * The **collisionstart** event is fired when a [[Body|physics body]], usually attached to an actor,\n   *  first starts colliding with another [[Body|body]], and will not fire again while in contact until\n   *  the the pair separates and collides again.\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\n   * (like landing) or if a item has been touched and needs to be picked up.\n   */\n  public off(eventName: Events.collisionstart, handler?: (event: CollisionStartEvent) => void): void;\n  /**\n   * The **collisionend** event is fired when two [[Body|physics bodies]] are no longer in contact.\n   * This event will not fire again until another collision and separation.\n   *\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\n   * (like jumping) or has left an area.\n   */\n  public off(eventName: Events.collisionend, handler?: (event: CollisionEndEvent) => void): void;\n  /**\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\n   * bodies are intersecting.\n   *\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\n   * ricochet of the ball depending on which side of the paddle you hit.\n   */\n  public off(eventName: Events.precollision, handler?: (event: PreCollisionEvent) => void): void;\n  /**\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\n   * type collision pairs.\n   *\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\n   * tweak the default resolution.\n   */\n  public off(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\n  public off(eventName: Events.pointerup, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerdown, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerenter, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerleave, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointermove, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointercancel, handler?: (event: PointerEvent) => void): void;\n  public off(eventName: Events.pointerwheel, handler?: (event: WheelEvent) => void): void;\n  public off(eventName: Events.pointerdragstart, handler?: (event: PointerDragEvent) => void): void;\n  public off(eventName: Events.pointerdragend, handler?: (event: PointerDragEvent) => void): void;\n  public off(eventName: Events.pointerdragenter, handler?: (event: PointerDragEvent) => void): void;\n  public off(eventName: Events.pointerdragleave, handler?: (event: PointerDragEvent) => void): void;\n  public off(eventName: Events.pointerdragmove, handler?: (event: PointerDragEvent) => void): void;\n  public off(eventName: Events.prekill, handler?: (event: PreKillEvent) => void): void;\n  public off(eventName: Events.postkill, handler?: (event: PostKillEvent) => void): void;\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<Actor>) => void): void;\n  public off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent<Actor>) => void): void;\n  public off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent<Actor>) => void): void;\n  public off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\n  public off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\n  public off(eventName: Events.enterviewport, handler?: (event: EnterViewPortEvent) => void): void;\n  public off(eventName: Events.exitviewport, handler?: (event: ExitViewPortEvent) => void): void;\n  public off(eventName: string, handler?: (event: GameEvent<Actor>) => void): void;\n  public off(eventName: string, handler?: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  // #endregion\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _prekill handler for [[onPreKill]] lifecycle event\n   * @internal\n   */\n  public _prekill(_scene: Scene) {\n    super.emit('prekill', new PreKillEvent(this));\n    this.onPreKill(_scene);\n  }\n\n  /**\n   * Safe to override onPreKill lifecycle event handler. Synonymous with `.on('prekill', (evt) =>{...})`\n   *\n   * `onPreKill` is called directly before an actor is killed and removed from its current [[Scene]].\n   */\n  public onPreKill(_scene: Scene) {\n    // Override me\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _prekill handler for [[onPostKill]] lifecycle event\n   * @internal\n   */\n  public _postkill(_scene: Scene) {\n    super.emit('postkill', new PostKillEvent(this));\n    this.onPostKill(_scene);\n  }\n\n  /**\n   * Safe to override onPostKill lifecycle event handler. Synonymous with `.on('postkill', (evt) => {...})`\n   *\n   * `onPostKill` is called directly after an actor is killed and remove from its current [[Scene]].\n   */\n  public onPostKill(_scene: Scene) {\n    // Override me\n  }\n\n  /**\n   * If the current actor is a member of the scene, this will remove\n   * it from the scene graph. It will no longer be drawn or updated.\n   */\n  public kill() {\n    if (this.scene) {\n      this._prekill(this.scene);\n      this.emit('kill', new KillEvent(this));\n      this._isKilled = true;\n      this.scene.remove(this);\n      this._postkill(this.scene);\n    } else {\n      this.logger.warn('Cannot kill actor, it was never added to the Scene');\n    }\n  }\n\n  /**\n   * If the current actor is killed, it will now not be killed.\n   */\n  public unkill() {\n    this._isKilled = false;\n  }\n\n  /**\n   * Indicates wether the actor has been killed.\n   */\n  public isKilled(): boolean {\n    return this._isKilled;\n  }\n\n  /**\n   * Adds a child actor to this actor. All movement of the child actor will be\n   * relative to the parent actor. Meaning if the parent moves the child will\n   * move with it.\n   * @param actor The child actor to add\n   */\n  public add(actor: Actor) {\n    actor.body.collider.type = CollisionType.PreventCollision;\n    if (Util.addItemToArray(actor, this.children)) {\n      actor.parent = this;\n      if (this.scene) {\n        this.scene.world.add(actor);\n      }\n    }\n  }\n  /**\n   * Removes a child actor from this actor.\n   * @param actor The child actor to remove\n   */\n  public remove(actor: Actor) {\n    if (Util.removeItemFromArray(actor, this.children)) {\n      actor.parent = null;\n    }\n  }\n  /**\n   * Sets the current drawing of the actor to the drawing corresponding to\n   * the key.\n   * @param key The key of the drawing\n   */\n  public setDrawing(key: string): void;\n  /**\n   * Sets the current drawing of the actor to the drawing corresponding to\n   * an `enum` key (e.g. `Animations.Left`)\n   * @param key The `enum` key of the drawing\n   */\n  public setDrawing(key: number): void;\n  public setDrawing(key: any): void {\n    key = key.toString();\n    if (this.currentDrawing !== this.frames[<string>key]) {\n      if (this.frames[key] != null) {\n        this.frames[key].reset();\n        this.currentDrawing = this.frames[key];\n      } else {\n        Logger.getInstance().error(`the specified drawing key ${key} does not exist`);\n      }\n    }\n    if (this.currentDrawing && this.currentDrawing instanceof Animation) {\n      this.currentDrawing.tick(0);\n    }\n  }\n\n  /**\n   * Adds a whole texture as the \"default\" drawing. Set a drawing using [[setDrawing]].\n   */\n  public addDrawing(texture: Texture): void;\n  /**\n   * Adds a whole sprite as the \"default\" drawing. Set a drawing using [[setDrawing]].\n   */\n  public addDrawing(sprite: Sprite): void;\n  /**\n   * Adds a drawing to the list of available drawings for an actor. Set a drawing using [[setDrawing]].\n   * @param key     The key to associate with a drawing for this actor\n   * @param drawing This can be an [[Animation]], [[Sprite]], or [[Polygon]].\n   */\n  public addDrawing(key: any, drawing: Drawable): void;\n  public addDrawing(): void {\n    if (arguments.length === 2) {\n      this.frames[<string>arguments[0]] = arguments[1];\n      if (!this.currentDrawing) {\n        this.currentDrawing = arguments[1];\n      }\n    } else {\n      if (arguments[0] instanceof Sprite) {\n        this.addDrawing('default', arguments[0]);\n      }\n      if (arguments[0] instanceof Texture) {\n        this.addDrawing('default', arguments[0].asSprite());\n      }\n    }\n  }\n\n  public get z(): number {\n    return this.getZIndex();\n  }\n\n  public set z(newZ: number) {\n    this.setZIndex(newZ);\n  }\n\n  /**\n   * Gets the z-index of an actor. The z-index determines the relative order an actor is drawn in.\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\n   * @deprecated Use actor.z\n   */\n  public getZIndex(): number {\n    return this.components.transform.z;\n  }\n\n  /**\n   * Sets the z-index of an actor and updates it in the drawing list for the scene.\n   * The z-index determines the relative order an actor is drawn in.\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\n   * @param newIndex new z-index to assign\n   * @deprecated Use actor.z\n   */\n  public setZIndex(newIndex: number) {\n    this.components.transform.z = newIndex;\n  }\n\n  /**\n   * Get the center point of an actor\n   */\n  public get center(): Vector {\n    return new Vector(this.pos.x + this.width / 2 - this.anchor.x * this.width, this.pos.y + this.height / 2 - this.anchor.y * this.height);\n  }\n\n  public get width() {\n    return this._width * this.getGlobalScale().x;\n  }\n\n  public set width(width: number) {\n    this._width = width / this.scale.x;\n    this.body.collider.shape = Shape.Box(this._width, this._height, this.anchor);\n    this.body.markCollisionShapeDirty();\n  }\n\n  public get height() {\n    return this._height * this.getGlobalScale().y;\n  }\n\n  public set height(height: number) {\n    this._height = height / this.scale.y;\n    this.body.collider.shape = Shape.Box(this._width, this._height, this.anchor);\n    this.body.markCollisionShapeDirty();\n  }\n\n  /**\n   * Gets this actor's rotation taking into account any parent relationships\n   *\n   * @returns Rotation angle in radians\n   */\n  public getWorldRotation(): number {\n    if (!this.parent) {\n      return this.rotation;\n    }\n\n    return this.rotation + this.parent.getWorldRotation();\n  }\n\n  /**\n   * Gets an actor's world position taking into account parent relationships, scaling, rotation, and translation\n   *\n   * @returns Position in world coordinates\n   */\n  public getWorldPos(): Vector {\n    if (!this.parent) {\n      return this.pos.clone();\n    }\n\n    // collect parents\n    const parents: Actor[] = [];\n    let root: Actor = this;\n\n    parents.push(this);\n\n    // find parents\n    while (root.parent) {\n      root = root.parent;\n      parents.push(root);\n    }\n\n    // calculate position\n    const x = parents.reduceRight((px, p) => {\n      if (p.parent) {\n        return px + p.pos.x * p.getGlobalScale().x;\n      }\n      return px + p.pos.x;\n    }, 0);\n\n    const y = parents.reduceRight((py, p) => {\n      if (p.parent) {\n        return py + p.pos.y * p.getGlobalScale().y;\n      }\n      return py + p.pos.y;\n    }, 0);\n\n    // rotate around root anchor\n    const ra = root.getWorldPos(); // 10, 10\n    const r = this.getWorldRotation();\n\n    return new Vector(x, y).rotate(r, ra);\n  }\n\n  /**\n   * Gets the global scale of the Actor\n   */\n  public getGlobalScale(): Vector {\n    if (!this.parent) {\n      return new Vector(this.scale.x, this.scale.y);\n    }\n\n    const parentScale = this.parent.getGlobalScale();\n    return new Vector(this.scale.x * parentScale.x, this.scale.y * parentScale.y);\n  }\n\n  // #region Collision\n\n  /**\n   * Tests whether the x/y specified are contained in the actor\n   * @param x  X coordinate to test (in world coordinates)\n   * @param y  Y coordinate to test (in world coordinates)\n   * @param recurse checks whether the x/y are contained in any child actors (if they exist).\n   */\n  public contains(x: number, y: number, recurse: boolean = false): boolean {\n    // These shenanigans are to handle child actor containment,\n    // the only time getWorldPos and pos are different is a child actor\n    const childShift = this.getWorldPos().sub(this.pos);\n    const containment = this.body.collider.bounds.translate(childShift).contains(new Vector(x, y));\n\n    if (recurse) {\n      return (\n        containment ||\n        this.children.some((child: Actor) => {\n          return child.contains(x, y, true);\n        })\n      );\n    }\n\n    return containment;\n  }\n\n  /**\n   * Returns true if the two actor.body.collider.shape's surfaces are less than or equal to the distance specified from each other\n   * @param actor     Actor to test\n   * @param distance  Distance in pixels to test\n   */\n  public within(actor: Actor, distance: number): boolean {\n    return this.body.collider.shape.getClosestLineBetween(actor.body.collider.shape).getLength() <= distance;\n  }\n\n  // #endregion\n\n  // #region Update\n\n  /**\n   * Called by the Engine, updates the state of the actor\n   * @param engine The reference to the current game engine\n   * @param delta  The time elapsed since the last update in milliseconds\n   */\n  public update(engine: Engine, delta: number) {\n    this._initialize(engine);\n    this._preupdate(engine, delta);\n\n    // Tick animations\n    const drawing = this.currentDrawing;\n    if (drawing && drawing instanceof Animation) {\n      drawing.tick(delta, engine.stats.currFrame.id);\n    }\n\n    // Update action queue\n    this.actionQueue.update(delta);\n\n    // Update color only opacity\n    if (this.color) {\n      this.color.a = this.opacity;\n    }\n\n    if (this.opacity === 0) {\n      this.visible = false;\n    }\n\n    // capture old transform\n    this.body.captureOldTransform();\n\n    // Run Euler integration\n    this.body.integrate(delta);\n\n    // Update actor pipeline (movement, collision detection, event propagation, offscreen culling)\n    for (const trait of this.traits) {\n      trait.update(this, engine, delta);\n    }\n\n    // Update child actors\n    for (let i = 0; i < this.children.length; i++) {\n      this.children[i].update(engine, delta);\n    }\n\n    this._postupdate(engine, delta);\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before an actor is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after an actor is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPreUpdate(engine, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(engine: Engine, delta: number): void {\n    this.emit('postupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPostUpdate(engine, delta);\n  }\n\n  // endregion\n\n  // #region Drawing\n  /**\n   * Called by the Engine, draws the actor to the screen\n   * @param ctx   The rendering context\n   * @param delta The time since the last draw in milliseconds\n   */\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\n    // translate canvas by anchor offset\n    ctx.save();\n    ctx.translate(-(this._width * this.anchor.x), -(this._height * this.anchor.y));\n\n    this._predraw(ctx, delta);\n\n    if (this.currentDrawing) {\n      const drawing = this.currentDrawing;\n      // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\n      const offsetX = (this._width - drawing.width * drawing.scale.x) * this.anchor.x;\n      const offsetY = (this._height - drawing.height * drawing.scale.y) * this.anchor.y;\n\n      this.currentDrawing.draw({ ctx, x: offsetX, y: offsetY, opacity: this.opacity });\n    } else {\n      if (this.color && this.body && this.body.collider && this.body.collider.shape) {\n        this.body.collider.shape.draw(ctx, this.color, new Vector(0, 0));\n      }\n    }\n    ctx.restore();\n    this._postdraw(ctx, delta);\n  }\n\n  /**\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('predraw', (evt) =>{...})`\n   *\n   * `onPreDraw` is called directly before an actor is drawn, but after local transforms are made.\n   */\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('postdraw', (evt) =>{...})`\n   *\n   * `onPostDraw` is called directly after an actor is drawn, and before local transforms are removed.\n   */\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // Override me\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\n   * @internal\n   */\n  public _predraw(ctx: CanvasRenderingContext2D, delta: number): void {\n    this.emit('predraw', new PreDrawEvent(ctx, delta, this));\n    this.onPreDraw(ctx, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\n   * @internal\n   */\n  public _postdraw(ctx: CanvasRenderingContext2D, delta: number): void {\n    this.emit('postdraw', new PreDrawEvent(ctx, delta, this));\n    this.onPostDraw(ctx, delta);\n  }\n\n  /**\n   * Called by the Engine, draws the actors debugging to the screen\n   * @param ctx The rendering context\n   */\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    this.emit('predebugdraw', new PreDebugDrawEvent(ctx, this));\n\n    this.body.collider.debugDraw(ctx);\n\n    // Draw actor bounding box\n    const bb = this.body.collider.localBounds.translate(this.getWorldPos());\n    bb.debugDraw(ctx);\n\n    // Draw actor Id\n    ctx.fillText('id: ' + this.id, bb.left + 3, bb.top + 10);\n\n    // Draw actor anchor Vector\n    ctx.fillStyle = Color.Yellow.toString();\n    ctx.beginPath();\n    ctx.arc(this.getWorldPos().x, this.getWorldPos().y, 3, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    // Culling Box debug draw\n    for (let j = 0; j < this.traits.length; j++) {\n      if (this.traits[j] instanceof Traits.OffscreenCulling) {\n        (<Traits.OffscreenCulling>this.traits[j]).cullingBox.debugDraw(ctx); // eslint-disable-line\n      }\n    }\n\n    // Unit Circle debug draw\n    ctx.strokeStyle = Color.Yellow.toString();\n    ctx.beginPath();\n    const radius = Math.min(this.width, this.height);\n    ctx.arc(this.getWorldPos().x, this.getWorldPos().y, radius, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.stroke();\n    const ticks: { [key: string]: number } = {\n      '0 Pi': 0,\n      'Pi/2': Math.PI / 2,\n      Pi: Math.PI,\n      '3/2 Pi': (3 * Math.PI) / 2\n    };\n\n    const oldFont = ctx.font;\n    for (const tick in ticks) {\n      ctx.fillStyle = Color.Yellow.toString();\n      ctx.font = '14px';\n      ctx.textAlign = 'center';\n      ctx.fillText(\n        tick,\n        this.getWorldPos().x + Math.cos(ticks[tick]) * (radius + 10),\n        this.getWorldPos().y + Math.sin(ticks[tick]) * (radius + 10)\n      );\n    }\n\n    ctx.font = oldFont;\n\n    // Draw child actors\n    for (let i = 0; i < this.children.length; i++) {\n      this.children[i].debugDraw(ctx);\n    }\n\n    this.emit('postdebugdraw', new PostDebugDrawEvent(ctx, this));\n  }\n\n  /**\n   * Returns the full array of ancestors\n   */\n  public getAncestors(): Actor[] {\n    const path: Actor[] = [this];\n    let currentActor: Actor = this;\n    let parent: Actor;\n\n    while ((parent = currentActor.parent)) {\n      currentActor = parent;\n      path.push(currentActor);\n    }\n\n    return path.reverse();\n  }\n  // #endregion\n}\n\n/**\n * The most important primitive in Excalibur is an `Actor`. Anything that\n * can move on the screen, collide with another `Actor`, respond to events,\n * or interact with the current scene, must be an actor. An `Actor` **must**\n * be part of a [[Scene]] for it to be drawn to the screen.\n */\nexport class Actor extends Configurable(ActorImpl) {\n  constructor();\n  constructor(config?: ActorArgs);\n  constructor(x?: number, y?: number, width?: number, height?: number, color?: Color);\n  constructor(xOrConfig?: number | ActorArgs, y?: number, width?: number, height?: number, color?: Color) {\n    super(xOrConfig, y, width, height, color);\n  }\n}\n","/**\n * Internal class used to build instances of AudioContext\n */\n/* istanbul ignore next */\nexport class AudioContextFactory {\n  private static _INSTANCE: AudioContext = null;\n\n  public static create(): AudioContext {\n    if (!this._INSTANCE) {\n      if ((<any>window).AudioContext || (<any>window).webkitAudioContext) {\n        this._INSTANCE = new (<any>window).AudioContext();\n      }\n    }\n\n    return this._INSTANCE;\n  }\n}\n","import { AudioContextFactory } from '../Resources/Sound/AudioContext';\nimport { Logger } from './Log';\n\nexport interface LegacyWebAudioSource {\n  playbackState: string;\n  PLAYING_STATE: 'playing';\n  FINISHED_STATE: 'finished';\n}\n\n/**\n * Patch for detecting legacy web audio in browsers\n * @internal\n * @param source\n */\nfunction isLegacyWebAudioSource(source: any): source is LegacyWebAudioSource {\n  return !!source.playbackState;\n}\n\nexport class WebAudio {\n  private static _UNLOCKED: boolean = false;\n\n  /**\n   * Play an empty sound to unlock Safari WebAudio context. Call this function\n   * right after a user interaction event.\n   * @source https://paulbakaus.com/tutorials/html5/web-audio-on-ios/\n   */\n  static unlock(): Promise<boolean> {\n    const promise = new Promise<boolean>((resolve, reject) => {\n      if (WebAudio._UNLOCKED || !AudioContextFactory.create()) {\n        return resolve(true);\n      }\n      const unlockTimeoutTimer = setTimeout(() => {\n        Logger.getInstance().warn('Excalibur was unable to unlock the audio context, audio probably will not play in this browser.');\n        resolve();\n      }, 200);\n\n      const audioContext = AudioContextFactory.create();\n      audioContext.resume().then(\n        () => {\n          // create empty buffer and play it\n          const buffer = audioContext.createBuffer(1, 1, 22050);\n          const source = audioContext.createBufferSource();\n          let ended = false;\n\n          source.buffer = buffer;\n          source.connect(audioContext.destination);\n          source.onended = () => (ended = true);\n\n          source.start(0);\n\n          // by checking the play state after some time, we know if we're really unlocked\n          setTimeout(() => {\n            if (isLegacyWebAudioSource(source)) {\n              if (source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE) {\n                WebAudio._UNLOCKED = true;\n              }\n            } else {\n              if (audioContext.currentTime > 0 || ended) {\n                WebAudio._UNLOCKED = true;\n              }\n            }\n          }, 0);\n\n          clearTimeout(unlockTimeoutTimer);\n          resolve();\n        },\n        () => {\n          reject();\n        }\n      );\n    });\n\n\n    return promise;\n  }\n\n  static isUnlocked() {\n    return this._UNLOCKED;\n  }\n}\n","export default \"data:image/png;base64,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\"","import { Color } from './Drawing/Color';\nimport { WebAudio } from './Util/WebAudio';\nimport { Logger } from './Util/Log';\nimport { Engine } from './Engine';\nimport { Loadable } from './Interfaces/Loadable';\nimport { CanLoad } from './Interfaces/Loader';\nimport { Class } from './Class';\nimport * as DrawUtil from './Util/DrawUtil';\n\nimport logoImg from './Loader.logo.png';\nimport loaderCss from './Loader.css';\nimport { Vector } from './Algebra';\nimport { clamp } from './Util/Util';\n\n/**\n * Pre-loading assets\n *\n * The loader provides a mechanism to preload multiple resources at\n * one time. The loader must be passed to the engine in order to\n * trigger the loading progress bar.\n *\n * The [[Loader]] itself implements [[Loadable]] so you can load loaders.\n *\n * ## Example: Pre-loading resources for a game\n *\n * ```js\n * // create a loader\n * var loader = new ex.Loader();\n *\n * // create a resource dictionary (best practice is to keep a separate file)\n * var resources = {\n *   TextureGround: new ex.Texture(\"/images/textures/ground.png\"),\n *   SoundDeath: new ex.Sound(\"/sound/death.wav\", \"/sound/death.mp3\")\n * };\n *\n * // loop through dictionary and add to loader\n * for (var loadable in resources) {\n *   if (resources.hasOwnProperty(loadable)) {\n *     loader.addResource(resources[loadable]);\n *   }\n * }\n *\n * // start game\n * game.start(loader).then(function () {\n *   console.log(\"Game started!\");\n * });\n * ```\n *\n * ## Customize the Loader\n *\n * The loader can be customized to show different, text, logo, background color, and button.\n *\n * ```typescript\n * const loader = new ex.Loader([playerTexture]);\n *\n * // The loaders button text can simply modified using this\n * loader.playButtonText = 'Start the best game ever';\n *\n * // The logo can be changed by inserting a base64 image string here\n *\n * loader.logo = 'data:image/png;base64,iVBORw...';\n * loader.logoWidth = 15;\n * loader.logoHeight = 14;\n *\n * // The background color can be changed like so by supplying a valid CSS color string\n *\n * loader.backgroundColor = 'red'\n * loader.backgroundColor = '#176BAA'\n *\n * // To build a completely new button\n * loader.startButtonFactory = () => {\n *     let myButton = document.createElement('button');\n *     myButton.textContent = 'The best button';\n *     return myButton;\n * };\n *\n * engine.start(loader).then(() => {});\n * ```\n */\nexport class Loader extends Class implements CanLoad {\n  private _resourceList: Loadable[] = [];\n  private _index = 0;\n\n  private _playButtonShown: boolean = false;\n  private _resourceCount: number = 0;\n  private _numLoaded: number = 0;\n  private _progressCounts: { [key: string]: number } = {};\n  private _totalCounts: { [key: string]: number } = {};\n  private _engine: Engine;\n\n  // logo drawing stuff\n\n  // base64 string encoding of the excalibur logo (logo-white.png)\n  public logo = logoImg;\n  public logoWidth = 468;\n  public logoHeight = 118;\n  /**\n   * Positions the top left corner of the logo image\n   * If not set, the loader automatically positions the logo\n   */\n  public logoPosition: Vector | null;\n  /**\n   * Positions the top left corner of the play button.\n   * If not set, the loader automatically positions the play button\n   */\n  public playButtonPosition: Vector | null;\n  /**\n   * Positions the top left corner of the loading bar\n   * If not set, the loader automatically positions the loading bar\n   */\n  public loadingBarPosition: Vector | null;\n\n  /**\n   * Gets or sets the color of the loading bar, default is [[Color.White]]\n   */\n  public loadingBarColor: Color = Color.White;\n\n  /**\n   * Gets or sets the background color of the loader as a hex string\n   */\n  public backgroundColor: string = '#176BAA';\n\n  protected _imageElement: HTMLImageElement;\n  protected get _image() {\n    if (!this._imageElement) {\n      this._imageElement = new Image();\n      this._imageElement.src = this.logo;\n    }\n\n    return this._imageElement;\n  }\n\n  public suppressPlayButton: boolean = false;\n  public get playButtonRootElement(): HTMLElement | null {\n    return this._playButtonRootElement;\n  }\n  public get playButtonElement(): HTMLButtonElement | null {\n    return this._playButtonElement;\n  }\n  protected _playButtonRootElement: HTMLElement;\n  protected _playButtonElement: HTMLButtonElement;\n  protected _styleBlock: HTMLStyleElement;\n  /** Loads the css from Loader.css */\n  protected _playButtonStyles: string = loaderCss.toString();\n  protected get _playButton() {\n    if (!this._playButtonRootElement) {\n      this._playButtonRootElement = document.createElement('div');\n      this._playButtonRootElement.id = 'excalibur-play-root';\n      this._playButtonRootElement.style.position = 'absolute';\n      document.body.appendChild(this._playButtonRootElement);\n    }\n    if (!this._styleBlock) {\n      this._styleBlock = document.createElement('style');\n      this._styleBlock.textContent = this._playButtonStyles;\n      document.head.appendChild(this._styleBlock);\n    }\n    if (!this._playButtonElement) {\n      this._playButtonElement = this.startButtonFactory();\n      this._playButtonRootElement.appendChild(this._playButtonElement);\n    }\n    return this._playButtonElement;\n  }\n\n  /**\n   * Get/set play button text\n   */\n  public playButtonText: string = 'Play game';\n\n  /**\n   * Return a html button element for excalibur to use as a play button\n   */\n  public startButtonFactory = () => {\n    const buttonElement = document.createElement('button');\n    buttonElement.id = 'excalibur-play';\n    buttonElement.textContent = this.playButtonText;\n    buttonElement.style.display = 'none';\n    return buttonElement;\n  };\n\n  /**\n   * @param loadables  Optionally provide the list of resources you want to load at constructor time\n   */\n  constructor(loadables?: Loadable[]) {\n    super();\n\n    if (loadables) {\n      this.addResources(loadables);\n    }\n  }\n\n  public wireEngine(engine: Engine) {\n    this._engine = engine;\n  }\n\n  /**\n   * Add a resource to the loader to load\n   * @param loadable  Resource to add\n   */\n  public addResource(loadable: Loadable) {\n    const key = this._index++;\n    this._resourceList.push(loadable);\n    this._progressCounts[key] = 0;\n    this._totalCounts[key] = 1;\n    this._resourceCount++;\n  }\n\n  /**\n   * Add a list of resources to the loader to load\n   * @param loadables  The list of resources to load\n   */\n  public addResources(loadables: Loadable[]) {\n    let i = 0;\n    const len = loadables.length;\n\n    for (i; i < len; i++) {\n      this.addResource(loadables[i]);\n    }\n  }\n\n  /**\n   * Returns true if the loader has completely loaded all resources\n   */\n  public isLoaded() {\n    return this._numLoaded === this._resourceCount;\n  }\n\n  /**\n   * Shows the play button and returns a promise that resolves when clicked\n   */\n  public showPlayButton(): Promise<any> {\n    if (this.suppressPlayButton) {\n      return Promise.resolve();\n    } else {\n      this._playButtonShown = true;\n      this._playButton.style.display = 'block';\n      const promise = new Promise((resolve) => {\n        this._playButton.addEventListener('click', () => resolve());\n        this._playButton.addEventListener('touchend', () => resolve());\n        this._playButton.addEventListener('pointerup', () => resolve());\n      });\n\n      return promise;\n    }\n  }\n\n  public hidePlayButton() {\n    this._playButtonShown = false;\n    this._playButton.style.display = 'none';\n  }\n\n  /**\n   * Clean up generated elements for the loader\n   */\n  public dispose() {\n    if (this._playButtonRootElement.parentElement) {\n      this._playButtonRootElement.removeChild(this._playButtonElement);\n      document.body.removeChild(this._playButtonRootElement);\n      document.head.removeChild(this._styleBlock);\n      this._playButtonRootElement = null;\n      this._playButtonElement = null;\n      this._styleBlock = null;\n    }\n  }\n\n  /**\n   * Begin loading all of the supplied resources, returning a promise\n   * that resolves when loading of all is complete\n   */\n  public load(): Promise<any> {\n    const complete = new Promise<any>((resolve) => {\n      const me = this;\n      if (this._resourceList.length === 0) {\n        me.showPlayButton().then(() => {\n          // Unlock audio context in chrome after user gesture\n          // https://github.com/excaliburjs/Excalibur/issues/262\n          // https://github.com/excaliburjs/Excalibur/issues/1031\n          WebAudio.unlock().then(() => {\n            me.hidePlayButton();\n            me.oncomplete.call(me);\n            resolve();\n          });\n        });\n        return;\n      }\n\n      const progressArray = new Array<any>(this._resourceList.length);\n      const progressChunks = this._resourceList.length;\n\n      for (const index in this._resourceList) {\n        const resource = this._resourceList[index];\n        if (this._engine) {\n          resource.wireEngine(this._engine);\n        }\n        resource.onprogress = (e) => {\n          const total = <number>e.total;\n          const loaded = <number>e.loaded;\n          progressArray[index] = { loaded: (loaded / total) * (100 / progressChunks), total: 100 };\n\n          const progressResult: any = progressArray.reduce(\n            function (accum, next) {\n              return { loaded: accum.loaded + next.loaded, total: 100 };\n            },\n            { loaded: 0, total: 100 }\n          );\n\n          me.onprogress.call(me, progressResult);\n        };\n\n        resource.oncomplete = resource.onerror = () => {\n          me._numLoaded++;\n          if (me._numLoaded === me._resourceCount) {\n            setTimeout(() => {\n              me.showPlayButton().then(() => {\n                // Unlock audio context in chrome after user gesture\n                // https://github.com/excaliburjs/Excalibur/issues/262\n                // https://github.com/excaliburjs/Excalibur/issues/1031\n                WebAudio.unlock().then(() => {\n                  me.hidePlayButton();\n                  me.oncomplete.call(me);\n                  resolve();\n                });\n              });\n            }, 200); // short delay in showing the button for aesthetics\n          }\n        };\n      }\n\n      const loadNext = (list: Loadable[], index: number) => {\n        if (!list[index]) {\n          return;\n        }\n        list[index].load().then(() => {\n          loadNext(list, index + 1);\n        });\n      };\n      loadNext(this._resourceList, 0);\n    });\n    return complete;\n  }\n\n  public updateResourceProgress(loadedBytes: number, totalBytes: number) {\n    const chunkSize = 100 / this._resourceCount;\n    const resourceProgress = loadedBytes / totalBytes;\n    // This only works if we load 1 resource at a time\n    const totalProgress = resourceProgress * chunkSize + this.progress * 100;\n    this.onprogress({ loaded: totalProgress, total: 100 });\n  }\n\n  public markResourceComplete() {\n    this._numLoaded++;\n  }\n\n  /**\n   * Returns the progess of the loader as a number between [0, 1] inclusive.\n   */\n  public get progress(): number {\n    return this._resourceCount > 0 ? clamp(this._numLoaded, 0, this._resourceCount) / this._resourceCount : 1;\n  }\n\n  /**\n   * Loader draw function. Draws the default Excalibur loading screen.\n   * Override `logo`, `logoWidth`, `logoHeight` and `backgroundColor` properties\n   * to customize the drawing, or just override entire method.\n   */\n  public draw(ctx: CanvasRenderingContext2D) {\n    const canvasHeight = this._engine.canvasHeight / this._engine.pixelRatio;\n    const canvasWidth = this._engine.canvasWidth / this._engine.pixelRatio;\n\n    if (this._playButtonRootElement) {\n      const left = ctx.canvas.offsetLeft;\n      const top = ctx.canvas.offsetTop;\n      const buttonWidth = this._playButton.clientWidth;\n      const buttonHeight = this._playButton.clientHeight;\n      if (this.playButtonPosition) {\n        this._playButtonRootElement.style.left = `${this.playButtonPosition.x}px`;\n        this._playButtonRootElement.style.top = `${this.playButtonPosition.y}px`;\n      } else {\n        this._playButtonRootElement.style.left = `${left + canvasWidth / 2 - buttonWidth / 2}px`;\n        this._playButtonRootElement.style.top = `${top + canvasHeight / 2 - buttonHeight / 2 + 100}px`;\n      }\n    }\n\n    ctx.fillStyle = this.backgroundColor;\n    ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n\n    let logoY = canvasHeight / 2;\n    const width = Math.min(this.logoWidth, canvasWidth * 0.75);\n    let logoX = canvasWidth / 2 - width / 2;\n\n    if (this.logoPosition) {\n      logoX = this.logoPosition.x;\n      logoY = this.logoPosition.y;\n    }\n\n    const imageHeight = Math.floor(width * (this.logoHeight / this.logoWidth)); // OG height/width factor\n    const oldAntialias = this._engine.getAntialiasing();\n    this._engine.setAntialiasing(true);\n    if (!this.logoPosition) {\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY - imageHeight - 20, width, imageHeight);\n    } else {\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY, width, imageHeight);\n    }\n\n    // loading box\n    if (!this.suppressPlayButton && this._playButtonShown) {\n      this._engine.setAntialiasing(oldAntialias);\n      return;\n    }\n\n    let loadingX = logoX;\n    let loadingY = logoY;\n    if (this.loadingBarPosition) {\n      loadingX = this.loadingBarPosition.x;\n      loadingY = this.loadingBarPosition.y;\n    }\n\n    ctx.lineWidth = 2;\n    DrawUtil.roundRect(ctx, loadingX, loadingY, width, 20, 10, this.loadingBarColor);\n    const progress = width * this.progress;\n    const margin = 5;\n    const progressWidth = progress - margin * 2;\n    const height = 20 - margin * 2;\n    DrawUtil.roundRect(\n      ctx,\n      loadingX + margin,\n      loadingY + margin,\n      progressWidth > 10 ? progressWidth : 10,\n      height,\n      5,\n      null,\n      this.loadingBarColor\n    );\n    this._engine.setAntialiasing(oldAntialias);\n  }\n\n  /**\n   * Perform any calculations or logic in the `update` method. The default `Loader` does not\n   * do anything in this method so it is safe to override.\n   */\n  public update(_engine: Engine, _delta: number) {\n    // overridable update\n  }\n\n  public getData: () => any = () => {\n    return;\n  };\n\n  public setData: (data: any) => any = () => {\n    return;\n  };\n\n  public processData: (data: any) => any = () => {\n    return;\n  };\n\n  public onprogress: (e: any) => void = (e: any) => {\n    Logger.getInstance().debug('[ex.Loader] Loading ' + ((100 * e.loaded) / e.total).toFixed(0));\n\n    return;\n  };\n\n  public oncomplete: () => void = () => {\n    return;\n  };\n\n  public onerror: () => void = () => {\n    return;\n  };\n}\n","import { Logger } from './Log';\n/**\n * This is the list of features that will be used to log the supported\n * features to the console when Detector.logBrowserFeatures() is called.\n */\n\nconst REPORTED_FEATURES: { [key: string]: string } = {\n  webgl: 'WebGL',\n  webaudio: 'WebAudio',\n  gamepadapi: 'Gamepad API'\n};\n\n/**\n * Interface for detected browser features matrix\n */\nexport interface DetectedFeatures {\n  readonly canvas: boolean;\n  readonly arraybuffer: boolean;\n  readonly dataurl: boolean;\n  readonly objecturl: boolean;\n  readonly rgba: boolean;\n  readonly webaudio: boolean;\n  readonly webgl: boolean;\n  readonly gamepadapi: boolean;\n}\n\ninterface CriticalTests {\n  canvasSupport(): boolean;\n  arrayBufferSupport(): boolean;\n  dataUrlSupport(): boolean;\n  objectUrlSupport(): boolean;\n  rgbaSupport(): boolean;\n}\n\ninterface WarningTests {\n  webAudioSupport(): boolean;\n  webglSupport(): boolean;\n}\n\n/**\n * Excalibur internal feature detection helper class\n */\nexport class Detector {\n  private _features: DetectedFeatures = null;\n\n  public failedTests: string[] = [];\n\n  public constructor() {\n    this._features = this._loadBrowserFeatures();\n  }\n\n  /**\n   * Returns a map of currently supported browser features. This method\n   * treats the features as a singleton and will only calculate feature\n   * support if it has not previously been done.\n   */\n  public getBrowserFeatures(): DetectedFeatures {\n    if (this._features === null) {\n      this._features = this._loadBrowserFeatures();\n    }\n    return this._features;\n  }\n\n  /**\n   * Report on non-critical browser support for debugging purposes.\n   * Use native browser console colors for visibility.\n   */\n  public logBrowserFeatures(): void {\n    let msg = '%cSUPPORTED BROWSER FEATURES\\n==========================%c\\n';\n    const args = ['font-weight: bold; color: navy', 'font-weight: normal; color: inherit'];\n\n    const supported: any = this.getBrowserFeatures();\n    for (const feature of Object.keys(REPORTED_FEATURES)) {\n      if (supported[feature]) {\n        msg += '(%c\\u2713%c)'; // (✓)\n        args.push('font-weight: bold; color: green');\n        args.push('font-weight: normal; color: inherit');\n      } else {\n        msg += '(%c\\u2717%c)'; // (✗)\n        args.push('font-weight: bold; color: red');\n        args.push('font-weight: normal; color: inherit');\n      }\n\n      msg += ' ' + REPORTED_FEATURES[feature] + '\\n';\n    }\n\n    args.unshift(msg);\n    // eslint-disable-next-line no-console\n    console.log.apply(console, args);\n  }\n\n  /**\n   * Executes several IIFE's to get a constant reference to supported\n   * features within the current execution context.\n   */\n  private _loadBrowserFeatures(): DetectedFeatures {\n    return {\n      // IIFE to check canvas support\n      canvas: (() => {\n        return this._criticalTests.canvasSupport();\n      })(),\n\n      // IIFE to check arraybuffer support\n      arraybuffer: (() => {\n        return this._criticalTests.arrayBufferSupport();\n      })(),\n\n      // IIFE to check dataurl support\n      dataurl: (() => {\n        return this._criticalTests.dataUrlSupport();\n      })(),\n\n      // IIFE to check objecturl support\n      objecturl: (() => {\n        return this._criticalTests.objectUrlSupport();\n      })(),\n\n      // IIFE to check rgba support\n      rgba: (() => {\n        return this._criticalTests.rgbaSupport();\n      })(),\n\n      // IIFE to check webaudio support\n      webaudio: (() => {\n        return this._warningTest.webAudioSupport();\n      })(),\n\n      // IIFE to check webgl support\n      webgl: (() => {\n        return this._warningTest.webglSupport();\n      })(),\n\n      // IIFE to check gamepadapi support\n      gamepadapi: (() => {\n        return !!(<any>navigator).getGamepads;\n      })()\n    };\n  }\n\n  // critical browser features required for ex to run\n  private _criticalTests: CriticalTests = {\n    // Test canvas/2d context support\n    canvasSupport: function() {\n      const elem = document.createElement('canvas');\n      return !!(elem.getContext && elem.getContext('2d'));\n    },\n\n    // Test array buffer support ex uses for downloading binary data\n    arrayBufferSupport: function() {\n      const xhr = new XMLHttpRequest();\n      xhr.open('GET', '/');\n      try {\n        xhr.responseType = 'arraybuffer';\n      } catch (e) {\n        return false;\n      }\n      return xhr.responseType === 'arraybuffer';\n    },\n\n    // Test data urls ex uses for sprites\n    dataUrlSupport: function() {\n      const canvas = document.createElement('canvas');\n      return canvas.toDataURL('image/png').indexOf('data:image/png') === 0;\n    },\n\n    // Test object url support for loading\n    objectUrlSupport: function() {\n      return 'URL' in window && 'revokeObjectURL' in URL && 'createObjectURL' in URL;\n    },\n\n    // RGBA support for colors\n    rgbaSupport: function() {\n      const style = document.createElement('a').style;\n      style.cssText = 'background-color:rgba(150,255,150,.5)';\n      return ('' + style.backgroundColor).indexOf('rgba') > -1;\n    }\n  };\n\n  // warnings excalibur performance will be degraded\n  private _warningTest: WarningTests = {\n    webAudioSupport: function() {\n      return !!(\n        (<any>window).AudioContext ||\n        (<any>window).webkitAudioContext ||\n        (<any>window).mozAudioContext ||\n        (<any>window).msAudioContext ||\n        (<any>window).oAudioContext\n      );\n    },\n    webglSupport: function() {\n      const elem = document.createElement('canvas');\n      return !!(elem.getContext && elem.getContext('webgl'));\n    }\n  };\n\n  public test(): boolean {\n    // Critical test will for ex not to run\n    let failedCritical = false;\n    for (const test in this._criticalTests) {\n      if (!this._criticalTests[<keyof CriticalTests>test].call(this)) {\n        this.failedTests.push(test);\n        Logger.getInstance().error('Critical browser feature missing, Excalibur requires:', test);\n        failedCritical = true;\n      }\n    }\n    if (failedCritical) {\n      return false;\n    }\n\n    // Warning tests do not for ex to return false to compatibility\n    for (const warning in this._warningTest) {\n      if (!this._warningTest[<keyof WarningTests>warning]()) {\n        Logger.getInstance().warn('Warning browser feature missing, Excalibur will have reduced performance:', warning);\n      }\n    }\n\n    return true;\n  }\n}\n","import { Vector } from './Algebra';\nimport { Engine } from './Engine';\nimport { Actor, ActorArgs } from './Actor';\nimport * as Traits from './Traits/Index';\nimport { CollisionType } from './Collision/CollisionType';\nimport { Shape } from './Collision/Shape';\nimport { CoordPlane } from './EntityComponentSystem/Components/TransformComponent';\n\n/**\n * Helper [[Actor]] primitive for drawing UI's, optimized for UI drawing. Does\n * not participate in collisions. Drawn on top of all other actors.\n */\nexport class ScreenElement extends Actor {\n  protected _engine: Engine;\n\n  constructor();\n  constructor(xOrConfig?: number, y?: number, width?: number, height?: number);\n  constructor(config?: ActorArgs);\n  /**\n   * @param xOrConfig  The starting x coordinate of the actor or the actor option bag\n   * @param y       The starting y coordinate of the actor\n   * @param width   The starting width of the actor\n   * @param height  The starting height of the actor\n   */\n  constructor(xOrConfig?: number | ActorArgs, y?: number, width?: number, height?: number) {\n    if (typeof xOrConfig !== 'object') {\n      super(<number>xOrConfig, y, width, height);\n    } else {\n      super(<ActorArgs>xOrConfig);\n    }\n    this.components.transform.coordPlane = CoordPlane.Screen;\n    this.traits = [];\n    this.traits.push(new Traits.CapturePointer());\n    this.anchor.setTo(0, 0);\n    this.body.collider.type = CollisionType.PreventCollision;\n    this.body.collider.shape = Shape.Box(this.width, this.height, this.anchor);\n    this.enableCapturePointer = true;\n  }\n\n  public _initialize(engine: Engine) {\n    this._engine = engine;\n    super._initialize(engine);\n  }\n\n  public contains(x: number, y: number, useWorld: boolean = true) {\n    if (useWorld) {\n      return super.contains(x, y);\n    }\n\n    const coords = this._engine.worldToScreenCoordinates(new Vector(x, y));\n    return super.contains(coords.x, coords.y);\n  }\n}\n","import { Scene } from './Scene';\n\nexport interface TimerOptions {\n  repeats?: boolean;\n  numberOfRepeats?: number;\n  fcn?: () => void;\n  interval: number;\n}\n\n/**\n * The Excalibur timer hooks into the internal timer and fires callbacks,\n * after a certain interval, optionally repeating.\n */\nexport class Timer {\n  public static id: number = 0;\n  public id: number = 0;\n  public interval: number = 10;\n  public repeats: boolean = false;\n  public maxNumberOfRepeats: number = -1;\n  private _elapsedTime: number = 0;\n  private _totalTimeAlive: number = 0;\n  private _paused: boolean = false;\n  private _numberOfTicks: number = 0;\n  private _callbacks: Array<() => void>;\n  public complete: boolean = false;\n  public scene: Scene = null;\n\n  /**\n   * @param options    Options - repeats, numberOfRepeats, fcn, interval\n   * @param repeats    Indicates whether this call back should be fired only once, or repeat after every interval as completed.\n   * @param numberOfRepeats Specifies a maximum number of times that this timer will execute.\n   * @param fcn        The callback to be fired after the interval is complete.\n   */\n  constructor(options: TimerOptions);\n  constructor(fcn: TimerOptions | (() => void), interval?: number, repeats?: boolean, numberOfRepeats?: number) {\n    if (typeof fcn !== 'function') {\n      const options = fcn;\n      fcn = options.fcn;\n      interval = options.interval;\n      repeats = options.repeats;\n      numberOfRepeats = options.numberOfRepeats;\n    }\n\n    if (!!numberOfRepeats && numberOfRepeats >= 0) {\n      this.maxNumberOfRepeats = numberOfRepeats;\n      if (!repeats) {\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\n      }\n    }\n\n    this.id = Timer.id++;\n    this.interval = interval || this.interval;\n    this.repeats = repeats || this.repeats;\n\n    this._callbacks = [];\n\n    if (fcn) {\n      this.on(fcn);\n    }\n  }\n\n  /**\n   * Adds a new callback to be fired after the interval is complete\n   * @param fcn The callback to be added to the callback list, to be fired after the interval is complete.\n   */\n  public on(fcn: () => void) {\n    this._callbacks.push(fcn);\n  }\n\n  /**\n   * Removes a callback from the callback list to be fired after the interval is complete.\n   * @param fcn The callback to be removed from the callback list, to be fired after the interval is complete.\n   */\n  public off(fcn: () => void) {\n    const index = this._callbacks.indexOf(fcn);\n    this._callbacks.splice(index, 1);\n  }\n\n  /**\n   * Updates the timer after a certain number of milliseconds have elapsed. This is used internally by the engine.\n   * @param delta  Number of elapsed milliseconds since the last update.\n   */\n  public update(delta: number) {\n    if (!this._paused) {\n      this._totalTimeAlive += delta;\n      this._elapsedTime += delta;\n\n      if (this.maxNumberOfRepeats > -1 && this._numberOfTicks >= this.maxNumberOfRepeats) {\n        this.complete = true;\n      }\n\n      if (!this.complete && this._elapsedTime >= this.interval) {\n        this._callbacks.forEach((c) => {\n          c.call(this);\n        });\n\n        this._numberOfTicks++;\n        if (this.repeats) {\n          this._elapsedTime = 0;\n        } else {\n          this.complete = true;\n        }\n      }\n    }\n  }\n\n  /**\n   * Resets the timer so that it can be reused, and optionally reconfigure the timers interval.\n   * @param newInterval If specified, sets a new non-negative interval in milliseconds to refire the callback\n   * @param newNumberOfRepeats If specified, sets a new non-negative upper limit to the number of time this timer executes\n   */\n  public reset(newInterval?: number, newNumberOfRepeats?: number) {\n    if (!!newInterval && newInterval >= 0) {\n      this.interval = newInterval;\n    }\n\n    if (!!this.maxNumberOfRepeats && this.maxNumberOfRepeats >= 0) {\n      this.maxNumberOfRepeats = newNumberOfRepeats;\n      if (!this.repeats) {\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\n      }\n    }\n\n    this.complete = false;\n    this._elapsedTime = 0;\n    this._numberOfTicks = 0;\n  }\n\n  public get timesRepeated(): number {\n    return this._numberOfTicks;\n  }\n\n  public getTimeRunning(): number {\n    return this._totalTimeAlive;\n  }\n\n  /**\n   * Pauses the timer so that no more time will be incremented towards the next call\n   */\n  public pause() {\n    this._paused = true;\n  }\n\n  /**\n   * Unpauses the timer. Time will now increment towards the next call\n   */\n  public unpause() {\n    this._paused = false;\n  }\n\n  /**\n   * Cancels the timer, preventing any further executions.\n   */\n  public cancel() {\n    if (this.scene) {\n      this.scene.cancelTimer(this);\n    }\n  }\n}\n","import { Physics } from './../Physics';\nimport { BoundingBox } from './BoundingBox';\nimport { Body } from './Body';\n\nimport { Ray } from '../Algebra';\nimport { Logger } from '../Util/Log';\n\n/**\n * Dynamic Tree Node used for tracking bounds within the tree\n */\nexport class TreeNode {\n  public left: TreeNode;\n  public right: TreeNode;\n  public bounds: BoundingBox;\n  public height: number;\n  public body: Body;\n  constructor(public parent?: TreeNode) {\n    this.parent = parent || null;\n    this.body = null;\n    this.bounds = new BoundingBox();\n    this.left = null;\n    this.right = null;\n    this.height = 0;\n  }\n\n  public isLeaf(): boolean {\n    return !this.left && !this.right;\n  }\n}\n\n/**\n * The DynamicTrees provides a spatial partitioning data structure for quickly querying for overlapping bounding boxes for\n * all tracked bodies. The worst case performance of this is O(n*log(n)) where n is the number of bodies in the tree.\n *\n * Internally the bounding boxes are organized as a balanced binary tree of bounding boxes, where the leaf nodes are tracked bodies.\n * Every non-leaf node is a bounding box that contains child bounding boxes.\n */\nexport class DynamicTree {\n  public root: TreeNode;\n  public nodes: { [key: number]: TreeNode };\n  constructor(public worldBounds: BoundingBox = new BoundingBox(-Number.MAX_VALUE, -Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE)) {\n    this.root = null;\n    this.nodes = {};\n  }\n\n  /**\n   * Inserts a node into the dynamic tree\n   */\n  private _insert(leaf: TreeNode): void {\n    // If there are no nodes in the tree, make this the root leaf\n    if (this.root === null) {\n      this.root = leaf;\n      this.root.parent = null;\n      return;\n    }\n\n    // Search the tree for a node that is not a leaf and find the best place to insert\n    const leafAABB = leaf.bounds;\n    let currentRoot = this.root;\n    while (!currentRoot.isLeaf()) {\n      const left = currentRoot.left;\n      const right = currentRoot.right;\n\n      const area = currentRoot.bounds.getPerimeter();\n      const combinedAABB = currentRoot.bounds.combine(leafAABB);\n      const combinedArea = combinedAABB.getPerimeter();\n\n      // Calculate cost heuristic for creating a new parent and leaf\n      const cost = 2 * combinedArea;\n\n      // Minimum cost of pushing the leaf down the tree\n      const inheritanceCost = 2 * (combinedArea - area);\n\n      // Cost of descending\n      let leftCost = 0;\n      const leftCombined = leafAABB.combine(left.bounds);\n      let newArea;\n      let oldArea;\n      if (left.isLeaf()) {\n        leftCost = leftCombined.getPerimeter() + inheritanceCost;\n      } else {\n        oldArea = left.bounds.getPerimeter();\n        newArea = leftCombined.getPerimeter();\n        leftCost = newArea - oldArea + inheritanceCost;\n      }\n\n      let rightCost = 0;\n      const rightCombined = leafAABB.combine(right.bounds);\n      if (right.isLeaf()) {\n        rightCost = rightCombined.getPerimeter() + inheritanceCost;\n      } else {\n        oldArea = right.bounds.getPerimeter();\n        newArea = rightCombined.getPerimeter();\n        rightCost = newArea - oldArea + inheritanceCost;\n      }\n\n      // cost is acceptable\n      if (cost < leftCost && cost < rightCost) {\n        break;\n      }\n\n      // Descend to the depths\n      if (leftCost < rightCost) {\n        currentRoot = left;\n      } else {\n        currentRoot = right;\n      }\n    }\n\n    // Create the new parent node and insert into the tree\n    const oldParent = currentRoot.parent;\n    const newParent = new TreeNode(oldParent);\n    newParent.bounds = leafAABB.combine(currentRoot.bounds);\n    newParent.height = currentRoot.height + 1;\n\n    if (oldParent !== null) {\n      // The sibling node was not the root\n      if (oldParent.left === currentRoot) {\n        oldParent.left = newParent;\n      } else {\n        oldParent.right = newParent;\n      }\n\n      newParent.left = currentRoot;\n      newParent.right = leaf;\n\n      currentRoot.parent = newParent;\n      leaf.parent = newParent;\n    } else {\n      // The sibling node was the root\n      newParent.left = currentRoot;\n      newParent.right = leaf;\n\n      currentRoot.parent = newParent;\n      leaf.parent = newParent;\n      this.root = newParent;\n    }\n\n    // Walk up the tree fixing heights and AABBs\n    let currentNode = leaf.parent;\n    while (currentNode) {\n      currentNode = this._balance(currentNode);\n\n      if (!currentNode.left) {\n        throw new Error('Parent of current leaf cannot have a null left child' + currentNode);\n      }\n      if (!currentNode.right) {\n        throw new Error('Parent of current leaf cannot have a null right child' + currentNode);\n      }\n\n      currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\n      currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\n\n      currentNode = currentNode.parent;\n    }\n  }\n\n  /**\n   * Removes a node from the dynamic tree\n   */\n  private _remove(leaf: TreeNode) {\n    if (leaf === this.root) {\n      this.root = null;\n      return;\n    }\n\n    const parent = leaf.parent;\n    const grandParent = parent.parent;\n    let sibling: TreeNode;\n    if (parent.left === leaf) {\n      sibling = parent.right;\n    } else {\n      sibling = parent.left;\n    }\n\n    if (grandParent) {\n      if (grandParent.left === parent) {\n        grandParent.left = sibling;\n      } else {\n        grandParent.right = sibling;\n      }\n      sibling.parent = grandParent;\n\n      let currentNode = grandParent;\n      while (currentNode) {\n        currentNode = this._balance(currentNode);\n        currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\n        currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\n\n        currentNode = currentNode.parent;\n      }\n    } else {\n      this.root = sibling;\n      sibling.parent = null;\n    }\n  }\n\n  /**\n   * Tracks a body in the dynamic tree\n   */\n  public trackBody(body: Body) {\n    const node = new TreeNode();\n    node.body = body;\n    node.bounds = body.collider.bounds;\n    node.bounds.left -= 2;\n    node.bounds.top -= 2;\n    node.bounds.right += 2;\n    node.bounds.bottom += 2;\n    this.nodes[body.id] = node;\n    this._insert(node);\n  }\n\n  /**\n   * Updates the dynamic tree given the current bounds of each body being tracked\n   */\n  public updateBody(body: Body) {\n    const node = this.nodes[body.id];\n    if (!node) {\n      return false;\n    }\n    const b = body.collider.bounds;\n\n    // if the body is outside the world no longer update it\n    if (!this.worldBounds.contains(b)) {\n      Logger.getInstance().warn('Collider with id ' + body.id + ' is outside the world bounds and will no longer be tracked for physics');\n      this.untrackBody(body);\n      return false;\n    }\n\n    if (node.bounds.contains(b)) {\n      return false;\n    }\n\n    this._remove(node);\n    b.left -= Physics.boundsPadding;\n    b.top -= Physics.boundsPadding;\n    b.right += Physics.boundsPadding;\n    b.bottom += Physics.boundsPadding;\n\n    const multdx = body.vel.x * Physics.dynamicTreeVelocityMultiplier;\n    const multdy = body.vel.y * Physics.dynamicTreeVelocityMultiplier;\n\n    if (multdx < 0) {\n      b.left += multdx;\n    } else {\n      b.right += multdx;\n    }\n\n    if (multdy < 0) {\n      b.top += multdy;\n    } else {\n      b.bottom += multdy;\n    }\n\n    node.bounds = b;\n    this._insert(node);\n    return true;\n  }\n\n  /**\n   * Untracks a body from the dynamic tree\n   */\n  public untrackBody(body: Body) {\n    const node = this.nodes[body.collider.id];\n    if (!node) {\n      return;\n    }\n    this._remove(node);\n    this.nodes[body.collider.id] = null;\n    delete this.nodes[body.collider.id];\n  }\n\n  /**\n   * Balances the tree about a node\n   */\n  private _balance(node: TreeNode) {\n    if (node === null) {\n      throw new Error('Cannot balance at null node');\n    }\n\n    if (node.isLeaf() || node.height < 2) {\n      return node;\n    }\n\n    const left = node.left;\n    const right = node.right;\n\n    const a = node;\n    const b = left;\n    const c = right;\n    const d = left.left;\n    const e = left.right;\n    const f = right.left;\n    const g = right.right;\n\n    const balance = c.height - b.height;\n    // Rotate c node up\n    if (balance > 1) {\n      // Swap the right node with it's parent\n      c.left = a;\n      c.parent = a.parent;\n      a.parent = c;\n\n      // The original node's old parent should point to the right node\n      // this is mega confusing\n      if (c.parent) {\n        if (c.parent.left === a) {\n          c.parent.left = c;\n        } else {\n          c.parent.right = c;\n        }\n      } else {\n        this.root = c;\n      }\n\n      // Rotate\n      if (f.height > g.height) {\n        c.right = f;\n        a.right = g;\n        g.parent = a;\n\n        a.bounds = b.bounds.combine(g.bounds);\n        c.bounds = a.bounds.combine(f.bounds);\n\n        a.height = 1 + Math.max(b.height, g.height);\n        c.height = 1 + Math.max(a.height, f.height);\n      } else {\n        c.right = g;\n        a.right = f;\n        f.parent = a;\n\n        a.bounds = b.bounds.combine(f.bounds);\n        c.bounds = a.bounds.combine(g.bounds);\n\n        a.height = 1 + Math.max(b.height, f.height);\n        c.height = 1 + Math.max(a.height, g.height);\n      }\n\n      return c;\n    }\n    // Rotate left node up\n    if (balance < -1) {\n      // swap\n      b.left = a;\n      b.parent = a.parent;\n      a.parent = b;\n\n      // node's old parent should point to b\n      if (b.parent) {\n        if (b.parent.left === a) {\n          b.parent.left = b;\n        } else {\n          if (b.parent.right !== a) {\n            throw 'Error rotating Dynamic Tree';\n          }\n          b.parent.right = b;\n        }\n      } else {\n        this.root = b;\n      }\n\n      // rotate\n      if (d.height > e.height) {\n        b.right = d;\n        a.left = e;\n        e.parent = a;\n\n        a.bounds = c.bounds.combine(e.bounds);\n        b.bounds = a.bounds.combine(d.bounds);\n\n        a.height = 1 + Math.max(c.height, e.height);\n        b.height = 1 + Math.max(a.height, d.height);\n      } else {\n        b.right = e;\n        a.left = d;\n        d.parent = a;\n\n        a.bounds = c.bounds.combine(d.bounds);\n        b.bounds = a.bounds.combine(e.bounds);\n\n        a.height = 1 + Math.max(c.height, d.height);\n        b.height = 1 + Math.max(a.height, e.height);\n      }\n      return b;\n    }\n\n    return node;\n  }\n\n  /**\n   * Returns the internal height of the tree, shorter trees are better. Performance drops as the tree grows\n   */\n  public getHeight(): number {\n    if (this.root === null) {\n      return 0;\n    }\n    return this.root.height;\n  }\n\n  /**\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be colliding with the provided body.\n   *\n   * In the query callback, it will be passed a potential collider. Returning true from this callback indicates\n   * that you are complete with your query and you do not want to continue. Returning false will continue searching\n   * the tree until all possible colliders have been returned.\n   */\n  public query(body: Body, callback: (other: Body) => boolean): void {\n    const bounds = body.collider.bounds;\n    const helper = (currentNode: TreeNode): boolean => {\n      if (currentNode && currentNode.bounds.intersect(bounds)) {\n        if (currentNode.isLeaf() && currentNode.body !== body) {\n          if (callback.call(body, currentNode.body)) {\n            return true;\n          }\n        } else {\n          return helper(currentNode.left) || helper(currentNode.right);\n        }\n      }\n      return false;\n    };\n    helper(this.root);\n  }\n\n  /**\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be intersecting. By default the raycast query uses an infinitely\n   * long ray to test the tree specified by `max`.\n   *\n   * In the query callback, it will be passed a potential body that intersects with the raycast. Returning true from this\n   * callback indicates that your are complete with your query and do not want to continue. Return false will continue searching\n   * the tree until all possible bodies that would intersect with the ray have been returned.\n   */\n  public rayCastQuery(ray: Ray, max: number = Infinity, callback: (other: Body) => boolean): void {\n    const helper = (currentNode: TreeNode): boolean => {\n      if (currentNode && currentNode.bounds.rayCast(ray, max)) {\n        if (currentNode.isLeaf()) {\n          if (callback.call(ray, currentNode.body)) {\n            // ray hit a leaf! return the body\n            return true;\n          }\n        } else {\n          // ray hit but not at a leaf, recurse deeper\n          return helper(currentNode.left) || helper(currentNode.right);\n        }\n      }\n      return false; // ray missed\n    };\n    helper(this.root);\n  }\n\n  public getNodes(): TreeNode[] {\n    const helper = (currentNode: TreeNode): TreeNode[] => {\n      if (currentNode) {\n        return [currentNode].concat(helper(currentNode.left), helper(currentNode.right));\n      } else {\n        return [];\n      }\n    };\n    return helper(this.root);\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    // draw all the nodes in the Dynamic Tree\n    const helper = (currentNode: TreeNode) => {\n      if (currentNode) {\n        if (currentNode.isLeaf()) {\n          ctx.lineWidth = 1;\n          ctx.strokeStyle = 'green';\n        } else {\n          ctx.lineWidth = 1;\n          ctx.strokeStyle = 'white';\n        }\n        currentNode.bounds.debugDraw(ctx);\n\n        if (currentNode.left) {\n          helper(currentNode.left);\n        }\n        if (currentNode.right) {\n          helper(currentNode.right);\n        }\n      }\n    };\n\n    helper(this.root);\n  }\n}\n","import { Physics } from './../Physics';\nimport { CollisionBroadphase } from './CollisionResolver';\nimport { DynamicTree } from './DynamicTree';\nimport { Pair } from './Pair';\nimport { Body } from './Body';\n\nimport { Vector, Ray } from '../Algebra';\nimport { FrameStats } from '../Debug';\nimport { CollisionResolutionStrategy } from '../Physics';\nimport { Logger } from '../Util/Log';\nimport { CollisionStartEvent, CollisionEndEvent } from '../Events';\nimport { CollisionType } from './CollisionType';\nimport { Collider } from './Collider';\n\nexport class DynamicTreeCollisionBroadphase implements CollisionBroadphase {\n  private _dynamicCollisionTree = new DynamicTree();\n  private _collisionHash: { [key: string]: boolean } = {};\n  private _collisionPairCache: Pair[] = [];\n  private _lastFramePairs: Pair[] = [];\n  private _lastFramePairsHash: { [pairId: string]: Pair } = {};\n\n  /**\n   * Tracks a physics body for collisions\n   */\n  public track(target: Body): void {\n    if (!target) {\n      Logger.getInstance().warn('Cannot track null physics body');\n      return;\n    }\n    this._dynamicCollisionTree.trackBody(target);\n  }\n\n  /**\n   * Untracks a physics body\n   */\n  public untrack(target: Body): void {\n    if (!target) {\n      Logger.getInstance().warn('Cannot untrack a null physics body');\n      return;\n    }\n    this._dynamicCollisionTree.untrackBody(target);\n  }\n\n  private _shouldGenerateCollisionPair(colliderA: Collider, colliderB: Collider) {\n    // if the collision pair has been calculated already short circuit\n    const hash = Pair.calculatePairHash(colliderA, colliderB);\n    if (this._collisionHash[hash]) {\n      return false; // pair exists easy exit return false\n    }\n\n    return Pair.canCollide(colliderA, colliderB);\n  }\n\n  /**\n   * Detects potential collision pairs in a broadphase approach with the dynamic aabb tree strategy\n   */\n  public broadphase(targets: Body[], delta: number, stats?: FrameStats): Pair[] {\n    const seconds = delta / 1000;\n\n    // Retrieve the list of potential colliders, exclude killed, prevented, and self\n    const potentialColliders = targets\n      .map((t) => t.collider)\n      .filter((other) => {\n        return other.active && other.type !== CollisionType.PreventCollision;\n      });\n\n    // clear old list of collision pairs\n    this._collisionPairCache = [];\n    this._collisionHash = {};\n\n    // check for normal collision pairs\n    let collider: Collider;\n    for (let j = 0, l = potentialColliders.length; j < l; j++) {\n      collider = potentialColliders[j];\n\n      // Query the collision tree for potential colliders\n      this._dynamicCollisionTree.query(collider.body, (other: Body) => {\n        if (this._shouldGenerateCollisionPair(collider, other.collider)) {\n          const pair = new Pair(collider, other.collider);\n          this._collisionHash[pair.id] = true;\n          this._collisionPairCache.push(pair);\n        }\n        // Always return false, to query whole tree. Returning true in the query method stops searching\n        return false;\n      });\n    }\n    if (stats) {\n      stats.physics.pairs = this._collisionPairCache.length;\n    }\n\n    // Check dynamic tree for fast moving objects\n    // Fast moving objects are those moving at least there smallest bound per frame\n    if (Physics.checkForFastBodies) {\n      for (const collider of potentialColliders) {\n        // Skip non-active objects. Does not make sense on other collision types\n        if (collider.type !== CollisionType.Active) {\n          continue;\n        }\n\n        // Maximum travel distance next frame\n        const updateDistance =\n          collider.body.vel.size * seconds + // velocity term\n          collider.body.acc.size * 0.5 * seconds * seconds; // acc term\n\n        // Find the minimum dimension\n        const minDimension = Math.min(collider.bounds.height, collider.bounds.width);\n        if (Physics.disableMinimumSpeedForFastBody || updateDistance > minDimension / 2) {\n          if (stats) {\n            stats.physics.fastBodies++;\n          }\n\n          // start with the oldPos because the integration for actors has already happened\n          // objects resting on a surface may be slightly penetrating in the current position\n          const updateVec = collider.body.pos.sub(collider.body.oldPos);\n          const centerPoint = collider.shape.center;\n          const furthestPoint = collider.shape.getFurthestPoint(collider.body.vel);\n          const origin: Vector = furthestPoint.sub(updateVec);\n\n          const ray: Ray = new Ray(origin, collider.body.vel);\n\n          // back the ray up by -2x surfaceEpsilon to account for fast moving objects starting on the surface\n          ray.pos = ray.pos.add(ray.dir.scale(-2 * Physics.surfaceEpsilon));\n          let minBody: Body;\n          let minTranslate: Vector = new Vector(Infinity, Infinity);\n          this._dynamicCollisionTree.rayCastQuery(ray, updateDistance + Physics.surfaceEpsilon * 2, (other: Body) => {\n            if (collider.body !== other && other.collider.shape && Pair.canCollide(collider, other.collider)) {\n              const hitPoint = other.collider.shape.rayCast(ray, updateDistance + Physics.surfaceEpsilon * 10);\n              if (hitPoint) {\n                const translate = hitPoint.sub(origin);\n                if (translate.size < minTranslate.size) {\n                  minTranslate = translate;\n                  minBody = other;\n                }\n              }\n            }\n            return false;\n          });\n\n          if (minBody && Vector.isValid(minTranslate)) {\n            const pair = new Pair(collider, minBody.collider);\n            if (!this._collisionHash[pair.id]) {\n              this._collisionHash[pair.id] = true;\n              this._collisionPairCache.push(pair);\n            }\n            // move the fast moving object to the other body\n            // need to push into the surface by ex.Physics.surfaceEpsilon\n            const shift = centerPoint.sub(furthestPoint);\n            collider.body.pos = origin\n              .add(shift)\n              .add(minTranslate)\n              .add(ray.dir.scale(2 * Physics.surfaceEpsilon));\n            collider.shape.recalc();\n\n            if (stats) {\n              stats.physics.fastBodyCollisions++;\n            }\n          }\n        }\n      }\n    }\n    // return cache\n    return this._collisionPairCache;\n  }\n\n  /**\n   * Applies narrow phase on collision pairs to find actual area intersections\n   * Adds actual colliding pairs to stats' Frame data\n   */\n  public narrowphase(pairs: Pair[], stats?: FrameStats): Pair[] {\n    for (let i = 0; i < pairs.length; i++) {\n      pairs[i].collide();\n      if (stats && pairs[i].collision) {\n        stats.physics.collisions++;\n        stats.physics.collidersHash[pairs[i].id] = pairs[i];\n      }\n    }\n    return pairs.filter((p) => p.collision);\n  }\n\n  /**\n   * Perform collision resolution given a strategy (rigid body or box) and move objects out of intersect.\n   */\n  public resolve(pairs: Pair[], delta: number, strategy: CollisionResolutionStrategy): Pair[] {\n    for (const pair of pairs) {\n      pair.resolve(strategy);\n\n      if (pair.collision) {\n        pair.colliderA.body.applyMtv();\n        pair.colliderB.body.applyMtv();\n        // todo still don't like this, this is a small integration step to resolve narrowphase collisions\n        pair.colliderA.body.integrate(delta * Physics.collisionShift);\n        pair.colliderB.body.integrate(delta * Physics.collisionShift);\n      }\n    }\n\n    return pairs.filter((p) => p.canCollide);\n  }\n\n  public runCollisionStartEnd(pairs: Pair[]) {\n    const currentFrameHash: { [pairId: string]: Pair } = {};\n\n    for (const p of pairs) {\n      // load currentFrameHash\n      currentFrameHash[p.id] = p;\n\n      // find all new collisions\n      if (!this._lastFramePairsHash[p.id]) {\n        const actor1 = p.colliderA;\n        const actor2 = p.colliderB;\n        actor1.emit('collisionstart', new CollisionStartEvent(actor1, actor2, p));\n        actor2.emit('collisionstart', new CollisionStartEvent(actor2, actor1, p));\n      }\n    }\n\n    // find all old collisions\n    for (const p of this._lastFramePairs) {\n      if (!currentFrameHash[p.id]) {\n        const actor1 = p.colliderA;\n        const actor2 = p.colliderB;\n        actor1.emit('collisionend', new CollisionEndEvent(actor1, actor2));\n        actor2.emit('collisionend', new CollisionEndEvent(actor2, actor1));\n      }\n    }\n\n    // reset the last frame cache\n    this._lastFramePairs = pairs;\n    this._lastFramePairsHash = currentFrameHash;\n  }\n\n  /**\n   * Update the dynamic tree positions\n   */\n  public update(targets: Body[]): number {\n    let updated = 0;\n    const len = targets.length;\n\n    for (let i = 0; i < len; i++) {\n      if (this._dynamicCollisionTree.updateBody(targets[i])) {\n        updated++;\n      }\n    }\n    return updated;\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    if (Physics.broadphaseDebug) {\n      this._dynamicCollisionTree.debugDraw(ctx);\n    }\n\n    if (Physics.showContacts || Physics.showCollisionNormals) {\n      for (const pair of this._collisionPairCache) {\n        pair.debugDraw(ctx);\n      }\n    }\n  }\n}\n","import { BoundingBox } from './Collision/BoundingBox';\nimport { Color } from './Drawing/Color';\nimport { Engine } from './Engine';\nimport { vec, Vector } from './Algebra';\nimport { Actor } from './Actor';\nimport { Logger } from './Util/Log';\nimport { SpriteSheet } from './Drawing/SpriteSheet';\nimport * as Events from './Events';\nimport { Configurable } from './Configurable';\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { CanvasDrawComponent } from './Drawing/CanvasDrawComponent';\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\n\n/**\n * @hidden\n */\nexport class TileMapImpl extends Entity<TransformComponent | CanvasDrawComponent> {\n  private _collidingX: number = -1;\n  private _collidingY: number = -1;\n  private _onScreenXStart: number = 0;\n  private _onScreenXEnd: number = 9999;\n  private _onScreenYStart: number = 0;\n  private _onScreenYEnd: number = 9999;\n  private _spriteSheets: { [key: string]: SpriteSheet } = {};\n  public logger: Logger = Logger.getInstance();\n  public data: Cell[] = [];\n  public x: number;\n  public y: number;\n  public z = 0;\n  public visible = true;\n  public isOffscreen = false;\n  public rotation = 0;\n  public scale = Vector.One;\n  public cellWidth: number;\n  public cellHeight: number;\n  public rows: number;\n  public cols: number;\n\n  public get pos(): Vector {\n    return vec(this.x, this.y);\n  }\n\n  public set pos(val: Vector) {\n    this.x = val.x;\n    this.y = val.y;\n  }\n\n  public on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<TileMap>) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<TileMap>) => void): void;\n  public on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n  public on(eventName: string, handler: (event: Events.GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  /**\n   * @param xOrConfig     The x coordinate to anchor the TileMap's upper left corner (should not be changed once set) or TileMap option bag\n   * @param y             The y coordinate to anchor the TileMap's upper left corner (should not be changed once set)\n   * @param cellWidth     The individual width of each cell (in pixels) (should not be changed once set)\n   * @param cellHeight    The individual height of each cell (in pixels) (should not be changed once set)\n   * @param rows          The number of rows in the TileMap (should not be changed once set)\n   * @param cols          The number of cols in the TileMap (should not be changed once set)\n   */\n  constructor(xOrConfig: number | TileMapArgs, y: number, cellWidth: number, cellHeight: number, rows: number, cols: number) {\n    super();\n    if (xOrConfig && typeof xOrConfig === 'object') {\n      const config = xOrConfig;\n      xOrConfig = config.x;\n      y = config.y;\n      cellWidth = config.cellWidth;\n      cellHeight = config.cellHeight;\n      rows = config.rows;\n      cols = config.cols;\n    }\n    this.x = <number>xOrConfig;\n    this.y = y;\n    this.cellWidth = cellWidth;\n    this.cellHeight = cellHeight;\n    this.rows = rows;\n    this.cols = cols;\n    this.data = new Array<Cell>(rows * cols);\n    for (let i = 0; i < cols; i++) {\n      for (let j = 0; j < rows; j++) {\n        (() => {\n          const cd = new Cell(i * cellWidth + <number>xOrConfig, j * cellHeight + y, cellWidth, cellHeight, i + j * cols);\n          this.data[i + j * cols] = cd;\n        })();\n      }\n    }\n\n    this.addComponent(new TransformComponent());\n    this.addComponent(new CanvasDrawComponent((ctx, delta) => this.draw(ctx, delta)));\n  }\n\n  public registerSpriteSheet(key: string, spriteSheet: SpriteSheet) {\n    this._spriteSheets[key] = spriteSheet;\n  }\n  /**\n   * Returns the intersection vector that can be used to resolve collisions with actors. If there\n   * is no collision null is returned.\n   */\n  public collides(actor: Actor): Vector {\n    const width = actor.pos.x + actor.width;\n    const height = actor.pos.y + actor.height;\n    const actorBounds = actor.body.collider.bounds;\n    const overlaps: Vector[] = [];\n    if (actor.width <= 0 || actor.height <= 0) {\n      return null;\n    }\n    // trace points for overlap\n    for (let x = actorBounds.left; x <= width; x += Math.min(actor.width / 2, this.cellWidth / 2)) {\n      for (let y = actorBounds.top; y <= height; y += Math.min(actor.height / 2, this.cellHeight / 2)) {\n        const cell = this.getCellByPoint(x, y);\n        if (cell && cell.solid) {\n          const overlap = actorBounds.intersect(cell.bounds);\n          const dir = actor.center.sub(cell.center);\n          if (overlap && overlap.dot(dir) > 0) {\n            overlaps.push(overlap);\n          }\n        }\n      }\n    }\n    if (overlaps.length === 0) {\n      return null;\n    }\n    // Return the smallest change other than zero\n    const result = overlaps.reduce((accum, next) => {\n      let x = accum.x;\n      let y = accum.y;\n      if (Math.abs(accum.x) < Math.abs(next.x)) {\n        x = next.x;\n      }\n      if (Math.abs(accum.y) < Math.abs(next.y)) {\n        y = next.y;\n      }\n      return new Vector(x, y);\n    });\n    return result;\n  }\n\n  /**\n   * Returns the [[Cell]] by index (row major order)\n   */\n  public getCellByIndex(index: number): Cell {\n    return this.data[index];\n  }\n  /**\n   * Returns the [[Cell]] by its x and y coordinates\n   */\n  public getCell(x: number, y: number): Cell {\n    if (x < 0 || y < 0 || x >= this.cols || y >= this.rows) {\n      return null;\n    }\n    return this.data[x + y * this.cols];\n  }\n  /**\n   * Returns the [[Cell]] by testing a point in global coordinates,\n   * returns `null` if no cell was found.\n   */\n  public getCellByPoint(x: number, y: number): Cell {\n    x = Math.floor((x - this.x) / this.cellWidth);\n    y = Math.floor((y - this.y) / this.cellHeight);\n    const cell = this.getCell(x, y);\n    if (x >= 0 && y >= 0 && x < this.cols && y < this.rows && cell) {\n      return cell;\n    }\n    return null;\n  }\n\n  public onPreUpdate(_engine: Engine, _delta: number) {\n    // Override me\n  }\n\n  public onPostUpdate(_engine: Engine, _delta: number) {\n    // Override me\n  }\n\n  public update(engine: Engine, delta: number) {\n    this.onPreUpdate(engine, delta);\n    this.emit('preupdate', new Events.PreUpdateEvent(engine, delta, this));\n\n    const worldCoordsUpperLeft = engine.screenToWorldCoordinates(new Vector(0, 0));\n    const worldCoordsLowerRight = engine.screenToWorldCoordinates(new Vector(engine.canvas.clientWidth, engine.canvas.clientHeight));\n\n    this._onScreenXStart = Math.max(Math.floor((worldCoordsUpperLeft.x - this.x) / this.cellWidth) - 2, 0);\n    this._onScreenYStart = Math.max(Math.floor((worldCoordsUpperLeft.y - this.y) / this.cellHeight) - 2, 0);\n    this._onScreenXEnd = Math.max(Math.floor((worldCoordsLowerRight.x - this.x) / this.cellWidth) + 2, 0);\n    this._onScreenYEnd = Math.max(Math.floor((worldCoordsLowerRight.y - this.y) / this.cellHeight) + 2, 0);\n\n    this.onPostUpdate(engine, delta);\n    this.emit('postupdate', new Events.PostUpdateEvent(engine, delta, this));\n  }\n\n  /**\n   * Draws the tile map to the screen. Called by the [[Scene]].\n   * @param ctx    The current rendering context\n   * @param delta  The number of milliseconds since the last draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\n    this.emit('predraw', new Events.PreDrawEvent(ctx, delta, this));\n\n    let x = this._onScreenXStart;\n    const xEnd = Math.min(this._onScreenXEnd, this.cols);\n    let y = this._onScreenYStart;\n    const yEnd = Math.min(this._onScreenYEnd, this.rows);\n\n    let cs: TileSprite[], csi: number, cslen: number;\n\n    for (x; x < xEnd; x++) {\n      for (y; y < yEnd; y++) {\n        // get non-negative tile sprites\n        cs = this.getCell(x, y).sprites.filter((s) => {\n          return s.spriteId > -1;\n        });\n\n        for (csi = 0, cslen = cs.length; csi < cslen; csi++) {\n          const ss = this._spriteSheets[cs[csi].spriteSheetKey];\n\n          // draw sprite, warning if sprite doesn't exist\n          if (ss) {\n            const sprite = ss.getSprite(cs[csi].spriteId);\n            if (sprite) {\n              sprite.draw(ctx, x * this.cellWidth, y * this.cellHeight);\n            } else {\n              this.logger.warn('Sprite does not exist for id', cs[csi].spriteId, 'in sprite sheet', cs[csi].spriteSheetKey, sprite, ss);\n            }\n          } else {\n            this.logger.warn('Sprite sheet', cs[csi].spriteSheetKey, 'does not exist', ss);\n          }\n        }\n      }\n      y = this._onScreenYStart;\n    }\n\n    this.emit('postdraw', new Events.PostDrawEvent(ctx, delta, this));\n  }\n\n  /**\n   * Draws all the tile map's debug info. Called by the [[Scene]].\n   * @param ctx  The current rendering context\n   */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    const width = this.cols * this.cellWidth;\n    const height = this.rows * this.cellHeight;\n    ctx.save();\n    ctx.strokeStyle = Color.Red.toString();\n    for (let x = 0; x < this.cols + 1; x++) {\n      ctx.beginPath();\n      ctx.moveTo(this.x + x * this.cellWidth, this.y);\n      ctx.lineTo(this.x + x * this.cellWidth, this.y + height);\n      ctx.stroke();\n    }\n    for (let y = 0; y < this.rows + 1; y++) {\n      ctx.beginPath();\n      ctx.moveTo(this.x, this.y + y * this.cellHeight);\n      ctx.lineTo(this.x + width, this.y + y * this.cellHeight);\n      ctx.stroke();\n    }\n    const solid = Color.Red;\n    solid.a = 0.3;\n    this.data\n      .filter(function (cell) {\n        return cell.solid;\n      })\n      .forEach(function (cell) {\n        ctx.fillStyle = solid.toString();\n        ctx.fillRect(cell.x, cell.y, cell.width, cell.height);\n      });\n    if (this._collidingY > -1 && this._collidingX > -1) {\n      ctx.fillStyle = Color.Cyan.toString();\n      ctx.fillRect(\n        this.x + this._collidingX * this.cellWidth,\n        this.y + this._collidingY * this.cellHeight,\n        this.cellWidth,\n        this.cellHeight\n      );\n    }\n    ctx.restore();\n  }\n}\n\nexport interface TileMapArgs extends Partial<TileMapImpl> {\n  x: number;\n  y: number;\n  cellWidth: number;\n  cellHeight: number;\n  rows: number;\n  cols: number;\n}\n\n/**\n * The [[TileMap]] class provides a lightweight way to do large complex scenes with collision\n * without the overhead of actors.\n */\nexport class TileMap extends Configurable(TileMapImpl) {\n  constructor(config: TileMapArgs);\n  constructor(x: number, y: number, cellWidth: number, cellHeight: number, rows: number, cols: number);\n  constructor(xOrConfig: number | TileMapArgs, y?: number, cellWidth?: number, cellHeight?: number, rows?: number, cols?: number) {\n    super(xOrConfig, y, cellWidth, cellHeight, rows, cols);\n  }\n}\n\n/**\n * Tile sprites are used to render a specific sprite from a [[TileMap]]'s spritesheet(s)\n */\nexport class TileSprite {\n  /**\n   * @param spriteSheetKey  The key of the spritesheet to use\n   * @param spriteId        The index of the sprite in the [[SpriteSheet]]\n   */\n  constructor(public spriteSheetKey: string, public spriteId: number) {}\n}\n\n/**\n * @hidden\n */\nexport class CellImpl {\n  private _bounds: BoundingBox;\n  public x: number;\n  public y: number;\n  public width: number;\n  public height: number;\n  public index: number;\n  public solid: boolean = false;\n  public sprites: TileSprite[] = [];\n\n  /**\n   * @param xOrConfig Gets or sets x coordinate of the cell in world coordinates or cell option bag\n   * @param y       Gets or sets y coordinate of the cell in world coordinates\n   * @param width   Gets or sets the width of the cell\n   * @param height  Gets or sets the height of the cell\n   * @param index   The index of the cell in row major order\n   * @param solid   Gets or sets whether this cell is solid\n   * @param sprites The list of tile sprites to use to draw in this cell (in order)\n   */\n  constructor(\n    xOrConfig: number | CellArgs,\n    y: number,\n    width: number,\n    height: number,\n    index: number,\n    solid: boolean = false,\n    sprites: TileSprite[] = []\n  ) {\n    if (xOrConfig && typeof xOrConfig === 'object') {\n      const config = xOrConfig;\n      xOrConfig = config.x;\n      y = config.y;\n      width = config.width;\n      height = config.height;\n      index = config.index;\n      solid = config.solid;\n      sprites = config.sprites;\n    }\n    this.x = <number>xOrConfig;\n    this.y = y;\n    this.width = width;\n    this.height = height;\n    this.index = index;\n    this.solid = solid;\n    this.sprites = sprites;\n    this._bounds = new BoundingBox(this.x, this.y, this.x + this.width, this.y + this.height);\n  }\n\n  public get bounds() {\n    return this._bounds;\n  }\n\n  public get center(): Vector {\n    return new Vector(this.x + this.width / 2, this.y + this.height / 2);\n  }\n\n  /**\n   * Add another [[TileSprite]] to this cell\n   */\n  public pushSprite(tileSprite: TileSprite) {\n    this.sprites.push(tileSprite);\n  }\n  /**\n   * Remove an instance of [[TileSprite]] from this cell\n   */\n  public removeSprite(tileSprite: TileSprite) {\n    let index = -1;\n    if ((index = this.sprites.indexOf(tileSprite)) > -1) {\n      this.sprites.splice(index, 1);\n    }\n  }\n  /**\n   * Clear all sprites from this cell\n   */\n  public clearSprites() {\n    this.sprites.length = 0;\n  }\n}\n\nexport interface CellArgs extends Partial<CellImpl> {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  index: number;\n  solid?: boolean;\n  sprites?: TileSprite[];\n}\n\n/**\n * TileMap Cell\n *\n * A light-weight object that occupies a space in a collision map. Generally\n * created by a [[TileMap]].\n *\n * Cells can draw multiple sprites. Note that the order of drawing is the order\n * of the sprites in the array so the last one will be drawn on top. You can\n * use transparency to create layers this way.\n */\nexport class Cell extends Configurable(CellImpl) {\n  constructor(config: CellArgs);\n  constructor(x: number, y: number, width: number, height: number, index: number, solid?: boolean, sprites?: TileSprite[]);\n  constructor(\n    xOrConfig: number | CellArgs,\n    y?: number,\n    width?: number,\n    height?: number,\n    index?: number,\n    solid?: boolean,\n    sprites?: TileSprite[]\n  ) {\n    super(xOrConfig, y, width, height, index, solid, sprites);\n  }\n}\n","import { Engine } from './Engine';\nimport { EasingFunction, EasingFunctions } from './Util/EasingFunctions';\nimport { Vector } from './Algebra';\nimport { Actor } from './Actor';\nimport { removeItemFromArray } from './Util/Util';\nimport { CanUpdate, CanInitialize } from './Interfaces/LifecycleEvents';\nimport { PreUpdateEvent, PostUpdateEvent, GameEvent, InitializeEvent } from './Events';\nimport { Class } from './Class';\nimport { BoundingBox } from './Collision/BoundingBox';\nimport { Logger } from './Util/Log';\n\n/**\n * Interface that describes a custom camera strategy for tracking targets\n */\nexport interface CameraStrategy<T> {\n  /**\n   * Target of the camera strategy that will be passed to the action\n   */\n  target: T;\n\n  /**\n   * Camera strategies perform an action to calculate a new focus returned out of the strategy\n   * @param target The target object to apply this camera strategy (if any)\n   * @param camera The current camera implementation in excalibur running the game\n   * @param engine The current engine running the game\n   * @param delta The elapsed time in milliseconds since the last frame\n   */\n  action: (target: T, camera: Camera, engine: Engine, delta: number) => Vector;\n}\n\n/**\n * Container to house convenience strategy methods\n * @internal\n */\nexport class StrategyContainer {\n  constructor(public camera: Camera) {}\n\n  /**\n   * Creates and adds the [[LockCameraToActorStrategy]] on the current camera.\n   * @param actor The actor to lock the camera to\n   */\n  public lockToActor(actor: Actor) {\n    this.camera.addStrategy(new LockCameraToActorStrategy(actor));\n  }\n\n  /**\n   * Creates and adds the [[LockCameraToActorAxisStrategy]] on the current camera\n   * @param actor The actor to lock the camera to\n   * @param axis The axis to follow the actor on\n   */\n  public lockToActorAxis(actor: Actor, axis: Axis) {\n    this.camera.addStrategy(new LockCameraToActorAxisStrategy(actor, axis));\n  }\n\n  /**\n   * Creates and adds the [[ElasticToActorStrategy]] on the current camera\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\n   * correct and bounce around the target\n   *\n   * @param actor Target actor to elastically follow\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\n   */\n  public elasticToActor(actor: Actor, cameraElasticity: number, cameraFriction: number) {\n    this.camera.addStrategy(new ElasticToActorStrategy(actor, cameraElasticity, cameraFriction));\n  }\n\n  /**\n   * Creates and adds the [[RadiusAroundActorStrategy]] on the current camera\n   * @param actor Target actor to follow when it is \"radius\" pixels away\n   * @param radius Number of pixels away before the camera will follow\n   */\n  public radiusAroundActor(actor: Actor, radius: number) {\n    this.camera.addStrategy(new RadiusAroundActorStrategy(actor, radius));\n  }\n\n  /**\n   * Creates and adds the [[LimitCameraBoundsStrategy]] on the current camera\n   * @param box The bounding box to limit the camera to.\n   */\n  public limitCameraBounds(box: BoundingBox) {\n    this.camera.addStrategy(new LimitCameraBoundsStrategy(box));\n  }\n}\n\n/**\n * Camera axis enum\n */\nexport enum Axis {\n  X,\n  Y\n}\n\n/**\n * Lock a camera to the exact x/y position of an actor.\n */\nexport class LockCameraToActorStrategy implements CameraStrategy<Actor> {\n  constructor(public target: Actor) {}\n  public action = (target: Actor, _cam: Camera, _eng: Engine, _delta: number) => {\n    const center = target.center;\n    return center;\n  };\n}\n\n/**\n * Lock a camera to a specific axis around an actor.\n */\nexport class LockCameraToActorAxisStrategy implements CameraStrategy<Actor> {\n  constructor(public target: Actor, public axis: Axis) {}\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\n    const center = target.center;\n    const currentFocus = cam.getFocus();\n    if (this.axis === Axis.X) {\n      return new Vector(center.x, currentFocus.y);\n    } else {\n      return new Vector(currentFocus.x, center.y);\n    }\n  };\n}\n\n/**\n * Using [Hook's law](https://en.wikipedia.org/wiki/Hooke's_law), elastically move the camera towards the target actor.\n */\nexport class ElasticToActorStrategy implements CameraStrategy<Actor> {\n  /**\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\n   * correct and bounce around the target\n   *\n   * @param target Target actor to elastically follow\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\n   */\n  constructor(public target: Actor, public cameraElasticity: number, public cameraFriction: number) {}\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\n    const position = target.center;\n    let focus = cam.getFocus();\n    let cameraVel = cam.vel.clone();\n\n    // Calculate the stretch vector, using the spring equation\n    // F = kX\n    // https://en.wikipedia.org/wiki/Hooke's_law\n    // Apply to the current camera velocity\n    const stretch = position.sub(focus).scale(this.cameraElasticity); // stretch is X\n    cameraVel = cameraVel.add(stretch);\n\n    // Calculate the friction (-1 to apply a force in the opposition of motion)\n    // Apply to the current camera velocity\n    const friction = cameraVel.scale(-1).scale(this.cameraFriction);\n    cameraVel = cameraVel.add(friction);\n\n    // Update position by velocity deltas\n    focus = focus.add(cameraVel);\n\n    return focus;\n  };\n}\n\nexport class RadiusAroundActorStrategy implements CameraStrategy<Actor> {\n  /**\n   *\n   * @param target Target actor to follow when it is \"radius\" pixels away\n   * @param radius Number of pixels away before the camera will follow\n   */\n  constructor(public target: Actor, public radius: number) {}\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\n    const position = target.center;\n    const focus = cam.getFocus();\n\n    const direction = position.sub(focus);\n    const distance = direction.size;\n    if (distance >= this.radius) {\n      const offset = distance - this.radius;\n      return focus.add(direction.normalize().scale(offset));\n    }\n    return focus;\n  };\n}\n\n/**\n * Prevent a camera from going beyond the given camera dimensions.\n */\nexport class LimitCameraBoundsStrategy implements CameraStrategy<BoundingBox> {\n  /**\n   * Useful for limiting the camera to a [[TileMap]]'s dimensions, or a specific area inside the map.\n   *\n   * Note that this strategy does not perform any movement by itself.\n   * It only sets the camera position to within the given bounds when the camera has gone beyond them.\n   * Thus, it is a good idea to combine it with other camera strategies and set this strategy as the last one.\n   *\n   * Make sure that the camera bounds are at least as large as the viewport size.\n   *\n   * @param target The bounding box to limit the camera to\n   */\n\n  boundSizeChecked: boolean = false; // Check and warn only once\n\n  constructor(public target: BoundingBox) {}\n\n  public action = (target: BoundingBox, cam: Camera, _eng: Engine, _delta: number) => {\n    const focus = cam.getFocus();\n\n    if (!this.boundSizeChecked) {\n      if (target.bottom - target.top < _eng.drawHeight || target.right - target.left < _eng.drawWidth) {\n        Logger.getInstance().warn('Camera bounds should not be smaller than the engine viewport');\n      }\n      this.boundSizeChecked = true;\n    }\n\n    if (focus.x < target.left + _eng.halfDrawWidth) {\n      focus.x = target.left + _eng.halfDrawWidth;\n    } else if (focus.x > target.right - _eng.halfDrawWidth) {\n      focus.x = target.right - _eng.halfDrawWidth;\n    }\n\n    if (focus.y < target.top + _eng.halfDrawHeight) {\n      focus.y = target.top + _eng.halfDrawHeight;\n    } else if (focus.y > target.bottom - _eng.halfDrawHeight) {\n      focus.y = target.bottom - _eng.halfDrawHeight;\n    }\n\n    return focus;\n  };\n}\n\n/**\n * Cameras\n *\n * [[Camera]] is the base class for all Excalibur cameras. Cameras are used\n * to move around your game and set focus. They are used to determine\n * what is \"off screen\" and can be used to scale the game.\n *\n */\nexport class Camera extends Class implements CanUpdate, CanInitialize {\n  protected _follow: Actor;\n\n  private _cameraStrategies: CameraStrategy<any>[] = [];\n\n  public strategy: StrategyContainer = new StrategyContainer(this);\n\n  /**\n   * Get or set current zoom of the camera, defaults to 1\n   */\n  public z: number = 1;\n  /**\n   * Get or set rate of change in zoom, defaults to 0\n   */\n  public dz: number = 0;\n  /**\n   * Get or set zoom acceleration\n   */\n  public az: number = 0;\n\n  /**\n   * Current rotation of the camera\n   */\n  public rotation: number = 0;\n\n  /**\n   * Current angular velocity\n   */\n  public rx: number = 0;\n\n  /**\n   * Get or set the camera's angular velocity\n   */\n  public get angularVelocity(): number {\n    return this.rx;\n  }\n\n  public set angularVelocity(value: number) {\n    this.rx = value;\n  }\n\n  /**\n   * Get or set the camera's position\n   */\n  public pos: Vector = Vector.Zero;\n\n  /**\n   * Get or set the camera's velocity\n   */\n  public vel: Vector = Vector.Zero;\n\n  /**\n   * GEt or set the camera's acceleration\n   */\n  public acc: Vector = Vector.Zero;\n\n  private _cameraMoving: boolean = false;\n  private _currentLerpTime: number = 0;\n  private _lerpDuration: number = 1000; // 1 second\n  private _lerpStart: Vector = null;\n  private _lerpEnd: Vector = null;\n  private _lerpResolve: (value: Vector) => void;\n  private _lerpPromise: Promise<Vector>;\n\n  //camera effects\n  protected _isShaking: boolean = false;\n  private _shakeMagnitudeX: number = 0;\n  private _shakeMagnitudeY: number = 0;\n  private _shakeDuration: number = 0;\n  private _elapsedShakeTime: number = 0;\n  private _xShake: number = 0;\n  private _yShake: number = 0;\n\n  protected _isZooming: boolean = false;\n  private _zoomStart: number = 1;\n  private _zoomEnd: number = 1;\n  private _currentZoomTime: number = 0;\n  private _zoomDuration: number = 0;\n\n  private _zoomResolve: (val: boolean) => void;\n  private _zoomPromise: Promise<boolean>;\n  private _zoomEasing: EasingFunction = EasingFunctions.EaseInOutCubic;\n  private _easing: EasingFunction = EasingFunctions.EaseInOutCubic;\n\n  /**\n   * Get the camera's x position\n   */\n  public get x() {\n    return this.pos.x;\n  }\n\n  /**\n   * Set the camera's x position (cannot be set when following an [[Actor]] or when moving)\n   */\n  public set x(value: number) {\n    if (!this._follow && !this._cameraMoving) {\n      this.pos.x = value;\n    }\n  }\n\n  /**\n   * Get the camera's y position\n   */\n  public get y() {\n    return this.pos.y;\n  }\n\n  /**\n   * Set the camera's y position (cannot be set when following an [[Actor]] or when moving)\n   */\n  public set y(value: number) {\n    if (!this._follow && !this._cameraMoving) {\n      this.pos.y = value;\n    }\n  }\n\n  /**\n   * Get or set the camera's x velocity\n   */\n  public get dx() {\n    return this.vel.x;\n  }\n\n  public set dx(value: number) {\n    this.vel.x = value;\n  }\n\n  /**\n   * Get or set the camera's y velocity\n   */\n  public get dy() {\n    return this.vel.y;\n  }\n\n  public set dy(value: number) {\n    this.vel.y = value;\n  }\n\n  /**\n   * Get or set the camera's x acceleration\n   */\n  public get ax() {\n    return this.acc.x;\n  }\n\n  public set ax(value: number) {\n    this.acc.x = value;\n  }\n\n  /**\n   * Get or set the camera's y acceleration\n   */\n  public get ay() {\n    return this.acc.y;\n  }\n\n  public set ay(value: number) {\n    this.acc.y = value;\n  }\n\n  /**\n   * Returns the focal point of the camera, a new point giving the x and y position of the camera\n   */\n  public getFocus() {\n    return this.pos;\n  }\n\n  /**\n   * This moves the camera focal point to the specified position using specified easing function. Cannot move when following an Actor.\n   *\n   * @param pos The target position to move to\n   * @param duration The duration in milliseconds the move should last\n   * @param [easingFn] An optional easing function ([[ex.EasingFunctions.EaseInOutCubic]] by default)\n   * @returns A [[Promise]] that resolves when movement is finished, including if it's interrupted.\n   *          The [[Promise]] value is the [[Vector]] of the target position. It will be rejected if a move cannot be made.\n   */\n  public move(pos: Vector, duration: number, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<Vector> {\n    if (typeof easingFn !== 'function') {\n      throw 'Please specify an EasingFunction';\n    }\n\n    // cannot move when following an actor\n    if (this._follow) {\n      return Promise.reject(pos);\n    }\n\n    // resolve existing promise, if any\n    if (this._lerpPromise && this._lerpResolve) {\n      this._lerpResolve(pos);\n    }\n\n    this._lerpPromise = new Promise<Vector>((resolve) => {\n      this._lerpResolve = resolve;\n    });\n    this._lerpStart = this.getFocus().clone();\n    this._lerpDuration = duration;\n    this._lerpEnd = pos;\n    this._currentLerpTime = 0;\n    this._cameraMoving = true;\n    this._easing = easingFn;\n\n    return this._lerpPromise;\n  }\n\n  /**\n   * Sets the camera to shake at the specified magnitudes for the specified duration\n   * @param magnitudeX  The x magnitude of the shake\n   * @param magnitudeY  The y magnitude of the shake\n   * @param duration    The duration of the shake in milliseconds\n   */\n  public shake(magnitudeX: number, magnitudeY: number, duration: number) {\n    this._isShaking = true;\n    this._shakeMagnitudeX = magnitudeX;\n    this._shakeMagnitudeY = magnitudeY;\n    this._shakeDuration = duration;\n  }\n\n  /**\n   * Zooms the camera in or out by the specified scale over the specified duration.\n   * If no duration is specified, it take effect immediately.\n   * @param scale    The scale of the zoom\n   * @param duration The duration of the zoom in milliseconds\n   */\n  public zoom(scale: number, duration: number = 0, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<boolean> {\n    this._zoomPromise = new Promise<boolean>((resolve) => {\n      this._zoomResolve = resolve;\n    });\n\n    if (duration) {\n      this._isZooming = true;\n      this._zoomEasing = easingFn;\n      this._currentZoomTime = 0;\n      this._zoomDuration = duration;\n      this._zoomStart = this.z;\n      this._zoomEnd = scale;\n    } else {\n      this._isZooming = false;\n      this.z = scale;\n      return Promise.resolve(true);\n    }\n\n    return this._zoomPromise;\n  }\n\n  /**\n   * Gets the current zoom scale\n   */\n  public getZoom() {\n    return this.z;\n  }\n\n  /**\n   * Gets the bounding box of the viewport of this camera in world coordinates\n   */\n  public get viewport(): BoundingBox {\n    if (this._engine) {\n      const halfWidth = this._engine.halfDrawWidth;\n      const halfHeight = this._engine.halfDrawHeight;\n\n      return new BoundingBox(this.x - halfWidth, this.y - halfHeight, this.x + halfWidth, this.y + halfHeight);\n    }\n    return new BoundingBox(0, 0, 0, 0);\n  }\n\n  /**\n   * Adds a new camera strategy to this camera\n   * @param cameraStrategy Instance of an [[CameraStrategy]]\n   */\n  public addStrategy<T>(cameraStrategy: CameraStrategy<T>) {\n    this._cameraStrategies.push(cameraStrategy);\n  }\n\n  /**\n   * Removes a camera strategy by reference\n   * @param cameraStrategy Instance of an [[CameraStrategy]]\n   */\n  public removeStrategy<T>(cameraStrategy: CameraStrategy<T>) {\n    removeItemFromArray(cameraStrategy, this._cameraStrategies);\n  }\n\n  /**\n   * Clears all camera strategies from the camera\n   */\n  public clearAllStrategies() {\n    this._cameraStrategies.length = 0;\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\n    this.onPreUpdate(engine, delta);\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before a scene is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // Overridable\n  }\n\n  /**\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(engine: Engine, delta: number): void {\n    this.emit('postupdate', new PostUpdateEvent(engine, delta, this));\n    this.onPostUpdate(engine, delta);\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after a scene is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // Overridable\n  }\n\n  private _engine: Engine;\n  private _isInitialized = false;\n  public get isInitialized() {\n    return this._isInitialized;\n  }\n\n  public _initialize(_engine: Engine) {\n    if (!this.isInitialized) {\n      this.onInitialize(_engine);\n      super.emit('initialize', new InitializeEvent(_engine, this));\n      this._isInitialized = true;\n      this._engine = _engine;\n    }\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after a scene is updated.\n   */\n  public onInitialize(_engine: Engine) {\n    // Overridable\n  }\n\n  public on(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\n  public on(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\n  public on(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\n  public on(eventName: any, handler: any) {\n    super.on(eventName, handler);\n  }\n\n  public off(eventName: 'initialize', handler?: (event: InitializeEvent) => void): void;\n  public off(eventName: 'preupdate', handler?: (event: PreUpdateEvent) => void): void;\n  public off(eventName: 'postupdate', handler?: (event: PostUpdateEvent) => void): void;\n  public off(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\n  public off(eventName: string, handler: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  public once(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\n  public once(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\n  public once(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public update(_engine: Engine, delta: number) {\n    this._initialize(_engine);\n    this._preupdate(_engine, delta);\n\n    // Update placements based on linear algebra\n    this.pos = this.pos.add(this.vel.scale(delta / 1000));\n    this.z += (this.dz * delta) / 1000;\n\n    this.vel = this.vel.add(this.acc.scale(delta / 1000));\n    this.dz += (this.az * delta) / 1000;\n\n    this.rotation += (this.angularVelocity * delta) / 1000;\n\n    if (this._isZooming) {\n      if (this._currentZoomTime < this._zoomDuration) {\n        const zoomEasing = this._zoomEasing;\n        const newZoom = zoomEasing(this._currentZoomTime, this._zoomStart, this._zoomEnd, this._zoomDuration);\n\n        this.z = newZoom;\n        this._currentZoomTime += delta;\n      } else {\n        this._isZooming = false;\n        this.z = this._zoomEnd;\n        this._currentZoomTime = 0;\n        this._zoomResolve(true);\n      }\n    }\n\n    if (this._cameraMoving) {\n      if (this._currentLerpTime < this._lerpDuration) {\n        const moveEasing = EasingFunctions.CreateVectorEasingFunction(this._easing);\n\n        const lerpPoint = moveEasing(this._currentLerpTime, this._lerpStart, this._lerpEnd, this._lerpDuration);\n\n        this.pos = lerpPoint;\n\n        this._currentLerpTime += delta;\n      } else {\n        this.pos = this._lerpEnd;\n        const end = this._lerpEnd.clone();\n\n        this._lerpStart = null;\n        this._lerpEnd = null;\n        this._currentLerpTime = 0;\n        this._cameraMoving = false;\n        // Order matters here, resolve should be last so any chain promises have a clean slate\n        this._lerpResolve(end);\n      }\n    }\n\n    if (this._isDoneShaking()) {\n      this._isShaking = false;\n      this._elapsedShakeTime = 0;\n      this._shakeMagnitudeX = 0;\n      this._shakeMagnitudeY = 0;\n      this._shakeDuration = 0;\n      this._xShake = 0;\n      this._yShake = 0;\n    } else {\n      this._elapsedShakeTime += delta;\n      this._xShake = ((Math.random() * this._shakeMagnitudeX) | 0) + 1;\n      this._yShake = ((Math.random() * this._shakeMagnitudeY) | 0) + 1;\n    }\n\n    for (const s of this._cameraStrategies) {\n      this.pos = s.action.call(s, s.target, this, _engine, delta);\n    }\n\n    this._postupdate(_engine, delta);\n  }\n\n  /**\n   * Applies the relevant transformations to the game canvas to \"move\" or apply effects to the Camera\n   * @param ctx    Canvas context to apply transformations\n   */\n  public draw(ctx: CanvasRenderingContext2D) {\n    const focus = this.getFocus();\n    const canvasWidth = ctx.canvas.width;\n    const canvasHeight = ctx.canvas.height;\n    const pixelRatio = this._engine ? this._engine.pixelRatio : window.devicePixelRatio;\n    const zoom = this.getZoom();\n\n    const newCanvasWidth = canvasWidth / zoom / pixelRatio;\n    const newCanvasHeight = canvasHeight / zoom / pixelRatio;\n\n    ctx.scale(zoom, zoom);\n    ctx.translate(-focus.x + newCanvasWidth / 2 + this._xShake, -focus.y + newCanvasHeight / 2 + this._yShake);\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    const focus = this.getFocus();\n    ctx.fillStyle = 'red';\n    ctx.strokeStyle = 'white';\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    ctx.arc(focus.x, focus.y, 15, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.stroke();\n\n    ctx.beginPath();\n    ctx.arc(focus.x, focus.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.stroke();\n\n    ctx.beginPath();\n    ctx.setLineDash([5, 15]);\n    ctx.lineWidth = 5;\n    ctx.strokeStyle = 'white';\n    ctx.strokeRect(this.viewport.left, this.viewport.top, this.viewport.width, this.viewport.height);\n    ctx.closePath();\n  }\n\n  private _isDoneShaking(): boolean {\n    return !this._isShaking || this._elapsedShakeTime >= this._shakeDuration;\n  }\n}\n","import { Engine } from './Engine';\nimport { Color } from './Drawing/Color';\nimport { SpriteFont } from './Drawing/SpriteSheet';\nimport { Actor } from './Actor';\nimport { Configurable } from './Configurable';\nimport { Vector } from './Algebra';\nimport { CollisionType } from './Collision/CollisionType';\n/**\n * Enum representing the different font size units\n * https://developer.mozilla.org/en-US/docs/Web/CSS/font-size\n */\nexport enum FontUnit {\n  /**\n   * Em is a scalable unit, 1 em is equal to the current font size of the current element, parent elements can effect em values\n   */\n  Em,\n  /**\n   * Rem is similar to the Em, it is a scalable unit. 1 rem is equal to the font size of the root element\n   */\n  Rem,\n  /**\n   * Pixel is a unit of length in screen pixels\n   */\n  Px,\n  /**\n   * Point is a physical unit length (1/72 of an inch)\n   */\n  Pt,\n  /**\n   * Percent is a scalable unit similar to Em, the only difference is the Em units scale faster when Text-Size stuff\n   */\n  Percent\n}\n\n/**\n * Enum representing the different horizontal text alignments\n */\nexport enum TextAlign {\n  /**\n   * The text is left-aligned.\n   */\n  Left,\n  /**\n   * The text is right-aligned.\n   */\n  Right,\n  /**\n   * The text is centered.\n   */\n  Center,\n  /**\n   * The text is aligned at the normal start of the line (left-aligned for left-to-right locales,\n   * right-aligned for right-to-left locales).\n   */\n  Start,\n  /**\n   * The text is aligned at the normal end of the line (right-aligned for left-to-right locales,\n   * left-aligned for right-to-left locales).\n   */\n  End\n}\n\n/**\n * Enum representing the different baseline text alignments\n */\nexport enum BaseAlign {\n  /**\n   * The text baseline is the top of the em square.\n   */\n  Top,\n  /**\n   * The text baseline is the hanging baseline.  Currently unsupported; this will act like\n   * alphabetic.\n   */\n  Hanging,\n  /**\n   * The text baseline is the middle of the em square.\n   */\n  Middle,\n  /**\n   * The text baseline is the normal alphabetic baseline.\n   */\n  Alphabetic,\n  /**\n   * The text baseline is the ideographic baseline; this is the bottom of\n   * the body of the characters, if the main body of characters protrudes\n   * beneath the alphabetic baseline.  Currently unsupported; this will\n   * act like alphabetic.\n   */\n  Ideographic,\n  /**\n   * The text baseline is the bottom of the bounding box.  This differs\n   * from the ideographic baseline in that the ideographic baseline\n   * doesn't consider descenders.\n   */\n  Bottom\n}\n\n/**\n * Enum representing the different possible font styles\n */\nexport enum FontStyle {\n  Normal,\n  Italic,\n  Oblique\n}\n\nexport interface LabelArgs extends Partial<LabelImpl> {\n  x?: number;\n  y?: number;\n  text?: string;\n  bold?: boolean;\n  pos?: Vector;\n  spriteFont?: SpriteFont;\n  fontFamily?: string;\n  fontSize?: number;\n  fontStyle?: FontStyle;\n  fontUnit?: FontUnit;\n  textAlign?: TextAlign;\n  maxWidth?: number;\n}\n\n/**\n * @hidden\n */\nexport class LabelImpl extends Actor {\n  /**\n   * The text to draw.\n   */\n  public text: string;\n\n  /**\n   * Sets or gets the bold property of the label's text, by default it's false\n   */\n  public bold: boolean = false;\n\n  /**\n   * The [[SpriteFont]] to use, if any. Overrides [[fontFamily]] if present.\n   */\n  public spriteFont: SpriteFont;\n\n  /**\n   * The CSS font family string (e.g. `sans-serif`, `Droid Sans Pro`). Web fonts\n   * are supported, same as in CSS.\n   */\n  public fontFamily: string;\n\n  /**\n   * The font size in the selected units, default is 10 (default units is pixel)\n   */\n  public fontSize: number = 10;\n\n  /**\n   * The font style for this label, the default is [[FontStyle.Normal]]\n   */\n  public fontStyle: FontStyle = FontStyle.Normal;\n\n  /**\n   * The css units for a font size such as px, pt, em (SpriteFont only support px), by default is 'px';\n   */\n  public fontUnit: FontUnit = FontUnit.Px;\n\n  /**\n   * Gets or sets the horizontal text alignment property for the label.\n   */\n  public textAlign: TextAlign = TextAlign.Left;\n\n  /**\n   * Gets or sets the baseline alignment property for the label.\n   */\n  public baseAlign: BaseAlign = BaseAlign.Bottom;\n\n  /**\n   * Gets or sets the maximum width (in pixels) that the label should occupy\n   */\n  public maxWidth: number;\n\n  /**\n   * Gets or sets the letter spacing on a Label. Only supported with Sprite Fonts.\n   */\n  public letterSpacing: number = 0; //px\n\n  /**\n   * Whether or not the [[SpriteFont]] will be case-sensitive when matching characters.\n   */\n  public caseInsensitive: boolean = true;\n\n  private _textShadowOn: boolean;\n  private _shadowOffsetX: number;\n  private _shadowOffsetY: number;\n\n  /**\n   * @param textOrConfig    The text of the label, or label option bag\n   * @param x           The x position of the label\n   * @param y           The y position of the label\n   * @param fontFamily  Use a value that is valid for the CSS `font-family` property. The default is `sans-serif`.\n   * @param spriteFont  Use an Excalibur sprite font for the label's font, if a SpriteFont is provided it will take precedence\n   * over a css font.\n   */\n  constructor(textOrConfig?: string | Partial<LabelImpl>, x?: number, y?: number, fontFamily?: string, spriteFont?: SpriteFont) {\n    super(textOrConfig && typeof textOrConfig === 'object' ? textOrConfig : { pos: new Vector(x, y) });\n\n    let text = '';\n    if (textOrConfig && typeof textOrConfig === 'object') {\n      fontFamily = textOrConfig.fontFamily;\n      spriteFont = textOrConfig.spriteFont;\n      text = textOrConfig.text;\n    } else {\n      text = <string>textOrConfig;\n    }\n\n    this.text = text || '';\n    this.color = Color.Black;\n    this.spriteFont = spriteFont;\n    this.body.collider.type = CollisionType.PreventCollision;\n    this.fontFamily = fontFamily || 'sans-serif'; // coalesce to default canvas font\n\n    this._textShadowOn = false;\n    this._shadowOffsetX = 0;\n    this._shadowOffsetY = 0;\n    if (spriteFont) {\n      //this._textSprites = spriteFont.getTextSprites();\n    }\n  }\n\n  /**\n   * Returns the width of the text in the label (in pixels);\n   * @param ctx  Rendering context to measure the string with\n   */\n  public getTextWidth(ctx: CanvasRenderingContext2D): number {\n    const oldFont = ctx.font;\n    ctx.font = this._fontString;\n    const width = ctx.measureText(this.text).width;\n    ctx.font = oldFont;\n    return width;\n  }\n\n  /* istanbul ignore next */\n  private _lookupFontUnit(fontUnit: FontUnit): string {\n    switch (fontUnit) {\n      case FontUnit.Em:\n        return 'em';\n      case FontUnit.Rem:\n        return 'rem';\n      case FontUnit.Pt:\n        return 'pt';\n      case FontUnit.Px:\n        return 'px';\n      case FontUnit.Percent:\n        return '%';\n      default:\n        return 'px';\n    }\n  }\n\n  /* istanbul ignore next */\n  private _lookupTextAlign(textAlign: TextAlign): CanvasTextAlign {\n    switch (textAlign) {\n      case TextAlign.Left:\n        return 'left';\n      case TextAlign.Right:\n        return 'right';\n      case TextAlign.Center:\n        return 'center';\n      case TextAlign.End:\n        return 'end';\n      case TextAlign.Start:\n        return 'start';\n      default:\n        return 'start';\n    }\n  }\n\n  /* istanbul ignore next */\n  private _lookupBaseAlign(baseAlign: BaseAlign): CanvasTextBaseline {\n    switch (baseAlign) {\n      case BaseAlign.Alphabetic:\n        return 'alphabetic';\n      case BaseAlign.Bottom:\n        return 'bottom';\n      case BaseAlign.Hanging:\n        return 'hanging';\n      case BaseAlign.Ideographic:\n        return 'ideographic';\n      case BaseAlign.Middle:\n        return 'middle';\n      case BaseAlign.Top:\n        return 'top';\n      default:\n        return 'alphabetic';\n    }\n  }\n\n  /* istanbul ignore next */\n  private _lookupFontStyle(fontStyle: FontStyle): string {\n    const boldstring = this.bold ? ' bold' : '';\n    switch (fontStyle) {\n      case FontStyle.Italic:\n        return 'italic' + boldstring;\n      case FontStyle.Normal:\n        return 'normal' + boldstring;\n      case FontStyle.Oblique:\n        return 'oblique' + boldstring;\n      default:\n        return 'normal' + boldstring;\n    }\n  }\n\n  /**\n   * Sets the text shadow for sprite fonts\n   * @param offsetX      The x offset in pixels to place the shadow\n   * @param offsetY      The y offset in pixels to place the shadow\n   * @param shadowColor  The color of the text shadow\n   */\n  public setTextShadow(offsetX: number, offsetY: number, shadowColor: Color) {\n    this.spriteFont.setTextShadow(offsetX, offsetY, shadowColor);\n  }\n\n  /**\n   * Toggles text shadows on or off, only applies when using sprite fonts\n   */\n  public useTextShadow(on: boolean) {\n    this.spriteFont.useTextShadow(on);\n  }\n\n  /**\n   * Clears the current text shadow\n   */\n  public clearTextShadow() {\n    this._textShadowOn = false;\n    this._shadowOffsetX = 0;\n    this._shadowOffsetY = 0;\n  }\n\n  public update(engine: Engine, delta: number) {\n    super.update(engine, delta);\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\n    ctx.save();\n    if (this._textShadowOn) {\n      ctx.save();\n      ctx.translate(this._shadowOffsetX, this._shadowOffsetY);\n      this._fontDraw(ctx);\n      ctx.restore();\n    }\n    this._fontDraw(ctx);\n\n    super.draw(ctx, delta);\n    ctx.restore();\n  }\n\n  private _fontDraw(ctx: CanvasRenderingContext2D) {\n    if (this.spriteFont) {\n      this.spriteFont.draw(ctx, this.text, 0, 0, {\n        color: this.color.clone(),\n        baseAlign: this.baseAlign,\n        textAlign: this.textAlign,\n        fontSize: this.fontSize,\n        letterSpacing: this.letterSpacing,\n        opacity: this.opacity\n      });\n    } else {\n      const oldAlign = ctx.textAlign;\n      const oldTextBaseline = ctx.textBaseline;\n\n      ctx.textAlign = this._lookupTextAlign(this.textAlign);\n      ctx.textBaseline = this._lookupBaseAlign(this.baseAlign);\n      if (this.color) {\n        this.color.a = this.opacity;\n      }\n      ctx.fillStyle = this.color.toString();\n      ctx.font = this._fontString;\n      if (this.maxWidth) {\n        ctx.fillText(this.text, 0, 0, this.maxWidth);\n      } else {\n        ctx.fillText(this.text, 0, 0);\n      }\n\n      ctx.textAlign = oldAlign;\n      ctx.textBaseline = oldTextBaseline;\n    }\n  }\n\n  protected get _fontString() {\n    return `${this._lookupFontStyle(this.fontStyle)} ${this.fontSize}${this._lookupFontUnit(this.fontUnit)} ${this.fontFamily}`;\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    super.debugDraw(ctx);\n  }\n}\n\n/**\n * Labels are the way to draw small amounts of text to the screen. They are\n * actors and inherit all of the benefits and capabilities.\n */\nexport class Label extends Configurable(LabelImpl) {\n  constructor();\n  constructor(config?: LabelArgs);\n  constructor(text?: string, x?: number, y?: number, fontFamily?: string, spriteFont?: SpriteFont);\n  constructor(textOrConfig?: string | LabelArgs, x?: number, y?: number, fontFamily?: string, spriteFont?: SpriteFont) {\n    super(textOrConfig, x, y, fontFamily, spriteFont);\n  }\n}\n","import { Color } from './Drawing/Color';\nimport { Engine } from './Engine';\nimport { ActionQueue } from './Actions/Action';\nimport { EventDispatcher } from './EventDispatcher';\nimport { Actor, isActor } from './Actor';\nimport { Vector } from './Algebra';\nimport { ExitTriggerEvent, EnterTriggerEvent, CollisionEndEvent, CollisionStartEvent } from './Events';\nimport * as Util from './Util/Util';\nimport { CollisionType } from './Collision/CollisionType';\n\n/**\n * ITriggerOptions\n */\nexport interface TriggerOptions {\n  // position of the trigger\n  pos: Vector;\n  // width of the trigger\n  width: number;\n  // height of the trigger\n  height: number;\n  // whether the trigger is visible or not\n  visible: boolean;\n  // action to take when triggered\n  action: () => void;\n  // if specified the trigger will only fire on a specific actor and overrides any filter\n  target: Actor;\n  // Returns true if the triggers should fire on the collided actor\n  filter: (actor: Actor) => boolean;\n  // -1 if it should repeat forever\n  repeat: number;\n}\n\nconst triggerDefaults: Partial<TriggerOptions> = {\n  pos: Vector.Zero,\n  width: 10,\n  height: 10,\n  visible: false,\n  action: () => {\n    return;\n  },\n  filter: () => true,\n  repeat: -1\n};\n\n/**\n * Triggers are a method of firing arbitrary code on collision. These are useful\n * as 'buttons', 'switches', or to trigger effects in a game. By default triggers\n * are invisible, and can only be seen when [[Trigger.visible]] is set to `true`.\n */\nexport class Trigger extends Actor {\n  private _target: Actor;\n  /**\n   * Action to fire when triggered by collision\n   */\n  public action: () => void = () => {\n    return;\n  };\n  /**\n   * Filter to add additional granularity to action dispatch, if a filter is specified the action will only fire when\n   * filter return true for the collided actor.\n   */\n  public filter: (actor: Actor) => boolean = () => true;\n  /**\n   * Number of times to repeat before killing the trigger,\n   */\n  public repeat: number = -1;\n\n  /**\n   *\n   * @param opts Trigger options\n   */\n  constructor(opts: Partial<TriggerOptions>) {\n    super(opts.pos.x, opts.pos.y, opts.width, opts.height);\n    opts = Util.extend({}, triggerDefaults, opts);\n\n    this.filter = opts.filter || this.filter;\n    this.repeat = opts.repeat || this.repeat;\n    this.action = opts.action || this.action;\n    if (opts.target) {\n      this.target = opts.target;\n    }\n\n    this.visible = opts.visible;\n    this.body.collider.type = CollisionType.Passive;\n    this.eventDispatcher = new EventDispatcher(this);\n    this.actionQueue = new ActionQueue(this);\n\n    this.on('collisionstart', (evt: CollisionStartEvent<Actor>) => {\n      if (isActor(evt.other) && this.filter(evt.other)) {\n        this.emit('enter', new EnterTriggerEvent(this, evt.other));\n        this._dispatchAction();\n        // remove trigger if its done, -1 repeat forever\n        if (this.repeat === 0) {\n          this.kill();\n        }\n      }\n    });\n\n    this.on('collisionend', (evt: CollisionEndEvent<Actor>) => {\n      if (isActor(evt.other) && this.filter(evt.other)) {\n        this.emit('exit', new ExitTriggerEvent(this, evt.other));\n      }\n    });\n  }\n\n  public set target(target: Actor) {\n    this._target = target;\n    this.filter = (actor: Actor) => actor === target;\n  }\n\n  public get target() {\n    return this._target;\n  }\n\n  public _initialize(engine: Engine) {\n    super._initialize(engine);\n  }\n\n  private _dispatchAction() {\n    this.action.call(this);\n    this.repeat--;\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    super.debugDraw(ctx);\n    // Meant to draw debug information about actors\n    ctx.save();\n    ctx.translate(this.pos.x, this.pos.y);\n\n    const bb = this.body.collider.bounds;\n    const wp = this.getWorldPos();\n    bb.left = bb.left - wp.x;\n    bb.right = bb.right - wp.x;\n    bb.top = bb.top - wp.y;\n    bb.bottom = bb.bottom - wp.y;\n\n    // Currently collision primitives cannot rotate\n    // ctx.rotate(this.rotation);\n    ctx.fillStyle = Color.Violet.toString();\n    ctx.strokeStyle = Color.Violet.toString();\n    ctx.fillText('Trigger', 10, 10);\n    bb.debugDraw(ctx);\n\n    ctx.restore();\n  }\n}\n","import { Actor } from '../Actor';\nimport { ScreenElement } from '../ScreenElement';\nimport { Label } from '../Label';\nimport { Trigger } from '../Trigger';\n\n/**\n * Type guard to detect if something is an actor\n * @deprecated\n * @param actor\n */\nexport function isVanillaActor(actor: Actor) {\n  return !(actor instanceof ScreenElement) && !(actor instanceof Trigger) && !(actor instanceof Label);\n}\n\n/**\n * Type guard to detect a screen element\n * TODO: Move to screen element\n */\nexport function isScreenElement(actor: Actor) {\n  return actor instanceof ScreenElement;\n}\n","import { Entity } from './Entity';\nimport { Message, Observer } from '../Util/Observable';\nimport { Component } from './Component';\nimport { Scene } from '../Scene';\n\n/**\n * Enum that determines whether to run the system in the update or draw phase\n */\nexport enum SystemType {\n  Update = 'update',\n  Draw = 'draw'\n}\n\nexport type SystemTypes<ComponentTypes> = ComponentTypes extends Component<infer TypeName> ? TypeName : never;\n\n/**\n * An Excalibur [[System]] that updates entities of certain types.\n * Systems are scene specific\n *\n * Excalibur Systems currently require at least 1 Component type to operated\n *\n * Multiple types are declared as a type union\n * For example:\n *\n * ```typescript\n * class MySystem extends System<ComponentA | ComponentB> {\n *   public readonly types = ['a', 'b'] as const;\n *   public readonly systemType = SystemType.Update;\n *   public update(entities: Entity<ComponentA | ComponentB>) {\n *      ...\n *   }\n * }\n * ```\n */\nexport abstract class System<ComponentTypeUnion extends Component = Component, ContextType = Scene>\nimplements Observer<AddedEntity | RemovedEntity> {\n  /**\n   * The types of entities that this system operates on\n   * For example ['transform', 'motion']\n   */\n  abstract readonly types: readonly SystemTypes<ComponentTypeUnion>[];\n\n  /**\n   * Determine whether the system is called in the [[SystemType.Update]] or the [[SystemType.Draw]] phase. Update is first, then Draw.\n   */\n  abstract readonly systemType: SystemType;\n\n  /**\n   * System can execute in priority order, by default all systems are priority 0. Lower values indicated higher priority.\n   * For a system to execute before all other a lower priority value (-1 for example) must be set.\n   * For a system to exectue after all other a higher priority value (10 for example) must be set.\n   */\n  public priority: number = 0;\n\n  /**\n   * Optionally specify a sort order for entities passed to the your system\n   * @param a The left entity\n   * @param b The right entity\n   */\n  sort?(a: Entity<ComponentTypeUnion>, b: Entity<ComponentTypeUnion>): number;\n\n  /**\n   * Optionally specify an initialize handler\n   * @param scene\n   */\n  initialize?(engine: ContextType): void;\n\n  /**\n   * Update all entities that match this system's types\n   * @param entities Entities to update that match this system's typse\n   * @param delta Time in milliseconds\n   */\n  abstract update(entities: Entity<ComponentTypeUnion>[], delta: number): void;\n\n  /**\n   * Optionally run a preupdate before the system processes matching entities\n   * @param engine\n   * @param delta Time in milliseconds since the last frame\n   */\n  preupdate?(engine: ContextType, delta: number): void;\n\n  /**\n   * Optionally run a postupdate after the system processes matching entities\n   * @param engine\n   * @param delta Time in milliseconds since the last frame\n   */\n  postupdate?(engine: ContextType, delta: number): void;\n\n  /**\n   * Optionally run a debug draw step to visualize the internals of the system\n   */\n  debugDraw?(ctx: CanvasRenderingContext2D, delta: number): void;\n\n  /**\n   * Systems observe when entities match their types or no longer match their types, override\n   * @param _entityAddedOrRemoved\n   */\n  public notify(_entityAddedOrRemoved: AddedEntity | RemovedEntity) {\n    // Override me\n  }\n}\n\n/**\n * An [[Entity]] with [[Component]] types that matches a [[System]] types exists in the current scene.\n */\nexport class AddedEntity implements Message<Entity> {\n  readonly type: 'Entity Added' = 'Entity Added';\n  constructor(public data: Entity) {}\n}\n\n/**\n * Type guard to check for AddedEntity messages\n * @param x\n */\nexport function isAddedSystemEntity(x: Message<Entity>): x is AddedEntity {\n  return !!x && x.type === 'Entity Added';\n}\n\n/**\n * An [[Entity]] with [[Component]] types that no longer matches a [[System]] types exists in the current scene.\n */\nexport class RemovedEntity implements Message<Entity> {\n  readonly type: 'Entity Removed' = 'Entity Removed';\n  constructor(public data: Entity) {}\n}\n\n/**\n * type guard to check for the RemovedEntity message\n */\nexport function isRemoveSystemEntity(x: Message<Entity>): x is RemovedEntity {\n  return !!x && x.type === 'Entity Removed';\n}\n","import { Engine } from '../Engine';\nimport { Actor } from '../Actor';\nimport { Entity, System, SystemType } from '../EntityComponentSystem';\nimport { CanvasDrawComponent } from './CanvasDrawComponent';\nimport { Scene } from '../Scene';\nimport { Camera } from '../Camera';\nimport { CoordPlane, TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\n\n/**\n * Draws anything with a transform and a \"draw\" method\n */\nexport class CanvasDrawingSystem extends System<TransformComponent | CanvasDrawComponent> {\n  public readonly types = ['transform', 'canvas'] as const;\n  public systemType = SystemType.Draw;\n  public priority = -1;\n\n  private _ctx: CanvasRenderingContext2D;\n  private _camera: Camera;\n  private _engine: Engine;\n\n  public initialize(scene: Scene): void {\n    this._ctx = scene.engine.ctx;\n    this._engine = scene.engine;\n    this._camera = scene.camera;\n  }\n\n  public sort(a: Entity<TransformComponent | CanvasDrawComponent>, b: Entity<TransformComponent | CanvasDrawComponent>) {\n    return a.components.transform.z - b.components.transform.z;\n  }\n\n  public update(entities: Entity<TransformComponent | CanvasDrawComponent>[], delta: number) {\n    this._clearScreen();\n\n    let transform: TransformComponent;\n    let canvasdraw: CanvasDrawComponent;\n    const length = entities.length;\n    for (let i = 0; i < length; i++) {\n      if ((entities[i] as Actor).visible && !(entities[i] as Actor).isOffScreen) {\n        transform = entities[i].components.transform;\n        canvasdraw = entities[i].components.canvas;\n\n        this._ctx.save();\n        this._pushCameraTransform(transform);\n\n        this._ctx.save();\n        this._applyTransform(entities[i] as Actor);\n        canvasdraw.draw(this._ctx, delta);\n        this._ctx.restore();\n\n        this._popCameraTransform(transform);\n        this._ctx.restore();\n      }\n\n      if (this._engine.isDebug) {\n        this._ctx.save();\n        this._pushCameraTransform(transform);\n        this._ctx.strokeStyle = 'yellow';\n        (entities[i] as Actor).debugDraw(this._ctx);\n        this._popCameraTransform(transform);\n        this._ctx.restore();\n      }\n    }\n    if (this._engine.isDebug) {\n      this._ctx.save();\n      this._camera.draw(this._ctx);\n      this._camera.debugDraw(this._ctx);\n      this._ctx.restore();\n    }\n  }\n\n  private _applyTransform(actor: Actor) {\n    let parent = actor.parent;\n    while (parent) {\n      this._ctx.translate(parent.pos.x, parent.pos.y);\n      this._ctx.rotate(parent.rotation);\n      this._ctx.scale(parent.scale.x, parent.scale.y);\n      parent = parent.parent;\n    }\n\n    this._ctx.translate(actor.pos.x, actor.pos.y);\n    this._ctx.rotate(actor.rotation);\n    this._ctx.scale(actor.scale.x, actor.scale.y);\n  }\n\n  private _clearScreen(): void {\n    this._ctx.clearRect(0, 0, this._ctx.canvas.width, this._ctx.canvas.height);\n    this._ctx.fillStyle = this._engine.backgroundColor.toString();\n    this._ctx.fillRect(0, 0, this._ctx.canvas.width, this._ctx.canvas.height);\n  }\n\n  private _pushCameraTransform(transform: TransformComponent) {\n    if (transform.coordPlane === CoordPlane.World) {\n      // Apply camera transform to place entity in world space\n      this._ctx.save();\n      if (this._camera) {\n        this._camera.draw(this._ctx);\n      }\n    }\n  }\n\n  private _popCameraTransform(transform: TransformComponent) {\n    if (transform.coordPlane === CoordPlane.World) {\n      // Restore back to screen space from world space if we were drawing an entity there\n      this._ctx.restore();\n    }\n  }\n}\n","import { Entity, RemovedComponent, AddedComponent, isAddedComponent, isRemovedComponent } from './Entity';\nimport { Observer } from '../Util/Observable';\nimport { World } from './World';\nimport { Util } from '..';\n\n// Add/Remove entitys and components\n\nexport class EntityManager implements Observer<RemovedComponent | AddedComponent> {\n  public entities: Entity[] = [];\n  public _entityIndex: { [entityId: string]: Entity } = {};\n\n  constructor(private _world: World<any>) {}\n\n  /**\n   * EntityManager observes changes on entities\n   * @param message\n   */\n  public notify(message: RemovedComponent | AddedComponent): void {\n    if (isAddedComponent(message)) {\n      // we don't need the component, it's already on the entity\n      this._world.queryManager.addEntity(message.data.entity);\n    }\n\n    if (isRemovedComponent(message)) {\n      this._world.queryManager.removeComponent(message.data.entity, message.data.component);\n    }\n  }\n\n  /**\n   * Adds an entity to be tracked by the EntityManager\n   * @param entity\n   */\n  public addEntity(entity: Entity): void {\n    if (entity) {\n      this._entityIndex[entity.id] = entity;\n      this.entities.push(entity);\n      this._world.queryManager.addEntity(entity);\n      entity.changes.register(this);\n    }\n  }\n\n  public removeEntity(entity: Entity): void;\n  public removeEntity(id: number): void;\n  public removeEntity(idOrEntity: number | Entity): void {\n    let id = 0;\n    if (idOrEntity instanceof Entity) {\n      id = idOrEntity.id;\n    } else {\n      id = idOrEntity;\n    }\n    const entity = this._entityIndex[id];\n    delete this._entityIndex[id];\n    if (entity) {\n      Util.removeItemFromArray(entity, this.entities);\n      this._world.queryManager.removeEntity(entity);\n      entity.changes.unregister(this);\n    }\n  }\n\n  public processComponentRemovals(): void {\n    for (const entity of this.entities) {\n      entity.processComponentRemoval();\n    }\n  }\n\n  public getById(id: number): Entity {\n    return this._entityIndex[id];\n  }\n\n  public clear(): void {\n    for (const entity of this.entities) {\n      this.removeEntity(entity);\n    }\n  }\n}\n","export const buildTypeKey = (types: readonly string[]) => {\n  const key = [...types].sort((a, b) => a.localeCompare(b)).join('+');\n  return key;\n};\n","import { Entity } from './Entity';\nimport { buildTypeKey } from './Util';\nimport { Observable } from '../Util/Observable';\nimport { Util, Component } from '..';\nimport { AddedEntity, RemovedEntity } from './System';\n\n/**\n * Represents query for entities that match a list of types that is cached and observable\n *\n * Queries can be strongly typed by supplying a type union in the optional type parameter\n * ```typescript\n * const queryAB = new ex.Query<ComponentTypeA, ComponentTypeB>(['A', 'B']);\n * ```\n */\nexport class Query<T extends Component = Component> extends Observable<AddedEntity | RemovedEntity> {\n  private _entities: Entity<T>[] = [];\n  private _key: string;\n  public get key(): string {\n    if (this._key) {\n      return this._key;\n    }\n    return (this._key = buildTypeKey(this.types));\n  }\n\n  constructor(public types: readonly string[]) {\n    super();\n  }\n\n  /**\n   * Returns a list of entities that match the query\n   *\n   * @param sort Optional sorting function to sort entities returned from the query\n   */\n  public getEntities(sort?: (a: Entity<T>, b: Entity<T>) => number): Entity<T>[] {\n    if (sort) {\n      this._entities.sort(sort);\n    }\n    return this._entities;\n  }\n\n  /**\n   * Add an entity to the query, will only be added if the entity matches the query types\n   * @param entity\n   */\n  public addEntity(entity: Entity<T>): void {\n    if (!Util.contains(this._entities, entity) && this.matches(entity)) {\n      this._entities.push(entity);\n      this.notifyAll(new AddedEntity(entity));\n    }\n  }\n\n  /**\n   * If the entity is part of the query it will be removed regardless of types\n   * @param entity\n   */\n  public removeEntity(entity: Entity<T>): void {\n    if (Util.removeItemFromArray(entity, this._entities)) {\n      this.notifyAll(new RemovedEntity(entity));\n    }\n  }\n\n  /**\n   * Removes all entities and observers from the query\n   */\n  public clear(): void {\n    this._entities.length = 0;\n    for (const observer of this.observers) {\n      this.unregister(observer);\n    }\n  }\n\n  /**\n   * Returns whether the entity's types match query\n   * @param entity\n   */\n  public matches(entity: Entity): boolean;\n  /**\n   * Returns whether the list of ComponentTypes match the query\n   * @param types\n   */\n  public matches(types: string[]): boolean;\n  public matches(typesOrEntity: string[] | Entity): boolean {\n    let types: string[] = [];\n    if (typesOrEntity instanceof Entity) {\n      types = typesOrEntity.types;\n    } else {\n      types = typesOrEntity;\n    }\n\n    let matches = true;\n    for (const type of this.types) {\n      matches = matches && types.indexOf(type) > -1;\n      if (!matches) {\n        return false;\n      }\n    }\n    return matches;\n  }\n}\n","import { Entity } from './Entity';\nimport { buildTypeKey } from './Util';\nimport { Query } from './Query';\nimport { Component } from './Component';\nimport { World } from './World';\n\n/**\n * The query manager is responsible for updating all queries when entities/components change\n */\nexport class QueryManager {\n  private _queries: { [entityComponentKey: string]: Query<any> } = {};\n\n  constructor(private _world: World<any>) {}\n\n  /**\n   * Adds a query to the manager and populates with any entities that match\n   * @param query\n   */\n  private _addQuery(query: Query<any>) {\n    this._queries[buildTypeKey(query.types)] = query;\n    for (const entity of this._world.entityManager.entities) {\n      query.addEntity(entity);\n    }\n  }\n\n  /**\n   * Removes the query if there are no observers left\n   * @param query\n   */\n  public maybeRemoveQuery(query: Query): void {\n    if (query.observers.length === 0) {\n      query.clear();\n      delete this._queries[buildTypeKey(query.types)];\n    }\n  }\n\n  /**\n   * Adds the entity to any matching query in the query manage\n   * @param entity\n   */\n  public addEntity(entity: Entity) {\n    for (const queryType in this._queries) {\n      if (this._queries[queryType]) {\n        this._queries[queryType].addEntity(entity);\n      }\n    }\n  }\n\n  /**\n   * Removes an entity from queries if the removed component disqualifies it\n   * @param entity\n   * @param component\n   */\n  public removeComponent(entity: Entity, component: Component) {\n    for (const queryType in this._queries) {\n      if (this._queries[queryType].matches(entity.types.concat([component.type]))) {\n        this._queries[queryType].removeEntity(entity);\n      }\n    }\n  }\n\n  /**\n   * Removes an entity from all queries it is currently a part of\n   * @param entity\n   */\n  public removeEntity(entity: Entity) {\n    for (const queryType in this._queries) {\n      this._queries[queryType].removeEntity(entity);\n    }\n  }\n\n  /**\n   * Creates a populated query and returns, if the query already exists that will be returned instead of a new instance\n   * @param types\n   */\n  public createQuery<T extends Component = Component>(types: readonly string[]): Query<T> {\n    const maybeExistingQuery = this.getQuery<T>(types);\n    if (maybeExistingQuery) {\n      return maybeExistingQuery;\n    }\n    const query = new Query<T>(types);\n    this._addQuery(query);\n    return query;\n  }\n\n  /**\n   * Retrieves an existing query by types if it exists otherwise returns null\n   * @param types\n   */\n  public getQuery<T extends Component = Component>(types: readonly string[]): Query<T> {\n    const key = buildTypeKey(types);\n    if (this._queries[key]) {\n      return this._queries[key] as Query<T>;\n    }\n    return null;\n  }\n}\n","import { System, SystemType } from './System';\nimport { Util } from '..';\nimport { World } from './World';\n\n/**\n * The SystemManager is responsible for keeping track of all systems in a scene.\n * Systems are scene specific\n */\nexport class SystemManager<ContextType> {\n  /**\n   * List of systems, to add a new system call [[SystemManager.addSystem]]\n   */\n  public systems: System<any, ContextType>[] = [];\n  public _keyToSystem: { [key: string]: System<any, ContextType> };\n  constructor(private _world: World<ContextType>) {}\n\n  /**\n   * Adds a system to the manager, it will now be updated every frame\n   * @param system\n   */\n  public addSystem(system: System<any, ContextType>): void {\n    // validate system has types\n    if (!system.types || system.types.length === 0) {\n      throw new Error(`Attempted to add a System without any types`);\n    }\n\n    const query = this._world.queryManager.createQuery(system.types);\n    this.systems.push(system);\n    this.systems.sort((a, b) => a.priority - b.priority);\n    query.register(system);\n    if (system.initialize) {\n      system.initialize(this._world.context);\n    }\n  }\n\n  /**\n   * Removes a system from the manager, it will no longer be updated\n   * @param system\n   */\n  public removeSystem(system: System<any, ContextType>) {\n    Util.removeItemFromArray(system, this.systems);\n    const query = this._world.queryManager.getQuery(system.types);\n    if (query) {\n      query.unregister(system);\n      this._world.queryManager.maybeRemoveQuery(query);\n    }\n  }\n\n  /**\n   * Updates all systems\n   * @param type whether this is an update or draw system\n   * @param engine engine reference\n   * @param delta time in milliseconds\n   */\n  public updateSystems(type: SystemType, engine: ContextType, delta: number) {\n    const systems = this.systems.filter((s) => s.systemType === type);\n    for (const s of systems) {\n      if (s.preupdate) {\n        s.preupdate(engine, delta);\n      }\n    }\n\n    for (const s of systems) {\n      const entities = this._world.queryManager.getQuery(s.types).getEntities(s.sort);\n      s.update(entities, delta);\n    }\n\n    for (const s of systems) {\n      if (s.postupdate) {\n        s.postupdate(engine, delta);\n      }\n    }\n  }\n\n  public clear(): void {\n    for (const system of this.systems) {\n      this.removeSystem(system);\n    }\n  }\n}\n","import { Entity } from './Entity';\nimport { EntityManager } from './EntityManager';\nimport { QueryManager } from './QueryManager';\nimport { System, SystemType } from './System';\nimport { SystemManager } from './SystemManager';\n\n/**\n * The World is a self-contained entity component system for a particular context.\n */\nexport class World<ContextType> {\n  public queryManager: QueryManager = new QueryManager(this);\n  public entityManager: EntityManager = new EntityManager(this);\n  public systemManager: SystemManager<ContextType> = new SystemManager<ContextType>(this);\n\n  /**\n   * The context type is passed to the system updates\n   * @param context\n   */\n  constructor(public context: ContextType) {}\n\n  /**\n   * Update systems by type and time elapsed in milliseconds\n   */\n  update(type: SystemType, delta: number) {\n    this.systemManager.updateSystems(type, this.context, delta);\n    this.entityManager.processComponentRemovals();\n  }\n\n  /**\n   * Add an entity to the ECS world\n   * @param entity\n   */\n  add(entity: Entity): void;\n  /**\n   * Add a system to the ECS world\n   * @param system\n   */\n  add(system: System<any, ContextType>): void;\n  add(entityOrSystem: Entity | System<any, ContextType>): void {\n    if (entityOrSystem instanceof Entity) {\n      this.entityManager.addEntity(entityOrSystem);\n    }\n\n    if (entityOrSystem instanceof System) {\n      this.systemManager.addSystem(entityOrSystem);\n    }\n  }\n\n  /**\n   * Remove an entity from the ECS world\n   * @param entity\n   */\n  remove(entity: Entity): void;\n  /**\n   * Remove a system from the ECS world\n   * @param system\n   */\n  remove(system: System<any, ContextType>): void;\n  remove(entityOrSystem: Entity | System<any, ContextType>): void {\n    if (entityOrSystem instanceof Entity) {\n      this.entityManager.removeEntity(entityOrSystem);\n    }\n\n    if (entityOrSystem instanceof System) {\n      this.systemManager.removeSystem(entityOrSystem);\n    }\n  }\n\n  clearEntities(): void {\n    this.entityManager.clear();\n  }\n\n  clearSystems(): void {\n    this.systemManager.clear();\n  }\n}\n","import { Logger } from './../Util/Log';\nimport { PostProcessor } from './PostProcessor';\nimport { Engine } from '../Engine';\n\nexport enum ColorBlindness {\n  Protanope,\n  Deuteranope,\n  Tritanope\n}\n\n/**\n * This post processor can correct colors and simulate color blindness.\n * It is possible to use this on every game, but the game's performance\n * will suffer measurably. It's better to use it as a helpful tool while developing your game.\n * Remember, the best practice is to design with color blindness in mind.\n */\nexport class ColorBlindCorrector implements PostProcessor {\n  /*eslint-disable */\n  private _vertexShader =\n    '' +\n    'attribute vec2 a_position;' +\n    'attribute vec2 a_texCoord;' +\n    'uniform vec2 u_resolution;' +\n    'varying vec2 v_texCoord;' +\n    'void main() {' +\n    // convert the rectangle from pixels to 0.0 to 1.0\n    'vec2 zeroToOne = a_position / u_resolution;' +\n    // convert from 0->1 to 0->2\n    'vec2 zeroToTwo = zeroToOne * 2.0;' +\n    // convert from 0->2 to -1->+1 (clipspace)\n    'vec2 clipSpace = zeroToTwo - 1.0;' +\n    'gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);' +\n    // pass the texCoord to the fragment shader\n    // The GPU will interpolate this value between points.\n    'v_texCoord = a_texCoord;' +\n    '}';\n\n  private _fragmentShader =\n    'precision mediump float;' +\n    // our texture\n    'uniform sampler2D u_image;' +\n    // the texCoords passed in from the vertex shader.\n    'varying vec2 v_texCoord;' +\n    // Color blind conversions\n    /*'mat3 m[9] =' +\n   '{' +\n      'mat3(1.0, 0.0, 0.0,  0.0, 1.0, 0.0,  0.0, 0.0, 1.0  ),' + // normal\n      'mat3(0.567, 0.433, 0.0,  0.558, 0.442, 0.0,  0.0, 0.242, 0.758),' + // protanopia\n      'mat3(0.817, 0.183, 0.0,  0.333, 0.667, 0.0,  0.0, 0.125,0.875),' + // protanomaly\n      'mat3(0.625, 0.375, 0.0,  0.7, 0.3, 0.0,  0.0, 0.3,0.7  ),' + // deuteranopia\n      'mat3(0.8, 0.2, 0.0,  0.258, 0.742, 0.0,  0.0, 0.142,0.858),' + // deuteranomaly\n      'mat3(0.95, 0.05, 0.0,  0.0, 0.433, 0.567,  0.0, 0.475,0.525),' + // tritanopia\n      'mat3(0.967, 0.033, 0.0,  0.0, 0.733, 0.267,  0.0, 0.183,0.817),' + // tritanomaly\n      'mat3(0.299, 0.587, 0.114,  0.299, 0.587, 0.114,  0.299, 0.587,0.114),' + // achromatopsia\n      'mat3(0.618, 0.320, 0.062,  0.163, 0.775, 0.062,  0.163, 0.320,0.516)' +  // achromatomaly\n   '};' +*/\n\n    'void main() {' +\n    'vec4 o =  texture2D(u_image, v_texCoord);' +\n    // RGB to LMS matrix conversion\n    'float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);' +\n    'float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);' +\n    'float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);' +\n    // Simulate color blindness\n\n    '//MODE CODE//' +\n    /* Deuteranope for testing\n      'float l = 1.0 * L + 0.0 * M + 0.0 * S;' +\n            'float m = 0.494207 * L + 0.0 * M + 1.24827 * S;' +\n            'float s = 0.0 * L + 0.0 * M + 1.0 * S;' +*/\n\n    // LMS to RGB matrix conversion\n    'vec4 error;' +\n    'error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);' +\n    'error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);' +\n    'error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);' +\n    'error.a = 1.0;' +\n    'vec4 diff = o - error;' +\n    'vec4 correction;' +\n    'correction.r = 0.0;' +\n    'correction.g =  (diff.r * 0.7) + (diff.g * 1.0);' +\n    'correction.b =  (diff.r * 0.7) + (diff.b * 1.0);' +\n    'correction = o + correction;' +\n    'correction.a = o.a;' +\n    '//SIMULATE//' +\n    '}';\n\n  /*eslint-enable */\n  private _internalCanvas: HTMLCanvasElement;\n  private _gl: WebGLRenderingContext;\n  private _program: WebGLProgram;\n\n  constructor(public engine: Engine, public simulate: boolean = false, public colorMode: ColorBlindness = ColorBlindness.Protanope) {\n    this._internalCanvas = document.createElement('canvas');\n    this._internalCanvas.width = engine.drawWidth;\n    this._internalCanvas.height = engine.drawHeight;\n\n    // eslint-disable-next-line\n    this._gl = <WebGLRenderingContext>this._internalCanvas.getContext('webgl', { preserveDrawingBuffer: true });\n\n    this._program = this._gl.createProgram();\n    const fragmentShader = this._getShader('Fragment', this._getFragmentShaderByMode(colorMode));\n    const vertextShader = this._getShader('Vertex', this._vertexShader);\n\n    this._gl.attachShader(this._program, vertextShader);\n    this._gl.attachShader(this._program, fragmentShader);\n    this._gl.linkProgram(this._program);\n\n    if (!this._gl.getProgramParameter(this._program, this._gl.LINK_STATUS)) {\n      Logger.getInstance().error('Unable to link shader program!');\n    }\n\n    this._gl.useProgram(this._program);\n  }\n\n  private _getFragmentShaderByMode(colorMode: ColorBlindness) {\n    let code = '';\n    if (colorMode === ColorBlindness.Protanope) {\n      code =\n        'float l = 0.0 * L + 2.02344 * M + -2.52581 * S;' +\n        'float m = 0.0 * L + 1.0 * M + 0.0 * S;' +\n        'float s = 0.0 * L + 0.0 * M + 1.0 * S;';\n    } else if (colorMode === ColorBlindness.Deuteranope) {\n      code =\n        'float l = 1.0 * L + 0.0 * M + 0.0 * S;' +\n        'float m = 0.494207 * L + 0.0 * M + 1.24827 * S;' +\n        'float s = 0.0 * L + 0.0 * M + 1.0 * S;';\n    } else if (colorMode === ColorBlindness.Tritanope) {\n      code =\n        'float l = 1.0 * L + 0.0 * M + 0.0 * S;' +\n        'float m = 0.0 * L + 1.0 * M + 0.0 * S;' +\n        'float s = -0.395913 * L + 0.801109 * M + 0.0 * S;';\n    }\n\n    if (this.simulate) {\n      this._fragmentShader = this._fragmentShader.replace('//SIMULATE//', 'gl_FragColor = error.rgba;');\n    } else {\n      this._fragmentShader = this._fragmentShader.replace('//SIMULATE//', 'gl_FragColor = correction.rgba;');\n    }\n\n    return this._fragmentShader.replace('//MODE CODE//', code);\n  }\n\n  private _setRectangle(x: number, y: number, width: number, height: number) {\n    const x1 = x;\n    const x2 = x + width;\n    const y1 = y;\n    const y2 = y + height;\n    this._gl.bufferData(this._gl.ARRAY_BUFFER, new Float32Array([x1, y1, x2, y1, x1, y2, x1, y2, x2, y1, x2, y2]), this._gl.STATIC_DRAW);\n  }\n\n  private _getShader(type: string, program: string): WebGLShader {\n    let shader: WebGLShader;\n    if (type === 'Fragment') {\n      shader = this._gl.createShader(this._gl.FRAGMENT_SHADER);\n    } else if (type === 'Vertex') {\n      shader = this._gl.createShader(this._gl.VERTEX_SHADER);\n    } else {\n      Logger.getInstance().error('Error unknown shader type', type);\n    }\n\n    this._gl.shaderSource(shader, program);\n    this._gl.compileShader(shader);\n\n    if (!this._gl.getShaderParameter(shader, this._gl.COMPILE_STATUS)) {\n      Logger.getInstance().error('Unable to compile shader!', this._gl.getShaderInfoLog(shader));\n      return null;\n    }\n\n    return shader;\n  }\n\n  public process(image: ImageData, out: CanvasRenderingContext2D) {\n    // look up where the vertex data needs to go.\n    const positionLocation = this._gl.getAttribLocation(this._program, 'a_position');\n    const texCoordLocation = this._gl.getAttribLocation(this._program, 'a_texCoord');\n\n    const texCoordBuffer = this._gl.createBuffer();\n    this._gl.bindBuffer(this._gl.ARRAY_BUFFER, texCoordBuffer);\n    this._gl.bufferData(\n      this._gl.ARRAY_BUFFER,\n      new Float32Array([0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0]),\n      this._gl.STATIC_DRAW\n    );\n    this._gl.enableVertexAttribArray(texCoordLocation);\n    this._gl.vertexAttribPointer(texCoordLocation, 2, this._gl.FLOAT, false, 0, 0);\n\n    // Create a texture.\n    const texture = this._gl.createTexture();\n    this._gl.bindTexture(this._gl.TEXTURE_2D, texture);\n\n    // Set the parameters so we can render any size image.\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_S, this._gl.CLAMP_TO_EDGE);\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_T, this._gl.CLAMP_TO_EDGE);\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_MIN_FILTER, this._gl.NEAREST);\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_MAG_FILTER, this._gl.NEAREST);\n    // Flip the texture when unpacking into the gl context, gl reads textures in the opposite order as everything else :/\n    this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL, 1);\n    // Upload the image into the texture.\n    this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, image);\n\n    // lookup uniforms\n    const resolutionLocation = this._gl.getUniformLocation(this._program, 'u_resolution');\n\n    // set the resolution\n    this._gl.uniform2f(resolutionLocation, this._internalCanvas.width, this._internalCanvas.height);\n\n    // Create a buffer for the position of the rectangle corners.\n    const positionBuffer = this._gl.createBuffer();\n    this._gl.bindBuffer(this._gl.ARRAY_BUFFER, positionBuffer);\n    this._gl.enableVertexAttribArray(positionLocation);\n    this._gl.vertexAttribPointer(positionLocation, 2, this._gl.FLOAT, false, 0, 0);\n\n    // Set a rectangle the same size as the image.\n    this._setRectangle(0, 0, image.width, image.height);\n\n    // Draw the rectangle.\n    this._gl.drawArrays(this._gl.TRIANGLES, 0, 6);\n\n    // Grab transformed image from internal canvas\n    const pixelData = new Uint8Array(image.width * image.height * 4);\n    this._gl.readPixels(0, 0, image.width, image.height, this._gl.RGBA, this._gl.UNSIGNED_BYTE, pixelData);\n\n    (<any>image.data).set(pixelData);\n\n    out.putImageData(image, 0, 0);\n  }\n}\n","import { Logger } from '../Util/Log';\nimport { Class } from '../Class';\nimport * as Events from '../Events';\n\n/**\n * Enum representing input key codes\n */\nexport enum Keys {\n  // NUMPAD\n  Num0 = 'Numpad0',\n  Num1 = 'Numpad1',\n  Num2 = 'Numpad2',\n  Num3 = 'Numpad3',\n  Num4 = 'Numpad4',\n  Num5 = 'Numpad5',\n  Num6 = 'Numpad6',\n  Num7 = 'Numpad7',\n  Num8 = 'Numpad8',\n  Num9 = 'Numpad9',\n  NumAdd = 'NumpadAdd',\n  NumSubtract = 'NumpadSubtract',\n  NumMultiply = 'NumpadMultiply',\n  NumDivide = 'NumpadDivide',\n  // NumComma = 'NumpadComma', // not x-browser\n  NumDecimal = 'NumpadDecimal',\n  Numpad0 = 'Numpad0',\n  Numpad1 = 'Numpad1',\n  Numpad2 = 'Numpad2',\n  Numpad3 = 'Numpad3',\n  Numpad4 = 'Numpad4',\n  Numpad5 = 'Numpad5',\n  Numpad6 = 'Numpad6',\n  Numpad7 = 'Numpad7',\n  Numpad8 = 'Numpad8',\n  Numpad9 = 'Numpad9',\n  NumpadAdd = 'NumpadAdd',\n  NumpadSubtract = 'NumpadSubtract',\n  NumpadMultiply = 'NumpadMultiply',\n  NumpadDivide = 'NumpadDivide',\n  // NumpadComma = 'NumpadComma', // not x-browser\n  NumpadDecimal = 'NumpadDecimal',\n\n  // MODIFIERS\n  NumLock = 'NumLock',\n  ShiftLeft = 'ShiftLeft',\n  ShiftRight = 'ShiftRight',\n  AltLeft = 'AltLeft',\n  AltRight = 'AltRight',\n\n  // NUMBERS\n  Key0 = 'Digit0',\n  Key1 = 'Digit1',\n  Key2 = 'Digit2',\n  Key3 = 'Digit3',\n  Key4 = 'Digit4',\n  Key5 = 'Digit5',\n  Key6 = 'Digit6',\n  Key7 = 'Digit7',\n  Key8 = 'Digit8',\n  Key9 = 'Digit9',\n  Digit0 = 'Digit0',\n  Digit1 = 'Digit1',\n  Digit2 = 'Digit2',\n  Digit3 = 'Digit3',\n  Digit4 = 'Digit4',\n  Digit5 = 'Digit5',\n  Digit6 = 'Digit6',\n  Digit7 = 'Digit7',\n  Digit8 = 'Digit8',\n  Digit9 = 'Digit9',\n\n  // LETTERS\n  A = 'KeyA',\n  B = 'KeyB',\n  C = 'KeyC',\n  D = 'KeyD',\n  E = 'KeyE',\n  F = 'KeyF',\n  G = 'KeyG',\n  H = 'KeyH',\n  I = 'KeyI',\n  J = 'KeyJ',\n  K = 'KeyK',\n  L = 'KeyL',\n  M = 'KeyM',\n  N = 'KeyN',\n  O = 'KeyO',\n  P = 'KeyP',\n  Q = 'KeyQ',\n  R = 'KeyR',\n  S = 'KeyS',\n  T = 'KeyT',\n  U = 'KeyU',\n  V = 'KeyV',\n  W = 'KeyW',\n  X = 'KeyX',\n  Y = 'KeyY',\n  Z = 'KeyZ',\n  KeyA = 'KeyA',\n  KeyB = 'KeyB',\n  KeyC = 'KeyC',\n  KeyD = 'KeyD',\n  KeyE = 'KeyE',\n  KeyF = 'KeyF',\n  KeyG = 'KeyG',\n  KeyH = 'KeyH',\n  KeyI = 'KeyI',\n  KeyJ = 'KeyJ',\n  KeyK = 'KeyK',\n  KeyL = 'KeyL',\n  KeyM = 'KeyM',\n  KeyN = 'KeyN',\n  KeyO = 'KeyO',\n  KeyP = 'KeyP',\n  KeyQ = 'KeyQ',\n  KeyR = 'KeyR',\n  KeyS = 'KeyS',\n  KeyT = 'KeyT',\n  KeyU = 'KeyU',\n  KeyV = 'KeyV',\n  KeyW = 'KeyW',\n  KeyX = 'KeyX',\n  KeyY = 'KeyY',\n  KeyZ = 'KeyZ',\n\n  // SYMBOLS\n  Semicolon = 'Semicolon',\n  Quote = 'Quote',\n  Comma = 'Comma',\n  Minus = 'Minus',\n  Period = 'Period',\n  Slash = 'Slash',\n  Equal = 'Equal',\n  BracketLeft = 'BracketLeft',\n  Backslash = 'Backslash',\n  BracketRight = 'BracketRight',\n  Backquote = 'Backquote',\n\n  // DIRECTIONS\n  Up = 'ArrowUp',\n  Down = 'ArrowDown',\n  Left = 'ArrowLeft',\n  Right = 'ArrowRight',\n  ArrowUp = 'ArrowUp',\n  ArrowDown = 'ArrowDown',\n  ArrowLeft = 'ArrowLeft',\n  ArrowRight = 'ArrowRight',\n\n  // OTHER\n  Space = 'Space',\n  Esc = 'Escape',\n  Escape = 'Escape'\n}\n\n/**\n * Event thrown on a game object for a key event\n */\nexport class KeyEvent extends Events.GameEvent<any> {\n  /**\n   * @param key  The key responsible for throwing the event\n   */\n  constructor(public key: Keys) {\n    super();\n  }\n}\n\n/**\n * Provides keyboard support for Excalibur.\n */\nexport class Keyboard extends Class {\n  private _keys: Keys[] = [];\n  private _keysUp: Keys[] = [];\n  private _keysDown: Keys[] = [];\n\n  constructor() {\n    super();\n  }\n\n  public on(eventName: Events.press, handler: (event: KeyEvent) => void): void;\n  public on(eventName: Events.release, handler: (event: KeyEvent) => void): void;\n  public on(eventName: Events.hold, handler: (event: KeyEvent) => void): void;\n  public on(eventName: string, handler: (event: Events.GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  /**\n   * Initialize Keyboard event listeners\n   */\n  init(global?: GlobalEventHandlers): void {\n    if (!global) {\n      try {\n        // Try and listen to events on top window frame if within an iframe.\n        //\n        // See https://github.com/excaliburjs/Excalibur/issues/1294\n        //\n        // Attempt to add an event listener, which triggers a DOMException on\n        // cross-origin iframes\n        const noop = () => {\n          return;\n        };\n        window.top.addEventListener('blur', noop);\n        window.top.removeEventListener('blur', noop);\n\n        // this will be the same as window if not embedded within an iframe\n        global = window.top;\n      } catch {\n        // fallback to current frame\n        global = window;\n\n        Logger.getInstance().warn(\n          'Failed to bind to keyboard events to top frame. ' +\n            'If you are trying to embed Excalibur in a cross-origin iframe, keyboard events will not fire.'\n        );\n      }\n    }\n\n    global.addEventListener('blur', () => {\n      this._keys.length = 0; // empties array efficiently\n    });\n\n    // key up is on window because canvas cannot have focus\n    global.addEventListener('keyup', (ev: KeyboardEvent) => {\n      const code = ev.code as Keys;\n      const key = this._keys.indexOf(code);\n      this._keys.splice(key, 1);\n      this._keysUp.push(code);\n      const keyEvent = new KeyEvent(code);\n\n      // alias the old api, we may want to deprecate this in the future\n      this.eventDispatcher.emit('up', keyEvent);\n      this.eventDispatcher.emit('release', keyEvent);\n    });\n\n    // key down is on window because canvas cannot have focus\n    global.addEventListener('keydown', (ev: KeyboardEvent) => {\n      const code = ev.code as Keys;\n      if (this._keys.indexOf(code) === -1) {\n        this._keys.push(code);\n        this._keysDown.push(code);\n        const keyEvent = new KeyEvent(code);\n        this.eventDispatcher.emit('down', keyEvent);\n        this.eventDispatcher.emit('press', keyEvent);\n      }\n    });\n  }\n\n  public update() {\n    // Reset keysDown and keysUp after update is complete\n    this._keysDown.length = 0;\n    this._keysUp.length = 0;\n\n    // Emit synthetic \"hold\" event\n    for (let i = 0; i < this._keys.length; i++) {\n      this.eventDispatcher.emit('hold', new KeyEvent(this._keys[i]));\n    }\n  }\n\n  /**\n   * Gets list of keys being pressed down\n   */\n  public getKeys(): Keys[] {\n    return this._keys;\n  }\n\n  /**\n   * Tests if a certain key was just pressed this frame. This is cleared at the end of the update frame.\n   * @param key Test whether a key was just pressed\n   */\n  public wasPressed(key: Keys): boolean {\n    return this._keysDown.indexOf(key) > -1;\n  }\n\n  /**\n   * Tests if a certain key is held down. This is persisted between frames.\n   * @param key  Test whether a key is held down\n   */\n  public isHeld(key: Keys): boolean {\n    return this._keys.indexOf(key) > -1;\n  }\n\n  /**\n   * Tests if a certain key was just released this frame. This is cleared at the end of the update frame.\n   * @param key  Test whether a key was just released\n   */\n  public wasReleased(key: Keys): boolean {\n    return this._keysUp.indexOf(key) > -1;\n  }\n}\n","import { Actor } from '../Actor';\nimport { Vector } from '../Algebra';\nimport { Class } from '../Class';\nimport * as Actors from '../Util/Actors';\nimport { removeItemFromArray } from '../Util/Util';\nimport { PointerMoveEvent, PointerDownEvent, PointerUpEvent, WheelEvent } from './PointerEvents';\n\nexport interface ActorsUnderPointer {\n  [ActorId: number]: Actor;\n  length: number;\n}\n\n/**\n * The type of pointer for a [[PointerEvent]].\n */\nexport enum PointerType {\n  Touch = 'Touch',\n  Mouse = 'Mouse',\n  Pen = 'Pen',\n  Unknown = 'Unknown'\n}\n\n/**\n * Determines the scope of handling mouse/touch events. See [[Pointers]] for more information.\n */\nexport enum PointerScope {\n  /**\n   * Handle events on the `canvas` element only. Events originating outside the\n   * `canvas` will not be handled.\n   */\n  Canvas = 'Canvas',\n\n  /**\n   * Handles events on the entire document. All events will be handled by Excalibur.\n   */\n  Document = 'Document'\n}\n\n/**\n * Captures and dispatches PointerEvents\n */\nexport class Pointer extends Class {\n  private static _MAX_ID = 0;\n  public readonly id = Pointer._MAX_ID++;\n  private _isDown: boolean = false;\n  private _wasDown: boolean = false;\n\n  private _actorsUnderPointer: ActorsUnderPointer = { length: 0 };\n\n  private _actors: Actor[] = [];\n  private _actorsLastFrame: Actor[] = [];\n  private _actorsNoLongerUnderPointer: Actor[] = [];\n\n  /**\n   * Whether the Pointer is currently dragging.\n   */\n  public get isDragging(): boolean {\n    return this._isDown;\n  }\n\n  /**\n   * Whether the Pointer just started dragging.\n   */\n  public get isDragStart(): boolean {\n    return !this._wasDown && this._isDown;\n  }\n\n  /**\n   * Whether the Pointer just ended dragging.\n   */\n  public get isDragEnd(): boolean {\n    return this._wasDown && !this._isDown;\n  }\n\n  /**\n   * Returns true if pointer has any actors under\n   */\n  public get hasActorsUnderPointer(): boolean {\n    return !!this._actorsUnderPointer.length;\n  }\n\n  /**\n   * The last position on the document this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastPagePos: Vector = null;\n\n  /**\n   * The last position on the screen this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastScreenPos: Vector = null;\n\n  /**\n   * The last position in the game world coordinates this pointer was at. Can be `null` if pointer was never active.\n   */\n  public lastWorldPos: Vector = null;\n\n  /**\n   * Returns the currently dragging target or null if it isn't exist\n   */\n  public dragTarget: Actor = null;\n\n  constructor() {\n    super();\n\n    this.on('move', this._onPointerMove);\n    this.on('down', this._onPointerDown);\n    this.on('up', this._onPointerUp);\n  }\n\n  on(event: 'move', handler: (event: PointerMoveEvent) => void): void;\n  on(event: 'down', handler: (event: PointerDownEvent) => void): void;\n  on(event: 'up', handler: (event: PointerUpEvent) => void): void;\n  on(event: 'wheel', handler: (event: WheelEvent) => void): void;\n  on(event: string, handler: (event: any) => void): void {\n    super.on(event, handler);\n  }\n\n  once(event: 'move', handler: (event: PointerMoveEvent) => void): void;\n  once(event: 'down', handler: (event: PointerDownEvent) => void): void;\n  once(event: 'up', handler: (event: PointerUpEvent) => void): void;\n  once(event: 'wheel', handler: (event: WheelEvent) => void): void;\n  once(event: string, handler: (event: any) => void): void {\n    super.once(event, handler);\n  }\n\n  off(event: 'move', handler?: (event: PointerMoveEvent) => void): void;\n  off(event: 'down', handler?: (event: PointerDownEvent) => void): void;\n  off(event: 'up', handler?: (event: PointerUpEvent) => void): void;\n  off(event: 'wheel', handler?: (event: WheelEvent) => void): void;\n  off(event: string, handler?: (event: any) => void): void {\n    super.off(event, handler);\n  }\n\n  /**\n   * Update the state of current pointer, meant to be called a the end of frame\n   */\n  public update(): void {\n    if (this._wasDown && !this._isDown) {\n      this._wasDown = false;\n    } else if (!this._wasDown && this._isDown) {\n      this._wasDown = true;\n    }\n    this._actorsLastFrame = [...this._actors];\n    this._actorsNoLongerUnderPointer = [];\n  }\n\n  /**\n   * Adds an Actor to actorsUnderPointer object.\n   * @param actor An Actor to be added;\n   */\n  public addActorUnderPointer(actor: Actor): void {\n    if (!this.isActorAliveUnderPointer(actor)) {\n      this._actorsUnderPointer[actor.id] = actor;\n      this._actorsUnderPointer.length += 1;\n      this._actors.push(actor);\n    }\n\n    // Actors under the pointer are sorted by z, ties are broken by id\n    this._actors.sort((a, b) => {\n      if (a.z === b.z) {\n        return a.id - b.id;\n      }\n      return a.z - b.z;\n    });\n  }\n\n  /**\n   * Removes an Actor from actorsUnderPointer object.\n   * @param actor An Actor to be removed;\n   */\n  public removeActorUnderPointer(actor: Actor): void {\n    if (this.isActorAliveUnderPointer(actor)) {\n      delete this._actorsUnderPointer[actor.id];\n      this._actorsUnderPointer.length -= 1;\n      removeItemFromArray(actor, this._actors);\n      this._actorsNoLongerUnderPointer.push(actor);\n    }\n  }\n\n  /**\n   * Returns all actors under this pointer this frame\n   */\n  public getActorsUnderPointer(): Actor[] {\n    return this._actors;\n  }\n\n  /**\n   * Returns all actors that are no longer under the pointer this frame\n   */\n  public getActorsUnderPointerLastFrame(): Actor[] {\n    return this._actorsLastFrame;\n  }\n\n  /**\n   * Returns all actors relevant for events to pointer this frame\n   */\n  public getActorsForEvents(): Actor[] {\n    return this._actors.concat(this._actorsLastFrame).filter((actor, i, self) => {\n      return self.indexOf(actor) === i;\n    });\n  }\n\n  /**\n   * Checks if Pointer location has a specific Actor bounds contained underneath.\n   * @param actor An Actor for check;\n   */\n  public checkActorUnderPointer(actor: Actor): boolean {\n    if (this.lastWorldPos) {\n      return actor.contains(this.lastWorldPos.x, this.lastWorldPos.y, !Actors.isScreenElement(actor));\n    }\n    return false;\n  }\n\n  /**\n   * Checks if an actor was under the pointer last frame\n   * @param actor\n   */\n  public wasActorUnderPointer(actor: Actor): boolean {\n    return this._actorsLastFrame.indexOf(actor) > -1; // || !!this._actorsUnderPointerLastFrame.hasOwnProperty(actor.id.toString());\n  }\n\n  /**\n   * Checks if Pointer has a specific Actor in ActorsUnderPointer list.\n   * @param actor An Actor for check;\n   */\n  public isActorAliveUnderPointer(actor: Actor): boolean {\n    return !!(!actor.isKilled() && actor.scene && this._actorsUnderPointer.hasOwnProperty(actor.id.toString()));\n  }\n\n  private _onPointerMove(ev: PointerMoveEvent): void {\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\n  }\n\n  private _onPointerDown(ev: PointerDownEvent): void {\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\n    this._isDown = true;\n  }\n\n  private _onPointerUp(_ev: PointerUpEvent): void {\n    this._isDown = false;\n    this.dragTarget = null;\n  }\n}\n","import { Actor } from '../Actor';\nimport { Vector, GlobalCoordinates } from '../Algebra';\nimport { Pointer, PointerType } from './Pointer';\nimport { GameEvent } from '../Events';\n\n/**\n * Native browser button enumeration\n */\nexport enum NativePointerButton {\n  NoButton = -1,\n  Left = 0,\n  Middle = 1,\n  Right = 2,\n  Unknown = 3\n}\n\n/**\n * The mouse button being pressed.\n */\nexport enum PointerButton {\n  Left = 'Left',\n  Middle = 'Middle',\n  Right = 'Right',\n  Unknown = 'Unknown',\n  NoButton = 'NoButton'\n}\n\nexport enum WheelDeltaMode {\n  Pixel = 'Pixel',\n  Line = 'Line',\n  Page = 'Page'\n}\n\n/**\n * Type that indicates Excalibur's valid synthetic pointer events\n */\nexport type PointerEventName =\n  | 'pointerdragstart'\n  | 'pointerdragend'\n  | 'pointerdragmove'\n  | 'pointerdragenter'\n  | 'pointerdragleave'\n  | 'pointermove'\n  | 'pointerenter'\n  | 'pointerleave'\n  | 'pointerup'\n  | 'pointerdown';\n\n/**\n * Pointer events\n *\n * Represents a mouse, touch, or stylus event. See [[Pointers]] for more information on\n * handling pointer input.\n *\n * For mouse-based events, you can inspect [[PointerEvent.button]] to see what button was pressed.\n */\nexport class PointerEvent extends GameEvent<Actor> {\n  protected _name: string;\n\n  public get name() {\n    return this._name;\n  }\n\n  /** The world coordinates of the event. */\n  public get worldPos(): Vector {\n    return this.coordinates.worldPos.clone();\n  }\n\n  /** The page coordinates of the event. */\n  public get pagePos(): Vector {\n    return this.coordinates.pagePos.clone();\n  }\n\n  /** The screen coordinates of the event. */\n  public get screenPos(): Vector {\n    return this.coordinates.screenPos.clone();\n  }\n\n  /**\n   * @param coordinates         The [[GlobalCoordinates]] of the event\n   * @param pointer             The [[Pointer]] of the event\n   * @param index               The index of the pointer (zero-based)\n   * @param pointerType         The type of pointer\n   * @param button              The button pressed (if [[PointerType.Mouse]])\n   * @param ev                  The raw DOM event being handled\n   */\n  constructor(\n    protected coordinates: GlobalCoordinates,\n    public pointer: Pointer,\n    public index: number,\n    public pointerType: PointerType,\n    public button: PointerButton,\n    public ev: any\n  ) {\n    super();\n  }\n\n  public get pos(): Vector {\n    return this.coordinates.worldPos.clone();\n  }\n\n  public propagate(actor: Actor): void {\n    this.doAction(actor);\n\n    if (this.bubbles && actor.parent) {\n      this.propagate(actor.parent);\n    }\n  }\n\n  /**\n   * Action, that calls when event happens\n   */\n  public doAction(actor: Actor): void {\n    if (actor) {\n      this._onActionStart(actor);\n      actor.emit(this._name, this);\n      this._onActionEnd(actor);\n    }\n  }\n\n  protected _onActionStart(_actor?: Actor) {\n    // to be rewritten\n  }\n\n  protected _onActionEnd(_actor?: Actor) {\n    // to be rewritten\n  }\n}\n\nexport class PointerEventFactory<T extends PointerEvent> {\n  constructor(\n    protected _pointerEventType: new (\n      coordinates: GlobalCoordinates,\n      pointer: Pointer,\n      index: number,\n      pointerType: PointerType,\n      button: PointerButton,\n      ev: any\n    ) => T\n  ) {}\n\n  /**\n   * Create specific PointerEvent\n   */\n  public create(\n    coordinates: GlobalCoordinates,\n    pointer: Pointer,\n    index: number,\n    pointerType: PointerType,\n    button: PointerButton,\n    ev: any\n  ): T {\n    return new this._pointerEventType(coordinates, pointer, index, pointerType, button, ev);\n  }\n}\n\nexport class PointerDragEvent extends PointerEvent {}\n\nexport class PointerUpEvent extends PointerEvent {\n  protected _name = 'pointerup';\n\n  protected _onActionEnd(actor: Actor) {\n    const pointer = this.pointer;\n\n    if (pointer.isDragEnd && actor.capturePointer.captureDragEvents) {\n      actor.eventDispatcher.emit('pointerdragend', this);\n    }\n  }\n}\n\nexport class PointerDownEvent extends PointerEvent {\n  protected _name = 'pointerdown';\n\n  protected _onActionEnd(actor: Actor) {\n    if (this.pointer.isDragStart && actor.capturePointer.captureDragEvents) {\n      actor.eventDispatcher.emit('pointerdragstart', this);\n    }\n  }\n}\n\nexport class PointerMoveEvent extends PointerEvent {\n  protected _name = 'pointermove';\n\n  public propagate(actor: Actor): void {\n    // If the actor was under the pointer last frame, but not this one it left\n    // if (this.pointer.wasActorUnderPointer(actor) && !this.pointer.isActorUnderPointer(actor)) {\n    //   this._onActorLeave(actor);\n    //   return;\n    // }\n\n    if (this.pointer.isActorAliveUnderPointer(actor)) {\n      this.doAction(actor);\n\n      if (this.bubbles && actor.parent) {\n        this.propagate(actor.parent);\n      }\n    }\n  }\n\n  protected _onActionStart(actor: Actor) {\n    if (!actor.capturePointer.captureMoveEvents) {\n      return;\n    }\n\n    // In the case this is new\n    // if (this.pointer.checkActorUnderPointer(actor) && !this.pointer.wasActorUnderPointer(actor)) {\n    //   this._onActorEnter(actor);\n    // }\n\n    if (this.pointer.isDragging && actor.capturePointer.captureDragEvents) {\n      actor.eventDispatcher.emit('pointerdragmove', this);\n    }\n  }\n\n  // private _onActorEnter(actor: Actor) {\n  //   const pe = createPointerEventByName('enter', this.coordinates, this.pointer, this.index, this.pointerType, this.button, this.ev);\n  //   pe.propagate(actor);\n  //   this.pointer.addActorUnderPointer(actor);\n\n  //   if (this.pointer.isDragging) {\n  //     this.pointer.dragTarget = actor;\n  //   }\n  // }\n\n  // private _onActorLeave(actor: Actor) {\n  //   const pe = createPointerEventByName('leave', this.coordinates, this.pointer, this.index, this.pointerType, this.button, this.ev);\n  //   pe.propagate(actor);\n  //   this.pointer.removeActorUnderPointer(actor);\n  // }\n}\n\nexport class PointerEnterEvent extends PointerEvent {\n  protected _name = 'pointerenter';\n\n  protected _onActionStart(actor: Actor) {\n    if (!actor.capturePointer.captureMoveEvents) {\n      return;\n    }\n  }\n\n  protected _onActionEnd(actor: Actor) {\n    const pointer = this.pointer;\n\n    if (pointer.isDragging && actor.capturePointer.captureDragEvents) {\n      actor.eventDispatcher.emit('pointerdragenter', this);\n    }\n  }\n}\n\nexport class PointerLeaveEvent extends PointerEvent {\n  protected _name = 'pointerleave';\n\n  protected _onActionStart(actor: Actor) {\n    if (!actor.capturePointer.captureMoveEvents) {\n      return;\n    }\n  }\n\n  protected _onActionEnd(actor: Actor) {\n    const pointer = this.pointer;\n\n    if (pointer.isDragging && actor.capturePointer.captureDragEvents) {\n      actor.eventDispatcher.emit('pointerdragleave', this);\n    }\n  }\n}\n\nexport class PointerCancelEvent extends PointerEvent {\n  protected _name = 'pointercancel';\n}\n/**\n * Wheel Events\n *\n * Represents a mouse wheel event. See [[Pointers]] for more information on\n * handling point input.\n */\nexport class WheelEvent extends GameEvent<Actor> {\n  /**\n   * @param x            The `x` coordinate of the event (in world coordinates)\n   * @param y            The `y` coordinate of the event (in world coordinates)\n   * @param pageX        The `x` coordinate of the event (in document coordinates)\n   * @param pageY        The `y` coordinate of the event (in document coordinates)\n   * @param screenX      The `x` coordinate of the event (in screen coordinates)\n   * @param screenY      The `y` coordinate of the event (in screen coordinates)\n   * @param index        The index of the pointer (zero-based)\n   * @param deltaX       The type of pointer\n   * @param deltaY       The type of pointer\n   * @param deltaZ       The type of pointer\n   * @param deltaMode    The type of movement [[WheelDeltaMode]]\n   * @param ev           The raw DOM event being handled\n   */\n  constructor(\n    public x: number,\n    public y: number,\n    public pageX: number,\n    public pageY: number,\n    public screenX: number,\n    public screenY: number,\n    public index: number,\n    public deltaX: number,\n    public deltaY: number,\n    public deltaZ: number,\n    public deltaMode: WheelDeltaMode,\n    public ev: any\n  ) {\n    super();\n  }\n}\n\n/**\n *\n */\nexport function createPointerEventByName(\n  eventName: string,\n  coordinates: GlobalCoordinates,\n  pointer: Pointer,\n  index: number,\n  pointerType: PointerType,\n  button: PointerButton,\n  ev: any\n) {\n  let factory: PointerEventFactory<PointerEvent>;\n\n  switch (eventName) {\n    case 'up':\n      factory = new PointerEventFactory(<any>PointerUpEvent);\n      break;\n    case 'down':\n      factory = new PointerEventFactory(<any>PointerDownEvent);\n      break;\n    case 'move':\n      factory = new PointerEventFactory(<any>PointerMoveEvent);\n      break;\n    case 'cancel':\n      factory = new PointerEventFactory(<any>PointerCancelEvent);\n      break;\n    case 'enter':\n      factory = new PointerEventFactory(<any>PointerEnterEvent);\n      break;\n    case 'leave':\n      factory = new PointerEventFactory(<any>PointerLeaveEvent);\n      break;\n  }\n\n  return factory.create(coordinates, pointer, index, pointerType, button, ev);\n}\n","import { ScreenElement } from './ScreenElement';\nimport { Physics } from './Physics';\nimport {\n  InitializeEvent,\n  ActivateEvent,\n  DeactivateEvent,\n  PreUpdateEvent,\n  PostUpdateEvent,\n  PreDrawEvent,\n  PostDrawEvent,\n  PreDebugDrawEvent,\n  PostDebugDrawEvent,\n  GameEvent\n} from './Events';\nimport { Logger } from './Util/Log';\nimport { Timer } from './Timer';\nimport { DynamicTreeCollisionBroadphase } from './Collision/DynamicTreeCollisionBroadphase';\nimport { CollisionBroadphase } from './Collision/CollisionResolver';\nimport { Engine } from './Engine';\nimport { TileMap } from './TileMap';\nimport { Camera } from './Camera';\nimport { Actor } from './Actor';\nimport { Class } from './Class';\nimport { CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw } from './Interfaces/LifecycleEvents';\nimport * as Util from './Util/Util';\nimport * as Events from './Events';\nimport * as ActorUtils from './Util/Actors';\nimport { Trigger } from './Trigger';\nimport { Body } from './Collision/Body';\nimport { SystemType } from './EntityComponentSystem/System';\nimport { CanvasDrawingSystem } from './Drawing/CanvasDrawingSystem';\nimport { obsolete } from './Util/Decorators';\nimport { World } from './EntityComponentSystem/World';\n/**\n * [[Actor|Actors]] are composed together into groupings called Scenes in\n * Excalibur. The metaphor models the same idea behind real world\n * actors in a scene. Only actors in scenes will be updated and drawn.\n *\n * Typical usages of a scene include: levels, menus, loading screens, etc.\n */\nexport class Scene extends Class implements CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw {\n  /**\n   * Gets or sets the current camera for the scene\n   */\n  public camera: Camera;\n\n  /**\n   * The actors in the current scene\n   */\n  public actors: Actor[] = [];\n\n  /**\n   * The ECS world for the scene\n   */\n  public world = new World(this);\n\n  /**\n   * Physics bodies in the current scene\n   */\n  private _bodies: Body[] = [];\n\n  /**\n   * The triggers in the current scene\n   */\n  public triggers: Trigger[] = [];\n\n  /**\n   * The [[TileMap]]s in the scene, if any\n   */\n  public tileMaps: TileMap[] = [];\n\n  /**\n   * Access to the Excalibur engine\n   */\n  public engine: Engine;\n\n  /**\n   * The [[ScreenElement]]s in a scene, if any; these are drawn last\n   * @deprecated\n   */\n  @obsolete({\n    message: 'Will be removed in excalibur v0.26.0',\n    alternateMethod: 'ScreenElements now are normal actors with a Transform Coordinate Plane of Screen'\n  })\n  public get screenElements(): ScreenElement[] {\n    return this.actors.filter((a) => a instanceof ScreenElement) as ScreenElement[];\n  }\n\n  private _isInitialized: boolean = false;\n\n  private _broadphase: CollisionBroadphase = new DynamicTreeCollisionBroadphase();\n\n  private _killQueue: Actor[] = [];\n  private _triggerKillQueue: Trigger[] = [];\n  private _timers: Timer[] = [];\n  private _cancelQueue: Timer[] = [];\n  private _logger: Logger = Logger.getInstance();\n\n  constructor(_engine?: Engine) {\n    super();\n    this.camera = new Camera();\n    if (_engine) {\n      this.engine = _engine;\n      this.camera.x = this.engine.halfDrawWidth;\n      this.camera.y = this.engine.halfDrawHeight;\n    }\n  }\n\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent<Scene>) => void): void;\n  public on(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\n  public on(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Scene>) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Scene>) => void): void;\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent<Scene>) => void): void;\n  public once(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\n  public once(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Scene>) => void): void;\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Scene>) => void): void;\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public off(eventName: Events.initialize, handler?: (event: InitializeEvent<Scene>) => void): void;\n  public off(eventName: Events.activate, handler?: (event: ActivateEvent) => void): void;\n  public off(eventName: Events.deactivate, handler?: (event: DeactivateEvent) => void): void;\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent<Scene>) => void): void;\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent<Scene>) => void): void;\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\n  public off(eventName: Events.predebugdraw, handler?: (event: PreDebugDrawEvent) => void): void;\n  public off(eventName: Events.postdebugdraw, handler?: (event: PostDebugDrawEvent) => void): void;\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\n  public off(eventName: string, handler?: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  /**\n   * This is called before the first update of the [[Scene]]. Initializes scene members like the camera. This method is meant to be\n   * overridden. This is where initialization of child actors should take place.\n   */\n  public onInitialize(_engine: Engine): void {\n    // will be overridden\n  }\n\n  /**\n   * This is called when the scene is made active and started. It is meant to be overridden,\n   * this is where you should setup any DOM UI or event handlers needed for the scene.\n   */\n  public onActivate(_oldScene: Scene, _newScene: Scene): void {\n    // will be overridden\n  }\n\n  /**\n   * This is called when the scene is made transitioned away from and stopped. It is meant to be overridden,\n   * this is where you should cleanup any DOM UI or event handlers needed for the scene.\n   */\n  public onDeactivate(_oldScene: Scene, _newScene: Scene): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreUpdate` is called directly before a scene is updated.\n   */\n  public onPreUpdate(_engine: Engine, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostUpdate` is called directly after a scene is updated.\n   */\n  public onPostUpdate(_engine: Engine, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPreDraw` is called directly before a scene is drawn.\n   */\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\n   *\n   * `onPostDraw` is called directly after a scene is drawn.\n   */\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    // will be overridden\n  }\n\n  /**\n   * Initializes actors in the scene\n   */\n  private _initializeChildren(): void {\n    for (const child of this.actors) {\n      child._initialize(this.engine);\n    }\n  }\n\n  /**\n   * Gets whether or not the [[Scene]] has been initialized\n   */\n  public get isInitialized(): boolean {\n    return this._isInitialized;\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Initializes the scene before the first update, meant to be called by engine not by users of\n   * Excalibur\n   * @internal\n   */\n  public _initialize(engine: Engine) {\n    if (!this.isInitialized) {\n      this.engine = engine;\n      if (this.camera) {\n        this.camera.x = engine.halfDrawWidth;\n        this.camera.y = engine.halfDrawHeight;\n      }\n\n      // Initialize systems\n      this.world.add(new CanvasDrawingSystem());\n\n      // This order is important! we want to be sure any custom init that add actors\n      // fire before the actor init\n      this.onInitialize.call(this, engine);\n      this._initializeChildren();\n\n      this._logger.debug('Scene.onInitialize', this, engine);\n      this.eventDispatcher.emit('initialize', new InitializeEvent(engine, this));\n      this._isInitialized = true;\n    }\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Activates the scene with the base behavior, then calls the overridable `onActivate` implementation.\n   * @internal\n   */\n  public _activate(oldScene: Scene, newScene: Scene): void {\n    this._logger.debug('Scene.onActivate', this);\n    this.onActivate(oldScene, newScene);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Deactivates the scene with the base behavior, then calls the overridable `onDeactivate` implementation.\n   * @internal\n   */\n  public _deactivate(oldScene: Scene, newScene: Scene): void {\n    this._logger.debug('Scene.onDeactivate', this);\n    this.onDeactivate(oldScene, newScene);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\n   * @internal\n   */\n  public _preupdate(_engine: Engine, delta: number): void {\n    this.emit('preupdate', new PreUpdateEvent(_engine, delta, this));\n    this.onPreUpdate(_engine, delta);\n  }\n\n  /**\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\n   * @internal\n   */\n  public _postupdate(_engine: Engine, delta: number): void {\n    this.emit('postupdate', new PostUpdateEvent(_engine, delta, this));\n    this.onPostUpdate(_engine, delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\n   *\n   * @internal\n   */\n  public _predraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    this.emit('predraw', new PreDrawEvent(_ctx, _delta, this));\n    this.onPreDraw(_ctx, _delta);\n  }\n\n  /**\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\n   *\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\n   *\n   * @internal\n   */\n  public _postdraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\n    this.emit('postdraw', new PostDrawEvent(_ctx, _delta, this));\n    this.onPostDraw(_ctx, _delta);\n  }\n\n  /**\n   * Updates all the actors and timers in the scene. Called by the [[Engine]].\n   * @param engine  Reference to the current Engine\n   * @param delta   The number of milliseconds since the last update\n   */\n  public update(engine: Engine, delta: number) {\n    this._preupdate(engine, delta);\n    this.world.update(SystemType.Update, delta);\n\n    if (this.camera) {\n      this.camera.update(engine, delta);\n    }\n\n    let i: number, len: number;\n    // Remove timers in the cancel queue before updating them\n    for (i = 0, len = this._cancelQueue.length; i < len; i++) {\n      this.removeTimer(this._cancelQueue[i]);\n    }\n    this._cancelQueue.length = 0;\n\n    // Cycle through timers updating timers\n    for (const timer of this._timers) {\n      timer.update(delta);\n    }\n\n    // Cycle through actors updating tile maps\n    for (i = 0, len = this.tileMaps.length; i < len; i++) {\n      this.tileMaps[i].update(engine, delta);\n    }\n\n    // Cycle through actors updating actors\n    for (i = 0, len = this.actors.length; i < len; i++) {\n      this.actors[i].update(engine, delta);\n      this._bodies[i] = this.actors[i].body;\n    }\n\n    // Cycle through triggers updating\n    for (i = 0, len = this.triggers.length; i < len; i++) {\n      this.triggers[i].update(engine, delta);\n    }\n\n    this._collectActorStats(engine);\n\n    engine.input.pointers.dispatchPointerEvents();\n\n    // Run the broadphase and narrowphase\n    if (this._broadphase && Physics.enabled) {\n      const beforeBroadphase = Date.now();\n      this._broadphase.update(this._bodies, delta);\n      let pairs = this._broadphase.broadphase(this._bodies, delta, engine.stats.currFrame);\n      const afterBroadphase = Date.now();\n\n      const beforeNarrowphase = Date.now();\n      let iter: number = Physics.collisionPasses;\n      const collisionDelta = delta / iter;\n      while (iter > 0) {\n        // Run the narrowphase\n        pairs = this._broadphase.narrowphase(pairs, engine.stats.currFrame);\n        // Run collision resolution strategy\n        pairs = this._broadphase.resolve(pairs, collisionDelta, Physics.collisionResolutionStrategy);\n\n        this._broadphase.runCollisionStartEnd(pairs);\n\n        iter--;\n      }\n\n      const afterNarrowphase = Date.now();\n      engine.stats.currFrame.physics.broadphase = afterBroadphase - beforeBroadphase;\n      engine.stats.currFrame.physics.narrowphase = afterNarrowphase - beforeNarrowphase;\n    }\n\n    engine.stats.currFrame.actors.killed = this._killQueue.length + this._triggerKillQueue.length;\n\n    this._processKillQueue(this._killQueue, this.actors);\n    this._processKillQueue(this._triggerKillQueue, this.triggers);\n\n    this._postupdate(engine, delta);\n  }\n\n  private _processKillQueue(killQueue: Actor[], collection: Actor[]) {\n    // Remove actors from scene graph after being killed\n    let actorIndex: number;\n    for (const killed of killQueue) {\n      //don't remove actors that were readded during the same frame they were killed\n      if (killed.isKilled()) {\n        actorIndex = collection.indexOf(killed);\n        if (actorIndex > -1) {\n          collection.splice(actorIndex, 1);\n          this.world.remove(killed);\n          killed.children.forEach((c) => this.world.remove(c));\n        }\n      }\n    }\n    killQueue.length = 0;\n  }\n\n  /**\n   * Draws all the actors in the Scene. Called by the [[Engine]].\n   * @param ctx    The current rendering context\n   * @param delta  The number of milliseconds since the last draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\n    this._predraw(ctx, delta);\n\n    this.world.update(SystemType.Draw, delta);\n\n    this._postdraw(ctx, delta);\n  }\n\n  /**\n   * Draws all the actors' debug information in the Scene. Called by the [[Engine]].\n   * @param ctx  The current rendering context\n   */\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    this.emit('predebugdraw', new PreDebugDrawEvent(ctx, this));\n    this._broadphase.debugDraw(ctx, 20);\n    this.emit('postdebugdraw', new PostDebugDrawEvent(ctx, this));\n  }\n\n  /**\n   * Checks whether an actor is contained in this scene or not\n   */\n  public contains(actor: Actor): boolean {\n    return this.actors.indexOf(actor) > -1;\n  }\n\n  /**\n   * Adds a [[Timer]] to the current [[Scene]].\n   * @param timer  The timer to add to the current [[Scene]].\n   */\n  public add(timer: Timer): void;\n\n  /**\n   * Adds a [[TileMap]] to the [[Scene]], once this is done the [[TileMap]] will be drawn and updated.\n   */\n  public add(tileMap: TileMap): void;\n\n  /**\n   * Adds a [[Trigger]] to the [[Scene]], once this is done the [[Trigger]] will listen for interactions with other actors.\n   * @param trigger\n   */\n  public add(trigger: Trigger): void;\n\n  /**\n   * Adds an actor to the scene, once this is done the [[Actor]] will be drawn and updated.\n   * @param actor  The actor to add to the current scene\n   */\n  public add(actor: Actor): void;\n\n  /**\n   * Adds a [[ScreenElement]] to the scene.\n   * @param screenElement  The ScreenElement to add to the current scene\n   */\n  public add(screenElement: ScreenElement): void;\n  public add(entity: any): void {\n    if (entity instanceof Actor) {\n      entity.unkill();\n    }\n    if (entity instanceof Actor) {\n      if (!Util.contains(this.actors, entity)) {\n        this._broadphase.track(entity.body);\n        entity.scene = this;\n        if (entity instanceof Trigger) {\n          this.triggers.push(entity);\n        } else {\n          this.actors.push(entity);\n        }\n\n        this.world.add(entity);\n        entity.children.forEach((c) => this.world.add(c));\n      }\n      return;\n    }\n    if (entity instanceof Timer) {\n      if (!Util.contains(this._timers, entity)) {\n        this.addTimer(entity);\n      }\n      return;\n    }\n    if (entity instanceof TileMap) {\n      if (!Util.contains(this.tileMaps, entity)) {\n        this.addTileMap(entity);\n      }\n    }\n  }\n\n  /**\n   * Removes a [[Timer]] from the current scene, it will no longer be updated.\n   * @param timer  The timer to remove to the current scene.\n   */\n  public remove(timer: Timer): void;\n\n  /**\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\n   * @param tileMap {TileMap}\n   */\n  public remove(tileMap: TileMap): void;\n\n  /**\n   * Removes an actor from the scene, it will no longer be drawn or updated.\n   * @param actor  The actor to remove from the current scene.\n   */\n  public remove(actor: Actor): void;\n\n  /**\n   * Removes a [[ScreenElement]] to the scene, it will no longer be drawn or updated\n   * @param screenElement  The ScreenElement to remove from the current scene\n   */\n  public remove(screenElement: ScreenElement): void;\n  public remove(entity: any): void {\n    if (entity instanceof Actor) {\n      if (!Util.contains(this.actors, entity)) {\n        return;\n      }\n      this._broadphase.untrack(entity.body);\n      if (entity instanceof Trigger) {\n        this._triggerKillQueue.push(entity);\n      } else {\n        if (!entity.isKilled()) {\n          entity.kill();\n        }\n        this._killQueue.push(entity);\n      }\n\n      entity.parent = null;\n    }\n    if (entity instanceof Timer) {\n      this.removeTimer(entity);\n    }\n    if (entity instanceof TileMap) {\n      this.removeTileMap(entity);\n    }\n  }\n\n  /**\n   * Adds (any) actor to act as a piece of UI, meaning it is always positioned\n   * in screen coordinates. UI actors do not participate in collisions.\n   * @todo Should this be `ScreenElement` only?\n   * @deprecated\n   */\n  @obsolete({message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.add'})\n  public addScreenElement(actor: Actor) {\n    this.add(actor);\n  }\n\n  /**\n   * Removes an actor as a piece of UI\n   * @deprecated\n   */\n  @obsolete({message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.remove'})\n  public removeScreenElement(actor: Actor) {\n    this.remove(actor);\n  }\n\n  /**\n   * Adds a [[TileMap]] to the scene, once this is done the TileMap will be drawn and updated.\n   * @deprecated\n   */\n  @obsolete({message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.add'})\n  public addTileMap(tileMap: TileMap) {\n    this.tileMaps.push(tileMap);\n    this.world.add(tileMap);\n  }\n\n  /**\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\n   * @deprecated\n   */\n  @obsolete({message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.remove'})\n  public removeTileMap(tileMap: TileMap) {\n    const index = this.tileMaps.indexOf(tileMap);\n    if (index > -1) {\n      this.tileMaps.splice(index, 1);\n      this.world.remove(tileMap);\n    }\n  }\n\n  /**\n   * Adds a [[Timer]] to the scene\n   * @param timer  The timer to add\n   */\n  public addTimer(timer: Timer): Timer {\n    this._timers.push(timer);\n    timer.scene = this;\n    return timer;\n  }\n\n  /**\n   * Removes a [[Timer]] from the scene.\n   * @warning Can be dangerous, use [[cancelTimer]] instead\n   * @param timer  The timer to remove\n   */\n  public removeTimer(timer: Timer): Timer {\n    const i = this._timers.indexOf(timer);\n    if (i !== -1) {\n      this._timers.splice(i, 1);\n    }\n    return timer;\n  }\n\n  /**\n   * Cancels a [[Timer]], removing it from the scene nicely\n   * @param timer  The timer to cancel\n   */\n  public cancelTimer(timer: Timer): Timer {\n    this._cancelQueue.push(timer);\n    return timer;\n  }\n\n  /**\n   * Tests whether a [[Timer]] is active in the scene\n   */\n  public isTimerActive(timer: Timer): boolean {\n    return this._timers.indexOf(timer) > -1 && !timer.complete;\n  }\n\n  public isCurrentScene(): boolean {\n    if (this.engine) {\n      return this.engine.currentScene === this;\n    }\n    return false;\n  }\n\n  private _collectActorStats(engine: Engine) {\n    for (const _ui of this.screenElements) {\n      engine.stats.currFrame.actors.ui++;\n    }\n\n    for (const actor of this.actors) {\n      engine.stats.currFrame.actors.alive++;\n      for (const child of actor.children) {\n        if (ActorUtils.isScreenElement(child)) {\n          engine.stats.currFrame.actors.ui++;\n        } else {\n          engine.stats.currFrame.actors.alive++;\n        }\n      }\n    }\n  }\n}\n","import { Engine } from './Engine';\nimport { ColorBlindCorrector, ColorBlindness } from './PostProcessing/Index';\n\nexport interface DebugFlags {\n  colorBlindMode: ColorBlindFlags;\n}\n\nexport class ColorBlindFlags {\n  private _engine: Engine;\n\n  constructor(engine: Engine) {\n    this._engine = engine;\n  }\n\n  public correct(colorBlindness: ColorBlindness) {\n    this._engine.postProcessors.push(new ColorBlindCorrector(this._engine, false, colorBlindness));\n  }\n\n  public simulate(colorBlindness: ColorBlindness) {\n    this._engine.postProcessors.push(new ColorBlindCorrector(this._engine, true, colorBlindness));\n  }\n}\n","import { DebugFlags, ColorBlindFlags } from './DebugFlags';\nimport { Pair } from './Collision/Pair';\nimport { Engine } from './Engine';\n\n/**\n * Debug stats containing current and previous frame statistics\n */\nexport interface DebugStats {\n  currFrame: FrameStats;\n  prevFrame: FrameStats;\n}\n\n/**\n * Hash containing the [[Pair.id]]s of pairs that collided in a frame\n */\nexport interface CollidersHash {\n  [pairId: string]: Pair;\n}\n\n/**\n * Represents a frame's individual statistics\n */\nexport interface FrameStatistics {\n  /**\n   * The number of the frame\n   */\n  id: number;\n\n  /**\n   * Gets the frame's delta (time since last frame scaled by [[Engine.timescale]]) (in ms)\n   */\n  delta: number;\n\n  /**\n   * Gets the frame's frames-per-second (FPS)\n   */\n  fps: number;\n\n  /**\n   * Duration statistics (in ms)\n   */\n  duration: FrameDurationStats;\n\n  /**\n   * Actor statistics\n   */\n  actors: FrameActorStats;\n\n  /**\n   * Physics statistics\n   */\n  physics: PhysicsStatistics;\n}\n\n/**\n * Represents actor stats for a frame\n */\nexport interface FrameActorStats {\n  /**\n   * Gets the frame's number of actors (alive)\n   */\n  alive: number;\n\n  /**\n   * Gets the frame's number of actors (killed)\n   */\n  killed: number;\n\n  /**\n   * Gets the frame's number of remaining actors (alive - killed)\n   */\n  remaining: number;\n\n  /**\n   * Gets the frame's number of UI actors\n   */\n  ui: number;\n\n  /**\n   * Gets the frame's number of total actors (remaining + UI)\n   */\n  total: number;\n}\n\n/**\n * Represents duration stats for a frame\n */\nexport interface FrameDurationStats {\n  /**\n   * Gets the frame's total time to run the update function (in ms)\n   */\n  update: number;\n\n  /**\n   * Gets the frame's total time to run the draw function (in ms)\n   */\n  draw: number;\n\n  /**\n   * Gets the frame's total render duration (update + draw duration) (in ms)\n   */\n  total: number;\n}\n\n/**\n * Represents physics stats for the current frame\n */\nexport interface PhysicsStatistics {\n  /**\n   * Gets the number of broadphase collision pairs which\n   */\n  pairs: number;\n\n  /**\n   * Gets the number of actual collisions\n   */\n  collisions: number;\n\n  /**\n   * A Hash storing the [[Pair.id]]s of [[Pair]]s that collided in the frame\n   */\n  collidersHash: CollidersHash;\n\n  /**\n   * Gets the number of fast moving bodies using raycast continuous collisions in the scene\n   */\n  fastBodies: number;\n\n  /**\n   * Gets the number of bodies that had a fast body collision resolution\n   */\n  fastBodyCollisions: number;\n\n  /**\n   * Gets the time it took to calculate the broadphase pairs\n   */\n  broadphase: number;\n\n  /**\n   * Gets the time it took to calculate the narrowphase\n   */\n  narrowphase: number;\n}\n\n/**\n * Debug statistics and flags for Excalibur. If polling these values, it would be\n * best to do so on the `postupdate` event for [[Engine]], after all values have been\n * updated during a frame.\n */\nexport class Debug implements DebugFlags {\n  private _engine: Engine;\n\n  constructor(engine: Engine) {\n    this._engine = engine;\n\n    this.colorBlindMode = new ColorBlindFlags(this._engine);\n  }\n\n  /**\n   * Performance statistics\n   */\n  public stats: DebugStats = {\n    /**\n     * Current frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\n     * Best accessed on [[postframe]] event. See [[FrameStats]]\n     */\n    currFrame: new FrameStats(),\n\n    /**\n     * Previous frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\n     * Best accessed on [[preframe]] event. Best inspected on engine event `preframe`. See [[FrameStats]]\n     */\n    prevFrame: new FrameStats()\n  };\n\n  /**\n   * Correct or simulate color blindness using [[ColorBlindness]] post processor.\n   * @warning Will reduce FPS.\n   */\n  public colorBlindMode: ColorBlindFlags;\n}\n\n/**\n * Implementation of a frame's stats. Meant to have values copied via [[FrameStats.reset]], avoid\n * creating instances of this every frame.\n */\nexport class FrameStats implements FrameStatistics {\n  private _id: number = 0;\n  private _delta: number = 0;\n  private _fps: number = 0;\n  private _actorStats: FrameActorStats = {\n    alive: 0,\n    killed: 0,\n    ui: 0,\n    get remaining() {\n      return this.alive - this.killed;\n    },\n    get total() {\n      return this.remaining + this.ui;\n    }\n  };\n  private _durationStats: FrameDurationStats = {\n    update: 0,\n    draw: 0,\n    get total() {\n      return this.update + this.draw;\n    }\n  };\n\n  private _physicsStats: PhysicsStats = new PhysicsStats();\n\n  /**\n   * Zero out values or clone other IFrameStat stats. Allows instance reuse.\n   *\n   * @param [otherStats] Optional stats to clone\n   */\n  public reset(otherStats?: FrameStatistics) {\n    if (otherStats) {\n      this.id = otherStats.id;\n      this.delta = otherStats.delta;\n      this.fps = otherStats.fps;\n      this.actors.alive = otherStats.actors.alive;\n      this.actors.killed = otherStats.actors.killed;\n      this.actors.ui = otherStats.actors.ui;\n      this.duration.update = otherStats.duration.update;\n      this.duration.draw = otherStats.duration.draw;\n      this._physicsStats.reset(otherStats.physics);\n    } else {\n      this.id = this.delta = this.fps = 0;\n      this.actors.alive = this.actors.killed = this.actors.ui = 0;\n      this.duration.update = this.duration.draw = 0;\n      this._physicsStats.reset();\n    }\n  }\n\n  /**\n   * Provides a clone of this instance.\n   */\n  public clone(): FrameStats {\n    const fs = new FrameStats();\n\n    fs.reset(this);\n\n    return fs;\n  }\n\n  /**\n   * Gets the frame's id\n   */\n  public get id() {\n    return this._id;\n  }\n\n  /**\n   * Sets the frame's id\n   */\n  public set id(value: number) {\n    this._id = value;\n  }\n\n  /**\n   * Gets the frame's delta (time since last frame)\n   */\n  public get delta() {\n    return this._delta;\n  }\n\n  /**\n   * Sets the frame's delta (time since last frame). Internal use only.\n   * @internal\n   */\n  public set delta(value: number) {\n    this._delta = value;\n  }\n\n  /**\n   * Gets the frame's frames-per-second (FPS)\n   */\n  public get fps() {\n    return this._fps;\n  }\n\n  /**\n   * Sets the frame's frames-per-second (FPS). Internal use only.\n   * @internal\n   */\n  public set fps(value: number) {\n    this._fps = value;\n  }\n\n  /**\n   * Gets the frame's actor statistics\n   */\n  public get actors() {\n    return this._actorStats;\n  }\n\n  /**\n   * Gets the frame's duration statistics\n   */\n  public get duration() {\n    return this._durationStats;\n  }\n\n  /**\n   * Gets the frame's physics statistics\n   */\n  public get physics() {\n    return this._physicsStats;\n  }\n}\n\nexport class PhysicsStats implements PhysicsStatistics {\n  private _pairs: number = 0;\n  private _collisions: number = 0;\n  private _collidersHash: CollidersHash = {};\n  private _fastBodies: number = 0;\n  private _fastBodyCollisions: number = 0;\n  private _broadphase: number = 0;\n  private _narrowphase: number = 0;\n\n  /**\n   * Zero out values or clone other IPhysicsStats stats. Allows instance reuse.\n   *\n   * @param [otherStats] Optional stats to clone\n   */\n  public reset(otherStats?: PhysicsStatistics) {\n    if (otherStats) {\n      this.pairs = otherStats.pairs;\n      this.collisions = otherStats.collisions;\n      this.collidersHash = otherStats.collidersHash;\n      this.fastBodies = otherStats.fastBodies;\n      this.fastBodyCollisions = otherStats.fastBodyCollisions;\n      this.broadphase = otherStats.broadphase;\n      this.narrowphase = otherStats.narrowphase;\n    } else {\n      this.pairs = this.collisions = this.fastBodies = 0;\n      this.fastBodyCollisions = this.broadphase = this.narrowphase = 0;\n      this.collidersHash = {};\n    }\n  }\n\n  /**\n   * Provides a clone of this instance.\n   */\n  public clone(): PhysicsStatistics {\n    const ps = new PhysicsStats();\n\n    ps.reset(this);\n\n    return ps;\n  }\n\n  public get pairs(): number {\n    return this._pairs;\n  }\n\n  public set pairs(value: number) {\n    this._pairs = value;\n  }\n\n  public get collisions(): number {\n    return this._collisions;\n  }\n\n  public set collisions(value: number) {\n    this._collisions = value;\n  }\n\n  public get collidersHash(): CollidersHash {\n    return this._collidersHash;\n  }\n\n  public set collidersHash(colliders: CollidersHash) {\n    this._collidersHash = colliders;\n  }\n\n  public get fastBodies(): number {\n    return this._fastBodies;\n  }\n\n  public set fastBodies(value: number) {\n    this._fastBodies = value;\n  }\n\n  public get fastBodyCollisions(): number {\n    return this._fastBodyCollisions;\n  }\n\n  public set fastBodyCollisions(value: number) {\n    this._fastBodyCollisions = value;\n  }\n\n  public get broadphase(): number {\n    return this._broadphase;\n  }\n\n  public set broadphase(value: number) {\n    this._broadphase = value;\n  }\n\n  public get narrowphase(): number {\n    return this._narrowphase;\n  }\n\n  public set narrowphase(value: number) {\n    this._narrowphase = value;\n  }\n}\n","import { Class } from '../Class';\nimport { Engine, ScrollPreventionMode } from '../Engine';\nimport { Pointer, PointerType } from './Pointer';\nimport {\n  PointerEvent,\n  WheelEvent,\n  NativePointerButton,\n  PointerButton,\n  WheelDeltaMode,\n  createPointerEventByName,\n  PointerLeaveEvent,\n  PointerEnterEvent\n} from './PointerEvents';\nimport { GameEvent } from '../Events';\n\nimport * as Events from '../Events';\nimport * as Util from '../Util/Util';\nimport { GlobalCoordinates, Vector } from '../Algebra';\nimport { CapturePointer } from '../Traits/CapturePointer';\nimport { Actor } from '../Actor';\n\ninterface TouchEvent extends Event {\n  altKey: boolean;\n  changedTouches: Touch[];\n  ctrlKey: boolean;\n  metaKey: boolean;\n  shiftKey: boolean;\n  targetTouches: Touch[];\n  touches: Touch[];\n  type: string;\n  target: Element;\n}\n\ninterface Touch {\n  identifier: number;\n  screenX: number;\n  screenY: number;\n  clientX: number;\n  clientY: number;\n  pageX: number;\n  pageY: number;\n  radiusX: number;\n  radiusY: number;\n  rotationAngle: number;\n  force: number;\n  target: Element;\n}\n\n/**\n * A constant used to normalize wheel events across different browsers\n *\n * This normalization factor is pulled from https://developer.mozilla.org/en-US/docs/Web/Events/wheel#Listening_to_this_event_across_browser\n */\nconst ScrollWheelNormalizationFactor = -1 / 40;\n\n/**\n * Handles pointer events (mouse, touch, stylus, etc.) and normalizes to\n * [W3C Pointer Events](http://www.w3.org/TR/pointerevents/).\n */\nexport class Pointers extends Class {\n  private _engine: Engine;\n\n  private _pointerDown: PointerEvent[] = [];\n  private _pointerUp: PointerEvent[] = [];\n  private _pointerMove: PointerEvent[] = [];\n  private _pointerCancel: PointerEvent[] = [];\n  private _wheel: WheelEvent[] = [];\n  private _pointers: Pointer[] = [];\n  private _activePointers: number[] = [];\n\n  constructor(engine: Engine) {\n    super();\n\n    this._engine = engine;\n    this._pointers.push(new Pointer());\n    this._activePointers = [-1];\n    this.primary = this._pointers[0];\n  }\n\n  public on(eventName: Events.up, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.down, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.move, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.enter, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.leave, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.cancel, handler: (event: PointerEvent) => void): void;\n  public on(eventName: Events.wheel, handler: (event: WheelEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  /**\n   * Primary pointer (mouse, 1 finger, stylus, etc.)\n   */\n  public primary: Pointer;\n\n  /**\n   * Initializes pointer event listeners\n   */\n  public init(target?: GlobalEventHandlers): void {\n    target = target || this._engine.canvas;\n\n    // Touch Events\n    target.addEventListener('touchstart', this._handleTouchEvent('down', this._pointerDown));\n    target.addEventListener('touchend', this._handleTouchEvent('up', this._pointerUp));\n    target.addEventListener('touchmove', this._handleTouchEvent('move', this._pointerMove));\n    target.addEventListener('touchcancel', this._handleTouchEvent('cancel', this._pointerCancel));\n\n    // W3C Pointer Events\n    // Current: IE11, IE10\n    if ((<any>window).PointerEvent) {\n      // IE11\n      this._engine.canvas.style.touchAction = 'none';\n      target.addEventListener('pointerdown', this._handlePointerEvent('down', this._pointerDown));\n      target.addEventListener('pointerup', this._handlePointerEvent('up', this._pointerUp));\n      target.addEventListener('pointermove', this._handlePointerEvent('move', this._pointerMove));\n      target.addEventListener('pointercancel', this._handlePointerEvent('cancel', this._pointerCancel));\n    } else if ((<any>window).MSPointerEvent) {\n      // IE10\n      (this._engine.canvas.style as any).msTouchAction = 'none';\n      target.addEventListener('MSPointerDown', this._handlePointerEvent('down', this._pointerDown));\n      target.addEventListener('MSPointerUp', this._handlePointerEvent('up', this._pointerUp));\n      target.addEventListener('MSPointerMove', this._handlePointerEvent('move', this._pointerMove));\n      target.addEventListener('MSPointerCancel', this._handlePointerEvent('cancel', this._pointerCancel));\n    } else {\n      // Mouse Events\n      target.addEventListener('mousedown', this._handleMouseEvent('down', this._pointerDown));\n      target.addEventListener('mouseup', this._handleMouseEvent('up', this._pointerUp));\n      target.addEventListener('mousemove', this._handleMouseEvent('move', this._pointerMove));\n    }\n\n    // MDN MouseWheelEvent\n    const wheelOptions = {\n      passive: !(\n        this._engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\n        this._engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas\n      )\n    };\n    if ('onwheel' in document.createElement('div')) {\n      // Modern Browsers\n      target.addEventListener('wheel', this._handleWheelEvent('wheel', this._wheel), wheelOptions);\n    } else if (document.onmousewheel !== undefined) {\n      // Webkit and IE\n      target.addEventListener('mousewheel', this._handleWheelEvent('wheel', this._wheel), wheelOptions);\n    } else {\n      // Remaining browser and older Firefox\n      target.addEventListener('MozMousePixelScroll', this._handleWheelEvent('wheel', this._wheel), wheelOptions);\n    }\n  }\n\n  /**\n   * Synthesize a pointer event that looks like a real browser event to excalibur\n   * @param eventName\n   * @param pos\n   */\n  public triggerEvent(\n    eventName: 'up' | 'down' | 'move' | 'cancel' | 'wheel',\n    pos: Vector | GlobalCoordinates,\n    button: NativePointerButton = NativePointerButton.Left,\n    pointerType: 'mouse' | 'touch' | 'pen' = 'mouse',\n    pointerId: number = 0\n  ): void {\n    let x = 0;\n    let y = 0;\n    let coords: GlobalCoordinates;\n    if (pos instanceof GlobalCoordinates) {\n      x = pos.pagePos.x;\n      y = pos.pagePos.y;\n      coords = pos;\n    } else {\n      x = pos.x;\n      y = pos.y;\n      coords = new GlobalCoordinates(pos.clone(), pos.clone(), pos.clone());\n    }\n\n    const eventish = {\n      pageX: x,\n      pageY: y,\n      pointerId: pointerId,\n      pointerType: pointerType,\n      button: button,\n      preventDefault: () => {\n        /* do nothing */\n      }\n    };\n\n    switch (eventName) {\n      case 'move':\n        this._handlePointerEvent(eventName, this._pointerMove, coords)(eventish as MSPointerEvent);\n        break;\n      case 'down':\n        this._handlePointerEvent(eventName, this._pointerDown, coords)(eventish as MSPointerEvent);\n        break;\n      case 'up':\n        this._handlePointerEvent(eventName, this._pointerUp, coords)(eventish as MSPointerEvent);\n        break;\n      case 'cancel':\n        this._handlePointerEvent(eventName, this._pointerCancel, coords)(eventish as MSPointerEvent);\n        break;\n    }\n    for (const actor of this._engine.currentScene.actors) {\n      const capturePointer = actor.traits.filter((t) => t instanceof CapturePointer)[0];\n      if (capturePointer) {\n        capturePointer.update(actor, this._engine, 1);\n      }\n    }\n    this.dispatchPointerEvents();\n    this.update();\n  }\n\n  /**\n   * Update all pointer events and pointers, meant to be called at the end of frame\n   */\n  public update(): void {\n    this._pointerUp.length = 0;\n    this._pointerDown.length = 0;\n    this._pointerMove.length = 0;\n    this._pointerCancel.length = 0;\n    this._wheel.length = 0;\n\n    for (let i = 0; i < this._pointers.length; i++) {\n      this._pointers[i].update();\n    }\n  }\n\n  /**\n   * Safely gets a Pointer at a specific index and initializes one if it doesn't yet exist\n   * @param index  The pointer index to retrieve\n   */\n  public at(index: number): Pointer {\n    if (index >= this._pointers.length) {\n      // Ensure there is a pointer to retrieve\n      for (let i = this._pointers.length - 1, max = index; i < max; i++) {\n        this._pointers.push(new Pointer());\n        this._activePointers.push(-1);\n      }\n    }\n\n    return this._pointers[index];\n  }\n\n  /**\n   * Get number of pointers being watched\n   */\n  public count(): number {\n    return this._pointers.length;\n  }\n\n  public checkAndUpdateActorUnderPointer(actor: Actor) {\n    for (const pointer of this._pointers) {\n      if (pointer.checkActorUnderPointer(actor)) {\n        pointer.addActorUnderPointer(actor);\n      } else {\n        pointer.removeActorUnderPointer(actor);\n      }\n    }\n  }\n\n  private _dispatchWithBubble(events: PointerEvent[]) {\n    for (const evt of events) {\n      for (const actor of evt.pointer.getActorsForEvents()) {\n        evt.propagate(actor);\n        if (!evt.bubbles) {\n          // if the event stops bubbling part way stop processing\n          break;\n        }\n      }\n    }\n  }\n\n  private _dispatchPointerLeaveEvents() {\n    const lastMoveEventPerPointerPerActor: { [pointerId: string]: PointerEvent } = {};\n    const pointerLeave: PointerLeaveEvent[] = [];\n\n    for (const evt of this._pointerMove) {\n      for (const actor of evt.pointer.getActorsForEvents()) {\n        // If the actor was under the pointer last frame, but not this this frame, pointer left\n        if (\n          !lastMoveEventPerPointerPerActor[evt.pointer.id + '+' + actor.id] &&\n          evt.pointer.wasActorUnderPointer(actor) &&\n          !evt.pointer.isActorAliveUnderPointer(actor)\n        ) {\n          lastMoveEventPerPointerPerActor[evt.pointer.id + '+' + actor.id] = evt;\n          const pe = createPointerEventByName(\n            'leave',\n            new GlobalCoordinates(evt.worldPos, evt.pagePos, evt.screenPos),\n            evt.pointer,\n            evt.index,\n            evt.pointerType,\n            evt.button,\n            evt.ev\n          );\n\n          pe.propagate(actor);\n          pointerLeave.push(<PointerLeaveEvent>pe);\n        }\n      }\n    }\n    return pointerLeave;\n  }\n\n  private _dispatchPointerEnterEvents() {\n    const lastMoveEventPerPointer: { [pointerId: number]: PointerEvent } = {};\n    const pointerEnter: PointerEnterEvent[] = [];\n\n    for (const evt of this._pointerMove) {\n      for (const actor of evt.pointer.getActorsForEvents()) {\n        // If the actor was not under the pointer last frame, but it is this frame, pointer entered\n        if (\n          !lastMoveEventPerPointer[evt.pointer.id] &&\n          !evt.pointer.wasActorUnderPointer(actor) &&\n          evt.pointer.isActorAliveUnderPointer(actor)\n        ) {\n          lastMoveEventPerPointer[evt.pointer.id] = evt;\n          const pe = createPointerEventByName(\n            'enter',\n            new GlobalCoordinates(evt.worldPos, evt.pagePos, evt.screenPos),\n            evt.pointer,\n            evt.index,\n            evt.pointerType,\n            evt.button,\n            evt.ev\n          );\n          pe.propagate(actor);\n          pointerEnter.push(<PointerEnterEvent>pe);\n          // if pointer is dragging set the drag target\n          if (evt.pointer.isDragging) {\n            evt.pointer.dragTarget = actor;\n          }\n        }\n      }\n    }\n    return pointerEnter;\n  }\n\n  public dispatchPointerEvents() {\n    this._dispatchWithBubble(this._pointerDown);\n    this._dispatchWithBubble(this._pointerUp);\n    this._dispatchWithBubble(this._pointerMove);\n    this._dispatchPointerLeaveEvents();\n    this._dispatchPointerEnterEvents();\n    this._dispatchWithBubble(this._pointerCancel);\n\n    // TODO some duplication here\n    for (const evt of this._wheel) {\n      for (const actor of this._pointers[evt.index].getActorsUnderPointer()) {\n        this._propagateWheelPointerEvent(actor, evt);\n        if (!evt.bubbles) {\n          // if the event stops bubbling part way stop processing\n          break;\n        }\n      }\n    }\n  }\n\n  private _propagateWheelPointerEvent(actor: Actor, wheelEvent: WheelEvent) {\n    actor.emit('pointerwheel', wheelEvent);\n\n    // Recurse and propagate\n    if (wheelEvent.bubbles && actor.parent) {\n      this._propagateWheelPointerEvent(actor.parent, wheelEvent);\n    }\n  }\n\n  private _handleMouseEvent(eventName: string, eventArr: PointerEvent[]) {\n    return (e: MouseEvent) => {\n      e.preventDefault();\n\n      const pointer = this.at(0);\n      const coordinates = GlobalCoordinates.fromPagePosition(e.pageX, e.pageY, this._engine);\n      const pe = createPointerEventByName(\n        eventName,\n        coordinates,\n        pointer,\n        0,\n        PointerType.Mouse,\n        this._nativeButtonToPointerButton(e.button),\n        e\n      );\n\n      eventArr.push(pe);\n      pointer.eventDispatcher.emit(eventName, pe);\n    };\n  }\n\n  private _handleTouchEvent(eventName: string, eventArr: PointerEvent[]) {\n    return (e: TouchEvent) => {\n      e.preventDefault();\n      for (let i = 0, len = e.changedTouches.length; i < len; i++) {\n        const index = this._pointers.length > 1 ? this._getPointerIndex(e.changedTouches[i].identifier) : 0;\n        if (index === -1) {\n          continue;\n        }\n\n        const pointer = this.at(index);\n        const coordinates = GlobalCoordinates.fromPagePosition(e.changedTouches[i].pageX, e.changedTouches[i].pageY, this._engine);\n        const pe = createPointerEventByName(eventName, coordinates, pointer, index, PointerType.Touch, PointerButton.Unknown, e);\n\n        eventArr.push(pe);\n        pointer.eventDispatcher.emit(eventName, pe);\n        // only with multi-pointer\n        if (this._pointers.length > 1) {\n          if (eventName === 'up') {\n            // remove pointer ID from pool when pointer is lifted\n            this._activePointers[index] = -1;\n          } else if (eventName === 'down') {\n            // set pointer ID to given index\n            this._activePointers[index] = e.changedTouches[i].identifier;\n          }\n        }\n      }\n    };\n  }\n\n  private _handlePointerEvent(eventName: string, eventArr: PointerEvent[], coords?: GlobalCoordinates) {\n    return (e: MSPointerEvent) => {\n      e.preventDefault();\n\n      // get the index for this pointer ID if multi-pointer is asked for\n      const index = this._pointers.length > 1 ? this._getPointerIndex(e.pointerId) : 0;\n      if (index === -1) {\n        return;\n      }\n\n      const pointer = this.at(index);\n      const coordinates = coords || GlobalCoordinates.fromPagePosition(e.pageX, e.pageY, this._engine);\n      const pe = createPointerEventByName(\n        eventName,\n        coordinates,\n        pointer,\n        index,\n        this._stringToPointerType(e.pointerType),\n        this._nativeButtonToPointerButton(e.button),\n        e\n      );\n\n      eventArr.push(pe);\n      pointer.eventDispatcher.emit(eventName, pe);\n\n      // only with multi-pointer\n      if (this._pointers.length > 1) {\n        if (eventName === 'up') {\n          // remove pointer ID from pool when pointer is lifted\n          this._activePointers[index] = -1;\n        } else if (eventName === 'down') {\n          // set pointer ID to given index\n          this._activePointers[index] = e.pointerId;\n        }\n      }\n    };\n  }\n\n  private _handleWheelEvent(eventName: string, eventArr: WheelEvent[]) {\n    return (e: MouseWheelEvent) => {\n      // Should we prevent page scroll because of this event\n      if (\n        this._engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\n        (this._engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas && e.target === this._engine.canvas)\n      ) {\n        e.preventDefault();\n      }\n\n      const x: number = e.pageX - Util.getPosition(this._engine.canvas).x;\n      const y: number = e.pageY - Util.getPosition(this._engine.canvas).y;\n      const transformedPoint = this._engine.screenToWorldCoordinates(new Vector(x, y));\n\n      // deltaX, deltaY, and deltaZ are the standard modern properties\n      // wheelDeltaX, wheelDeltaY, are legacy properties in webkit browsers and older IE\n      // e.detail is only used in opera\n\n      const deltaX = e.deltaX || e.wheelDeltaX * ScrollWheelNormalizationFactor || 0;\n      const deltaY =\n        e.deltaY || e.wheelDeltaY * ScrollWheelNormalizationFactor || e.wheelDelta * ScrollWheelNormalizationFactor || e.detail || 0;\n      const deltaZ = e.deltaZ || 0;\n      let deltaMode = WheelDeltaMode.Pixel;\n\n      if (e.deltaMode) {\n        if (e.deltaMode === 1) {\n          deltaMode = WheelDeltaMode.Line;\n        } else if (e.deltaMode === 2) {\n          deltaMode = WheelDeltaMode.Page;\n        }\n      }\n\n      const we = new WheelEvent(transformedPoint.x, transformedPoint.y, e.pageX, e.pageY, x, y, 0, deltaX, deltaY, deltaZ, deltaMode, e);\n\n      eventArr.push(we);\n      this.at(0).eventDispatcher.emit(eventName, we);\n    };\n  }\n\n  /**\n   * Gets the index of the pointer specified for the given pointer ID or finds the next empty pointer slot available.\n   * This is required because IE10/11 uses incrementing pointer IDs so we need to store a mapping of ID => idx\n   */\n  private _getPointerIndex(pointerId: number) {\n    let idx;\n    if ((idx = this._activePointers.indexOf(pointerId)) > -1) {\n      return idx;\n    }\n\n    for (let i = 0; i < this._activePointers.length; i++) {\n      if (this._activePointers[i] === -1) {\n        return i;\n      }\n    }\n\n    // ignore pointer because game isn't watching\n    return -1;\n  }\n\n  private _nativeButtonToPointerButton(s: NativePointerButton): PointerButton {\n    switch (s) {\n      case NativePointerButton.NoButton:\n        return PointerButton.NoButton;\n      case NativePointerButton.Left:\n        return PointerButton.Left;\n      case NativePointerButton.Middle:\n        return PointerButton.Middle;\n      case NativePointerButton.Right:\n        return PointerButton.Right;\n      case NativePointerButton.Unknown:\n        return PointerButton.Unknown;\n      default:\n        return Util.fail(s);\n    }\n  }\n\n  private _stringToPointerType(s: string) {\n    switch (s) {\n      case 'touch':\n        return PointerType.Touch;\n      case 'mouse':\n        return PointerType.Mouse;\n      case 'pen':\n        return PointerType.Pen;\n      default:\n        return PointerType.Unknown;\n    }\n  }\n}\n","import { Class } from './../Class';\nimport { GameEvent, GamepadConnectEvent, GamepadDisconnectEvent, GamepadButtonEvent, GamepadAxisEvent } from '../Events';\nimport * as Events from '../Events';\n\n/**\n * Excalibur leverages the HTML5 Gamepad API [where it is supported](http://caniuse.com/#feat=gamepad)\n * to provide controller support for your games.\n */\nexport class Gamepads extends Class {\n  /**\n   * Whether or not to poll for Gamepad input (default: `false`)\n   */\n  public enabled = false;\n\n  /**\n   * Whether or not Gamepad API is supported\n   */\n  public supported = !!(<any>navigator).getGamepads;\n\n  /**\n   * The minimum value an axis has to move before considering it a change\n   */\n  public static MinAxisMoveThreshold = 0.05;\n\n  private _gamePadTimeStamps = [0, 0, 0, 0];\n  private _oldPads: Gamepad[] = [];\n  private _pads: Gamepad[] = [];\n  private _initSuccess: boolean = false;\n  private _navigator: NavigatorGamepads = <any>navigator;\n  private _minimumConfiguration: GamepadConfiguration = null;\n\n  constructor() {\n    super();\n  }\n\n  public init() {\n    if (!this.supported) {\n      return;\n    }\n    if (this._initSuccess) {\n      return;\n    }\n\n    // In Chrome, this will return 4 undefined items until a button is pressed\n    // In FF, this will not return any items until a button is pressed\n    this._oldPads = this._clonePads(this._navigator.getGamepads());\n    if (this._oldPads.length && this._oldPads[0]) {\n      this._initSuccess = true;\n    }\n  }\n\n  /**\n   * Sets the minimum gamepad configuration, for example {axis: 4, buttons: 4} means\n   * this game requires at minimum 4 axis inputs and 4 buttons, this is not restrictive\n   * all other controllers with more axis or buttons are valid as well. If no minimum\n   * configuration is set all pads are valid.\n   */\n  public setMinimumGamepadConfiguration(config: GamepadConfiguration): void {\n    this._enableAndUpdate(); // if config is used, implicitly enable\n    this._minimumConfiguration = config;\n  }\n\n  /**\n   * When implicitly enabled, set the enabled flag and run an update so information is updated\n   */\n  private _enableAndUpdate() {\n    if (!this.enabled) {\n      this.enabled = true;\n      this.update();\n    }\n  }\n\n  /**\n   * Checks a navigator gamepad against the minimum configuration if present.\n   */\n  private _isGamepadValid(pad: NavigatorGamepad): boolean {\n    if (!this._minimumConfiguration) {\n      return true;\n    }\n    if (!pad) {\n      return false;\n    }\n    const axesLength = pad.axes.filter((value) => {\n      return typeof value !== undefined;\n    }).length;\n\n    const buttonLength = pad.buttons.filter((value) => {\n      return typeof value !== undefined;\n    }).length;\n    return axesLength >= this._minimumConfiguration.axis && buttonLength >= this._minimumConfiguration.buttons && pad.connected;\n  }\n\n  public on(eventName: Events.connect, handler: (event: GamepadConnectEvent) => void): void;\n  public on(eventName: Events.disconnect, handler: (event: GamepadDisconnectEvent) => void): void;\n  public on(eventName: Events.button, handler: (event: GamepadButtonEvent) => void): void;\n  public on(eventName: Events.axis, handler: (event: GamepadAxisEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    this._enableAndUpdate(); // implicitly enable\n    super.on(eventName, handler);\n  }\n\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void) {\n    this._enableAndUpdate(); // implicitly enable\n    super.off(eventName, handler);\n  }\n\n  /**\n   * Updates Gamepad state and publishes Gamepad events\n   */\n  public update() {\n    if (!this.enabled || !this.supported) {\n      return;\n    }\n    this.init();\n\n    const gamepads = this._navigator.getGamepads();\n\n    for (let i = 0; i < gamepads.length; i++) {\n      if (!gamepads[i]) {\n        const gamepad = this.at(i);\n        // If was connected, but now isn't emit the disconnect event\n        if (gamepad.connected) {\n          this.eventDispatcher.emit('disconnect', new GamepadDisconnectEvent(i, gamepad));\n        }\n        // Reset connection status\n        gamepad.connected = false;\n        continue;\n      } else {\n        if (!this.at(i).connected && this._isGamepadValid(gamepads[i])) {\n          this.eventDispatcher.emit('connect', new GamepadConnectEvent(i, this.at(i)));\n        }\n        // Set connection status\n        this.at(i).connected = true;\n      }\n\n      // Only supported in Chrome\n      if (gamepads[i].timestamp && gamepads[i].timestamp === this._gamePadTimeStamps[i]) {\n        continue;\n      }\n\n      this._gamePadTimeStamps[i] = gamepads[i].timestamp;\n\n      // Add reference to navigator gamepad\n      this.at(i).navigatorGamepad = gamepads[i];\n\n      // Buttons\n      let b: string, bi: number, a: string, ai: number, value: number;\n\n      for (b in Buttons) {\n        bi = <any>Buttons[b];\n        if (typeof bi === 'number') {\n          if (gamepads[i].buttons[bi]) {\n            value = gamepads[i].buttons[bi].value;\n            if (value !== this._oldPads[i].getButton(bi)) {\n              if (gamepads[i].buttons[bi].pressed) {\n                this.at(i).updateButton(bi, value);\n                this.at(i).eventDispatcher.emit('button', new GamepadButtonEvent(bi, value, this.at(i)));\n              } else {\n                this.at(i).updateButton(bi, 0);\n              }\n            }\n          }\n        }\n      }\n\n      // Axes\n      for (a in Axes) {\n        ai = <any>Axes[a];\n        if (typeof ai === 'number') {\n          value = gamepads[i].axes[ai];\n          if (value !== this._oldPads[i].getAxes(ai)) {\n            this.at(i).updateAxes(ai, value);\n            this.at(i).eventDispatcher.emit('axis', new GamepadAxisEvent(ai, value, this.at(i)));\n          }\n        }\n      }\n\n      this._oldPads[i] = this._clonePad(gamepads[i]);\n    }\n  }\n\n  /**\n   * Safely retrieves a Gamepad at a specific index and creates one if it doesn't yet exist\n   */\n  public at(index: number): Gamepad {\n    this._enableAndUpdate(); // implicitly enable gamepads when at() is called\n    if (index >= this._pads.length) {\n      // Ensure there is a pad to retrieve\n      for (let i = this._pads.length - 1, max = index; i < max; i++) {\n        this._pads.push(new Gamepad());\n        this._oldPads.push(new Gamepad());\n      }\n    }\n\n    return this._pads[index];\n  }\n\n  /**\n   * Returns a list of all valid gamepads that meet the minimum configuration requirement.\n   */\n  public getValidGamepads(): Gamepad[] {\n    this._enableAndUpdate();\n    const result: Gamepad[] = [];\n    for (let i = 0; i < this._pads.length; i++) {\n      if (this._isGamepadValid(this.at(i).navigatorGamepad) && this.at(i).connected) {\n        result.push(this.at(i));\n      }\n    }\n    return result;\n  }\n\n  /**\n   * Gets the number of connected gamepads\n   */\n  public count() {\n    return this._pads.filter((p) => p.connected).length;\n  }\n\n  private _clonePads(pads: NavigatorGamepad[]): Gamepad[] {\n    const arr = [];\n    for (let i = 0, len = pads.length; i < len; i++) {\n      arr.push(this._clonePad(pads[i]));\n    }\n    return arr;\n  }\n\n  /**\n   * Fastest way to clone a known object is to do it yourself\n   */\n  private _clonePad(pad: NavigatorGamepad): Gamepad {\n    let i, len;\n    const clonedPad = new Gamepad();\n\n    if (!pad) {\n      return clonedPad;\n    }\n\n    for (i = 0, len = pad.buttons.length; i < len; i++) {\n      if (pad.buttons[i]) {\n        clonedPad.updateButton(i, pad.buttons[i].value);\n      }\n    }\n    for (i = 0, len = pad.axes.length; i < len; i++) {\n      clonedPad.updateAxes(i, pad.axes[i]);\n    }\n\n    return clonedPad;\n  }\n}\n\n/**\n * Gamepad holds state information for a connected controller. See [[Gamepads]]\n * for more information on handling controller input.\n */\nexport class Gamepad extends Class {\n  public connected = false;\n  public navigatorGamepad: NavigatorGamepad;\n  private _buttons: number[] = new Array(16);\n  private _axes: number[] = new Array(4);\n\n  constructor() {\n    super();\n\n    for (let i = 0; i < this._buttons.length; i++) {\n      this._buttons[i] = 0;\n    }\n    for (let i = 0; i < this._axes.length; i++) {\n      this._axes[i] = 0;\n    }\n  }\n\n  /**\n   * Whether or not the given button is pressed\n   * @param button     The button to query\n   * @param threshold  The threshold over which the button is considered to be pressed\n   */\n  public isButtonPressed(button: Buttons, threshold: number = 1) {\n    return this._buttons[button] >= threshold;\n  }\n\n  /**\n   * Gets the given button value between 0 and 1\n   */\n  public getButton(button: Buttons) {\n    return this._buttons[button];\n  }\n\n  /**\n   * Gets the given axis value between -1 and 1. Values below\n   * [[MinAxisMoveThreshold]] are considered 0.\n   */\n  public getAxes(axes: Axes) {\n    const value = this._axes[axes];\n\n    if (Math.abs(value) < Gamepads.MinAxisMoveThreshold) {\n      return 0;\n    } else {\n      return value;\n    }\n  }\n\n  public updateButton(buttonIndex: number, value: number) {\n    this._buttons[buttonIndex] = value;\n  }\n\n  public updateAxes(axesIndex: number, value: number) {\n    this._axes[axesIndex] = value;\n  }\n}\n\n/**\n * Gamepad Buttons enumeration\n */\nexport enum Buttons {\n  /**\n   * Face 1 button (e.g. A)\n   */\n  Face1 = 0,\n  /**\n   * Face 2 button (e.g. B)\n   */\n  Face2 = 1,\n  /**\n   * Face 3 button (e.g. X)\n   */\n  Face3 = 2,\n  /**\n   * Face 4 button (e.g. Y)\n   */\n  Face4 = 3,\n  /**\n   * Left bumper button\n   */\n  LeftBumper = 4,\n  /**\n   * Right bumper button\n   */\n  RightBumper = 5,\n  /**\n   * Left trigger button\n   */\n  LeftTrigger = 6,\n  /**\n   * Right trigger button\n   */\n  RightTrigger = 7,\n  /**\n   * Select button\n   */\n  Select = 8,\n  /**\n   * Start button\n   */\n  Start = 9,\n  /**\n   * Left analog stick press (e.g. L3)\n   */\n  LeftStick = 10,\n  /**\n   * Right analog stick press (e.g. R3)\n   */\n  RightStick = 11,\n  /**\n   * D-pad up\n   */\n  DpadUp = 12,\n  /**\n   * D-pad down\n   */\n  DpadDown = 13,\n  /**\n   * D-pad left\n   */\n  DpadLeft = 14,\n  /**\n   * D-pad right\n   */\n  DpadRight = 15\n}\n\n/**\n * Gamepad Axes enumeration\n */\nexport enum Axes {\n  /**\n   * Left analogue stick X direction\n   */\n  LeftStickX = 0,\n  /**\n   * Left analogue stick Y direction\n   */\n  LeftStickY = 1,\n  /**\n   * Right analogue stick X direction\n   */\n  RightStickX = 2,\n  /**\n   * Right analogue stick Y direction\n   */\n  RightStickY = 3\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepads {\n  getGamepads(): NavigatorGamepad[];\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepad {\n  axes: number[];\n  buttons: NavigatorGamepadButton[];\n  connected: boolean;\n  id: string;\n  index: number;\n  mapping: string;\n  timestamp: number;\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepadButton {\n  pressed: boolean;\n  value: number;\n}\n\n/**\n * @internal\n */\nexport interface NavigatorGamepadEvent {\n  gamepad: NavigatorGamepad;\n}\n\n/**\n * @internal\n */\nexport interface GamepadConfiguration {\n  axis: number;\n  buttons: number;\n}\n","export interface NativeEventable {\n  addEventListener(name: string, handler: (...any: any[]) => any): any;\n  removeEventListener(name: string, handler: (...any: any[]) => any): any;\n}\n\nexport class BrowserComponent<T extends NativeEventable> {\n  private _paused = false;\n  private _nativeHandlers: { [key: string]: (handler: any) => void } = {};\n\n  on(eventName: string, handler: (evt: any) => void): void {\n    if (this._nativeHandlers[eventName]) {\n      this.off(eventName, this._nativeHandlers[eventName]);\n    }\n    this._nativeHandlers[eventName] = this._decorate(handler);\n    this.nativeComponent.addEventListener(eventName, this._nativeHandlers[eventName]);\n  }\n  off(eventName: string, handler?: (event: any) => void): void {\n    if (!handler) {\n      handler = this._nativeHandlers[eventName];\n    }\n    this.nativeComponent.removeEventListener(eventName, handler);\n    this._nativeHandlers[eventName] = null;\n  }\n\n  private _decorate(handler: (evt: any) => void): (evt: any) => void {\n    return (evt: any) => {\n      if (!this._paused) {\n        handler(evt);\n      }\n    };\n  }\n\n  public pause() {\n    this._paused = true;\n  }\n\n  public resume() {\n    this._paused = false;\n  }\n\n  public clear() {\n    for (const event in this._nativeHandlers) {\n      this.off(event);\n    }\n  }\n\n  constructor(public nativeComponent: T) {}\n}\n\nexport class BrowserEvents {\n  private _windowComponent: BrowserComponent<Window>;\n  private _documentComponent: BrowserComponent<Document>;\n  constructor(private _windowGlobal: Window, private _documentGlobal: Document) {\n    this._windowComponent = new BrowserComponent(this._windowGlobal);\n    this._documentComponent = new BrowserComponent(this._documentGlobal);\n  }\n\n  public get window(): BrowserComponent<Window> {\n    return this._windowComponent;\n  }\n\n  public get document(): BrowserComponent<Document> {\n    return this._documentComponent;\n  }\n\n  public pause() {\n    this.window.pause();\n    this.document.pause();\n  }\n\n  public resume() {\n    this.window.resume();\n    this.document.resume();\n  }\n\n  public clear() {\n    this.window.clear();\n    this.document.clear();\n  }\n}\n","import { EX_VERSION } from './';\nimport { Flags } from './Flags';\nimport { polyfill } from './Polyfill';\npolyfill();\nimport { CanUpdate, CanDraw, CanInitialize } from './Interfaces/LifecycleEvents';\nimport { Loadable } from './Interfaces/Loadable';\nimport { Vector } from './Algebra';\nimport { Screen, DisplayMode, AbsolutePosition, ScreenDimension } from './Screen';\nimport { ScreenElement } from './ScreenElement';\nimport { Actor } from './Actor';\nimport { Timer } from './Timer';\nimport { TileMap } from './TileMap';\nimport { Animation } from './Drawing/Animation';\nimport { Loader } from './Loader';\nimport { Detector } from './Util/Detector';\nimport {\n  VisibleEvent,\n  HiddenEvent,\n  GameStartEvent,\n  GameStopEvent,\n  PreUpdateEvent,\n  PostUpdateEvent,\n  PreFrameEvent,\n  PostFrameEvent,\n  GameEvent,\n  DeactivateEvent,\n  ActivateEvent,\n  PreDrawEvent,\n  PostDrawEvent,\n  InitializeEvent\n} from './Events';\nimport { CanLoad } from './Interfaces/Loader';\nimport { Logger, LogLevel } from './Util/Log';\nimport { Color } from './Drawing/Color';\nimport { Scene } from './Scene';\nimport { PostProcessor } from './PostProcessing/PostProcessor';\nimport { Debug, DebugStats } from './Debug';\nimport { Class } from './Class';\nimport * as Input from './Input/Index';\nimport * as Events from './Events';\nimport { BrowserEvents } from './Util/Browser';\nimport { obsolete } from './Util/Decorators';\n\n/**\n * Enum representing the different mousewheel event bubble prevention\n */\nexport enum ScrollPreventionMode {\n  /**\n   * Do not prevent any page scrolling\n   */\n  None,\n  /**\n   * Prevent page scroll if mouse is over the game canvas\n   */\n  Canvas,\n  /**\n   * Prevent all page scrolling via mouse wheel\n   */\n  All\n}\n\n/**\n * Defines the available options to configure the Excalibur engine at constructor time.\n */\nexport interface EngineOptions {\n  /**\n   * Optionally configure the width of the viewport in css pixels\n   */\n  width?: number;\n\n  /**\n   * Optionally configure the height of the viewport in css pixels\n   */\n  height?: number;\n\n  /**\n   * Optionally configure the width & height of the viewport in css pixels.\n   * Use `viewport` instead of [[EngineOptions.width]] and [[EngineOptions.height]], or vice versa.\n   */\n  viewport?: ScreenDimension;\n\n  /**\n   * Optionally specify the size the logical pixel resolution, if not specified it will be width x height.\n   * See [[Resolution]] for common presets.\n   */\n  resolution?: ScreenDimension;\n\n  /**\n   * Optionally specify antialiasing (smoothing), by default true (smooth pixels)\n   */\n  antialiasing?: boolean;\n\n  /**\n   * Optionally configure the native canvas transparent backdrop\n   */\n  enableCanvasTransparency?: boolean;\n\n  /**\n   * Optionally specify the target canvas DOM element to render the game in\n   */\n  canvasElementId?: string;\n\n  /**\n   * Optionally specify the target canvas DOM element directly\n   */\n  canvasElement?: HTMLCanvasElement;\n\n  /**\n   * The [[DisplayMode]] of the game. Depending on this value, [[width]] and [[height]] may be ignored.\n   */\n  displayMode?: DisplayMode;\n\n  /**\n   * Configures the pointer scope. Pointers scoped to the 'Canvas' can only fire events within the canvas viewport; whereas, 'Document'\n   * (default) scoped will fire anywhere on the page.\n   */\n  pointerScope?: Input.PointerScope;\n\n  /**\n   * Suppress boot up console message, which contains the \"powered by Excalibur message\"\n   */\n  suppressConsoleBootMessage?: boolean;\n\n  /**\n   * Suppress minimum browser feature detection, it is not recommended users of excalibur switch this off. This feature ensures that\n   * the currently running browser meets the minimum requirements for running excalibur. This can be useful if running on non-standard\n   * browsers or if there is a bug in excalibur preventing execution.\n   */\n  suppressMinimumBrowserFeatureDetection?: boolean;\n\n  /**\n   * Suppress HiDPI auto detection and scaling, it is not recommended users of excalibur switch off this feature. This feature detects\n   * and scales the drawing canvas appropriately to accommodate HiDPI screens.\n   */\n  suppressHiDPIScaling?: boolean;\n\n  /**\n   * Suppress play button, it is not recommended users of excalibur switch this feature. Some browsers require a user gesture (like a click)\n   * for certain browser features to work like web audio.\n   */\n  suppressPlayButton?: boolean;\n\n  /**\n   * Specify how the game window is to be positioned when the [[DisplayMode.Position]] is chosen. This option MUST be specified\n   * if the DisplayMode is set as [[DisplayMode.Position]]. The position can be either a string or an [[AbsolutePosition]].\n   * String must be in the format of css style background-position. The vertical position must precede the horizontal position in strings.\n   *\n   * Valid String examples: \"top left\", \"top\", \"bottom\", \"middle\", \"middle center\", \"bottom right\"\n   * Valid [[AbsolutePosition]] examples: `{top: 5, right: 10%}`, `{bottom: 49em, left: 10px}`, `{left: 10, bottom: 40}`\n   */\n  position?: string | AbsolutePosition;\n\n  /**\n   * Scroll prevention method.\n   */\n  scrollPreventionMode?: ScrollPreventionMode;\n\n  /**\n   * Optionally set the background color\n   */\n  backgroundColor?: Color;\n}\n\n/**\n * The Excalibur Engine\n *\n * The [[Engine]] is the main driver for a game. It is responsible for\n * starting/stopping the game, maintaining state, transmitting events,\n * loading resources, and managing the scene.\n */\nexport class Engine extends Class implements CanInitialize, CanUpdate, CanDraw {\n  /**\n   *\n   */\n  public browser: BrowserEvents;\n\n  /**\n   * Screen abstraction\n   */\n  public screen: Screen;\n\n  /**\n   * Direct access to the engine's canvas element\n   */\n  public canvas: HTMLCanvasElement;\n\n  /**\n   * Direct access to the engine's 2D rendering context\n   */\n  public ctx: CanvasRenderingContext2D;\n\n  /**\n   * Direct access to the canvas element ID, if an ID exists\n   */\n  public canvasElementId: string;\n\n  /**\n   * The width of the game canvas in pixels (physical width component of the\n   * resolution of the canvas element)\n   */\n  public get canvasWidth(): number {\n    return this.screen.canvasWidth;\n  }\n\n  /**\n   * Returns half width of the game canvas in pixels (half physical width component)\n   */\n  public get halfCanvasWidth(): number {\n    return this.screen.halfCanvasWidth;\n  }\n\n  /**\n   * The height of the game canvas in pixels, (physical height component of\n   * the resolution of the canvas element)\n   */\n  public get canvasHeight(): number {\n    return this.screen.canvasHeight;\n  }\n\n  /**\n   * Returns half height of the game canvas in pixels (half physical height component)\n   */\n  public get halfCanvasHeight(): number {\n    return this.screen.halfCanvasHeight;\n  }\n\n  /**\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get drawWidth(): number {\n    return this.screen.drawWidth;\n  }\n\n  /**\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get halfDrawWidth(): number {\n    return this.screen.halfDrawWidth;\n  }\n\n  /**\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get drawHeight(): number {\n    return this.screen.drawHeight;\n  }\n\n  /**\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\n   */\n  public get halfDrawHeight(): number {\n    return this.screen.halfDrawHeight;\n  }\n\n  /**\n   * Returns whether excalibur detects the current screen to be HiDPI\n   */\n  public get isHiDpi(): boolean {\n    return this.screen.isHiDpi;\n  }\n\n  /**\n   * Access engine input like pointer, keyboard, or gamepad\n   */\n  public input: Input.EngineInput;\n\n  private _hasStarted: boolean = false;\n\n  /**\n   * Access Excalibur debugging functionality.\n   */\n  public debug: Debug;\n\n  /**\n   * Access [[stats]] that holds frame statistics.\n   */\n  public get stats(): DebugStats {\n    return this.debug.stats;\n  }\n\n  /**\n   * Gets or sets the list of post processors to apply at the end of drawing a frame (such as [[ColorBlindCorrector]])\n   */\n  public postProcessors: PostProcessor[] = [];\n\n  /**\n   * The current [[Scene]] being drawn and updated on screen\n   */\n  public currentScene: Scene;\n\n  /**\n   * The default [[Scene]] of the game, use [[Engine.goToScene]] to transition to different scenes.\n   */\n  public rootScene: Scene;\n\n  /**\n   * Contains all the scenes currently registered with Excalibur\n   */\n  public scenes: { [key: string]: Scene } = {};\n\n  private _animations: AnimationNode[] = [];\n\n  /**\n   * Indicates whether the engine is set to fullscreen or not\n   */\n  public get isFullscreen(): boolean {\n    return this.screen.isFullScreen;\n  }\n\n  /**\n   * Indicates the current [[DisplayMode]] of the engine.\n   */\n  public get displayMode(): DisplayMode {\n    return this.screen.displayMode;\n  }\n\n  private _suppressPlayButton: boolean = false;\n  /**\n   * Returns the calculated pixel ration for use in rendering\n   */\n  public get pixelRatio(): number {\n    return this.screen.pixelRatio;\n  }\n\n  /**\n   * Indicates the current position of the engine. Valid only when DisplayMode is DisplayMode.Position\n   */\n  public position: string | AbsolutePosition;\n  /**\n   * Indicates whether audio should be paused when the game is no longer visible.\n   */\n  public pauseAudioWhenHidden: boolean = true;\n\n  /**\n   * Indicates whether the engine should draw with debug information\n   */\n  private _isDebug: boolean = false;\n  public get isDebug(): boolean {\n    return this._isDebug;\n  }\n  public debugColor: Color = new Color(255, 255, 255);\n  /**\n   * Sets the background color for the engine.\n   */\n  public backgroundColor: Color;\n\n  /**\n   * Sets the Transparency for the engine.\n   */\n  public enableCanvasTransparency: boolean = true;\n\n  /**\n   * The action to take when a fatal exception is thrown\n   */\n  public onFatalException = (e: any) => {\n    Logger.getInstance().fatal(e);\n  };\n\n  /**\n   * The mouse wheel scroll prevention mode\n   */\n  public pageScrollPreventionMode: ScrollPreventionMode;\n\n  private _logger: Logger;\n\n  // this is a reference to the current requestAnimationFrame return value\n  private _requestId: number;\n\n  // this determines whether excalibur is compatible with your browser\n  private _compatible: boolean;\n\n  private _timescale: number = 1.0;\n\n  // loading\n  private _loader: CanLoad;\n  private _isLoading: boolean = false;\n\n  private _isInitialized: boolean = false;\n\n  public on(eventName: Events.initialize, handler: (event: Events.InitializeEvent<Engine>) => void): void;\n  public on(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\n  public on(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\n  public on(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\n  public on(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Engine>) => void): void;\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Engine>) => void): void;\n  public on(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\n  public on(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public on(eventName: string, handler: (event: any) => void): void {\n    super.on(eventName, handler);\n  }\n\n  public once(eventName: Events.initialize, handler: (event: Events.InitializeEvent<Engine>) => void): void;\n  public once(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\n  public once(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\n  public once(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\n  public once(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Engine>) => void): void;\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Engine>) => void): void;\n  public once(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\n  public once(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\n  public once(eventName: string, handler: (event: any) => void): void {\n    super.once(eventName, handler);\n  }\n\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<Engine>) => void): void;\n  public off(eventName: Events.visible, handler?: (event: VisibleEvent) => void): void;\n  public off(eventName: Events.hidden, handler?: (event: HiddenEvent) => void): void;\n  public off(eventName: Events.start, handler?: (event: GameStartEvent) => void): void;\n  public off(eventName: Events.stop, handler?: (event: GameStopEvent) => void): void;\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent<Engine>) => void): void;\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent<Engine>) => void): void;\n  public off(eventName: Events.preframe, handler?: (event: PreFrameEvent) => void): void;\n  public off(eventName: Events.postframe, handler?: (event: PostFrameEvent) => void): void;\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\n  public off(eventName: string, handler?: (event: any) => void): void {\n    super.off(eventName, handler);\n  }\n\n  /**\n   * Default [[EngineOptions]]\n   */\n  private static _DEFAULT_ENGINE_OPTIONS: EngineOptions = {\n    width: 0,\n    height: 0,\n    enableCanvasTransparency: true,\n    canvasElementId: '',\n    canvasElement: undefined,\n    pointerScope: Input.PointerScope.Document,\n    suppressConsoleBootMessage: null,\n    suppressMinimumBrowserFeatureDetection: null,\n    suppressHiDPIScaling: null,\n    suppressPlayButton: null,\n    scrollPreventionMode: ScrollPreventionMode.Canvas,\n    backgroundColor: Color.fromHex('#2185d0') // Excalibur blue\n  };\n\n  /**\n   * Creates a new game using the given [[EngineOptions]]. By default, if no options are provided,\n   * the game will be rendered full screen (taking up all available browser window space).\n   * You can customize the game rendering through [[EngineOptions]].\n   *\n   * Example:\n   *\n   * ```js\n   * var game = new ex.Engine({\n   *   width: 0, // the width of the canvas\n   *   height: 0, // the height of the canvas\n   *   enableCanvasTransparency: true, // the transparencySection of the canvas\n   *   canvasElementId: '', // the DOM canvas element ID, if you are providing your own\n   *   displayMode: ex.DisplayMode.FullScreen, // the display mode\n   *   pointerScope: ex.Input.PointerScope.Document, // the scope of capturing pointer (mouse/touch) events\n   *   backgroundColor: ex.Color.fromHex('#2185d0') // background color of the engine\n   * });\n   *\n   * // call game.start, which is a Promise\n   * game.start().then(function () {\n   *   // ready, set, go!\n   * });\n   * ```\n   */\n  constructor(options?: EngineOptions) {\n    super();\n\n    options = { ...Engine._DEFAULT_ENGINE_OPTIONS, ...options };\n\n    Flags.freeze();\n\n    // Initialize browser events facade\n    this.browser = new BrowserEvents(window, document);\n\n    // Check compatibility\n    const detector = new Detector();\n    if (!options.suppressMinimumBrowserFeatureDetection && !(this._compatible = detector.test())) {\n      const message = document.createElement('div');\n      message.innerText = 'Sorry, your browser does not support all the features needed for Excalibur';\n      document.body.appendChild(message);\n\n      detector.failedTests.forEach(function (test) {\n        const testMessage = document.createElement('div');\n        testMessage.innerText = 'Browser feature missing ' + test;\n        document.body.appendChild(testMessage);\n      });\n\n      if (options.canvasElementId) {\n        const canvas = document.getElementById(options.canvasElementId);\n        if (canvas) {\n          canvas.parentElement.removeChild(canvas);\n        }\n      }\n\n      return;\n    } else {\n      this._compatible = true;\n    }\n\n    // Use native console API for color fun\n    // eslint-disable-next-line no-console\n    if (console.log && !options.suppressConsoleBootMessage) {\n      // eslint-disable-next-line no-console\n      console.log(\n        `%cPowered by Excalibur.js (v${EX_VERSION})`,\n        'background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;'\n      );\n      // eslint-disable-next-line no-console\n      console.log('\\n\\\n      /| ________________\\n\\\nO|===|* >________________>\\n\\\n      \\\\|');\n      // eslint-disable-next-line no-console\n      console.log('Visit', 'http://excaliburjs.com', 'for more information');\n    }\n\n    // Suppress play button\n    if (options.suppressPlayButton) {\n      this._suppressPlayButton = true;\n    }\n\n    this._logger = Logger.getInstance();\n\n    // If debug is enabled, let's log browser features to the console.\n    if (this._logger.defaultLevel === LogLevel.Debug) {\n      detector.logBrowserFeatures();\n    }\n\n    this._logger.debug('Building engine...');\n\n    this.canvasElementId = options.canvasElementId;\n\n    if (options.canvasElementId) {\n      this._logger.debug('Using Canvas element specified: ' + options.canvasElementId);\n      this.canvas = <HTMLCanvasElement>document.getElementById(options.canvasElementId);\n    } else if (options.canvasElement) {\n      this._logger.debug('Using Canvas element specified:', options.canvasElement);\n      this.canvas = options.canvasElement;\n    } else {\n      this._logger.debug('Using generated canvas element');\n      this.canvas = <HTMLCanvasElement>document.createElement('canvas');\n    }\n\n    let displayMode = options.displayMode ?? DisplayMode.Fixed;\n    if ((options.width && options.height) || options.viewport) {\n      if (options.displayMode === undefined) {\n        displayMode = DisplayMode.Fixed;\n      }\n      this._logger.debug('Engine viewport is size ' + options.width + ' x ' + options.height);\n    } else if (!options.displayMode) {\n      this._logger.debug('Engine viewport is fullscreen');\n      displayMode = DisplayMode.FullScreen;\n    }\n\n    // eslint-disable-next-line\n    this.ctx = this.canvas.getContext('2d', { alpha: this.enableCanvasTransparency });\n\n    this.screen = new Screen({\n      canvas: this.canvas,\n      context: this.ctx,\n      antialiasing: options.antialiasing ?? true,\n      browser: this.browser,\n      viewport: options.viewport ?? { width: options.width, height: options.height },\n      resolution: options.resolution,\n      displayMode,\n      position: options.position,\n      pixelRatio: options.suppressHiDPIScaling ? 1 : null\n    });\n\n    this.screen.applyResolutionAndViewport();\n\n    if (options.backgroundColor) {\n      this.backgroundColor = options.backgroundColor.clone();\n    }\n\n    this.enableCanvasTransparency = options.enableCanvasTransparency;\n\n    this._loader = new Loader();\n    this.debug = new Debug(this);\n\n    this._initialize(options);\n\n    this.rootScene = this.currentScene = new Scene(this);\n\n    this.addScene('root', this.rootScene);\n    this.goToScene('root');\n  }\n\n  /**\n   * Returns a BoundingBox of the top left corner of the screen\n   * and the bottom right corner of the screen.\n   */\n  public getWorldBounds() {\n    return this.screen.getWorldBounds();\n  }\n\n  /**\n   * Gets the current engine timescale factor (default is 1.0 which is 1:1 time)\n   */\n  public get timescale() {\n    return this._timescale;\n  }\n\n  /**\n   * Sets the current engine timescale factor. Useful for creating slow-motion effects or fast-forward effects\n   * when using time-based movement.\n   */\n  public set timescale(value: number) {\n    if (value <= 0) {\n      Logger.getInstance().error('Cannot set engine.timescale to a value of 0 or less than 0.');\n      return;\n    }\n\n    this._timescale = value;\n  }\n\n  /**\n   * Plays a sprite animation on the screen at the specified `x` and `y`\n   * (in game coordinates, not screen pixels). These animations play\n   * independent of actors, and will be cleaned up internally as soon\n   * as they are complete. Note animations that loop will never be\n   * cleaned up.\n   *\n   * @param animation  Animation to play\n   * @param x          x game coordinate to play the animation\n   * @param y          y game coordinate to play the animation\n   * @deprecated\n   */\n  @obsolete({message: 'Will be removed in excalibur v0.26.0'})\n  public playAnimation(animation: Animation, x: number, y: number) {\n    this._animations.push(new AnimationNode(animation, x, y));\n  }\n\n  /**\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\n   * will be drawn and updated.\n   */\n  public addTileMap(tileMap: TileMap) {\n    this.currentScene.addTileMap(tileMap);\n  }\n\n  /**\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\n   */\n  public removeTileMap(tileMap: TileMap) {\n    this.currentScene.removeTileMap(tileMap);\n  }\n\n  /**\n   * Adds a [[Timer]] to the [[currentScene]].\n   * @param timer  The timer to add to the [[currentScene]].\n   */\n  public addTimer(timer: Timer): Timer {\n    return this.currentScene.addTimer(timer);\n  }\n\n  /**\n   * Removes a [[Timer]] from the [[currentScene]].\n   * @param timer  The timer to remove to the [[currentScene]].\n   */\n  public removeTimer(timer: Timer): Timer {\n    return this.currentScene.removeTimer(timer);\n  }\n\n  /**\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\n   * would levels or menus.\n   *\n   * @param key  The name of the scene, must be unique\n   * @param scene The scene to add to the engine\n   */\n  public addScene(key: string, scene: Scene) {\n    if (this.scenes[key]) {\n      this._logger.warn('Scene', key, 'already exists overwriting');\n    }\n    this.scenes[key] = scene;\n  }\n\n  /**\n   * Removes a [[Scene]] instance from the engine\n   * @param scene  The scene to remove\n   */\n  public removeScene(scene: Scene): void;\n  /**\n   * Removes a scene from the engine by key\n   * @param key  The scene key to remove\n   */\n  public removeScene(key: string): void;\n  /**\n   * @internal\n   */\n  public removeScene(entity: any): void {\n    if (entity instanceof Scene) {\n      // remove scene\n      for (const key in this.scenes) {\n        if (this.scenes.hasOwnProperty(key)) {\n          if (this.scenes[key] === entity) {\n            delete this.scenes[key];\n          }\n        }\n      }\n    }\n\n    if (typeof entity === 'string') {\n      // remove scene\n      delete this.scenes[entity];\n    }\n  }\n\n  /**\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\n   * would levels or menus.\n   * @param sceneKey  The key of the scene, must be unique\n   * @param scene     The scene to add to the engine\n   */\n  public add(sceneKey: string, scene: Scene): void;\n  /**\n   * Adds a [[Timer]] to the [[currentScene]].\n   * @param timer  The timer to add to the [[currentScene]].\n   */\n  public add(timer: Timer): void;\n  /**\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\n   * will be drawn and updated.\n   */\n  public add(tileMap: TileMap): void;\n  /**\n   * Adds an actor to the [[currentScene]] of the game. This is synonymous\n   * to calling `engine.currentScene.add(actor)`.\n   *\n   * Actors can only be drawn if they are a member of a scene, and only\n   * the [[currentScene]] may be drawn or updated.\n   *\n   * @param actor  The actor to add to the [[currentScene]]\n   */\n  public add(actor: Actor): void;\n\n  /**\n   * Adds a [[ScreenElement]] to the [[currentScene]] of the game,\n   * ScreenElements do not participate in collisions, instead the\n   * remain in the same place on the screen.\n   * @param screenElement  The ScreenElement to add to the [[currentScene]]\n   */\n  public add(screenElement: ScreenElement): void;\n  public add(entity: any): void {\n    if (arguments.length === 2) {\n      this.addScene(<string>arguments[0], <Scene>arguments[1]);\n    }\n    this.currentScene.add(entity);\n  }\n\n  /**\n   * Removes a scene instance from the engine\n   * @param scene  The scene to remove\n   */\n  public remove(scene: Scene): void;\n  /**\n   * Removes a scene from the engine by key\n   * @param sceneKey  The scene to remove\n   */\n  public remove(sceneKey: string): void;\n  /**\n   * Removes a [[Timer]] from the [[currentScene]].\n   * @param timer  The timer to remove to the [[currentScene]].\n   */\n  public remove(timer: Timer): void;\n  /**\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\n   */\n  public remove(tileMap: TileMap): void;\n  /**\n   * Removes an actor from the [[currentScene]] of the game. This is synonymous\n   * to calling `engine.currentScene.removeChild(actor)`.\n   * Actors that are removed from a scene will no longer be drawn or updated.\n   *\n   * @param actor  The actor to remove from the [[currentScene]].\n   */\n  public remove(actor: Actor): void;\n  /**\n   * Removes a [[ScreenElement]] to the scene, it will no longer be drawn or updated\n   * @param screenElement  The ScreenElement to remove from the [[currentScene]]\n   */\n  public remove(screenElement: ScreenElement): void;\n  public remove(entity: any): void {\n    if (entity instanceof Actor) {\n      this.currentScene.remove(entity);\n    }\n\n    if (entity instanceof Scene) {\n      this.removeScene(entity);\n    }\n\n    if (typeof entity === 'string') {\n      this.removeScene(entity);\n    }\n  }\n\n  /**\n   * Changes the currently updating and drawing scene to a different,\n   * named scene. Calls the [[Scene]] lifecycle events.\n   * @param key  The key of the scene to transition to.\n   */\n  public goToScene(key: string) {\n    if (this.scenes[key]) {\n      const oldScene = this.currentScene;\n      const newScene = this.scenes[key];\n\n      this._logger.debug('Going to scene:', key);\n\n      // only deactivate when initialized\n      if (this.currentScene.isInitialized) {\n        this.currentScene._deactivate.call(this.currentScene, [oldScene, newScene]);\n        this.currentScene.eventDispatcher.emit('deactivate', new DeactivateEvent(newScene, this.currentScene));\n      }\n\n      // set current scene to new one\n      this.currentScene = newScene;\n      this.screen.setCurrentCamera(newScene.camera);\n\n      // initialize the current scene if has not been already\n      this.currentScene._initialize(this);\n\n      this.currentScene._activate.call(this.currentScene, [oldScene, newScene]);\n      this.currentScene.eventDispatcher.emit('activate', new ActivateEvent(oldScene, this.currentScene));\n    } else {\n      this._logger.error('Scene', key, 'does not exist!');\n    }\n  }\n\n  /**\n   * Transforms the current x, y from screen coordinates to world coordinates\n   * @param point  Screen coordinate to convert\n   */\n  public screenToWorldCoordinates(point: Vector): Vector {\n    return this.screen.screenToWorldCoordinates(point);\n  }\n\n  /**\n   * Transforms a world coordinate, to a screen coordinate\n   * @param point  World coordinate to convert\n   */\n  public worldToScreenCoordinates(point: Vector): Vector {\n    return this.screen.worldToScreenCoordinates(point);\n  }\n\n  /**\n   * Initializes the internal canvas, rendering context, display mode, and native event listeners\n   */\n  private _initialize(options?: EngineOptions) {\n    this.pageScrollPreventionMode = options.scrollPreventionMode;\n\n    // initialize inputs\n    this.input = {\n      keyboard: new Input.Keyboard(),\n      pointers: new Input.Pointers(this),\n      gamepads: new Input.Gamepads()\n    };\n    this.input.keyboard.init();\n    this.input.pointers.init(options && options.pointerScope === Input.PointerScope.Document ? document : this.canvas);\n    this.input.gamepads.init();\n\n    // Issue #385 make use of the visibility api\n    // https://developer.mozilla.org/en-US/docs/Web/Guide/User_experience/Using_the_Page_Visibility_API\n\n    let hidden: keyof HTMLDocument, visibilityChange: string;\n    if (typeof document.hidden !== 'undefined') {\n      // Opera 12.10 and Firefox 18 and later support\n      hidden = 'hidden';\n      visibilityChange = 'visibilitychange';\n    } else if ('msHidden' in document) {\n      hidden = <keyof HTMLDocument>'msHidden';\n      visibilityChange = 'msvisibilitychange';\n    } else if ('webkitHidden' in document) {\n      hidden = <keyof HTMLDocument>'webkitHidden';\n      visibilityChange = 'webkitvisibilitychange';\n    }\n\n    this.browser.document.on(visibilityChange, () => {\n      if (document[hidden]) {\n        this.eventDispatcher.emit('hidden', new HiddenEvent(this));\n        this._logger.debug('Window hidden');\n      } else {\n        this.eventDispatcher.emit('visible', new VisibleEvent(this));\n        this._logger.debug('Window visible');\n      }\n    });\n\n    if (!this.canvasElementId && !options.canvasElement) {\n      document.body.appendChild(this.canvas);\n    }\n  }\n\n  public onInitialize(_engine: Engine) {\n    // Override me\n  }\n\n  /**\n   * If supported by the browser, this will set the antialiasing flag on the\n   * canvas. Set this to `false` if you want a 'jagged' pixel art look to your\n   * image resources.\n   * @param isSmooth  Set smoothing to true or false\n   */\n  public setAntialiasing(isSmooth: boolean) {\n    this.screen.antialiasing = isSmooth;\n  }\n\n  /**\n   * Return the current smoothing status of the canvas\n   */\n  public getAntialiasing(): boolean {\n    return this.screen.antialiasing;\n  }\n\n  /**\n   * Gets whether the actor is Initialized\n   */\n  public get isInitialized(): boolean {\n    return this._isInitialized;\n  }\n\n  private _overrideInitialize(engine: Engine) {\n    if (!this.isInitialized) {\n      this.onInitialize(engine);\n      super.emit('initialize', new InitializeEvent(engine, this));\n      this._isInitialized = true;\n    }\n  }\n\n  /**\n   * Updates the entire state of the game\n   * @param delta  Number of milliseconds elapsed since the last update.\n   */\n  private _update(delta: number) {\n    if (this._isLoading) {\n      // suspend updates until loading is finished\n      this._loader.update(this, delta);\n      // Update input listeners\n      this.input.keyboard.update();\n      this.input.pointers.update();\n      this.input.gamepads.update();\n      return;\n    }\n    this._overrideInitialize(this);\n    // Publish preupdate events\n    this._preupdate(delta);\n\n    // process engine level events\n    this.currentScene.update(this, delta);\n\n    // update animations\n    // TODO remove\n    this._animations = this._animations.filter(function (a) {\n      return !a.animation.isDone();\n    });\n\n    // Update input listeners\n    this.input.keyboard.update();\n    this.input.pointers.update();\n    this.input.gamepads.update();\n\n    // Publish update event\n    this._postupdate(delta);\n  }\n\n  /**\n   * @internal\n   */\n  public _preupdate(delta: number) {\n    this.emit('preupdate', new PreUpdateEvent(this, delta, this));\n    this.onPreUpdate(this, delta);\n  }\n\n  public onPreUpdate(_engine: Engine, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * @internal\n   */\n  public _postupdate(delta: number) {\n    this.emit('postupdate', new PostUpdateEvent(this, delta, this));\n    this.onPostUpdate(this, delta);\n  }\n\n  public onPostUpdate(_engine: Engine, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * Draws the entire game\n   * @param delta  Number of milliseconds elapsed since the last draw.\n   */\n  private _draw(delta: number) {\n    const ctx = this.ctx;\n    this._predraw(ctx, delta);\n\n    if (this._isLoading) {\n      this._loader.draw(ctx, delta);\n      // Drawing nothing else while loading\n      return;\n    }\n\n    ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight);\n    ctx.fillStyle = this.backgroundColor.toString();\n    ctx.fillRect(0, 0, this.canvasWidth, this.canvasHeight);\n\n    this.currentScene.draw(this.ctx, delta);\n\n    // todo needs to be a better way of doing this\n    let a = 0;\n    const len = this._animations.length;\n    for (a; a < len; a++) {\n      this._animations[a].animation.draw(ctx, this._animations[a].x, this._animations[a].y);\n    }\n\n    // Draw debug information\n    if (this.isDebug) {\n      this.ctx.font = 'Consolas';\n      this.ctx.fillStyle = this.debugColor.toString();\n      const keys = this.input.keyboard.getKeys();\n      for (let j = 0; j < keys.length; j++) {\n        this.ctx.fillText(keys[j].toString() + ' : ' + (Input.Keys[keys[j]] ? Input.Keys[keys[j]] : 'Not Mapped'), 100, 10 * j + 10);\n      }\n\n      this.ctx.fillText('FPS:' + this.stats.currFrame.fps.toFixed(2).toString(), 10, 10);\n    }\n\n    // Post processing\n    for (let i = 0; i < this.postProcessors.length; i++) {\n      this.postProcessors[i].process(this.ctx.getImageData(0, 0, this.canvasWidth, this.canvasHeight), this.ctx);\n    }\n\n    this._postdraw(ctx, delta);\n  }\n\n  /**\n   * @internal\n   */\n  public _predraw(_ctx: CanvasRenderingContext2D, delta: number) {\n    this.emit('predraw', new PreDrawEvent(_ctx, delta, this));\n    this.onPreDraw(_ctx, delta);\n  }\n\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * @internal\n   */\n  public _postdraw(_ctx: CanvasRenderingContext2D, delta: number) {\n    this.emit('postdraw', new PostDrawEvent(_ctx, delta, this));\n    this.onPostDraw(_ctx, delta);\n  }\n\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number) {\n    // Override me\n  }\n\n  /**\n   * Enable or disable Excalibur debugging functionality.\n   * @param toggle a value that debug drawing will be changed to\n   */\n  public showDebug(toggle: boolean): void {\n    this._isDebug = toggle;\n  }\n\n  /**\n   * Toggle Excalibur debugging functionality.\n   */\n  public toggleDebug(): boolean {\n    this._isDebug = !this._isDebug;\n    return this._isDebug;\n  }\n\n  /**\n   * Starts the internal game loop for Excalibur after loading\n   * any provided assets.\n   * @param loader  Optional [[Loader]] to use to load resources. The default loader is [[Loader]], override to provide your own\n   * custom loader.\n   */\n  public start(loader?: Loader): Promise<any> {\n    if (!this._compatible) {\n      return Promise.reject('Excalibur is incompatible with your browser');\n    }\n    // Changing resolution invalidates context state, so we need to capture it before applying\n    this.screen.pushResolutionAndViewport();\n    this.screen.resolution = this.screen.viewport;\n    this.screen.applyResolutionAndViewport();\n\n    let loadingComplete: Promise<any>;\n    if (loader) {\n      this._loader = loader;\n      this._loader.suppressPlayButton = this._suppressPlayButton || this._loader.suppressPlayButton;\n      this._loader.wireEngine(this);\n      loadingComplete = this.load(this._loader);\n    } else {\n      loadingComplete = Promise.resolve();\n    }\n\n    loadingComplete.then(() => {\n      this.screen.popResolutionAndViewport();\n      this.screen.applyResolutionAndViewport();\n      this.emit('start', new GameStartEvent(this));\n    });\n\n    if (!this._hasStarted) {\n      this._hasStarted = true;\n      this._logger.debug('Starting game...');\n      this.browser.resume();\n      Engine.createMainLoop(this, window.requestAnimationFrame, Date.now)();\n\n      this._logger.debug('Game started');\n    } else {\n      // Game already started;\n    }\n    return loadingComplete;\n  }\n\n  public static createMainLoop(game: Engine, raf: (func: Function) => number, nowFn: () => number) {\n    let lastTime = nowFn();\n\n    return function mainloop() {\n      if (!game._hasStarted) {\n        return;\n      }\n      try {\n        game._requestId = raf(mainloop);\n        game.emit('preframe', new PreFrameEvent(game, game.stats.prevFrame));\n\n        // Get the time to calculate time-elapsed\n        const now = nowFn();\n        let elapsed = Math.floor(now - lastTime) || 1;\n        // Resolves issue #138 if the game has been paused, or blurred for\n        // more than a 200 milliseconds, reset elapsed time to 1. This improves reliability\n        // and provides more expected behavior when the engine comes back\n        // into focus\n        if (elapsed > 200) {\n          elapsed = 1;\n        }\n        const delta = elapsed * game.timescale;\n\n        // reset frame stats (reuse existing instances)\n        const frameId = game.stats.prevFrame.id + 1;\n        game.stats.currFrame.reset();\n        game.stats.currFrame.id = frameId;\n        game.stats.currFrame.delta = delta;\n        game.stats.currFrame.fps = 1.0 / (delta / 1000);\n\n        const beforeUpdate = nowFn();\n        game._update(delta);\n        const afterUpdate = nowFn();\n        game._draw(delta);\n        const afterDraw = nowFn();\n\n        game.stats.currFrame.duration.update = afterUpdate - beforeUpdate;\n        game.stats.currFrame.duration.draw = afterDraw - afterUpdate;\n\n        lastTime = now;\n\n        game.emit('postframe', new PostFrameEvent(game, game.stats.currFrame));\n        game.stats.prevFrame.reset(game.stats.currFrame);\n      } catch (e) {\n        window.cancelAnimationFrame(game._requestId);\n        game.stop();\n        game.onFatalException(e);\n      }\n    };\n  }\n\n  /**\n   * Stops Excalibur's main loop, useful for pausing the game.\n   */\n  public stop() {\n    if (this._hasStarted) {\n      this.emit('stop', new GameStopEvent(this));\n      this.browser.pause();\n      this._hasStarted = false;\n      this._logger.debug('Game stopped');\n    }\n  }\n\n  /**\n   * Returns the Engine's Running status, Useful for checking whether engine is running or paused.\n   */\n  public isPaused(): boolean {\n    return !this._hasStarted;\n  }\n\n  /**\n   * Takes a screen shot of the current viewport and returns it as an\n   * HTML Image Element.\n   */\n  public screenshot(): HTMLImageElement {\n    const result = new Image();\n    const raw = this.canvas.toDataURL('image/png');\n    result.src = raw;\n    return result;\n  }\n\n  /**\n   * Another option available to you to load resources into the game.\n   * Immediately after calling this the game will pause and the loading screen\n   * will appear.\n   * @param loader  Some [[Loadable]] such as a [[Loader]] collection, [[Sound]], or [[Texture]].\n   */\n  public load(loader: Loadable): Promise<any> {\n    const complete = new Promise<any>((resolve) => {\n      this._isLoading = true;\n\n      loader.load().then(() => {\n        if (this._suppressPlayButton) {\n          setTimeout(() => {\n            this._isLoading = false;\n            resolve();\n            // Delay is to give the logo a chance to show, otherwise don't delay\n          }, 500);\n        } else {\n          this._isLoading = false;\n          resolve();\n        }\n      });\n    });\n\n    return complete;\n  }\n}\n\n/**\n * @internal\n * @deprecated\n */\n@obsolete({message: 'Will be removed in excalibur v0.26.0'})\nclass AnimationNode {\n  constructor(public animation: Animation, public x: number, public y: number) {}\n}\n","import { GameEvent } from '../Events';\nimport { Sound } from '../Resources/Sound/Sound';\nimport { Actor } from '../Actor';\nimport { WebAudioInstance } from '../Resources/Sound/WebAudioInstance';\n\nexport class MediaEvent extends GameEvent<Sound> {\n  /**\n   * Media event cannot bubble\n   */\n  public set bubbles(_value: boolean) {\n    // stubbed\n  }\n  /**\n   * Media event cannot bubble\n   */\n  public get bubbles(): boolean {\n    return false;\n  }\n  /**\n   * Media event cannot bubble, so they have no path\n   */\n  protected get _path(): Actor[] {\n    return null;\n  }\n  /**\n   * Media event cannot bubble, so they have no path\n   */\n  protected set _path(_val: Actor[]) {\n    // stubbed\n  }\n\n  constructor(public target: Sound, protected _name: string = 'MediaEvent') {\n    super();\n  }\n\n  /**\n   * Prevents event from bubbling\n   */\n  public stopPropagation(): void {\n    /**\n     * Stub\n     */\n  }\n  /**\n   * Action, that calls when event happens\n   */\n  public action(): void {\n    /**\n     * Stub\n     */\n  }\n  /**\n   * Propagate event further through event path\n   */\n  public propagate(): void {\n    /**\n     * Stub\n     */\n  }\n\n  public layPath(_actor: Actor): void {\n    /**\n     * Stub\n     */\n  }\n}\n\nexport class NativeSoundEvent extends MediaEvent {\n  constructor(target: Sound, public track?: WebAudioInstance) {\n    super(target, 'NativeSoundEvent');\n  }\n}\n\nexport class NativeSoundProcessedEvent extends MediaEvent {\n  public data: string | AudioBuffer;\n\n  constructor(target: Sound, private _processedData: string | AudioBuffer) {\n    super(target, 'NativeSoundProcessedEvent');\n\n    this.data = this._processedData;\n  }\n}\n","import { Engine } from './Engine';\nimport { Actor } from './Actor';\nimport { Sprite } from './Drawing/Sprite';\nimport { Color } from './Drawing/Color';\nimport { Vector } from './Algebra';\nimport * as Util from './Util/Util';\nimport * as DrawUtil from './Util/DrawUtil';\nimport * as Traits from './Traits/Index';\nimport { Configurable } from './Configurable';\nimport { Random } from './Math/Random';\nimport { CollisionType } from './Collision/CollisionType';\n\n/**\n * An enum that represents the types of emitter nozzles\n */\nexport enum EmitterType {\n  /**\n   * Constant for the circular emitter type\n   */\n  Circle,\n  /**\n   * Constant for the rectangular emitter type\n   */\n  Rectangle\n}\n\n/**\n * @hidden\n */\nexport class ParticleImpl {\n  public position: Vector = new Vector(0, 0);\n  public velocity: Vector = new Vector(0, 0);\n  public acceleration: Vector = new Vector(0, 0);\n  public particleRotationalVelocity: number = 0;\n  public currentRotation: number = 0;\n\n  public focus: Vector = null;\n  public focusAccel: number = 0;\n  public opacity: number = 1;\n  public beginColor: Color = Color.White;\n  public endColor: Color = Color.White;\n\n  // Life is counted in ms\n  public life: number = 300;\n  public fadeFlag: boolean = false;\n\n  // Color transitions\n  private _rRate: number = 1;\n  private _gRate: number = 1;\n  private _bRate: number = 1;\n  private _aRate: number = 0;\n  private _currentColor: Color = Color.White;\n\n  public emitter: ParticleEmitter = null;\n  public particleSize: number = 5;\n  public particleSprite: Sprite = null;\n\n  public startSize: number;\n  public endSize: number;\n  public sizeRate: number = 0;\n  public elapsedMultiplier: number = 0;\n\n  constructor(\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  ) {\n    let emitter = emitterOrConfig;\n    if (emitter && !(emitterOrConfig instanceof ParticleEmitter)) {\n      const config = emitterOrConfig;\n      emitter = config.emitter;\n      life = config.life;\n      opacity = config.opacity;\n      endColor = config.endColor;\n      beginColor = config.beginColor;\n      position = config.position;\n      velocity = config.velocity;\n      acceleration = config.acceleration;\n      startSize = config.startSize;\n      endSize = config.endSize;\n    }\n    this.emitter = <ParticleEmitter>emitter;\n    this.life = life || this.life;\n    this.opacity = opacity || this.opacity;\n    this.endColor = endColor || this.endColor.clone();\n    this.beginColor = beginColor || this.beginColor.clone();\n    this._currentColor = this.beginColor.clone();\n    this.position = position || this.position;\n    this.velocity = velocity || this.velocity;\n    this.acceleration = acceleration || this.acceleration;\n    this._rRate = (this.endColor.r - this.beginColor.r) / this.life;\n    this._gRate = (this.endColor.g - this.beginColor.g) / this.life;\n    this._bRate = (this.endColor.b - this.beginColor.b) / this.life;\n    this._aRate = this.opacity / this.life;\n\n    this.startSize = startSize || 0;\n    this.endSize = endSize || 0;\n\n    if (this.endSize > 0 && this.startSize > 0) {\n      this.sizeRate = (this.endSize - this.startSize) / this.life;\n      this.particleSize = this.startSize;\n    }\n  }\n\n  public kill() {\n    this.emitter.removeParticle(this);\n  }\n\n  public update(delta: number) {\n    this.life = this.life - delta;\n    this.elapsedMultiplier = this.elapsedMultiplier + delta;\n\n    if (this.life < 0) {\n      this.kill();\n    }\n\n    if (this.fadeFlag) {\n      this.opacity = Util.clamp(this._aRate * this.life, 0.0001, 1);\n    }\n\n    if (this.startSize > 0 && this.endSize > 0) {\n      this.particleSize = Util.clamp(\n        this.sizeRate * delta + this.particleSize,\n        Math.min(this.startSize, this.endSize),\n        Math.max(this.startSize, this.endSize)\n      );\n    }\n\n    this._currentColor.r = Util.clamp(this._currentColor.r + this._rRate * delta, 0, 255);\n    this._currentColor.g = Util.clamp(this._currentColor.g + this._gRate * delta, 0, 255);\n    this._currentColor.b = Util.clamp(this._currentColor.b + this._bRate * delta, 0, 255);\n    this._currentColor.a = Util.clamp(this.opacity, 0.0001, 1);\n\n    if (this.focus) {\n      const accel = this.focus\n        .sub(this.position)\n        .normalize()\n        .scale(this.focusAccel)\n        .scale(delta / 1000);\n      this.velocity = this.velocity.add(accel);\n    } else {\n      this.velocity = this.velocity.add(this.acceleration.scale(delta / 1000));\n    }\n    this.position = this.position.add(this.velocity.scale(delta / 1000));\n\n    if (this.particleRotationalVelocity) {\n      this.currentRotation = (this.currentRotation + (this.particleRotationalVelocity * delta) / 1000) % (2 * Math.PI);\n    }\n  }\n\n  public draw(ctx: CanvasRenderingContext2D) {\n    if (this.particleSprite) {\n      this.particleSprite.rotation = this.currentRotation;\n      this.particleSprite.scale.setTo(this.particleSize, this.particleSize);\n      this.particleSprite.draw(ctx, this.position.x, this.position.y);\n      return;\n    }\n\n    this._currentColor.a = Util.clamp(this.opacity, 0.0001, 1);\n    ctx.fillStyle = this._currentColor.toString();\n    ctx.beginPath();\n    ctx.arc(this.position.x, this.position.y, this.particleSize, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.closePath();\n  }\n}\n\nexport interface ParticleArgs extends Partial<ParticleImpl> {\n  emitter: ParticleEmitter;\n  position?: Vector;\n  velocity?: Vector;\n  acceleration?: Vector;\n  particleRotationalVelocity?: number;\n  currentRotation?: number;\n  particleSize?: number;\n  particleSprite?: Sprite;\n}\n\n/**\n * Particle is used in a [[ParticleEmitter]]\n */\nexport class Particle extends Configurable(ParticleImpl) {\n  constructor(config: ParticleArgs);\n  constructor(\n    emitter: ParticleEmitter,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  );\n  constructor(\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\n    life?: number,\n    opacity?: number,\n    beginColor?: Color,\n    endColor?: Color,\n    position?: Vector,\n    velocity?: Vector,\n    acceleration?: Vector,\n    startSize?: number,\n    endSize?: number\n  ) {\n    super(emitterOrConfig, life, opacity, beginColor, endColor, position, velocity, acceleration, startSize, endSize);\n  }\n}\n\n/**\n * @hidden\n */\nexport class ParticleEmitterImpl extends Actor {\n  private _particlesToEmit: number;\n\n  public numParticles: number = 0;\n\n  /**\n   * Random number generator\n   */\n  public random: Random;\n\n  /**\n   * Gets or sets the isEmitting flag\n   */\n  public isEmitting: boolean = true;\n  /**\n   * Gets or sets the backing particle collection\n   */\n  public particles: Util.Collection<Particle> = null;\n\n  /**\n   * Gets or sets the backing deadParticle collection\n   */\n  public deadParticles: Util.Collection<Particle> = null;\n\n  /**\n   * Gets or sets the minimum particle velocity\n   */\n  public minVel: number = 0;\n  /**\n   * Gets or sets the maximum particle velocity\n   */\n  public maxVel: number = 0;\n\n  /**\n   * Gets or sets the acceleration vector for all particles\n   */\n  public acceleration: Vector = new Vector(0, 0);\n\n  /**\n   * Gets or sets the minimum angle in radians\n   */\n  public minAngle: number = 0;\n  /**\n   * Gets or sets the maximum angle in radians\n   */\n  public maxAngle: number = 0;\n\n  /**\n   * Gets or sets the emission rate for particles (particles/sec)\n   */\n  public emitRate: number = 1; //particles/sec\n  /**\n   * Gets or sets the life of each particle in milliseconds\n   */\n  public particleLife: number = 2000;\n  /**\n   * Gets or sets the opacity of each particle from 0 to 1.0\n   */\n  public opacity: number = 1;\n  /**\n   * Gets or sets the fade flag which causes particles to gradually fade out over the course of their life.\n   */\n  public fadeFlag: boolean = false;\n\n  /**\n   * Gets or sets the optional focus where all particles should accelerate towards\n   */\n  public focus: Vector = null;\n  /**\n   * Gets or sets the acceleration for focusing particles if a focus has been specified\n   */\n  public focusAccel: number = 1;\n  /*\n   * Gets or sets the optional starting size for the particles\n   */\n  public startSize: number = null;\n  /*\n   * Gets or sets the optional ending size for the particles\n   */\n  public endSize: number = null;\n\n  /**\n   * Gets or sets the minimum size of all particles\n   */\n  public minSize: number = 5;\n  /**\n   * Gets or sets the maximum size of all particles\n   */\n  public maxSize: number = 5;\n\n  /**\n   * Gets or sets the beginning color of all particles\n   */\n  public beginColor: Color = Color.White;\n  /**\n   * Gets or sets the ending color of all particles\n   */\n  public endColor: Color = Color.White;\n\n  /**\n   * Gets or sets the sprite that a particle should use\n   * @warning Performance intensive\n   */\n  public particleSprite: Sprite = null;\n\n  /**\n   * Gets or sets the emitter type for the particle emitter\n   */\n  public emitterType: EmitterType = EmitterType.Rectangle;\n\n  /**\n   * Gets or sets the emitter radius, only takes effect when the [[emitterType]] is [[EmitterType.Circle]]\n   */\n  public radius: number = 0;\n\n  /**\n   * Gets or sets the particle rotational speed velocity\n   */\n  public particleRotationalVelocity: number = 0;\n\n  /**\n   * Indicates whether particles should start with a random rotation\n   */\n  public randomRotation: boolean = false;\n\n  /**\n   * @param xOrConfig The x position of the emitter, or the particle emitter options bag\n   * @param y         The y position of the emitter\n   * @param width     The width of the emitter\n   * @param height    The height of the emitter\n   */\n  constructor(xOrConfig?: number | ParticleEmitterArgs, y?: number, width?: number, height?: number) {\n    super(typeof xOrConfig === 'number' ? { pos: new Vector(xOrConfig, y), width: width, height: height } : xOrConfig);\n    this._particlesToEmit = 0;\n    this.body.collider.type = CollisionType.PreventCollision;\n    this.particles = new Util.Collection<Particle>();\n    this.deadParticles = new Util.Collection<Particle>();\n    this.random = new Random();\n\n    // Remove offscreen culling from particle emitters\n    for (let i = 0; i < this.traits.length; i++) {\n      if (this.traits[i] instanceof Traits.OffscreenCulling) {\n        this.traits.splice(i, 1);\n      }\n    }\n  }\n\n  public removeParticle(particle: Particle) {\n    this.deadParticles.push(particle);\n  }\n\n  /**\n   * Causes the emitter to emit particles\n   * @param particleCount  Number of particles to emit right now\n   */\n  public emitParticles(particleCount: number) {\n    for (let i = 0; i < particleCount; i++) {\n      this.particles.push(this._createParticle());\n    }\n  }\n\n  public clearParticles() {\n    this.particles.clear();\n  }\n\n  // Creates a new particle given the constraints of the emitter\n  private _createParticle(): Particle {\n    // todo implement emitter constraints;\n    let ranX = 0;\n    let ranY = 0;\n\n    const angle = Util.randomInRange(this.minAngle, this.maxAngle, this.random);\n    const vel = Util.randomInRange(this.minVel, this.maxVel, this.random);\n    const size = this.startSize || Util.randomInRange(this.minSize, this.maxSize, this.random);\n    const dx = vel * Math.cos(angle);\n    const dy = vel * Math.sin(angle);\n\n    if (this.emitterType === EmitterType.Rectangle) {\n      ranX = Util.randomInRange(0, this.width, this.random);\n      ranY = Util.randomInRange(0, this.height, this.random);\n    } else if (this.emitterType === EmitterType.Circle) {\n      const radius = Util.randomInRange(0, this.radius, this.random);\n      ranX = radius * Math.cos(angle);\n      ranY = radius * Math.sin(angle);\n    }\n\n    const p = new Particle(\n      this,\n      this.particleLife,\n      this.opacity,\n      this.beginColor,\n      this.endColor,\n      new Vector(ranX, ranY),\n      new Vector(dx, dy),\n      this.acceleration,\n      this.startSize,\n      this.endSize\n    );\n    p.fadeFlag = this.fadeFlag;\n    p.particleSize = size;\n    if (this.particleSprite) {\n      p.particleSprite = this.particleSprite;\n    }\n    p.particleRotationalVelocity = this.particleRotationalVelocity;\n    if (this.randomRotation) {\n      p.currentRotation = Util.randomInRange(0, Math.PI * 2, this.random);\n    }\n    if (this.focus) {\n      p.focus = this.focus.add(new Vector(this.pos.x, this.pos.y));\n      p.focusAccel = this.focusAccel;\n    }\n    return p;\n  }\n\n  public update(engine: Engine, delta: number) {\n    super.update(engine, delta);\n\n    if (this.isEmitting) {\n      this._particlesToEmit += this.emitRate * (delta / 1000);\n      //var numParticles = Math.ceil(this.emitRate * delta / 1000);\n      if (this._particlesToEmit > 1.0) {\n        this.emitParticles(Math.floor(this._particlesToEmit));\n        this._particlesToEmit = this._particlesToEmit - Math.floor(this._particlesToEmit);\n      }\n    }\n\n    this.particles.forEach((p) => p.update(delta));\n    this.deadParticles.forEach((p) => this.particles.removeElement(p));\n    this.deadParticles.clear();\n  }\n\n  public draw(ctx: CanvasRenderingContext2D) {\n    // todo is there a more efficient to draw\n    // possibly use a webgl offscreen canvas and shaders to do particles?\n    this.particles.forEach((p) => p.draw(ctx));\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    super.debugDraw(ctx);\n    ctx.fillStyle = Color.Black.toString();\n    ctx.fillText('Particles: ' + this.particles.count(), this.pos.x, this.pos.y + 20);\n\n    if (this.focus) {\n      ctx.fillRect(this.focus.x + this.pos.x, this.focus.y + this.pos.y, 3, 3);\n      DrawUtil.line(ctx, Color.Yellow, this.focus.x + this.pos.x, this.focus.y + this.pos.y, this.center.x, this.center.y);\n      ctx.fillText('Focus', this.focus.x + this.pos.x, this.focus.y + this.pos.y);\n    }\n  }\n}\n\nexport interface ParticleEmitterArgs extends Partial<ParticleEmitterImpl> {\n  width?: number;\n  height?: number;\n  isEmitting?: boolean;\n  minVel?: number;\n  maxVel?: number;\n  acceleration?: Vector;\n  minAngle?: number;\n  maxAngle?: number;\n  emitRate?: number;\n  particleLife?: number;\n  opacity?: number;\n  fadeFlag?: boolean;\n  focus?: Vector;\n  focusAccel?: number;\n  startSize?: number;\n  endSize?: number;\n  minSize?: number;\n  maxSize?: number;\n  beginColor?: Color;\n  endColor?: Color;\n  particleSprite?: Sprite;\n  emitterType?: EmitterType;\n  radius?: number;\n  particleRotationalVelocity?: number;\n  randomRotation?: boolean;\n  random?: Random;\n}\n\n/**\n * Using a particle emitter is a great way to create interesting effects\n * in your game, like smoke, fire, water, explosions, etc. `ParticleEmitter`\n * extend [[Actor]] allowing you to use all of the features that come with.\n */\nexport class ParticleEmitter extends Configurable(ParticleEmitterImpl) {\n  constructor(config?: ParticleEmitterArgs);\n  constructor(x?: number | ParticleEmitterArgs, y?: number, width?: number, height?: number);\n  constructor(xOrConfig?: number | ParticleEmitterArgs, y?: number, width?: number, height?: number) {\n    super(xOrConfig, y, width, height);\n  }\n}\n","export * from './ActionContext';\nexport * from './Actionable';\nexport * from './RotationType';\n\nimport * as actions from './Action';\nexport { actions as Actions };\n\n// legacy Internal.Actions namespace support\nexport const Internal = { Actions: actions };\n","import { CollisionGroup } from './CollisionGroup';\n\n/**\n * Static class for managing collision groups in excalibur, there is a maximum of 32 collision groups possible in excalibur\n */\nexport class CollisionGroupManager {\n  // using bitmasking the maximum number of groups is 32, because that is the highest 32bit integer that JS can present.\n  private static _STARTING_BIT = 0b1 | 0;\n  private static _MAX_GROUPS = 32;\n  private static _CURRENT_GROUP = 1;\n  private static _CURRENT_BIT = CollisionGroupManager._STARTING_BIT;\n  private static _GROUPS: Map<string, CollisionGroup> = new Map<string, CollisionGroup>();\n\n  /**\n   * Create a new named collision group up to a max of 32.\n   * @param name Name for the collision group\n   * @param mask Optionally provide your own 32-bit mask, if none is provide the manager will generate one\n   */\n  public static create(name: string, mask?: number) {\n    if (this._CURRENT_GROUP > this._MAX_GROUPS) {\n      throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);\n    }\n    if (this._GROUPS.get(name)) {\n      throw new Error(`Collision group ${name} already exists`);\n    }\n    const group = new CollisionGroup(name, this._CURRENT_BIT, mask !== undefined ? mask : ~this._CURRENT_BIT);\n    this._CURRENT_BIT = (this._CURRENT_BIT << 1) | 0;\n    this._CURRENT_GROUP++;\n    this._GROUPS.set(name, group);\n    return group;\n  }\n\n  /**\n   * Get all collision groups currently tracked by excalibur\n   */\n  public static get groups(): CollisionGroup[] {\n    return Array.from(this._GROUPS.values());\n  }\n\n  /**\n   * Get a collision group by it's name\n   * @param name\n   */\n  public static groupByName(name: string) {\n    return this._GROUPS.get(name);\n  }\n\n  /**\n   * Resets the managers internal group management state\n   */\n  public static reset() {\n    this._GROUPS = new Map<string, CollisionGroup>();\n    this._CURRENT_BIT = this._STARTING_BIT;\n    this._CURRENT_GROUP = 1;\n  }\n}\n","import { Color } from './Color';\nimport * as Effects from './SpriteEffects';\n\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\nimport { Vector } from '../Algebra';\n\n/**\n * Creates a closed polygon drawing given a list of [[Vector]]s.\n *\n * @warning Use sparingly as Polygons are performance intensive\n */\nexport class Polygon implements Drawable {\n  public flipVertical: boolean;\n  public flipHorizontal: boolean;\n  public drawWidth: number;\n  public drawHeight: number;\n\n  public width: number;\n  public height: number;\n\n  /**\n   * The color to use for the lines of the polygon\n   */\n  public lineColor: Color;\n  /**\n   * The color to use for the interior of the polygon\n   */\n  public fillColor: Color;\n  /**\n   * The width of the lines of the polygon\n   */\n  public lineWidth: number = 5;\n  /**\n   * Indicates whether the polygon is filled or not.\n   */\n  public filled: boolean = false;\n\n  private _points: Vector[] = [];\n  public anchor = Vector.Zero;\n  public offset = Vector.Zero;\n  public rotation: number = 0;\n  public scale = Vector.One;\n  public opacity: number = 1;\n\n  /**\n   * @param points  The vectors to use to build the polygon in order\n   */\n  constructor(points: Vector[]) {\n    this._points = points;\n\n    const minX = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.min(prev, curr.x);\n    }, 0);\n    const maxX = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.max(prev, curr.x);\n    }, 0);\n\n    this.drawWidth = maxX - minX;\n\n    const minY = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.min(prev, curr.y);\n    }, 0);\n    const maxY = this._points.reduce((prev: number, curr: Vector) => {\n      return Math.max(prev, curr.y);\n    }, 0);\n\n    this.drawHeight = maxY - minY;\n\n    this.height = this.drawHeight;\n    this.width = this.drawWidth;\n  }\n\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public addEffect() {\n    // not supported on polygons\n  }\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public removeEffect(index: number): void;\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public removeEffect(effect: Effects.SpriteEffect): void;\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public removeEffect() {\n    // not supported on polygons\n  }\n\n  /**\n   * @notimplemented Effects are not supported on `Polygon`\n   */\n  public clearEffects() {\n    // not supported on polygons\n  }\n\n  public reset() {\n    //pass\n  }\n\n  /**\n   * Draws the sprite appropriately to the 2D rendering context, at an x and y coordinate.\n   * @param ctx  The 2D rendering context\n   * @param x    The x coordinate of where to draw\n   * @param y    The y coordinate of where to draw\n   */\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\n  /**\n   * Draws the sprite with custom options to override internals without mutating them.\n   * @param options\n   */\n  public draw(options: DrawOptions): void;\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number): void {\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\n    } else {\n      this._drawWithOptions(ctxOrOptions);\n    }\n  }\n\n  private _drawWithOptions(options: DrawOptions) {\n    const { ctx, x, y, rotation, drawWidth, drawHeight, anchor, offset, opacity, flipHorizontal, flipVertical } = {\n      ...options,\n      rotation: options.rotation ?? this.rotation,\n      drawWidth: options.drawWidth ?? this.drawWidth,\n      drawHeight: options.drawHeight ?? this.drawHeight,\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\n      flipVertical: options.flipVertical ?? this.flipVertical,\n      anchor: options.anchor ?? this.anchor,\n      offset: options.offset ?? this.offset,\n      opacity: options.opacity ?? this.opacity\n    };\n\n    const xpoint = drawWidth * anchor.x + offset.x + x;\n    const ypoint = drawHeight * anchor.y + offset.y + y;\n\n    ctx.save();\n    ctx.translate(xpoint, ypoint);\n    ctx.scale(this.scale.x, this.scale.y);\n    ctx.rotate(rotation);\n    ctx.beginPath();\n    ctx.lineWidth = this.lineWidth;\n\n    // Iterate through the supplied points and construct a 'polygon'\n    const firstPoint = this._points[0];\n    ctx.moveTo(firstPoint.x, firstPoint.y);\n\n    let i = 0;\n    const len = this._points.length;\n\n    for (i; i < len; i++) {\n      ctx.lineTo(this._points[i].x, this._points[i].y);\n    }\n\n    ctx.lineTo(firstPoint.x, firstPoint.y);\n    ctx.closePath();\n\n    if (this.filled) {\n      ctx.fillStyle = this.fillColor.toString();\n      ctx.fill();\n    }\n\n    ctx.strokeStyle = this.lineColor.toString();\n\n    if (flipHorizontal) {\n      ctx.translate(drawWidth, 0);\n      ctx.scale(-1, 1);\n    }\n\n    if (flipVertical) {\n      ctx.translate(0, drawHeight);\n      ctx.scale(1, -1);\n    }\n\n    const oldAlpha = ctx.globalAlpha;\n    ctx.globalAlpha = opacity ?? 1;\n    ctx.stroke();\n    ctx.globalAlpha = oldAlpha;\n\n    ctx.restore();\n  }\n}\n","import { Sprite, SpriteArgs } from './Sprite';\nimport { Animation } from './Animation';\nimport { Color } from './Color';\nimport * as Effects from './SpriteEffects';\n\nimport { Texture } from '../Resources/Texture';\nimport { Engine } from '../Engine';\nimport { Logger } from '../Util/Log';\nimport { TextAlign, BaseAlign } from '../Label';\nimport { Configurable } from '../Configurable';\n\n/**\n * @hidden\n */\nexport class SpriteSheetImpl {\n  public sprites: Sprite[] = [];\n  public image: Texture = null;\n  public columns: number = 0;\n  public rows: number = 0;\n  public spWidth: number = 0;\n  public spHeight: number = 0;\n  public spacing: number = 0;\n  /**\n   * @param imageOrConfigOrSprites The backing image texture to build the SpriteSheet, option bag, or sprite list\n   * @param columns   The number of columns in the image texture\n   * @param rows      The number of rows in the image texture\n   * @param spWidth   The width of each individual sprite in pixels\n   * @param spHeight  The height of each individual sprite in pixels\n   * @param spacing   The spacing between every sprite in a spritesheet\n   */\n  constructor(\n    imageOrConfigOrSprites: Texture | SpriteSheetArgs | Sprite[],\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number\n  ) {\n    let loadFromImage: boolean = false;\n    if (imageOrConfigOrSprites instanceof Array) {\n      this.sprites = imageOrConfigOrSprites;\n    } else {\n      if (imageOrConfigOrSprites && !(imageOrConfigOrSprites instanceof Texture)) {\n        this.columns = imageOrConfigOrSprites.columns;\n        this.rows = imageOrConfigOrSprites.rows;\n        this.spWidth = imageOrConfigOrSprites.spWidth;\n        this.spHeight = imageOrConfigOrSprites.spHeight;\n        this.image = imageOrConfigOrSprites.image;\n        this.spacing = imageOrConfigOrSprites.spacing || 0;\n      } else {\n        this.image = <Texture>imageOrConfigOrSprites;\n        this.columns = columns;\n        this.rows = rows;\n        this.spWidth = spWidth;\n        this.spHeight = spHeight;\n        this.spacing = spacing || 0;\n      }\n      this.sprites = new Array(this.columns * this.rows);\n      loadFromImage = true;\n    }\n\n    // Inspect actual image dimensions with preloading\n    if (this.image instanceof Texture) {\n      let isWidthError: boolean = false;\n      let isHeightError: boolean = false;\n      if (this.image.isLoaded()) {\n        isWidthError = this.spWidth * this.columns > this.image.image.naturalWidth;\n        isHeightError = this.spHeight * this.rows > this.image.image.naturalHeight;\n        if (isWidthError) {\n          throw new RangeError(\n            `SpriteSheet specified is wider, ` +\n              `${this.columns} cols x ${this.spWidth} pixels > ${this.image.image.naturalWidth} ` +\n              `pixels than image width`\n          );\n        }\n        if (isHeightError) {\n          throw new RangeError(\n            `SpriteSheet specified is taller, ` +\n              `${this.rows} rows x ${this.spHeight} pixels > ${this.image.image.naturalHeight} ` +\n              `pixels than image height`\n          );\n        }\n      }\n    }\n\n    if (loadFromImage) {\n      for (let i = 0; i < this.rows; i++) {\n        for (let j = 0; j < this.columns; j++) {\n          this.sprites[j + i * this.columns] = new Sprite(\n            this.image,\n            j * this.spWidth + this.spacing * j + this.spacing,\n            i * this.spHeight + this.spacing * i + this.spacing,\n            this.spWidth,\n            this.spHeight\n          );\n        }\n      }\n    }\n  }\n\n  /**\n   * Create an animation from the this SpriteSheet by listing out the\n   * sprite indices. Sprites are organized in row major order in the SpriteSheet.\n   * @param engine   Reference to the current game [[Engine]]\n   * @param indices  An array of sprite indices to use in the animation\n   * @param speed    The number in milliseconds to display each frame in the animation\n   */\n  public getAnimationByIndices(engine: Engine, indices: number[], speed: number) {\n    let images: Sprite[] = indices.map((index) => {\n      return this.sprites[index];\n    });\n\n    images = images.map(function(i) {\n      return i.clone();\n    });\n    return new Animation(engine, images, speed);\n  }\n\n  /**\n   * Create an animation from the this SpriteSheet by specifying the range of\n   * images with the beginning (inclusive) and ending (exclusive) index\n   * For example `getAnimationBetween(engine, 0, 5, 200)` returns an animation with 5 frames.\n   * @param engine      Reference to the current game Engine\n   * @param beginIndex  The index to start taking frames (inclusive)\n   * @param endIndex    The index to stop taking frames (exclusive)\n   * @param speed       The number in milliseconds to display each frame in the animation\n   */\n  public getAnimationBetween(engine: Engine, beginIndex: number, endIndex: number, speed: number) {\n    let images = this.sprites.slice(beginIndex, endIndex);\n    images = images.map(function(i) {\n      return i.clone();\n    });\n    return new Animation(engine, images, speed);\n  }\n\n  /**\n   * Treat the entire SpriteSheet as one animation, organizing the frames in\n   * row major order.\n   * @param engine  Reference to the current game [[Engine]]\n   * @param speed   The number in milliseconds to display each frame the animation\n   */\n  public getAnimationForAll(engine: Engine, speed: number) {\n    const sprites = this.sprites.map(function(i) {\n      return i.clone();\n    });\n    return new Animation(engine, sprites, speed);\n  }\n\n  /**\n   * Retrieve a specific sprite from the SpriteSheet by its index. Sprites are organized\n   * in row major order in the SpriteSheet.\n   * @param index  The index of the sprite\n   */\n  public getSprite(index: number): Sprite {\n    if (index >= 0 && index < this.sprites.length) {\n      return this.sprites[index];\n    } else {\n      throw new Error('Invalid index: ' + index);\n    }\n  }\n\n  /**\n   * Get an animation with bespoke sprite coordinates. This is useful if the SpriteSheet is\n   * packed and not a uniform width or height. The resulting [[Animation]] will have the height and width of the\n   * largest dimension (width, height) from among the sprite coordinates\n   * @param engine\n   * @param spriteCoordinates\n   * @param speed\n   */\n  public getAnimationByCoords(engine: Engine, spriteCoordinates: SpriteArgs[], speed: number): Animation {\n    let maxWidth: number = 0;\n    let maxHeight: number = 0;\n    const sprites: Sprite[] = new Array(spriteCoordinates.length);\n    for (let i = 0; i < spriteCoordinates.length; i++) {\n      const coord = spriteCoordinates[i];\n      // no need to pass image again if using a spritesheet\n      coord.image = coord.image || this.image;\n      maxWidth = Math.max(maxWidth, coord.drawWidth);\n      maxHeight = Math.max(maxHeight, coord.drawHeight);\n      sprites[i] = new Sprite(coord);\n    }\n\n    const anim = new Animation(engine, sprites, speed);\n\n    anim.drawWidth = maxWidth;\n    anim.drawHeight = maxHeight;\n    return anim;\n  }\n}\n\nexport interface SpriteSheetArgs extends Partial<SpriteSheetImpl> {\n  image: Texture;\n  sprites?: Sprite[];\n  spWidth: number;\n  spHeight: number;\n  rows: number;\n  columns: number;\n  spacing?: number;\n}\n\n/**\n * Sprite sheets are a useful mechanism for slicing up image resources into\n * separate sprites or for generating in game animations. [[Sprite|Sprites]] are organized\n * in row major order in the [[SpriteSheet]].\n */\nexport class SpriteSheet extends Configurable(SpriteSheetImpl) {\n  constructor(config: SpriteSheetArgs);\n  constructor(sprites: Sprite[]);\n  constructor(image: Texture, columns: number, rows: number, spWidth: number, spHeight: number);\n  constructor(\n    imageOrConfigOrSprites: Texture | SpriteSheetArgs | Sprite[],\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number\n  ) {\n    super(imageOrConfigOrSprites, columns, rows, spWidth, spHeight, spacing);\n  }\n}\n\nexport class SpriteFontImpl extends SpriteSheet {\n  private _currentColor: Color = Color.Black;\n  private _currentOpacity: Number = 1.0;\n  private _sprites: { [key: string]: Sprite } = {};\n\n  // text shadow\n  private _textShadowOn: boolean = false;\n  private _textShadowDirty: boolean = true;\n  private _textShadowColor: Color = Color.Black;\n  private _textShadowSprites: { [key: string]: Sprite } = {};\n  private _shadowOffsetX: number = 5;\n  private _shadowOffsetY: number = 5;\n  private _alphabet: string;\n  private _caseInsensitive: boolean;\n\n  /**\n   * @param imageOrConfig   The backing image texture to build the SpriteFont or the sprite font option bag\n   * @param alphabet        A string representing all the characters in the image, in row major order.\n   * @param caseInsensitive  Indicate whether this font takes case into account\n   * @param columns         The number of columns of characters in the image\n   * @param rows            The number of rows of characters in the image\n   * @param spWidth         The width of each character in pixels\n   * @param spHeight        The height of each character in pixels\n   */\n  constructor(\n    imageOrConfig: Texture | SpriteFontArgs,\n    alphabet: string,\n    caseInsensitive: boolean,\n    columns: number,\n    rows: number,\n    spWidth: number,\n    spHeight: number,\n    spacing?: number\n  ) {\n    super(\n      imageOrConfig instanceof Texture ?\n        {\n          image: imageOrConfig,\n          spWidth: spWidth,\n          spHeight: spHeight,\n          rows: rows,\n          columns: columns,\n          spacing: spacing || 0\n        }\n        : imageOrConfig\n    );\n\n    if (imageOrConfig && !(imageOrConfig instanceof Texture)) {\n      alphabet = imageOrConfig.alphabet;\n      caseInsensitive = imageOrConfig.caseInsensitive;\n    }\n\n    this._alphabet = alphabet;\n    this._caseInsensitive = caseInsensitive;\n    this._sprites = this.getTextSprites();\n  }\n\n  /**\n   * Returns a dictionary that maps each character in the alphabet to the appropriate [[Sprite]].\n   */\n  public getTextSprites(): { [key: string]: Sprite } {\n    const lookup: { [key: string]: Sprite } = {};\n    for (let i = 0; i < this._alphabet.length; i++) {\n      let char = this._alphabet[i];\n      if (this._caseInsensitive) {\n        char = char.toLowerCase();\n      }\n      lookup[char] = this.sprites[i].clone();\n    }\n    return lookup;\n  }\n\n  /**\n   * Sets the text shadow for sprite fonts\n   * @param offsetX      The x offset in pixels to place the shadow\n   * @param offsetY      The y offset in pixels to place the shadow\n   * @param shadowColor  The color of the text shadow\n   */\n  public setTextShadow(offsetX: number, offsetY: number, shadowColor: Color) {\n    this._textShadowOn = true;\n    this._shadowOffsetX = offsetX;\n    this._shadowOffsetY = offsetY;\n    this._textShadowColor = shadowColor.clone();\n    this._textShadowDirty = true;\n    for (const character in this._sprites) {\n      this._textShadowSprites[character] = this._sprites[character].clone();\n    }\n  }\n\n  /**\n   * Toggles text shadows on or off\n   */\n  public useTextShadow(on: boolean) {\n    this._textShadowOn = on;\n    if (on) {\n      this.setTextShadow(5, 5, this._textShadowColor);\n    }\n  }\n\n  /**\n   * Draws the current sprite font\n   */\n  public draw(ctx: CanvasRenderingContext2D, text: string, x: number, y: number, options: SpriteFontOptions) {\n    options = this._parseOptions(options);\n\n    if (this._currentColor.toString() !== options.color.toString() || this._currentOpacity !== options.opacity) {\n      this._currentOpacity = options.opacity;\n      this._currentColor = options.color;\n      for (const char in this._sprites) {\n        this._sprites[char].clearEffects();\n        this._sprites[char].fill(options.color);\n        this._sprites[char].opacity(options.opacity);\n      }\n    }\n\n    if (this._textShadowOn && this._textShadowDirty && this._textShadowColor) {\n      for (const characterShadow in this._textShadowSprites) {\n        this._textShadowSprites[characterShadow].clearEffects();\n        this._textShadowSprites[characterShadow].addEffect(new Effects.Fill(this._textShadowColor.clone()));\n      }\n      this._textShadowDirty = false;\n    }\n\n    // find the current length of text in pixels\n    const sprite = this.sprites[0];\n\n    // find the current height fo the text in pixels\n    const height = sprite.drawHeight;\n\n    // calculate appropriate scale for font size\n    const scale = options.fontSize / height;\n\n    const length = text.length * sprite.drawWidth * scale + text.length * options.letterSpacing;\n\n    let currX = x;\n    if (options.textAlign === TextAlign.Left || options.textAlign === TextAlign.Start) {\n      currX = x;\n    } else if (options.textAlign === TextAlign.Right || options.textAlign === TextAlign.End) {\n      currX = x - length;\n    } else if (options.textAlign === TextAlign.Center) {\n      currX = x - length / 2;\n    }\n\n    let currY = y - height * scale;\n    if (options.baseAlign === BaseAlign.Top || options.baseAlign === BaseAlign.Hanging) {\n      currY = y;\n    } else if (\n      options.baseAlign === BaseAlign.Ideographic ||\n      options.baseAlign === BaseAlign.Bottom ||\n      options.baseAlign === BaseAlign.Alphabetic\n    ) {\n      currY = y - height * scale;\n    } else if (options.baseAlign === BaseAlign.Middle) {\n      currY = y - (height * scale) / 2;\n    }\n\n    for (let i = 0; i < text.length; i++) {\n      let character = text[i];\n      if (this._caseInsensitive) {\n        character = character.toLowerCase();\n      }\n      try {\n        // if text shadow\n        if (this._textShadowOn) {\n          this._textShadowSprites[character].scale.x = scale;\n          this._textShadowSprites[character].scale.y = scale;\n          this._textShadowSprites[character].draw(ctx, currX + this._shadowOffsetX, currY + this._shadowOffsetY);\n        }\n\n        const charSprite = this._sprites[character];\n        charSprite.scale.x = scale;\n        charSprite.scale.y = scale;\n        charSprite.draw(ctx, currX, currY);\n        currX += charSprite.drawWidth + options.letterSpacing;\n      } catch (e) {\n        Logger.getInstance().error(`SpriteFont Error drawing char ${character}`);\n      }\n    }\n  }\n\n  private _parseOptions(options: SpriteFontOptions): SpriteFontOptions {\n    return {\n      fontSize: options.fontSize || 10,\n      letterSpacing: options.letterSpacing || 0,\n      color: options.color || Color.Black,\n      textAlign: typeof options.textAlign === undefined ? TextAlign.Left : options.textAlign,\n      baseAlign: typeof options.baseAlign === undefined ? BaseAlign.Bottom : options.baseAlign,\n      maxWidth: options.maxWidth || -1,\n      opacity: options.opacity || 0\n    };\n  }\n}\n\n/**\n * Specify various font attributes for sprite fonts\n */\nexport interface SpriteFontOptions {\n  color?: Color;\n  opacity?: number;\n  fontSize?: number;\n  letterSpacing?: number;\n  textAlign?: TextAlign;\n  baseAlign?: BaseAlign;\n  maxWidth?: number;\n}\n\nexport interface SpriteFontArgs extends SpriteSheetArgs {\n  image: Texture;\n  columns: number;\n  rows: number;\n  spWidth: number;\n  spHeight: number;\n  alphabet: string;\n  caseInsensitive: boolean;\n}\n\n/**\n * Sprite fonts are a used in conjunction with a [[Label]] to specify\n * a particular bitmap as a font. Note that some font features are not\n * supported by Sprite fonts.\n */\nexport class SpriteFont extends Configurable(SpriteFontImpl) {\n  constructor(config: SpriteFontArgs);\n  constructor(image: Texture, alphabet: string, caseInsensitive: boolean, columns: number, rows: number, spWidth: number, spHeight: number);\n  constructor(\n    imageOrConfig: Texture | SpriteFontArgs,\n    alphabet?: string,\n    caseInsensitive?: boolean,\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number\n  ) {\n    super(imageOrConfig, alphabet, caseInsensitive, columns, rows, spWidth, spHeight, spacing);\n  }\n}\n","import { Audio } from './Audio';\n\nexport type ExResponseType = '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text';\n\nexport interface ExResponseTypesLookup {\n  [name: string]: ExResponseType;\n}\n\nexport class ExResponse {\n  public static type: ExResponseTypesLookup = {\n    any: '',\n    blob: 'blob',\n    json: 'json',\n    text: 'text',\n    document: 'document',\n    arraybuffer: 'arraybuffer'\n  };\n}\n\n/**\n * Represents an audio implementation like [[AudioTagInstance]] or [[WebAudioInstance]]\n */\nexport interface AudioImplementation {\n  /**\n   * XHR response type\n   */\n  responseType: ExResponseType;\n\n  /**\n   * Processes raw data and transforms into sound data\n   */\n  processData(data: Blob | ArrayBuffer): Promise<string | AudioBuffer>;\n\n  /**\n   * Factory method that returns an instance of a played audio track\n   */\n  createInstance(data: string | AudioBuffer): Audio;\n}\n","import { Engine } from './../Engine';\nimport * as Events from './../Events';\nimport { Scene } from '../Scene';\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport interface _initialize {\n  _initialize(engine: Engine): void;\n}\n\n/**\n * Type guard checking for internal initialize method\n * @internal\n * @param a\n */\nexport function has_initialize(a: any): a is _initialize {\n  return !!a._initialize;\n}\n\nexport interface OnInitialize {\n  onInitialize(engine: Engine): void;\n}\n\n/**\n *\n */\nexport function hasOnInitialize(a: any): a is OnInitialize {\n  return !!a.onInitialize;\n}\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport interface _preupdate {\n  _preupdate(engine: Engine, delta: number): void;\n}\n\n/**\n *\n */\nexport function has_preupdate(a: any): a is _preupdate {\n  return !!a._preupdate;\n}\n\nexport interface OnPreUpdate {\n  onPreUpdate(engine: Engine, delta: number): void;\n}\n\n/**\n *\n */\nexport function hasOnPreUpdate(a: any): a is OnPreUpdate {\n  return !!a.onPreUpdate;\n}\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport interface _postupdate {\n  _postupdate(engine: Engine, delta: number): void;\n}\n\n/**\n *\n */\nexport function has_postupdate(a: any): a is _postupdate {\n  return !!a.onPostUpdate;\n}\n\nexport interface OnPostUpdate {\n  onPostUpdate(engine: Engine, delta: number): void;\n}\n\n/**\n *\n */\nexport function hasOnPostUpdate(a: any): a is OnPostUpdate {\n  return !!a.onPostUpdate;\n}\n\nexport interface CanInitialize {\n  /**\n   * Overridable implementation\n   */\n  onInitialize(_engine: Engine): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\n  once(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\n  off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<any>) => void): void;\n}\n\nexport interface CanActivate {\n  /**\n   * Overridable implementation\n   */\n  onActivate(oldScene: Scene, newScene: Scene): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\n  once(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\n  off(eventName: Events.activate, handler?: (event: Events.ActivateEvent) => void): void;\n}\n\nexport interface CanDeactivate {\n  /**\n   * Overridable implementation\n   */\n  onDeactivate(oldScene: Scene, newScene: Scene): void;\n\n  /**\n   * Event signature\n   */\n  on(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\n  once(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\n  off(eventName: Events.deactivate, handler?: (event: Events.DeactivateEvent) => void): void;\n}\n\nexport interface CanUpdate {\n  /**\n   * Overridable implementation\n   */\n  onPreUpdate(_engine: Engine, _delta: number): void;\n\n  /**\n   * Event signature\n   */\n  on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\n  once(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\n  off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent<any>) => void): void;\n\n  /**\n   * Overridable implementation\n   */\n  onPostUpdate(_engine: Engine, _delta: number): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\n  once(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\n  off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent<any>) => void): void;\n}\n\nexport interface OnPreDraw {\n  /**\n   * Overridable implementation\n   */\n  onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\n}\n\nexport interface OnPostDraw {\n  /**\n   * Overridable implementation\n   */\n  onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\n}\n\nexport interface CanDraw extends OnPreDraw, OnPostDraw {\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\n\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\n}\n\n/**\n *\n */\nexport function hasPreDraw(a: any): a is OnPreDraw {\n  return !!a.onPreDraw;\n}\n\n/**\n *\n */\nexport function hasPostDraw(a: any): a is OnPostDraw {\n  return !!a.onPostDraw;\n}\n\nexport interface CanBeKilled {\n  /**\n   * Overridable implementation\n   */\n  onPreKill(_scene: Scene): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\n  once(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\n  off(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\n\n  /**\n   * Overridable implementation\n   */\n  onPostKill(_scene: Scene): void;\n\n  /**\n   * Event signatures\n   */\n  on(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\n  once(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\n  off(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\n}\n","import { Random } from './Random';\nimport { Color } from '../Drawing/Color';\nimport * as Util from '../Util/Util';\n\n/**\n * Linear interpolation between a and b\n * @internal\n * @param time number between [0, 1]\n * @param a starting number\n * @param b ending number\n */\nfunction _lerp(time: number, a: number, b: number): number {\n  return a + time * (b - a);\n}\n\n/**\n * Reduce t by a quintic function that produces a desired effect\n * @internal\n * @param t\n */\nfunction _fade(t: number): number {\n  return t * t * t * (t * (t * 6 - 15) + 10);\n}\n\n/**\n * Options for the perlin noise generator\n */\nexport interface PerlinOptions {\n  /**\n   * Random number seed for the Perlin noise generator\n   */\n  seed?: number;\n  /**\n   * Number of octaves to use when generating the noise, the number of octaves is the number of times the perlin\n   * noise is generated and laid on top of itself. Using higher values can increase the curviness of the noise, and\n   * make it look more natural.\n   */\n  octaves?: number;\n  /**\n   * Frequency to use when generating the noise, the higher the number the more quickly the pattern will oscillate. Another way\n   * to think about this is that it is like \"zooming\" out from an infinite pattern determined by the seed.\n   */\n  frequency?: number;\n  /**\n   * The amplitude determines the relative height of the peaks generated in the noise.\n   */\n  amplitude?: number;\n  /**\n   * The persistance determines how quickly the amplitude will drop off, a high degree of persistance results in smoother patterns,\n   * a low degree of persistance generates spiky patterns.\n   */\n  persistance?: number;\n}\n\n/**\n * Generates perlin noise based on the 2002 Siggraph paper http://mrl.nyu.edu/~perlin/noise/\n * Also https://flafla2.github.io/2014/08/09/perlinnoise.html\n */\nexport class PerlinGenerator {\n  private _perm: number[] = [\n    151,\n    160,\n    137,\n    91,\n    90,\n    15,\n    131,\n    13,\n    201,\n    95,\n    96,\n    53,\n    194,\n    233,\n    7,\n    225,\n    140,\n    36,\n    103,\n    30,\n    69,\n    142,\n    8,\n    99,\n    37,\n    240,\n    21,\n    10,\n    23,\n    190,\n    6,\n    148,\n    247,\n    120,\n    234,\n    75,\n    0,\n    26,\n    197,\n    62,\n    94,\n    252,\n    219,\n    203,\n    117,\n    35,\n    11,\n    32,\n    57,\n    177,\n    33,\n    88,\n    237,\n    149,\n    56,\n    87,\n    174,\n    20,\n    125,\n    136,\n    171,\n    168,\n    68,\n    175,\n    74,\n    165,\n    71,\n    134,\n    139,\n    48,\n    27,\n    166,\n    77,\n    146,\n    158,\n    231,\n    83,\n    111,\n    229,\n    122,\n    60,\n    211,\n    133,\n    230,\n    220,\n    105,\n    92,\n    41,\n    55,\n    46,\n    245,\n    40,\n    244,\n    102,\n    143,\n    54,\n    65,\n    25,\n    63,\n    161,\n    1,\n    216,\n    80,\n    73,\n    209,\n    76,\n    132,\n    187,\n    208,\n    89,\n    18,\n    169,\n    200,\n    196,\n    135,\n    130,\n    116,\n    188,\n    159,\n    86,\n    164,\n    100,\n    109,\n    198,\n    173,\n    186,\n    3,\n    64,\n    52,\n    217,\n    226,\n    250,\n    124,\n    123,\n    5,\n    202,\n    38,\n    147,\n    118,\n    126,\n    255,\n    82,\n    85,\n    212,\n    207,\n    206,\n    59,\n    227,\n    47,\n    16,\n    58,\n    17,\n    182,\n    189,\n    28,\n    42,\n    223,\n    183,\n    170,\n    213,\n    119,\n    248,\n    152,\n    2,\n    44,\n    154,\n    163,\n    70,\n    221,\n    153,\n    101,\n    155,\n    167,\n    43,\n    172,\n    9,\n    129,\n    22,\n    39,\n    253,\n    19,\n    98,\n    108,\n    110,\n    79,\n    113,\n    224,\n    232,\n    178,\n    185,\n    112,\n    104,\n    218,\n    246,\n    97,\n    228,\n    251,\n    34,\n    242,\n    193,\n    238,\n    210,\n    144,\n    12,\n    191,\n    179,\n    162,\n    241,\n    81,\n    51,\n    145,\n    235,\n    249,\n    14,\n    239,\n    107,\n    49,\n    192,\n    214,\n    31,\n    181,\n    199,\n    106,\n    157,\n    184,\n    84,\n    204,\n    176,\n    115,\n    121,\n    50,\n    45,\n    127,\n    4,\n    150,\n    254,\n    138,\n    236,\n    205,\n    93,\n    222,\n    114,\n    67,\n    29,\n    24,\n    72,\n    243,\n    141,\n    128,\n    195,\n    78,\n    66,\n    215,\n    61,\n    156,\n    180\n  ];\n  private _p: Uint8Array = new Uint8Array(512);\n  private _random: Random;\n\n  private _defaultPerlinOptions: PerlinOptions = {\n    octaves: 1,\n    frequency: 1,\n    amplitude: 1,\n    persistance: 0.5\n  };\n\n  /**\n   * The persistance determines how quickly the amplitude will drop off, a high degree of persistance results in smoother patterns,\n   * a low degree of persistance generates spiky patterns.\n   */\n  public persistance: number;\n\n  /**\n   * The amplitude determines the relative height of the peaks generated in the noise.\n   */\n  public amplitude: number;\n\n  /**\n   * Frequency to use when generating the noise, the higher the number the more quickly the pattern will oscillate. Another way\n   * to think about this is that it is like \"zooming\" out from an infinite pattern determined by the seed.\n   */\n  public frequency: number;\n\n  /**\n   * Number of octaves to use when generating the noise, the number of octaves is the number of times the perlin\n   * noise is generated and laid on top of itself. Using higher values can increase the curviness of the noise, and\n   * make it look more natural.\n   */\n  public octaves: number;\n\n  constructor(options?: PerlinOptions) {\n    options = Util.extend({}, this._defaultPerlinOptions, options);\n\n    this.persistance = options.persistance;\n    this.amplitude = options.amplitude;\n    this.frequency = options.frequency;\n    this.octaves = options.octaves;\n\n    if (options.seed) {\n      this._random = new Random(options.seed);\n    } else {\n      this._random = new Random();\n    }\n\n    this._perm = this._random.shuffle(this._perm);\n\n    for (let i = 0; i < 512; i++) {\n      this._p[i] = this._perm[i % 256] & 0xff;\n    }\n  }\n\n  /**\n   * Generates 1-Dimensional perlin noise given an x and generates noises values between [0, 1].\n   */\n  public noise(x: number): number;\n  /**\n   * Generates 2-Dimensional perlin noise given an (x, y) and generates noise values between [0, 1]\n   */\n  public noise(x: number, y: number): number;\n  /**\n   * Generates 3-Dimensional perlin noise given an (x, y, z) and generates noise values between [0, 1]\n   */\n  public noise(x: number, y: number, z: number): number;\n  public noise(): number {\n    let amp = this.amplitude;\n    let freq = this.frequency;\n\n    let total = 0;\n    let maxValue = 0;\n    for (let i = 0; i < this.octaves; i++) {\n      switch (arguments.length) {\n        case 1:\n          total += this._noise1d(arguments[0] * freq) * amp;\n          break;\n        case 2:\n          total += this._noise2d(arguments[0] * freq, arguments[1] * freq) * amp;\n          break;\n        case 3:\n          total += this._noise3d(arguments[0] * freq, arguments[1] * freq, arguments[2] * freq) * amp;\n          break;\n        /* istanbul ignore next */\n        default:\n          throw new Error('Invalid arguments for perlin noise');\n      }\n      maxValue += amp;\n      amp *= this.persistance;\n      freq *= 2;\n    }\n    return total / maxValue;\n  }\n\n  /**\n   * Generates a list starting at 0 and ending at 1 of continuous perlin noise, by default the step is 1/length;\n   *\n   */\n  public sequence(length: number, step?: number): number[] {\n    if (!step) {\n      step = 1 / length;\n    }\n    const array: number[] = new Array(length);\n    for (let i = 0; i < length; i++) {\n      array[i] = this.noise(i * step);\n    }\n    return array;\n  }\n\n  /**\n   * Generates a 2D grid of perlin noise given a step value packed into a 1D array i = (x + y*width),\n   * by default the step will 1/(min(dimension))\n   */\n  public grid(width: number, height: number, step?: number): number[] {\n    if (!step) {\n      step = 1 / Math.min(width, height);\n    }\n\n    const array: number[] = new Array(width * height);\n\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        array[x + y * width] = this.noise(x * step, y * step);\n      }\n    }\n\n    return array;\n  }\n\n  private _gradient3d(hash: number, x: number, y: number, z: number) {\n    const h = hash & 0xf;\n    const u = h < 8 ? x : y;\n    const v = h < 4 ? y : h === 12 || h === 14 ? x : z;\n    return ((h & 0b1) === 0 ? u : -u) + ((h & 0b10) === 0 ? v : -v);\n  }\n\n  private _gradient2d(hash: number, x: number, y: number) {\n    const value = (hash & 0b1) === 0 ? x : y;\n    return (hash & 0b10) === 0 ? -value : value;\n  }\n\n  private _gradient1d(hash: number, x: number) {\n    return (hash & 0b1) === 0 ? -x : x;\n  }\n\n  private _noise1d(x: number) {\n    const intX = Math.floor(x) & 0xff; // force 0-255 integers to lookup in permutation\n    x -= Math.floor(x);\n    const fadeX = _fade(x);\n    return (_lerp(fadeX, this._gradient1d(this._p[intX], x), this._gradient1d(this._p[intX + 1], x - 1)) + 1) / 2;\n  }\n\n  private _noise2d(x: number, y: number) {\n    const intX = Math.floor(x) & 0xff;\n    const intY = Math.floor(y) & 0xff;\n\n    x -= Math.floor(x);\n    y -= Math.floor(y);\n\n    const fadeX = _fade(x);\n    const fadeY = _fade(y);\n    const a = this._p[intX] + intY;\n    const b = this._p[intX + 1] + intY;\n    return (\n      (_lerp(\n        fadeY,\n        _lerp(fadeX, this._gradient2d(this._p[a], x, y), this._gradient2d(this._p[b], x - 1, y)),\n        _lerp(fadeX, this._gradient2d(this._p[a + 1], x, y - 1), this._gradient2d(this._p[b + 1], x - 1, y - 1))\n      ) +\n        1) /\n      2\n    );\n  }\n\n  private _noise3d(x: number, y: number, z: number) {\n    const intX = Math.floor(x) & 0xff;\n    const intY = Math.floor(y) & 0xff;\n    const intZ = Math.floor(z) & 0xff;\n\n    x -= Math.floor(x);\n    y -= Math.floor(y);\n    z -= Math.floor(z);\n\n    const fadeX = _fade(x);\n    const fadeY = _fade(y);\n    const fadeZ = _fade(z);\n\n    const a = this._p[intX] + intY;\n    const b = this._p[intX + 1] + intY;\n\n    const aa = this._p[a] + intZ;\n    const ba = this._p[b] + intZ;\n\n    const ab = this._p[a + 1] + intZ;\n    const bb = this._p[b + 1] + intZ;\n\n    return (\n      (_lerp(\n        fadeZ,\n        _lerp(\n          fadeY,\n          _lerp(fadeX, this._gradient3d(this._p[aa], x, y, z), this._gradient3d(this._p[ba], x - 1, y, z)),\n          _lerp(fadeX, this._gradient3d(this._p[ab], x, y - 1, z), this._gradient3d(this._p[bb], x - 1, y - 1, z))\n        ),\n        _lerp(\n          fadeY,\n          _lerp(fadeX, this._gradient3d(this._p[aa + 1], x, y, z - 1), this._gradient3d(this._p[ba + 1], x - 1, y, z - 1)),\n          _lerp(fadeX, this._gradient3d(this._p[ab + 1], x, y - 1, z - 1), this._gradient3d(this._p[bb + 1], x - 1, y - 1, z - 1))\n        )\n      ) +\n        1) /\n      2\n    );\n  }\n}\n\n/**\n * A helper to draw 2D perlin maps given a perlin generator and a function\n */\nexport class PerlinDrawer2D {\n  /**\n   * @param generator - An existing perlin generator\n   * @param colorFcn - A color function that takes a value between [0, 255] derived from the perlin generator, and returns a color\n   */\n  constructor(public generator: PerlinGenerator, public colorFcn?: (val: number) => Color) {\n    if (!colorFcn) {\n      this.colorFcn = (val: number) => {\n        return val < 125 ? Color.Black : Color.White;\n      };\n    }\n  }\n\n  /**\n   * Returns an image of 2D perlin noise\n   */\n  public image(width: number, height: number): HTMLImageElement {\n    const image = document.createElement('img');\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    const ctx = canvas.getContext('2d');\n    this.draw(ctx, 0, 0, width, height);\n    image.src = canvas.toDataURL();\n    return image;\n  }\n\n  /**\n   * This draws a 2D perlin grid on a canvas context, not recommended to be called every frame due to performance\n   */\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number, width: number, height: number) {\n    const grid = this.generator.grid(width, height);\n    const imageData = ctx.getImageData(x, y, width, height);\n    for (let j = 0; j < height; j++) {\n      for (let i = 0; i < width; i++) {\n        const val = grid[i + width * j];\n        const c = Math.floor(val * 255) & 0xff;\n        const pixel = (i + j * imageData.width) * 4;\n        const color = this.colorFcn(c);\n\n        imageData.data[pixel] = color.r;\n        imageData.data[pixel + 1] = color.g;\n        imageData.data[pixel + 2] = color.b;\n        imageData.data[pixel + 3] = Math.floor(color.a * 255);\n      }\n    }\n    ctx.putImageData(imageData, x, y);\n  }\n}\n","import { Audio } from '../../Interfaces/Audio';\nimport * as Util from '../../Util/Util';\nimport { AudioContextFactory } from './AudioContext';\n\n/**\n * Internal class representing a Web Audio AudioBufferSourceNode instance\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API\n */\nexport class WebAudioInstance implements Audio {\n  private _volume = 1;\n  private _duration: number | undefined = undefined;\n\n  private _playingPromise: Promise<boolean>;\n  private _playingResolve: (value: boolean) => void;\n\n  private _loop = false;\n  public set loop(value: boolean) {\n    this._loop = value;\n\n    if (this._instance) {\n      this._instance.loop = value;\n      this._wireUpOnEnded();\n    }\n  }\n  public get loop(): boolean {\n    return this._loop;\n  }\n\n  public set volume(value: number) {\n    value = Util.clamp(value, 0, 1.0);\n\n    this._volume = value;\n\n    if (this._isPlaying && this._volumeNode.gain.setTargetAtTime) {\n      // https://developer.mozilla.org/en-US/docs/Web/API/AudioParam/setTargetAtTime\n      // After each .1 seconds timestep, the target value will ~63.2% closer to the target value.\n      // This exponential ramp provides a more pleasant transition in gain\n      this._volumeNode.gain.setTargetAtTime(value, this._audioContext.currentTime, 0.1);\n    } else {\n      this._volumeNode.gain.value = value;\n    }\n  }\n  public get volume(): number {\n    return this._volume;\n  }\n\n  public set duration(value: number | undefined) {\n    this._duration = value;\n  }\n\n  /**\n   * Duration of the sound, in seconds.\n   */\n  public get duration() {\n    return this._duration;\n  }\n\n  private get _playbackRate(): number {\n    return this._instance ? 1 / (this._instance.playbackRate.value || 1.0) : null;\n  }\n\n  private _isPlaying = false;\n  private _isPaused = false;\n  private _instance: AudioBufferSourceNode;\n  private _audioContext: AudioContext = AudioContextFactory.create();\n  private _volumeNode = this._audioContext.createGain();\n  private _startTime: number;\n\n  /**\n   * Current playback offset (in seconds)\n   */\n  private _currentOffset = 0;\n\n  constructor(private _src: AudioBuffer) {\n    this._createNewBufferSource();\n  }\n\n  public isPlaying() {\n    return this._isPlaying;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\n  public play(playStarted: () => any = () => {}) {\n    if (this._isPaused) {\n      this._resumePlayBack();\n      playStarted();\n    }\n\n    if (!this._isPlaying) {\n      this._startPlayBack();\n      playStarted();\n    }\n\n    return this._playingPromise;\n  }\n\n  public pause() {\n    if (!this._isPlaying) {\n      return;\n    }\n\n    this._isPaused = true;\n    this._isPlaying = false;\n\n    this._instance.stop(0);\n    // Playback rate will be a scale factor of how fast/slow the audio is being played\n    // default is 1.0\n    // we need to invert it to get the time scale\n\n    this._setPauseOffset();\n  }\n\n  public stop() {\n    if (!this._isPlaying) {\n      return;\n    }\n\n    this._isPlaying = false;\n    this._isPaused = false;\n\n    this._currentOffset = 0;\n    this._instance.stop(0);\n\n    // handler will not be wired up if we were looping\n    if (!this._instance.onended) {\n      this._handleOnEnded();\n    }\n  }\n\n  private _startPlayBack() {\n    this._isPlaying = true;\n    this._isPaused = false;\n    this._playingPromise = new Promise<boolean>((resolve) => {\n      this._playingResolve = resolve;\n    });\n\n    if (!this._instance) {\n      this._createNewBufferSource();\n    }\n\n    this._rememberStartTime();\n\n    this._volumeNode.connect(this._audioContext.destination);\n    this._instance.start(0, 0);\n    this._currentOffset = 0;\n\n    this._wireUpOnEnded();\n  }\n\n  private _resumePlayBack() {\n    if (!this._isPaused) {\n      return;\n    }\n\n    this._isPaused = false;\n    this._isPlaying = true;\n\n    // a buffer source can only be started once\n    // so we need to dispose of the previous instance before\n    // \"resuming\" the next one\n    this._instance.onended = null; // dispose of any previous event handler\n    this._createNewBufferSource();\n\n    const duration = this._playbackRate * this._src.duration;\n    const restartTime = this._currentOffset % duration;\n\n    this._rememberStartTime(restartTime * -1000);\n    this._instance.start(0, restartTime);\n    this._wireUpOnEnded();\n  }\n\n  private _wireUpOnEnded() {\n    if (!this.loop) {\n      this._instance.onended = () => this._handleOnEnded();\n    }\n  }\n\n  private _handleOnEnded() {\n    // pausing calls stop(0) which triggers onended event\n    // so we don't \"resolve\" yet (when we resume we'll try again)\n    if (!this._isPaused) {\n      this._isPlaying = false;\n      this._playingResolve(true);\n    }\n  }\n\n  private _rememberStartTime(amend?: number) {\n    this._startTime = new Date().getTime() + (amend | 0);\n  }\n\n  private _setPauseOffset() {\n    this._currentOffset = ((new Date().getTime() - this._startTime) * this._playbackRate) / 1000; // in seconds\n  }\n\n  private _createNewBufferSource() {\n    this._instance = this._audioContext.createBufferSource();\n    this._instance.buffer = this._src;\n    this._instance.loop = this.loop;\n    this._instance.playbackRate.setValueAtTime(1.0, 0);\n\n    this._instance.connect(this._volumeNode);\n  }\n}\n","import { Logger } from './Log';\n\n/**\n * Whether or not the browser can play this file as HTML5 Audio\n */\nexport function canPlayFile(file: string): boolean {\n  try {\n    const a = new Audio();\n    const filetype = /.*\\.([A-Za-z0-9]+)$/;\n    const type = file.match(filetype)[1];\n    if (a.canPlayType('audio/' + type)) {\n      return true;\n    } else {\n      return false;\n    }\n  } catch (e) {\n    Logger.getInstance().warn('Cannot determine audio support, assuming no support for the Audio Tag', e);\n    return false;\n  }\n}\n","import { ExResponse } from '../../Interfaces/AudioImplementation';\nimport { Audio } from '../../Interfaces/Audio';\nimport { Engine } from '../../Engine';\nimport { Resource } from '../Resource';\nimport { WebAudioInstance } from './WebAudioInstance';\nimport { AudioContextFactory } from './AudioContext';\nimport { NativeSoundEvent, NativeSoundProcessedEvent } from '../../Events/MediaEvents';\nimport { canPlayFile } from '../../Util/Sound';\n\n/**\n * The [[Sound]] object allows games built in Excalibur to load audio\n * components, from soundtracks to sound effects. [[Sound]] is an [[Loadable]]\n * which means it can be passed to a [[Loader]] to pre-load before a game or level.\n */\nexport class Sound extends Resource<ArrayBuffer> implements Audio {\n  /**\n   * Indicates whether the clip should loop when complete\n   * @param value  Set the looping flag\n   */\n  public set loop(value: boolean) {\n    this._loop = value;\n\n    for (const track of this._tracks) {\n      track.loop = this._loop;\n    }\n\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._loop);\n  }\n  public get loop(): boolean {\n    return this._loop;\n  }\n\n  public set volume(value: number) {\n    this._volume = value;\n\n    for (const track of this._tracks) {\n      track.volume = this._volume;\n    }\n\n    this.emit('volumechange', new NativeSoundEvent(this));\n\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._volume);\n  }\n  public get volume(): number {\n    return this._volume;\n  }\n\n  public get duration(): number | undefined {\n    return this._duration;\n  }\n\n  /**\n   * Return array of Current AudioInstances playing or being paused\n   */\n  public get instances(): Audio[] {\n    return this._tracks;\n  }\n\n  public path: string;\n\n  private _loop = false;\n  private _volume = 1;\n  private _duration: number | undefined = undefined;\n  private _isStopped = false;\n  private _isPaused = false;\n  private _tracks: Audio[] = [];\n  private _engine: Engine;\n  private _wasPlayingOnHidden: boolean = false;\n  private _processedDataResolve: (value: AudioBuffer) => void;\n  private _processedData = new Promise<AudioBuffer>((resolve) => {\n    this._processedDataResolve = resolve;\n  });\n  private _audioContext = AudioContextFactory.create();\n\n  /**\n   * @param paths A list of audio sources (clip.wav, clip.mp3, clip.ogg) for this audio clip. This is done for browser compatibility.\n   */\n  constructor(...paths: string[]) {\n    super('', '');\n\n    this.responseType = ExResponse.type.arraybuffer;\n    /* Chrome : MP3, WAV, Ogg\n     * Firefox : WAV, Ogg,\n     * IE : MP3, WAV coming soon\n     * Safari MP3, WAV, Ogg\n     */\n    for (const path of paths) {\n      if (canPlayFile(path)) {\n        this.path = path;\n        break;\n      }\n    }\n\n    if (!this.path) {\n      this.logger.warn('This browser does not support any of the audio files specified:', paths.join(', '));\n      this.logger.warn('Attempting to use', paths[0]);\n      this.path = paths[0]; // select the first specified\n    }\n  }\n\n  public wireEngine(engine: Engine) {\n    if (engine) {\n      this._engine = engine;\n\n      this._engine.on('hidden', () => {\n        if (engine.pauseAudioWhenHidden && this.isPlaying()) {\n          this._wasPlayingOnHidden = true;\n          this.pause();\n        }\n      });\n\n      this._engine.on('visible', () => {\n        if (engine.pauseAudioWhenHidden && this._wasPlayingOnHidden) {\n          this.play();\n          this._wasPlayingOnHidden = false;\n        }\n      });\n\n      this._engine.on('start', () => {\n        this._isStopped = false;\n      });\n\n      this._engine.on('stop', () => {\n        this.stop();\n        this._isStopped = true;\n      });\n    }\n  }\n\n  /**\n   * Returns how many instances of the sound are currently playing\n   */\n  public instanceCount(): number {\n    return this._tracks.length;\n  }\n\n  /**\n   * Whether or not the sound is playing right now\n   */\n  public isPlaying(): boolean {\n    return this._tracks.some((t) => t.isPlaying());\n  }\n\n  /**\n   * Play the sound, returns a promise that resolves when the sound is done playing\n   * An optional volume argument can be passed in to play the sound. Max volume is 1.0\n   */\n  public play(volume?: number): Promise<boolean> {\n    if (!this.isLoaded()) {\n      this.logger.warn('Cannot start playing. Resource', this.path, 'is not loaded yet');\n\n      return Promise.resolve(true);\n    }\n\n    if (this._isStopped) {\n      this.logger.warn('Cannot start playing. Engine is in a stopped state.');\n      return Promise.resolve(false);\n    }\n\n    this.volume = volume || this.volume;\n\n    if (this._isPaused) {\n      return this._resumePlayback();\n    } else {\n      return this._startPlayback();\n    }\n  }\n\n  /**\n   * Stop the sound, and do not rewind\n   */\n  public pause() {\n    if (!this.isPlaying()) {\n      return;\n    }\n\n    for (const track of this._tracks) {\n      track.pause();\n    }\n\n    this._isPaused = true;\n\n    this.emit('pause', new NativeSoundEvent(this));\n\n    this.logger.debug('Paused all instances of sound', this.path);\n  }\n\n  /**\n   * Stop the sound if it is currently playing and rewind the track. If the sound is not playing, rewinds the track.\n   */\n  public stop() {\n    for (const track of this._tracks) {\n      track.stop();\n    }\n\n    this.emit('stop', new NativeSoundEvent(this));\n\n    this._isPaused = false;\n    this._tracks.length = 0;\n    this.logger.debug('Stopped all instances of sound', this.path);\n  }\n\n  public setData(data: any) {\n    this.emit('emptied', new NativeSoundEvent(this));\n\n    this.data = data;\n  }\n\n  public async processData(data: ArrayBuffer): Promise<AudioBuffer> {\n    /**\n     * Processes raw arraybuffer data and decodes into WebAudio buffer (async).\n     */\n    const audioBuffer = await this._processArrayBufferData(data);\n    this._setProcessedData(audioBuffer);\n    return audioBuffer;\n  }\n\n  /**\n   * Get Id of provided AudioInstance in current trackList\n   * @param track [[AudioInstance]] which Id is to be given\n   */\n  public getTrackId(track: Audio): number {\n    return this._tracks.indexOf(track);\n  }\n\n  private async _resumePlayback(): Promise<boolean> {\n    if (this._isPaused) {\n      const resumed: Promise<boolean>[] = [];\n      // ensure we resume *current* tracks (if paused)\n      for (const track of this._tracks) {\n        resumed.push(track.play());\n      }\n\n      this._isPaused = false;\n\n      this.emit('resume', new NativeSoundEvent(this));\n\n      this.logger.debug('Resuming paused instances for sound', this.path, this._tracks);\n      // resolve when resumed tracks are done\n      await Promise.all(resumed);\n    }\n    return true;\n  }\n\n  /**\n   * Starts playback, returns a promise that resolves when playback is complete\n   */\n  private async _startPlayback(): Promise<boolean> {\n    const track = await this._createNewTrack();\n\n    const complete = await track.play(() => {\n      this.emit('playbackstart', new NativeSoundEvent(this, track));\n      this.logger.debug('Playing new instance for sound', this.path);\n    });\n\n    // when done, remove track\n    this.emit('playbackend', new NativeSoundEvent(this, track));\n    this._tracks.splice(this.getTrackId(track), 1);\n\n    return complete;\n  }\n\n  private async _processArrayBufferData(data: ArrayBuffer): Promise<AudioBuffer> {\n    try {\n      return this._audioContext.decodeAudioData(data.slice(0));\n    } catch (e) {\n      this.logger.error(\n        'Unable to decode ' +\n          ' this browser may not fully support this format, or the file may be corrupt, ' +\n          'if this is an mp3 try removing id3 tags and album art from the file.'\n      );\n      return undefined;\n    }\n  }\n\n  private _setProcessedData(processedData: AudioBuffer): void {\n    this._processedDataResolve(processedData);\n    this._duration = typeof processedData === 'object' ? processedData.duration : undefined;\n    this.emit('processed', new NativeSoundProcessedEvent(this, processedData));\n  }\n\n  private _createNewTrack(): Promise<WebAudioInstance> {\n    this.processData(this.data);\n\n    return new Promise((resolve) => {\n      this._processedData.then(\n        (processedData) => {\n          resolve(this._getTrackInstance(processedData));\n\n          return processedData;\n        },\n        (error) => {\n          this.logger.error(error, 'Cannot create AudioInstance due to wrong processed data.');\n        }\n      );\n    });\n  }\n\n  private _getTrackInstance(data: AudioBuffer): WebAudioInstance {\n    const newTrack = new WebAudioInstance(data);\n\n    newTrack.loop = this.loop;\n    newTrack.volume = this.volume;\n    newTrack.duration = this.duration;\n\n    this._tracks.push(newTrack);\n\n    return newTrack;\n  }\n}\n","import { Resource } from './Resource';\nimport { Sprite } from '../Drawing/Sprite';\nimport { Texture } from './Texture';\nimport { Color } from '../Drawing/Color';\nimport { SpriteSheet } from '../Drawing/SpriteSheet';\nimport { Animation } from '../Drawing/Animation';\nimport { Engine } from '../Engine';\n/**\n * The [[Texture]] object allows games built in Excalibur to load image resources.\n * [[Texture]] is an [[Loadable]] which means it can be passed to a [[Loader]]\n * to pre-load before starting a level or game.\n */\nexport class Gif extends Resource<Texture[]> {\n  /**\n   * The width of the texture in pixels\n   */\n  public width: number;\n\n  /**\n   * The height of the texture in pixels\n   */\n  public height: number;\n\n  /**\n   * A [[Promise]] that resolves when the Texture is loaded.\n   */\n  public loaded: Promise<any> = new Promise<any>((resolve) => {\n    this._loadedResolve = resolve;\n  });\n\n  private _isLoaded: boolean = false;\n  private _stream: Stream = null;\n  private _gif: ParseGif = null;\n  private _textures: Texture[] = [];\n  private _animation: Animation = null;\n  private _transparentColor: Color = null;\n  private _loadedResolve: (value?: any) => void;\n\n  /**\n   * Populated once loading is complete\n   */\n  public images: HTMLImageElement;\n\n  /**\n   * @param path       Path to the image resource\n   * @param color      Optionally set the color to treat as transparent the gif, by default [[Color.Magenta]]\n   * @param bustCache  Optionally load texture with cache busting\n   */\n  constructor(public path: string, public color: Color = Color.Magenta, public bustCache = true) {\n    super(path, 'arraybuffer', bustCache);\n    this._transparentColor = color;\n  }\n\n  /**\n   * Returns true if the Texture is completely loaded and is ready\n   * to be drawn.\n   */\n  public isLoaded(): boolean {\n    return this._isLoaded;\n  }\n\n  /**\n   * Begins loading the texture and returns a promise to be resolved on completion\n   */\n  public load(): Promise<Texture[]> {\n    const complete = new Promise<Texture[]>((resolve, reject) => {\n      return super.load().then(\n        () => {\n          this._stream = new Stream(this.getData());\n          this._gif = new ParseGif(this._stream, this._transparentColor);\n          const promises: Promise<HTMLImageElement>[] = [];\n          for (let imageIndex: number = 0; imageIndex < this._gif.images.length; imageIndex++) {\n            const texture = new Texture(this._gif.images[imageIndex].src, false);\n            this._textures.push(texture);\n            promises.push(texture.load());\n          }\n\n          return Promise.all(promises).then(() => {\n            this._isLoaded = true;\n            this._loadedResolve(this._textures);\n            resolve(this._textures);\n          });\n        },\n        () => {\n          reject('Error loading texture.');\n        }\n      );\n    });\n    return complete;\n  }\n\n  public asSprite(id: number = 0): Sprite {\n    const sprite = this._textures[id].asSprite();\n    return sprite;\n  }\n\n  public asSpriteSheet(): SpriteSheet {\n    const spriteArray: Sprite[] = this._textures.map((texture) => {\n      return texture.asSprite();\n    });\n    return new SpriteSheet(spriteArray);\n  }\n\n  public asAnimation(engine: Engine, speed: number): Animation {\n    const spriteSheet: SpriteSheet = this.asSpriteSheet();\n    this._animation = spriteSheet.getAnimationForAll(engine, speed);\n    return this._animation;\n  }\n\n  public get readCheckBytes(): number[] {\n    return this._gif.checkBytes;\n  }\n}\n\nexport interface Frame {\n  sentinel: number;\n  type: string;\n  leftPos: number;\n  topPos: number;\n  width: number;\n  height: number;\n  lctFlag: boolean;\n  interlaced: boolean;\n  sorted: boolean;\n  reserved: boolean[];\n  lctSize: number;\n  lzwMinCodeSize: number;\n  pixels: number[];\n}\n\nconst bitsToNum = (ba: any) => {\n  return ba.reduce(function (s: number, n: number) {\n    return s * 2 + n;\n  }, 0);\n};\n\nconst byteToBitArr = (bite: any) => {\n  const a = [];\n  for (let i = 7; i >= 0; i--) {\n    a.push(!!(bite & (1 << i)));\n  }\n  return a;\n};\n\nexport class Stream {\n  data: any = null;\n  len: number = 0;\n  position: number = 0;\n\n  constructor(dataArray: ArrayBuffer) {\n    this.data = new Uint8Array(dataArray);\n    this.len = this.data.byteLength;\n    if (this.len === 0) {\n      throw new Error('No data loaded from file');\n    }\n  }\n\n  public readByte = () => {\n    if (this.position >= this.data.byteLength) {\n      throw new Error('Attempted to read past end of stream.');\n    }\n    return this.data[this.position++];\n  };\n\n  public readBytes = (n: number) => {\n    const bytes = [];\n    for (let i = 0; i < n; i++) {\n      bytes.push(this.readByte());\n    }\n    return bytes;\n  };\n\n  public read = (n: number) => {\n    let s = '';\n    for (let i = 0; i < n; i++) {\n      s += String.fromCharCode(this.readByte());\n    }\n    return s;\n  };\n\n  public readUnsigned = () => {\n    // Little-endian.\n    const a = this.readBytes(2);\n    return (a[1] << 8) + a[0];\n  };\n}\n\nconst lzwDecode = function (minCodeSize: number, data: any) {\n  // TODO: Now that the GIF parser is a bit different, maybe this should get an array of bytes instead of a String?\n  let pos = 0; // Maybe this streaming thing should be merged with the Stream?\n\n  const readCode = function (size: number) {\n    let code = 0;\n    for (let i = 0; i < size; i++) {\n      if (data.charCodeAt(pos >> 3) & (1 << (pos & 7))) {\n        code |= 1 << i;\n      }\n      pos++;\n    }\n    return code;\n  };\n\n  const output: any[] = [];\n\n  const clearCode = 1 << minCodeSize;\n  const eoiCode = clearCode + 1;\n\n  let codeSize = minCodeSize + 1;\n\n  let dict: any[] = [];\n\n  const clear = function () {\n    dict = [];\n    codeSize = minCodeSize + 1;\n    for (let i = 0; i < clearCode; i++) {\n      dict[i] = [i];\n    }\n    dict[clearCode] = [];\n    dict[eoiCode] = null;\n  };\n\n  let code;\n  let last;\n\n  while (true) {\n    last = code;\n    code = readCode(codeSize);\n    if (code === clearCode) {\n      clear();\n      continue;\n    }\n    if (code === eoiCode) {\n      break;\n    }\n\n    if (code < dict.length) {\n      if (last !== clearCode) {\n        dict.push(dict[last].concat(dict[code][0]));\n      }\n    } else {\n      if (code !== dict.length) {\n        throw new Error('Invalid LZW code.');\n      }\n      dict.push(dict[last].concat(dict[last][0]));\n    }\n    output.push.apply(output, dict[code]);\n\n    if (dict.length === 1 << codeSize && codeSize < 12) {\n      // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\n      codeSize++;\n    }\n  }\n\n  // I don't know if this is technically an error, but some GIFs do it.\n  //if (Math.ceil(pos / 8) !== data.length) throw new Error('Extraneous LZW bytes.');\n  return output;\n};\n\n// The actual parsing; returns an object with properties.\nexport class ParseGif {\n  private _st: Stream = null;\n  private _handler: any = {};\n  private _transparentColor: Color = null;\n  public frames: Frame[] = [];\n  public images: HTMLImageElement[] = [];\n  public globalColorTable: any[] = [];\n  public checkBytes: number[] = [];\n\n  constructor(stream: Stream, color: Color = Color.Magenta) {\n    this._st = stream;\n    this._handler = {};\n    this._transparentColor = color;\n    this.parseHeader();\n    this.parseBlock();\n  }\n\n  // LZW (GIF-specific)\n  parseColorTable = (entries: any) => {\n    // Each entry is 3 bytes, for RGB.\n    const ct = [];\n    for (let i = 0; i < entries; i++) {\n      const rgb: number[] = this._st.readBytes(3);\n      const rgba =\n        '#' +\n        rgb\n          .map((x: any) => {\n            const hex = x.toString(16);\n            return hex.length === 1 ? '0' + hex : hex;\n          })\n          .join('');\n      ct.push(rgba);\n    }\n    return ct;\n  };\n\n  readSubBlocks = () => {\n    let size, data;\n    data = '';\n    do {\n      size = this._st.readByte();\n      data += this._st.read(size);\n    } while (size !== 0);\n    return data;\n  };\n\n  parseHeader = () => {\n    const hdr: any = {\n      sig: null,\n      ver: null,\n      width: null,\n      height: null,\n      colorRes: null,\n      globalColorTableSize: null,\n      gctFlag: null,\n      sorted: null,\n      globalColorTable: [],\n      bgColor: null,\n      pixelAspectRatio: null // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\n    };\n\n    hdr.sig = this._st.read(3);\n    hdr.ver = this._st.read(3);\n    if (hdr.sig !== 'GIF') {\n      throw new Error('Not a GIF file.'); // XXX: This should probably be handled more nicely.\n    }\n\n    hdr.width = this._st.readUnsigned();\n    hdr.height = this._st.readUnsigned();\n\n    const bits = byteToBitArr(this._st.readByte());\n    hdr.gctFlag = bits.shift();\n    hdr.colorRes = bitsToNum(bits.splice(0, 3));\n    hdr.sorted = bits.shift();\n    hdr.globalColorTableSize = bitsToNum(bits.splice(0, 3));\n\n    hdr.bgColor = this._st.readByte();\n    hdr.pixelAspectRatio = this._st.readByte(); // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\n\n    if (hdr.gctFlag) {\n      hdr.globalColorTable = this.parseColorTable(1 << (hdr.globalColorTableSize + 1));\n      this.globalColorTable = hdr.globalColorTable;\n    }\n    if (this._handler.hdr && this._handler.hdr(hdr)) {\n      this.checkBytes.push(this._handler.hdr);\n    }\n  };\n\n  parseExt = (block: any) => {\n    const parseGCExt = (block: any) => {\n      this.checkBytes.push(this._st.readByte()); // Always 4\n\n      const bits = byteToBitArr(this._st.readByte());\n      block.reserved = bits.splice(0, 3); // Reserved; should be 000.\n      block.disposalMethod = bitsToNum(bits.splice(0, 3));\n      block.userInput = bits.shift();\n      block.transparencyGiven = bits.shift();\n\n      block.delayTime = this._st.readUnsigned();\n\n      block.transparencyIndex = this._st.readByte();\n\n      block.terminator = this._st.readByte();\n\n      if (this._handler.gce && this._handler.gce(block)) {\n        this.checkBytes.push(this._handler.gce);\n      }\n    };\n\n    const parseComExt = (block: any) => {\n      block.comment = this.readSubBlocks();\n      if (this._handler.com && this._handler.com(block)) {\n        this.checkBytes.push(this._handler.com);\n      }\n    };\n\n    const parsePTExt = (block: any) => {\n      this.checkBytes.push(this._st.readByte()); // Always 12\n      block.ptHeader = this._st.readBytes(12);\n      block.ptData = this.readSubBlocks();\n      if (this._handler.pte && this._handler.pte(block)) {\n        this.checkBytes.push(this._handler.pte);\n      }\n    };\n\n    const parseAppExt = (block: any) => {\n      const parseNetscapeExt = (block: any) => {\n        this.checkBytes.push(this._st.readByte()); // Always 3\n        block.unknown = this._st.readByte(); // ??? Always 1? What is this?\n        block.iterations = this._st.readUnsigned();\n        block.terminator = this._st.readByte();\n        if (this._handler.app && this._handler.app.NETSCAPE && this._handler.app.NETSCAPE(block)) {\n          this.checkBytes.push(this._handler.app);\n        }\n      };\n\n      const parseUnknownAppExt = (block: any) => {\n        block.appData = this.readSubBlocks();\n        // FIXME: This won't work if a handler wants to match on any identifier.\n        if (this._handler.app && this._handler.app[block.identifier] && this._handler.app[block.identifier](block)) {\n          this.checkBytes.push(this._handler.app[block.identifier]);\n        }\n      };\n\n      this.checkBytes.push(this._st.readByte()); // Always 11\n      block.identifier = this._st.read(8);\n      block.authCode = this._st.read(3);\n      switch (block.identifier) {\n        case 'NETSCAPE':\n          parseNetscapeExt(block);\n          break;\n        default:\n          parseUnknownAppExt(block);\n          break;\n      }\n    };\n\n    const parseUnknownExt = (block: any) => {\n      block.data = this.readSubBlocks();\n      if (this._handler.unknown && this._handler.unknown(block)) {\n        this.checkBytes.push(this._handler.unknown);\n      }\n    };\n\n    block.label = this._st.readByte();\n    switch (block.label) {\n      case 0xf9:\n        block.extType = 'gce';\n        parseGCExt(block);\n        break;\n      case 0xfe:\n        block.extType = 'com';\n        parseComExt(block);\n        break;\n      case 0x01:\n        block.extType = 'pte';\n        parsePTExt(block);\n        break;\n      case 0xff:\n        block.extType = 'app';\n        parseAppExt(block);\n        break;\n      default:\n        block.extType = 'unknown';\n        parseUnknownExt(block);\n        break;\n    }\n  };\n\n  parseImg = (img: any) => {\n    const deinterlace = (pixels: any, width: any) => {\n      // Of course this defeats the purpose of interlacing. And it's *probably*\n      // the least efficient way it's ever been implemented. But nevertheless...\n\n      const newPixels = new Array(pixels.length);\n      const rows = pixels.length / width;\n      const cpRow = (toRow: any, fromRow: any) => {\n        const fromPixels = pixels.slice(fromRow * width, (fromRow + 1) * width);\n        newPixels.splice.apply(newPixels, [toRow * width, width].concat(fromPixels));\n      };\n\n      const offsets = [0, 4, 2, 1];\n      const steps = [8, 8, 4, 2];\n\n      let fromRow = 0;\n      for (let pass = 0; pass < 4; pass++) {\n        for (let toRow = offsets[pass]; toRow < rows; toRow += steps[pass]) {\n          cpRow(toRow, fromRow);\n          fromRow++;\n        }\n      }\n\n      return newPixels;\n    };\n\n    img.leftPos = this._st.readUnsigned();\n    img.topPos = this._st.readUnsigned();\n    img.width = this._st.readUnsigned();\n    img.height = this._st.readUnsigned();\n\n    const bits = byteToBitArr(this._st.readByte());\n    img.lctFlag = bits.shift();\n    img.interlaced = bits.shift();\n    img.sorted = bits.shift();\n    img.reserved = bits.splice(0, 2);\n    img.lctSize = bitsToNum(bits.splice(0, 3));\n\n    if (img.lctFlag) {\n      img.lct = this.parseColorTable(1 << (img.lctSize + 1));\n    }\n\n    img.lzwMinCodeSize = this._st.readByte();\n\n    const lzwData = this.readSubBlocks();\n\n    img.pixels = lzwDecode(img.lzwMinCodeSize, lzwData);\n\n    if (img.interlaced) {\n      // Move\n      img.pixels = deinterlace(img.pixels, img.width);\n    }\n\n    this.frames.push(img);\n    this.arrayToImage(img);\n    if (this._handler.img && this._handler.img(img)) {\n      this.checkBytes.push(this._handler);\n    }\n  };\n\n  public parseBlock = () => {\n    const block = {\n      sentinel: this._st.readByte(),\n      type: ''\n    };\n    const blockChar = String.fromCharCode(block.sentinel);\n    switch (blockChar) {\n      case '!':\n        block.type = 'ext';\n        this.parseExt(block);\n        break;\n      case ',':\n        block.type = 'img';\n        this.parseImg(block);\n        break;\n      case ';':\n        block.type = 'eof';\n        if (this._handler.eof && this._handler.eof(block)) {\n          this.checkBytes.push(this._handler.eof);\n        }\n        break;\n      default:\n        throw new Error('Unknown block: 0x' + block.sentinel.toString(16));\n    }\n\n    if (block.type !== 'eof') {\n      this.parseBlock();\n    }\n  };\n\n  arrayToImage = (frame: Frame) => {\n    let count = 0;\n    const c = document.createElement('canvas');\n    c.id = count.toString();\n    c.width = frame.width;\n    c.height = frame.height;\n    count++;\n    const context = c.getContext('2d');\n    const pixSize = 1;\n    let y = 0;\n    let x = 0;\n    for (let i = 0; i < frame.pixels.length; i++) {\n      if (x % frame.width === 0) {\n        y++;\n        x = 0;\n      }\n      if (this.globalColorTable[frame.pixels[i]] === this._transparentColor.toHex()) {\n        context.fillStyle = `rgba(0, 0, 0, 0)`;\n      } else {\n        context.fillStyle = this.globalColorTable[frame.pixels[i]];\n      }\n\n      context.fillRect(x, y, pixSize, pixSize);\n      x++;\n    }\n    const img = new Image();\n    img.src = c.toDataURL();\n    this.images.push(img);\n  };\n}\n","import { obsolete } from './Decorators';\n\n/**\n * A sorted list implementation. NOTE: this implementation is not self-balancing\n * @deprecated\n */\n@obsolete({message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use built in JS array.sort'})\nexport class SortedList<T> {\n  private _getComparable: (item: T) => number;\n  private _root: BinaryTreeNode<T>;\n\n  constructor(getComparable: (item: T) => number) {\n    this._getComparable = getComparable;\n  }\n\n  public find(element: T): boolean {\n    return this._find(this._root, element);\n  }\n\n  private _find(node: BinaryTreeNode<T>, element: any): boolean {\n    if (node == null) {\n      return false;\n    } else if (this._getComparable(element) === node.getKey()) {\n      if (node.getData().indexOf(element) > -1) {\n        return true;\n      } else {\n        return false;\n      }\n    } else if (this._getComparable(element) < node.getKey()) {\n      return this._find(node.getLeft(), element);\n    } else {\n      return this._find(node.getRight(), element);\n    }\n  }\n\n  // returns the array of elements at a specific key value\n  public get(key: number): any[] {\n    return this._get(this._root, key);\n  }\n\n  private _get(node: BinaryTreeNode<T>, key: number): any[] {\n    if (node == null) {\n      return [];\n    } else if (key === node.getKey()) {\n      return node.getData();\n    } else if (key < node.getKey()) {\n      return this._get(node.getLeft(), key);\n    } else {\n      return this._get(node.getRight(), key);\n    }\n  }\n\n  public add(element: T): boolean {\n    if (this._root == null) {\n      this._root = new BinaryTreeNode(this._getComparable(element), [element], null, null);\n      return true;\n    } else {\n      return this._insert(this._root, element);\n    }\n  }\n\n  private _insert(node: BinaryTreeNode<T>, element: T): boolean {\n    if (node != null) {\n      if (this._getComparable(element) === node.getKey()) {\n        if (node.getData().indexOf(element) > -1) {\n          return false; // the element we're trying to insert already exists\n        } else {\n          node.getData().push(element);\n          return true;\n        }\n      } else if (this._getComparable(element) < node.getKey()) {\n        if (node.getLeft() == null) {\n          node.setLeft(new BinaryTreeNode(this._getComparable(element), [element], null, null));\n          return true;\n        } else {\n          return this._insert(node.getLeft(), element);\n        }\n      } else {\n        if (node.getRight() == null) {\n          node.setRight(new BinaryTreeNode(this._getComparable(element), [element], null, null));\n          return true;\n        } else {\n          return this._insert(node.getRight(), element);\n        }\n      }\n    }\n    return false;\n  }\n\n  public removeByComparable(element: T): void {\n    this._root = this._remove(this._root, element);\n  }\n\n  private _remove(node: BinaryTreeNode<T>, element: T): BinaryTreeNode<T> {\n    if (node == null) {\n      return null;\n    } else if (this._getComparable(element) === node.getKey()) {\n      const elementIndex = node.getData().indexOf(element);\n      // if the node contains the element, remove the element\n      if (elementIndex > -1) {\n        node.getData().splice(elementIndex, 1);\n        // if we have removed the last element at this node, remove the node\n        if (node.getData().length === 0) {\n          // if the node is a leaf\n          if (node.getLeft() == null && node.getRight() == null) {\n            return null;\n          } else if (node.getLeft() == null) {\n            return node.getRight();\n          } else if (node.getRight() == null) {\n            return node.getLeft();\n          }\n          // if node has 2 children\n          const temp = this._findMinNode(node.getRight());\n          node.setKey(temp.getKey());\n          node.setData(temp.getData());\n          node.setRight(this._cleanup(node.getRight(), temp)); //\"cleanup nodes\" (move them up recursively)\n          return node;\n        } else {\n          // this prevents the node from being removed since it still contains elements\n          return node;\n        }\n      }\n    } else if (this._getComparable(element) < node.getKey()) {\n      node.setLeft(this._remove(node.getLeft(), element));\n      return node;\n    } else {\n      node.setRight(this._remove(node.getRight(), element));\n      return node;\n    }\n    return null;\n  }\n\n  // called once we have successfully removed the element we wanted, recursively corrects the part of the tree below the removed node\n  private _cleanup(node: BinaryTreeNode<T>, element: BinaryTreeNode<T>): BinaryTreeNode<T> {\n    const comparable = element.getKey();\n    if (node == null) {\n      return null;\n    } else if (comparable === node.getKey()) {\n      // if the node is a leaf\n      if (node.getLeft() == null && node.getRight() == null) {\n        return null;\n      } else if (node.getLeft() == null) {\n        return node.getRight();\n      } else if (node.getRight() == null) {\n        return node.getLeft();\n      }\n      // if node has 2 children\n      const temp = this._findMinNode(node.getRight());\n      node.setKey(temp.getKey());\n      node.setData(temp.getData());\n\n      node.setRight(this._cleanup(node.getRight(), temp));\n      return node;\n    } else if (element.getKey() < node.getKey()) {\n      node.setLeft(this._cleanup(node.getLeft(), element));\n      return node;\n    } else {\n      node.setRight(this._cleanup(node.getRight(), element));\n      return node;\n    }\n  }\n\n  private _findMinNode(node: BinaryTreeNode<T>): BinaryTreeNode<T> {\n    let current = node;\n    while (current.getLeft() != null) {\n      current = current.getLeft();\n    }\n    return current;\n  }\n\n  public list(): Array<T> {\n    const results = new Array<T>();\n    this._list(this._root, results);\n    return results;\n  }\n\n  private _list(treeNode: BinaryTreeNode<T>, results: Array<T>): void {\n    if (treeNode != null) {\n      this._list(treeNode.getLeft(), results);\n      treeNode.getData().forEach((element) => {\n        results.push(element);\n      });\n      this._list(treeNode.getRight(), results);\n    }\n  }\n}\n\n/**\n * A tree node part of [[SortedList]]\n * @deprecated\n */\n@obsolete({message: 'Will be removed in excalibur v0.26.0'})\nexport class BinaryTreeNode<T> {\n  private _key: number;\n  private _data: Array<T>;\n  private _left: BinaryTreeNode<T>;\n  private _right: BinaryTreeNode<T>;\n\n  constructor(key: number, data: Array<T>, left: BinaryTreeNode<T>, right: BinaryTreeNode<T>) {\n    this._key = key;\n    this._data = data;\n    this._left = left;\n    this._right = right;\n  }\n\n  public getKey(): number {\n    return this._key;\n  }\n\n  public setKey(key: number) {\n    this._key = key;\n  }\n\n  public getData(): T[] {\n    return this._data;\n  }\n\n  public setData(data: T[]) {\n    this._data = data;\n  }\n\n  public getLeft(): BinaryTreeNode<T> {\n    return this._left;\n  }\n\n  public setLeft(left: BinaryTreeNode<T>) {\n    this._left = left;\n  }\n\n  public getRight(): BinaryTreeNode<T> {\n    return this._right;\n  }\n\n  public setRight(right: BinaryTreeNode<T>) {\n    this._right = right;\n  }\n}\n\n/**\n * Mock element for testing\n *\n * @internal\n * @deprecated\n */\nexport class MockedElement {\n  private _key: number = 0;\n\n  constructor(key: number) {\n    this._key = key;\n  }\n\n  public getTheKey() {\n    return this._key;\n  }\n\n  public setKey(key: number) {\n    this._key = key;\n  }\n}\n","// Promises/A+ Spec http://promises-aplus.github.io/promises-spec/\n\nimport { obsolete } from './Util/Decorators';\n\n/**\n * Valid states for a promise to be in\n * @deprecated Will be removed in v0.26.0\n */\nexport enum PromiseState {\n  Resolved,\n  Rejected,\n  Pending\n}\n\n/**\n * @deprecated Will be removed in v0.26.0\n */\nexport interface PromiseLike<T> {\n  then(successCallback?: (value?: T) => any, rejectCallback?: (value?: T) => any): PromiseLike<T>;\n  error(rejectCallback?: (value?: any) => any): PromiseLike<T>;\n\n  //Cannot define static methods on interfaces\n  //wrap<T>(value?: T): IPromise<T>;\n\n  resolve(value?: T): PromiseLike<T>;\n  reject(value?: any): PromiseLike<T>;\n\n  state(): PromiseState;\n}\n\n/**\n * Promises are used to do asynchronous work and they are useful for\n * creating a chain of actions. In Excalibur they are used for loading,\n * sounds, animation, actions, and more.\n * @deprecated Will be removed in v0.26.0\n */\n@obsolete({\n  message: 'ex.Promises are being replaced by native browser promises in v0.26.0',\n  alternateMethod: 'Use browser native promises'\n})\nexport class Promise<T> implements PromiseLike<T> {\n  private _state: PromiseState = PromiseState.Pending;\n  private _value: T;\n  private _successCallbacks: { (value?: T): any }[] = [];\n  private _rejectCallback: (value?: any) => any = () => {\n    return;\n  };\n  private _errorCallback: (value?: any) => any;\n\n  /**\n   * Create and resolve a Promise with an optional value\n   * @param value  An optional value to wrap in a resolved promise\n   */\n  public static resolve<T>(value?: T): Promise<T> {\n    const promise = new Promise<T>().resolve(value);\n\n    return promise;\n  }\n\n  /**\n   * Create and reject a Promise with an optional value\n   * @param value  An optional value to wrap in a rejected promise\n   */\n  public static reject<T>(value?: T): Promise<T> {\n    const promise = new Promise<T>().reject(value);\n\n    return promise;\n  }\n\n  /**\n   * Returns a new promise that resolves when all the promises passed to it resolve, or rejects\n   * when at least 1 promise rejects.\n   */\n  public static join<T>(promises: Promise<T>[]): Promise<T>;\n\n  /**\n   * Returns a new promise that resolves when all the promises passed to it resolve, or rejects\n   * when at least 1 promise rejects.\n   */\n  public static join<T>(...promises: Promise<T>[]): Promise<T>;\n\n  public static join<T>() {\n    let promises: Promise<T>[] = [];\n\n    if (arguments.length > 0 && !Array.isArray(arguments[0])) {\n      for (let _i = 0; _i < arguments.length; _i++) {\n        promises[_i - 0] = arguments[_i];\n      }\n    } else if (arguments.length === 1 && Array.isArray(arguments[0])) {\n      promises = arguments[0];\n    }\n\n    const joinedPromise = new Promise<T>();\n    if (!promises || !promises.length) {\n      return joinedPromise.resolve();\n    }\n\n    const total = promises.length;\n    let successes = 0;\n    let rejects = 0;\n    const errors: any = [];\n\n    promises.forEach((p) => {\n      p.then(\n        () => {\n          successes += 1;\n          if (successes === total) {\n            joinedPromise.resolve();\n          } else if (successes + rejects + errors.length === total) {\n            joinedPromise.reject(errors);\n          }\n        },\n        () => {\n          rejects += 1;\n          if (successes + rejects + errors.length === total) {\n            joinedPromise.reject(errors);\n          }\n        }\n      ).error((e) => {\n        errors.push(e);\n        if (errors.length + successes + rejects === total) {\n          joinedPromise.reject(errors);\n        }\n      });\n    });\n\n    return joinedPromise;\n  }\n\n  /**\n   * Chain success and reject callbacks after the promise is resolved\n   * @param successCallback  Call on resolution of promise\n   * @param rejectCallback   Call on rejection of promise\n   */\n  public then(successCallback?: (value?: T) => any, rejectCallback?: (value?: any) => any) {\n    if (successCallback) {\n      this._successCallbacks.push(successCallback);\n\n      // If the promise is already resolved call immediately\n      if (this.state() === PromiseState.Resolved) {\n        try {\n          successCallback.call(this, this._value);\n        } catch (e) {\n          this._handleError(e);\n        }\n      }\n    }\n    if (rejectCallback) {\n      this._rejectCallback = rejectCallback;\n\n      // If the promise is already rejected call immediately\n      if (this.state() === PromiseState.Rejected) {\n        try {\n          rejectCallback.call(this, this._value);\n        } catch (e) {\n          this._handleError(e);\n        }\n      }\n    }\n\n    return this;\n  }\n\n  /**\n   * Add an error callback to the promise\n   * @param errorCallback  Call if there was an error in a callback\n   */\n  public error(errorCallback?: (value?: any) => any) {\n    if (errorCallback) {\n      this._errorCallback = errorCallback;\n    }\n    return this;\n  }\n\n  /**\n   * Resolve the promise and pass an option value to the success callbacks\n   * @param value  Value to pass to the success callbacks\n   */\n  public resolve(value?: T): Promise<T> {\n    if (this._state === PromiseState.Pending) {\n      this._value = value;\n      try {\n        this._state = PromiseState.Resolved;\n        this._successCallbacks.forEach((cb) => {\n          cb.call(this, this._value);\n        });\n      } catch (e) {\n        this._handleError(e);\n      }\n    } else {\n      throw new Error('Cannot resolve a promise that is not in a pending state!');\n    }\n    return this;\n  }\n\n  /**\n   * Reject the promise and pass an option value to the reject callbacks\n   * @param value  Value to pass to the reject callbacks\n   */\n  public reject(value?: any) {\n    if (this._state === PromiseState.Pending) {\n      this._value = value;\n      try {\n        this._state = PromiseState.Rejected;\n        this._rejectCallback.call(this, this._value);\n      } catch (e) {\n        this._handleError(e);\n      }\n    } else {\n      throw new Error('Cannot reject a promise that is not in a pending state!');\n    }\n    return this;\n  }\n\n  /**\n   * Inspect the current state of a promise\n   */\n  public state(): PromiseState {\n    return this._state;\n  }\n\n  private _handleError(e: any) {\n    if (this._errorCallback) {\n      this._errorCallback.call(this, e);\n    } else {\n      // rethrow error\n      throw e;\n    }\n  }\n}\n","/**\n * The current Excalibur version string\n * @description `process.env.__EX_VERSION` gets replaced by Webpack on build\n */\nexport const EX_VERSION = process.env.__EX_VERSION;\nimport { polyfill } from './Polyfill';\npolyfill();\n\n// This file is used as the bundle entry point and exports everything\n// that will be exposed as the `ex` global variable.\nexport * from './Flags';\nexport * from './Engine';\nexport * from './Screen';\nexport { Actor, ActorArgs } from './Actor';\nexport { CollisionType } from './Collision/CollisionType';\nexport * from './Algebra';\nexport * from './Camera';\nexport * from './Class';\nexport * from './Configurable';\nexport * from './Debug';\nexport * from './EventDispatcher';\nexport * from './Events/MediaEvents';\nexport * from './Events';\nexport { Label, FontStyle, FontUnit, TextAlign, BaseAlign } from './Label';\nexport * from './Loader';\nexport { Particle, ParticleEmitter, ParticleArgs, ParticleEmitterArgs, EmitterType } from './Particles';\nexport * from './Physics';\nexport * from './Scene';\nexport { TileMap, Cell, TileMapArgs, CellArgs, TileSprite } from './TileMap';\nexport * from './Timer';\nexport * from './Trigger';\nexport * from './ScreenElement';\n\nexport * from './Actions/Index';\nexport * from './Collision/Index';\nexport * from './Drawing/Index';\nexport * from './Interfaces/Index';\nexport * from './Math/Index';\nexport * from './PostProcessing/Index';\nexport * from './Resources/Index';\n\nexport * from './EntityComponentSystem/index';\n\n// ex.Events namespace\nimport * as events from './Events';\nexport { events as Events };\n\n// ex.Input namespace\nimport * as input from './Input/Index';\nexport { input as Input };\n\n// ex.Traits namespace\nimport * as traits from './Traits/Index';\nexport { traits as Traits };\n\n// ex.Util namespaces\nimport * as util from './Util/Index';\nexport { util as Util };\n\nexport * from './Util/Browser';\nexport * from './Util/Decorators';\nexport * from './Util/Detector';\nexport * from './Util/CullingBox';\nexport * from './Util/EasingFunctions';\nexport * from './Util/Log';\nexport * from './Util/SortedList';\n\n// ex.Deprecated\nexport * from './Promises';\n// import * as deprecated from './Deprecated';\n// export { deprecated as Deprecated };\n// export * from './Deprecated';\n"],"sourceRoot":""}