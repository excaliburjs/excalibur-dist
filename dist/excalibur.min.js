/*!
 * excalibur - 0.25.0-alpha.7428+e6fe439 - 2020-11-5
 * https://github.com/excaliburjs/Excalibur
 * Copyright (c) 2020 Excalibur.js <https://github.com/excaliburjs/Excalibur/graphs/contributors>
 * Licensed BSD-2-Clause
 * @preserve
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ex=e():t.ex=e()}(window,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=179)}([function(t,e,n){var i=n(7),r=n(17).f,o=n(16),s=n(40),a=n(46),c=n(98),u=n(99);t.exports=function(t,e){var n,h,l,p,f,d=t.target,y=t.global,g=t.stat;if(n=y?i:g?i[d]||a(d,{}):(i[d]||{}).prototype)for(h in e){if(p=e[h],l=t.noTargetGet?(f=r(n,h))&&f.value:n[h],!u(y?h:d+(g?".":"#")+h,t.forced)&&void 0!==l){if(typeof p==typeof l)continue;c(p,l)}(t.sham||l&&l.sham)&&o(p,"sham",!0),s(n,h,p,t)}}},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,n){var i=n(1);t.exports=!i((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(t,e,n){var i=n(45);t.exports=function(t){return Object(i(t))}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,n){var i=n(7),r=n(47),o=n(10),s=n(38),a=n(53),c=n(65),u=r("wks"),h=i.Symbol,l=c?h:h&&h.withoutSetter||s;t.exports=function(t){return o(u,t)||(a&&o(h,t)?u[t]=h[t]:u[t]=l("Symbol."+t)),u[t]}},function(t,e,n){var i=n(2),r=n(58),o=n(13),s=n(22),a=Object.defineProperty;e.f=i?a:function(t,e,n){if(o(t),e=s(e,!0),o(n),r)try{return a(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},function(t,e,n){(function(e){var n=function(t){return t&&t.Math==Math&&t};t.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof e&&e)||Function("return this")()}).call(this,n(97))},function(t,e,n){var i=n(21),r=Math.min;t.exports=function(t){return t>0?r(i(t),9007199254740991):0}},function(t,e,n){var i=n(2),r=n(1),o=n(10),s=Object.defineProperty,a={},c=function(t){throw t};t.exports=function(t,e){if(o(a,t))return a[t];e||(e={});var n=[][t],u=!!o(e,"ACCESSORS")&&e.ACCESSORS,h=o(e,0)?e[0]:c,l=o(e,1)?e[1]:void 0;return a[t]=!!n&&!r((function(){if(u&&!i)return!0;var t={length:-1};u?s(t,1,{enumerable:!0,get:c}):t[1]=1,n.call(t,h,l)}))}},function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},function(t,e,n){var i=n(27),r=n(45);t.exports=function(t){return i(r(t))}},function(t,e,n){"use strict";var i=n(1);t.exports=function(t,e){var n=[][t];return!!n&&i((function(){n.call(null,e||function(){throw 1},1)}))}},function(t,e,n){var i=n(4);t.exports=function(t){if(!i(t))throw TypeError(String(t)+" is not an object");return t}},function(t,e,n){var i=n(5),r=n(41),o=n(6),s=i("unscopables"),a=Array.prototype;null==a[s]&&o.f(a,s,{configurable:!0,value:r(null)}),t.exports=function(t){a[s][t]=!0}},function(t,e,n){var i=n(42),r=n(27),o=n(3),s=n(8),a=n(34),c=[].push,u=function(t){var e=1==t,n=2==t,u=3==t,h=4==t,l=6==t,p=5==t||l;return function(f,d,y,g){for(var _,v,m=o(f),b=r(m),w=i(d,y,3),x=s(b.length),P=0,A=g||a,S=e?A(f,x):n?A(f,0):void 0;x>P;P++)if((p||P in b)&&(v=w(_=b[P],P,m),t))if(e)S[P]=v;else if(v)switch(t){case 3:return!0;case 5:return _;case 6:return P;case 2:c.call(S,_)}else if(h)return!1;return l?-1:u||h?h:S}};t.exports={forEach:u(0),map:u(1),filter:u(2),some:u(3),every:u(4),find:u(5),findIndex:u(6)}},function(t,e,n){var i=n(2),r=n(6),o=n(24);t.exports=i?function(t,e,n){return r.f(t,e,o(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e,n){var i=n(2),r=n(39),o=n(24),s=n(11),a=n(22),c=n(10),u=n(58),h=Object.getOwnPropertyDescriptor;e.f=i?h:function(t,e){if(t=s(t),e=a(e,!0),u)try{return h(t,e)}catch(t){}if(c(t,e))return o(!r.f.call(t,e),t[e])}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}},function(t,e,n){"use strict";var i=n(22),r=n(6),o=n(24);t.exports=function(t,e,n){var s=i(e);s in t?r.f(t,s,o(0,n)):t[s]=n}},function(t,e,n){var i=n(48);t.exports=Array.isArray||function(t){return"Array"==i(t)}},function(t,e){var n=Math.ceil,i=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?i:n)(t)}},function(t,e,n){var i=n(4);t.exports=function(t,e){if(!i(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!i(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!i(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!i(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},function(t,e,n){var i=n(10),r=n(3),o=n(37),s=n(64),a=o("IE_PROTO"),c=Object.prototype;t.exports=s?Object.getPrototypeOf:function(t){return t=r(t),i(t,a)?t[a]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?c:null}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){t.exports=!1},function(t,e){t.exports={}},function(t,e,n){var i=n(1),r=n(48),o="".split;t.exports=i((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==r(t)?o.call(t,""):Object(t)}:Object},function(t,e,n){var i=n(29),r=n(7),o=function(t){return"function"==typeof t?t:void 0};t.exports=function(t,e){return arguments.length<2?o(i[t])||o(r[t]):i[t]&&i[t][e]||r[t]&&r[t][e]}},function(t,e,n){var i=n(7);t.exports=i},function(t,e,n){var i=n(21),r=Math.max,o=Math.min;t.exports=function(t,e){var n=i(t);return n<0?r(n+e,0):o(n,e)}},function(t,e,n){var i=n(62),r=n(51);t.exports=Object.keys||function(t){return i(t,r)}},function(t,e,n){var i=n(6).f,r=n(10),o=n(5)("toStringTag");t.exports=function(t,e,n){t&&!r(t=n?t:t.prototype,o)&&i(t,o,{configurable:!0,value:e})}},function(t,e){t.exports={}},function(t,e,n){var i=n(4),r=n(20),o=n(5)("species");t.exports=function(t,e){var n;return r(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!r(n.prototype)?i(n)&&null===(n=n[o])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)}},function(t,e,n){var i=n(1),r=n(5),o=n(72),s=r("species");t.exports=function(t){return o>=51||!i((function(){var e=[];return(e.constructor={})[s]=function(){return{foo:1}},1!==e[t](Boolean).foo}))}},function(t,e,n){var i,r,o,s=n(96),a=n(7),c=n(4),u=n(16),h=n(10),l=n(37),p=n(26),f=a.WeakMap;if(s){var d=new f,y=d.get,g=d.has,_=d.set;i=function(t,e){return _.call(d,t,e),e},r=function(t){return y.call(d,t)||{}},o=function(t){return g.call(d,t)}}else{var v=l("state");p[v]=!0,i=function(t,e){return u(t,v,e),e},r=function(t){return h(t,v)?t[v]:{}},o=function(t){return h(t,v)}}t.exports={set:i,get:r,has:o,enforce:function(t){return o(t)?r(t):i(t,{})},getterFor:function(t){return function(e){var n;if(!c(e)||(n=r(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}}},function(t,e,n){var i=n(47),r=n(38),o=i("keys");t.exports=function(t){return o[t]||(o[t]=r(t))}},function(t,e){var n=0,i=Math.random();t.exports=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++n+i).toString(36)}},function(t,e,n){"use strict";var i={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,o=r&&!i.call({1:2},1);e.f=o?function(t){var e=r(this,t);return!!e&&e.enumerable}:i},function(t,e,n){var i=n(7),r=n(16),o=n(10),s=n(46),a=n(56),c=n(36),u=c.get,h=c.enforce,l=String(String).split("String");(t.exports=function(t,e,n,a){var c=!!a&&!!a.unsafe,u=!!a&&!!a.enumerable,p=!!a&&!!a.noTargetGet;"function"==typeof n&&("string"!=typeof e||o(n,"name")||r(n,"name",e),h(n).source=l.join("string"==typeof e?e:"")),t!==i?(c?!p&&t[e]&&(u=!0):delete t[e],u?t[e]=n:r(t,e,n)):u?t[e]=n:s(e,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&u(this).source||a(this)}))},function(t,e,n){var i,r=n(13),o=n(66),s=n(51),a=n(26),c=n(101),u=n(59),h=n(37),l=h("IE_PROTO"),p=function(){},f=function(t){return"<script>"+t+"<\/script>"},d=function(){try{i=document.domain&&new ActiveXObject("htmlfile")}catch(t){}var t,e;d=i?function(t){t.write(f("")),t.close();var e=t.parentWindow.Object;return t=null,e}(i):((e=u("iframe")).style.display="none",c.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(f("document.F=Object")),t.close(),t.F);for(var n=s.length;n--;)delete d.prototype[s[n]];return d()};a[l]=!0,t.exports=Object.create||function(t,e){var n;return null!==t?(p.prototype=r(t),n=new p,p.prototype=null,n[l]=t):n=d(),void 0===e?n:o(n,e)}},function(t,e,n){var i=n(18);t.exports=function(t,e,n){if(i(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,r){return t.call(e,n,i,r)}}return function(){return t.apply(e,arguments)}}},function(t,e,n){var i=n(1);t.exports=!i((function(){return Object.isExtensible(Object.preventExtensions({}))}))},function(t,e,n){"use strict";var i=n(25),r=n(7),o=n(1);t.exports=i||!o((function(){var t=Math.random();__defineSetter__.call(null,t,(function(){})),delete r[t]}))},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t}},function(t,e,n){var i=n(7),r=n(16);t.exports=function(t,e){try{r(i,t,e)}catch(n){i[t]=e}return e}},function(t,e,n){var i=n(25),r=n(57);(t.exports=function(t,e){return r[t]||(r[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.6.5",mode:i?"pure":"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})},function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,e,n){var i=n(62),r=n(51).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return i(t,r)}},function(t,e,n){var i=n(11),r=n(8),o=n(30),s=function(t){return function(e,n,s){var a,c=i(e),u=r(c.length),h=o(s,u);if(t&&n!=n){for(;u>h;)if((a=c[h++])!=a)return!0}else for(;u>h;h++)if((t||h in c)&&c[h]===n)return t||h||0;return!t&&-1}};t.exports={includes:s(!0),indexOf:s(!1)}},function(t,e){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,n){var i=n(1);t.exports=!!Object.getOwnPropertySymbols&&!i((function(){return!String(Symbol())}))},function(t,e,n){var i={};i[n(5)("toStringTag")]="z",t.exports="[object z]"===String(i)},function(t,e,n){var i=n(26),r=n(4),o=n(10),s=n(6).f,a=n(38),c=n(43),u=a("meta"),h=0,l=Object.isExtensible||function(){return!0},p=function(t){s(t,u,{value:{objectID:"O"+ ++h,weakData:{}}})},f=t.exports={REQUIRED:!1,fastKey:function(t,e){if(!r(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,u)){if(!l(t))return"F";if(!e)return"E";p(t)}return t[u].objectID},getWeakData:function(t,e){if(!o(t,u)){if(!l(t))return!0;if(!e)return!1;p(t)}return t[u].weakData},onFreeze:function(t){return c&&f.REQUIRED&&l(t)&&!o(t,u)&&p(t),t}};i[u]=!0},function(t,e,n){var i=n(57),r=Function.toString;"function"!=typeof i.inspectSource&&(i.inspectSource=function(t){return r.call(t)}),t.exports=i.inspectSource},function(t,e,n){var i=n(7),r=n(46),o=i["__core-js_shared__"]||r("__core-js_shared__",{});t.exports=o},function(t,e,n){var i=n(2),r=n(1),o=n(59);t.exports=!i&&!r((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},function(t,e,n){var i=n(7),r=n(4),o=i.document,s=r(o)&&r(o.createElement);t.exports=function(t){return s?o.createElement(t):{}}},function(t,e,n){"use strict";var i=n(0),r=n(100),o=n(23),s=n(67),a=n(32),c=n(16),u=n(40),h=n(5),l=n(25),p=n(33),f=n(63),d=f.IteratorPrototype,y=f.BUGGY_SAFARI_ITERATORS,g=h("iterator"),_=function(){return this};t.exports=function(t,e,n,h,f,v,m){r(n,e,h);var b,w,x,P=function(t){if(t===f&&O)return O;if(!y&&t in E)return E[t];switch(t){case"keys":case"values":case"entries":return function(){return new n(this,t)}}return function(){return new n(this)}},A=e+" Iterator",S=!1,E=t.prototype,C=E[g]||E["@@iterator"]||f&&E[f],O=!y&&C||P(f),T="Array"==e&&E.entries||C;if(T&&(b=o(T.call(new t)),d!==Object.prototype&&b.next&&(l||o(b)===d||(s?s(b,d):"function"!=typeof b[g]&&c(b,g,_)),a(b,A,!0,!0),l&&(p[A]=_))),"values"==f&&C&&"values"!==C.name&&(S=!0,O=function(){return C.call(this)}),l&&!m||E[g]===O||c(E,g,O),p[e]=O,f)if(w={values:P("values"),keys:v?O:P("keys"),entries:P("entries")},m)for(x in w)!y&&!S&&x in E||u(E,x,w[x]);else i({target:e,proto:!0,forced:y||S},w);return w}},function(t,e,n){var i=n(28),r=n(49),o=n(52),s=n(13);t.exports=i("Reflect","ownKeys")||function(t){var e=r.f(s(t)),n=o.f;return n?e.concat(n(t)):e}},function(t,e,n){var i=n(10),r=n(11),o=n(50).indexOf,s=n(26);t.exports=function(t,e){var n,a=r(t),c=0,u=[];for(n in a)!i(s,n)&&i(a,n)&&u.push(n);for(;e.length>c;)i(a,n=e[c++])&&(~o(u,n)||u.push(n));return u}},function(t,e,n){"use strict";var i,r,o,s=n(23),a=n(16),c=n(10),u=n(5),h=n(25),l=u("iterator"),p=!1;[].keys&&("next"in(o=[].keys())?(r=s(s(o)))!==Object.prototype&&(i=r):p=!0),null==i&&(i={}),h||c(i,l)||a(i,l,(function(){return this})),t.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:p}},function(t,e,n){var i=n(1);t.exports=!i((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},function(t,e,n){var i=n(53);t.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(t,e,n){var i=n(2),r=n(6),o=n(13),s=n(31);t.exports=i?Object.defineProperties:function(t,e){o(t);for(var n,i=s(e),a=i.length,c=0;a>c;)r.f(t,n=i[c++],e[n]);return t}},function(t,e,n){var i=n(13),r=n(102);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),e=n instanceof Array}catch(t){}return function(n,o){return i(n),r(o),e?t.call(n,o):n.__proto__=o,n}}():void 0)},function(t,e,n){var i=n(13);t.exports=function(t,e,n,r){try{return r?e(i(n)[0],n[1]):e(n)}catch(e){var o=t.return;throw void 0!==o&&i(o.call(t)),e}}},function(t,e,n){var i=n(5),r=n(33),o=i("iterator"),s=Array.prototype;t.exports=function(t){return void 0!==t&&(r.Array===t||s[o]===t)}},function(t,e,n){var i=n(71),r=n(33),o=n(5)("iterator");t.exports=function(t){if(null!=t)return t[o]||t["@@iterator"]||r[i(t)]}},function(t,e,n){var i=n(54),r=n(48),o=n(5)("toStringTag"),s="Arguments"==r(function(){return arguments}());t.exports=i?r:function(t){var e,n,i;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),o))?n:s?r(e):"Object"==(i=r(e))&&"function"==typeof e.callee?"Arguments":i}},function(t,e,n){var i,r,o=n(7),s=n(109),a=o.process,c=a&&a.versions,u=c&&c.v8;u?r=(i=u.split("."))[0]+i[1]:s&&(!(i=s.match(/Edge\/(\d+)/))||i[1]>=74)&&(i=s.match(/Chrome\/(\d+)/))&&(r=i[1]),t.exports=r&&+r},function(t,e,n){"use strict";var i=n(20),r=n(8),o=n(42),s=function(t,e,n,a,c,u,h,l){for(var p,f=c,d=0,y=!!h&&o(h,l,3);d<a;){if(d in n){if(p=y?y(n[d],d,e):n[d],u>0&&i(p))f=s(t,e,p,r(p.length),f,u-1)-1;else{if(f>=9007199254740991)throw TypeError("Exceed the acceptable array length");t[f]=p}f++}d++}return f};t.exports=s},function(t,e,n){var i=n(18),r=n(3),o=n(27),s=n(8),a=function(t){return function(e,n,a,c){i(n);var u=r(e),h=o(u),l=s(u.length),p=t?l-1:0,f=t?-1:1;if(a<2)for(;;){if(p in h){c=h[p],p+=f;break}if(p+=f,t?p<0:l<=p)throw TypeError("Reduce of empty array with no initial value")}for(;t?p>=0:l>p;p+=f)p in h&&(c=n(c,h[p],p,u));return c}};t.exports={left:a(!1),right:a(!0)}},function(t,e,n){var i=n(11),r=n(49).f,o={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return s&&"[object Window]"==o.call(t)?function(t){try{return r(t)}catch(t){return s.slice()}}(t):r(i(t))}},function(t,e,n){var i=n(5);e.f=i},function(t,e,n){var i=n(2),r=n(31),o=n(11),s=n(39).f,a=function(t){return function(e){for(var n,a=o(e),c=r(a),u=c.length,h=0,l=[];u>h;)n=c[h++],i&&!s.call(a,n)||l.push(t?[n,a[n]]:a[n]);return l}};t.exports={entries:a(!0),values:a(!1)}},function(t,e,n){"use strict";var i=n(79),r=n.n(i)()(!0);r.push([t.i,"/* Buttons styles start */\n\nbutton#excalibur-play {\n  display: inline-block;\n  position: relative;\n  z-index: 999;\n  border-radius: 6px;\n  border: none;\n  /*border: 3px solid;\n    border-color: white;\n    box-shadow: 0 0 10px #ccc;*/\n  padding: 1rem 1.5rem 1rem 4rem;\n  margin: 0;\n  text-decoration: none;\n  background: #00b233;\n  color: #ffffff;\n  font-family: sans-serif;\n  font-size: 2rem;\n  line-height: 1;\n  cursor: pointer;\n  text-align: center;\n  transition: background 250ms ease-in-out, transform 150ms ease;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\n  animation: excalibur-button-fadein 200ms;\n}\n\n/*\nbutton#excalibur-play {\n  display: none;\n}*/\n\nbutton#excalibur-play:after {\n  position: absolute;\n  content: '';\n  border: 8px solid;\n  border-color: transparent transparent transparent white;\n  left: 35px;\n  top: 24px;\n  width: 0;\n  height: 0;\n}\n\nbutton#excalibur-play:before {\n  position: absolute;\n  content: '';\n  border: 3px solid;\n  left: 19px;\n  top: 14px;\n  border-radius: 20px;\n  width: 30px;\n  height: 30px;\n}\n\nbutton#excalibur-play:hover,\nbutton#excalibur-play:focus {\n  background: #00982c;\n}\n\nbutton#excalibur-play:focus {\n  outline: 1px solid #fff;\n  outline-offset: -4px;\n}\n\nbutton#excalibur-play:active {\n  transform: scale(0.99);\n}\n\n@keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Firefox < 16 */\n@-moz-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Safari, Chrome and Opera > 12.1 */\n@-webkit-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Internet Explorer */\n@-ms-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Opera < 12.1 */\n@-o-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n","",{version:3,sources:["webpack://Loader.css"],names:[],mappings:"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB,8DAA8D;EAC9D,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF",sourcesContent:["/* Buttons styles start */\n\nbutton#excalibur-play {\n  display: inline-block;\n  position: relative;\n  z-index: 999;\n  border-radius: 6px;\n  border: none;\n  /*border: 3px solid;\n    border-color: white;\n    box-shadow: 0 0 10px #ccc;*/\n  padding: 1rem 1.5rem 1rem 4rem;\n  margin: 0;\n  text-decoration: none;\n  background: #00b233;\n  color: #ffffff;\n  font-family: sans-serif;\n  font-size: 2rem;\n  line-height: 1;\n  cursor: pointer;\n  text-align: center;\n  transition: background 250ms ease-in-out, transform 150ms ease;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\n  animation: excalibur-button-fadein 200ms;\n}\n\n/*\nbutton#excalibur-play {\n  display: none;\n}*/\n\nbutton#excalibur-play:after {\n  position: absolute;\n  content: '';\n  border: 8px solid;\n  border-color: transparent transparent transparent white;\n  left: 35px;\n  top: 24px;\n  width: 0;\n  height: 0;\n}\n\nbutton#excalibur-play:before {\n  position: absolute;\n  content: '';\n  border: 3px solid;\n  left: 19px;\n  top: 14px;\n  border-radius: 20px;\n  width: 30px;\n  height: 30px;\n}\n\nbutton#excalibur-play:hover,\nbutton#excalibur-play:focus {\n  background: #00982c;\n}\n\nbutton#excalibur-play:focus {\n  outline: 1px solid #fff;\n  outline-offset: -4px;\n}\n\nbutton#excalibur-play:active {\n  transform: scale(0.99);\n}\n\n@keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Firefox < 16 */\n@-moz-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Safari, Chrome and Opera > 12.1 */\n@-webkit-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Internet Explorer */\n@-ms-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Opera < 12.1 */\n@-o-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n"],sourceRoot:""}]),e.a=r},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var r=(s=i,a=btoa(unescape(encodeURIComponent(JSON.stringify(s)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(c," */")),o=i.sources.map((function(t){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(t," */")}));return[n].concat(o).concat([r]).join("\n")}var s,a,c;return[n].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,i){"string"==typeof t&&(t=[[null,t,""]]);var r={};if(i)for(var o=0;o<this.length;o++){var s=this[o][0];null!=s&&(r[s]=!0)}for(var a=0;a<t.length;a++){var c=[].concat(t[a]);i&&r[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),e.push(c))}},e}},,,,,,,,,,,,,,function(t,e,n){n(94),n(103),n(106),n(107),n(108),n(110),n(112),n(113),n(115),n(116),n(117),n(118),n(119),n(120),n(122),n(123),n(124),n(125),n(126),n(128),n(129),n(130),n(131),n(132),n(133),n(134),n(135),n(137),n(138),n(139);var i=n(29);t.exports=i.Array},function(t,e,n){"use strict";var i=n(95).charAt,r=n(36),o=n(60),s=r.set,a=r.getterFor("String Iterator");o(String,"String",(function(t){s(this,{type:"String Iterator",string:String(t),index:0})}),(function(){var t,e=a(this),n=e.string,r=e.index;return r>=n.length?{value:void 0,done:!0}:(t=i(n,r),e.index+=t.length,{value:t,done:!1})}))},function(t,e,n){var i=n(21),r=n(45),o=function(t){return function(e,n){var o,s,a=String(r(e)),c=i(n),u=a.length;return c<0||c>=u?t?"":void 0:(o=a.charCodeAt(c))<55296||o>56319||c+1===u||(s=a.charCodeAt(c+1))<56320||s>57343?t?a.charAt(c):o:t?a.slice(c,c+2):s-56320+(o-55296<<10)+65536}};t.exports={codeAt:o(!1),charAt:o(!0)}},function(t,e,n){var i=n(7),r=n(56),o=i.WeakMap;t.exports="function"==typeof o&&/native code/.test(r(o))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){var i=n(10),r=n(61),o=n(17),s=n(6);t.exports=function(t,e){for(var n=r(e),a=s.f,c=o.f,u=0;u<n.length;u++){var h=n[u];i(t,h)||a(t,h,c(e,h))}}},function(t,e,n){var i=n(1),r=/#|\.prototype\./,o=function(t,e){var n=a[s(t)];return n==u||n!=c&&("function"==typeof e?i(e):!!e)},s=o.normalize=function(t){return String(t).replace(r,".").toLowerCase()},a=o.data={},c=o.NATIVE="N",u=o.POLYFILL="P";t.exports=o},function(t,e,n){"use strict";var i=n(63).IteratorPrototype,r=n(41),o=n(24),s=n(32),a=n(33),c=function(){return this};t.exports=function(t,e,n){var u=e+" Iterator";return t.prototype=r(i,{next:o(1,n)}),s(t,u,!1,!0),a[u]=c,t}},function(t,e,n){var i=n(28);t.exports=i("document","documentElement")},function(t,e,n){var i=n(4);t.exports=function(t){if(!i(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype");return t}},function(t,e,n){var i=n(0),r=n(104);i({target:"Array",stat:!0,forced:!n(105)((function(t){Array.from(t)}))},{from:r})},function(t,e,n){"use strict";var i=n(42),r=n(3),o=n(68),s=n(69),a=n(8),c=n(19),u=n(70);t.exports=function(t){var e,n,h,l,p,f,d=r(t),y="function"==typeof this?this:Array,g=arguments.length,_=g>1?arguments[1]:void 0,v=void 0!==_,m=u(d),b=0;if(v&&(_=i(_,g>2?arguments[2]:void 0,2)),null==m||y==Array&&s(m))for(n=new y(e=a(d.length));e>b;b++)f=v?_(d[b],b):d[b],c(n,b,f);else for(p=(l=m.call(d)).next,n=new y;!(h=p.call(l)).done;b++)f=v?o(l,_,[h.value,b],!0):h.value,c(n,b,f);return n.length=b,n}},function(t,e,n){var i=n(5)("iterator"),r=!1;try{var o=0,s={next:function(){return{done:!!o++}},return:function(){r=!0}};s[i]=function(){return this},Array.from(s,(function(){throw 2}))}catch(t){}t.exports=function(t,e){if(!e&&!r)return!1;var n=!1;try{var o={};o[i]=function(){return{next:function(){return{done:n=!0}}}},t(o)}catch(t){}return n}},function(t,e,n){n(0)({target:"Array",stat:!0},{isArray:n(20)})},function(t,e,n){"use strict";var i=n(0),r=n(1),o=n(19);i({target:"Array",stat:!0,forced:r((function(){function t(){}return!(Array.of.call(t)instanceof t)}))},{of:function(){for(var t=0,e=arguments.length,n=new("function"==typeof this?this:Array)(e);e>t;)o(n,t,arguments[t++]);return n.length=e,n}})},function(t,e,n){"use strict";var i=n(0),r=n(1),o=n(20),s=n(4),a=n(3),c=n(8),u=n(19),h=n(34),l=n(35),p=n(5),f=n(72),d=p("isConcatSpreadable"),y=f>=51||!r((function(){var t=[];return t[d]=!1,t.concat()[0]!==t})),g=l("concat"),_=function(t){if(!s(t))return!1;var e=t[d];return void 0!==e?!!e:o(t)};i({target:"Array",proto:!0,forced:!y||!g},{concat:function(t){var e,n,i,r,o,s=a(this),l=h(s,0),p=0;for(e=-1,i=arguments.length;e<i;e++)if(o=-1===e?s:arguments[e],_(o)){if(p+(r=c(o.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<r;n++,p++)n in o&&u(l,p,o[n])}else{if(p>=9007199254740991)throw TypeError("Maximum allowed index exceeded");u(l,p++,o)}return l.length=p,l}})},function(t,e,n){var i=n(28);t.exports=i("navigator","userAgent")||""},function(t,e,n){var i=n(0),r=n(111),o=n(14);i({target:"Array",proto:!0},{copyWithin:r}),o("copyWithin")},function(t,e,n){"use strict";var i=n(3),r=n(30),o=n(8),s=Math.min;t.exports=[].copyWithin||function(t,e){var n=i(this),a=o(n.length),c=r(t,a),u=r(e,a),h=arguments.length>2?arguments[2]:void 0,l=s((void 0===h?a:r(h,a))-u,a-c),p=1;for(u<c&&c<u+l&&(p=-1,u+=l-1,c+=l-1);l-- >0;)u in n?n[c]=n[u]:delete n[c],c+=p,u+=p;return n}},function(t,e,n){"use strict";var i=n(0),r=n(15).every,o=n(12),s=n(9),a=o("every"),c=s("every");i({target:"Array",proto:!0,forced:!a||!c},{every:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,n){var i=n(0),r=n(114),o=n(14);i({target:"Array",proto:!0},{fill:r}),o("fill")},function(t,e,n){"use strict";var i=n(3),r=n(30),o=n(8);t.exports=function(t){for(var e=i(this),n=o(e.length),s=arguments.length,a=r(s>1?arguments[1]:void 0,n),c=s>2?arguments[2]:void 0,u=void 0===c?n:r(c,n);u>a;)e[a++]=t;return e}},function(t,e,n){"use strict";var i=n(0),r=n(15).filter,o=n(35),s=n(9),a=o("filter"),c=s("filter");i({target:"Array",proto:!0,forced:!a||!c},{filter:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,n){"use strict";var i=n(0),r=n(15).find,o=n(14),s=n(9),a=!0,c=s("find");"find"in[]&&Array(1).find((function(){a=!1})),i({target:"Array",proto:!0,forced:a||!c},{find:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),o("find")},function(t,e,n){"use strict";var i=n(0),r=n(15).findIndex,o=n(14),s=n(9),a=!0,c=s("findIndex");"findIndex"in[]&&Array(1).findIndex((function(){a=!1})),i({target:"Array",proto:!0,forced:a||!c},{findIndex:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),o("findIndex")},function(t,e,n){"use strict";var i=n(0),r=n(73),o=n(3),s=n(8),a=n(21),c=n(34);i({target:"Array",proto:!0},{flat:function(){var t=arguments.length?arguments[0]:void 0,e=o(this),n=s(e.length),i=c(e,0);return i.length=r(i,e,e,n,0,void 0===t?1:a(t)),i}})},function(t,e,n){"use strict";var i=n(0),r=n(73),o=n(3),s=n(8),a=n(18),c=n(34);i({target:"Array",proto:!0},{flatMap:function(t){var e,n=o(this),i=s(n.length);return a(t),(e=c(n,0)).length=r(e,n,n,i,0,1,t,arguments.length>1?arguments[1]:void 0),e}})},function(t,e,n){"use strict";var i=n(0),r=n(121);i({target:"Array",proto:!0,forced:[].forEach!=r},{forEach:r})},function(t,e,n){"use strict";var i=n(15).forEach,r=n(12),o=n(9),s=r("forEach"),a=o("forEach");t.exports=s&&a?[].forEach:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}},function(t,e,n){"use strict";var i=n(0),r=n(50).includes,o=n(14);i({target:"Array",proto:!0,forced:!n(9)("indexOf",{ACCESSORS:!0,1:0})},{includes:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),o("includes")},function(t,e,n){"use strict";var i=n(0),r=n(50).indexOf,o=n(12),s=n(9),a=[].indexOf,c=!!a&&1/[1].indexOf(1,-0)<0,u=o("indexOf"),h=s("indexOf",{ACCESSORS:!0,1:0});i({target:"Array",proto:!0,forced:c||!u||!h},{indexOf:function(t){return c?a.apply(this,arguments)||0:r(this,t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,n){"use strict";var i=n(11),r=n(14),o=n(33),s=n(36),a=n(60),c=s.set,u=s.getterFor("Array Iterator");t.exports=a(Array,"Array",(function(t,e){c(this,{type:"Array Iterator",target:i(t),index:0,kind:e})}),(function(){var t=u(this),e=t.target,n=t.kind,i=t.index++;return!e||i>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:i,done:!1}:"values"==n?{value:e[i],done:!1}:{value:[i,e[i]],done:!1}}),"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},function(t,e,n){"use strict";var i=n(0),r=n(27),o=n(11),s=n(12),a=[].join,c=r!=Object,u=s("join",",");i({target:"Array",proto:!0,forced:c||!u},{join:function(t){return a.call(o(this),void 0===t?",":t)}})},function(t,e,n){var i=n(0),r=n(127);i({target:"Array",proto:!0,forced:r!==[].lastIndexOf},{lastIndexOf:r})},function(t,e,n){"use strict";var i=n(11),r=n(21),o=n(8),s=n(12),a=n(9),c=Math.min,u=[].lastIndexOf,h=!!u&&1/[1].lastIndexOf(1,-0)<0,l=s("lastIndexOf"),p=a("indexOf",{ACCESSORS:!0,1:0}),f=h||!l||!p;t.exports=f?function(t){if(h)return u.apply(this,arguments)||0;var e=i(this),n=o(e.length),s=n-1;for(arguments.length>1&&(s=c(s,r(arguments[1]))),s<0&&(s=n+s);s>=0;s--)if(s in e&&e[s]===t)return s||0;return-1}:u},function(t,e,n){"use strict";var i=n(0),r=n(15).map,o=n(35),s=n(9),a=o("map"),c=s("map");i({target:"Array",proto:!0,forced:!a||!c},{map:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,n){"use strict";var i=n(0),r=n(74).left,o=n(12),s=n(9),a=o("reduce"),c=s("reduce",{1:0});i({target:"Array",proto:!0,forced:!a||!c},{reduce:function(t){return r(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}})},function(t,e,n){"use strict";var i=n(0),r=n(74).right,o=n(12),s=n(9),a=o("reduceRight"),c=s("reduce",{1:0});i({target:"Array",proto:!0,forced:!a||!c},{reduceRight:function(t){return r(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}})},function(t,e,n){"use strict";var i=n(0),r=n(20),o=[].reverse,s=[1,2];i({target:"Array",proto:!0,forced:String(s)===String(s.reverse())},{reverse:function(){return r(this)&&(this.length=this.length),o.call(this)}})},function(t,e,n){"use strict";var i=n(0),r=n(4),o=n(20),s=n(30),a=n(8),c=n(11),u=n(19),h=n(5),l=n(35),p=n(9),f=l("slice"),d=p("slice",{ACCESSORS:!0,0:0,1:2}),y=h("species"),g=[].slice,_=Math.max;i({target:"Array",proto:!0,forced:!f||!d},{slice:function(t,e){var n,i,h,l=c(this),p=a(l.length),f=s(t,p),d=s(void 0===e?p:e,p);if(o(l)&&("function"!=typeof(n=l.constructor)||n!==Array&&!o(n.prototype)?r(n)&&null===(n=n[y])&&(n=void 0):n=void 0,n===Array||void 0===n))return g.call(l,f,d);for(i=new(void 0===n?Array:n)(_(d-f,0)),h=0;f<d;f++,h++)f in l&&u(i,h,l[f]);return i.length=h,i}})},function(t,e,n){"use strict";var i=n(0),r=n(15).some,o=n(12),s=n(9),a=o("some"),c=s("some");i({target:"Array",proto:!0,forced:!a||!c},{some:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,n){"use strict";var i=n(0),r=n(18),o=n(3),s=n(1),a=n(12),c=[],u=c.sort,h=s((function(){c.sort(void 0)})),l=s((function(){c.sort(null)})),p=a("sort");i({target:"Array",proto:!0,forced:h||!l||!p},{sort:function(t){return void 0===t?u.call(o(this)):u.call(o(this),r(t))}})},function(t,e,n){n(136)("Array")},function(t,e,n){"use strict";var i=n(28),r=n(6),o=n(5),s=n(2),a=o("species");t.exports=function(t){var e=i(t),n=r.f;s&&e&&!e[a]&&n(e,a,{configurable:!0,get:function(){return this}})}},function(t,e,n){"use strict";var i=n(0),r=n(30),o=n(21),s=n(8),a=n(3),c=n(34),u=n(19),h=n(35),l=n(9),p=h("splice"),f=l("splice",{ACCESSORS:!0,0:0,1:2}),d=Math.max,y=Math.min;i({target:"Array",proto:!0,forced:!p||!f},{splice:function(t,e){var n,i,h,l,p,f,g=a(this),_=s(g.length),v=r(t,_),m=arguments.length;if(0===m?n=i=0:1===m?(n=0,i=_-v):(n=m-2,i=y(d(o(e),0),_-v)),_+n-i>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(h=c(g,i),l=0;l<i;l++)(p=v+l)in g&&u(h,l,g[p]);if(h.length=i,n<i){for(l=v;l<_-i;l++)f=l+n,(p=l+i)in g?g[f]=g[p]:delete g[f];for(l=_;l>_-i+n;l--)delete g[l-1]}else if(n>i)for(l=_-i;l>v;l--)f=l+n-1,(p=l+i-1)in g?g[f]=g[p]:delete g[f];for(l=0;l<n;l++)g[l+v]=arguments[l+2];return g.length=_-i+n,h}})},function(t,e,n){n(14)("flat")},function(t,e,n){n(14)("flatMap")},function(t,e,n){n(141),n(143),n(145),n(146),n(147),n(148),n(149),n(150),n(152),n(153),n(154),n(155),n(156),n(158),n(159),n(160),n(161),n(162),n(163),n(164),n(165),n(166),n(168),n(169),n(170),n(171),n(172),n(173);var i=n(29);t.exports=i.Object},function(t,e,n){"use strict";var i=n(0),r=n(7),o=n(28),s=n(25),a=n(2),c=n(53),u=n(65),h=n(1),l=n(10),p=n(20),f=n(4),d=n(13),y=n(3),g=n(11),_=n(22),v=n(24),m=n(41),b=n(31),w=n(49),x=n(75),P=n(52),A=n(17),S=n(6),E=n(39),C=n(16),O=n(40),T=n(47),B=n(37),D=n(26),M=n(38),j=n(5),R=n(76),k=n(142),F=n(32),I=n(36),L=n(15).forEach,U=B("hidden"),z=j("toPrimitive"),N=I.set,W=I.getterFor("Symbol"),H=Object.prototype,q=r.Symbol,K=o("JSON","stringify"),V=A.f,G=S.f,X=x.f,Q=E.f,Z=T("symbols"),Y=T("op-symbols"),J=T("string-to-symbol-registry"),$=T("symbol-to-string-registry"),tt=T("wks"),et=r.QObject,nt=!et||!et.prototype||!et.prototype.findChild,it=a&&h((function(){return 7!=m(G({},"a",{get:function(){return G(this,"a",{value:7}).a}})).a}))?function(t,e,n){var i=V(H,e);i&&delete H[e],G(t,e,n),i&&t!==H&&G(H,e,i)}:G,rt=function(t,e){var n=Z[t]=m(q.prototype);return N(n,{type:"Symbol",tag:t,description:e}),a||(n.description=e),n},ot=u?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof q},st=function(t,e,n){t===H&&st(Y,e,n),d(t);var i=_(e,!0);return d(n),l(Z,i)?(n.enumerable?(l(t,U)&&t[U][i]&&(t[U][i]=!1),n=m(n,{enumerable:v(0,!1)})):(l(t,U)||G(t,U,v(1,{})),t[U][i]=!0),it(t,i,n)):G(t,i,n)},at=function(t,e){d(t);var n=g(e),i=b(n).concat(lt(n));return L(i,(function(e){a&&!ct.call(n,e)||st(t,e,n[e])})),t},ct=function(t){var e=_(t,!0),n=Q.call(this,e);return!(this===H&&l(Z,e)&&!l(Y,e))&&(!(n||!l(this,e)||!l(Z,e)||l(this,U)&&this[U][e])||n)},ut=function(t,e){var n=g(t),i=_(e,!0);if(n!==H||!l(Z,i)||l(Y,i)){var r=V(n,i);return!r||!l(Z,i)||l(n,U)&&n[U][i]||(r.enumerable=!0),r}},ht=function(t){var e=X(g(t)),n=[];return L(e,(function(t){l(Z,t)||l(D,t)||n.push(t)})),n},lt=function(t){var e=t===H,n=X(e?Y:g(t)),i=[];return L(n,(function(t){!l(Z,t)||e&&!l(H,t)||i.push(Z[t])})),i};(c||(O((q=function(){if(this instanceof q)throw TypeError("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,e=M(t),n=function(t){this===H&&n.call(Y,t),l(this,U)&&l(this[U],e)&&(this[U][e]=!1),it(this,e,v(1,t))};return a&&nt&&it(H,e,{configurable:!0,set:n}),rt(e,t)}).prototype,"toString",(function(){return W(this).tag})),O(q,"withoutSetter",(function(t){return rt(M(t),t)})),E.f=ct,S.f=st,A.f=ut,w.f=x.f=ht,P.f=lt,R.f=function(t){return rt(j(t),t)},a&&(G(q.prototype,"description",{configurable:!0,get:function(){return W(this).description}}),s||O(H,"propertyIsEnumerable",ct,{unsafe:!0}))),i({global:!0,wrap:!0,forced:!c,sham:!c},{Symbol:q}),L(b(tt),(function(t){k(t)})),i({target:"Symbol",stat:!0,forced:!c},{for:function(t){var e=String(t);if(l(J,e))return J[e];var n=q(e);return J[e]=n,$[n]=e,n},keyFor:function(t){if(!ot(t))throw TypeError(t+" is not a symbol");if(l($,t))return $[t]},useSetter:function(){nt=!0},useSimple:function(){nt=!1}}),i({target:"Object",stat:!0,forced:!c,sham:!a},{create:function(t,e){return void 0===e?m(t):at(m(t),e)},defineProperty:st,defineProperties:at,getOwnPropertyDescriptor:ut}),i({target:"Object",stat:!0,forced:!c},{getOwnPropertyNames:ht,getOwnPropertySymbols:lt}),i({target:"Object",stat:!0,forced:h((function(){P.f(1)}))},{getOwnPropertySymbols:function(t){return P.f(y(t))}}),K)&&i({target:"JSON",stat:!0,forced:!c||h((function(){var t=q();return"[null]"!=K([t])||"{}"!=K({a:t})||"{}"!=K(Object(t))}))},{stringify:function(t,e,n){for(var i,r=[t],o=1;arguments.length>o;)r.push(arguments[o++]);if(i=e,(f(e)||void 0!==t)&&!ot(t))return p(e)||(e=function(t,e){if("function"==typeof i&&(e=i.call(this,t,e)),!ot(e))return e}),r[1]=e,K.apply(null,r)}});q.prototype[z]||C(q.prototype,z,q.prototype.valueOf),F(q,"Symbol"),D[U]=!0},function(t,e,n){var i=n(29),r=n(10),o=n(76),s=n(6).f;t.exports=function(t){var e=i.Symbol||(i.Symbol={});r(e,t)||s(e,t,{value:o.f(t)})}},function(t,e,n){var i=n(0),r=n(144);i({target:"Object",stat:!0,forced:Object.assign!==r},{assign:r})},function(t,e,n){"use strict";var i=n(2),r=n(1),o=n(31),s=n(52),a=n(39),c=n(3),u=n(27),h=Object.assign,l=Object.defineProperty;t.exports=!h||r((function(){if(i&&1!==h({b:1},h(l({},"a",{enumerable:!0,get:function(){l(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},n=Symbol();return t[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=h({},t)[n]||"abcdefghijklmnopqrst"!=o(h({},e)).join("")}))?function(t,e){for(var n=c(t),r=arguments.length,h=1,l=s.f,p=a.f;r>h;)for(var f,d=u(arguments[h++]),y=l?o(d).concat(l(d)):o(d),g=y.length,_=0;g>_;)f=y[_++],i&&!p.call(d,f)||(n[f]=d[f]);return n}:h},function(t,e,n){n(0)({target:"Object",stat:!0,sham:!n(2)},{create:n(41)})},function(t,e,n){var i=n(0),r=n(2);i({target:"Object",stat:!0,forced:!r,sham:!r},{defineProperty:n(6).f})},function(t,e,n){var i=n(0),r=n(2);i({target:"Object",stat:!0,forced:!r,sham:!r},{defineProperties:n(66)})},function(t,e,n){var i=n(0),r=n(77).entries;i({target:"Object",stat:!0},{entries:function(t){return r(t)}})},function(t,e,n){var i=n(0),r=n(43),o=n(1),s=n(4),a=n(55).onFreeze,c=Object.freeze;i({target:"Object",stat:!0,forced:o((function(){c(1)})),sham:!r},{freeze:function(t){return c&&s(t)?c(a(t)):t}})},function(t,e,n){var i=n(0),r=n(151),o=n(19);i({target:"Object",stat:!0},{fromEntries:function(t){var e={};return r(t,(function(t,n){o(e,t,n)}),void 0,!0),e}})},function(t,e,n){var i=n(13),r=n(69),o=n(8),s=n(42),a=n(70),c=n(68),u=function(t,e){this.stopped=t,this.result=e};(t.exports=function(t,e,n,h,l){var p,f,d,y,g,_,v,m=s(e,n,h?2:1);if(l)p=t;else{if("function"!=typeof(f=a(t)))throw TypeError("Target is not iterable");if(r(f)){for(d=0,y=o(t.length);y>d;d++)if((g=h?m(i(v=t[d])[0],v[1]):m(t[d]))&&g instanceof u)return g;return new u(!1)}p=f.call(t)}for(_=p.next;!(v=_.call(p)).done;)if("object"==typeof(g=c(p,m,v.value,h))&&g&&g instanceof u)return g;return new u(!1)}).stop=function(t){return new u(!0,t)}},function(t,e,n){var i=n(0),r=n(1),o=n(11),s=n(17).f,a=n(2),c=r((function(){s(1)}));i({target:"Object",stat:!0,forced:!a||c,sham:!a},{getOwnPropertyDescriptor:function(t,e){return s(o(t),e)}})},function(t,e,n){var i=n(0),r=n(2),o=n(61),s=n(11),a=n(17),c=n(19);i({target:"Object",stat:!0,sham:!r},{getOwnPropertyDescriptors:function(t){for(var e,n,i=s(t),r=a.f,u=o(i),h={},l=0;u.length>l;)void 0!==(n=r(i,e=u[l++]))&&c(h,e,n);return h}})},function(t,e,n){var i=n(0),r=n(1),o=n(75).f;i({target:"Object",stat:!0,forced:r((function(){return!Object.getOwnPropertyNames(1)}))},{getOwnPropertyNames:o})},function(t,e,n){var i=n(0),r=n(1),o=n(3),s=n(23),a=n(64);i({target:"Object",stat:!0,forced:r((function(){s(1)})),sham:!a},{getPrototypeOf:function(t){return s(o(t))}})},function(t,e,n){n(0)({target:"Object",stat:!0},{is:n(157)})},function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}},function(t,e,n){var i=n(0),r=n(1),o=n(4),s=Object.isExtensible;i({target:"Object",stat:!0,forced:r((function(){s(1)}))},{isExtensible:function(t){return!!o(t)&&(!s||s(t))}})},function(t,e,n){var i=n(0),r=n(1),o=n(4),s=Object.isFrozen;i({target:"Object",stat:!0,forced:r((function(){s(1)}))},{isFrozen:function(t){return!o(t)||!!s&&s(t)}})},function(t,e,n){var i=n(0),r=n(1),o=n(4),s=Object.isSealed;i({target:"Object",stat:!0,forced:r((function(){s(1)}))},{isSealed:function(t){return!o(t)||!!s&&s(t)}})},function(t,e,n){var i=n(0),r=n(3),o=n(31);i({target:"Object",stat:!0,forced:n(1)((function(){o(1)}))},{keys:function(t){return o(r(t))}})},function(t,e,n){var i=n(0),r=n(4),o=n(55).onFreeze,s=n(43),a=n(1),c=Object.preventExtensions;i({target:"Object",stat:!0,forced:a((function(){c(1)})),sham:!s},{preventExtensions:function(t){return c&&r(t)?c(o(t)):t}})},function(t,e,n){var i=n(0),r=n(4),o=n(55).onFreeze,s=n(43),a=n(1),c=Object.seal;i({target:"Object",stat:!0,forced:a((function(){c(1)})),sham:!s},{seal:function(t){return c&&r(t)?c(o(t)):t}})},function(t,e,n){n(0)({target:"Object",stat:!0},{setPrototypeOf:n(67)})},function(t,e,n){var i=n(0),r=n(77).values;i({target:"Object",stat:!0},{values:function(t){return r(t)}})},function(t,e,n){var i=n(54),r=n(40),o=n(167);i||r(Object.prototype,"toString",o,{unsafe:!0})},function(t,e,n){"use strict";var i=n(54),r=n(71);t.exports=i?{}.toString:function(){return"[object "+r(this)+"]"}},function(t,e,n){"use strict";var i=n(0),r=n(2),o=n(44),s=n(3),a=n(18),c=n(6);r&&i({target:"Object",proto:!0,forced:o},{__defineGetter__:function(t,e){c.f(s(this),t,{get:a(e),enumerable:!0,configurable:!0})}})},function(t,e,n){"use strict";var i=n(0),r=n(2),o=n(44),s=n(3),a=n(18),c=n(6);r&&i({target:"Object",proto:!0,forced:o},{__defineSetter__:function(t,e){c.f(s(this),t,{set:a(e),enumerable:!0,configurable:!0})}})},function(t,e,n){"use strict";var i=n(0),r=n(2),o=n(44),s=n(3),a=n(22),c=n(23),u=n(17).f;r&&i({target:"Object",proto:!0,forced:o},{__lookupGetter__:function(t){var e,n=s(this),i=a(t,!0);do{if(e=u(n,i))return e.get}while(n=c(n))}})},function(t,e,n){"use strict";var i=n(0),r=n(2),o=n(44),s=n(3),a=n(22),c=n(23),u=n(17).f;r&&i({target:"Object",proto:!0,forced:o},{__lookupSetter__:function(t){var e,n=s(this),i=a(t,!0);do{if(e=u(n,i))return e.set}while(n=c(n))}})},function(t,e,n){n(32)(Math,"Math",!0)},function(t,e,n){var i=n(7);n(32)(i.JSON,"JSON",!0)},function(t,e,n){n(175),n(177),n(178);var i=n(29);t.exports=i.Function},function(t,e,n){n(0)({target:"Function",proto:!0},{bind:n(176)})},function(t,e,n){"use strict";var i=n(18),r=n(4),o=[].slice,s={},a=function(t,e,n){if(!(e in s)){for(var i=[],r=0;r<e;r++)i[r]="a["+r+"]";s[e]=Function("C,a","return new C("+i.join(",")+")")}return s[e](t,n)};t.exports=Function.bind||function(t){var e=i(this),n=o.call(arguments,1),s=function(){var i=n.concat(o.call(arguments));return this instanceof s?a(e,i.length,i):e.apply(t,i)};return r(e.prototype)&&(s.prototype=e.prototype),s}},function(t,e,n){var i=n(2),r=n(6).f,o=Function.prototype,s=o.toString,a=/^\s*function ([^ (]*)/;!i||"name"in o||r(o,"name",{configurable:!0,get:function(){try{return s.call(this).match(a)[1]}catch(t){return""}}})},function(t,e,n){"use strict";var i=n(4),r=n(6),o=n(23),s=n(5)("hasInstance"),a=Function.prototype;s in a||r.f(a,s,{value:function(t){if("function"!=typeof this||!i(t))return!1;if(!i(this.prototype))return t instanceof this;for(;t=o(t);)if(this.prototype===t)return!0;return!1}})},function(t,e,n){"use strict";n.r(e),n.d(e,"EX_VERSION",(function(){return ho})),n.d(e,"Flags",(function(){return p})),n.d(e,"ScrollPreventionMode",(function(){return lr})),n.d(e,"Engine",(function(){return vr})),n.d(e,"DisplayMode",(function(){return Vt})),n.d(e,"Resolution",(function(){return $t})),n.d(e,"Screen",(function(){return te})),n.d(e,"Actor",(function(){return En})),n.d(e,"CollisionType",(function(){return ut})),n.d(e,"Vector",(function(){return V})),n.d(e,"Ray",(function(){return G})),n.d(e,"Line",(function(){return X})),n.d(e,"Projection",(function(){return Q})),n.d(e,"GlobalCoordinates",(function(){return Z})),n.d(e,"vec",(function(){return Y})),n.d(e,"StrategyContainer",(function(){return Vn})),n.d(e,"Axis",(function(){return On})),n.d(e,"LockCameraToActorStrategy",(function(){return Yn})),n.d(e,"LockCameraToActorAxisStrategy",(function(){return Jn})),n.d(e,"ElasticToActorStrategy",(function(){return $n})),n.d(e,"RadiusAroundActorStrategy",(function(){return ti})),n.d(e,"LimitCameraBoundsStrategy",(function(){return ei})),n.d(e,"Camera",(function(){return ni})),n.d(e,"Class",(function(){return ne})),n.d(e,"Configurable",(function(){return ye})),n.d(e,"Debug",(function(){return Mi})),n.d(e,"FrameStats",(function(){return ji})),n.d(e,"PhysicsStats",(function(){return Ri})),n.d(e,"EventDispatcher",(function(){return ee})),n.d(e,"MediaEvent",(function(){return wr})),n.d(e,"NativeSoundEvent",(function(){return xr})),n.d(e,"NativeSoundProcessedEvent",(function(){return Pr})),n.d(e,"EventTypes",(function(){return st})),n.d(e,"GameEvent",(function(){return ht})),n.d(e,"KillEvent",(function(){return lt})),n.d(e,"PreKillEvent",(function(){return pt})),n.d(e,"PostKillEvent",(function(){return ft})),n.d(e,"GameStartEvent",(function(){return dt})),n.d(e,"GameStopEvent",(function(){return yt})),n.d(e,"PreDrawEvent",(function(){return gt})),n.d(e,"PostDrawEvent",(function(){return _t})),n.d(e,"PreDebugDrawEvent",(function(){return vt})),n.d(e,"PostDebugDrawEvent",(function(){return mt})),n.d(e,"PreUpdateEvent",(function(){return bt})),n.d(e,"PostUpdateEvent",(function(){return wt})),n.d(e,"PreFrameEvent",(function(){return xt})),n.d(e,"PostFrameEvent",(function(){return Pt})),n.d(e,"GamepadConnectEvent",(function(){return At})),n.d(e,"GamepadDisconnectEvent",(function(){return St})),n.d(e,"GamepadButtonEvent",(function(){return Et})),n.d(e,"GamepadAxisEvent",(function(){return Ct})),n.d(e,"SubscribeEvent",(function(){return Ot})),n.d(e,"UnsubscribeEvent",(function(){return Tt})),n.d(e,"VisibleEvent",(function(){return Bt})),n.d(e,"HiddenEvent",(function(){return Dt})),n.d(e,"PreCollisionEvent",(function(){return Mt})),n.d(e,"PostCollisionEvent",(function(){return jt})),n.d(e,"CollisionStartEvent",(function(){return Rt})),n.d(e,"CollisionEndEvent",(function(){return kt})),n.d(e,"InitializeEvent",(function(){return Ft})),n.d(e,"ActivateEvent",(function(){return It})),n.d(e,"DeactivateEvent",(function(){return Lt})),n.d(e,"ExitViewPortEvent",(function(){return Ut})),n.d(e,"EnterViewPortEvent",(function(){return zt})),n.d(e,"EnterTriggerEvent",(function(){return Nt})),n.d(e,"ExitTriggerEvent",(function(){return Wt})),n.d(e,"Label",(function(){return oi})),n.d(e,"FontStyle",(function(){return Zn})),n.d(e,"FontUnit",(function(){return Gn})),n.d(e,"TextAlign",(function(){return Xn})),n.d(e,"BaseAlign",(function(){return Qn})),n.d(e,"Loader",(function(){return Mn})),n.d(e,"Particle",(function(){return Sr})),n.d(e,"ParticleEmitter",(function(){return Er})),n.d(e,"EmitterType",(function(){return _r})),n.d(e,"CollisionResolutionStrategy",(function(){return J})),n.d(e,"BroadphaseStrategy",(function(){return $})),n.d(e,"Integrator",(function(){return tt})),n.d(e,"Physics",(function(){return at})),n.d(e,"PromiseState",(function(){return l})),n.d(e,"Promise",(function(){return d})),n.d(e,"Scene",(function(){return Oi})),n.d(e,"TileMap",(function(){return Wn})),n.d(e,"Cell",(function(){return qn})),n.d(e,"TileSprite",(function(){return Hn})),n.d(e,"Timer",(function(){return In})),n.d(e,"Trigger",(function(){return ci})),n.d(e,"ScreenElement",(function(){return Fn})),n.d(e,"ActionContext",(function(){return Ke})),n.d(e,"RotationType",(function(){return ge})),n.d(e,"Actions",(function(){return o})),n.d(e,"Internal",(function(){return Cr})),n.d(e,"Body",(function(){return Ge})),n.d(e,"isCollider",(function(){return sn})),n.d(e,"Collider",(function(){return an})),n.d(e,"BoundingBox",(function(){return Yt})),n.d(e,"Circle",(function(){return Xt})),n.d(e,"CollisionContact",(function(){return Ht})),n.d(e,"CollisionJumpTable",(function(){return qt})),n.d(e,"ClosestLine",(function(){return Kt})),n.d(e,"ClosestLineJumpTable",(function(){return Gt})),n.d(e,"CollisionGroup",(function(){return rn})),n.d(e,"CollisionGroupManager",(function(){return Or})),n.d(e,"TreeNode",(function(){return Ln})),n.d(e,"DynamicTree",(function(){return Un})),n.d(e,"DynamicTreeCollisionBroadphase",(function(){return zn})),n.d(e,"Edge",(function(){return Qt})),n.d(e,"Pair",(function(){return on})),n.d(e,"ConvexPolygon",(function(){return Zt})),n.d(e,"Side",(function(){return f})),n.d(e,"Shape",(function(){return Ve})),n.d(e,"Animation",(function(){return Ae})),n.d(e,"Color",(function(){return nt})),n.d(e,"Polygon",(function(){return Br})),n.d(e,"Sprite",(function(){return me})),n.d(e,"SpriteSheet",(function(){return Mr})),n.d(e,"SpriteFont",(function(){return jr})),n.d(e,"CanvasDrawComponent",(function(){return bn})),n.d(e,"CanvasDrawingSystem",(function(){return _i})),n.d(e,"Effects",(function(){return r})),n.d(e,"ExResponse",(function(){return Rr})),n.d(e,"has_initialize",(function(){return kr})),n.d(e,"hasOnInitialize",(function(){return Fr})),n.d(e,"has_preupdate",(function(){return Ir})),n.d(e,"hasOnPreUpdate",(function(){return Lr})),n.d(e,"has_postupdate",(function(){return Ur})),n.d(e,"hasOnPostUpdate",(function(){return zr})),n.d(e,"hasPreDraw",(function(){return Nr})),n.d(e,"hasPostDraw",(function(){return Wr})),n.d(e,"PerlinGenerator",(function(){return Kr})),n.d(e,"PerlinDrawer2D",(function(){return Vr})),n.d(e,"Random",(function(){return y})),n.d(e,"ColorBlindness",(function(){return yi})),n.d(e,"ColorBlindCorrector",(function(){return Bi})),n.d(e,"Resource",(function(){return re})),n.d(e,"Sound",(function(){return $r})),n.d(e,"AudioContextFactory",(function(){return Cn})),n.d(e,"AudioInstanceFactory",(function(){return Xr})),n.d(e,"AudioInstance",(function(){return Qr})),n.d(e,"WebAudioInstance",(function(){return Zr})),n.d(e,"Texture",(function(){return we})),n.d(e,"Gif",(function(){return eo})),n.d(e,"Stream",(function(){return ro})),n.d(e,"ParseGif",(function(){return oo})),n.d(e,"Component",(function(){return un})),n.d(e,"TagComponent",(function(){return hn})),n.d(e,"AddedComponent",(function(){return fn})),n.d(e,"isAddedComponent",(function(){return dn})),n.d(e,"RemovedComponent",(function(){return yn})),n.d(e,"isRemovedComponent",(function(){return gn})),n.d(e,"Entity",(function(){return vn})),n.d(e,"EntityManager",(function(){return vi})),n.d(e,"Query",(function(){return xi})),n.d(e,"QueryManager",(function(){return Pi})),n.d(e,"SystemType",(function(){return ri})),n.d(e,"System",(function(){return hi})),n.d(e,"AddedEntity",(function(){return li})),n.d(e,"isAddedSystemEntity",(function(){return pi})),n.d(e,"RemovedEntity",(function(){return fi})),n.d(e,"isRemoveSystemEntity",(function(){return di})),n.d(e,"SystemManager",(function(){return Ai})),n.d(e,"World",(function(){return Si})),n.d(e,"Events",(function(){return i})),n.d(e,"Input",(function(){return a})),n.d(e,"Traits",(function(){return c})),n.d(e,"Util",(function(){return u})),n.d(e,"BrowserComponent",(function(){return pr})),n.d(e,"BrowserEvents",(function(){return fr})),n.d(e,"maxMessages",(function(){return z})),n.d(e,"resetObsoleteCounter",(function(){return W})),n.d(e,"obsolete",(function(){return q})),n.d(e,"Detector",(function(){return Rn})),n.d(e,"CullingBox",(function(){return Qe})),n.d(e,"EasingFunctions",(function(){return qe})),n.d(e,"LogLevel",(function(){return M})),n.d(e,"Logger",(function(){return k})),n.d(e,"ConsoleAppender",(function(){return F})),n.d(e,"ScreenAppender",(function(){return I})),n.d(e,"SortedList",(function(){return ao})),n.d(e,"BinaryTreeNode",(function(){return co})),n.d(e,"MockedElement",(function(){return uo}));var i={};n.r(i),n.d(i,"EventTypes",(function(){return st})),n.d(i,"GameEvent",(function(){return ht})),n.d(i,"KillEvent",(function(){return lt})),n.d(i,"PreKillEvent",(function(){return pt})),n.d(i,"PostKillEvent",(function(){return ft})),n.d(i,"GameStartEvent",(function(){return dt})),n.d(i,"GameStopEvent",(function(){return yt})),n.d(i,"PreDrawEvent",(function(){return gt})),n.d(i,"PostDrawEvent",(function(){return _t})),n.d(i,"PreDebugDrawEvent",(function(){return vt})),n.d(i,"PostDebugDrawEvent",(function(){return mt})),n.d(i,"PreUpdateEvent",(function(){return bt})),n.d(i,"PostUpdateEvent",(function(){return wt})),n.d(i,"PreFrameEvent",(function(){return xt})),n.d(i,"PostFrameEvent",(function(){return Pt})),n.d(i,"GamepadConnectEvent",(function(){return At})),n.d(i,"GamepadDisconnectEvent",(function(){return St})),n.d(i,"GamepadButtonEvent",(function(){return Et})),n.d(i,"GamepadAxisEvent",(function(){return Ct})),n.d(i,"SubscribeEvent",(function(){return Ot})),n.d(i,"UnsubscribeEvent",(function(){return Tt})),n.d(i,"VisibleEvent",(function(){return Bt})),n.d(i,"HiddenEvent",(function(){return Dt})),n.d(i,"PreCollisionEvent",(function(){return Mt})),n.d(i,"PostCollisionEvent",(function(){return jt})),n.d(i,"CollisionStartEvent",(function(){return Rt})),n.d(i,"CollisionEndEvent",(function(){return kt})),n.d(i,"InitializeEvent",(function(){return Ft})),n.d(i,"ActivateEvent",(function(){return It})),n.d(i,"DeactivateEvent",(function(){return Lt})),n.d(i,"ExitViewPortEvent",(function(){return Ut})),n.d(i,"EnterViewPortEvent",(function(){return zt})),n.d(i,"EnterTriggerEvent",(function(){return Nt})),n.d(i,"ExitTriggerEvent",(function(){return Wt}));var r={};n.r(r),n.d(r,"Grayscale",(function(){return oe})),n.d(r,"Invert",(function(){return se})),n.d(r,"Opacity",(function(){return ae})),n.d(r,"Colorize",(function(){return ce})),n.d(r,"Lighten",(function(){return ue})),n.d(r,"Darken",(function(){return he})),n.d(r,"Saturate",(function(){return le})),n.d(r,"Desaturate",(function(){return pe})),n.d(r,"Fill",(function(){return fe}));var o={};n.r(o),n.d(o,"EaseTo",(function(){return Ee})),n.d(o,"MoveTo",(function(){return Ce})),n.d(o,"MoveBy",(function(){return Oe})),n.d(o,"Follow",(function(){return Te})),n.d(o,"Meet",(function(){return Be})),n.d(o,"RotateTo",(function(){return De})),n.d(o,"RotateBy",(function(){return Me})),n.d(o,"ScaleTo",(function(){return je})),n.d(o,"ScaleBy",(function(){return Re})),n.d(o,"Delay",(function(){return ke})),n.d(o,"Blink",(function(){return Fe})),n.d(o,"Fade",(function(){return Ie})),n.d(o,"Die",(function(){return Le})),n.d(o,"CallMethod",(function(){return Ue})),n.d(o,"Repeat",(function(){return ze})),n.d(o,"RepeatForever",(function(){return Ne})),n.d(o,"ActionQueue",(function(){return We}));var s={};n.r(s),n.d(s,"line",(function(){return Je})),n.d(s,"point",(function(){return $e})),n.d(s,"vector",(function(){return tn})),n.d(s,"roundRect",(function(){return en})),n.d(s,"circle",(function(){return nn}));var a={};n.r(a),n.d(a,"Gamepads",(function(){return ur})),n.d(a,"Gamepad",(function(){return hr})),n.d(a,"Buttons",(function(){return rr})),n.d(a,"Axes",(function(){return or})),n.d(a,"PointerType",(function(){return Fi})),n.d(a,"PointerScope",(function(){return Ii})),n.d(a,"Pointer",(function(){return Ki})),n.d(a,"Pointers",(function(){return ar})),n.d(a,"NativePointerButton",(function(){return Wi})),n.d(a,"PointerButton",(function(){return Hi})),n.d(a,"WheelDeltaMode",(function(){return qi})),n.d(a,"PointerEvent",(function(){return Gi})),n.d(a,"PointerEventFactory",(function(){return Xi})),n.d(a,"PointerDragEvent",(function(){return Qi})),n.d(a,"PointerUpEvent",(function(){return Zi})),n.d(a,"PointerDownEvent",(function(){return Yi})),n.d(a,"PointerMoveEvent",(function(){return Ji})),n.d(a,"PointerEnterEvent",(function(){return $i})),n.d(a,"PointerLeaveEvent",(function(){return tr})),n.d(a,"PointerCancelEvent",(function(){return er})),n.d(a,"WheelEvent",(function(){return nr})),n.d(a,"createPointerEventByName",(function(){return ir})),n.d(a,"Keys",(function(){return Ti})),n.d(a,"KeyEvent",(function(){return Li})),n.d(a,"Keyboard",(function(){return Ui}));var c={};n.r(c),n.d(c,"CapturePointer",(function(){return Ye})),n.d(c,"OffscreenCulling",(function(){return Ze})),n.d(c,"TileMapCollisionDetection",(function(){return Xe}));var u={};n.r(u),n.d(u,"TwoPI",(function(){return g})),n.d(u,"extend",(function(){return _})),n.d(u,"base64Encode",(function(){return v})),n.d(u,"nullish",(function(){return m})),n.d(u,"clamp",(function(){return b})),n.d(u,"randomInRange",(function(){return w})),n.d(u,"randomIntInRange",(function(){return x})),n.d(u,"canonicalizeAngle",(function(){return P})),n.d(u,"toDegrees",(function(){return A})),n.d(u,"toRadians",(function(){return S})),n.d(u,"getPosition",(function(){return E})),n.d(u,"addItemToArray",(function(){return C})),n.d(u,"removeItemFromArray",(function(){return O})),n.d(u,"contains",(function(){return T})),n.d(u,"getOppositeSide",(function(){return B})),n.d(u,"getSideFromDirection",(function(){return D})),n.d(u,"Collection",(function(){return j})),n.d(u,"fail",(function(){return R})),n.d(u,"DrawUtil",(function(){return s}));n(93),n(140),n(174);function h(){"undefined"==typeof window&&(window={audioContext:function(){}}),"undefined"==typeof window||window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setInterval(t,1e3/60)}),"undefined"==typeof window||window.cancelAnimationFrame||(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(){}),"undefined"==typeof window||window.AudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext),"undefined"==typeof window||window.devicePixelRatio||(window.devicePixelRatio=window.devicePixelRatio||1)}var l,p=function(){function t(){}return t.freeze=function(){t._FROZEN=!0},t._reset=function(){t._FROZEN=!1,t._FLAGS={}},t.enable=function(e){if(this._FROZEN)throw Error("Feature flags can only be enabled before Engine constructor time");t._FLAGS[e]=!0},t.disable=function(e){if(this._FROZEN)throw Error("Feature flags can only be disabled before Engine constructor time");t._FLAGS[e]=!1},t.isEnabled=function(e){return!!t._FLAGS[e]},t.show=function(){return Object.keys(t._FLAGS)},t._FROZEN=!1,t._FLAGS={},t}();!function(t){t[t.Resolved=0]="Resolved",t[t.Rejected=1]="Rejected",t[t.Pending=2]="Pending"}(l||(l={}));var f,d=function(){function t(){this._state=l.Pending,this._successCallbacks=[],this._rejectCallback=function(){}}return t.resolve=function(e){return(new t).resolve(e)},t.reject=function(e){return(new t).reject(e)},t.join=function(){var e=[];if(arguments.length>0&&!Array.isArray(arguments[0]))for(var n=0;n<arguments.length;n++)e[n-0]=arguments[n];else 1===arguments.length&&Array.isArray(arguments[0])&&(e=arguments[0]);var i=new t;if(!e||!e.length)return i.resolve();var r=e.length,o=0,s=0,a=[];return e.forEach((function(t){t.then((function(){(o+=1)===r?i.resolve():o+s+a.length===r&&i.reject(a)}),(function(){o+(s+=1)+a.length===r&&i.reject(a)})).error((function(t){a.push(t),a.length+o+s===r&&i.reject(a)}))})),i},t.prototype.then=function(t,e){if(t&&(this._successCallbacks.push(t),this.state()===l.Resolved))try{t.call(this,this._value)}catch(t){this._handleError(t)}if(e&&(this._rejectCallback=e,this.state()===l.Rejected))try{e.call(this,this._value)}catch(t){this._handleError(t)}return this},t.prototype.error=function(t){return t&&(this._errorCallback=t),this},t.prototype.resolve=function(t){var e=this;if(this._state!==l.Pending)throw new Error("Cannot resolve a promise that is not in a pending state!");this._value=t;try{this._state=l.Resolved,this._successCallbacks.forEach((function(t){t.call(e,e._value)}))}catch(t){this._handleError(t)}return this},t.prototype.reject=function(t){if(this._state!==l.Pending)throw new Error("Cannot reject a promise that is not in a pending state!");this._value=t;try{this._state=l.Rejected,this._rejectCallback.call(this,this._value)}catch(t){this._handleError(t)}return this},t.prototype.state=function(){return this._state},t.prototype._handleError=function(t){if(!this._errorCallback)throw t;this._errorCallback.call(this,t)},t}(),y=function(){function t(t){this.seed=t,this._lowerMask=2147483647,this._upperMask=2147483648,this._w=32,this._n=624,this._m=397,this._a=2567483615,this._u=11,this._s=7,this._b=2636928640,this._t=15,this._c=4022730752,this._l=18,this._f=1812433253,this._mt=new Array(this._n),this._mt[0]=(t||Date.now())>>>0;for(var e=1;e<this._n;e++){var n=this._mt[e-1]^this._mt[e-1]>>>this._w-2;this._mt[e]=(this._f*((4294901760&n)>>>16)<<16)+this._f*(65535&n)+e>>>0}this._index=this._n}return t.prototype._twist=function(){for(var t=[0,this._a],e=0,n=0;n<this._n-this._m;n++)e=this._mt[n]&this._upperMask|this._mt[n+1]&this._lowerMask,this._mt[n]=this._mt[n+this._m]^e>>>1^4294967295&t[1&e];for(;n<this._n-1;n++)e=this._mt[n]&this._upperMask|this._mt[n+1]&this._lowerMask,this._mt[n]=this._mt[n+(this._m-this._n)]^e>>>1^4294967295&t[1&e];e=this._mt[this._n-1]&this._upperMask|this._mt[0]&this._lowerMask,this._mt[this._n-1]=this._mt[this._m-1]^e>>>1^4294967295&t[1&e],this._index=0},t.prototype.nextInt=function(){this._index>=this._n&&this._twist();var t=this._mt[this._index++];return t^=t>>>this._u,t^=t<<this._s&this._b,t^=t<<this._t&this._c,(t^=t>>>this._l)>>>0},t.prototype.next=function(){return this.nextInt()*(1/4294967296)},t.prototype.floating=function(t,e){return(e-t)*this.next()+t},t.prototype.integer=function(t,e){return Math.floor((e-t+1)*this.next()+t)},t.prototype.bool=function(t){return void 0===t&&(t=.5),this.next()<=t},t.prototype.pickOne=function(t){return t[this.integer(0,t.length-1)]},t.prototype.pickSet=function(t,e,n){return void 0===n&&(n=!1),n?this._pickSetWithDuplicates(t,e):this._pickSetWithoutDuplicates(t,e)},t.prototype._pickSetWithoutDuplicates=function(t,e){if(e>t.length||e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 < n <= length");if(e===t.length)return t;for(var n=new Array(e),i=0,r=t.slice(0);i<e;){var o=this.integer(0,r.length-1);n[i++]=r[o],r.splice(o,1)}return n},t.prototype._pickSetWithDuplicates=function(t,e){if(e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT");for(var n=new Array(e),i=0;i<e;i++)n[i]=this.pickOne(t);return n},t.prototype.shuffle=function(t){for(var e=t.slice(0),n=null,i=0;i<e.length-2;i++){var r=this.integer(i,e.length-1);n=e[i],e[i]=e[r],e[r]=n}return e},t.prototype.range=function(t,e,n){for(var i=new Array(t),r=0;r<t;r++)i[r]=this.integer(e,n);return i},t.prototype.d4=function(){return this.integer(1,4)},t.prototype.d6=function(){return this.integer(1,6)},t.prototype.d8=function(){return this.integer(1,8)},t.prototype.d10=function(){return this.integer(1,10)},t.prototype.d12=function(){return this.integer(1,12)},t.prototype.d20=function(){return this.integer(1,20)},t}();!function(t){t.None="None",t.Top="Top",t.Bottom="Bottom",t.Left="Left",t.Right="Right"}(f||(f={}));var g=2*Math.PI;function _(){var t={},e=!1,n=0,i=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(e=arguments[0],n++);var r="function"==typeof Object.assign,o=null;for(o=r?Object.assign:function(n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e&&"[object Object]"===Object.prototype.toString.call(n[i])?t[i]=_(!0,t[i],n[i]):t[i]=n[i])};n<i;n++){var s=arguments[n];r?o(t,s):o(s)}return t}function v(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="",i=0;i<t.length;){var r=255&t.charCodeAt(i++),o=255&t.charCodeAt(i++),s=255&t.charCodeAt(i++),a=r>>2,c=(3&r)<<4|o>>4,u=void 0,h=void 0;isNaN(o)?u=h=64:(u=(15&o)<<2|s>>6,h=isNaN(s)?64:63&s),n+=e.charAt(a)+e.charAt(c)+e.charAt(u)+e.charAt(h)}return n}function m(t,e){return null!=t?t:e}function b(t,e,n){return Math.min(Math.max(e,t),n)}function w(t,e,n){return void 0===n&&(n=new y),n?n.floating(t,e):t+Math.random()*(e-t)}function x(t,e,n){return void 0===n&&(n=new y),n?n.integer(t,e):Math.round(w(t,e))}function P(t){var e=t;if(t>g)for(;e>g;)e-=g;if(t<0)for(;e<0;)e+=g;return e}function A(t){return 180/Math.PI*t}function S(t){return t/180*Math.PI}function E(t){var e=0,n=0,i=function(t){e+=t.offsetLeft,t.offsetParent&&i(t.offsetParent)},r=function(t){n+=t.offsetTop,t.offsetParent&&r(t.offsetParent)};return i(t),r(t),new V(e,n)}function C(t,e){return-1===e.indexOf(t)&&(e.push(t),!0)}function O(t,e){var n;return(n=e.indexOf(t))>-1&&(e.splice(n,1),!0)}function T(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return!0;return!1}function B(t){return t===f.Top?f.Bottom:t===f.Bottom?f.Top:t===f.Left?f.Right:t===f.Right?f.Left:f.None}function D(t){for(var e=[V.Left,V.Right,V.Up,V.Down],n=[f.Left,f.Right,f.Top,f.Bottom],i=-Number.MAX_VALUE,r=-1,o=0;o<e.length;o++)e[o].dot(t)>i&&(i=e[o].dot(t),r=o);return n[r]}var M,j=function(){function t(e){void 0===e&&(e=t.DefaultSize),this._internalArray=null,this._endPointer=0,this._internalArray=new Array(e)}return t.prototype._resize=function(){for(var t=2*this._internalArray.length,e=new Array(t),n=this.count(),i=0;i<n;i++)e[i]=this._internalArray[i];delete this._internalArray,this._internalArray=e},t.prototype.push=function(t){return this._endPointer===this._internalArray.length&&this._resize(),this._internalArray[this._endPointer++]=t},t.prototype.pop=function(){return this._endPointer=this._endPointer-1<0?0:this._endPointer-1,this._internalArray[this._endPointer]},t.prototype.count=function(){return this._endPointer},t.prototype.clear=function(){this._endPointer=0},t.prototype.internalSize=function(){return this._internalArray.length},t.prototype.elementAt=function(t){if(t>=this.count())throw new Error("Invalid index "+t);return this._internalArray[t]},t.prototype.insert=function(t,e){return t>=this.count()&&this._resize(),this._internalArray[t]=e},t.prototype.remove=function(t){var e=this.count();if(0===e)throw new Error("Invalid parameter "+t);for(var n=this._internalArray[t],i=t;i<e;i++)this._internalArray[i]=this._internalArray[i+1];return this._endPointer--,n},t.prototype.removeElement=function(t){var e=this._internalArray.indexOf(t);this.remove(e)},t.prototype.toArray=function(){return this._internalArray.slice(0,this._endPointer)},t.prototype.forEach=function(t){for(var e=0,n=this.count();e<n;e++)t.call(this,this._internalArray[e],e)},t.prototype.map=function(t){for(var e=this.count(),n=0;n<e;n++)this._internalArray[n]=t.call(this,this._internalArray[n],n)},t.DefaultSize=200,t}();function R(t){throw new Error(t)}!function(t){t[t.Debug=0]="Debug",t[t.Info=1]="Info",t[t.Warn=2]="Warn",t[t.Error=3]="Error",t[t.Fatal=4]="Fatal"}(M||(M={}));var k=function(){function t(){if(this._appenders=[],this.defaultLevel=M.Info,t._INSTANCE)throw new Error("Logger is a singleton");return t._INSTANCE=this,t._INSTANCE.addAppender(new F),t._INSTANCE}return t.getInstance=function(){return null==t._INSTANCE&&(t._INSTANCE=new t),t._INSTANCE},t.prototype.addAppender=function(t){this._appenders.push(t)},t.prototype.clearAppenders=function(){this._appenders.length=0},t.prototype._log=function(t,e){null==t&&(t=this.defaultLevel);for(var n=this._appenders.length,i=0;i<n;i++)t>=this.defaultLevel&&this._appenders[i].log(t,e)},t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._log(M.Debug,t)},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._log(M.Info,t)},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._log(M.Warn,t)},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._log(M.Error,t)},t.prototype.fatal=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._log(M.Fatal,t)},t._INSTANCE=null,t}(),F=function(){function t(){}return t.prototype.log=function(t,e){if(console||console.log||!console.warn||!console.error){var n=[];n.unshift.apply(n,e),n.unshift("["+M[t]+"] : "),t<M.Warn?console.log.apply?console.log.apply(console,n):console.log(n.join(" ")):t<M.Error?console.warn.apply?console.warn.apply(console,n):console.warn(n.join(" ")):console.error.apply?console.error.apply(console,n):console.error(n.join(" "))}},t}(),I=function(){function t(t,e){this._messages=[],this._canvas=document.createElement("canvas"),this._canvas.width=t||window.innerWidth,this._canvas.height=e||window.innerHeight,this._canvas.style.position="absolute",this._ctx=this._canvas.getContext("2d"),document.body.appendChild(this._canvas)}return t.prototype.log=function(t,e){var n=e.join(",");this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._messages.unshift("["+M[t]+"] : "+n);for(var i=10,r=1,o=0;o<this._messages.length;o++)this._ctx.fillStyle="rgba(255,255,255,"+r.toFixed(2)+")",this._ctx.fillText(this._messages[o],200,i),i+=10,r=r>0?r-.05:0},t}(),L=function(){return(L=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},U=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)i[r]=o[s];return i},z=5,N={},W=function(){for(var t in N)N[t]=0},H=function(t,e){N[t]<z&&(k.getInstance().warn(t),console.trace&&e.showStackTrace&&console.trace()),N[t]++};function q(t){return t=_({},{message:"This feature will be removed in future versions of Excalibur.",alternateMethod:null,showStackTrack:!1},t),function(e,n,i){if(i&&"function"!=typeof i.value&&"function"!=typeof i.get&&"function"!=typeof i.set)throw new SyntaxError("Only classes/functions/getters/setters can be marked as obsolete");var r=(e.name||"")+(e.name&&n?".":"")+(n||"")+" is marked obsolete: "+t.message+(t.alternateMethod?" Use "+t.alternateMethod+" instead":"");N[r]||(N[r]=0);var o=i?L({},i):e;if(!i){var s=function(){var e=Array.prototype.slice.call(arguments);return H(r,t),new(o.bind.apply(o,U([void 0],e)))};return s.prototype=o.prototype,s}return i&&i.value?(o.value=function(){return H(r,t),i.value.apply(this,arguments)},o):(i&&i.get&&(o.get=function(){return H(r,t),i.get.apply(this,arguments)}),i&&i.set&&(o.set=function(){return H(r,t),i.set.apply(this,arguments)}),o)}}var K=function(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},V=function(){function t(t,e){this.x=t,this.y=e}return Object.defineProperty(t,"Zero",{get:function(){return new t(0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(t,"One",{get:function(){return new t(1,1)},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Half",{get:function(){return new t(.5,.5)},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Up",{get:function(){return new t(0,-1)},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Down",{get:function(){return new t(0,1)},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Left",{get:function(){return new t(-1,0)},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Right",{get:function(){return new t(1,0)},enumerable:!1,configurable:!0}),t.fromAngle=function(e){return new t(Math.cos(e),Math.sin(e))},t.isValid=function(t){return null!=t&&(!isNaN(t.x)&&!isNaN(t.y)&&(t.x!==1/0&&t.y!==1/0&&t.x!==-1/0&&t.y!==-1/0))},t.distance=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},t.prototype.setTo=function(t,e){this.x=t,this.y=e},t.prototype.equals=function(t,e){return void 0===e&&(e=.001),Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e},t.prototype.distance=function(e){return e||(e=t.Zero),Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},t.prototype.magnitude=function(){return this.distance()},Object.defineProperty(t.prototype,"size",{get:function(){return this.distance()},set:function(t){var e=this.normalize().scale(t);this.x=e.x,this.y=e.y},enumerable:!1,configurable:!0}),t.prototype.normalize=function(){var e=this.distance();return e>0?new t(this.x/e,this.y/e):new t(0,1)},t.prototype.average=function(t){return this.add(t).scale(.5)},t.prototype.scale=function(e){return e instanceof t?new t(this.x*e.x,this.y*e.y):new t(this.x*e,this.y*e)},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.addEqual=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.subEqual=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.scaleEqual=function(t){return this.x*=t,this.y*=t,this},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.cross=function(e){return e instanceof t?this.x*e.y-this.y*e.x:"number"==typeof e?new t(e*this.y,-e*this.x):void 0},t.prototype.perpendicular=function(){return new t(this.y,-this.x)},t.prototype.normal=function(){return this.perpendicular().normalize()},t.prototype.negate=function(){return this.scale(-1)},t.prototype.toAngle=function(){return Math.atan2(this.y,this.x)},t.prototype.rotate=function(e,n){n||(n=new t(0,0));var i=Math.sin(e),r=Math.cos(e);return new t(r*(this.x-n.x)-i*(this.y-n.y)+n.x,i*(this.x-n.x)+r*(this.y-n.y)+n.y)},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.toString=function(){return"("+this.x+", "+this.y+")"},K([q({message:"will be removed in favour of `.size` in version 0.25.0"})],t.prototype,"magnitude",null),t}(),G=function(){function t(t,e){this.pos=t,this.dir=e.normalize()}return t.prototype.intersect=function(t){var e=t.begin.sub(this.pos);if(0===this.dir.cross(t.getSlope())&&0!==e.cross(this.dir))return-1;var n=this.dir.cross(t.getSlope());if(0===n)return-1;var i=e.cross(t.getSlope())/n;if(i>=0){var r=e.cross(this.dir)/n/t.getLength();if(r>=0&&r<=1)return i}return-1},t.prototype.getPoint=function(t){return this.pos.add(this.dir.scale(t))},t}(),X=function(){function t(t,e){this.begin=t,this.end=e}return Object.defineProperty(t.prototype,"slope",{get:function(){return(this.end.y-this.begin.y)/(this.end.x-this.begin.x)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intercept",{get:function(){return this.begin.y-this.slope*this.begin.x},enumerable:!1,configurable:!0}),t.prototype.normal=function(){return this.end.sub(this.begin).normal()},t.prototype.getSlope=function(){var t=this.begin,e=this.end,n=t.distance(e);return e.sub(t).scale(1/n)},t.prototype.getEdge=function(){var t=this.begin;return this.end.sub(t)},t.prototype.getLength=function(){var t=this.begin,e=this.end;return t.distance(e)},Object.defineProperty(t.prototype,"midpoint",{get:function(){return this.begin.add(this.end).scale(.5)},enumerable:!1,configurable:!0}),t.prototype.flip=function(){return new t(this.end,this.begin)},t.prototype.distanceToPoint=function(t){var e=t.x,n=t.y,i=this.getLength(),r=this.end.y-this.begin.y,o=this.end.x-this.begin.x;return Math.abs(r*e-o*n+this.end.x*this.begin.y-this.end.y*this.begin.x)/i},t.prototype.findVectorToPoint=function(t){var e=this.begin.sub(t),n=this.getSlope();return e.sub(n.scale(e.dot(n)))},t.prototype.findPoint=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null);var n=this.slope,i=this.intercept;if(null!==t)return new V(t,n*t+i);if(null!==e)return new V((e-i)/n,e);throw new Error("You must provide an X or a Y value")},t.prototype.hasPoint=function(){var t,e=0;if("number"==typeof arguments[0]&&"number"==typeof arguments[1])t=new V(arguments[0],arguments[1]),e=arguments[2]||0;else{if(!(arguments[0]instanceof V))throw"Could not determine the arguments for Vector.hasPoint";t=arguments[0],e=arguments[1]||0}var n=t.x-this.begin.x,i=t.y-this.begin.y,r=this.end.x-this.begin.x,o=this.end.y-this.begin.y,s=n*o-i*r;return!(Math.abs(s)>e)&&(Math.abs(r)>=Math.abs(o)?r>0?this.begin.x<=t.x&&t.x<=this.end.x:this.end.x<=t.x&&t.x<=this.begin.x:o>0?this.begin.y<=t.y&&t.y<=this.end.y:this.end.y<=t.y&&t.y<=this.begin.y)},t}(),Q=function(){function t(t,e){this.min=t,this.max=e}return t.prototype.overlaps=function(t){return this.max>t.min&&t.max>this.min},t.prototype.getOverlap=function(t){return this.overlaps(t)?this.max>t.max?t.max-this.min:this.max-t.min:0},t}(),Z=function(){function t(t,e,n){this.worldPos=t,this.pagePos=e,this.screenPos=n}return t.fromPagePosition=function(e,n,i){var r,o,s,a;3===arguments.length?(s=new V(r=e,o=n),a=i):(r=(s=e).x,o=s.y,a=n);var c=r-E(a.canvas).x,u=o-E(a.canvas).y,h=new V(c,u),l=a.screenToWorldCoordinates(h);return new t(l,s,h)},t}();function Y(t,e){return new V(t,e)}var J,$,tt,et=function(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},nt=function(){function t(t,e,n,i){this.r=t,this.g=e,this.b=n,this.a=null!=i?i:1}return t.fromRGB=function(e,n,i,r){return new t(e,n,i,r)},t.fromRGBString=function(e){var n;if(n=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)/i)){var i=parseInt(n[1],10),r=parseInt(n[2],10),o=parseInt(n[3],10),s=1;return n[4]&&(s=parseFloat(n[4])),new t(i,r,o,s)}throw new Error("Invalid rgb/a string: "+e)},t.fromHex=function(e){var n;if(n=e.match(/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i)){var i=parseInt(n[1],16),r=parseInt(n[2],16),o=parseInt(n[3],16),s=1;return n[4]&&(s=parseInt(n[4],16)/255),new t(i,r,o,s)}throw new Error("Invalid hex string: "+e)},t.fromHSL=function(t,e,n,i){return void 0===i&&(i=1),new it(t,e,n,i).toRGBA()},t.prototype.lighten=function(t){void 0===t&&(t=.1);var e=it.fromRGBA(this.r,this.g,this.b,this.a);return e.l+=(1-e.l)*t,e.toRGBA()},t.prototype.darken=function(t){void 0===t&&(t=.1);var e=it.fromRGBA(this.r,this.g,this.b,this.a);return e.l-=e.l*t,e.toRGBA()},t.prototype.saturate=function(t){void 0===t&&(t=.1);var e=it.fromRGBA(this.r,this.g,this.b,this.a);return e.s+=e.s*t,e.toRGBA()},t.prototype.desaturate=function(t){void 0===t&&(t=.1);var e=it.fromRGBA(this.r,this.g,this.b,this.a);return e.s-=e.s*t,e.toRGBA()},t.prototype.multiply=function(e){return new t(e.r/255*this.r/255*255,e.g/255*this.g/255*255,e.b/255*this.b/255*255,e.a*this.a)},t.prototype.mulitiply=function(t){return this.multiply(t)},t.prototype.screen=function(t){var e=t.invert(),n=t.invert();return e.multiply(n).invert()},t.prototype.invert=function(){return new t(255-this.r,255-this.g,255-this.b,1-this.a)},t.prototype.average=function(e){return new t((e.r+this.r)/2,(e.g+this.g)/2,(e.b+this.b)/2,(e.a+this.a)/2)},t.prototype.toString=function(t){switch(void 0===t&&(t="rgb"),t){case"rgb":return this.toRGBA();case"hsl":return this.toHSLA();case"hex":return this.toHex();default:throw new Error("Invalid Color format")}},t.prototype._componentToHex=function(t){var e=t.toString(16);return 1===e.length?"0"+e:e},t.prototype.toHex=function(){return"#"+this._componentToHex(this.r)+this._componentToHex(this.g)+this._componentToHex(this.b)},t.prototype.toRGBA=function(){var t=String(this.r.toFixed(0))+", "+String(this.g.toFixed(0))+", "+String(this.b.toFixed(0));return void 0!==this.a||null!==this.a?"rgba("+t+", "+String(this.a)+")":"rgb("+t+")"},t.prototype.toHSLA=function(){return it.fromRGBA(this.r,this.g,this.b,this.a).toString()},t.prototype.fillStyle=function(){return this.toString()},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},Object.defineProperty(t,"Black",{get:function(){return t.fromHex("#000000")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"White",{get:function(){return t.fromHex("#FFFFFF")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Gray",{get:function(){return t.fromHex("#808080")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"LightGray",{get:function(){return t.fromHex("#D3D3D3")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DarkGray",{get:function(){return t.fromHex("#A9A9A9")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Yellow",{get:function(){return t.fromHex("#FFFF00")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Orange",{get:function(){return t.fromHex("#FFA500")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Red",{get:function(){return t.fromHex("#FF0000")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Vermilion",{get:function(){return t.fromHex("#FF5B31")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Vermillion",{get:function(){return t.Vermilion},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Rose",{get:function(){return t.fromHex("#FF007F")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Magenta",{get:function(){return t.fromHex("#FF00FF")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Violet",{get:function(){return t.fromHex("#7F00FF")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Blue",{get:function(){return t.fromHex("#0000FF")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Azure",{get:function(){return t.fromHex("#007FFF")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Cyan",{get:function(){return t.fromHex("#00FFFF")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Viridian",{get:function(){return t.fromHex("#59978F")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Green",{get:function(){return t.fromHex("#00FF00")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Chartreuse",{get:function(){return t.fromHex("#7FFF00")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Transparent",{get:function(){return t.fromHex("#FFFFFF00")},enumerable:!1,configurable:!0}),et([q({message:"Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0"})],t.prototype,"mulitiply",null),et([q({message:"Alias for incorrect spelling used in older versions",alternateMethod:"Vermilion"})],t,"Vermillion",null),t}(),it=function(){function t(t,e,n,i){this.h=t,this.s=e,this.l=n,this.a=i}return t.hue2rgb=function(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t},t.fromRGBA=function(e,n,i,r){e/=255,n/=255,i/=255;var o,s,a=Math.max(e,n,i),c=Math.min(e,n,i),u=(a+c)/2;if(a===c)o=s=0;else{var h=a-c;switch(s=u>.5?h/(2-a-c):h/(a+c),a){case e:o=(n-i)/h+(n<i?6:0);break;case n:o=(i-e)/h+2;break;case i:o=(e-n)/h+4}o/=6}return new t(o,s,u,r)},t.prototype.toRGBA=function(){var e,n,i;if(0===this.s)e=n=i=this.l;else{var r=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,o=2*this.l-r;e=t.hue2rgb(o,r,this.h+1/3),n=t.hue2rgb(o,r,this.h),i=t.hue2rgb(o,r,this.h-1/3)}return new nt(255*e,255*n,255*i,this.a)},t.prototype.toString=function(){return"hsla("+this.h.toFixed(0)+", "+this.s.toFixed(0)+", "+this.l.toFixed(0)+", "+this.a.toFixed(0)+")"},t}(),rt=function(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};!function(t){t[t.Box=0]="Box",t[t.RigidBody=1]="RigidBody"}(J||(J={})),function(t){t[t.Naive=0]="Naive",t[t.DynamicAABBTree=1]="DynamicAABBTree"}($||($={})),function(t){t[t.Euler=0]="Euler"}(tt||(tt={}));var ot,st,at=function(){function t(){}return t.useBoxPhysics=function(){t.collisionResolutionStrategy=J.Box},t.useRigidBodyPhysics=function(){t.collisionResolutionStrategy=J.RigidBody},Object.defineProperty(t,"dynamicTreeVelocityMultiplyer",{get:function(){return t.dynamicTreeVelocityMultiplier},set:function(e){t.dynamicTreeVelocityMultiplier=e},enumerable:!1,configurable:!0}),t.acc=new V(0,0),t.enabled=!0,t.collisionPasses=5,t.broadphaseStrategy=$.DynamicAABBTree,t.broadphaseDebug=!1,t.showCollisionNormals=!1,t.showMotionVectors=!1,t.showBounds=!1,t.showArea=!1,t.showContacts=!1,t.showNormals=!1,t.collisionResolutionStrategy=J.Box,t.defaultMass=10,t.integrator=tt.Euler,t.integrationSteps=1,t.allowRigidBodyRotation=!0,t.collisionShift=.001,t.dynamicTreeVelocityMultiplier=2,t.boundsPadding=5,t.surfaceEpsilon=.1,t.checkForFastBodies=!0,t.disableMinimumSpeedForFastBody=!1,rt([q({message:"Alias for incorrect spelling used in older versions, will be removed in v0.25.0",alternateMethod:"dynamicTreeVelocityMultiplier"})],t,"dynamicTreeVelocityMultiplyer",null),t}(),ct=(ot=function(t,e){return(ot=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}ot(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});!function(t){t.Kill="kill",t.PreKill="prekill",t.PostKill="postkill",t.PreDraw="predraw",t.PostDraw="postdraw",t.PreDebugDraw="predebugdraw",t.PostDebugDraw="postdebugdraw",t.PreUpdate="preupdate",t.PostUpdate="postupdate",t.PreFrame="preframe",t.PostFrame="postframe",t.PreCollision="precollision",t.CollisionStart="collisionstart",t.CollisionEnd="collisionend",t.PostCollision="postcollision",t.Initialize="initialize",t.Activate="activate",t.Deactivate="deactivate",t.ExitViewport="exitviewport",t.EnterViewport="enterviewport",t.ExitTrigger="exit",t.EnterTrigger="enter",t.Connect="connect",t.Disconnect="disconnect",t.Button="button",t.Axis="axis",t.Subscribe="subscribe",t.Unsubscribe="unsubscribe",t.Visible="visible",t.Hidden="hidden",t.Start="start",t.Stop="stop",t.PointerUp="pointerup",t.PointerDown="pointerdown",t.PointerMove="pointermove",t.PointerEnter="pointerenter",t.PointerLeave="pointerleave",t.PointerCancel="pointercancel",t.PointerWheel="pointerwheel",t.Up="up",t.Down="down",t.Move="move",t.Enter="enter",t.Leave="leave",t.Cancel="cancel",t.Wheel="wheel",t.Press="press",t.Release="release",t.Hold="hold",t.PointerDragStart="pointerdragstart",t.PointerDragEnd="pointerdragend",t.PointerDragEnter="pointerdragenter",t.PointerDragLeave="pointerdragleave",t.PointerDragMove="pointerdragmove"}(st||(st={}));var ut,ht=function(){function t(){this._bubbles=!0}return Object.defineProperty(t.prototype,"bubbles",{get:function(){return this._bubbles},set:function(t){this._bubbles=t},enumerable:!1,configurable:!0}),t.prototype.stopPropagation=function(){this.bubbles=!1},t}(),lt=function(t){function e(e){var n=t.call(this)||this;return n.target=e,n}return ct(e,t),e}(ht),pt=function(t){function e(e){var n=t.call(this)||this;return n.target=e,n}return ct(e,t),e}(ht),ft=function(t){function e(e){var n=t.call(this)||this;return n.target=e,n}return ct(e,t),e}(ht),dt=function(t){function e(e){var n=t.call(this)||this;return n.target=e,n}return ct(e,t),e}(ht),yt=function(t){function e(e){var n=t.call(this)||this;return n.target=e,n}return ct(e,t),e}(ht),gt=function(t){function e(e,n,i){var r=t.call(this)||this;return r.ctx=e,r.delta=n,r.target=i,r}return ct(e,t),e}(ht),_t=function(t){function e(e,n,i){var r=t.call(this)||this;return r.ctx=e,r.delta=n,r.target=i,r}return ct(e,t),e}(ht),vt=function(t){function e(e,n){var i=t.call(this)||this;return i.ctx=e,i.target=n,i}return ct(e,t),e}(ht),mt=function(t){function e(e,n){var i=t.call(this)||this;return i.ctx=e,i.target=n,i}return ct(e,t),e}(ht),bt=function(t){function e(e,n,i){var r=t.call(this)||this;return r.engine=e,r.delta=n,r.target=i,r}return ct(e,t),e}(ht),wt=function(t){function e(e,n,i){var r=t.call(this)||this;return r.engine=e,r.delta=n,r.target=i,r}return ct(e,t),e}(ht),xt=function(t){function e(e,n){var i=t.call(this)||this;return i.engine=e,i.prevStats=n,i.target=e,i}return ct(e,t),e}(ht),Pt=function(t){function e(e,n){var i=t.call(this)||this;return i.engine=e,i.stats=n,i.target=e,i}return ct(e,t),e}(ht),At=function(t){function e(e,n){var i=t.call(this)||this;return i.index=e,i.gamepad=n,i.target=n,i}return ct(e,t),e}(ht),St=function(t){function e(e,n){var i=t.call(this)||this;return i.index=e,i.gamepad=n,i.target=n,i}return ct(e,t),e}(ht),Et=function(t){function e(e,n,i){var r=t.call(this)||this;return r.button=e,r.value=n,r.target=i,r}return ct(e,t),e}(ht),Ct=function(t){function e(e,n,i){var r=t.call(this)||this;return r.axis=e,r.value=n,r.target=i,r}return ct(e,t),e}(ht),Ot=function(t){function e(e,n){var i=t.call(this)||this;return i.topic=e,i.handler=n,i}return ct(e,t),e}(ht),Tt=function(t){function e(e,n){var i=t.call(this)||this;return i.topic=e,i.handler=n,i}return ct(e,t),e}(ht),Bt=function(t){function e(e){var n=t.call(this)||this;return n.target=e,n}return ct(e,t),e}(ht),Dt=function(t){function e(e){var n=t.call(this)||this;return n.target=e,n}return ct(e,t),e}(ht),Mt=function(t){function e(e,n,i,r){var o=t.call(this)||this;return o.other=n,o.side=i,o.intersection=r,o.target=e,o}return ct(e,t),Object.defineProperty(e.prototype,"actor",{get:function(){return this.target},set:function(t){this.target=t},enumerable:!1,configurable:!0}),e}(ht),jt=function(t){function e(e,n,i,r){var o=t.call(this)||this;return o.other=n,o.side=i,o.intersection=r,o.target=e,o}return ct(e,t),Object.defineProperty(e.prototype,"actor",{get:function(){return this.target},set:function(t){this.target=t},enumerable:!1,configurable:!0}),e}(ht),Rt=function(t){function e(e,n,i){var r=t.call(this)||this;return r.other=n,r.pair=i,r.target=e,r}return ct(e,t),Object.defineProperty(e.prototype,"actor",{get:function(){return this.target},set:function(t){this.target=t},enumerable:!1,configurable:!0}),e}(ht),kt=function(t){function e(e,n){var i=t.call(this)||this;return i.other=n,i.target=e,i}return ct(e,t),Object.defineProperty(e.prototype,"actor",{get:function(){return this.target},set:function(t){this.target=t},enumerable:!1,configurable:!0}),e}(ht),Ft=function(t){function e(e,n){var i=t.call(this)||this;return i.engine=e,i.target=n,i}return ct(e,t),e}(ht),It=function(t){function e(e,n){var i=t.call(this)||this;return i.oldScene=e,i.target=n,i}return ct(e,t),e}(ht),Lt=function(t){function e(e,n){var i=t.call(this)||this;return i.newScene=e,i.target=n,i}return ct(e,t),e}(ht),Ut=function(t){function e(e){var n=t.call(this)||this;return n.target=e,n}return ct(e,t),e}(ht),zt=function(t){function e(e){var n=t.call(this)||this;return n.target=e,n}return ct(e,t),e}(ht),Nt=function(t){function e(e,n){var i=t.call(this)||this;return i.target=e,i.actor=n,i}return ct(e,t),e}(ht),Wt=function(t){function e(e,n){var i=t.call(this)||this;return i.target=e,i.actor=n,i}return ct(e,t),e}(ht);!function(t){t.PreventCollision="PreventCollision",t.Passive="Passive",t.Active="Active",t.Fixed="Fixed"}(ut||(ut={}));var Ht=function(){function t(t,e,n,i,r){this.colliderA=t,this.colliderB=e,this.mtv=n,this.point=i,this.normal=r}return t.prototype.resolve=function(t){if(t===J.RigidBody)this._resolveRigidBodyCollision();else{if(t!==J.Box)throw new Error("Unknown collision resolution strategy");this._resolveBoxCollision()}},t.prototype._applyBoxImpulse=function(t,e,n){if(t.type===ut.Active&&e.type!==ut.Passive){t.type===ut.Active&&e.type===ut.Active&&(n=n.scale(.5)),t.body.pos.y+=n.y,t.body.pos.x+=n.x;var i=n.normalize();if(i.dot(t.body.vel)<0){var r=i.scale(i.dot(t.body.vel.negate()));t.body.vel=t.body.vel.add(r)}t.emit("postcollision",new jt(t,e,D(n),n))}},t.prototype._resolveBoxCollision=function(){var t=D(this.mtv),e=this.mtv.negate();this.colliderA.emit("precollision",new Mt(this.colliderA,this.colliderB,t,e)),this.colliderB.emit("precollision",new Mt(this.colliderB,this.colliderA,B(t),e.negate())),this._applyBoxImpulse(this.colliderA,this.colliderB,e),this._applyBoxImpulse(this.colliderB,this.colliderA,e.negate())},t.prototype._resolveRigidBodyCollision=function(){var t=this.colliderA.body,e=this.colliderB.body,n=this.mtv,i=this.normal;if(t!==e){var r=D(this.mtv);if(this.colliderA.emit("precollision",new Mt(this.colliderA,this.colliderB,r,this.mtv)),this.colliderB.emit("precollision",new Mt(this.colliderB,this.colliderA,B(r),this.mtv.negate())),this.colliderA.type!==ut.Passive&&this.colliderB.type!==ut.Passive){var o=this.colliderA.type===ut.Fixed?0:1/this.colliderA.mass,s=this.colliderB.type===ut.Fixed?0:1/this.colliderB.mass,a=this.colliderA.type===ut.Fixed?0:1/this.colliderA.inertia,c=this.colliderB.type===ut.Fixed?0:1/this.colliderB.inertia,u=Math.min(this.colliderA.bounciness,this.colliderB.bounciness),h=Math.min(this.colliderA.friction,this.colliderB.friction),l=(i=i.normalize()).normal().normalize(),p=this.point.sub(this.colliderA.center),f=this.point.sub(this.colliderB.center),d=e.vel.add(f.cross(-e.rx)).sub(t.vel.sub(p.cross(t.rx))),y=d.dot(i),g=d.dot(l),_=p.dot(l),v=p.dot(i),m=f.dot(l),b=f.dot(i);if(!(y>0)){var w=-(1+u)*y/(o+s+a*_*_+c*m*m);if(this.colliderA.type===ut.Fixed?(e.vel=e.vel.add(i.scale(w*s)),at.allowRigidBodyRotation&&(e.rx-=w*c*-f.cross(i)),e.addMtv(n)):this.colliderB.type===ut.Fixed?(t.vel=t.vel.sub(i.scale(w*o)),at.allowRigidBodyRotation&&(t.rx+=w*a*-p.cross(i)),t.addMtv(n.negate())):(e.vel=e.vel.add(i.scale(w*s)),t.vel=t.vel.sub(i.scale(w*o)),at.allowRigidBodyRotation&&(e.rx-=w*c*-f.cross(i),t.rx+=w*a*-p.cross(i)),e.addMtv(n.scale(.5)),t.addMtv(n.scale(-.5))),h&&g){var x=d.sub(i.scale(d.dot(i))).normalize(),P=d.dot(x)/(o+s+v*v*a+b*b*c),A=new V(0,0);A=Math.abs(P)<=w*h?x.scale(P).negate():x.scale(-w*h),this.colliderA.type===ut.Fixed?(e.vel=e.vel.add(A.scale(s)),at.allowRigidBodyRotation&&(e.rx+=A.dot(x)*c*f.cross(x))):this.colliderB.type===ut.Fixed?(t.vel=t.vel.sub(A.scale(o)),at.allowRigidBodyRotation&&(t.rx-=A.dot(x)*a*p.cross(x))):(e.vel=e.vel.add(A.scale(s)),t.vel=t.vel.sub(A.scale(o)),at.allowRigidBodyRotation&&(e.rx+=A.dot(x)*c*f.cross(x),t.rx-=A.dot(x)*a*p.cross(x)))}this.colliderA.emit("postcollision",new jt(this.colliderA,this.colliderB,r,this.mtv)),this.colliderB.emit("postcollision",new jt(this.colliderB,this.colliderA,B(r),this.mtv.negate()))}}}},t}(),qt={CollideCircleCircle:function(t,e){var n=t.radius+e.radius,i=t.worldPos,r=e.worldPos;if(i.distance(r)>n)return null;var o=r.sub(i).normalize(),s=o.scale(n-r.distance(i)),a=t.getFurthestPoint(o);return new Ht(t.collider,e.collider,s,a,o)},CollideCirclePolygon:function(t,e){var n=t.testSeparatingAxisTheorem(e);if(!n)return null;var i=n.dot(e.center.sub(t.center));n=i<0?n.negate():n;var r=[],o=e.getFurthestPoint(n.negate()),s=t.getFurthestPoint(n);return t.contains(o)&&r.push(o),e.contains(s)&&r.push(s),0===r.length?null:new Ht(t.collider,e.collider,n,2===r.length?r[0].average(r[1]):r[0],n.normalize())},CollideCircleEdge:function(t,e){var n=t.center,i=e.end.sub(e.begin),r=i.dot(e.end.sub(n)),o=i.dot(n.sub(e.begin));if(o<=0){var s=e.begin.sub(n),a=s.dot(s);return a>t.radius*t.radius?null:new Ht(t.collider,e.collider,s.normalize().scale(t.radius-Math.sqrt(a)),e.begin,s.normalize())}if(r<=0){var c=e.end.sub(n),u=c.dot(c);return u>t.radius*t.radius?null:new Ht(t.collider,e.collider,c.normalize().scale(t.radius-Math.sqrt(u)),e.end,c.normalize())}var h=i.dot(i),l=e.begin.scale(r).add(e.end.scale(o)).scale(1/h),p=n.sub(l),f=p.dot(p);if(f>t.radius*t.radius)return null;var d=i.perpendicular();d.dot(n.sub(e.begin))<0&&(d.x=-d.x,d.y=-d.y);var y=(d=d.normalize()).scale(Math.abs(t.radius-Math.sqrt(f)));return new Ht(t.collider,e.collider,y.negate(),l,d.negate())},CollideEdgeEdge:function(){return null},CollidePolygonEdge:function(t,e){var n=e.end.sub(e.begin).normal();if(t.contains(e.begin)){var i=t.getClosestFace(e.begin),r=i.distance,o=i.face;if(r)return new Ht(t.collider,e.collider,r.negate(),e.begin.add(r.negate()),o.normal().negate())}if(t.contains(e.end)){var s=t.getClosestFace(e.end);r=s.distance,o=s.face;if(r)return new Ht(t.collider,e.collider,r.negate(),e.end.add(r.negate()),o.normal().negate())}var a=t.center,c=e.center.sub(a).normalize(),u=new Zt({collider:e.collider,points:[e.begin,e.end,e.end.add(c.scale(30)),e.begin.add(c.scale(30))]}),h=t.testSeparatingAxisTheorem(u);return h?(n=n.dot(c)<0?n.negate():n,h=h.dot(c)<0?h.negate():h,new Ht(t.collider,e.collider,h,t.getFurthestPoint(n),n)):null},CollidePolygonPolygon:function(t,e){var n=t.testSeparatingAxisTheorem(e);if(!n)return null;var i=n.dot(e.center.sub(t.center));n=i<0?n.negate():n;var r=[],o=t.getFurthestPoint(n),s=e.getFurthestPoint(n.negate());e.contains(o)&&r.push(o),t.contains(s)&&r.push(s),0===r.length&&r.push(s);var a=2===r.length?r[0].add(r[1]).scale(.5):r[0];return new Ht(t.collider,e.collider,n,a,n.normalize())}};function Kt(t,e,n,i){var r=t.sub(n),o=e.dot(e),s=e.dot(i),a=i.dot(i),c=e.dot(r),u=i.dot(r),h=o*a-s*s,l=h,p=h;if(0===h||h<=.01){var f=c/s;return new X(t,n.add(i.scale(f)))}var d=s*u-a*c,y=o*u-s*c;return d<0?(d=0,y=u,p=a):d>l&&(d=l,y=u+s,p=a),y<0?(y=0,-c<0?d=0:-c>o?d=l:(d=-c,l=o)):y>p&&(y=p,-c+s<0?d=0:-c+s>o?d=l:(d=-c+s,l=o)),d=Math.abs(d)<.001?0:d/l,y=Math.abs(y)<.001?0:y/p,new X(t.add(e.scale(d)),n.add(i.scale(y)))}var Vt,Gt={PolygonPolygonClosestLine:function(t,e){var n=e.worldPos,i=n.sub(t.worldPos),r=i.negate(),o=new G(t.worldPos,i),s=new G(n,r),a=t.rayCast(o).add(o.dir.scale(.1)),c=e.rayCast(s).add(s.dir.scale(.1)),u=t.getClosestFace(a),h=e.getClosestFace(c);return Kt(u.face.begin,u.face.getEdge(),h.face.begin,h.face.getEdge())},PolygonEdgeClosestLine:function(t,e){var n=e.worldPos.sub(t.worldPos),i=new G(t.worldPos,n),r=t.rayCast(i).add(i.dir.scale(.1)),o=t.getClosestFace(r),s=o.face.begin,a=o.face.getEdge(),c=e.asLine();return Kt(s,a,c.begin,c.getEdge())},PolygonCircleClosestLine:function(t,e){var n=e.worldPos,i=n.sub(t.worldPos),r=new G(t.worldPos,i.normalize()),o=t.rayCast(r).add(r.dir.scale(.1)),s=t.getClosestFace(o),a=s.face.begin,c=s.face.getEdge(),u=(c.x*(n.x-a.x)+c.y*(n.y-a.y))/(c.x*c.x+c.y*c.y);u>1?u=1:u<0&&(u=0);var h=Math.sqrt(Math.pow(a.x+c.x*u-n.x,2)+Math.pow(a.y+c.y*u-n.y,2))-e.radius,l=(a.x+c.x*u-n.x)*e.radius/(e.radius+h),p=(a.y+c.y*u-n.y)*e.radius/(e.radius+h);return new X(c.scale(u).add(a),new V(n.x+l,n.y+p))},CircleCircleClosestLine:function(t,e){var n=e.worldPos.sub(t.worldPos),i=t.worldPos.sub(e.worldPos),r=new G(t.worldPos,n),o=new G(e.worldPos,i),s=t.rayCast(r),a=e.rayCast(o);return new X(s,a)},CircleEdgeClosestLine:function(t,e){var n=t.worldPos,i=e.asLine(),r=i.begin,o=i.getEdge(),s=(o.x*(n.x-r.x)+o.y*(n.y-r.y))/(o.x*o.x+o.y*o.y);s>1?s=1:s<0&&(s=0);var a=Math.sqrt(Math.pow(r.x+o.x*s-n.x,2)+Math.pow(r.y+o.y*s-n.y,2))-t.radius,c=(r.x+o.x*s-n.x)*t.radius/(t.radius+a),u=(r.y+o.y*s-n.y)*t.radius/(t.radius+a);return new X(o.scale(s).add(r),new V(n.x+c,n.y+u))},EdgeEdgeClosestLine:function(t,e){var n=t.asLine(),i=n.begin,r=n.getEdge(),o=e.asLine();return Kt(i,r,o.begin,o.getEdge())}},Xt=function(){function t(t){this.offset=V.Zero,this.offset=t.offset||V.Zero,this.radius=t.radius||0,this.collider=t.collider||null}return Object.defineProperty(t.prototype,"worldPos",{get:function(){return this.collider&&this.collider.body?this.collider.body.pos.add(this.offset):this.offset},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return new t({offset:this.offset.clone(),radius:this.radius,collider:null})},Object.defineProperty(t.prototype,"center",{get:function(){return this.collider&&this.collider.body?this.offset.add(this.collider.body.pos):this.offset},enumerable:!1,configurable:!0}),t.prototype.contains=function(t){var e=this.offset;return this.collider&&this.collider.body&&(e=this.collider.body.pos),e.distance(t)<=this.radius},t.prototype.rayCast=function(t,e){void 0===e&&(e=1/0);var n=this.center,i=t.dir,r=t.pos,o=Math.sqrt(Math.pow(i.dot(r.sub(n)),2)-Math.pow(r.sub(n).distance(),2)+Math.pow(this.radius,2));if(o<0)return null;var s=0;if(0===o)return(s=-i.dot(r.sub(n)))>0&&s<e?t.getPoint(s):null;var a=-i.dot(r.sub(n))+o,c=-i.dot(r.sub(n))-o,u=[];a>=0&&u.push(a),c>=0&&u.push(c);var h=Math.min.apply(Math,u);return h<=e?t.getPoint(h):null},t.prototype.getClosestLineBetween=function(e){if(e instanceof t)return Gt.CircleCircleClosestLine(this,e);if(e instanceof Zt)return Gt.PolygonCircleClosestLine(e,this).flip();if(e instanceof Qt)return Gt.CircleEdgeClosestLine(this,e).flip();throw new Error("Polygon could not collide with unknown CollisionShape "+typeof e)},t.prototype.collide=function(e){if(e instanceof t)return qt.CollideCircleCircle(this,e);if(e instanceof Zt)return qt.CollideCirclePolygon(this,e);if(e instanceof Qt)return qt.CollideCircleEdge(this,e);throw new Error("Circle could not collide with unknown CollisionShape "+typeof e)},t.prototype.getFurthestPoint=function(t){return this.center.add(t.normalize().scale(this.radius))},Object.defineProperty(t.prototype,"bounds",{get:function(){var t=V.Zero;return this.collider&&this.collider.body&&(t=this.collider.body.pos),new Yt(this.offset.x+t.x-this.radius,this.offset.y+t.y-this.radius,this.offset.x+t.x+this.radius,this.offset.y+t.y+this.radius)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localBounds",{get:function(){return new Yt(this.offset.x-this.radius,this.offset.y-this.radius,this.offset.x+this.radius,this.offset.y+this.radius)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"axes",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"inertia",{get:function(){return(this.collider?this.collider.mass:at.defaultMass)*this.radius*this.radius/2},enumerable:!1,configurable:!0}),t.prototype.testSeparatingAxisTheorem=function(t){var e=t.axes,n=t.center,i=t.getFurthestPoint(this.offset.sub(n));e.push(this.offset.sub(i).normalize());for(var r=Number.MAX_VALUE,o=null,s=-1,a=0;a<e.length;a++){var c=t.project(e[a]),u=this.project(e[a]),h=c.getOverlap(u);if(h<=0)return null;h<r&&(r=h,o=e[a],s=a)}return s<0?null:o.normalize().scale(r)},t.prototype.recalc=function(){},t.prototype.project=function(t){var e=[],n=this.center.dot(t);return e.push(n),e.push(n+this.radius),e.push(n-this.radius),new Q(Math.min.apply(Math,e),Math.max.apply(Math,e))},t.prototype.draw=function(t,e,n){void 0===e&&(e=nt.Green),void 0===n&&(n=V.Zero);var i=n.add(this.offset);t.beginPath(),t.fillStyle=e.toString(),t.arc(i.x,i.y,this.radius,0,2*Math.PI),t.closePath(),t.fill()},t.prototype.debugDraw=function(t,e){void 0===e&&(e=nt.Green);var n=this.collider.body,i=n?n.pos.add(this.offset):this.offset,r=n?n.rotation:0;t.beginPath(),t.strokeStyle=e.toString(),t.arc(i.x,i.y,this.radius,0,2*Math.PI),t.closePath(),t.stroke(),t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(Math.cos(r)*this.radius+i.x,Math.sin(r)*this.radius+i.y),t.closePath(),t.stroke()},t}(),Qt=function(){function t(t){this.begin=t.begin||V.Zero,this.end=t.end||V.Zero,this.collider=t.collider||null,this.offset=this.center}return t.prototype.clone=function(){return new t({begin:this.begin.clone(),end:this.end.clone(),collider:null})},Object.defineProperty(t.prototype,"worldPos",{get:function(){return this.collider&&this.collider.body?this.collider.body.pos.add(this.offset):this.offset},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"center",{get:function(){return this.begin.average(this.end).add(this._getBodyPos())},enumerable:!1,configurable:!0}),t.prototype._getBodyPos=function(){var t=V.Zero;return this.collider&&this.collider.body&&(t=this.collider.body.pos),t},t.prototype._getTransformedBegin=function(){var t=this.collider?this.collider.body:null,e=t?t.rotation:0;return this.begin.rotate(e).add(this._getBodyPos())},t.prototype._getTransformedEnd=function(){var t=this.collider?this.collider.body:null,e=t?t.rotation:0;return this.end.rotate(e).add(this._getBodyPos())},t.prototype.getSlope=function(){var t=this._getTransformedBegin(),e=this._getTransformedEnd(),n=t.distance(e);return e.sub(t).scale(1/n)},t.prototype.getLength=function(){var t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.distance(e)},t.prototype.contains=function(){return!1},t.prototype.rayCast=function(t,e){void 0===e&&(e=1/0);var n=this._getTransformedBegin().sub(t.pos);if(0===t.dir.cross(this.getSlope())&&0!==n.cross(t.dir))return null;var i=t.dir.cross(this.getSlope());if(0===i)return null;var r=n.cross(this.getSlope())/i;if(r>=0&&r<=e){var o=n.cross(t.dir)/i/this.getLength();if(o>=0&&o<=1)return t.getPoint(r)}return null},t.prototype.getClosestLineBetween=function(e){if(e instanceof Xt)return Gt.CircleEdgeClosestLine(e,this);if(e instanceof Zt)return Gt.PolygonEdgeClosestLine(e,this).flip();if(e instanceof t)return Gt.EdgeEdgeClosestLine(this,e);throw new Error("Polygon could not collide with unknown CollisionShape "+typeof e)},t.prototype.collide=function(e){if(e instanceof Xt)return qt.CollideCircleEdge(e,this);if(e instanceof Zt)return qt.CollidePolygonEdge(e,this);if(e instanceof t)return qt.CollideEdgeEdge();throw new Error("Edge could not collide with unknown CollisionShape "+typeof e)},t.prototype.getFurthestPoint=function(t){var e=this._getTransformedBegin(),n=this._getTransformedEnd();return t.dot(e)>0?e:n},t.prototype._boundsFromBeginEnd=function(t,e){return new Yt(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.max(t.x,e.x),Math.max(t.y,e.y))},Object.defineProperty(t.prototype,"bounds",{get:function(){var t=this._getTransformedBegin(),e=this._getTransformedEnd();return this._boundsFromBeginEnd(t,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localBounds",{get:function(){return this._boundsFromBeginEnd(this.begin,this.end)},enumerable:!1,configurable:!0}),t.prototype.asLine=function(){return new X(this._getTransformedBegin(),this._getTransformedEnd())},t.prototype.asLocalLine=function(){return new X(this.begin,this.end)},Object.defineProperty(t.prototype,"axes",{get:function(){var t=this._getTransformedEnd().sub(this._getTransformedBegin()).normal(),e=[];return e.push(t),e.push(t.negate()),e.push(t.normal()),e.push(t.normal().negate()),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"inertia",{get:function(){var t=this.collider?this.collider.mass:at.defaultMass,e=this.end.sub(this.begin).distance()/2;return t*e*e},enumerable:!1,configurable:!0}),t.prototype.recalc=function(){},t.prototype.project=function(t){for(var e=[],n=[this._getTransformedBegin(),this._getTransformedEnd()],i=n.length,r=0;r<i;r++)e.push(n[r].dot(t));return new Q(Math.min.apply(Math,e),Math.max.apply(Math,e))},t.prototype.draw=function(t,e,n){void 0===e&&(e=nt.Green),void 0===n&&(n=V.Zero);var i=this.begin.add(n),r=this.end.add(n);t.strokeStyle=e.toString(),t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(r.x,r.y),t.closePath(),t.stroke()},t.prototype.debugDraw=function(t,e){void 0===e&&(e=nt.Red);var n=this._getTransformedBegin(),i=this._getTransformedEnd();t.strokeStyle=e.toString(),t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(i.x,i.y),t.closePath(),t.stroke()},t}(),Zt=function(){function t(t){this._transformedPoints=[],this._axes=[],this._sides=[],this.offset=t.offset||V.Zero;var e=!!t.clockwiseWinding;this.points=(e?t.points.reverse():t.points)||[],this.collider=this.collider=t.collider||null,this._calculateTransformation()}return t.prototype.clone=function(){return new t({offset:this.offset.clone(),points:this.points.map((function(t){return t.clone()})),collider:null})},Object.defineProperty(t.prototype,"worldPos",{get:function(){return this.collider&&this.collider.body?this.collider.body.pos.add(this.offset):this.offset},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"center",{get:function(){var t=this.collider?this.collider.body:null;return t?t.pos.add(this.offset):this.offset},enumerable:!1,configurable:!0}),t.prototype._calculateTransformation=function(){var t=this.collider?this.collider.body:null,e=t?t.pos.add(this.offset):this.offset,n=t?t.rotation:0,i=t?t.scale:V.One,r=this.points.length;this._transformedPoints.length=0;for(var o=0;o<r;o++)this._transformedPoints[o]=this.points[o].scale(i).rotate(n).add(e)},t.prototype.getTransformedPoints=function(){return this._transformedPoints.length&&(!this.collider||!this.collider.body||this.collider.body.oldPos.equals(this.collider.body.pos)&&this.collider.body.oldRotation===this.collider.body.rotation&&this.collider.body.oldScale===this.collider.body.scale)||this._calculateTransformation(),this._transformedPoints},t.prototype.getSides=function(){if(this._sides.length)return this._sides;for(var t=[],e=this.getTransformedPoints(),n=e.length,i=0;i<n;i++)t.push(new X(e[i],e[(i-1+n)%n]));return this._sides=t,this._sides},t.prototype.recalc=function(){this._sides.length=0,this._axes.length=0,this._transformedPoints.length=0,this.getTransformedPoints(),this.getSides()},t.prototype.contains=function(t){var e=new G(t,new V(1,0));return this.getSides().reduce((function(t,n){return e.intersect(n)>=0?t+1:t}),0)%2!=0},t.prototype.getClosestLineBetween=function(e){if(e instanceof Xt)return Gt.PolygonCircleClosestLine(this,e);if(e instanceof t)return Gt.PolygonPolygonClosestLine(this,e);if(e instanceof Qt)return Gt.PolygonEdgeClosestLine(this,e);throw new Error("Polygon could not collide with unknown CollisionShape "+typeof e)},t.prototype.collide=function(e){if(e instanceof Xt)return qt.CollideCirclePolygon(e,this);if(e instanceof t)return qt.CollidePolygonPolygon(this,e);if(e instanceof Qt)return qt.CollidePolygonEdge(this,e);throw new Error("Polygon could not collide with unknown CollisionShape "+typeof e)},t.prototype.getFurthestPoint=function(t){for(var e=this.getTransformedPoints(),n=null,i=-Number.MAX_VALUE,r=0;r<e.length;r++){var o=t.dot(e[r]);o>i&&(i=o,n=e[r])}return n},t.prototype.getClosestFace=function(t){for(var e=this.getSides(),n=Number.POSITIVE_INFINITY,i=-1,r=-1,o=0;o<e.length;o++){var s=e[o].distanceToPoint(t);s<n&&(n=s,i=o,r=s)}return-1!==i?{distance:e[i].normal().scale(r),face:e[i]}:null},Object.defineProperty(t.prototype,"bounds",{get:function(){var t=this.getTransformedPoints();return Yt.fromPoints(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localBounds",{get:function(){return Yt.fromPoints(this.points)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"inertia",{get:function(){for(var t=this.collider?this.collider.mass:at.defaultMass,e=0,n=0,i=0;i<this.points.length;i++){var r=(i+1)%this.points.length,o=this.points[r].cross(this.points[i]);e+=o*(this.points[i].dot(this.points[i])+this.points[i].dot(this.points[r])+this.points[r].dot(this.points[r])),n+=o}return t/6*(e/n)},enumerable:!1,configurable:!0}),t.prototype.rayCast=function(t,e){void 0===e&&(e=1/0);for(var n=this.getSides(),i=n.length,r=Number.MAX_VALUE,o=-1,s=0;s<i;s++){var a=t.intersect(n[s]);a>=0&&a<r&&a<=e&&(r=a,o=s)}return o>=0?t.getPoint(r):null},Object.defineProperty(t.prototype,"axes",{get:function(){if(this._axes.length)return this._axes;for(var t=[],e=this.getTransformedPoints(),n=e.length,i=0;i<n;i++)t.push(e[i].sub(e[(i+1)%n]).normal());return this._axes=t,this._axes},enumerable:!1,configurable:!0}),t.prototype.testSeparatingAxisTheorem=function(t){for(var e=t,n=this.axes.concat(e.axes),i=Number.MAX_VALUE,r=null,o=-1,s=0;s<n.length;s++){var a=this.project(n[s]),c=e.project(n[s]),u=a.getOverlap(c);if(u<=0)return null;u<i&&(i=u,r=n[s],o=s)}return-1===o?null:r.normalize().scale(i)},t.prototype.project=function(t){for(var e=this.getTransformedPoints(),n=e.length,i=Number.MAX_VALUE,r=-Number.MAX_VALUE,o=0;o<n;o++){var s=e[o].dot(t);i=Math.min(i,s),r=Math.max(r,s)}return new Q(i,r)},t.prototype.draw=function(t,e,n){void 0===e&&(e=nt.Green),void 0===n&&(n=V.Zero);var i=n.add(this.offset);t.beginPath(),t.fillStyle=e.toString(),t.moveTo(i.x,i.y);var r=this.points[0].sub(i);this.points.map((function(t){return t.sub(r)})).forEach((function(e){t.lineTo(e.x,e.y)})),t.lineTo(i.x,i.y),t.closePath(),t.fill()},t.prototype.debugDraw=function(t,e){void 0===e&&(e=nt.Red),t.beginPath(),t.strokeStyle=e.toString();var n=this.getTransformedPoints()[0];t.moveTo(n.x,n.y),this.getTransformedPoints().forEach((function(e){t.lineTo(e.x,e.y)})),t.lineTo(n.x,n.y),t.closePath(),t.stroke()},t}(),Yt=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),"object"==typeof t?(this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom):"number"==typeof t&&(this.left=t,this.top=e,this.right=n,this.bottom=i)}return t.getSideFromIntersection=function(t){return t&&t?Math.abs(t.x)>Math.abs(t.y)?t.x<0?f.Right:f.Left:t.y<0?f.Bottom:f.Top:f.None},t.fromPoints=function(e){for(var n=1/0,i=1/0,r=-1/0,o=-1/0,s=0;s<e.length;s++)e[s].x<n&&(n=e[s].x),e[s].x>r&&(r=e[s].x),e[s].y<i&&(i=e[s].y),e[s].y>o&&(o=e[s].y);return new t(n,i,r,o)},t.fromDimension=function(e,n,i,r){return void 0===i&&(i=V.Half),void 0===r&&(r=V.Zero),new t(-e*i.x+r.x,-n*i.y+r.y,e-e*i.x+r.x,n-n*i.y+r.y)},Object.defineProperty(t.prototype,"width",{get:function(){return this.right-this.left},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.bottom-this.top},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"center",{get:function(){return new V((this.left+this.right)/2,(this.top+this.bottom)/2)},enumerable:!1,configurable:!0}),t.prototype.translate=function(e){return new t(this.left+e.x,this.top+e.y,this.right+e.x,this.bottom+e.y)},t.prototype.rotate=function(e,n){void 0===n&&(n=V.Zero);var i=this.getPoints().map((function(t){return t.rotate(e,n)}));return t.fromPoints(i)},t.prototype.scale=function(e,n){void 0===n&&(n=V.Zero);var i=this.translate(n);return new t(i.left*e.x,i.top*e.y,i.right*e.x,i.bottom*e.y)},t.prototype.getPerimeter=function(){return 2*(this.width+this.height)},t.prototype.getPoints=function(){var t=[];return t.push(new V(this.left,this.top)),t.push(new V(this.right,this.top)),t.push(new V(this.right,this.bottom)),t.push(new V(this.left,this.bottom)),t},t.prototype.toPolygon=function(t){var e=null;return t&&t.body&&t.body.collider&&(e=t.body.collider),new Zt({collider:e,points:this.getPoints(),offset:V.Zero})},t.prototype.rayCast=function(t,e){void 0===e&&(e=1/0);var n=-1/0,i=1/0,r=0===t.dir.x?Number.MAX_VALUE:1/t.dir.x,o=0===t.dir.y?Number.MAX_VALUE:1/t.dir.y,s=(this.left-t.pos.x)*r,a=(this.right-t.pos.x)*r;n=Math.min(s,a),i=Math.max(s,a);var c=(this.top-t.pos.y)*o,u=(this.bottom-t.pos.y)*o;return n=Math.max(n,Math.min(c,u)),(i=Math.min(i,Math.max(c,u)))>=Math.max(0,n)&&n<e},t.prototype.rayCastTime=function(t,e){void 0===e&&(e=1/0);var n=-1/0,i=1/0,r=0===t.dir.x?Number.MAX_VALUE:1/t.dir.x,o=0===t.dir.y?Number.MAX_VALUE:1/t.dir.y,s=(this.left-t.pos.x)*r,a=(this.right-t.pos.x)*r;n=Math.min(s,a),i=Math.max(s,a);var c=(this.top-t.pos.y)*o,u=(this.bottom-t.pos.y)*o;return n=Math.max(n,Math.min(c,u)),(i=Math.min(i,Math.max(c,u)))>=Math.max(0,n)&&n<e?n:-1},t.prototype.contains=function(e){return e instanceof V?this.left<=e.x&&this.top<=e.y&&this.bottom>=e.y&&this.right>=e.x:e instanceof t&&(this.left<e.left&&this.top<e.top&&e.bottom<this.bottom&&e.right<this.right)},t.prototype.combine=function(e){return new t(Math.min(this.left,e.left),Math.min(this.top,e.top),Math.max(this.right,e.right),Math.max(this.bottom,e.bottom))},Object.defineProperty(t.prototype,"dimensions",{get:function(){return new V(this.width,this.height)},enumerable:!1,configurable:!0}),t.prototype.intersect=function(t){var e=this.combine(t);if(e.width<t.width+this.width&&e.height<t.height+this.height&&!e.dimensions.equals(t.dimensions)&&!e.dimensions.equals(this.dimensions)){var n=0;n=this.right>=t.left&&this.right<=t.right?t.left-this.right:t.right-this.left;var i=0;return i=this.top<=t.bottom&&this.top>=t.top?t.bottom-this.top:t.top-this.bottom,Math.abs(n)<Math.abs(i)?new V(n,0):new V(0,i)}if(e.dimensions.equals(t.dimensions)||e.dimensions.equals(this.dimensions)){n=0;n=this.width-t.width>=0?this.right-t.right<=t.left-this.left?t.left-this.right:t.right-this.left:t.right-this.right<=this.left-t.left?this.left-t.right:this.right-t.left;i=0;return i=this.height-t.height>=0?this.bottom-t.bottom<=t.top-this.top?t.top-this.bottom:t.bottom-this.top:t.bottom-this.bottom<=this.top-t.top?this.top-t.bottom:this.bottom-t.top,Math.abs(n)<Math.abs(i)?new V(n,0):new V(0,i)}return null},t.prototype.intersectWithSide=function(e){var n=this.intersect(e);return t.getSideFromIntersection(n)},t.prototype.debugDraw=function(t,e){void 0===e&&(e=nt.Yellow),t.strokeStyle=e.toString(),t.strokeRect(this.left,this.top,this.width,this.height)},t}(),Jt=function(){return(Jt=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};!function(t){t.FullScreen="FullScreen",t.Container="Container",t.Fixed="Fixed",t.Position="Position"}(Vt||(Vt={}));var $t=function(){function t(){}return Object.defineProperty(t,"SVGA",{get:function(){return{width:800,height:600}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Standard",{get:function(){return{width:1920,height:1080}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Atari2600",{get:function(){return{width:160,height:192}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"GameBoy",{get:function(){return{width:160,height:144}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"GameBoyAdvance",{get:function(){return{width:240,height:160}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"NintendoDS",{get:function(){return{width:256,height:192}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"NES",{get:function(){return{width:256,height:224}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"SNES",{get:function(){return{width:256,height:244}},enumerable:!1,configurable:!0}),t}(),te=function(){function t(t){var e,n,i,r=this;this._antialiasing=!0,this._resolutionStack=[],this._viewportStack=[],this._pixelRatio=null,this._isFullScreen=!1,this._isDisposed=!1,this._logger=k.getInstance(),this._pixelRatioChangeHandler=function(){r._logger.debug("Pixel Ratio Change",window.devicePixelRatio),r.applyResolutionAndViewport()},this._windowResizeHandler=function(){var t=r.displayMode===Vt.Container?r.canvas.parentElement||document.body:window;r._logger.debug("View port resized"),r._setHeightByDisplayMode(t),r._logger.info("parent.clientHeight "+t.clientHeight),r.applyResolutionAndViewport()},this.viewport=t.viewport,this.resolution=null!==(e=t.resolution)&&void 0!==e?e:Jt({},this.viewport),this._displayMode=null!==(n=t.displayMode)&&void 0!==n?n:Vt.Fixed,this._canvas=t.canvas,this._ctx=t.context,this._antialiasing=null!==(i=t.antialiasing)&&void 0!==i?i:this._antialiasing,this._browser=t.browser,this._position=t.position,this._pixelRatio=t.pixelRatio,this._applyDisplayMode(),this._mediaQueryList=this._browser.window.nativeComponent.matchMedia("(resolution: "+window.devicePixelRatio+"dppx)"),this._mediaQueryList.addEventListener("change",this._pixelRatioChangeHandler)}return t.prototype.dispose=function(){this._isDisposed||(this._isDisposed=!0,this._browser.window.off("resize",this._windowResizeHandler),this._mediaQueryList.removeEventListener("change",this._pixelRatioChangeHandler))},Object.defineProperty(t.prototype,"pixelRatio",{get:function(){return this._pixelRatio?this._pixelRatio:window.devicePixelRatio<1?1:window.devicePixelRatio||1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHiDpi",{get:function(){return 1!==this.pixelRatio},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"displayMode",{get:function(){return this._displayMode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvas",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._resolution=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewport",{get:function(){return this._viewport?this._viewport:this._resolution},set:function(t){this._viewport=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaledWidth",{get:function(){return this._resolution.width*this.pixelRatio},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaledHeight",{get:function(){return this._resolution.height*this.pixelRatio},enumerable:!1,configurable:!0}),t.prototype.setCurrentCamera=function(t){this._camera=t},t.prototype.pushResolutionAndViewport=function(){this._resolutionStack.push(this.resolution),this._viewportStack.push(this.viewport),this.resolution=Jt({},this.resolution),this.viewport=Jt({},this.viewport)},t.prototype.popResolutionAndViewport=function(){this.resolution=this._resolutionStack.pop(),this.viewport=this._viewportStack.pop()},t.prototype.applyResolutionAndViewport=function(){this._canvas.width=this.scaledWidth,this._canvas.height=this.scaledHeight,this._antialiasing?this._canvas.style.imageRendering="auto":(this._canvas.style.imageRendering="pixelated",""===this._canvas.style.imageRendering&&(this._canvas.style.imageRendering="crisp-edges")),this._canvas.style.width=this.viewport.width+"px",this._canvas.style.height=this.viewport.height+"px",this._ctx.resetTransform(),this._ctx.scale(this.pixelRatio,this.pixelRatio),this._ctx.imageSmoothingEnabled=this._antialiasing},Object.defineProperty(t.prototype,"antialiasing",{get:function(){return this._antialiasing},set:function(t){this._antialiasing=t,this._ctx.imageSmoothingEnabled=this._antialiasing},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isFullScreen",{get:function(){return this._isFullScreen},enumerable:!1,configurable:!0}),t.prototype.goFullScreen=function(){var t=this;return this._canvas.requestFullscreen().then((function(){t._isFullScreen=!0}))},t.prototype.exitFullScreen=function(){var t=this;return document.exitFullscreen().then((function(){t._isFullScreen=!1}))},t.prototype.screenToWorldCoordinates=function(t){var e,n,i,r,o=t.x,s=t.y;return o=o/this.viewport.width*this.drawWidth,s=s/this.viewport.height*this.drawHeight,o-=this.halfDrawWidth,s-=this.halfDrawHeight,o+=null!==(n=null===(e=this._camera)||void 0===e?void 0:e.x)&&void 0!==n?n:0,s+=null!==(r=null===(i=this._camera)||void 0===i?void 0:i.y)&&void 0!==r?r:0,new V(Math.floor(o),Math.floor(s))},t.prototype.worldToScreenCoordinates=function(t){var e,n,i,r,o=t.x,s=t.y;return o-=null!==(n=null===(e=this._camera)||void 0===e?void 0:e.x)&&void 0!==n?n:0,s-=null!==(r=null===(i=this._camera)||void 0===i?void 0:i.y)&&void 0!==r?r:0,o+=this.halfDrawWidth,s+=this.halfDrawHeight,o=o*this.viewport.width/this.drawWidth,s=s*this.viewport.height/this.drawHeight,new V(Math.floor(o),Math.floor(s))},t.prototype.getWorldBounds=function(){var t=this.screenToWorldCoordinates(V.Zero).x,e=this.screenToWorldCoordinates(V.Zero).y,n=t+this.drawWidth,i=e+this.drawHeight;return new Yt(t,e,n,i)},Object.defineProperty(t.prototype,"canvasWidth",{get:function(){return this.canvas.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"halfCanvasWidth",{get:function(){return this.canvas.width/2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvasHeight",{get:function(){return this.canvas.height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"halfCanvasHeight",{get:function(){return this.canvas.height/2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"drawWidth",{get:function(){return this._camera?this.scaledWidth/this._camera.z/this.pixelRatio:this.scaledWidth/this.pixelRatio},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"halfDrawWidth",{get:function(){return this.drawWidth/2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"drawHeight",{get:function(){return this._camera?this.scaledHeight/this._camera.z/this.pixelRatio:this.scaledHeight/this.pixelRatio},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"halfDrawHeight",{get:function(){return this.drawHeight/2},enumerable:!1,configurable:!0}),t.prototype._applyDisplayMode=function(){if(this.displayMode===Vt.FullScreen||this.displayMode===Vt.Container){var t=this.displayMode===Vt.Container?this.canvas.parentElement||document.body:window;this._setHeightByDisplayMode(t),this._browser.window.on("resize",this._windowResizeHandler)}else this.displayMode===Vt.Position&&this._initializeDisplayModePosition(this._position)},t.prototype._setHeightByDisplayMode=function(t){this.displayMode===Vt.Container&&(this.resolution={width:t.clientWidth,height:t.clientHeight},this.viewport=this.resolution),this.displayMode===Vt.FullScreen&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.resolution={width:t.innerWidth,height:t.innerHeight},this.viewport=this.resolution)},t.prototype._initializeDisplayModePosition=function(t){if(!t)throw new Error("DisplayMode of Position was selected but no position option was given");if(this.canvas.style.display="block",this.canvas.style.position="absolute","string"==typeof t){var e=t.split(" ");switch(e[0]){case"top":this.canvas.style.top="0px";break;case"bottom":this.canvas.style.bottom="0px";break;case"middle":this.canvas.style.top="50%";var n=-this.halfDrawHeight;this.canvas.style.marginTop=n.toString();break;default:throw new Error("Invalid Position Given")}if(e[1])switch(e[1]){case"left":this.canvas.style.left="0px";break;case"right":this.canvas.style.right="0px";break;case"center":this.canvas.style.left="50%";var i=-this.halfDrawWidth;this.canvas.style.marginLeft=i.toString();break;default:throw new Error("Invalid Position Given")}}else t.top&&("number"==typeof t.top?this.canvas.style.top=t.top.toString()+"px":this.canvas.style.top=t.top),t.right&&("number"==typeof t.right?this.canvas.style.right=t.right.toString()+"px":this.canvas.style.right=t.right),t.bottom&&("number"==typeof t.bottom?this.canvas.style.bottom=t.bottom.toString()+"px":this.canvas.style.bottom=t.bottom),t.left&&("number"==typeof t.left?this.canvas.style.left=t.left.toString()+"px":this.canvas.style.left=t.left)},t}(),ee=function(){function t(t){this._handlers={},this._wiredEventDispatchers=[],this._target=t}return t.prototype.clear=function(){this._handlers={},this._wiredEventDispatchers=[]},t.prototype.emit=function(t,e){if(t){t=t.toLowerCase();var n,i,r=this._target;if(e||(e=new ht),e.target=r,this._handlers[t])for(n=0,i=this._handlers[t].length;n<i;n++)this._handlers[t][n].call(r,e);for(n=0,i=this._wiredEventDispatchers.length;n<i;n++)this._wiredEventDispatchers[n].emit(t,e)}},t.prototype.on=function(t,e){t=t.toLowerCase(),this._handlers[t]||(this._handlers[t]=[]),this._handlers[t].push(e),"unsubscribe"!==t&&"subscribe"!==t&&this.emit("subscribe",new Ot(t,e))},t.prototype.off=function(t,e){t=t.toLowerCase();var n=this._handlers[t];if(n)if(e){var i=n.indexOf(e);this._handlers[t].splice(i,1)}else this._handlers[t].length=0;"unsubscribe"!==t&&"subscribe"!==t&&this.emit("unsubscribe",new Tt(t,e))},t.prototype.once=function(t,e){var n=this;this.on(t,(function(i){var r=i||new ht;r.target=r.target||n._target,n.off(t,e),e.call(r.target,r)}))},t.prototype.wire=function(t){t._wiredEventDispatchers.push(this)},t.prototype.unwire=function(t){var e=t._wiredEventDispatchers.indexOf(this);e>-1&&t._wiredEventDispatchers.splice(e,1)},t}(),ne=function(){function t(){this.eventDispatcher=new ee(this)}return t.prototype.on=function(t,e){this.eventDispatcher.on(t,e)},t.prototype.off=function(t,e){this.eventDispatcher.off(t,e)},t.prototype.emit=function(t,e){this.eventDispatcher.emit(t,e)},t.prototype.once=function(t,e){this.eventDispatcher.once(t,e)},t}(),ie=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),re=function(t){function e(e,n,i){void 0===i&&(i=!0);var r=t.call(this)||this;return r.path=e,r.responseType=n,r.bustCache=i,r.data=null,r.logger=k.getInstance(),r.arrayBuffer=null,r.onprogress=function(){},r.oncomplete=function(){},r.onerror=function(){},r}return ie(e,t),e.prototype.isLoaded=function(){return null!==this.data},e.prototype.wireEngine=function(t){},e.prototype._cacheBust=function(t){return/\?\w*=\w*/.test(t)?t+="&__="+Date.now():t+="?__="+Date.now(),t},e.prototype._start=function(){this.logger.debug("Started loading resource "+this.path)},e.prototype.load=function(){var t=this,e=new d;if(null!==this.data)return this.logger.debug("Already have data for resource",this.path),e.resolve(this.data),this.oncomplete(),e;var n=new XMLHttpRequest;return n.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),n.responseType=this.responseType,n.onloadstart=function(){t._start()},n.onprogress=this.onprogress,n.onerror=this.onerror,n.onload=function(){if(0!==n.status&&200!==n.status)return t.logger.error("Failed to load resource ",t.path," server responded with error code",n.status),t.onerror(n.response),void e.resolve(n.response);t.data=t.processData(n.response),t.oncomplete(),t.logger.debug("Completed loading resource",t.path),e.resolve(t.data)},n.send(),e},e.prototype.getData=function(){return this.data},e.prototype.getArrayData=function(){return this.arrayBuffer},e.prototype.setData=function(t){this.data=this.processData(t)},e.prototype.processData=function(t){return"blob"===this.responseType?URL.createObjectURL(t):t},e}(ne),oe=function(){function t(){}return t.prototype.updatePixel=function(t,e,n){var i=4*(t+e*n.width),r=n.data,o=(r[i+0]+r[i+1]+r[i+2])/3;r[i+0]=o,r[i+1]=o,r[i+2]=o},t}(),se=function(){function t(){}return t.prototype.updatePixel=function(t,e,n){var i=4*(t+e*n.width),r=n.data;r[i+0]=255-r[i+0],r[i+1]=255-r[i+1],r[i+2]=255-r[i+2]},t}(),ae=function(){function t(t){this.opacity=t}return t.prototype.updatePixel=function(t,e,n){var i=4*(t+e*n.width),r=n.data;0!==r[i+3]&&(r[i+3]=Math.round(this.opacity*r[i+3]))},t}(),ce=function(){function t(t){this.color=t}return t.prototype.updatePixel=function(t,e,n){var i=4*(t+e*n.width),r=n.data;0!==r[i+3]&&(r[i+0]=(r[i+0]+this.color.r)/2,r[i+1]=(r[i+1]+this.color.g)/2,r[i+2]=(r[i+2]+this.color.b)/2)},t}(),ue=function(){function t(t){void 0===t&&(t=.1),this.factor=t}return t.prototype.updatePixel=function(t,e,n){var i=4*(t+e*n.width),r=n.data,o=nt.fromRGB(r[i+0],r[i+1],r[i+2],r[i+3]).lighten(this.factor);r[i+0]=o.r,r[i+1]=o.g,r[i+2]=o.b,r[i+3]=o.a},t}(),he=function(){function t(t){void 0===t&&(t=.1),this.factor=t}return t.prototype.updatePixel=function(t,e,n){var i=4*(t+e*n.width),r=n.data,o=nt.fromRGB(r[i+0],r[i+1],r[i+2],r[i+3]).darken(this.factor);r[i+0]=o.r,r[i+1]=o.g,r[i+2]=o.b,r[i+3]=o.a},t}(),le=function(){function t(t){void 0===t&&(t=.1),this.factor=t}return t.prototype.updatePixel=function(t,e,n){var i=4*(t+e*n.width),r=n.data,o=nt.fromRGB(r[i+0],r[i+1],r[i+2],r[i+3]).saturate(this.factor);r[i+0]=o.r,r[i+1]=o.g,r[i+2]=o.b,r[i+3]=o.a},t}(),pe=function(){function t(t){void 0===t&&(t=.1),this.factor=t}return t.prototype.updatePixel=function(t,e,n){var i=4*(t+e*n.width),r=n.data,o=nt.fromRGB(r[i+0],r[i+1],r[i+2],r[i+3]).desaturate(this.factor);r[i+0]=o.r,r[i+1]=o.g,r[i+2]=o.b,r[i+3]=o.a},t}(),fe=function(){function t(t){this.color=t}return t.prototype.updatePixel=function(t,e,n){var i=4*(t+e*n.width),r=n.data;0!==r[i+3]&&(r[i+0]=this.color.r,r[i+1]=this.color.g,r[i+2]=this.color.b)},t}(),de=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();function ye(t){return function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i=t.apply(this,e)||this,r=e.filter((function(t){return void 0!==t})).length;return 1!==r||!e[0]||"object"!=typeof e[0]||e[0]instanceof Array||i.assign(e[0]),i}return de(e,t),e.prototype.assign=function(t){for(var e in t)"function"!=typeof this[e]&&(this[e]=t[e])},e}(t)}var ge,_e=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),ve=function(){return(ve=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},me=function(t){function e(e,n,i,r,o){return t.call(this,e,n,i,r,o)||this}return _e(e,t),e}(ye(function(){function t(t,e,n,i,r){var o=this;this.x=0,this.y=0,this.rotation=0,this.anchor=new V(0,0),this.offset=V.Zero,this.scale=V.One,this.logger=k.getInstance(),this.flipVertical=!1,this.flipHorizontal=!1,this.effects=[],this.width=0,this.height=0,this._spriteCanvas=null,this._spriteCtx=null,this._pixelData=null,this._pixelsLoaded=!1,this._dirtyEffect=!1,this._opacity=1;var s=t;if(t&&!(t instanceof we)&&(e=0|t.x,n=0|t.y,i=0|t.width,r=0|t.height,!(s=t.image))){throw new Error("An image texture is required to contsruct a sprite")}this.x=e||0,this.y=n||0,this._texture=s,this._spriteCanvas=document.createElement("canvas"),this._spriteCanvas.width=i,this._spriteCanvas.height=r,this._spriteCtx=this._spriteCanvas.getContext("2d"),this._texture.loaded.then((function(){o.width=o.width||o._texture.image.naturalWidth,o.height=o.height||o._texture.image.naturalHeight,o._spriteCanvas.width=o._spriteCanvas.width||o._texture.image.naturalWidth,o._spriteCanvas.height=o._spriteCanvas.height||o._texture.image.naturalHeight,o._loadPixels(),o._dirtyEffect=!0})).error((function(t){o.logger.error("Error loading texture ",o._texture.path,t)})),this.width=i,this.height=r}return Object.defineProperty(t.prototype,"drawWidth",{get:function(){return this.width*this.scale.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"drawHeight",{get:function(){return this.height*this.scale.y},enumerable:!1,configurable:!0}),t.prototype._loadPixels=function(){if(this._texture.isLoaded()&&!this._pixelsLoaded){var t=this._texture.image.naturalWidth||0,e=this._texture.image.naturalHeight||0;if(this.width>t&&this.logger.warn("The sprite width "+this.width+" exceeds the width \n                              "+t+" of the backing texture "+this._texture.path),this.width<=0||t<=0)throw new Error("The width of a sprite cannot be 0 or negative, sprite width: "+this.width+", original width: "+t);if(this.height>e&&this.logger.warn("The sprite height "+this.height+" exceeds the height \n                              "+e+" of the backing texture "+this._texture.path),this.height<=0||e<=0)throw new Error("The height of a sprite cannot be 0 or negative, sprite height: "+this.height+", original height: "+e);this._spriteCtx.drawImage(this._texture.image,b(this.x,0,t),b(this.y,0,e),b(this.width,0,t),b(this.height,0,e),0,0,this.width,this.height),this._pixelsLoaded=!0}},t.prototype.opacity=function(t){this._opacity=t},t.prototype.grayscale=function(){this.addEffect(new oe)},t.prototype.invert=function(){this.addEffect(new se)},t.prototype.fill=function(t){this.addEffect(new fe(t))},t.prototype.colorize=function(t){this.addEffect(new ce(t))},t.prototype.lighten=function(t){void 0===t&&(t=.1),this.addEffect(new ue(t))},t.prototype.darken=function(t){void 0===t&&(t=.1),this.addEffect(new he(t))},t.prototype.saturate=function(t){void 0===t&&(t=.1),this.addEffect(new le(t))},t.prototype.desaturate=function(t){void 0===t&&(t=.1),this.addEffect(new pe(t))},t.prototype.addEffect=function(t){this.effects.push(t),this._texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0},t.prototype.removeEffect=function(t){var e=-1;(e="number"==typeof t?t:this.effects.indexOf(t))<0||e>=this.effects.length||(this.effects.splice(e,1),this._texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0)},t.prototype._applyEffects=function(){var t=this._texture.image.naturalWidth||0,e=this._texture.image.naturalHeight||0;if(this._spriteCtx.clearRect(0,0,this.width,this.height),this._spriteCtx.drawImage(this._texture.image,b(this.x,0,t),b(this.y,0,e),b(this.width,0,t),b(this.height,0,e),0,0,this.width,this.height),this.effects.length>0){this._pixelData=this._spriteCtx.getImageData(0,0,this.width,this.height);for(var n=this.effects.length,i=0;i<n;i++)for(var r=0;r<this.height;r++)for(var o=0;o<this.width;o++)this.effects[i].updatePixel(o,r,this._pixelData);this._spriteCtx.clearRect(0,0,this.width,this.height),this._spriteCtx.putImageData(this._pixelData,0,0)}this._dirtyEffect=!1},t.prototype.clearEffects=function(){this.effects.length=0,this._applyEffects()},t.prototype.reset=function(){},t.prototype.debugDraw=function(t,e,n){t.save(),t.translate(e,n),t.rotate(this.rotation);var i=this.drawWidth*this.anchor.x,r=this.drawHeight*this.anchor.y;t.strokeStyle=nt.Black.toString(),t.strokeRect(-i,-r,this.drawWidth,this.drawHeight),t.restore()},t.prototype.draw=function(t,e,n){t instanceof CanvasRenderingContext2D?this._drawWithOptions({ctx:t,x:e,y:n}):this._drawWithOptions(t)},t.prototype._drawWithOptions=function(t){var e,n,i,r,o,s,a,c,u=ve(ve({},t),{rotation:null!==(e=t.rotation)&&void 0!==e?e:this.rotation,drawWidth:null!==(n=t.drawWidth)&&void 0!==n?n:this.drawWidth,drawHeight:null!==(i=t.drawHeight)&&void 0!==i?i:this.drawHeight,flipHorizontal:null!==(r=t.flipHorizontal)&&void 0!==r?r:this.flipHorizontal,flipVertical:null!==(o=t.flipVertical)&&void 0!==o?o:this.flipVertical,anchor:null!==(s=t.anchor)&&void 0!==s?s:this.anchor,offset:null!==(a=t.offset)&&void 0!==a?a:this.offset,opacity:null!==(c=t.opacity)&&void 0!==c?c:this._opacity}),h=u.ctx,l=u.x,p=u.y,f=u.rotation,d=u.drawWidth,y=u.drawHeight,g=u.anchor,_=u.offset,v=u.opacity,m=u.flipHorizontal,b=u.flipVertical;this._dirtyEffect&&this._applyEffects(),h.save();var w=d*g.x+_.x,x=y*g.y+_.y;h.translate(l,p),h.rotate(f),m&&(h.translate(d,0),h.scale(-1,1)),b&&(h.translate(0,y),h.scale(1,-1)),this._dirtyEffect&&this._applyEffects();var P=h.globalAlpha;h.globalAlpha=null!=v?v:1,h.drawImage(this._spriteCanvas,0,0,this.width,this.height,-w,-x,d,y),h.globalAlpha=P,h.restore()},t.prototype.clone=function(){var t=new me(this._texture,this.x,this.y,this.width,this.height);t.scale=this.scale.clone(),t.rotation=this.rotation,t.flipHorizontal=this.flipHorizontal,t.flipVertical=this.flipVertical;for(var e=this.effects.length,n=0;n<e;n++)t.addEffect(this.effects[n]);return t},t}())),be=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),we=function(t){function e(e,n){void 0===n&&(n=!0);var i=t.call(this,e,"blob",n)||this;return i.path=e,i.bustCache=n,i.loaded=new d,i._isLoaded=!1,i._sprite=null,i._sprite=new me(i,0,0,0,0),i}return be(e,t),e.prototype.isLoaded=function(){return this._isLoaded},e.prototype.load=function(){var e=this,n=new d;this.path.indexOf("data:image/")>-1?(this.image=new Image,this.image.addEventListener("load",(function(){e.oncomplete(),e._isLoaded=!0,e.width=e._sprite.width=e.image.naturalWidth,e.height=e._sprite.height=e.image.naturalHeight,e._sprite=new me(e,0,0,e.width,e.height),e.loaded.resolve(e.image),n.resolve(e.image)})),this.image.src=this.path):t.prototype.load.call(this).then((function(){e.image=new Image,e.image.addEventListener("load",(function(){e._isLoaded=!0,e.width=e._sprite.width=e.image.naturalWidth,e.height=e._sprite.height=e.image.naturalHeight,e.loaded.resolve(e.image),n.resolve(e.image)})),e.image.src=t.prototype.getData.call(e)}),(function(){n.reject("Error loading texture.")}));return n},e.prototype.asSprite=function(){return this._sprite},e}(re),xe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Pe=function(){return(Pe=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},Ae=function(t){function e(e,n,i,r){return t.call(this,e,n,i,r)||this}return xe(e,t),e}(ye(function(){function t(t,e,n,i){this.sprites=[],this.currentFrame=0,this._timeLeftInFrame=0,this._idempotencyToken=-1,this.anchor=V.Zero,this.rotation=0,this.scale=V.One,this.loop=!0,this.freezeFrame=-1,this.flipVertical=!1,this.flipHorizontal=!1,this.drawWidth=0,this.drawHeight=0,this.width=0,this.height=0,this._opacity=1;var r=t;if(t&&!(t instanceof vr)){var o=t;r=o.engine,e=o.sprites,n=o.speed,i=o.loop}this.sprites=e,this.speed=n,this._engine=r,this._timeLeftInFrame=this.speed,null!=i&&(this.loop=i),e&&e[0]&&(this.drawHeight=e[0]?e[0].drawHeight:0,this.drawWidth=e[0]?e[0].drawWidth:0,this.width=e[0]?e[0].width:0,this.height=e[0]?e[0].height:0,this.freezeFrame=e.length-1)}return t.prototype.opacity=function(t){this._opacity=t},t.prototype.grayscale=function(){this.addEffect(new oe)},t.prototype.invert=function(){this.addEffect(new se)},t.prototype.fill=function(t){this.addEffect(new fe(t))},t.prototype.colorize=function(t){this.addEffect(new ce(t))},t.prototype.lighten=function(t){void 0===t&&(t=.1),this.addEffect(new ue(t))},t.prototype.darken=function(t){void 0===t&&(t=.1),this.addEffect(new he(t))},t.prototype.saturate=function(t){void 0===t&&(t=.1),this.addEffect(new le(t))},t.prototype.desaturate=function(t){void 0===t&&(t=.1),this.addEffect(new pe(t))},t.prototype.addEffect=function(t){for(var e in this.sprites)this.sprites[e].addEffect(t)},t.prototype.removeEffect=function(t){for(var e in this.sprites)this.sprites[e].removeEffect(t)},t.prototype.clearEffects=function(){for(var t in this.sprites)this.sprites[t].clearEffects()},t.prototype._setAnchor=function(t){for(var e in this.sprites)this.sprites[e].anchor.setTo(t.x,t.y)},t.prototype._setRotation=function(t){for(var e in this.sprites)this.sprites[e].rotation=t},t.prototype._setScale=function(t){for(var e in this.sprites)this.sprites[e].scale=t},t.prototype.reset=function(){this.currentFrame=0},t.prototype.isDone=function(){return!this.loop&&this.currentFrame>=this.sprites.length},t.prototype.tick=function(t,e){if(this._idempotencyToken!==e){this._idempotencyToken=e,this._timeLeftInFrame-=t,this._timeLeftInFrame<=0&&(this.currentFrame=this.loop?(this.currentFrame+1)%this.sprites.length:this.currentFrame+1,this._timeLeftInFrame=this.speed),this._updateValues();var n=this.sprites[this.currentFrame];n&&(this.width=n.width,this.height=n.height,this.drawWidth=n.drawWidth,this.drawHeight=n.drawHeight)}},t.prototype._updateValues=function(){this._setAnchor(this.anchor),this._setRotation(this.rotation),this._setScale(this.scale)},t.prototype.skip=function(t){this.currentFrame=(this.currentFrame+t)%this.sprites.length},t.prototype.draw=function(t,e,n){t instanceof CanvasRenderingContext2D?this._drawWithOptions({ctx:t,x:e,y:n}):this._drawWithOptions(t)},t.prototype._drawWithOptions=function(t){var e,n,i,r,o,s,a,c,u=Pe(Pe({},t),{rotation:null!==(e=t.rotation)&&void 0!==e?e:this.rotation,drawWidth:null!==(n=t.drawWidth)&&void 0!==n?n:this.drawWidth,drawHeight:null!==(i=t.drawHeight)&&void 0!==i?i:this.drawHeight,flipHorizontal:null!==(r=t.flipHorizontal)&&void 0!==r?r:this.flipHorizontal,flipVertical:null!==(o=t.flipVertical)&&void 0!==o?o:this.flipVertical,anchor:null!==(s=t.anchor)&&void 0!==s?s:this.anchor,opacity:null!==(a=t.opacity)&&void 0!==a?a:this._opacity});this._updateValues(),this.currentFrame<this.sprites.length&&(c=this.sprites[this.currentFrame]).draw(u),-1!==this.freezeFrame&&this.currentFrame>=this.sprites.length&&(c=this.sprites[b(this.freezeFrame,0,this.sprites.length-1)]).draw(u),c&&(this.drawWidth=c.drawWidth,this.drawHeight=c.drawHeight)},t.prototype.play=function(t,e){this.reset(),this._engine.playAnimation(this,t,e)},t}()));!function(t){t[t.ShortestPath=0]="ShortestPath",t[t.LongestPath=1]="LongestPath",t[t.Clockwise=2]="Clockwise",t[t.CounterClockwise=3]="CounterClockwise"}(ge||(ge={}));var Se=function(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},Ee=function(){function t(t,e,n,i,r){this.actor=t,this.easingFcn=r,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=new V(0,0),this._lerpEnd=new V(0,0),this._initialized=!1,this._stopped=!1,this._distance=0,this._lerpDuration=i,this._lerpEnd=new V(e,n)}return t.prototype._initialize=function(){this._lerpStart=new V(this.actor.pos.x,this.actor.pos.y),this._currentLerpTime=0,this._distance=this._lerpStart.distance(this._lerpEnd)},t.prototype.update=function(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;var e=this.actor.pos.x,n=this.actor.pos.y;this._currentLerpTime<this._lerpDuration?(e=this._lerpEnd.x<this._lerpStart.x?this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),n=this._lerpEnd.y<this._lerpStart.y?this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this.actor.vel.x=(e-this.actor.pos.x)/(t/1e3),this.actor.vel.y=(n-this.actor.pos.y)/(t/1e3)):(this.actor.pos.x=this._lerpEnd.x,this.actor.pos.y=this._lerpEnd.y,this.actor.vel=V.Zero)},t.prototype.isComplete=function(t){return this._stopped||new V(t.pos.x,t.pos.y).distance(this._lerpStart)>=this._distance},t.prototype.reset=function(){this._initialized=!1},t.prototype.stop=function(){this.actor.vel.y=0,this.actor.vel.x=0,this._stopped=!0},t}(),Ce=function(){function t(t,e,n,i){this._started=!1,this._stopped=!1,this._actor=t,this._end=new V(e,n),this._speed=i}return t.prototype.update=function(t){this._started||(this._started=!0,this._start=new V(this._actor.pos.x,this._actor.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());var e=this._dir.scale(this._speed);this._actor.vel.x=e.x,this._actor.vel.y=e.y,this.isComplete(this._actor)&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},t.prototype.isComplete=function(t){return this._stopped||new V(t.pos.x,t.pos.y).distance(this._start)>=this._distance},t.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}(),Oe=function(){function t(t,e,n,i){if(this._started=!1,this._stopped=!1,this._actor=t,this._speed=i,this._offset=new V(e,n),i<=0)throw k.getInstance().error("Attempted to moveBy with speed less than or equal to zero : "+i),new Error("Speed must be greater than 0 pixels per second")}return t.prototype.update=function(t){this._started||(this._started=!0,this._start=new V(this._actor.pos.x,this._actor.pos.y),this._end=this._start.add(this._offset),this._distance=this._offset.size,this._dir=this._end.sub(this._start).normalize()),this._actor.vel=this._dir.scale(this._speed),this.isComplete(this._actor)&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},t.prototype.isComplete=function(t){return this._stopped||t.pos.distance(this._start)>=this._distance},t.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}(),Te=function(){function t(t,e,n){this._started=!1,this._stopped=!1,this._actor=t,this._actorToFollow=e,this._current=new V(this._actor.pos.x,this._actor.pos.y),this._end=new V(e.pos.x,e.pos.y),this._maximumDistance=void 0!==n?n:this._current.distance(this._end),this._speed=0}return t.prototype.update=function(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());var e=Math.sqrt(Math.pow(this._actorToFollow.vel.x,2)+Math.pow(this._actorToFollow.vel.y,2));if(0!==e&&(this._speed=e),this._current.x=this._actor.pos.x,this._current.y=this._actor.pos.y,this._end.x=this._actorToFollow.pos.x,this._end.y=this._actorToFollow.pos.y,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){var n=this._dir.scale(this._speed);this._actor.vel.x=n.x,this._actor.vel.y=n.y}else this._actor.vel.x=0,this._actor.vel.y=0;this.isComplete()&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},t.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},t.prototype.isComplete=function(){return this._stopped},t.prototype.reset=function(){this._started=!1},t}(),Be=function(){function t(t,e,n){this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._actor=t,this._actorToMeet=e,this._current=new V(this._actor.pos.x,this._actor.pos.y),this._end=new V(e.pos.x,e.pos.y),this._speed=n||0,void 0!==n&&(this._speedWasSpecified=!0)}return t.prototype.update=function(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());var e=Math.sqrt(Math.pow(this._actorToMeet.vel.x,2)+Math.pow(this._actorToMeet.vel.y,2));0===e||this._speedWasSpecified||(this._speed=e),this._current.x=this._actor.pos.x,this._current.y=this._actor.pos.y,this._end.x=this._actorToMeet.pos.x,this._end.y=this._actorToMeet.pos.y,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();var n=this._dir.scale(this._speed);this._actor.vel.x=n.x,this._actor.vel.y=n.y,this.isComplete()&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},t.prototype.isComplete=function(){return this._stopped||this._distanceBetween<=1},t.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}(),De=function(){function t(t,e,n,i){this._started=!1,this._stopped=!1,this._actor=t,this._end=e,this._speed=n,this._rotationType=i||ge.ShortestPath}return t.prototype.update=function(t){if(!this._started){this._started=!0,this._start=this._actor.rotation;var e=Math.abs(this._end-this._start),n=g-e;switch(e>n?(this._shortDistance=n,this._longDistance=e):(this._shortDistance=e,this._longDistance=n),this._shortestPathIsPositive=(this._start-this._end+g)%g>=Math.PI,this._rotationType){case ge.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case ge.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case ge.Clockwise:this._direction=1,this._shortestPathIsPositive?this._distance=this._shortDistance:this._distance=this._longDistance;break;case ge.CounterClockwise:this._direction=-1,this._shortestPathIsPositive?this._distance=this._longDistance:this._distance=this._shortDistance}}this._actor.rx=this._direction*this._speed,this.isComplete()&&(this._actor.rotation=this._end,this._actor.rx=0,this._stopped=!0)},t.prototype.isComplete=function(){var t=Math.abs(this._actor.rotation-this._start);return this._stopped||t>=Math.abs(this._distance)},t.prototype.stop=function(){this._actor.rx=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}(),Me=function(){function t(t,e,n,i){this._started=!1,this._stopped=!1,this._actor=t,this._speed=n,this._offset=e,this._rotationType=i||ge.ShortestPath}return t.prototype.update=function(t){if(!this._started){this._started=!0,this._start=this._actor.rotation,this._end=this._start+this._offset;var e=Math.abs(this._end-this._start),n=g-e;switch(e>n?(this._shortDistance=n,this._longDistance=e):(this._shortDistance=e,this._longDistance=n),this._shortestPathIsPositive=(this._start-this._end+g)%g>=Math.PI,this._rotationType){case ge.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case ge.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case ge.Clockwise:this._direction=1,this._shortDistance>=0?this._distance=this._shortDistance:this._distance=this._longDistance;break;case ge.CounterClockwise:this._direction=-1,this._shortDistance<=0?this._distance=this._shortDistance:this._distance=this._longDistance}}this._actor.rx=this._direction*this._speed,this.isComplete()&&(this._actor.rotation=this._end,this._actor.rx=0,this._stopped=!0)},t.prototype.isComplete=function(){var t=Math.abs(this._actor.rotation-this._start);return this._stopped||t>=Math.abs(this._distance)},t.prototype.stop=function(){this._actor.rx=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}(),je=function(){function t(t,e,n,i,r){this._started=!1,this._stopped=!1,this._actor=t,this._endX=e,this._endY=n,this._speedX=i,this._speedY=r}return t.prototype.update=function(t){if(this._started||(this._started=!0,this._startX=this._actor.scale.x,this._startY=this._actor.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._actor.scale.x-this._startX)>=this._distanceX)this._actor.sx=0;else{var e=this._endY<this._startY?-1:1;this._actor.sx=this._speedX*e}if(Math.abs(this._actor.scale.y-this._startY)>=this._distanceY)this._actor.sy=0;else{var n=this._endY<this._startY?-1:1;this._actor.sy=this._speedY*n}this.isComplete()&&(this._actor.scale.x=this._endX,this._actor.scale.y=this._endY,this._actor.sx=0,this._actor.sy=0)},t.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.scale.y-this._startX)>=this._distanceX&&Math.abs(this._actor.scale.y-this._startY)>=this._distanceY},t.prototype.stop=function(){this._actor.sx=0,this._actor.sy=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t=Se([q({message:"ex.Action.ScaleTo will be removed in v0.25.0",alternateMethod:"Set width and hight directly"})],t)}(),Re=function(){function t(t,e,n,i){this._started=!1,this._stopped=!1,this._actor=t,this._offset=new V(e,n),this._speedX=this._speedY=i}return t.prototype.update=function(t){this._started||(this._started=!0,this._startScale=this._actor.scale.clone(),this._endScale=this._startScale.add(this._offset),this._distanceX=Math.abs(this._endScale.x-this._startScale.x),this._distanceY=Math.abs(this._endScale.y-this._startScale.y),this._directionX=this._endScale.x<this._startScale.x?-1:1,this._directionY=this._endScale.y<this._startScale.y?-1:1),this._actor.sx=this._speedX*this._directionX,this._actor.sy=this._speedY*this._directionY,this.isComplete()&&(this._actor.scale=this._endScale,this._actor.sx=0,this._actor.sy=0)},t.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.scale.x-this._startScale.x)>=this._distanceX&&Math.abs(this._actor.scale.y-this._startScale.y)>=this._distanceY},t.prototype.stop=function(){this._actor.sx=0,this._actor.sy=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t=Se([q({message:"ex.Action.ScaleBy will be removed in v0.25.0",alternateMethod:"Set width and hight directly"})],t)}(),ke=function(){function t(t,e){this._elapsedTime=0,this._started=!1,this._stopped=!1,this._actor=t,this._delay=e}return t.prototype.update=function(t){this._started||(this._started=!0),this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._elapsedTime+=t},t.prototype.isComplete=function(){return this._stopped||this._elapsedTime>=this._delay},t.prototype.stop=function(){this._stopped=!0},t.prototype.reset=function(){this._elapsedTime=0,this._started=!1},t}(),Fe=function(){function t(t,e,n,i){void 0===i&&(i=1),this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._actor=t,this._timeVisible=e,this._timeNotVisible=n,this._duration=(e+n)*i}return t.prototype.update=function(t){this._started||(this._started=!0),this._elapsedTime+=t,this._totalTime+=t,this._actor.visible&&this._elapsedTime>=this._timeVisible&&(this._actor.visible=!1,this._elapsedTime=0),!this._actor.visible&&this._elapsedTime>=this._timeNotVisible&&(this._actor.visible=!0,this._elapsedTime=0),this.isComplete()&&(this._actor.visible=!0)},t.prototype.isComplete=function(){return this._stopped||this._totalTime>=this._duration},t.prototype.stop=function(){this._actor.visible=!0,this._stopped=!0},t.prototype.reset=function(){this._started=!1,this._elapsedTime=0,this._totalTime=0},t}(),Ie=function(){function t(t,e,n){this._multiplier=1,this._started=!1,this._stopped=!1,this._actor=t,this._endOpacity=e,this._speed=n}return t.prototype.update=function(t){this._started||(this._started=!0,this._endOpacity<this._actor.opacity?this._multiplier=-1:this._multiplier=1),this._speed>0&&(this._actor.opacity+=this._multiplier*(Math.abs(this._actor.opacity-this._endOpacity)*t)/this._speed),this._speed-=t,this.isComplete()&&(this._actor.opacity=this._endOpacity),k.getInstance().debug("[Action fade] Actor opacity:",this._actor.opacity)},t.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.opacity-this._endOpacity)<.05},t.prototype.stop=function(){this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}(),Le=function(){function t(t){this._stopped=!1,this._actor=t}return t.prototype.update=function(t){this._actor.actionQueue.clearActions(),this._actor.kill(),this._stopped=!0},t.prototype.isComplete=function(){return this._stopped},t.prototype.stop=function(){},t.prototype.reset=function(){},t}(),Ue=function(){function t(t,e){this._method=null,this._actor=null,this._hasBeenCalled=!1,this._actor=t,this._method=e}return t.prototype.update=function(t){this._method.call(this._actor),this._hasBeenCalled=!0},t.prototype.isComplete=function(){return this._hasBeenCalled},t.prototype.reset=function(){this._hasBeenCalled=!1},t.prototype.stop=function(){this._hasBeenCalled=!0},t}(),ze=function(){function t(t,e,n){this._stopped=!1,this._actor=t,this._actionQueue=new We(t),this._repeat=e,this._originalRepeat=e;for(var i=n.length,r=0;r<i;r++)n[r].reset(),this._actionQueue.add(n[r])}return t.prototype.update=function(t){this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._actionQueue.hasNext()||(this._actionQueue.reset(),this._repeat--),this._actionQueue.update(t)},t.prototype.isComplete=function(){return this._stopped||this._repeat<=0},t.prototype.stop=function(){this._stopped=!0},t.prototype.reset=function(){this._repeat=this._originalRepeat},t}(),Ne=function(){function t(t,e){this._stopped=!1,this._actor=t,this._actionQueue=new We(t);for(var n=e.length,i=0;i<n;i++)e[i].reset(),this._actionQueue.add(e[i])}return t.prototype.update=function(t){this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._stopped||(this._actionQueue.hasNext()||this._actionQueue.reset(),this._actionQueue.update(t))},t.prototype.isComplete=function(){return this._stopped},t.prototype.stop=function(){this._stopped=!0,this._actionQueue.clearActions()},t.prototype.reset=function(){},t}(),We=function(){function t(t){this._actions=[],this._completedActions=[],this._actor=t}return t.prototype.add=function(t){this._actions.push(t)},t.prototype.remove=function(t){var e=this._actions.indexOf(t);this._actions.splice(e,1)},t.prototype.clearActions=function(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()},t.prototype.getActions=function(){return this._actions.concat(this._completedActions)},t.prototype.hasNext=function(){return this._actions.length>0},t.prototype.reset=function(){this._actions=this.getActions();for(var t=this._actions.length,e=0;e<t;e++)this._actions[e].reset();this._completedActions=[]},t.prototype.update=function(t){this._actions.length>0&&(this._currentAction=this._actions[0],this._currentAction.update(t),this._currentAction.isComplete(this._actor)&&this._completedActions.push(this._actions.shift()))},t}(),He=function(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},qe=function(){function t(){}return t.CreateReversibleEasingFunction=function(t){return function(e,n,i,r){return i<n?n-(t(e,i,n,r)-i):t(e,n,i,r)}},t.CreateReversableEasingFunction=function(e){return t.CreateReversibleEasingFunction(e)},t.CreateVectorEasingFunction=function(t){return function(e,n,i,r){return new V(t(e,n.x,i.x,r),t(e,n.y,i.y,r))}},t.Linear=t.CreateReversibleEasingFunction((function(t,e,n,i){return(n-=e)*t/i+e})),t.EaseInQuad=t.CreateReversibleEasingFunction((function(t,e,n,i){return(n-=e)*(t/=i)*t+e})),t.EaseOutQuad=t.CreateReversibleEasingFunction((function(t,e,n,i){return-(n-=e)*(t/=i)*(t-2)+e})),t.EaseInOutQuad=t.CreateReversibleEasingFunction((function(t,e,n,i){return n-=e,(t/=i/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e})),t.EaseInCubic=t.CreateReversibleEasingFunction((function(t,e,n,i){return(n-=e)*(t/=i)*t*t+e})),t.EaseOutCubic=t.CreateReversibleEasingFunction((function(t,e,n,i){return t/=i,(n-=e)*(--t*t*t+1)+e})),t.EaseInOutCubic=t.CreateReversibleEasingFunction((function(t,e,n,i){return n-=e,(t/=i/2)<1?n/2*t*t*t+e:n/2*((t-=2)*t*t+2)+e})),He([q({message:"Alias for incorrect spelling used in older versions, will be removed in v0.25.0",alternateMethod:"CreateReversibleEasingFunction"})],t,"CreateReversableEasingFunction",null),t}(),Ke=function(){function t(){this._actors=[],this._queues=[],null!==arguments&&(this._actors=Array.prototype.slice.call(arguments,0),this._queues=this._actors.map((function(t){return t.actionQueue})))}return t.prototype.clearActions=function(){for(var t=this._queues.length,e=0;e<t;e++)this._queues[e].clearActions()},t.prototype.addActorToContext=function(t){this._actors.push(t),this._queues.push(t.actionQueue)},t.prototype.removeActorFromContext=function(t){var e=this._actors.indexOf(t);e>-1&&(this._actors.splice(e,1),this._queues.splice(e,1))},t.prototype.easeTo=function(t,e,n,i){void 0===i&&(i=qe.Linear);for(var r=this._queues.length,o=0;o<r;o++)this._queues[o].add(new Ee(this._actors[o],t,e,n,i));return this},t.prototype.moveTo=function(t,e,n){for(var i=this._queues.length,r=0;r<i;r++)this._queues[r].add(new Ce(this._actors[r],t,e,n));return this},t.prototype.moveBy=function(t,e,n){for(var i=this._queues.length,r=0;r<i;r++)this._queues[r].add(new Oe(this._actors[r],t,e,n));return this},t.prototype.rotateTo=function(t,e,n){for(var i=this._queues.length,r=0;r<i;r++)this._queues[r].add(new De(this._actors[r],t,e,n));return this},t.prototype.rotateBy=function(t,e,n){for(var i=this._queues.length,r=0;r<i;r++)this._queues[r].add(new Me(this._actors[r],t,e,n));return this},t.prototype.scaleTo=function(t,e,n,i){for(var r=this._queues.length,o=0;o<r;o++)this._queues[o].add(new je(this._actors[o],t,e,n,i));return this},t.prototype.scaleBy=function(t,e,n){for(var i=this._queues.length,r=0;r<i;r++)this._queues[r].add(new Re(this._actors[r],t,e,n));return this},t.prototype.blink=function(t,e,n){void 0===n&&(n=1);for(var i=this._queues.length,r=0;r<i;r++)this._queues[r].add(new Fe(this._actors[r],t,e,n));return this},t.prototype.fade=function(t,e){for(var n=this._queues.length,i=0;i<n;i++)this._queues[i].add(new Ie(this._actors[i],t,e));return this},t.prototype.delay=function(t){for(var e=this._queues.length,n=0;n<e;n++)this._queues[n].add(new ke(this._actors[n],t));return this},t.prototype.die=function(){for(var t=this._queues.length,e=0;e<t;e++)this._queues[e].add(new Le(this._actors[e]));return this},t.prototype.callMethod=function(t){for(var e=this._queues.length,n=0;n<e;n++)this._queues[n].add(new Ue(this._actors[n],t));return this},t.prototype.repeat=function(t){if(!t)return this.repeatForever(),this;for(var e=this._queues.length,n=0;n<e;n++)this._queues[n].add(new ze(this._actors[n],t,this._actors[n].actionQueue.getActions()));return this},t.prototype.repeatForever=function(){for(var t=this._queues.length,e=0;e<t;e++)this._queues[e].add(new Ne(this._actors[e],this._actors[e].actionQueue.getActions()));return this},t.prototype.follow=function(t,e){for(var n=this._queues.length,i=0;i<n;i++)void 0===e?this._queues[i].add(new Te(this._actors[i],t)):this._queues[i].add(new Te(this._actors[i],t,e));return this},t.prototype.meet=function(t,e){for(var n=this._queues.length,i=0;i<n;i++)void 0===e?this._queues[i].add(new Be(this._actors[i],t)):this._queues[i].add(new Be(this._actors[i],t,e));return this},t.prototype.asPromise=function(){var t=this,e=this._queues.map((function(e,n){var i=new d;return e.add(new Ue(t._actors[n],(function(){i.resolve()}))),i}));return d.join.apply(this,e)},t}(),Ve=function(){function t(){}return t.Box=function(t,e,n,i){return void 0===n&&(n=V.Half),void 0===i&&(i=V.Zero),new Zt({points:new Yt(-t*n.x,-e*n.y,t-t*n.x,e-e*n.y).getPoints(),offset:i})},t.Polygon=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=V.Zero),new Zt({points:t,offset:n,clockwiseWinding:e})},t.Circle=function(t,e){return void 0===e&&(e=V.Zero),new Xt({radius:t,offset:e})},t.Edge=function(t,e){return new Qt({begin:t,end:e})},t}(),Ge=function(){function t(t){var e=t.actor,n=t.collider;if(this.oldPos=new V(0,0),this.vel=new V(0,0),this.oldVel=new V(0,0),this.acc=new V(0,0),this.oldAcc=V.Zero,this.torque=0,this.motion=10,this.oldRotation=0,this.scale=V.One,this.oldScale=V.One,this.sx=0,this.sy=0,this.rx=0,this._geometryDirty=!1,this._totalMtv=V.Zero,!e&&!n)throw new Error("An actor or collider are required to create a body");this.actor=e,this.collider=!n&&e?this.useBoxCollider(e.width,e.height,e.anchor):n}return Object.defineProperty(t.prototype,"id",{get:function(){return this.actor?this.actor.id:-1},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return new t({actor:null,collider:this.collider.clone()})},Object.defineProperty(t.prototype,"active",{get:function(){return!!this.actor&&!this.actor.isKilled()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"center",{get:function(){return this.pos},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collider",{get:function(){return this._collider},set:function(t){t&&(this._collider=t,this._collider.body=this,this._wireColliderEventsToActor())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return this.actor.components.transform},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pos",{get:function(){return this.transform.pos},set:function(t){this.transform.pos=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t},enumerable:!1,configurable:!0}),t.prototype.addMtv=function(t){this._totalMtv.addEqual(t)},t.prototype.applyMtv=function(){this.pos.addEqual(this._totalMtv),this._totalMtv.setTo(0,0)},t.prototype.markCollisionShapeDirty=function(){this._geometryDirty=!0},Object.defineProperty(t.prototype,"isColliderShapeDirty",{get:function(){return this._geometryDirty},enumerable:!1,configurable:!0}),t.prototype.captureOldTransform=function(){this.oldVel.setTo(this.vel.x,this.vel.y),this.oldPos.setTo(this.pos.x,this.pos.y),this.oldAcc.setTo(this.acc.x,this.acc.y),this.oldScale.setTo(this.scale.x,this.scale.y),this.oldRotation=this.rotation},t.prototype.integrate=function(t){var e=t/1e3,n=this.acc.clone();this.collider.type===ut.Active&&n.addEqual(at.acc),this.vel.addEqual(n.scale(e)),this.pos.addEqual(this.vel.scale(e)).addEqual(n.scale(.5*e*e)),this.rx+=this.torque*(1/this.collider.inertia)*e,this.rotation+=this.rx*e,this.scale.x+=this.sx*t/1e3,this.scale.y+=this.sy*t/1e3,this.scale.equals(this.oldScale)||(this._geometryDirty=!0),this.collider.update(),this._geometryDirty=!1},t.prototype.useBoxCollider=function(t,e,n,i){return void 0===n&&(n=V.Half),void 0===i&&(i=V.Zero),null==t&&(t=this.actor?this.actor.width:0),null==e&&(e=this.actor?this.actor.height:0),this.collider.shape=Ve.Box(t,e,n,i),this.collider},t.prototype.usePolygonCollider=function(t,e){return void 0===e&&(e=V.Zero),this.collider.shape=Ve.Polygon(t,!1,e),this.collider},t.prototype.useCircleCollider=function(t,e){return void 0===e&&(e=V.Zero),this.collider.shape=Ve.Circle(t,e),this.collider},t.prototype.useEdgeCollider=function(t,e){return this.collider.shape=Ve.Edge(t,e),this.collider},t.prototype._wireColliderEventsToActor=function(){var t=this;this.collider.clear(),this.collider.on("precollision",(function(e){t.actor&&t.actor.emit("precollision",new Mt(e.target.body.actor,e.other.body.actor,e.side,e.intersection))})),this.collider.on("postcollision",(function(e){t.actor&&t.actor.emit("postcollision",new jt(e.target.body.actor,e.other.body.actor,e.side,e.intersection))})),this.collider.on("collisionstart",(function(e){t.actor&&t.actor.emit("collisionstart",new Rt(e.target.body.actor,e.other.body.actor,e.pair))})),this.collider.on("collisionend",(function(e){t.actor&&t.actor.emit("collisionend",new kt(e.target.body.actor,e.other.body.actor))}))},t}(),Xe=function(){function t(){}return t.prototype.update=function(t,e){var n=t.eventDispatcher;if(t.body.collider.type!==ut.PreventCollision&&e.currentScene&&e.currentScene.tileMaps)for(var i=0;i<e.currentScene.tileMaps.length;i++)for(var r=e.currentScene.tileMaps[i],o=void 0,s=f.None,a=2;(o=r.collides(t))&&!(a--<0);)s=Yt.getSideFromIntersection(o),n.emit("precollision",new Mt(t,null,s,o)),t.body.collider.type===ut.Active&&(t.pos.y+=o.y,t.pos.x+=o.x,n.emit("postcollision",new jt(t,null,s,o)))},t}(),Qe=function(){function t(){this._topLeft=new V(0,0),this._topRight=new V(0,0),this._bottomLeft=new V(0,0),this._bottomRight=new V(0,0)}return t.prototype.isSpriteOffScreen=function(t,e){var n=t.currentDrawing.drawWidth,i=t.currentDrawing.drawHeight,r=t.rotation,o=t.center,s=t.getWorldPos();this._topLeft.x=s.x-n/2,this._topLeft.y=s.y-i/2,this._topLeft=this._topLeft.rotate(r,o),this._topRight.x=s.x+n/2,this._topRight.y=s.y-i/2,this._topRight=this._topRight.rotate(r,o),this._bottomLeft.x=s.x-n/2,this._bottomLeft.y=s.y+i/2,this._bottomLeft=this._bottomLeft.rotate(r,o),this._bottomRight.x=s.x+n/2,this._bottomRight.y=s.y+i/2,this._bottomRight=this._bottomRight.rotate(r,o);var a=e.worldToScreenCoordinates(this._topLeft),c=e.worldToScreenCoordinates(this._topRight),u=e.worldToScreenCoordinates(this._bottomLeft),h=e.worldToScreenCoordinates(this._bottomRight);this._xCoords=[],this._yCoords=[],this._xCoords.push(a.x,c.x,u.x,h.x),this._yCoords.push(a.y,c.y,u.y,h.y),this._xMin=Math.min.apply(null,this._xCoords),this._yMin=Math.min.apply(null,this._yCoords),this._xMax=Math.max.apply(null,this._xCoords),this._yMax=Math.max.apply(null,this._yCoords);var l=e.screenToWorldCoordinates(new V(this._xMin,this._yMin)),p=e.screenToWorldCoordinates(new V(this._xMax,this._yMax));this._xMinWorld=l.x,this._yMinWorld=l.y,this._xMaxWorld=p.x,this._yMaxWorld=p.y;var f=[new V(this._xMin,this._yMin),new V(this._xMax,this._yMin),new V(this._xMin,this._yMax),new V(this._xMax,this._yMax)];if(f[0].x<0&&f[1].x>e.canvas.clientWidth&&(f[0].y>0||f[2].y<e.canvas.clientHeight))return!1;if(f[0].y<0&&f[2].y>e.canvas.clientHeight&&(f[1].x>0||f[0].x<e.canvas.clientWidth))return!1;for(var d=0;d<f.length;d++)if(f[d].x>0&&f[d].y>0&&f[d].x<e.canvas.clientWidth&&f[d].y<e.canvas.clientHeight)return!1;return!0},t.prototype.debugDraw=function(t){t.beginPath(),t.strokeStyle=nt.White.toString(),t.rect(this._xMinWorld,this._yMinWorld,this._xMaxWorld-this._xMinWorld,this._yMaxWorld-this._yMinWorld),t.stroke(),t.fillStyle=nt.Red.toString(),t.beginPath(),t.arc(this._topLeft.x,this._topLeft.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=nt.Green.toString(),t.beginPath(),t.arc(this._topRight.x,this._topRight.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=nt.Blue.toString(),t.beginPath(),t.arc(this._bottomLeft.x,this._bottomLeft.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=nt.Magenta.toString(),t.beginPath(),t.arc(this._bottomRight.x,this._bottomRight.y,5,0,2*Math.PI),t.closePath(),t.fill()},t}(),Ze=function(){function t(){this.cullingBox=new Qe}return t.prototype.update=function(t,e){var n=t.eventDispatcher,i=!0;null!=t.currentDrawing&&(i=this.cullingBox.isSpriteOffScreen(t,e));var r=!1;e&&e.currentScene&&e.currentScene.camera&&e.currentScene.camera.viewport&&!t.parent&&(r=!e.currentScene.camera.viewport.intersect(t.body.collider.bounds)),t.isOffScreen?r&&i||(n.emit("enterviewport",new zt(t)),t.isOffScreen=!1):r&&i&&(n.emit("exitviewport",new Ut(t)),t.isOffScreen=!0)},t}(),Ye=function(){function t(){}return t.prototype.update=function(t,e){t.enableCapturePointer&&(t.isKilled()||e.input.pointers.checkAndUpdateActorUnderPointer(t))},t}();function Je(t,e,n,i,r,o,s,a){void 0===e&&(e=nt.Red),void 0===s&&(s=1),void 0===a&&(a="butt"),t.beginPath(),t.lineWidth=s,t.lineCap=a,t.strokeStyle=e.toString(),t.moveTo(n,i),t.lineTo(r,o),t.closePath(),t.stroke()}function $e(t,e,n){void 0===e&&(e=nt.Red),t.beginPath(),t.strokeStyle=e.toString(),t.arc(n.x,n.y,5,0,2*Math.PI),t.closePath(),t.stroke()}function tn(t,e,n,i,r){void 0===r&&(r=1);var o=e?e.toString():"blue",s=i.scale(r);t.beginPath(),t.strokeStyle=o,t.moveTo(n.x,n.y),t.lineTo(n.x+s.x,n.y+s.y),t.closePath(),t.stroke()}function en(t,e,n,i,r,o,s,a){var c;if(void 0===o&&(o=5),void 0===s&&(s=nt.White),void 0===a&&(a=null),"number"==typeof o)c={tl:o,tr:o,br:o,bl:o};else{var u={tl:0,tr:0,br:0,bl:0};for(var h in u)if(u.hasOwnProperty(h)){var l=h;c[l]=o[l]||u[l]}}t.beginPath(),t.moveTo(e+c.tl,n),t.lineTo(e+i-c.tr,n),t.quadraticCurveTo(e+i,n,e+i,n+c.tr),t.lineTo(e+i,n+r-c.br),t.quadraticCurveTo(e+i,n+r,e+i-c.br,n+r),t.lineTo(e+c.bl,n+r),t.quadraticCurveTo(e,n+r,e,n+r-c.bl),t.lineTo(e,n+c.tl),t.quadraticCurveTo(e,n,e+c.tl,n),t.closePath(),a&&(t.fillStyle=a.toString(),t.fill()),s&&(t.strokeStyle=s.toString(),t.stroke())}function nn(t,e,n,i,r,o){void 0===r&&(r=nt.White),void 0===o&&(o=null),t.beginPath(),t.arc(e,n,i,0,2*Math.PI),t.closePath(),o&&(t.fillStyle=o.toString(),t.fill()),r&&(t.strokeStyle=r.toString(),t.stroke())}var rn=function(){function t(t,e,n){this._name=t,this._category=e,this._mask=n}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"category",{get:function(){return this._category},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},enumerable:!1,configurable:!0}),t.prototype.canCollide=function(t){return 0!=(this.category&t.mask)&&0!=(t.category&this.mask)},t.All=new t("Collide with all groups",-1,-1),t}(),on=function(){function t(e,n){this.colliderA=e,this.colliderB=n,this.id=null,this.collision=null,this.id=t.calculatePairHash(e,n)}return t.canCollide=function(t,e){return!!t.group.canCollide(e.group)&&((t.type!==ut.Fixed||e.type!==ut.Fixed)&&(e.type!==ut.PreventCollision&&t.type!==ut.PreventCollision&&!(!t.active||!e.active)))},Object.defineProperty(t.prototype,"canCollide",{get:function(){var e=this.colliderA,n=this.colliderB;return t.canCollide(e,n)},enumerable:!1,configurable:!0}),t.prototype.collide=function(){this.collision=this.colliderA.collide(this.colliderB)},t.prototype.resolve=function(t){this.collision&&this.collision.resolve(t)},t.calculatePairHash=function(t,e){return t.id<e.id?"#"+t.id+"+"+e.id:"#"+e.id+"+"+t.id},t.prototype.debugDraw=function(t){this.collision&&(at.showContacts&&$e(t,nt.Red,this.collision.point),at.showCollisionNormals&&tn(t,nt.Cyan,this.collision.point,this.collision.normal,30))},t}();function sn(t){return t instanceof an}var an=function(){function t(t){var e=t.body,n=t.type,i=t.group,r=t.shape,o=t.offset,s=t.useShapeInertia,a=void 0===s||s;this._events=new ee(this),this.type=ut.PreventCollision,this.group=rn.All,this.mass=1,this.inertia=1e3,this.friction=.99,this.bounciness=.2,e&&e.collider&&!r?this._shape=e.collider.shape:(this._shape=r,this.body=e),this.useShapeInertia=a,this._shape.collider=this,this.type=n||this.type,this.group=i||this.group,this.offset=o||V.Zero}return t.prototype.clone=function(){return new t({body:null,type:this.type,shape:this._shape.clone(),group:this.group,offset:this.offset})},Object.defineProperty(t.prototype,"id",{get:function(){return this.body?this.body.id:-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shape",{get:function(){return this._shape},set:function(t){this._shape=t,this._shape.collider=this,this.useShapeInertia&&(this.inertia=isNaN(this._shape.inertia)?this.inertia:this._shape.inertia)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"center",{get:function(){return this.bounds.center},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"active",{get:function(){return this.body.active},enumerable:!1,configurable:!0}),t.prototype.collide=function(t){return this.shape.collide(t.shape)},t.prototype.getClosestLineBetween=function(t){return this.shape.getClosestLineBetween(t.shape)},Object.defineProperty(t.prototype,"offset",{get:function(){return this.shape.offset.clone()},set:function(t){this.shape.offset=t.clone()},enumerable:!1,configurable:!0}),t.prototype.touching=function(t){var e=new on(this,t);return e.collide(),!!e.collision},Object.defineProperty(t.prototype,"bounds",{get:function(){return this.shape?this.shape.bounds:this.body?(new Yt).translate(this.body.pos):new Yt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localBounds",{get:function(){return this.shape?this.shape.localBounds:new Yt},enumerable:!1,configurable:!0}),t.prototype.update=function(){this.shape&&this.shape.recalc()},t.prototype.emit=function(t,e){this._events.emit(t,e)},t.prototype.on=function(t,e){this._events.on(t,e)},t.prototype.off=function(t,e){this._events.off(t,e)},t.prototype.once=function(t,e){this._events.once(t,e)},t.prototype.clear=function(){this._events.clear()},t.prototype.debugDraw=function(t){at.showMotionVectors&&(tn(t,nt.Yellow,this.body.pos,this.body.acc.add(at.acc)),tn(t,nt.Red,this.body.pos,this.body.vel),$e(t,nt.Red,this.body.pos)),at.showBounds&&this.bounds.debugDraw(t,nt.Yellow),at.showArea&&this.shape.debugDraw(t,nt.Green)},t}(),cn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();var un=function(){function t(){this.owner=null}return t.prototype.clone=function(){var t,e=new this.constructor;for(var n in this)if(this.hasOwnProperty(n)){var i=this[n];(null==(t=i)?void 0:t.clone)&&"owner"!==n&&"clone"!==n?e[n]=i.clone():e[n]=i}return e},t}(),hn=function(t){function e(e,n){var i=t.call(this)||this;return i.type=e,i.value=n,i}return cn(e,t),e}(un),ln=function(){function t(){this.observers=[]}return t.prototype.register=function(t){this.observers.push(t)},t.prototype.unregister=function(t){var e=this.observers.indexOf(t);-1!==e&&this.observers.splice(e,1)},t.prototype.notifyAll=function(t){this.observers.forEach((function(e){return e.notify(t)}))},t}(),pn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),fn=function(t){this.data=t,this.type="Component Added"};function dn(t){return!!t&&"Component Added"===t.type}var yn=function(t){this.data=t,this.type="Component Removed"};function gn(t){return!!t&&"Component Removed"===t.type}var _n,vn=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n.id=e._ID++,n.active=!0,n._tagsMemo=[],n._typesMemo=[],n._componentsToRemove=[],n._handleChanges={defineProperty:function(t,e,i){return t[e]=i.value,n._rebuildMemos(),n.changes.notifyAll(new fn({component:i.value,entity:n})),!0},deleteProperty:function(t,e){return e in t&&(n.changes.notifyAll(new yn({component:t[e],entity:n})),delete t[e],n._rebuildMemos(),!0)}},n.components=new Proxy({},n._handleChanges),n.changes=new ln,n._isInitialized=!1,n}return pn(e,t),e.prototype.kill=function(){this.active=!1},e.prototype.isKilled=function(){return!this.active},Object.defineProperty(e.prototype,"tags",{get:function(){return this._tagsMemo},enumerable:!1,configurable:!0}),e.prototype.hasTag=function(t){return this.tags.includes(t)},Object.defineProperty(e.prototype,"types",{get:function(){return this._typesMemo},enumerable:!1,configurable:!0}),e.prototype._rebuildMemos=function(){this._tagsMemo=Object.values(this.components).filter((function(t){return t instanceof hn})).map((function(t){return t.type})),this._typesMemo=Object.keys(this.components)},e.prototype.clone=function(){for(var t=new e,n=0,i=this.types;n<i.length;n++){var r=i[n];t.addComponent(this.components[r].clone())}return t},e.prototype.addComponent=function(t,n){if(void 0===n&&(n=!1),t instanceof e)for(var i in t.components)this.addComponent(t.components[i].clone(),n);else{if(this.components[t.type]&&!n)return this;if(this.components[t.type]&&n&&this.removeComponent(t),t.dependencies&&t.dependencies.length)for(var r=0,o=t.dependencies;r<o.length;r++){var s=o[r];this.addComponent(new s)}t.owner=this,this.components[t.type]=t,t.onAdd&&t.onAdd(this)}return this},e.prototype.removeComponent=function(t,e){return void 0===e&&(e=!1),e?"string"==typeof t?this._removeComponentByType(t):t instanceof un&&this._removeComponentByType(t.type):this._componentsToRemove.push(t),this},e.prototype._removeComponentByType=function(t){this.components[t]&&(this.components[t].owner=null,this.components[t].onRemove&&this.components[t].onRemove(this),delete this.components[t])},e.prototype.processComponentRemoval=function(){for(var t=0,e=this._componentsToRemove;t<e.length;t++){var n=e[t],i="string"==typeof n?n:n.type;this._removeComponentByType(i)}this._componentsToRemove.length=0},e.prototype.has=function(t){return!!this.components[t]},Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!1,configurable:!0}),e.prototype._initialize=function(e){this.isInitialized||(this.onInitialize(e),t.prototype.emit.call(this,"initialize",new Ft(e,this)),this._isInitialized=!0)},e.prototype._preupdate=function(t,e){this.emit("preupdate",new bt(t,e,this)),this.onPreUpdate(t,e)},e.prototype._postupdate=function(t,e){this.emit("postupdate",new wt(t,e,this)),this.onPostUpdate(t,e)},e.prototype.onInitialize=function(t){},e.prototype.onPreUpdate=function(t,e){},e.prototype.onPostUpdate=function(t,e){},e._ID=0,e}(ne),mn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),bn=function(t){function e(e){var n,i=t.call(this)||this;return i.draw=e,i.type="canvas",i.draw=null!==(n=i.draw)&&void 0!==n?n:function(){},i}return mn(e,t),e}(un),wn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();!function(t){t.World="world",t.Screen="screen"}(_n||(_n={}));var xn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="transform",e.coordPlane=_n.World,e.pos=V.Zero,e.z=0,e.rotation=0,e.scale=V.One,e}return wn(e,t),e}(un),Pn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),An=function(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};function Sn(t){return t instanceof En}var En=function(t){function e(e,n,i,r,o){return t.call(this,e,n,i,r,o)||this}return Pn(e,t),e}(ye(function(t){function e(e,n,i,r,o){var s=t.call(this)||this;s._height=0,s._width=0,s.isOffScreen=!1,s.visible=!0,s.opacity=1,s.previousOpacity=1,s.logger=k.getInstance(),s.scene=null,s.parent=null,s.children=[],s.frames={},s.currentDrawing=null,s._draggable=!1,s._dragging=!1,s._pointerDragStartHandler=function(){s._dragging=!0},s._pointerDragEndHandler=function(){s._dragging=!1},s._pointerDragMoveHandler=function(t){s._dragging&&(s.pos=t.pointer.lastWorldPos)},s._pointerDragLeaveHandler=function(t){s._dragging&&(s.pos=t.pointer.lastWorldPos)},s.traits=[],s.enableCapturePointer=!1,s.capturePointer={captureMoveEvents:!1,captureDragEvents:!1},s._isKilled=!1,s._capturePointerEvents=["pointerup","pointerdown","pointermove","pointerenter","pointerleave","pointerdragstart","pointerdragend","pointerdragmove","pointerdragenter","pointerdragleave"],s._captureMoveEvents=["pointermove","pointerenter","pointerleave","pointerdragmove","pointerdragenter","pointerdragleave"],s._captureDragEvents=["pointerdragstart","pointerdragend","pointerdragmove","pointerdragenter","pointerdragleave"],s._initDefaults(),s.addComponent(new xn),s.addComponent(new bn((function(t,e){return s.draw(t,e)})));var a=!0,c=ut.Passive;if(e&&"object"==typeof e){var u=e;u.pos?(e=u.pos?u.pos.x:0,n=u.pos?u.pos.y:0):(e=u.x||0,n=u.y||0),i=u.width,r=u.height,u.body&&(a=!1,s.body=u.body),u.anchor&&(s.anchor=u.anchor),u.collisionType&&(c=u.collisionType)}return s._width=i||0,s._height=r||0,a&&(s.body=new Ge({collider:new an({type:c,shape:Ve.Box(s._width,s._height,s.anchor)})})),s.pos.x=e||0,s.pos.y=n||0,o&&(s.color=o,s.opacity=o.a),s.traits.push(new Xe),s.traits.push(new Ze),s.traits.push(new Ye),s.actionQueue=new We(s),s.actions=new Ke(s),s}return Pn(e,t),Object.defineProperty(e.prototype,"body",{get:function(){return this._body},set:function(t){this._body=t,this._body.actor=this},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this.body.pos},set:function(t){this.body.pos.setTo(t.x,t.y)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldPos",{get:function(){return this.body.oldPos},set:function(t){this.body.oldPos.setTo(t.x,t.y)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vel",{get:function(){return this.body.vel},set:function(t){this.body.vel.setTo(t.x,t.y)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldVel",{get:function(){return this.body.oldVel},set:function(t){this.body.oldVel.setTo(t.x,t.y)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"acc",{get:function(){return this.body.acc},set:function(t){this.body.acc.setTo(t.x,t.y)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldAcc",{get:function(){return this.body.oldAcc},set:function(t){this.body.oldAcc.setTo(t.x,t.y)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.body.rotation},set:function(t){this.body.rotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rx",{get:function(){return this.body.rx},set:function(t){this.body.rx=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.body.scale},set:function(t){this.body.scale=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldScale",{get:function(){return this.body.oldScale},set:function(t){this.body.oldScale=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sx",{get:function(){return this.body.sx},set:function(t){this.body.sx=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sy",{get:function(){return this.body.sy},set:function(t){this.body.sy=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"draggable",{get:function(){return this._draggable},set:function(t){t&&(t&&!this._draggable?(this.on("pointerdragstart",this._pointerDragStartHandler),this.on("pointerdragend",this._pointerDragEndHandler),this.on("pointerdragmove",this._pointerDragMoveHandler),this.on("pointerdragleave",this._pointerDragLeaveHandler)):!t&&this._draggable&&(this.off("pointerdragstart",this._pointerDragStartHandler),this.off("pointerdragend",this._pointerDragEndHandler),this.off("pointerdragmove",this._pointerDragMoveHandler),this.off("pointerdragleave",this._pointerDragLeaveHandler)),this._draggable=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t.clone()},enumerable:!1,configurable:!0}),e.prototype.onInitialize=function(t){},e.prototype._initialize=function(e){t.prototype._initialize.call(this,e);for(var n=0,i=this.children;n<i.length;n++){i[n]._initialize(e)}},e.prototype._initDefaults=function(){this.anchor=En.defaults.anchor.clone()},e.prototype._checkForPointerOptIn=function(t){if(t){var e=t.toLowerCase();-1!==this._capturePointerEvents.indexOf(e)&&(this.enableCapturePointer=!0,-1!==this._captureMoveEvents.indexOf(e)&&(this.capturePointer.captureMoveEvents=!0),-1!==this._captureDragEvents.indexOf(e)&&(this.capturePointer.captureDragEvents=!0))}},e.prototype.on=function(e,n){this._checkForPointerOptIn(e),t.prototype.on.call(this,e,n)},e.prototype.once=function(e,n){this._checkForPointerOptIn(e),t.prototype.once.call(this,e,n)},e.prototype.off=function(e,n){t.prototype.off.call(this,e,n)},e.prototype._prekill=function(e){t.prototype.emit.call(this,"prekill",new pt(this)),this.onPreKill(e)},e.prototype.onPreKill=function(t){},e.prototype._postkill=function(e){t.prototype.emit.call(this,"postkill",new ft(this)),this.onPostKill(e)},e.prototype.onPostKill=function(t){},e.prototype.kill=function(){this.scene?(this._prekill(this.scene),this.emit("kill",new lt(this)),this._isKilled=!0,this.scene.remove(this),this._postkill(this.scene)):this.logger.warn("Cannot kill actor, it was never added to the Scene")},e.prototype.unkill=function(){this._isKilled=!1},e.prototype.isKilled=function(){return this._isKilled},e.prototype.add=function(t){t.body.collider.type=ut.PreventCollision,C(t,this.children)&&(t.parent=this,this.scene&&this.scene.world.add(t))},e.prototype.remove=function(t){O(t,this.children)&&(t.parent=null)},e.prototype.setDrawing=function(t){t=t.toString(),this.currentDrawing!==this.frames[t]&&(null!=this.frames[t]?(this.frames[t].reset(),this.currentDrawing=this.frames[t]):k.getInstance().error("the specified drawing key "+t+" does not exist")),this.currentDrawing&&this.currentDrawing instanceof Ae&&this.currentDrawing.tick(0)},e.prototype.addDrawing=function(){2===arguments.length?(this.frames[arguments[0]]=arguments[1],this.currentDrawing||(this.currentDrawing=arguments[1])):(arguments[0]instanceof me&&this.addDrawing("default",arguments[0]),arguments[0]instanceof we&&this.addDrawing("default",arguments[0].asSprite()))},Object.defineProperty(e.prototype,"z",{get:function(){return this.getZIndex()},set:function(t){this.setZIndex(t)},enumerable:!1,configurable:!0}),e.prototype.getZIndex=function(){return this.components.transform.z},e.prototype.setZIndex=function(t){this.components.transform.z=t},Object.defineProperty(e.prototype,"center",{get:function(){return new V(this.pos.x+this.width/2-this.anchor.x*this.width,this.pos.y+this.height/2-this.anchor.y*this.height)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width*this.getGlobalScale().x},set:function(t){this._width=t/this.scale.x,this.body.collider.shape=Ve.Box(this._width,this._height,this.anchor),this.body.markCollisionShapeDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height*this.getGlobalScale().y},set:function(t){this._height=t/this.scale.y,this.body.collider.shape=Ve.Box(this._width,this._height,this.anchor),this.body.markCollisionShapeDirty()},enumerable:!1,configurable:!0}),e.prototype.getWorldRotation=function(){return this.parent?this.rotation+this.parent.getWorldRotation():this.rotation},e.prototype.getWorldPos=function(){if(!this.parent)return this.pos.clone();var t=[],e=this;for(t.push(this);e.parent;)e=e.parent,t.push(e);var n=t.reduceRight((function(t,e){return e.parent?t+e.pos.x*e.getGlobalScale().x:t+e.pos.x}),0),i=t.reduceRight((function(t,e){return e.parent?t+e.pos.y*e.getGlobalScale().y:t+e.pos.y}),0),r=e.getWorldPos(),o=this.getWorldRotation();return new V(n,i).rotate(o,r)},e.prototype.getGlobalScale=function(){if(!this.parent)return new V(this.scale.x,this.scale.y);var t=this.parent.getGlobalScale();return new V(this.scale.x*t.x,this.scale.y*t.y)},e.prototype.contains=function(t,e,n){void 0===n&&(n=!1);var i=this.getWorldPos().sub(this.pos),r=this.body.collider.bounds.translate(i).contains(new V(t,e));return n?r||this.children.some((function(n){return n.contains(t,e,!0)})):r},e.prototype.within=function(t,e){return this.body.collider.shape.getClosestLineBetween(t.body.collider.shape).getLength()<=e},e.prototype.update=function(t,e){this._initialize(t),this._preupdate(t,e);var n=this.currentDrawing;n&&n instanceof Ae&&n.tick(e,t.stats.currFrame.id),this.actionQueue.update(e),this.color&&(this.color.a=this.opacity),0===this.opacity&&(this.visible=!1),this.body.captureOldTransform(),this.body.integrate(e);for(var i=0,r=this.traits;i<r.length;i++){r[i].update(this,t,e)}for(var o=0;o<this.children.length;o++)this.children[o].update(t,e);this._postupdate(t,e)},e.prototype.onPreUpdate=function(t,e){},e.prototype.onPostUpdate=function(t,e){},e.prototype._preupdate=function(t,e){this.emit("preupdate",new bt(t,e,this)),this.onPreUpdate(t,e)},e.prototype._postupdate=function(t,e){this.emit("postupdate",new bt(t,e,this)),this.onPostUpdate(t,e)},e.prototype.draw=function(t,e){if(t.save(),t.translate(-this._width*this.anchor.x,-this._height*this.anchor.y),this._predraw(t,e),this.currentDrawing){var n=this.currentDrawing,i=(this._width-n.width*n.scale.x)*this.anchor.x,r=(this._height-n.height*n.scale.y)*this.anchor.y;this.currentDrawing.draw({ctx:t,x:i,y:r,opacity:this.opacity})}else this.color&&this.body&&this.body.collider&&this.body.collider.shape&&this.body.collider.shape.draw(t,this.color,new V(0,0));t.restore(),this._postdraw(t,e)},e.prototype.onPreDraw=function(t,e){},e.prototype.onPostDraw=function(t,e){},e.prototype._predraw=function(t,e){this.emit("predraw",new gt(t,e,this)),this.onPreDraw(t,e)},e.prototype._postdraw=function(t,e){this.emit("postdraw",new gt(t,e,this)),this.onPostDraw(t,e)},e.prototype.debugDraw=function(t){this.emit("predebugdraw",new vt(t,this)),this.body.collider.debugDraw(t);var e=this.body.collider.localBounds.translate(this.getWorldPos());e.debugDraw(t),t.fillText("id: "+this.id,e.left+3,e.top+10),t.fillStyle=nt.Yellow.toString(),t.beginPath(),t.arc(this.getWorldPos().x,this.getWorldPos().y,3,0,2*Math.PI),t.closePath(),t.fill();for(var n=0;n<this.traits.length;n++)this.traits[n]instanceof Ze&&this.traits[n].cullingBox.debugDraw(t);t.strokeStyle=nt.Yellow.toString(),t.beginPath();var i=Math.min(this.width,this.height);t.arc(this.getWorldPos().x,this.getWorldPos().y,i,0,2*Math.PI),t.closePath(),t.stroke();var r={"0 Pi":0,"Pi/2":Math.PI/2,Pi:Math.PI,"3/2 Pi":3*Math.PI/2},o=t.font;for(var s in r)t.fillStyle=nt.Yellow.toString(),t.font="14px",t.textAlign="center",t.fillText(s,this.getWorldPos().x+Math.cos(r[s])*(i+10),this.getWorldPos().y+Math.sin(r[s])*(i+10));t.font=o;for(var a=0;a<this.children.length;a++)this.children[a].debugDraw(t);this.emit("postdebugdraw",new mt(t,this))},e.prototype.getAncestors=function(){for(var t,e=[this],n=this;t=n.parent;)n=t,e.push(n);return e.reverse()},e.defaults={anchor:V.Half},An([q({message:"ex.Actor.sx will be removed in v0.25.0",alternateMethod:"Set width and height directly in constructor"})],e.prototype,"sx",null),An([q({message:"ex.Actor.sy will be removed in v0.25.0",alternateMethod:"Set width and height directly in constructor"})],e.prototype,"sy",null),e}(vn))),Cn=function(){function t(){}return t.create=function(){return this._INSTANCE||(window.AudioContext||window.webkitAudioContext)&&(this._INSTANCE=new window.AudioContext),this._INSTANCE},t._INSTANCE=null,t}();var On,Tn=function(){function t(){}return t.unlock=function(){var e=new d;if(t._UNLOCKED||!Cn.create())return e.resolve(!0);var n=setTimeout((function(){k.getInstance().warn("Excalibur was unable to unlock the audio context, audio probably will not play in this browser."),e.resolve()}),200),i=Cn.create();return i.resume().then((function(){var r=i.createBuffer(1,1,22050),o=i.createBufferSource(),s=!1;o.buffer=r,o.connect(i.destination),o.onended=function(){return s=!0},o.start(0),setTimeout((function(){!function(t){return!!t.playbackState}(o)?(i.currentTime>0||s)&&(t._UNLOCKED=!0):o.playbackState!==o.PLAYING_STATE&&o.playbackState!==o.FINISHED_STATE||(t._UNLOCKED=!0)}),0),clearTimeout(n),e.state()===l.Pending&&e.resolve()}),(function(){e.state()===l.Pending&&e.reject(!1)})),e},t.isUnlocked=function(){return this._UNLOCKED},t._UNLOCKED=!1,t}(),Bn=n(78),Dn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Mn=function(t){function e(e){var n=t.call(this)||this;return n._resourceList=[],n._index=0,n._playButtonShown=!1,n._resourceCount=0,n._numLoaded=0,n._progressCounts={},n._totalCounts={},n.logo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdQAAAB2CAYAAABxhGI9AAAACXBIWXMAAAsSAAALEgHS3X78AAAKnUlEQVR42u3dP2wjSx0H8N8hJIonIRmJjsq0SBR+BQ1dcqKhe0lD77SvSwpKkJKGPulpktfRIMUdEqKIqV57rpAokM4dbSiyq7ONPTP7x39ifz7SFbnEnp3xer47O7uzH15fXwMA6OYHmgAABCoACFQAEKgAgEAFAIEKAAIVAAQqACBQAUCgAoBABQCBCgAIVAAQqAAgUAFAoAIAAhUABCoACFQAEKgAgECFLbmOiNeFf2PbAyz68Pr6qhUgbRwR92v+/zwiJrYHMEKFMmcN///UtgcQqFBk1PD/97U9Qx8VCFSgu4EmAIEKAAIVAAQqACBQ4Z25jojP8eX+0WtNAgIVaOY+Im5j+eKh24h41jQgUIEyZ7F5NaPU7wCBCiwYd/w9cOB+qAlgJ3KLLow0EV198803RWvJfvfddx+0lhEqHKu5JgAjVCBvlhmFzjQRXUekHz9+TP79y8uLRjNChXfvoePvAYEKxNtj1e42/O5JoIJABcrdRMRVLM+X3kTEpaaB988cKuzWg9EobTWdMx0Oly8uN4dqhAoARqgnaN3arHfqu7OyH8ItKLVB/P+CEfMTHyGPY3npx1m8zWGDEeoBfUk/xdti57dr/r1Wv2+6EPow3tZ5rRdS72s1neuF97xvWd+XTH0/V+UMttDWqbI/r2nrxfp+jv2uSjSO7S+OXy/A/3lN+9xX5T5HxEUPZZ0tfB71+w57eJ/HFu+z+jkv1u92YX9fbI/HhX3JA9rp5MPr66tWaG9UfUGbrHIzi7cLUyYFf/tpTady03EEeL8mUJ6i7MKYNvWNqr4Pe2jradXO60LrvPAz2PQ5RPX684ah8dxD+2zantnCgVipSVV+m/tgB9W2DDq2Sx/vM95wcHhZhWVJm8yrv58cSgfTdc70+++/X/r522+/tUKSEepBqo+om4ZLPerMjUwuNnQCtx1GWJtee1FwdD5uWd86xLs8UaVt2aNEO1/saZ/Z5rYMW4zq6v34rGV9Bg3q2eZ9SkeNm9qwyUh30OPIHYFKx5FG03C7znSOqYBq+qW/zpQ3anH037TNHluG6f0WPsPhHvab4QFty7ogOeuxDYcNy2/zu2214WNYWxmBurNO8bGn97pNBOO8xy/9uCorZZ4I2r4C7aJgO7ZV9iE49Dm6NvOWx+pWE9CUq3zbdTp9doz38TbXtzqH9RT5CyWe422OaZoZGeZCabrhPQY9HjwsjpTvCg4YtlE2+Ta/j2bzn8fqrDqgm+6yUHOmAvWUjAtGhbNYvsBknDnqH1Qhc7VmxHgeb/NbudA5j/UXlYwif2p6luhAc9teu1npiHKnDs8if6tCm7JLX3NKpgttXe9ruc9mHMd7a83iwdxF5vt8tutARaCeklRnNK9C8WnNF7geJQ4T4XG3JhSnVdilQrG+yOnrlVHfsEGYzhNBn7Lu6tS7+HJafJQ4EMiNlNqWXZ9WPvVgnVYHG5M1ByDXkT6leX2EgTqJtyt45yv7S2qO3sEZjZhDLXeR+YKdJ0Zdk8QocvH9N732KrNtq+FZ/zzIHABcJrYpd+Xv14lOd5ap76SgrduW/VTQ1qcQpqnbgu4ifZvUMNpd9XuoZmvCtPaQ2Y/BCHVLgbrJTeRPDdVf6pfMKDU2fOkHmVFFfXr3MsouLsnNvV5kRoe5+s431PeuoKPqWnaurY/ZPBEeqwceN4l96iwO6H7Mjq4y7VGPVNe10VaZMzVCPVWpI/Z6FZbcv5fMqGCU+dLfFGzj58jP8+bCdJCo7yzKTwdOF0bu9Ug7V4c+yz7FJfYeGoysUss0HssIdVZwYLDujMqlESoCdTtGsZtbHnJBeNdDSJSs0jTKdMJN1HNX54Wv7bvsU9NkVJVa13dX+/wuArV0X/l5RHyo/lnfF4G6p6DrS0kHdtXhy35TGErDPYZUn2WfWqDOo/lVqdMD2O/hKJhD7S/odukymq9s02QN4EEPR/zbaOumZc+r15zK1Zqznl9jsfiemTM1QmV3HUuTkedlg9HIQzRbUD93dfC+2tpj2fIHEH2+RqCCQH13gZq7hWXTNpVu19OB1fc9nQ0AKOKUb5lU0P1kDyOneoWk0lOZ9cIP0x7qu8+2BhCoR2wYu1+e7DmaXzBSsu5vaX1ne2zrpmUPTmxf7PM1Dm4y/vC7ny7Nif7+z/9ZmtM0Z3panPLtPmra9f16bcK0Dpbnwk43Vd/RHtu6zfNQTy1QBy3aqG2g9nVmxml+BOoJyT3NpWmn9xhfFnu4bvDa+44BXhqqfdf3uUF9+yz77AT31Yue2mjecYQ62NLfgkA9ghHqLNEhNem4H1c6vdyDxhf/bpz5m4coW/c39wi6VH2bPtHlcaV9cvXts+zxCe6rTeqc2ndL7uGd93QwM9bFcAzMoZZ7SgTBbWx+asui61h/iq1+RmjqdbnQXQ3T1DNQ63V/U9ucqm/pMzPb1rePsk/1iTOjgvatR4W3Lc8ULB78pELyrnAfeTcj1NU509/86mfJ33/8+Mf00a05UyPUEw7UVCeWG/WNEiExyHRMt5ltW30izUPk18ytt7lNfc8i//DvtvXto+ySA5BjljsLUF8lPkqMPEtW1JomDsiGBZ9Byb4NAvUITSN9GuwsIj6t6UTOqk7jJREkmzqli8xIs96udSO20sX0H1vW92IL9e1a9rgqVyf91gbPsTy9UD9n9lOkT8k+RfkFR5PMNqxOcdSf32PBvg3vilO+zdxE+okx9Wm0ph36XYsRZCpMF993GOk5qvqB3Dct6jvssb67KvuUNJ3frw92bhr8/STSF0JdRPMLpUCgnsgo9S76PZ246ZFk1wWvK5m3vVoYvW1Sz7nN91jfXbQ1ZQc7TW6HeaoOalypG/8/p/rP1aNAc6ZHzSnfdqPUPhdy2PQw6Nz9gSVhuhiqueUHR3uu7y7K3rdDX4u46ZrPbUa0IFBZ0seKQ3XQTRt2vm3W/a2DbNKys++rvm3ep6+y1x2UdP3bWU9lzra47U1GmlctX/sQ23t+aOlByLTh/4NAPaCRxtcdO5HLSJ/6vNtCwGx67VPmPbvWd1q9frKHtp4kAqRJ2HR9j762JfX3bZ//elPtj13PPDx1+D5tqk/Xi6NO8SHz7MmH19dXrdBNfVFP6T2PT1UHNit87/t4m5+aRH+nQBdvqyhZDKJLfZs8h7XPsqdV2ZOV+tanKB8aln0dyxdAXbV4j4gvt4oMOrbP6vbU73NW7TMlbdTnPrWpfqXfh9HKZ9vke7KuTeZRNtXRSe6+1FV//ce/ln5eXfsXgcqXzr6+9261M3moOoa7E6nvTZTfy7iNsmfb7kjfgXGsvxe0vihsEts9HTquPpt1q1vtahu2TqAiUAEEKj0zhwoARqgAu/OnX/442WH+9xc/Wvr58re/Tr7f41/+ZsRqhAoACFQAEKgAcHjMoQJskJsz/eqrr5Z+vvr7v5fmQFevAl5lztQIFQAQqAAgUAHgIJlDBdhgdQ41N2eKESoAIFABQKACwFEwhwoARqgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAEKgAgUAFAoAKAQAUAgQoACFQAEKgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAQqAAgUAFAoAKAQAUAlvwPcFDns1DsH4sAAAAASUVORK5CYII=",n.logoWidth=468,n.logoHeight=118,n.loadingBarColor=nt.White,n.backgroundColor="#176BAA",n.suppressPlayButton=!1,n._playButtonStyles=Bn.a.toString(),n.playButtonText="Play game",n.startButtonFactory=function(){var t=document.createElement("button");return t.id="excalibur-play",t.textContent=n.playButtonText,t.style.display="none",t},n.getData=function(){},n.setData=function(){},n.processData=function(){},n.onprogress=function(t){k.getInstance().debug("[ex.Loader] Loading "+(100*t.loaded/t.total).toFixed(0))},n.oncomplete=function(){},n.onerror=function(){},e&&n.addResources(e),n}return Dn(e,t),Object.defineProperty(e.prototype,"_image",{get:function(){return this._imageElement||(this._imageElement=new Image,this._imageElement.src=this.logo),this._imageElement},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playButtonRootElement",{get:function(){return this._playButtonRootElement},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playButtonElement",{get:function(){return this._playButtonElement},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_playButton",{get:function(){return this._playButtonRootElement||(this._playButtonRootElement=document.createElement("div"),this._playButtonRootElement.id="excalibur-play-root",this._playButtonRootElement.style.position="absolute",document.body.appendChild(this._playButtonRootElement)),this._styleBlock||(this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._playButtonStyles,document.head.appendChild(this._styleBlock)),this._playButtonElement||(this._playButtonElement=this.startButtonFactory(),this._playButtonRootElement.appendChild(this._playButtonElement)),this._playButtonElement},enumerable:!1,configurable:!0}),e.prototype.wireEngine=function(t){this._engine=t},e.prototype.addResource=function(t){var e=this._index++;this._resourceList.push(t),this._progressCounts[e]=0,this._totalCounts[e]=1,this._resourceCount++},e.prototype.addResources=function(t){for(var e=0,n=t.length;e<n;e++)this.addResource(t[e])},e.prototype.isLoaded=function(){return this._numLoaded===this._resourceCount},e.prototype.showPlayButton=function(){if(this.suppressPlayButton)return d.resolve();this._playButtonShown=!0,this._playButton.style.display="block";var t=new d;return this._playButton.addEventListener("click",(function(){return t.state()===l.Pending?t.resolve():t})),this._playButton.addEventListener("touchend",(function(){return t.state()===l.Pending?t.resolve():t})),this._playButton.addEventListener("pointerup",(function(){return t.state()===l.Pending?t.resolve():t})),t},e.prototype.hidePlayButton=function(){this._playButtonShown=!1,this._playButton.style.display="none"},e.prototype.dispose=function(){this._playButtonRootElement.parentElement&&(this._playButtonRootElement.removeChild(this._playButtonElement),document.body.removeChild(this._playButtonRootElement),document.head.removeChild(this._styleBlock),this._playButtonRootElement=null,this._playButtonElement=null,this._styleBlock=null)},e.prototype.load=function(){var t=this,e=new d;if(0===this._resourceList.length)return this.showPlayButton().then((function(){Tn.unlock().then((function(){t.hidePlayButton(),t.oncomplete.call(t),e.resolve(),t.dispose()}))})),e;return this._resourceList.forEach((function(n){t._engine&&n.wireEngine(t._engine),n.onprogress=function(e){t.updateResourceProgress(e.loaded,e.total)},n.oncomplete=n.onerror=function(){t.markResourceComplete(),t.isLoaded()&&setTimeout((function(){t.showPlayButton().then((function(){Tn.unlock().then((function(){t.hidePlayButton(),t.oncomplete.call(t),e.resolve(),t.dispose()}))}))}),200)}})),function t(e,n){e[n]&&e[n].load().then((function(){t(e,n+1)}))}(this._resourceList,0),e},e.prototype.updateResourceProgress=function(t,e){var n=t/e*(100/this._resourceCount)+100*this.progress;this.onprogress({loaded:n,total:100})},e.prototype.markResourceComplete=function(){this._numLoaded++},Object.defineProperty(e.prototype,"progress",{get:function(){return this._resourceCount>0?this._numLoaded/this._resourceCount:1},enumerable:!1,configurable:!0}),e.prototype.draw=function(t){var e=this._engine.canvasHeight/this._engine.pixelRatio,n=this._engine.canvasWidth/this._engine.pixelRatio;if(this._playButtonRootElement){var i=t.canvas.offsetLeft,r=t.canvas.offsetTop,o=this._playButton.clientWidth,s=this._playButton.clientHeight;this.playButtonPosition?(this._playButtonRootElement.style.left=this.playButtonPosition.x+"px",this._playButtonRootElement.style.top=this.playButtonPosition.y+"px"):(this._playButtonRootElement.style.left=i+n/2-o/2+"px",this._playButtonRootElement.style.top=r+e/2-s/2+100+"px")}t.fillStyle=this.backgroundColor,t.fillRect(0,0,n,e);var a=e/2,c=Math.min(this.logoWidth,.75*n),u=n/2-c/2;this.logoPosition&&(u=this.logoPosition.x,a=this.logoPosition.y);var h=Math.floor(c*(this.logoHeight/this.logoWidth)),l=this._engine.getAntialiasing();if(this._engine.setAntialiasing(!0),this.logoPosition?t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,u,a,c,h):t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,u,a-h-20,c,h),this.suppressPlayButton||!this._playButtonShown){var p=u,f=a;this.loadingBarPosition&&(p=this.loadingBarPosition.x,f=this.loadingBarPosition.y),t.lineWidth=2,en(t,p,f,c,20,10,this.loadingBarColor);var d=c*this.progress-10;en(t,p+5,f+5,d>10?d:10,10,5,null,this.loadingBarColor),this._engine.setAntialiasing(l)}else this._engine.setAntialiasing(l)},e.prototype.update=function(t,e){},e}(ne),jn={webgl:"WebGL",webaudio:"WebAudio",gamepadapi:"Gamepad API"},Rn=function(){function t(){this._features=null,this.failedTests=[],this._criticalTests={canvasSupport:function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},arrayBufferSupport:function(){var t=new XMLHttpRequest;t.open("GET","/");try{t.responseType="arraybuffer"}catch(t){return!1}return"arraybuffer"===t.responseType},dataUrlSupport:function(){return 0===document.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")},objectUrlSupport:function(){return"URL"in window&&"revokeObjectURL"in URL&&"createObjectURL"in URL},rgbaSupport:function(){var t=document.createElement("a").style;return t.cssText="background-color:rgba(150,255,150,.5)",(""+t.backgroundColor).indexOf("rgba")>-1}},this._warningTest={webAudioSupport:function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext)},webglSupport:function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("webgl"))}},this._features=this._loadBrowserFeatures()}return t.prototype.getBrowserFeatures=function(){return null===this._features&&(this._features=this._loadBrowserFeatures()),this._features},t.prototype.logBrowserFeatures=function(){for(var t="%cSUPPORTED BROWSER FEATURES\n==========================%c\n",e=["font-weight: bold; color: navy","font-weight: normal; color: inherit"],n=this.getBrowserFeatures(),i=0,r=Object.keys(jn);i<r.length;i++){var o=r[i];n[o]?(t+="(%câ%c)",e.push("font-weight: bold; color: green"),e.push("font-weight: normal; color: inherit")):(t+="(%câ%c)",e.push("font-weight: bold; color: red"),e.push("font-weight: normal; color: inherit")),t+=" "+jn[o]+"\n"}e.unshift(t),console.log.apply(console,e)},t.prototype._loadBrowserFeatures=function(){var t=this;return{canvas:t._criticalTests.canvasSupport(),arraybuffer:t._criticalTests.arrayBufferSupport(),dataurl:t._criticalTests.dataUrlSupport(),objecturl:t._criticalTests.objectUrlSupport(),rgba:t._criticalTests.rgbaSupport(),webaudio:t._warningTest.webAudioSupport(),webgl:t._warningTest.webglSupport(),gamepadapi:!!navigator.getGamepads}},t.prototype.test=function(){var t=!1;for(var e in this._criticalTests)this._criticalTests[e].call(this)||(this.failedTests.push(e),k.getInstance().error("Critical browser feature missing, Excalibur requires:",e),t=!0);if(t)return!1;for(var n in this._warningTest)this._warningTest[n]()||k.getInstance().warn("Warning browser feature missing, Excalibur will have reduced performance:",n);return!0},t}(),kn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Fn=function(t){function e(e,n,i,r){var o=this;return(o="object"!=typeof e?t.call(this,e,n,i,r)||this:t.call(this,e)||this).components.transform.coordPlane=_n.Screen,o.traits=[],o.traits.push(new Ye),o.anchor.setTo(0,0),o.body.collider.type=ut.PreventCollision,o.body.collider.shape=Ve.Box(o.width,o.height,o.anchor),o.enableCapturePointer=!0,o}return kn(e,t),e.prototype._initialize=function(e){this._engine=e,t.prototype._initialize.call(this,e)},e.prototype.contains=function(e,n,i){if(void 0===i&&(i=!0),i)return t.prototype.contains.call(this,e,n);var r=this._engine.worldToScreenCoordinates(new V(e,n));return t.prototype.contains.call(this,r.x,r.y)},e}(En),In=function(){function t(e,n,i,r){if(this.id=0,this.interval=10,this.repeats=!1,this.maxNumberOfRepeats=-1,this._elapsedTime=0,this._totalTimeAlive=0,this._paused=!1,this._numberOfTicks=0,this.complete=!1,this.scene=null,"function"!=typeof e){var o=e;e=o.fcn,n=o.interval,i=o.repeats,r=o.numberOfRepeats}if(r&&r>=0&&(this.maxNumberOfRepeats=r,!i))throw new Error("repeats must be set to true if numberOfRepeats is set");this.id=t.id++,this.interval=n||this.interval,this.repeats=i||this.repeats,this._callbacks=[],e&&this.on(e)}return t.prototype.on=function(t){this._callbacks.push(t)},t.prototype.off=function(t){var e=this._callbacks.indexOf(t);this._callbacks.splice(e,1)},t.prototype.update=function(t){var e=this;this._paused||(this._totalTimeAlive+=t,this._elapsedTime+=t,this.maxNumberOfRepeats>-1&&this._numberOfTicks>=this.maxNumberOfRepeats&&(this.complete=!0),!this.complete&&this._elapsedTime>=this.interval&&(this._callbacks.forEach((function(t){t.call(e)})),this._numberOfTicks++,this.repeats?this._elapsedTime=0:this.complete=!0))},t.prototype.reset=function(t,e){if(t&&t>=0&&(this.interval=t),this.maxNumberOfRepeats&&this.maxNumberOfRepeats>=0&&(this.maxNumberOfRepeats=e,!this.repeats))throw new Error("repeats must be set to true if numberOfRepeats is set");this.complete=!1,this._elapsedTime=0,this._numberOfTicks=0},Object.defineProperty(t.prototype,"timesRepeated",{get:function(){return this._numberOfTicks},enumerable:!1,configurable:!0}),t.prototype.getTimeRunning=function(){return this._totalTimeAlive},t.prototype.pause=function(){this._paused=!0},t.prototype.unpause=function(){this._paused=!1},t.prototype.cancel=function(){this.scene&&this.scene.cancelTimer(this)},t.id=0,t}(),Ln=function(){function t(t){this.parent=t,this.parent=t||null,this.body=null,this.bounds=new Yt,this.left=null,this.right=null,this.height=0}return t.prototype.isLeaf=function(){return!this.left&&!this.right},t}(),Un=function(){function t(t){void 0===t&&(t=new Yt(-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)),this.worldBounds=t,this.root=null,this.nodes={}}return t.prototype._insert=function(t){if(null===this.root)return this.root=t,void(this.root.parent=null);for(var e=t.bounds,n=this.root;!n.isLeaf();){var i=n.left,r=n.right,o=n.bounds.getPerimeter(),s=n.bounds.combine(e).getPerimeter(),a=2*s,c=2*(s-o),u=0,h=e.combine(i.bounds),l=void 0;i.isLeaf()?u=h.getPerimeter()+c:(l=i.bounds.getPerimeter(),u=h.getPerimeter()-l+c);var p=0,f=e.combine(r.bounds);if(r.isLeaf()?p=f.getPerimeter()+c:(l=r.bounds.getPerimeter(),p=f.getPerimeter()-l+c),a<u&&a<p)break;n=u<p?i:r}var d=n.parent,y=new Ln(d);y.bounds=e.combine(n.bounds),y.height=n.height+1,null!==d?(d.left===n?d.left=y:d.right=y,y.left=n,y.right=t,n.parent=y,t.parent=y):(y.left=n,y.right=t,n.parent=y,t.parent=y,this.root=y);for(var g=t.parent;g;){if(!(g=this._balance(g)).left)throw new Error("Parent of current leaf cannot have a null left child"+g);if(!g.right)throw new Error("Parent of current leaf cannot have a null right child"+g);g.height=1+Math.max(g.left.height,g.right.height),g.bounds=g.left.bounds.combine(g.right.bounds),g=g.parent}},t.prototype._remove=function(t){if(t!==this.root){var e,n=t.parent,i=n.parent;if(e=n.left===t?n.right:n.left,i){i.left===n?i.left=e:i.right=e,e.parent=i;for(var r=i;r;)(r=this._balance(r)).bounds=r.left.bounds.combine(r.right.bounds),r.height=1+Math.max(r.left.height,r.right.height),r=r.parent}else this.root=e,e.parent=null}else this.root=null},t.prototype.trackBody=function(t){var e=new Ln;e.body=t,e.bounds=t.collider.bounds,e.bounds.left-=2,e.bounds.top-=2,e.bounds.right+=2,e.bounds.bottom+=2,this.nodes[t.id]=e,this._insert(e)},t.prototype.updateBody=function(t){var e=this.nodes[t.id];if(!e)return!1;var n=t.collider.bounds;if(!this.worldBounds.contains(n))return k.getInstance().warn("Collider with id "+t.id+" is outside the world bounds and will no longer be tracked for physics"),this.untrackBody(t),!1;if(e.bounds.contains(n))return!1;this._remove(e),n.left-=at.boundsPadding,n.top-=at.boundsPadding,n.right+=at.boundsPadding,n.bottom+=at.boundsPadding;var i=t.vel.x*at.dynamicTreeVelocityMultiplier,r=t.vel.y*at.dynamicTreeVelocityMultiplier;return i<0?n.left+=i:n.right+=i,r<0?n.top+=r:n.bottom+=r,e.bounds=n,this._insert(e),!0},t.prototype.untrackBody=function(t){var e=this.nodes[t.collider.id];e&&(this._remove(e),this.nodes[t.collider.id]=null,delete this.nodes[t.collider.id])},t.prototype._balance=function(t){if(null===t)throw new Error("Cannot balance at null node");if(t.isLeaf()||t.height<2)return t;var e=t.left,n=t.right,i=t,r=e,o=n,s=e.left,a=e.right,c=n.left,u=n.right,h=o.height-r.height;if(h>1)return o.left=i,o.parent=i.parent,i.parent=o,o.parent?o.parent.left===i?o.parent.left=o:o.parent.right=o:this.root=o,c.height>u.height?(o.right=c,i.right=u,u.parent=i,i.bounds=r.bounds.combine(u.bounds),o.bounds=i.bounds.combine(c.bounds),i.height=1+Math.max(r.height,u.height),o.height=1+Math.max(i.height,c.height)):(o.right=u,i.right=c,c.parent=i,i.bounds=r.bounds.combine(c.bounds),o.bounds=i.bounds.combine(u.bounds),i.height=1+Math.max(r.height,c.height),o.height=1+Math.max(i.height,u.height)),o;if(h<-1){if(r.left=i,r.parent=i.parent,i.parent=r,r.parent)if(r.parent.left===i)r.parent.left=r;else{if(r.parent.right!==i)throw"Error rotating Dynamic Tree";r.parent.right=r}else this.root=r;return s.height>a.height?(r.right=s,i.left=a,a.parent=i,i.bounds=o.bounds.combine(a.bounds),r.bounds=i.bounds.combine(s.bounds),i.height=1+Math.max(o.height,a.height),r.height=1+Math.max(i.height,s.height)):(r.right=a,i.left=s,s.parent=i,i.bounds=o.bounds.combine(s.bounds),r.bounds=i.bounds.combine(a.bounds),i.height=1+Math.max(o.height,s.height),r.height=1+Math.max(i.height,a.height)),r}return t},t.prototype.getHeight=function(){return null===this.root?0:this.root.height},t.prototype.query=function(t,e){var n=t.collider.bounds,i=function(r){if(r&&r.bounds.intersect(n)){if(!r.isLeaf()||r.body===t)return i(r.left)||i(r.right);if(e.call(t,r.body))return!0}return!1};i(this.root)},t.prototype.rayCastQuery=function(t,e,n){void 0===e&&(e=1/0);var i=function(r){if(r&&r.bounds.rayCast(t,e)){if(!r.isLeaf())return i(r.left)||i(r.right);if(n.call(t,r.body))return!0}return!1};i(this.root)},t.prototype.getNodes=function(){var t=function(e){return e?[e].concat(t(e.left),t(e.right)):[]};return t(this.root)},t.prototype.debugDraw=function(t){var e=function(n){n&&(n.isLeaf()?(t.lineWidth=1,t.strokeStyle="green"):(t.lineWidth=1,t.strokeStyle="white"),n.bounds.debugDraw(t),n.left&&e(n.left),n.right&&e(n.right))};e(this.root)},t}(),zn=function(){function t(){this._dynamicCollisionTree=new Un,this._collisionHash={},this._collisionPairCache=[],this._lastFramePairs=[],this._lastFramePairsHash={}}return t.prototype.track=function(t){t?this._dynamicCollisionTree.trackBody(t):k.getInstance().warn("Cannot track null physics body")},t.prototype.untrack=function(t){t?this._dynamicCollisionTree.untrackBody(t):k.getInstance().warn("Cannot untrack a null physics body")},t.prototype._shouldGenerateCollisionPair=function(t,e){var n=on.calculatePairHash(t,e);return!this._collisionHash[n]&&on.canCollide(t,e)},t.prototype.broadphase=function(t,e,n){var i,r=this,o=e/1e3,s=t.map((function(t){return t.collider})).filter((function(t){return t.active&&t.type!==ut.PreventCollision}));this._collisionPairCache=[],this._collisionHash={};for(var a=0,c=s.length;a<c;a++)i=s[a],this._dynamicCollisionTree.query(i.body,(function(t){if(r._shouldGenerateCollisionPair(i,t.collider)){var e=new on(i,t.collider);r._collisionHash[e.id]=!0,r._collisionPairCache.push(e)}return!1}));if(n&&(n.physics.pairs=this._collisionPairCache.length),at.checkForFastBodies)for(var u=function(t){if(t.type!==ut.Active)return"continue";var e=t.body.vel.size*o+.5*t.body.acc.size*o*o,i=Math.min(t.bounds.height,t.bounds.width);if(at.disableMinimumSpeedForFastBody||e>i/2){n&&n.physics.fastBodies++;var r,s=t.body.pos.sub(t.body.oldPos),a=t.shape.center,c=t.shape.getFurthestPoint(t.body.vel),u=c.sub(s),l=new G(u,t.body.vel);l.pos=l.pos.add(l.dir.scale(-2*at.surfaceEpsilon));var p=new V(1/0,1/0);if(h._dynamicCollisionTree.rayCastQuery(l,e+2*at.surfaceEpsilon,(function(n){if(t.body!==n&&n.collider.shape&&on.canCollide(t,n.collider)){var i=n.collider.shape.rayCast(l,e+10*at.surfaceEpsilon);if(i){var o=i.sub(u);o.size<p.size&&(p=o,r=n)}}return!1})),r&&V.isValid(p)){var f=new on(t,r.collider);h._collisionHash[f.id]||(h._collisionHash[f.id]=!0,h._collisionPairCache.push(f));var d=a.sub(c);t.body.pos=u.add(d).add(p).add(l.dir.scale(2*at.surfaceEpsilon)),t.shape.recalc(),n&&n.physics.fastBodyCollisions++}}},h=this,l=0,p=s;l<p.length;l++){u(p[l])}return this._collisionPairCache},t.prototype.narrowphase=function(t,e){for(var n=0;n<t.length;n++)t[n].collide(),e&&t[n].collision&&(e.physics.collisions++,e.physics.collidersHash[t[n].id]=t[n]);return t.filter((function(t){return t.collision}))},t.prototype.resolve=function(t,e,n){for(var i=0,r=t;i<r.length;i++){var o=r[i];o.resolve(n),o.collision&&(o.colliderA.body.applyMtv(),o.colliderB.body.applyMtv(),o.colliderA.body.integrate(e*at.collisionShift),o.colliderB.body.integrate(e*at.collisionShift))}return t.filter((function(t){return t.canCollide}))},t.prototype.runCollisionStartEnd=function(t){for(var e={},n=0,i=t;n<i.length;n++){if(e[(c=i[n]).id]=c,!this._lastFramePairsHash[c.id]){var r=c.colliderA,o=c.colliderB;r.emit("collisionstart",new Rt(r,o,c)),o.emit("collisionstart",new Rt(o,r,c))}}for(var s=0,a=this._lastFramePairs;s<a.length;s++){var c;if(!e[(c=a[s]).id]){r=c.colliderA,o=c.colliderB;r.emit("collisionend",new kt(r,o)),o.emit("collisionend",new kt(o,r))}}this._lastFramePairs=t,this._lastFramePairsHash=e},t.prototype.update=function(t){for(var e=0,n=t.length,i=0;i<n;i++)this._dynamicCollisionTree.updateBody(t[i])&&e++;return e},t.prototype.debugDraw=function(t){if(at.broadphaseDebug&&this._dynamicCollisionTree.debugDraw(t),at.showContacts||at.showCollisionNormals)for(var e=0,n=this._collisionPairCache;e<n.length;e++){n[e].debugDraw(t)}},t}(),Nn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Wn=function(t){function e(e,n,i,r,o,s){return t.call(this,e,n,i,r,o,s)||this}return Nn(e,t),e}(ye(function(t){function e(e,n,i,r,o,s){var a=t.call(this)||this;if(a._collidingX=-1,a._collidingY=-1,a._onScreenXStart=0,a._onScreenXEnd=9999,a._onScreenYStart=0,a._onScreenYEnd=9999,a._spriteSheets={},a.logger=k.getInstance(),a.data=[],a.z=0,a.visible=!0,a.isOffscreen=!1,a.rotation=0,a.scale=V.One,e&&"object"==typeof e){var c=e;e=c.x,n=c.y,i=c.cellWidth,r=c.cellHeight,o=c.rows,s=c.cols}a.x=e,a.y=n,a.cellWidth=i,a.cellHeight=r,a.rows=o,a.cols=s,a.data=new Array(o*s);for(var u=function(t){for(var c=function(o){var c;c=new qn(t*i+e,o*r+n,i,r,t+o*s),a.data[t+o*s]=c},u=0;u<o;u++)c(u)},h=0;h<s;h++)u(h);return a.addComponent(new xn),a.addComponent(new bn((function(t,e){return a.draw(t,e)}))),a}return Nn(e,t),Object.defineProperty(e.prototype,"pos",{get:function(){return Y(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y},enumerable:!1,configurable:!0}),e.prototype.on=function(e,n){t.prototype.on.call(this,e,n)},e.prototype.registerSpriteSheet=function(t,e){this._spriteSheets[t]=e},e.prototype.collides=function(t){var e=t.pos.x+t.width,n=t.pos.y+t.height,i=t.body.collider.bounds,r=[];if(t.width<=0||t.height<=0)return null;for(var o=i.left;o<=e;o+=Math.min(t.width/2,this.cellWidth/2))for(var s=i.top;s<=n;s+=Math.min(t.height/2,this.cellHeight/2)){var a=this.getCellByPoint(o,s);if(a&&a.solid){var c=i.intersect(a.bounds),u=t.center.sub(a.center);c&&c.dot(u)>0&&r.push(c)}}return 0===r.length?null:r.reduce((function(t,e){var n=t.x,i=t.y;return Math.abs(t.x)<Math.abs(e.x)&&(n=e.x),Math.abs(t.y)<Math.abs(e.y)&&(i=e.y),new V(n,i)}))},e.prototype.getCellByIndex=function(t){return this.data[t]},e.prototype.getCell=function(t,e){return t<0||e<0||t>=this.cols||e>=this.rows?null:this.data[t+e*this.cols]},e.prototype.getCellByPoint=function(t,e){t=Math.floor((t-this.x)/this.cellWidth),e=Math.floor((e-this.y)/this.cellHeight);var n=this.getCell(t,e);return t>=0&&e>=0&&t<this.cols&&e<this.rows&&n?n:null},e.prototype.onPreUpdate=function(t,e){},e.prototype.onPostUpdate=function(t,e){},e.prototype.update=function(t,e){this.onPreUpdate(t,e),this.emit("preupdate",new bt(t,e,this));var n=t.screenToWorldCoordinates(new V(0,0)),i=t.screenToWorldCoordinates(new V(t.canvas.clientWidth,t.canvas.clientHeight));this._onScreenXStart=Math.max(Math.floor((n.x-this.x)/this.cellWidth)-2,0),this._onScreenYStart=Math.max(Math.floor((n.y-this.y)/this.cellHeight)-2,0),this._onScreenXEnd=Math.max(Math.floor((i.x-this.x)/this.cellWidth)+2,0),this._onScreenYEnd=Math.max(Math.floor((i.y-this.y)/this.cellHeight)+2,0),this.onPostUpdate(t,e),this.emit("postupdate",new wt(t,e,this))},e.prototype.draw=function(t,e){this.emit("predraw",new gt(t,e,this));for(var n,i,r,o=this._onScreenXStart,s=Math.min(this._onScreenXEnd,this.cols),a=this._onScreenYStart,c=Math.min(this._onScreenYEnd,this.rows);o<s;o++){for(;a<c;a++)for(i=0,r=(n=this.getCell(o,a).sprites.filter((function(t){return t.spriteId>-1}))).length;i<r;i++){var u=this._spriteSheets[n[i].spriteSheetKey];if(u){var h=u.getSprite(n[i].spriteId);h?h.draw(t,o*this.cellWidth,a*this.cellHeight):this.logger.warn("Sprite does not exist for id",n[i].spriteId,"in sprite sheet",n[i].spriteSheetKey,h,u)}else this.logger.warn("Sprite sheet",n[i].spriteSheetKey,"does not exist",u)}a=this._onScreenYStart}this.emit("postdraw",new _t(t,e,this))},e.prototype.debugDraw=function(t){var e=this.cols*this.cellWidth,n=this.rows*this.cellHeight;t.save(),t.strokeStyle=nt.Red.toString();for(var i=0;i<this.cols+1;i++)t.beginPath(),t.moveTo(this.x+i*this.cellWidth,this.y),t.lineTo(this.x+i*this.cellWidth,this.y+n),t.stroke();for(var r=0;r<this.rows+1;r++)t.beginPath(),t.moveTo(this.x,this.y+r*this.cellHeight),t.lineTo(this.x+e,this.y+r*this.cellHeight),t.stroke();var o=nt.Red;o.a=.3,this.data.filter((function(t){return t.solid})).forEach((function(e){t.fillStyle=o.toString(),t.fillRect(e.x,e.y,e.width,e.height)})),this._collidingY>-1&&this._collidingX>-1&&(t.fillStyle=nt.Cyan.toString(),t.fillRect(this.x+this._collidingX*this.cellWidth,this.y+this._collidingY*this.cellHeight,this.cellWidth,this.cellHeight)),t.restore()},e}(vn))),Hn=function(t,e){this.spriteSheetKey=t,this.spriteId=e},qn=function(t){function e(e,n,i,r,o,s,a){return t.call(this,e,n,i,r,o,s,a)||this}return Nn(e,t),e}(ye(function(){function t(t,e,n,i,r,o,s){if(void 0===o&&(o=!1),void 0===s&&(s=[]),this.solid=!1,this.sprites=[],t&&"object"==typeof t){var a=t;t=a.x,e=a.y,n=a.width,i=a.height,r=a.index,o=a.solid,s=a.sprites}this.x=t,this.y=e,this.width=n,this.height=i,this.index=r,this.solid=o,this.sprites=s,this._bounds=new Yt(this.x,this.y,this.x+this.width,this.y+this.height)}return Object.defineProperty(t.prototype,"bounds",{get:function(){return this._bounds},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"center",{get:function(){return new V(this.x+this.width/2,this.y+this.height/2)},enumerable:!1,configurable:!0}),t.prototype.pushSprite=function(t){this.sprites.push(t)},t.prototype.removeSprite=function(t){var e;(e=this.sprites.indexOf(t))>-1&&this.sprites.splice(e,1)},t.prototype.clearSprites=function(){this.sprites.length=0},t}())),Kn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Vn=function(){function t(t){this.camera=t}return t.prototype.lockToActor=function(t){this.camera.addStrategy(new Yn(t))},t.prototype.lockToActorAxis=function(t,e){this.camera.addStrategy(new Jn(t,e))},t.prototype.elasticToActor=function(t,e,n){this.camera.addStrategy(new $n(t,e,n))},t.prototype.radiusAroundActor=function(t,e){this.camera.addStrategy(new ti(t,e))},t.prototype.limitCameraBounds=function(t){this.camera.addStrategy(new ei(t))},t}();!function(t){t[t.X=0]="X",t[t.Y=1]="Y"}(On||(On={}));var Gn,Xn,Qn,Zn,Yn=function(t){this.target=t,this.action=function(t,e,n,i){return t.center}},Jn=function(t,e){var n=this;this.target=t,this.axis=e,this.action=function(t,e,i,r){var o=t.center,s=e.getFocus();return n.axis===On.X?new V(o.x,s.y):new V(s.x,o.y)}},$n=function(t,e,n){var i=this;this.target=t,this.cameraElasticity=e,this.cameraFriction=n,this.action=function(t,e,n,r){var o=t.center,s=e.getFocus(),a=e.vel.clone(),c=o.sub(s).scale(i.cameraElasticity),u=(a=a.add(c)).scale(-1).scale(i.cameraFriction);return a=a.add(u),s=s.add(a)}},ti=function(t,e){var n=this;this.target=t,this.radius=e,this.action=function(t,e,i,r){var o=t.center,s=e.getFocus(),a=o.sub(s),c=a.size;if(c>=n.radius){var u=c-n.radius;return s.add(a.normalize().scale(u))}return s}},ei=function(t){var e=this;this.target=t,this.boundSizeChecked=!1,this.action=function(t,n,i,r){var o=n.getFocus();return e.boundSizeChecked||((t.bottom-t.top<i.drawHeight||t.right-t.left<i.drawWidth)&&k.getInstance().warn("Camera bounds should not be smaller than the engine viewport"),e.boundSizeChecked=!0),o.x<t.left+i.halfDrawWidth?o.x=t.left+i.halfDrawWidth:o.x>t.right-i.halfDrawWidth&&(o.x=t.right-i.halfDrawWidth),o.y<t.top+i.halfDrawHeight?o.y=t.top+i.halfDrawHeight:o.y>t.bottom-i.halfDrawHeight&&(o.y=t.bottom-i.halfDrawHeight),o}},ni=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._cameraStrategies=[],e.strategy=new Vn(e),e.z=1,e.dz=0,e.az=0,e.rotation=0,e.rx=0,e.pos=V.Zero,e.vel=V.Zero,e.acc=V.Zero,e._cameraMoving=!1,e._currentLerpTime=0,e._lerpDuration=1e3,e._lerpStart=null,e._lerpEnd=null,e._isShaking=!1,e._shakeMagnitudeX=0,e._shakeMagnitudeY=0,e._shakeDuration=0,e._elapsedShakeTime=0,e._xShake=0,e._yShake=0,e._isZooming=!1,e._zoomStart=1,e._zoomEnd=1,e._currentZoomTime=0,e._zoomDuration=0,e._zoomEasing=qe.EaseInOutCubic,e._easing=qe.EaseInOutCubic,e._isInitialized=!1,e}return Kn(e,t),Object.defineProperty(e.prototype,"angularVelocity",{get:function(){return this.rx},set:function(t){this.rx=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this.pos.x},set:function(t){this._follow||this._cameraMoving||(this.pos.x=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.pos.y},set:function(t){this._follow||this._cameraMoving||(this.pos.y=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dx",{get:function(){return this.vel.x},set:function(t){this.vel.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dy",{get:function(){return this.vel.y},set:function(t){this.vel.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ax",{get:function(){return this.acc.x},set:function(t){this.acc.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ay",{get:function(){return this.acc.y},set:function(t){this.acc.y=t},enumerable:!1,configurable:!0}),e.prototype.getFocus=function(){return this.pos},e.prototype.move=function(t,e,n){if(void 0===n&&(n=qe.EaseInOutCubic),"function"!=typeof n)throw"Please specify an EasingFunction";return this._follow?(new d).reject(t):(this._lerpPromise&&this._lerpPromise.state()===l.Pending&&this._lerpPromise.resolve(t),this._lerpPromise=new d,this._lerpStart=this.getFocus().clone(),this._lerpDuration=e,this._lerpEnd=t,this._currentLerpTime=0,this._cameraMoving=!0,this._easing=n,this._lerpPromise)},e.prototype.shake=function(t,e,n){this._isShaking=!0,this._shakeMagnitudeX=t,this._shakeMagnitudeY=e,this._shakeDuration=n},e.prototype.zoom=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=qe.EaseInOutCubic),this._zoomPromise=new d,e?(this._isZooming=!0,this._zoomEasing=n,this._currentZoomTime=0,this._zoomDuration=e,this._zoomStart=this.z,this._zoomEnd=t):(this._isZooming=!1,this.z=t,this._zoomPromise.resolve(!0)),this._zoomPromise},e.prototype.getZoom=function(){return this.z},Object.defineProperty(e.prototype,"viewport",{get:function(){if(this._engine){var t=this._engine.halfDrawWidth,e=this._engine.halfDrawHeight;return new Yt(this.x-t,this.y-e,this.x+t,this.y+e)}return new Yt(0,0,0,0)},enumerable:!1,configurable:!0}),e.prototype.addStrategy=function(t){this._cameraStrategies.push(t)},e.prototype.removeStrategy=function(t){O(t,this._cameraStrategies)},e.prototype.clearAllStrategies=function(){this._cameraStrategies.length=0},e.prototype._preupdate=function(t,e){this.emit("preupdate",new bt(t,e,this)),this.onPreUpdate(t,e)},e.prototype.onPreUpdate=function(t,e){},e.prototype._postupdate=function(t,e){this.emit("postupdate",new wt(t,e,this)),this.onPostUpdate(t,e)},e.prototype.onPostUpdate=function(t,e){},Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!1,configurable:!0}),e.prototype._initialize=function(e){this.isInitialized||(this.onInitialize(e),t.prototype.emit.call(this,"initialize",new Ft(e,this)),this._isInitialized=!0,this._engine=e)},e.prototype.onInitialize=function(t){},e.prototype.on=function(e,n){t.prototype.on.call(this,e,n)},e.prototype.off=function(e,n){t.prototype.off.call(this,e,n)},e.prototype.once=function(e,n){t.prototype.once.call(this,e,n)},e.prototype.update=function(t,e){if(this._initialize(t),this._preupdate(t,e),this.pos=this.pos.add(this.vel.scale(e/1e3)),this.z+=this.dz*e/1e3,this.vel=this.vel.add(this.acc.scale(e/1e3)),this.dz+=this.az*e/1e3,this.rotation+=this.angularVelocity*e/1e3,this._isZooming)if(this._currentZoomTime<this._zoomDuration){var n=(0,this._zoomEasing)(this._currentZoomTime,this._zoomStart,this._zoomEnd,this._zoomDuration);this.z=n,this._currentZoomTime+=e}else this._isZooming=!1,this.z=this._zoomEnd,this._currentZoomTime=0,this._zoomPromise.resolve(!0);if(this._cameraMoving)if(this._currentLerpTime<this._lerpDuration){var i=qe.CreateVectorEasingFunction(this._easing)(this._currentLerpTime,this._lerpStart,this._lerpEnd,this._lerpDuration);this.pos=i,this._currentLerpTime+=e}else{this.pos=this._lerpEnd;var r=this._lerpEnd.clone();this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1,this._lerpPromise.resolve(r)}this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._xShake=0,this._yShake=0):(this._elapsedShakeTime+=e,this._xShake=1+(Math.random()*this._shakeMagnitudeX|0),this._yShake=1+(Math.random()*this._shakeMagnitudeY|0));for(var o=0,s=this._cameraStrategies;o<s.length;o++){var a=s[o];this.pos=a.action.call(a,a.target,this,t,e)}this._postupdate(t,e)},e.prototype.draw=function(t){var e=this.getFocus(),n=t.canvas.width,i=t.canvas.height,r=this._engine?this._engine.pixelRatio:window.devicePixelRatio,o=this.getZoom(),s=n/o/r,a=i/o/r;t.scale(o,o),t.translate(-e.x+s/2+this._xShake,-e.y+a/2+this._yShake)},e.prototype.debugDraw=function(t){var e=this.getFocus();t.fillStyle="red",t.strokeStyle="white",t.lineWidth=3,t.beginPath(),t.arc(e.x,e.y,15,0,2*Math.PI),t.closePath(),t.stroke(),t.beginPath(),t.arc(e.x,e.y,5,0,2*Math.PI),t.closePath(),t.stroke(),t.beginPath(),t.setLineDash([5,15]),t.lineWidth=5,t.strokeStyle="white",t.strokeRect(this.viewport.left,this.viewport.top,this.viewport.width,this.viewport.height),t.closePath()},e.prototype._isDoneShaking=function(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration},e}(ne),ii=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();!function(t){t[t.Em=0]="Em",t[t.Rem=1]="Rem",t[t.Px=2]="Px",t[t.Pt=3]="Pt",t[t.Percent=4]="Percent"}(Gn||(Gn={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Start=3]="Start",t[t.End=4]="End"}(Xn||(Xn={})),function(t){t[t.Top=0]="Top",t[t.Hanging=1]="Hanging",t[t.Middle=2]="Middle",t[t.Alphabetic=3]="Alphabetic",t[t.Ideographic=4]="Ideographic",t[t.Bottom=5]="Bottom"}(Qn||(Qn={})),function(t){t[t.Normal=0]="Normal",t[t.Italic=1]="Italic",t[t.Oblique=2]="Oblique"}(Zn||(Zn={}));var ri,oi=function(t){function e(e,n,i,r,o){return t.call(this,e,n,i,r,o)||this}return ii(e,t),e}(ye(function(t){function e(e,n,i,r,o){var s=t.call(this,e&&"object"==typeof e?e:{pos:new V(n,i)})||this;s.bold=!1,s.fontSize=10,s.fontStyle=Zn.Normal,s.fontUnit=Gn.Px,s.textAlign=Xn.Left,s.baseAlign=Qn.Bottom,s.letterSpacing=0,s.caseInsensitive=!0;var a="";return e&&"object"==typeof e?(r=e.fontFamily,o=e.spriteFont,a=e.text):a=e,s.text=a||"",s.color=nt.Black,s.spriteFont=o,s.body.collider.type=ut.PreventCollision,s.fontFamily=r||"sans-serif",s._textShadowOn=!1,s._shadowOffsetX=0,s._shadowOffsetY=0,s}return ii(e,t),e.prototype.getTextWidth=function(t){var e=t.font;t.font=this._fontString;var n=t.measureText(this.text).width;return t.font=e,n},e.prototype._lookupFontUnit=function(t){switch(t){case Gn.Em:return"em";case Gn.Rem:return"rem";case Gn.Pt:return"pt";case Gn.Px:return"px";case Gn.Percent:return"%";default:return"px"}},e.prototype._lookupTextAlign=function(t){switch(t){case Xn.Left:return"left";case Xn.Right:return"right";case Xn.Center:return"center";case Xn.End:return"end";case Xn.Start:default:return"start"}},e.prototype._lookupBaseAlign=function(t){switch(t){case Qn.Alphabetic:return"alphabetic";case Qn.Bottom:return"bottom";case Qn.Hanging:return"hanging";case Qn.Ideographic:return"ideographic";case Qn.Middle:return"middle";case Qn.Top:return"top";default:return"alphabetic"}},e.prototype._lookupFontStyle=function(t){var e=this.bold?" bold":"";switch(t){case Zn.Italic:return"italic"+e;case Zn.Normal:return"normal"+e;case Zn.Oblique:return"oblique"+e;default:return"normal"+e}},e.prototype.setTextShadow=function(t,e,n){this.spriteFont.setTextShadow(t,e,n)},e.prototype.useTextShadow=function(t){this.spriteFont.useTextShadow(t)},e.prototype.clearTextShadow=function(){this._textShadowOn=!1,this._shadowOffsetX=0,this._shadowOffsetY=0},e.prototype.update=function(e,n){t.prototype.update.call(this,e,n)},e.prototype.draw=function(e,n){e.save(),this._textShadowOn&&(e.save(),e.translate(this._shadowOffsetX,this._shadowOffsetY),this._fontDraw(e),e.restore()),this._fontDraw(e),t.prototype.draw.call(this,e,n),e.restore()},e.prototype._fontDraw=function(t){if(this.spriteFont)this.spriteFont.draw(t,this.text,0,0,{color:this.color.clone(),baseAlign:this.baseAlign,textAlign:this.textAlign,fontSize:this.fontSize,letterSpacing:this.letterSpacing,opacity:this.opacity});else{var e=t.textAlign,n=t.textBaseline;t.textAlign=this._lookupTextAlign(this.textAlign),t.textBaseline=this._lookupBaseAlign(this.baseAlign),this.color&&(this.color.a=this.opacity),t.fillStyle=this.color.toString(),t.font=this._fontString,this.maxWidth?t.fillText(this.text,0,0,this.maxWidth):t.fillText(this.text,0,0),t.textAlign=e,t.textBaseline=n}},Object.defineProperty(e.prototype,"_fontString",{get:function(){return this._lookupFontStyle(this.fontStyle)+" "+this.fontSize+this._lookupFontUnit(this.fontUnit)+" "+this.fontFamily},enumerable:!1,configurable:!0}),e.prototype.debugDraw=function(e){t.prototype.debugDraw.call(this,e)},e}(En))),si=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),ai={pos:V.Zero,width:10,height:10,visible:!1,action:function(){},filter:function(){return!0},repeat:-1},ci=function(t){function e(e){var n=t.call(this,e.pos.x,e.pos.y,e.width,e.height)||this;return n.action=function(){},n.filter=function(){return!0},n.repeat=-1,e=_({},ai,e),n.filter=e.filter||n.filter,n.repeat=e.repeat||n.repeat,n.action=e.action||n.action,e.target&&(n.target=e.target),n.visible=e.visible,n.body.collider.type=ut.Passive,n.eventDispatcher=new ee(n),n.actionQueue=new We(n),n.on("collisionstart",(function(t){Sn(t.other)&&n.filter(t.other)&&(n.emit("enter",new Nt(n,t.other)),n._dispatchAction(),0===n.repeat&&n.kill())})),n.on("collisionend",(function(t){Sn(t.other)&&n.filter(t.other)&&n.emit("exit",new Wt(n,t.other))})),n}return si(e,t),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){this._target=t,this.filter=function(e){return e===t}},enumerable:!1,configurable:!0}),e.prototype._initialize=function(e){t.prototype._initialize.call(this,e)},e.prototype._dispatchAction=function(){this.action.call(this),this.repeat--},e.prototype.debugDraw=function(e){t.prototype.debugDraw.call(this,e),e.save(),e.translate(this.pos.x,this.pos.y);var n=this.body.collider.bounds,i=this.getWorldPos();n.left=n.left-i.x,n.right=n.right-i.x,n.top=n.top-i.y,n.bottom=n.bottom-i.y,e.fillStyle=nt.Violet.toString(),e.strokeStyle=nt.Violet.toString(),e.fillText("Trigger",10,10),n.debugDraw(e),e.restore()},e}(En);function ui(t){return t instanceof Fn}!function(t){t.Update="update",t.Draw="draw"}(ri||(ri={}));var hi=function(){function t(){this.priority=0}return t.prototype.notify=function(t){},t}(),li=function(t){this.data=t,this.type="Entity Added"};function pi(t){return!!t&&"Entity Added"===t.type}var fi=function(t){this.data=t,this.type="Entity Removed"};function di(t){return!!t&&"Entity Removed"===t.type}var yi,gi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),_i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.types=["transform","canvas"],e.systemType=ri.Draw,e.priority=-1,e}return gi(e,t),e.prototype.initialize=function(t){this._ctx=t.engine.ctx,this._engine=t.engine,this._camera=t.camera},e.prototype.sort=function(t,e){return t.components.transform.z-e.components.transform.z},e.prototype.update=function(t,e){var n,i;this._clearScreen();for(var r=t.length,o=0;o<r;o++)t[o].visible&&!t[o].isOffScreen&&(n=t[o].components.transform,i=t[o].components.canvas,this._ctx.save(),this._pushCameraTransform(n),this._ctx.save(),this._applyTransform(t[o]),i.draw(this._ctx,e),this._ctx.restore(),this._popCameraTransform(n),this._ctx.restore()),this._engine.isDebug&&(this._ctx.save(),this._pushCameraTransform(n),this._ctx.strokeStyle="yellow",t[o].debugDraw(this._ctx),this._popCameraTransform(n),this._ctx.restore());this._engine.isDebug&&(this._ctx.save(),this._camera.draw(this._ctx),this._camera.debugDraw(this._ctx),this._ctx.restore())},e.prototype._applyTransform=function(t){for(var e=t.parent;e;)this._ctx.translate(e.pos.x,e.pos.y),this._ctx.rotate(e.rotation),this._ctx.scale(e.scale.x,e.scale.y),e=e.parent;this._ctx.translate(t.pos.x,t.pos.y),this._ctx.rotate(t.rotation),this._ctx.scale(t.scale.x,t.scale.y)},e.prototype._clearScreen=function(){this._ctx.clearRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this._ctx.fillStyle=this._engine.backgroundColor.toString(),this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)},e.prototype._pushCameraTransform=function(t){t.coordPlane===_n.World&&(this._ctx.save(),this._camera&&this._camera.draw(this._ctx))},e.prototype._popCameraTransform=function(t){t.coordPlane===_n.World&&this._ctx.restore()},e}(hi),vi=function(){function t(t){this._world=t,this.entities=[],this._entityIndex={}}return t.prototype.notify=function(t){dn(t)&&this._world.queryManager.addEntity(t.data.entity),gn(t)&&this._world.queryManager.removeComponent(t.data.entity,t.data.component)},t.prototype.addEntity=function(t){t&&(this._entityIndex[t.id]=t,this.entities.push(t),this._world.queryManager.addEntity(t),t.changes.register(this))},t.prototype.removeEntity=function(t){var e=0;e=t instanceof vn?t.id:t;var n=this._entityIndex[e];delete this._entityIndex[e],n&&(u.removeItemFromArray(n,this.entities),this._world.queryManager.removeEntity(n),n.changes.unregister(this))},t.prototype.processComponentRemovals=function(){for(var t=0,e=this.entities;t<e.length;t++){e[t].processComponentRemoval()}},t.prototype.getById=function(t){return this._entityIndex[t]},t.prototype.clear=function(){for(var t=0,e=this.entities;t<e.length;t++){var n=e[t];this.removeEntity(n)}},t}(),mi=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)i[r]=o[s];return i},bi=function(t){return mi(t).sort((function(t,e){return t.localeCompare(e)})).join("+")},wi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),xi=function(t){function e(e){var n=t.call(this)||this;return n.types=e,n._entities=[],n}return wi(e,t),Object.defineProperty(e.prototype,"key",{get:function(){return this._key?this._key:this._key=bi(this.types)},enumerable:!1,configurable:!0}),e.prototype.getEntities=function(t){return t&&this._entities.sort(t),this._entities},e.prototype.addEntity=function(t){!u.contains(this._entities,t)&&this.matches(t)&&(this._entities.push(t),this.notifyAll(new li(t)))},e.prototype.removeEntity=function(t){u.removeItemFromArray(t,this._entities)&&this.notifyAll(new fi(t))},e.prototype.clear=function(){this._entities.length=0;for(var t=0,e=this.observers;t<e.length;t++){var n=e[t];this.unregister(n)}},e.prototype.matches=function(t){var e=[];e=t instanceof vn?t.types:t;for(var n=!0,i=0,r=this.types;i<r.length;i++){var o=r[i];if(!(n=n&&e.indexOf(o)>-1))return!1}return n},e}(ln),Pi=function(){function t(t){this._world=t,this._queries={}}return t.prototype._addQuery=function(t){this._queries[bi(t.types)]=t;for(var e=0,n=this._world.entityManager.entities;e<n.length;e++){var i=n[e];t.addEntity(i)}},t.prototype.maybeRemoveQuery=function(t){0===t.observers.length&&(t.clear(),delete this._queries[bi(t.types)])},t.prototype.addEntity=function(t){for(var e in this._queries)this._queries[e]&&this._queries[e].addEntity(t)},t.prototype.removeComponent=function(t,e){for(var n in this._queries)this._queries[n].matches(t.types.concat([e.type]))&&this._queries[n].removeEntity(t)},t.prototype.removeEntity=function(t){for(var e in this._queries)this._queries[e].removeEntity(t)},t.prototype.createQuery=function(t){var e=this.getQuery(t);if(e)return e;var n=new xi(t);return this._addQuery(n),n},t.prototype.getQuery=function(t){var e=bi(t);return this._queries[e]?this._queries[e]:null},t}(),Ai=function(){function t(t){this._world=t,this.systems=[]}return t.prototype.addSystem=function(t){if(!t.types||0===t.types.length)throw new Error("Attempted to add a System without any types");var e=this._world.queryManager.createQuery(t.types);this.systems.push(t),this.systems.sort((function(t,e){return t.priority-e.priority})),e.register(t),t.initialize&&t.initialize(this._world.context)},t.prototype.removeSystem=function(t){u.removeItemFromArray(t,this.systems);var e=this._world.queryManager.getQuery(t.types);e&&(e.unregister(t),this._world.queryManager.maybeRemoveQuery(e))},t.prototype.updateSystems=function(t,e,n){for(var i=this.systems.filter((function(e){return e.systemType===t})),r=0,o=i;r<o.length;r++){(c=o[r]).preupdate&&c.preupdate(e,n)}for(var s=0,a=i;s<a.length;s++){var c=a[s],u=this._world.queryManager.getQuery(c.types).getEntities(c.sort);c.update(u,n)}for(var h=0,l=i;h<l.length;h++){(c=l[h]).postupdate&&c.postupdate(e,n)}},t.prototype.clear=function(){for(var t=0,e=this.systems;t<e.length;t++){var n=e[t];this.removeSystem(n)}},t}(),Si=function(){function t(t){this.context=t,this.queryManager=new Pi(this),this.entityManager=new vi(this),this.systemManager=new Ai(this)}return t.prototype.update=function(t,e){this.systemManager.updateSystems(t,this.context,e),this.entityManager.processComponentRemovals()},t.prototype.add=function(t){t instanceof vn&&this.entityManager.addEntity(t),t instanceof hi&&this.systemManager.addSystem(t)},t.prototype.remove=function(t){t instanceof vn&&this.entityManager.removeEntity(t),t instanceof hi&&this.systemManager.removeSystem(t)},t.prototype.clearEntities=function(){this.entityManager.clear()},t.prototype.clearSystems=function(){this.systemManager.clear()},t}(),Ei=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Ci=function(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},Oi=function(t){function e(e){var n=t.call(this)||this;return n.actors=[],n.world=new Si(n),n._bodies=[],n.triggers=[],n.tileMaps=[],n._isInitialized=!1,n._broadphase=new zn,n._killQueue=[],n._triggerKillQueue=[],n._timers=[],n._cancelQueue=[],n._logger=k.getInstance(),n.camera=new ni,e&&(n.engine=e,n.camera.x=n.engine.halfDrawWidth,n.camera.y=n.engine.halfDrawHeight),n}return Ei(e,t),Object.defineProperty(e.prototype,"screenElements",{get:function(){return this.actors.filter((function(t){return t instanceof Fn}))},enumerable:!1,configurable:!0}),e.prototype.on=function(e,n){t.prototype.on.call(this,e,n)},e.prototype.once=function(e,n){t.prototype.once.call(this,e,n)},e.prototype.off=function(e,n){t.prototype.off.call(this,e,n)},e.prototype.onInitialize=function(t){},e.prototype.onActivate=function(t,e){},e.prototype.onDeactivate=function(t,e){},e.prototype.onPreUpdate=function(t,e){},e.prototype.onPostUpdate=function(t,e){},e.prototype.onPreDraw=function(t,e){},e.prototype.onPostDraw=function(t,e){},e.prototype._initializeChildren=function(){for(var t=0,e=this.actors;t<e.length;t++){e[t]._initialize(this.engine)}},Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!1,configurable:!0}),e.prototype._initialize=function(t){this.isInitialized||(this.engine=t,this.camera&&(this.camera.x=t.halfDrawWidth,this.camera.y=t.halfDrawHeight),this.world.add(new _i),this.onInitialize.call(this,t),this._initializeChildren(),this._logger.debug("Scene.onInitialize",this,t),this.eventDispatcher.emit("initialize",new Ft(t,this)),this._isInitialized=!0)},e.prototype._activate=function(t,e){this._logger.debug("Scene.onActivate",this),this.onActivate(t,e)},e.prototype._deactivate=function(t,e){this._logger.debug("Scene.onDeactivate",this),this.onDeactivate(t,e)},e.prototype._preupdate=function(t,e){this.emit("preupdate",new bt(t,e,this)),this.onPreUpdate(t,e)},e.prototype._postupdate=function(t,e){this.emit("postupdate",new wt(t,e,this)),this.onPostUpdate(t,e)},e.prototype._predraw=function(t,e){this.emit("predraw",new gt(t,e,this)),this.onPreDraw(t,e)},e.prototype._postdraw=function(t,e){this.emit("postdraw",new _t(t,e,this)),this.onPostDraw(t,e)},e.prototype.update=function(t,e){var n,i;for(this._preupdate(t,e),this.world.update(ri.Update,e),this.camera&&this.camera.update(t,e),n=0,i=this._cancelQueue.length;n<i;n++)this.removeTimer(this._cancelQueue[n]);this._cancelQueue.length=0;for(var r=0,o=this._timers;r<o.length;r++){o[r].update(e)}for(n=0,i=this.tileMaps.length;n<i;n++)this.tileMaps[n].update(t,e);for(n=0,i=this.actors.length;n<i;n++)this.actors[n].update(t,e),this._bodies[n]=this.actors[n].body;for(n=0,i=this.triggers.length;n<i;n++)this.triggers[n].update(t,e);if(this._collectActorStats(t),t.input.pointers.dispatchPointerEvents(),this._broadphase&&at.enabled){var s=Date.now();this._broadphase.update(this._bodies,e);for(var a=this._broadphase.broadphase(this._bodies,e,t.stats.currFrame),c=Date.now(),u=Date.now(),h=at.collisionPasses,l=e/h;h>0;)a=this._broadphase.narrowphase(a,t.stats.currFrame),a=this._broadphase.resolve(a,l,at.collisionResolutionStrategy),this._broadphase.runCollisionStartEnd(a),h--;var p=Date.now();t.stats.currFrame.physics.broadphase=c-s,t.stats.currFrame.physics.narrowphase=p-u}t.stats.currFrame.actors.killed=this._killQueue.length+this._triggerKillQueue.length,this._processKillQueue(this._killQueue,this.actors),this._processKillQueue(this._triggerKillQueue,this.triggers),this._postupdate(t,e)},e.prototype._processKillQueue=function(t,e){for(var n,i=this,r=0,o=t;r<o.length;r++){var s=o[r];s.isKilled()&&(n=e.indexOf(s))>-1&&(e.splice(n,1),this.world.remove(s),s.children.forEach((function(t){return i.world.remove(t)})))}t.length=0},e.prototype.draw=function(t,e){this._predraw(t,e),this.world.update(ri.Draw,e),this._postdraw(t,e)},e.prototype.debugDraw=function(t){this.emit("predebugdraw",new vt(t,this)),this._broadphase.debugDraw(t,20),this.emit("postdebugdraw",new mt(t,this))},e.prototype.contains=function(t){return this.actors.indexOf(t)>-1},e.prototype.add=function(t){var e=this;t instanceof En&&t.unkill(),t instanceof En?T(this.actors,t)||(this._broadphase.track(t.body),t.scene=this,t instanceof ci?this.triggers.push(t):this.actors.push(t),this.world.add(t),t.children.forEach((function(t){return e.world.add(t)}))):t instanceof In?T(this._timers,t)||this.addTimer(t):t instanceof Wn&&(T(this.tileMaps,t)||this.addTileMap(t))},e.prototype.remove=function(t){if(t instanceof En){if(!T(this.actors,t))return;this._broadphase.untrack(t.body),t instanceof ci?this._triggerKillQueue.push(t):(t.isKilled()||t.kill(),this._killQueue.push(t)),t.parent=null}t instanceof In&&this.removeTimer(t),t instanceof Wn&&this.removeTileMap(t)},e.prototype.addScreenElement=function(t){this.add(t)},e.prototype.removeScreenElement=function(t){this.remove(t)},e.prototype.addTileMap=function(t){this.tileMaps.push(t),this.world.add(t)},e.prototype.removeTileMap=function(t){var e=this.tileMaps.indexOf(t);e>-1&&(this.tileMaps.splice(e,1),this.world.remove(t))},e.prototype.addTimer=function(t){return this._timers.push(t),t.scene=this,t},e.prototype.removeTimer=function(t){var e=this._timers.indexOf(t);return-1!==e&&this._timers.splice(e,1),t},e.prototype.cancelTimer=function(t){return this._cancelQueue.push(t),t},e.prototype.isTimerActive=function(t){return this._timers.indexOf(t)>-1&&!t.complete},e.prototype.isCurrentScene=function(){return!!this.engine&&this.engine.currentScene===this},e.prototype._collectActorStats=function(t){for(var e=0,n=this.screenElements;e<n.length;e++){n[e];t.stats.currFrame.actors.ui++}for(var i=0,r=this.actors;i<r.length;i++){var o=r[i];t.stats.currFrame.actors.alive++;for(var s=0,a=o.children;s<a.length;s++){ui(a[s])?t.stats.currFrame.actors.ui++:t.stats.currFrame.actors.alive++}}},Ci([q({message:"Will be removed in excalibur v0.26.0",alternateMethod:"ScreenElements now are normal actors with a Transform Coordinate Plane of Screen"})],e.prototype,"screenElements",null),Ci([q({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Scene.add"})],e.prototype,"addScreenElement",null),Ci([q({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Scene.remove"})],e.prototype,"removeScreenElement",null),Ci([q({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Scene.add"})],e.prototype,"addTileMap",null),Ci([q({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Scene.remove"})],e.prototype,"removeTileMap",null),e}(ne);!function(t){t[t.Protanope=0]="Protanope",t[t.Deuteranope=1]="Deuteranope",t[t.Tritanope=2]="Tritanope"}(yi||(yi={}));var Ti,Bi=function(){function t(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=yi.Protanope),this.engine=t,this.simulate=e,this.colorMode=n,this._vertexShader="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}",this._fragmentShader="precision mediump float;uniform sampler2D u_image;varying vec2 v_texCoord;void main() {vec4 o =  texture2D(u_image, v_texCoord);float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);//MODE CODE//vec4 error;error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);error.a = 1.0;vec4 diff = o - error;vec4 correction;correction.r = 0.0;correction.g =  (diff.r * 0.7) + (diff.g * 1.0);correction.b =  (diff.r * 0.7) + (diff.b * 1.0);correction = o + correction;correction.a = o.a;//SIMULATE//}",this._internalCanvas=document.createElement("canvas"),this._internalCanvas.width=t.drawWidth,this._internalCanvas.height=t.drawHeight,this._gl=this._internalCanvas.getContext("webgl",{preserveDrawingBuffer:!0}),this._program=this._gl.createProgram();var i=this._getShader("Fragment",this._getFragmentShaderByMode(n)),r=this._getShader("Vertex",this._vertexShader);this._gl.attachShader(this._program,r),this._gl.attachShader(this._program,i),this._gl.linkProgram(this._program),this._gl.getProgramParameter(this._program,this._gl.LINK_STATUS)||k.getInstance().error("Unable to link shader program!"),this._gl.useProgram(this._program)}return t.prototype._getFragmentShaderByMode=function(t){var e="";return t===yi.Protanope?e="float l = 0.0 * L + 2.02344 * M + -2.52581 * S;float m = 0.0 * L + 1.0 * M + 0.0 * S;float s = 0.0 * L + 0.0 * M + 1.0 * S;":t===yi.Deuteranope?e="float l = 1.0 * L + 0.0 * M + 0.0 * S;float m = 0.494207 * L + 0.0 * M + 1.24827 * S;float s = 0.0 * L + 0.0 * M + 1.0 * S;":t===yi.Tritanope&&(e="float l = 1.0 * L + 0.0 * M + 0.0 * S;float m = 0.0 * L + 1.0 * M + 0.0 * S;float s = -0.395913 * L + 0.801109 * M + 0.0 * S;"),this.simulate?this._fragmentShader=this._fragmentShader.replace("//SIMULATE//","gl_FragColor = error.rgba;"):this._fragmentShader=this._fragmentShader.replace("//SIMULATE//","gl_FragColor = correction.rgba;"),this._fragmentShader.replace("//MODE CODE//",e)},t.prototype._setRectangle=function(t,e,n,i){var r=t,o=t+n,s=e,a=e+i;this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array([r,s,o,s,r,a,r,a,o,s,o,a]),this._gl.STATIC_DRAW)},t.prototype._getShader=function(t,e){var n;return"Fragment"===t?n=this._gl.createShader(this._gl.FRAGMENT_SHADER):"Vertex"===t?n=this._gl.createShader(this._gl.VERTEX_SHADER):k.getInstance().error("Error unknown shader type",t),this._gl.shaderSource(n,e),this._gl.compileShader(n),this._gl.getShaderParameter(n,this._gl.COMPILE_STATUS)?n:(k.getInstance().error("Unable to compile shader!",this._gl.getShaderInfoLog(n)),null)},t.prototype.process=function(t,e){var n=this._gl.getAttribLocation(this._program,"a_position"),i=this._gl.getAttribLocation(this._program,"a_texCoord"),r=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,r),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),this._gl.STATIC_DRAW),this._gl.enableVertexAttribArray(i),this._gl.vertexAttribPointer(i,2,this._gl.FLOAT,!1,0,0);var o=this._gl.createTexture();this._gl.bindTexture(this._gl.TEXTURE_2D,o),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,1),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t);var s=this._gl.getUniformLocation(this._program,"u_resolution");this._gl.uniform2f(s,this._internalCanvas.width,this._internalCanvas.height);var a=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,a),this._gl.enableVertexAttribArray(n),this._gl.vertexAttribPointer(n,2,this._gl.FLOAT,!1,0,0),this._setRectangle(0,0,t.width,t.height),this._gl.drawArrays(this._gl.TRIANGLES,0,6);var c=new Uint8Array(t.width*t.height*4);this._gl.readPixels(0,0,t.width,t.height,this._gl.RGBA,this._gl.UNSIGNED_BYTE,c),t.data.set(c),e.putImageData(t,0,0)},t}(),Di=function(){function t(t){this._engine=t}return t.prototype.correct=function(t){this._engine.postProcessors.push(new Bi(this._engine,!1,t))},t.prototype.simulate=function(t){this._engine.postProcessors.push(new Bi(this._engine,!0,t))},t}(),Mi=function(t){this.stats={currFrame:new ji,prevFrame:new ji},this._engine=t,this.colorBlindMode=new Di(this._engine)},ji=function(){function t(){this._id=0,this._delta=0,this._fps=0,this._actorStats={alive:0,killed:0,ui:0,get remaining(){return this.alive-this.killed},get total(){return this.remaining+this.ui}},this._durationStats={update:0,draw:0,get total(){return this.update+this.draw}},this._physicsStats=new Ri}return t.prototype.reset=function(t){t?(this.id=t.id,this.delta=t.delta,this.fps=t.fps,this.actors.alive=t.actors.alive,this.actors.killed=t.actors.killed,this.actors.ui=t.actors.ui,this.duration.update=t.duration.update,this.duration.draw=t.duration.draw,this._physicsStats.reset(t.physics)):(this.id=this.delta=this.fps=0,this.actors.alive=this.actors.killed=this.actors.ui=0,this.duration.update=this.duration.draw=0,this._physicsStats.reset())},t.prototype.clone=function(){var e=new t;return e.reset(this),e},Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"delta",{get:function(){return this._delta},set:function(t){this._delta=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fps",{get:function(){return this._fps},set:function(t){this._fps=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"actors",{get:function(){return this._actorStats},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._durationStats},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"physics",{get:function(){return this._physicsStats},enumerable:!1,configurable:!0}),t}(),Ri=function(){function t(){this._pairs=0,this._collisions=0,this._collidersHash={},this._fastBodies=0,this._fastBodyCollisions=0,this._broadphase=0,this._narrowphase=0}return t.prototype.reset=function(t){t?(this.pairs=t.pairs,this.collisions=t.collisions,this.collidersHash=t.collidersHash,this.fastBodies=t.fastBodies,this.fastBodyCollisions=t.fastBodyCollisions,this.broadphase=t.broadphase,this.narrowphase=t.narrowphase):(this.pairs=this.collisions=this.fastBodies=0,this.fastBodyCollisions=this.broadphase=this.narrowphase=0,this.collidersHash={})},t.prototype.clone=function(){var e=new t;return e.reset(this),e},Object.defineProperty(t.prototype,"pairs",{get:function(){return this._pairs},set:function(t){this._pairs=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisions",{get:function(){return this._collisions},set:function(t){this._collisions=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collidersHash",{get:function(){return this._collidersHash},set:function(t){this._collidersHash=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fastBodies",{get:function(){return this._fastBodies},set:function(t){this._fastBodies=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fastBodyCollisions",{get:function(){return this._fastBodyCollisions},set:function(t){this._fastBodyCollisions=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"broadphase",{get:function(){return this._broadphase},set:function(t){this._broadphase=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"narrowphase",{get:function(){return this._narrowphase},set:function(t){this._narrowphase=t},enumerable:!1,configurable:!0}),t}(),ki=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();!function(t){t.Num0="Numpad0",t.Num1="Numpad1",t.Num2="Numpad2",t.Num3="Numpad3",t.Num4="Numpad4",t.Num5="Numpad5",t.Num6="Numpad6",t.Num7="Numpad7",t.Num8="Numpad8",t.Num9="Numpad9",t.NumAdd="NumpadAdd",t.NumSubtract="NumpadSubtract",t.NumMultiply="NumpadMultiply",t.NumDivide="NumpadDivide",t.NumDecimal="NumpadDecimal",t.Numpad0="Numpad0",t.Numpad1="Numpad1",t.Numpad2="Numpad2",t.Numpad3="Numpad3",t.Numpad4="Numpad4",t.Numpad5="Numpad5",t.Numpad6="Numpad6",t.Numpad7="Numpad7",t.Numpad8="Numpad8",t.Numpad9="Numpad9",t.NumpadAdd="NumpadAdd",t.NumpadSubtract="NumpadSubtract",t.NumpadMultiply="NumpadMultiply",t.NumpadDivide="NumpadDivide",t.NumpadDecimal="NumpadDecimal",t.NumLock="NumLock",t.ShiftLeft="ShiftLeft",t.ShiftRight="ShiftRight",t.AltLeft="AltLeft",t.AltRight="AltRight",t.Key0="Digit0",t.Key1="Digit1",t.Key2="Digit2",t.Key3="Digit3",t.Key4="Digit4",t.Key5="Digit5",t.Key6="Digit6",t.Key7="Digit7",t.Key8="Digit8",t.Key9="Digit9",t.Digit0="Digit0",t.Digit1="Digit1",t.Digit2="Digit2",t.Digit3="Digit3",t.Digit4="Digit4",t.Digit5="Digit5",t.Digit6="Digit6",t.Digit7="Digit7",t.Digit8="Digit8",t.Digit9="Digit9",t.A="KeyA",t.B="KeyB",t.C="KeyC",t.D="KeyD",t.E="KeyE",t.F="KeyF",t.G="KeyG",t.H="KeyH",t.I="KeyI",t.J="KeyJ",t.K="KeyK",t.L="KeyL",t.M="KeyM",t.N="KeyN",t.O="KeyO",t.P="KeyP",t.Q="KeyQ",t.R="KeyR",t.S="KeyS",t.T="KeyT",t.U="KeyU",t.V="KeyV",t.W="KeyW",t.X="KeyX",t.Y="KeyY",t.Z="KeyZ",t.KeyA="KeyA",t.KeyB="KeyB",t.KeyC="KeyC",t.KeyD="KeyD",t.KeyE="KeyE",t.KeyF="KeyF",t.KeyG="KeyG",t.KeyH="KeyH",t.KeyI="KeyI",t.KeyJ="KeyJ",t.KeyK="KeyK",t.KeyL="KeyL",t.KeyM="KeyM",t.KeyN="KeyN",t.KeyO="KeyO",t.KeyP="KeyP",t.KeyQ="KeyQ",t.KeyR="KeyR",t.KeyS="KeyS",t.KeyT="KeyT",t.KeyU="KeyU",t.KeyV="KeyV",t.KeyW="KeyW",t.KeyX="KeyX",t.KeyY="KeyY",t.KeyZ="KeyZ",t.Semicolon="Semicolon",t.Quote="Quote",t.Comma="Comma",t.Minus="Minus",t.Period="Period",t.Slash="Slash",t.Equal="Equal",t.BracketLeft="BracketLeft",t.Backslash="Backslash",t.BracketRight="BracketRight",t.Backquote="Backquote",t.Up="ArrowUp",t.Down="ArrowDown",t.Left="ArrowLeft",t.Right="ArrowRight",t.ArrowUp="ArrowUp",t.ArrowDown="ArrowDown",t.ArrowLeft="ArrowLeft",t.ArrowRight="ArrowRight",t.Space="Space",t.Esc="Escape",t.Escape="Escape"}(Ti||(Ti={}));var Fi,Ii,Li=function(t){function e(e){var n=t.call(this)||this;return n.key=e,n}return ki(e,t),e}(ht),Ui=function(t){function e(){var e=t.call(this)||this;return e._keys=[],e._keysUp=[],e._keysDown=[],e}return ki(e,t),e.prototype.on=function(e,n){t.prototype.on.call(this,e,n)},e.prototype.init=function(t){var e=this;if(!t)try{var n=function(){};window.top.addEventListener("blur",n),window.top.removeEventListener("blur",n),t=window.top}catch(e){t=window,k.getInstance().warn("Failed to bind to keyboard events to top frame. If you are trying to embed Excalibur in a cross-origin iframe, keyboard events will not fire.")}t.addEventListener("blur",(function(){e._keys.length=0})),t.addEventListener("keyup",(function(t){var n=t.code,i=e._keys.indexOf(n);e._keys.splice(i,1),e._keysUp.push(n);var r=new Li(n);e.eventDispatcher.emit("up",r),e.eventDispatcher.emit("release",r)})),t.addEventListener("keydown",(function(t){var n=t.code;if(-1===e._keys.indexOf(n)){e._keys.push(n),e._keysDown.push(n);var i=new Li(n);e.eventDispatcher.emit("down",i),e.eventDispatcher.emit("press",i)}}))},e.prototype.update=function(){this._keysDown.length=0,this._keysUp.length=0;for(var t=0;t<this._keys.length;t++)this.eventDispatcher.emit("hold",new Li(this._keys[t]))},e.prototype.getKeys=function(){return this._keys},e.prototype.wasPressed=function(t){return this._keysDown.indexOf(t)>-1},e.prototype.isHeld=function(t){return this._keys.indexOf(t)>-1},e.prototype.wasReleased=function(t){return this._keysUp.indexOf(t)>-1},e}(ne),zi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Ni=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)i[r]=o[s];return i};!function(t){t.Touch="Touch",t.Mouse="Mouse",t.Pen="Pen",t.Unknown="Unknown"}(Fi||(Fi={})),function(t){t.Canvas="Canvas",t.Document="Document"}(Ii||(Ii={}));var Wi,Hi,qi,Ki=function(t){function e(){var n=t.call(this)||this;return n.id=e._MAX_ID++,n._isDown=!1,n._wasDown=!1,n._actorsUnderPointer={length:0},n._actors=[],n._actorsLastFrame=[],n._actorsNoLongerUnderPointer=[],n.lastPagePos=null,n.lastScreenPos=null,n.lastWorldPos=null,n.dragTarget=null,n.on("move",n._onPointerMove),n.on("down",n._onPointerDown),n.on("up",n._onPointerUp),n}return zi(e,t),Object.defineProperty(e.prototype,"isDragging",{get:function(){return this._isDown},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDragStart",{get:function(){return!this._wasDown&&this._isDown},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDragEnd",{get:function(){return this._wasDown&&!this._isDown},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasActorsUnderPointer",{get:function(){return!!this._actorsUnderPointer.length},enumerable:!1,configurable:!0}),e.prototype.on=function(e,n){t.prototype.on.call(this,e,n)},e.prototype.once=function(e,n){t.prototype.once.call(this,e,n)},e.prototype.off=function(e,n){t.prototype.off.call(this,e,n)},e.prototype.update=function(){this._wasDown&&!this._isDown?this._wasDown=!1:!this._wasDown&&this._isDown&&(this._wasDown=!0),this._actorsLastFrame=Ni(this._actors),this._actorsNoLongerUnderPointer=[]},e.prototype.addActorUnderPointer=function(t){this.isActorAliveUnderPointer(t)||(this._actorsUnderPointer[t.id]=t,this._actorsUnderPointer.length+=1,this._actors.push(t)),this._actors.sort((function(t,e){return t.z===e.z?t.id-e.id:t.z-e.z}))},e.prototype.removeActorUnderPointer=function(t){this.isActorAliveUnderPointer(t)&&(delete this._actorsUnderPointer[t.id],this._actorsUnderPointer.length-=1,O(t,this._actors),this._actorsNoLongerUnderPointer.push(t))},e.prototype.getActorsUnderPointer=function(){return this._actors},e.prototype.getActorsUnderPointerLastFrame=function(){return this._actorsLastFrame},e.prototype.getActorsForEvents=function(){return this._actors.concat(this._actorsLastFrame).filter((function(t,e,n){return n.indexOf(t)===e}))},e.prototype.checkActorUnderPointer=function(t){return!!this.lastWorldPos&&t.contains(this.lastWorldPos.x,this.lastWorldPos.y,!ui(t))},e.prototype.wasActorUnderPointer=function(t){return this._actorsLastFrame.indexOf(t)>-1},e.prototype.isActorAliveUnderPointer=function(t){return!(t.isKilled()||!t.scene||!this._actorsUnderPointer.hasOwnProperty(t.id.toString()))},e.prototype._onPointerMove=function(t){this.lastPagePos=new V(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new V(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new V(t.worldPos.x,t.worldPos.y)},e.prototype._onPointerDown=function(t){this.lastPagePos=new V(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new V(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new V(t.worldPos.x,t.worldPos.y),this._isDown=!0},e.prototype._onPointerUp=function(t){this._isDown=!1,this.dragTarget=null},e._MAX_ID=0,e}(ne),Vi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();!function(t){t[t.NoButton=-1]="NoButton",t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Unknown=3]="Unknown"}(Wi||(Wi={})),function(t){t.Left="Left",t.Middle="Middle",t.Right="Right",t.Unknown="Unknown",t.NoButton="NoButton"}(Hi||(Hi={})),function(t){t.Pixel="Pixel",t.Line="Line",t.Page="Page"}(qi||(qi={}));var Gi=function(t){function e(e,n,i,r,o,s){var a=t.call(this)||this;return a.coordinates=e,a.pointer=n,a.index=i,a.pointerType=r,a.button=o,a.ev=s,a}return Vi(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldPos",{get:function(){return this.coordinates.worldPos.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pagePos",{get:function(){return this.coordinates.pagePos.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"screenPos",{get:function(){return this.coordinates.screenPos.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this.coordinates.worldPos.clone()},enumerable:!1,configurable:!0}),e.prototype.propagate=function(t){this.doAction(t),this.bubbles&&t.parent&&this.propagate(t.parent)},e.prototype.doAction=function(t){t&&(this._onActionStart(t),t.emit(this._name,this),this._onActionEnd(t))},e.prototype._onActionStart=function(t){},e.prototype._onActionEnd=function(t){},e}(ht),Xi=function(){function t(t){this._pointerEventType=t}return t.prototype.create=function(t,e,n,i,r,o){return new this._pointerEventType(t,e,n,i,r,o)},t}(),Qi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vi(e,t),e}(Gi),Zi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="pointerup",e}return Vi(e,t),e.prototype._onActionEnd=function(t){this.pointer.isDragEnd&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragend",this)},e}(Gi),Yi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="pointerdown",e}return Vi(e,t),e.prototype._onActionEnd=function(t){this.pointer.isDragStart&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragstart",this)},e}(Gi),Ji=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="pointermove",e}return Vi(e,t),e.prototype.propagate=function(t){this.pointer.isActorAliveUnderPointer(t)&&(this.doAction(t),this.bubbles&&t.parent&&this.propagate(t.parent))},e.prototype._onActionStart=function(t){t.capturePointer.captureMoveEvents&&this.pointer.isDragging&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragmove",this)},e}(Gi),$i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="pointerenter",e}return Vi(e,t),e.prototype._onActionStart=function(t){t.capturePointer.captureMoveEvents},e.prototype._onActionEnd=function(t){this.pointer.isDragging&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragenter",this)},e}(Gi),tr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="pointerleave",e}return Vi(e,t),e.prototype._onActionStart=function(t){t.capturePointer.captureMoveEvents},e.prototype._onActionEnd=function(t){this.pointer.isDragging&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragleave",this)},e}(Gi),er=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="pointercancel",e}return Vi(e,t),e}(Gi),nr=function(t){function e(e,n,i,r,o,s,a,c,u,h,l,p){var f=t.call(this)||this;return f.x=e,f.y=n,f.pageX=i,f.pageY=r,f.screenX=o,f.screenY=s,f.index=a,f.deltaX=c,f.deltaY=u,f.deltaZ=h,f.deltaMode=l,f.ev=p,f}return Vi(e,t),e}(ht);function ir(t,e,n,i,r,o,s){var a;switch(t){case"up":a=new Xi(Zi);break;case"down":a=new Xi(Yi);break;case"move":a=new Xi(Ji);break;case"cancel":a=new Xi(er);break;case"enter":a=new Xi($i);break;case"leave":a=new Xi(tr)}return a.create(e,n,i,r,o,s)}var rr,or,sr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),ar=function(t){function e(e){var n=t.call(this)||this;return n._pointerDown=[],n._pointerUp=[],n._pointerMove=[],n._pointerCancel=[],n._wheel=[],n._pointers=[],n._activePointers=[],n._engine=e,n._pointers.push(new Ki),n._activePointers=[-1],n.primary=n._pointers[0],n}return sr(e,t),e.prototype.on=function(e,n){t.prototype.on.call(this,e,n)},e.prototype.init=function(t){(t=t||this._engine.canvas).addEventListener("touchstart",this._handleTouchEvent("down",this._pointerDown)),t.addEventListener("touchend",this._handleTouchEvent("up",this._pointerUp)),t.addEventListener("touchmove",this._handleTouchEvent("move",this._pointerMove)),t.addEventListener("touchcancel",this._handleTouchEvent("cancel",this._pointerCancel)),window.PointerEvent?(this._engine.canvas.style.touchAction="none",t.addEventListener("pointerdown",this._handlePointerEvent("down",this._pointerDown)),t.addEventListener("pointerup",this._handlePointerEvent("up",this._pointerUp)),t.addEventListener("pointermove",this._handlePointerEvent("move",this._pointerMove)),t.addEventListener("pointercancel",this._handlePointerEvent("cancel",this._pointerCancel))):window.MSPointerEvent?(this._engine.canvas.style.msTouchAction="none",t.addEventListener("MSPointerDown",this._handlePointerEvent("down",this._pointerDown)),t.addEventListener("MSPointerUp",this._handlePointerEvent("up",this._pointerUp)),t.addEventListener("MSPointerMove",this._handlePointerEvent("move",this._pointerMove)),t.addEventListener("MSPointerCancel",this._handlePointerEvent("cancel",this._pointerCancel))):(t.addEventListener("mousedown",this._handleMouseEvent("down",this._pointerDown)),t.addEventListener("mouseup",this._handleMouseEvent("up",this._pointerUp)),t.addEventListener("mousemove",this._handleMouseEvent("move",this._pointerMove)));var e={passive:!(this._engine.pageScrollPreventionMode===lr.All||this._engine.pageScrollPreventionMode===lr.Canvas)};"onwheel"in document.createElement("div")?t.addEventListener("wheel",this._handleWheelEvent("wheel",this._wheel),e):void 0!==document.onmousewheel?t.addEventListener("mousewheel",this._handleWheelEvent("wheel",this._wheel),e):t.addEventListener("MozMousePixelScroll",this._handleWheelEvent("wheel",this._wheel),e)},e.prototype.triggerEvent=function(t,e,n,i,r){void 0===n&&(n=Wi.Left),void 0===i&&(i="mouse"),void 0===r&&(r=0);var o,s=0,a=0;e instanceof Z?(s=e.pagePos.x,a=e.pagePos.y,o=e):(s=e.x,a=e.y,o=new Z(e.clone(),e.clone(),e.clone()));var c={pageX:s,pageY:a,pointerId:r,pointerType:i,button:n,preventDefault:function(){}};switch(t){case"move":this._handlePointerEvent(t,this._pointerMove,o)(c);break;case"down":this._handlePointerEvent(t,this._pointerDown,o)(c);break;case"up":this._handlePointerEvent(t,this._pointerUp,o)(c);break;case"cancel":this._handlePointerEvent(t,this._pointerCancel,o)(c)}for(var u=0,h=this._engine.currentScene.actors;u<h.length;u++){var l=h[u],p=l.traits.filter((function(t){return t instanceof Ye}))[0];p&&p.update(l,this._engine,1)}this.dispatchPointerEvents(),this.update()},e.prototype.update=function(){this._pointerUp.length=0,this._pointerDown.length=0,this._pointerMove.length=0,this._pointerCancel.length=0,this._wheel.length=0;for(var t=0;t<this._pointers.length;t++)this._pointers[t].update()},e.prototype.at=function(t){if(t>=this._pointers.length)for(var e=this._pointers.length-1,n=t;e<n;e++)this._pointers.push(new Ki),this._activePointers.push(-1);return this._pointers[t]},e.prototype.count=function(){return this._pointers.length},e.prototype.checkAndUpdateActorUnderPointer=function(t){for(var e=0,n=this._pointers;e<n.length;e++){var i=n[e];i.checkActorUnderPointer(t)?i.addActorUnderPointer(t):i.removeActorUnderPointer(t)}},e.prototype._dispatchWithBubble=function(t){for(var e=0,n=t;e<n.length;e++)for(var i=n[e],r=0,o=i.pointer.getActorsForEvents();r<o.length;r++){var s=o[r];if(i.propagate(s),!i.bubbles)break}},e.prototype._dispatchPointerLeaveEvents=function(){for(var t={},e=[],n=0,i=this._pointerMove;n<i.length;n++)for(var r=i[n],o=0,s=r.pointer.getActorsForEvents();o<s.length;o++){var a=s[o];if(!t[r.pointer.id+"+"+a.id]&&r.pointer.wasActorUnderPointer(a)&&!r.pointer.isActorAliveUnderPointer(a)){t[r.pointer.id+"+"+a.id]=r;var c=ir("leave",new Z(r.worldPos,r.pagePos,r.screenPos),r.pointer,r.index,r.pointerType,r.button,r.ev);c.propagate(a),e.push(c)}}return e},e.prototype._dispatchPointerEnterEvents=function(){for(var t={},e=[],n=0,i=this._pointerMove;n<i.length;n++)for(var r=i[n],o=0,s=r.pointer.getActorsForEvents();o<s.length;o++){var a=s[o];if(!t[r.pointer.id]&&!r.pointer.wasActorUnderPointer(a)&&r.pointer.isActorAliveUnderPointer(a)){t[r.pointer.id]=r;var c=ir("enter",new Z(r.worldPos,r.pagePos,r.screenPos),r.pointer,r.index,r.pointerType,r.button,r.ev);c.propagate(a),e.push(c),r.pointer.isDragging&&(r.pointer.dragTarget=a)}}return e},e.prototype.dispatchPointerEvents=function(){this._dispatchWithBubble(this._pointerDown),this._dispatchWithBubble(this._pointerUp),this._dispatchWithBubble(this._pointerMove),this._dispatchPointerLeaveEvents(),this._dispatchPointerEnterEvents(),this._dispatchWithBubble(this._pointerCancel);for(var t=0,e=this._wheel;t<e.length;t++)for(var n=e[t],i=0,r=this._pointers[n.index].getActorsUnderPointer();i<r.length;i++){var o=r[i];if(this._propagateWheelPointerEvent(o,n),!n.bubbles)break}},e.prototype._propagateWheelPointerEvent=function(t,e){t.emit("pointerwheel",e),e.bubbles&&t.parent&&this._propagateWheelPointerEvent(t.parent,e)},e.prototype._handleMouseEvent=function(t,e){var n=this;return function(i){i.preventDefault();var r=n.at(0),o=Z.fromPagePosition(i.pageX,i.pageY,n._engine),s=ir(t,o,r,0,Fi.Mouse,n._nativeButtonToPointerButton(i.button),i);e.push(s),r.eventDispatcher.emit(t,s)}},e.prototype._handleTouchEvent=function(t,e){var n=this;return function(i){i.preventDefault();for(var r=0,o=i.changedTouches.length;r<o;r++){var s=n._pointers.length>1?n._getPointerIndex(i.changedTouches[r].identifier):0;if(-1!==s){var a=n.at(s),c=Z.fromPagePosition(i.changedTouches[r].pageX,i.changedTouches[r].pageY,n._engine),u=ir(t,c,a,s,Fi.Touch,Hi.Unknown,i);e.push(u),a.eventDispatcher.emit(t,u),n._pointers.length>1&&("up"===t?n._activePointers[s]=-1:"down"===t&&(n._activePointers[s]=i.changedTouches[r].identifier))}}}},e.prototype._handlePointerEvent=function(t,e,n){var i=this;return function(r){r.preventDefault();var o=i._pointers.length>1?i._getPointerIndex(r.pointerId):0;if(-1!==o){var s=i.at(o),a=n||Z.fromPagePosition(r.pageX,r.pageY,i._engine),c=ir(t,a,s,o,i._stringToPointerType(r.pointerType),i._nativeButtonToPointerButton(r.button),r);e.push(c),s.eventDispatcher.emit(t,c),i._pointers.length>1&&("up"===t?i._activePointers[o]=-1:"down"===t&&(i._activePointers[o]=r.pointerId))}}},e.prototype._handleWheelEvent=function(t,e){var n=this;return function(i){(n._engine.pageScrollPreventionMode===lr.All||n._engine.pageScrollPreventionMode===lr.Canvas&&i.target===n._engine.canvas)&&i.preventDefault();var r=i.pageX-E(n._engine.canvas).x,o=i.pageY-E(n._engine.canvas).y,s=n._engine.screenToWorldCoordinates(new V(r,o)),a=i.deltaX||-.025*i.wheelDeltaX||0,c=i.deltaY||-.025*i.wheelDeltaY||-.025*i.wheelDelta||i.detail||0,u=i.deltaZ||0,h=qi.Pixel;i.deltaMode&&(1===i.deltaMode?h=qi.Line:2===i.deltaMode&&(h=qi.Page));var l=new nr(s.x,s.y,i.pageX,i.pageY,r,o,0,a,c,u,h,i);e.push(l),n.at(0).eventDispatcher.emit(t,l)}},e.prototype._getPointerIndex=function(t){var e;if((e=this._activePointers.indexOf(t))>-1)return e;for(var n=0;n<this._activePointers.length;n++)if(-1===this._activePointers[n])return n;return-1},e.prototype._nativeButtonToPointerButton=function(t){switch(t){case Wi.NoButton:return Hi.NoButton;case Wi.Left:return Hi.Left;case Wi.Middle:return Hi.Middle;case Wi.Right:return Hi.Right;case Wi.Unknown:return Hi.Unknown;default:return R(t)}},e.prototype._stringToPointerType=function(t){switch(t){case"touch":return Fi.Touch;case"mouse":return Fi.Mouse;case"pen":return Fi.Pen;default:return Fi.Unknown}},e}(ne),cr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),ur=function(t){function e(){var e=t.call(this)||this;return e.enabled=!1,e.supported=!!navigator.getGamepads,e._gamePadTimeStamps=[0,0,0,0],e._oldPads=[],e._pads=[],e._initSuccess=!1,e._navigator=navigator,e._minimumConfiguration=null,e}return cr(e,t),e.prototype.init=function(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))},e.prototype.setMinimumGamepadConfiguration=function(t){this._enableAndUpdate(),this._minimumConfiguration=t},e.prototype._enableAndUpdate=function(){this.enabled||(this.enabled=!0,this.update())},e.prototype._isGamepadValid=function(t){if(!this._minimumConfiguration)return!0;if(!t)return!1;var e=t.axes.filter((function(t){return void 0!==typeof t})).length,n=t.buttons.filter((function(t){return void 0!==typeof t})).length;return e>=this._minimumConfiguration.axis&&n>=this._minimumConfiguration.buttons&&t.connected},e.prototype.on=function(e,n){this._enableAndUpdate(),t.prototype.on.call(this,e,n)},e.prototype.off=function(e,n){this._enableAndUpdate(),t.prototype.off.call(this,e,n)},e.prototype.update=function(){if(this.enabled&&this.supported){this.init();for(var t=this._navigator.getGamepads(),e=0;e<t.length;e++)if(t[e]){if(!this.at(e).connected&&this._isGamepadValid(t[e])&&this.eventDispatcher.emit("connect",new At(e,this.at(e))),this.at(e).connected=!0,!t[e].timestamp||t[e].timestamp!==this._gamePadTimeStamps[e]){this._gamePadTimeStamps[e]=t[e].timestamp,this.at(e).navigatorGamepad=t[e];var n=void 0,i=void 0,r=void 0,o=void 0,s=void 0;for(n in rr)"number"==typeof(i=rr[n])&&t[e].buttons[i]&&(s=t[e].buttons[i].value)!==this._oldPads[e].getButton(i)&&(t[e].buttons[i].pressed?(this.at(e).updateButton(i,s),this.at(e).eventDispatcher.emit("button",new Et(i,s,this.at(e)))):this.at(e).updateButton(i,0));for(r in or)"number"==typeof(o=or[r])&&(s=t[e].axes[o])!==this._oldPads[e].getAxes(o)&&(this.at(e).updateAxes(o,s),this.at(e).eventDispatcher.emit("axis",new Ct(o,s,this.at(e))));this._oldPads[e]=this._clonePad(t[e])}}else{var a=this.at(e);a.connected&&this.eventDispatcher.emit("disconnect",new St(e,a)),a.connected=!1}}},e.prototype.at=function(t){if(this._enableAndUpdate(),t>=this._pads.length)for(var e=this._pads.length-1,n=t;e<n;e++)this._pads.push(new hr),this._oldPads.push(new hr);return this._pads[t]},e.prototype.getValidGamepads=function(){this._enableAndUpdate();for(var t=[],e=0;e<this._pads.length;e++)this._isGamepadValid(this.at(e).navigatorGamepad)&&this.at(e).connected&&t.push(this.at(e));return t},e.prototype.count=function(){return this._pads.filter((function(t){return t.connected})).length},e.prototype._clonePads=function(t){for(var e=[],n=0,i=t.length;n<i;n++)e.push(this._clonePad(t[n]));return e},e.prototype._clonePad=function(t){var e,n,i=new hr;if(!t)return i;for(e=0,n=t.buttons.length;e<n;e++)t.buttons[e]&&i.updateButton(e,t.buttons[e].value);for(e=0,n=t.axes.length;e<n;e++)i.updateAxes(e,t.axes[e]);return i},e.MinAxisMoveThreshold=.05,e}(ne),hr=function(t){function e(){var e=t.call(this)||this;e.connected=!1,e._buttons=new Array(16),e._axes=new Array(4);for(var n=0;n<e._buttons.length;n++)e._buttons[n]=0;for(n=0;n<e._axes.length;n++)e._axes[n]=0;return e}return cr(e,t),e.prototype.isButtonPressed=function(t,e){return void 0===e&&(e=1),this._buttons[t]>=e},e.prototype.getButton=function(t){return this._buttons[t]},e.prototype.getAxes=function(t){var e=this._axes[t];return Math.abs(e)<ur.MinAxisMoveThreshold?0:e},e.prototype.updateButton=function(t,e){this._buttons[t]=e},e.prototype.updateAxes=function(t,e){this._axes[t]=e},e}(ne);!function(t){t[t.Face1=0]="Face1",t[t.Face2=1]="Face2",t[t.Face3=2]="Face3",t[t.Face4=3]="Face4",t[t.LeftBumper=4]="LeftBumper",t[t.RightBumper=5]="RightBumper",t[t.LeftTrigger=6]="LeftTrigger",t[t.RightTrigger=7]="RightTrigger",t[t.Select=8]="Select",t[t.Start=9]="Start",t[t.LeftStick=10]="LeftStick",t[t.RightStick=11]="RightStick",t[t.DpadUp=12]="DpadUp",t[t.DpadDown=13]="DpadDown",t[t.DpadLeft=14]="DpadLeft",t[t.DpadRight=15]="DpadRight"}(rr||(rr={})),function(t){t[t.LeftStickX=0]="LeftStickX",t[t.LeftStickY=1]="LeftStickY",t[t.RightStickX=2]="RightStickX",t[t.RightStickY=3]="RightStickY"}(or||(or={}));var lr,pr=function(){function t(t){this.nativeComponent=t,this._paused=!1,this._nativeHandlers={}}return t.prototype.on=function(t,e){this._nativeHandlers[t]&&this.off(t,this._nativeHandlers[t]),this._nativeHandlers[t]=this._decorate(e),this.nativeComponent.addEventListener(t,this._nativeHandlers[t])},t.prototype.off=function(t,e){e||(e=this._nativeHandlers[t]),this.nativeComponent.removeEventListener(t,e),this._nativeHandlers[t]=null},t.prototype._decorate=function(t){var e=this;return function(n){e._paused||t(n)}},t.prototype.pause=function(){this._paused=!0},t.prototype.resume=function(){this._paused=!1},t.prototype.clear=function(){for(var t in this._nativeHandlers)this.off(t)},t}(),fr=function(){function t(t,e){this._windowGlobal=t,this._documentGlobal=e,this._windowComponent=new pr(this._windowGlobal),this._documentComponent=new pr(this._documentGlobal)}return Object.defineProperty(t.prototype,"window",{get:function(){return this._windowComponent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"document",{get:function(){return this._documentComponent},enumerable:!1,configurable:!0}),t.prototype.pause=function(){this.window.pause(),this.document.pause()},t.prototype.resume=function(){this.window.resume(),this.document.resume()},t.prototype.clear=function(){this.window.clear(),this.document.clear()},t}(),dr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),yr=function(){return(yr=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},gr=function(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};h(),function(t){t[t.None=0]="None",t[t.Canvas=1]="Canvas",t[t.All=2]="All"}(lr||(lr={}));var _r,vr=function(t){function e(n){var i,r,o,s=t.call(this)||this;s._hasStarted=!1,s.postProcessors=[],s.scenes={},s._animations=[],s._suppressPlayButton=!1,s.pauseAudioWhenHidden=!0,s._isDebug=!1,s.debugColor=new nt(255,255,255),s.enableCanvasTransparency=!0,s.onFatalException=function(t){k.getInstance().fatal(t)},s._timescale=1,s._isLoading=!1,s._isInitialized=!1,n=yr(yr({},e._DEFAULT_ENGINE_OPTIONS),n),p.freeze(),s.browser=new fr(window,document);var a=new Rn;if(!n.suppressMinimumBrowserFeatureDetection&&!(s._compatible=a.test())){var c=document.createElement("div");if(c.innerText="Sorry, your browser does not support all the features needed for Excalibur",document.body.appendChild(c),a.failedTests.forEach((function(t){var e=document.createElement("div");e.innerText="Browser feature missing "+t,document.body.appendChild(e)})),n.canvasElementId){var u=document.getElementById(n.canvasElementId);u&&u.parentElement.removeChild(u)}return s}s._compatible=!0,console.log&&!n.suppressConsoleBootMessage&&(console.log("%cPowered by Excalibur.js (v"+ho+")","background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;"),console.log("\n      /| ________________\nO|===|* >________________>\n      \\|"),console.log("Visit","http://excaliburjs.com","for more information")),n.suppressPlayButton&&(s._suppressPlayButton=!0),s._logger=k.getInstance(),s._logger.defaultLevel===M.Debug&&a.logBrowserFeatures(),s._logger.debug("Building engine..."),s.canvasElementId=n.canvasElementId,n.canvasElementId?(s._logger.debug("Using Canvas element specified: "+n.canvasElementId),s.canvas=document.getElementById(n.canvasElementId)):n.canvasElement?(s._logger.debug("Using Canvas element specified:",n.canvasElement),s.canvas=n.canvasElement):(s._logger.debug("Using generated canvas element"),s.canvas=document.createElement("canvas"));var h=null!==(i=n.displayMode)&&void 0!==i?i:Vt.Fixed;return n.width&&n.height||n.viewport?(void 0===n.displayMode&&(h=Vt.Fixed),s._logger.debug("Engine viewport is size "+n.width+" x "+n.height)):n.displayMode||(s._logger.debug("Engine viewport is fullscreen"),h=Vt.FullScreen),s.ctx=s.canvas.getContext("2d",{alpha:s.enableCanvasTransparency}),s.screen=new te({canvas:s.canvas,context:s.ctx,antialiasing:null===(r=n.antialiasing)||void 0===r||r,browser:s.browser,viewport:null!==(o=n.viewport)&&void 0!==o?o:{width:n.width,height:n.height},resolution:n.resolution,displayMode:h,position:n.position,pixelRatio:n.suppressHiDPIScaling?1:null}),s.screen.applyResolutionAndViewport(),n.backgroundColor&&(s.backgroundColor=n.backgroundColor.clone()),s.enableCanvasTransparency=n.enableCanvasTransparency,s._loader=new Mn,s.debug=new Mi(s),s._initialize(n),s.rootScene=s.currentScene=new Oi(s),s.addScene("root",s.rootScene),s.goToScene("root"),s}return dr(e,t),Object.defineProperty(e.prototype,"canvasWidth",{get:function(){return this.screen.canvasWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"halfCanvasWidth",{get:function(){return this.screen.halfCanvasWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvasHeight",{get:function(){return this.screen.canvasHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"halfCanvasHeight",{get:function(){return this.screen.halfCanvasHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"drawWidth",{get:function(){return this.screen.drawWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"halfDrawWidth",{get:function(){return this.screen.halfDrawWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"drawHeight",{get:function(){return this.screen.drawHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"halfDrawHeight",{get:function(){return this.screen.halfDrawHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHiDpi",{get:function(){return this.screen.isHiDpi},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stats",{get:function(){return this.debug.stats},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isFullscreen",{get:function(){return this.screen.isFullScreen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"displayMode",{get:function(){return this.screen.displayMode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pixelRatio",{get:function(){return this.screen.pixelRatio},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDebug",{get:function(){return this._isDebug},enumerable:!1,configurable:!0}),e.prototype.on=function(e,n){t.prototype.on.call(this,e,n)},e.prototype.once=function(e,n){t.prototype.once.call(this,e,n)},e.prototype.off=function(e,n){t.prototype.off.call(this,e,n)},e.prototype.getWorldBounds=function(){return this.screen.getWorldBounds()},Object.defineProperty(e.prototype,"timescale",{get:function(){return this._timescale},set:function(t){t<=0?k.getInstance().error("Cannot set engine.timescale to a value of 0 or less than 0."):this._timescale=t},enumerable:!1,configurable:!0}),e.prototype.playAnimation=function(t,e,n){this._animations.push(new mr(t,e,n))},e.prototype.addTileMap=function(t){this.currentScene.addTileMap(t)},e.prototype.removeTileMap=function(t){this.currentScene.removeTileMap(t)},e.prototype.addTimer=function(t){return this.currentScene.addTimer(t)},e.prototype.removeTimer=function(t){return this.currentScene.removeTimer(t)},e.prototype.addScene=function(t,e){this.scenes[t]&&this._logger.warn("Scene",t,"already exists overwriting"),this.scenes[t]=e},e.prototype.removeScene=function(t){if(t instanceof Oi)for(var e in this.scenes)this.scenes.hasOwnProperty(e)&&this.scenes[e]===t&&delete this.scenes[e];"string"==typeof t&&delete this.scenes[t]},e.prototype.add=function(t){2===arguments.length&&this.addScene(arguments[0],arguments[1]),this.currentScene.add(t)},e.prototype.remove=function(t){t instanceof En&&this.currentScene.remove(t),t instanceof Oi&&this.removeScene(t),"string"==typeof t&&this.removeScene(t)},e.prototype.goToScene=function(t){if(this.scenes[t]){var e=this.currentScene,n=this.scenes[t];this._logger.debug("Going to scene:",t),this.currentScene.isInitialized&&(this.currentScene._deactivate.call(this.currentScene,[e,n]),this.currentScene.eventDispatcher.emit("deactivate",new Lt(n,this.currentScene))),this.currentScene=n,this.screen.setCurrentCamera(n.camera),this.currentScene._initialize(this),this.currentScene._activate.call(this.currentScene,[e,n]),this.currentScene.eventDispatcher.emit("activate",new It(e,this.currentScene))}else this._logger.error("Scene",t,"does not exist!")},e.prototype.screenToWorldCoordinates=function(t){return this.screen.screenToWorldCoordinates(t)},e.prototype.worldToScreenCoordinates=function(t){return this.screen.worldToScreenCoordinates(t)},e.prototype._initialize=function(t){var e,n,i=this;this.pageScrollPreventionMode=t.scrollPreventionMode,this.input={keyboard:new Ui,pointers:new ar(this),gamepads:new ur},this.input.keyboard.init(),this.input.pointers.init(t&&t.pointerScope===Ii.Document?document:this.canvas),this.input.gamepads.init(),void 0!==document.hidden?(e="hidden",n="visibilitychange"):"msHidden"in document?(e="msHidden",n="msvisibilitychange"):"webkitHidden"in document&&(e="webkitHidden",n="webkitvisibilitychange"),this.browser.document.on(n,(function(){document[e]?(i.eventDispatcher.emit("hidden",new Dt(i)),i._logger.debug("Window hidden")):(i.eventDispatcher.emit("visible",new Bt(i)),i._logger.debug("Window visible"))})),this.canvasElementId||t.canvasElement||document.body.appendChild(this.canvas)},e.prototype.onInitialize=function(t){},e.prototype.setAntialiasing=function(t){this.screen.antialiasing=t},e.prototype.getAntialiasing=function(){return this.screen.antialiasing},Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!1,configurable:!0}),e.prototype._overrideInitialize=function(e){this.isInitialized||(this.onInitialize(e),t.prototype.emit.call(this,"initialize",new Ft(e,this)),this._isInitialized=!0)},e.prototype._update=function(t){if(this._isLoading)return this._loader.update(this,t),this.input.keyboard.update(),this.input.pointers.update(),void this.input.gamepads.update();this._overrideInitialize(this),this._preupdate(t),this.currentScene.update(this,t),this._animations=this._animations.filter((function(t){return!t.animation.isDone()})),this.input.keyboard.update(),this.input.pointers.update(),this.input.gamepads.update(),this._postupdate(t)},e.prototype._preupdate=function(t){this.emit("preupdate",new bt(this,t,this)),this.onPreUpdate(this,t)},e.prototype.onPreUpdate=function(t,e){},e.prototype._postupdate=function(t){this.emit("postupdate",new wt(this,t,this)),this.onPostUpdate(this,t)},e.prototype.onPostUpdate=function(t,e){},e.prototype._draw=function(t){var e=this.ctx;if(this._predraw(e,t),this._isLoading)this._loader.draw(e,t);else{e.clearRect(0,0,this.canvasWidth,this.canvasHeight),e.fillStyle=this.backgroundColor.toString(),e.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.currentScene.draw(this.ctx,t);for(var n=0,i=this._animations.length;n<i;n++)this._animations[n].animation.draw(e,this._animations[n].x,this._animations[n].y);if(this.isDebug){this.ctx.font="Consolas",this.ctx.fillStyle=this.debugColor.toString();for(var r=this.input.keyboard.getKeys(),o=0;o<r.length;o++)this.ctx.fillText(r[o].toString()+" : "+(Ti[r[o]]?Ti[r[o]]:"Not Mapped"),100,10*o+10);this.ctx.fillText("FPS:"+this.stats.currFrame.fps.toFixed(2).toString(),10,10)}for(var s=0;s<this.postProcessors.length;s++)this.postProcessors[s].process(this.ctx.getImageData(0,0,this.canvasWidth,this.canvasHeight),this.ctx);this._postdraw(e,t)}},e.prototype._predraw=function(t,e){this.emit("predraw",new gt(t,e,this)),this.onPreDraw(t,e)},e.prototype.onPreDraw=function(t,e){},e.prototype._postdraw=function(t,e){this.emit("postdraw",new _t(t,e,this)),this.onPostDraw(t,e)},e.prototype.onPostDraw=function(t,e){},e.prototype.showDebug=function(t){this._isDebug=t},e.prototype.toggleDebug=function(){return this._isDebug=!this._isDebug,this._isDebug},e.prototype.start=function(t){var n,i=this;return this._compatible?(this.screen.pushResolutionAndViewport(),this.screen.resolution=this.screen.viewport,this.screen.applyResolutionAndViewport(),t?(this._loader=t,this._loader.suppressPlayButton=this._suppressPlayButton||this._loader.suppressPlayButton,this._loader.wireEngine(this),n=this.load(this._loader)):n=d.resolve(),n.then((function(){i.screen.popResolutionAndViewport(),i.screen.applyResolutionAndViewport(),i.emit("start",new dt(i))})),this._hasStarted||(this._hasStarted=!0,this._logger.debug("Starting game..."),this.browser.resume(),e.createMainLoop(this,window.requestAnimationFrame,Date.now)(),this._logger.debug("Game started")),n):(new d).reject("Excalibur is incompatible with your browser")},e.createMainLoop=function(t,e,n){var i=n();return function r(){if(t._hasStarted)try{t._requestId=e(r),t.emit("preframe",new xt(t,t.stats.prevFrame));var o=n(),s=Math.floor(o-i)||1;s>200&&(s=1);var a=s*t.timescale,c=t.stats.prevFrame.id+1;t.stats.currFrame.reset(),t.stats.currFrame.id=c,t.stats.currFrame.delta=a,t.stats.currFrame.fps=1/(a/1e3);var u=n();t._update(a);var h=n();t._draw(a);var l=n();t.stats.currFrame.duration.update=h-u,t.stats.currFrame.duration.draw=l-h,i=o,t.emit("postframe",new Pt(t,t.stats.currFrame)),t.stats.prevFrame.reset(t.stats.currFrame)}catch(e){window.cancelAnimationFrame(t._requestId),t.stop(),t.onFatalException(e)}}},e.prototype.stop=function(){this._hasStarted&&(this.emit("stop",new yt(this)),this.browser.pause(),this._hasStarted=!1,this._logger.debug("Game stopped"))},e.prototype.isPaused=function(){return!this._hasStarted},e.prototype.screenshot=function(){var t=new Image,e=this.canvas.toDataURL("image/png");return t.src=e,t},e.prototype.load=function(t){var e=this,n=new d;return this._isLoading=!0,t.load().then((function(){e._suppressPlayButton?setTimeout((function(){e._isLoading=!1,n.resolve()}),500):(e._isLoading=!1,n.resolve())})),n},e._DEFAULT_ENGINE_OPTIONS={width:0,height:0,enableCanvasTransparency:!0,canvasElementId:"",canvasElement:void 0,pointerScope:Ii.Document,suppressConsoleBootMessage:null,suppressMinimumBrowserFeatureDetection:null,suppressHiDPIScaling:null,suppressPlayButton:null,scrollPreventionMode:lr.Canvas,backgroundColor:nt.fromHex("#2185d0")},gr([q({message:"Will be removed in excalibur v0.26.0"})],e.prototype,"playAnimation",null),e}(ne),mr=function(){function t(t,e,n){this.animation=t,this.x=e,this.y=n}return t=gr([q({message:"Will be removed in excalibur v0.26.0"})],t)}(),br=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),wr=function(t){function e(e,n){void 0===n&&(n="MediaEvent");var i=t.call(this)||this;return i.target=e,i._name=n,i}return br(e,t),Object.defineProperty(e.prototype,"bubbles",{get:function(){return!1},set:function(t){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_path",{get:function(){return null},set:function(t){},enumerable:!1,configurable:!0}),e.prototype.stopPropagation=function(){},e.prototype.action=function(){},e.prototype.propagate=function(){},e.prototype.layPath=function(t){},e}(ht),xr=function(t){function e(e,n){var i=t.call(this,e,"NativeSoundEvent")||this;return i.track=n,i}return br(e,t),e}(wr),Pr=function(t){function e(e,n){var i=t.call(this,e,"NativeSoundProcessedEvent")||this;return i._processedData=n,i.data=i._processedData,i}return br(e,t),e}(wr),Ar=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();!function(t){t[t.Circle=0]="Circle",t[t.Rectangle=1]="Rectangle"}(_r||(_r={}));var Sr=function(t){function e(e,n,i,r,o,s,a,c,u,h){return t.call(this,e,n,i,r,o,s,a,c,u,h)||this}return Ar(e,t),e}(ye(function(){function t(t,e,n,i,r,o,s,a,c,u){this.position=new V(0,0),this.velocity=new V(0,0),this.acceleration=new V(0,0),this.particleRotationalVelocity=0,this.currentRotation=0,this.focus=null,this.focusAccel=0,this.opacity=1,this.beginColor=nt.White,this.endColor=nt.White,this.life=300,this.fadeFlag=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=nt.White,this.emitter=null,this.particleSize=5,this.particleSprite=null,this.sizeRate=0,this.elapsedMultiplier=0;var h=t;if(h&&!(t instanceof Er)){var l=t;h=l.emitter,e=l.life,n=l.opacity,r=l.endColor,i=l.beginColor,o=l.position,s=l.velocity,a=l.acceleration,c=l.startSize,u=l.endSize}this.emitter=h,this.life=e||this.life,this.opacity=n||this.opacity,this.endColor=r||this.endColor.clone(),this.beginColor=i||this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.position=o||this.position,this.velocity=s||this.velocity,this.acceleration=a||this.acceleration,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.opacity/this.life,this.startSize=c||0,this.endSize=u||0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.particleSize=this.startSize)}return t.prototype.kill=function(){this.emitter.removeParticle(this)},t.prototype.update=function(t){if(this.life=this.life-t,this.elapsedMultiplier=this.elapsedMultiplier+t,this.life<0&&this.kill(),this.fadeFlag&&(this.opacity=b(this._aRate*this.life,1e-4,1)),this.startSize>0&&this.endSize>0&&(this.particleSize=b(this.sizeRate*t+this.particleSize,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=b(this._currentColor.r+this._rRate*t,0,255),this._currentColor.g=b(this._currentColor.g+this._gRate*t,0,255),this._currentColor.b=b(this._currentColor.b+this._bRate*t,0,255),this._currentColor.a=b(this.opacity,1e-4,1),this.focus){var e=this.focus.sub(this.position).normalize().scale(this.focusAccel).scale(t/1e3);this.velocity=this.velocity.add(e)}else this.velocity=this.velocity.add(this.acceleration.scale(t/1e3));this.position=this.position.add(this.velocity.scale(t/1e3)),this.particleRotationalVelocity&&(this.currentRotation=(this.currentRotation+this.particleRotationalVelocity*t/1e3)%(2*Math.PI))},t.prototype.draw=function(t){if(this.particleSprite)return this.particleSprite.rotation=this.currentRotation,this.particleSprite.scale.setTo(this.particleSize,this.particleSize),void this.particleSprite.draw(t,this.position.x,this.position.y);this._currentColor.a=b(this.opacity,1e-4,1),t.fillStyle=this._currentColor.toString(),t.beginPath(),t.arc(this.position.x,this.position.y,this.particleSize,0,2*Math.PI),t.fill(),t.closePath()},t}())),Er=function(t){function e(e,n,i,r){return t.call(this,e,n,i,r)||this}return Ar(e,t),e}(ye(function(t){function e(e,n,i,r){var o=t.call(this,"number"==typeof e?{pos:new V(e,n),width:i,height:r}:e)||this;o.numParticles=0,o.isEmitting=!0,o.particles=null,o.deadParticles=null,o.minVel=0,o.maxVel=0,o.acceleration=new V(0,0),o.minAngle=0,o.maxAngle=0,o.emitRate=1,o.particleLife=2e3,o.opacity=1,o.fadeFlag=!1,o.focus=null,o.focusAccel=1,o.startSize=null,o.endSize=null,o.minSize=5,o.maxSize=5,o.beginColor=nt.White,o.endColor=nt.White,o.particleSprite=null,o.emitterType=_r.Rectangle,o.radius=0,o.particleRotationalVelocity=0,o.randomRotation=!1,o._particlesToEmit=0,o.body.collider.type=ut.PreventCollision,o.particles=new j,o.deadParticles=new j,o.random=new y;for(var s=0;s<o.traits.length;s++)o.traits[s]instanceof Ze&&o.traits.splice(s,1);return o}return Ar(e,t),e.prototype.removeParticle=function(t){this.deadParticles.push(t)},e.prototype.emitParticles=function(t){for(var e=0;e<t;e++)this.particles.push(this._createParticle())},e.prototype.clearParticles=function(){this.particles.clear()},e.prototype._createParticle=function(){var t=0,e=0,n=w(this.minAngle,this.maxAngle,this.random),i=w(this.minVel,this.maxVel,this.random),r=this.startSize||w(this.minSize,this.maxSize,this.random),o=i*Math.cos(n),s=i*Math.sin(n);if(this.emitterType===_r.Rectangle)t=w(0,this.width,this.random),e=w(0,this.height,this.random);else if(this.emitterType===_r.Circle){var a=w(0,this.radius,this.random);t=a*Math.cos(n),e=a*Math.sin(n)}var c=new Sr(this,this.particleLife,this.opacity,this.beginColor,this.endColor,new V(t,e),new V(o,s),this.acceleration,this.startSize,this.endSize);return c.fadeFlag=this.fadeFlag,c.particleSize=r,this.particleSprite&&(c.particleSprite=this.particleSprite),c.particleRotationalVelocity=this.particleRotationalVelocity,this.randomRotation&&(c.currentRotation=w(0,2*Math.PI,this.random)),this.focus&&(c.focus=this.focus.add(new V(this.pos.x,this.pos.y)),c.focusAccel=this.focusAccel),c},e.prototype.update=function(e,n){var i=this;t.prototype.update.call(this,e,n),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(n/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit))),this.particles.forEach((function(t){return t.update(n)})),this.deadParticles.forEach((function(t){return i.particles.removeElement(t)})),this.deadParticles.clear()},e.prototype.draw=function(t){this.particles.forEach((function(e){return e.draw(t)}))},e.prototype.debugDraw=function(e){t.prototype.debugDraw.call(this,e),e.fillStyle=nt.Black.toString(),e.fillText("Particles: "+this.particles.count(),this.pos.x,this.pos.y+20),this.focus&&(e.fillRect(this.focus.x+this.pos.x,this.focus.y+this.pos.y,3,3),Je(e,nt.Yellow,this.focus.x+this.pos.x,this.focus.y+this.pos.y,this.center.x,this.center.y),e.fillText("Focus",this.focus.x+this.pos.x,this.focus.y+this.pos.y))},e}(En))),Cr={Actions:o},Or=function(){function t(){}return t.create=function(t,e){if(this._CURRENT_GROUP>this._MAX_GROUPS)throw new Error("Cannot have more than "+this._MAX_GROUPS+" collision groups");if(this._GROUPS.get(t))throw new Error("Collision group "+t+" already exists");var n=new rn(t,this._CURRENT_BIT,void 0!==e?e:~this._CURRENT_BIT);return this._CURRENT_BIT=this._CURRENT_BIT<<1|0,this._CURRENT_GROUP++,this._GROUPS.set(t,n),n},Object.defineProperty(t,"groups",{get:function(){return Array.from(this._GROUPS.values())},enumerable:!1,configurable:!0}),t.groupByName=function(t){return this._GROUPS.get(t)},t.reset=function(){this._GROUPS=new Map,this._CURRENT_BIT=this._STARTING_BIT,this._CURRENT_GROUP=1},t._STARTING_BIT=1,t._MAX_GROUPS=32,t._CURRENT_GROUP=1,t._CURRENT_BIT=t._STARTING_BIT,t._GROUPS=new Map,t}(),Tr=function(){return(Tr=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},Br=function(){function t(t){this.lineWidth=5,this.filled=!1,this._points=[],this.anchor=V.Zero,this.offset=V.Zero,this.rotation=0,this.scale=V.One,this.opacity=1,this._points=t;var e=this._points.reduce((function(t,e){return Math.min(t,e.x)}),0),n=this._points.reduce((function(t,e){return Math.max(t,e.x)}),0);this.drawWidth=n-e;var i=this._points.reduce((function(t,e){return Math.min(t,e.y)}),0),r=this._points.reduce((function(t,e){return Math.max(t,e.y)}),0);this.drawHeight=r-i,this.height=this.drawHeight,this.width=this.drawWidth}return t.prototype.addEffect=function(){},t.prototype.removeEffect=function(){},t.prototype.clearEffects=function(){},t.prototype.reset=function(){},t.prototype.draw=function(t,e,n){t instanceof CanvasRenderingContext2D?this._drawWithOptions({ctx:t,x:e,y:n}):this._drawWithOptions(t)},t.prototype._drawWithOptions=function(t){var e,n,i,r,o,s,a,c,u=Tr(Tr({},t),{rotation:null!==(e=t.rotation)&&void 0!==e?e:this.rotation,drawWidth:null!==(n=t.drawWidth)&&void 0!==n?n:this.drawWidth,drawHeight:null!==(i=t.drawHeight)&&void 0!==i?i:this.drawHeight,flipHorizontal:null!==(r=t.flipHorizontal)&&void 0!==r?r:this.flipHorizontal,flipVertical:null!==(o=t.flipVertical)&&void 0!==o?o:this.flipVertical,anchor:null!==(s=t.anchor)&&void 0!==s?s:this.anchor,offset:null!==(a=t.offset)&&void 0!==a?a:this.offset,opacity:null!==(c=t.opacity)&&void 0!==c?c:this.opacity}),h=u.ctx,l=u.x,p=u.y,f=u.rotation,d=u.drawWidth,y=u.drawHeight,g=u.anchor,_=u.offset,v=u.opacity,m=u.flipHorizontal,b=u.flipVertical,w=d*g.x+_.x+l,x=y*g.y+_.y+p;h.save(),h.translate(w,x),h.scale(this.scale.x,this.scale.y),h.rotate(f),h.beginPath(),h.lineWidth=this.lineWidth;var P=this._points[0];h.moveTo(P.x,P.y);for(var A=0,S=this._points.length;A<S;A++)h.lineTo(this._points[A].x,this._points[A].y);h.lineTo(P.x,P.y),h.closePath(),this.filled&&(h.fillStyle=this.fillColor.toString(),h.fill()),h.strokeStyle=this.lineColor.toString(),m&&(h.translate(d,0),h.scale(-1,1)),b&&(h.translate(0,y),h.scale(1,-1));var E=h.globalAlpha;h.globalAlpha=null!=v?v:1,h.stroke(),h.globalAlpha=E,h.restore()},t}(),Dr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Mr=function(t){function e(e,n,i,r,o,s){return t.call(this,e,n,i,r,o,s)||this}return Dr(e,t),e}(ye(function(){function t(t,e,n,i,r,o){var s=this;this.sprites=[],this.image=null,this.columns=0,this.rows=0,this.spWidth=0,this.spHeight=0,this.spacing=0;var a=!1;if(t instanceof Array?this.sprites=t:(!t||t instanceof we?(this.image=t,this.columns=e,this.rows=n,this.spWidth=i,this.spHeight=r,this.spacing=o||0):(this.columns=t.columns,this.rows=t.rows,this.spWidth=t.spWidth,this.spHeight=t.spHeight,this.image=t.image,this.spacing=t.spacing||0),this.sprites=new Array(this.columns*this.rows),a=!0),this.image instanceof we){var c=!1,u=!1;if(this.image.loaded.then((function(t){c=s.spWidth*s.columns>t.naturalWidth,u=s.spHeight*s.rows>t.naturalHeight})),c)throw new RangeError("SpriteSheet specified is wider, "+this.columns+" cols x "+this.spWidth+" pixels > "+this.image.image.naturalWidth+" pixels than image width");if(u)throw new RangeError("SpriteSheet specified is taller, "+this.rows+" rows x "+this.spHeight+" pixels > "+this.image.image.naturalHeight+" pixels than image height")}if(a)for(var h=0;h<this.rows;h++)for(var l=0;l<this.columns;l++)this.sprites[l+h*this.columns]=new me(this.image,l*this.spWidth+this.spacing*l+this.spacing,h*this.spHeight+this.spacing*h+this.spacing,this.spWidth,this.spHeight)}return t.prototype.getAnimationByIndices=function(t,e,n){var i=this,r=e.map((function(t){return i.sprites[t]}));return r=r.map((function(t){return t.clone()})),new Ae(t,r,n)},t.prototype.getAnimationBetween=function(t,e,n,i){var r=this.sprites.slice(e,n);return r=r.map((function(t){return t.clone()})),new Ae(t,r,i)},t.prototype.getAnimationForAll=function(t,e){var n=this.sprites.map((function(t){return t.clone()}));return new Ae(t,n,e)},t.prototype.getSprite=function(t){if(t>=0&&t<this.sprites.length)return this.sprites[t];throw new Error("Invalid index: "+t)},t.prototype.getAnimationByCoords=function(t,e,n){for(var i=0,r=0,o=new Array(e.length),s=0;s<e.length;s++){var a=e[s];a.image=a.image||this.image,i=Math.max(i,a.drawWidth),r=Math.max(r,a.drawHeight),o[s]=new me(a)}var c=new Ae(t,o,n);return c.drawWidth=i,c.drawHeight=r,c},t}())),jr=function(t){function e(e,n,i,r,o,s,a,c){return t.call(this,e,n,i,r,o,s,a,c)||this}return Dr(e,t),e}(ye(function(t){function e(e,n,i,r,o,s,a,c){var u=t.call(this,e instanceof we?{image:e,spWidth:s,spHeight:a,rows:o,columns:r,spacing:c||0}:e)||this;return u._currentColor=nt.Black,u._currentOpacity=1,u._sprites={},u._textShadowOn=!1,u._textShadowDirty=!0,u._textShadowColor=nt.Black,u._textShadowSprites={},u._shadowOffsetX=5,u._shadowOffsetY=5,!e||e instanceof we||(n=e.alphabet,i=e.caseInsensitive),u._alphabet=n,u._caseInsensitive=i,u._sprites=u.getTextSprites(),u}return Dr(e,t),e.prototype.getTextSprites=function(){for(var t={},e=0;e<this._alphabet.length;e++){var n=this._alphabet[e];this._caseInsensitive&&(n=n.toLowerCase()),t[n]=this.sprites[e].clone()}return t},e.prototype.setTextShadow=function(t,e,n){for(var i in this._textShadowOn=!0,this._shadowOffsetX=t,this._shadowOffsetY=e,this._textShadowColor=n.clone(),this._textShadowDirty=!0,this._sprites)this._textShadowSprites[i]=this._sprites[i].clone()},e.prototype.useTextShadow=function(t){this._textShadowOn=t,t&&this.setTextShadow(5,5,this._textShadowColor)},e.prototype.draw=function(t,e,n,i,r){if(r=this._parseOptions(r),this._currentColor.toString()!==r.color.toString()||this._currentOpacity!==r.opacity)for(var o in this._currentOpacity=r.opacity,this._currentColor=r.color,this._sprites)this._sprites[o].clearEffects(),this._sprites[o].fill(r.color),this._sprites[o].opacity(r.opacity);if(this._textShadowOn&&this._textShadowDirty&&this._textShadowColor){for(var s in this._textShadowSprites)this._textShadowSprites[s].clearEffects(),this._textShadowSprites[s].addEffect(new fe(this._textShadowColor.clone()));this._textShadowDirty=!1}var a=this.sprites[0],c=a.drawHeight,u=r.fontSize/c,h=e.length*a.drawWidth*u+e.length*r.letterSpacing,l=n;r.textAlign===Xn.Left||r.textAlign===Xn.Start?l=n:r.textAlign===Xn.Right||r.textAlign===Xn.End?l=n-h:r.textAlign===Xn.Center&&(l=n-h/2);var p=i-c*u;r.baseAlign===Qn.Top||r.baseAlign===Qn.Hanging?p=i:r.baseAlign===Qn.Ideographic||r.baseAlign===Qn.Bottom||r.baseAlign===Qn.Alphabetic?p=i-c*u:r.baseAlign===Qn.Middle&&(p=i-c*u/2);for(var f=0;f<e.length;f++){var d=e[f];this._caseInsensitive&&(d=d.toLowerCase());try{this._textShadowOn&&(this._textShadowSprites[d].scale.x=u,this._textShadowSprites[d].scale.y=u,this._textShadowSprites[d].draw(t,l+this._shadowOffsetX,p+this._shadowOffsetY));var y=this._sprites[d];y.scale.x=u,y.scale.y=u,y.draw(t,l,p),l+=y.drawWidth+r.letterSpacing}catch(t){k.getInstance().error("SpriteFont Error drawing char "+d)}}},e.prototype._parseOptions=function(t){return{fontSize:t.fontSize||10,letterSpacing:t.letterSpacing||0,color:t.color||nt.Black,textAlign:void 0===typeof t.textAlign?Xn.Left:t.textAlign,baseAlign:void 0===typeof t.baseAlign?Qn.Bottom:t.baseAlign,maxWidth:t.maxWidth||-1,opacity:t.opacity||0}},e}(Mr))),Rr=function(){function t(){}return t.type={any:"",blob:"blob",json:"json",text:"text",document:"document",arraybuffer:"arraybuffer"},t}();function kr(t){return!!t._initialize}function Fr(t){return!!t.onInitialize}function Ir(t){return!!t._preupdate}function Lr(t){return!!t.onPreUpdate}function Ur(t){return!!t.onPostUpdate}function zr(t){return!!t.onPostUpdate}function Nr(t){return!!t.onPreDraw}function Wr(t){return!!t.onPostDraw}function Hr(t,e,n){return e+t*(n-e)}function qr(t){return t*t*t*(t*(6*t-15)+10)}var Kr=function(){function t(t){this._perm=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this._p=new Uint8Array(512),this._defaultPerlinOptions={octaves:1,frequency:1,amplitude:1,persistance:.5},t=_({},this._defaultPerlinOptions,t),this.persistance=t.persistance,this.amplitude=t.amplitude,this.frequency=t.frequency,this.octaves=t.octaves,t.seed?this._random=new y(t.seed):this._random=new y,this._perm=this._random.shuffle(this._perm);for(var e=0;e<512;e++)this._p[e]=255&this._perm[e%256]}return t.prototype.noise=function(){for(var t=this.amplitude,e=this.frequency,n=0,i=0,r=0;r<this.octaves;r++){switch(arguments.length){case 1:n+=this._noise1d(arguments[0]*e)*t;break;case 2:n+=this._noise2d(arguments[0]*e,arguments[1]*e)*t;break;case 3:n+=this._noise3d(arguments[0]*e,arguments[1]*e,arguments[2]*e)*t;break;default:throw new Error("Invalid arguments for perlin noise")}i+=t,t*=this.persistance,e*=2}return n/i},t.prototype.sequence=function(t,e){e||(e=1/t);for(var n=new Array(t),i=0;i<t;i++)n[i]=this.noise(i*e);return n},t.prototype.grid=function(t,e,n){n||(n=1/Math.min(t,e));for(var i=new Array(t*e),r=0;r<e;r++)for(var o=0;o<t;o++)i[o+r*t]=this.noise(o*n,r*n);return i},t.prototype._gradient3d=function(t,e,n,i){var r=15&t,o=r<8?e:n,s=r<4?n:12===r||14===r?e:i;return(0==(1&r)?o:-o)+(0==(2&r)?s:-s)},t.prototype._gradient2d=function(t,e,n){var i=0==(1&t)?e:n;return 0==(2&t)?-i:i},t.prototype._gradient1d=function(t,e){return 0==(1&t)?-e:e},t.prototype._noise1d=function(t){var e=255&Math.floor(t);return(Hr(qr(t-=Math.floor(t)),this._gradient1d(this._p[e],t),this._gradient1d(this._p[e+1],t-1))+1)/2},t.prototype._noise2d=function(t,e){var n=255&Math.floor(t),i=255&Math.floor(e);t-=Math.floor(t),e-=Math.floor(e);var r=qr(t),o=qr(e),s=this._p[n]+i,a=this._p[n+1]+i;return(Hr(o,Hr(r,this._gradient2d(this._p[s],t,e),this._gradient2d(this._p[a],t-1,e)),Hr(r,this._gradient2d(this._p[s+1],t,e-1),this._gradient2d(this._p[a+1],t-1,e-1)))+1)/2},t.prototype._noise3d=function(t,e,n){var i=255&Math.floor(t),r=255&Math.floor(e),o=255&Math.floor(n);t-=Math.floor(t),e-=Math.floor(e),n-=Math.floor(n);var s=qr(t),a=qr(e),c=qr(n),u=this._p[i]+r,h=this._p[i+1]+r,l=this._p[u]+o,p=this._p[h]+o,f=this._p[u+1]+o,d=this._p[h+1]+o;return(Hr(c,Hr(a,Hr(s,this._gradient3d(this._p[l],t,e,n),this._gradient3d(this._p[p],t-1,e,n)),Hr(s,this._gradient3d(this._p[f],t,e-1,n),this._gradient3d(this._p[d],t-1,e-1,n))),Hr(a,Hr(s,this._gradient3d(this._p[l+1],t,e,n-1),this._gradient3d(this._p[p+1],t-1,e,n-1)),Hr(s,this._gradient3d(this._p[f+1],t,e-1,n-1),this._gradient3d(this._p[d+1],t-1,e-1,n-1))))+1)/2},t}(),Vr=function(){function t(t,e){this.generator=t,this.colorFcn=e,e||(this.colorFcn=function(t){return t<125?nt.Black:nt.White})}return t.prototype.image=function(t,e){var n=document.createElement("img"),i=document.createElement("canvas");i.width=t,i.height=e;var r=i.getContext("2d");return this.draw(r,0,0,t,e),n.src=i.toDataURL(),n},t.prototype.draw=function(t,e,n,i,r){for(var o=this.generator.grid(i,r),s=t.getImageData(e,n,i,r),a=0;a<r;a++)for(var c=0;c<i;c++){var u=o[c+i*a],h=255&Math.floor(255*u),l=4*(c+a*s.width),p=this.colorFcn(h);s.data[l]=p.r,s.data[l+1]=p.g,s.data[l+2]=p.b,s.data[l+3]=Math.floor(255*p.a)}t.putImageData(s,e,n)},t}(),Gr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Xr=function(){function t(){}return t.create=function(t){return t instanceof AudioBuffer?new Zr(t):new Qr(t)},t}(),Qr=function(){function t(t){this._src=t,this._volume=1,this._duration=void 0,this._loop=!1,this._isPlaying=!1,this._isPaused=!1}return Object.defineProperty(t.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this._instance&&(this._instance.loop=t,this._wireUpOnEnded())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=b(t,0,1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._duration},set:function(t){this._duration=t},enumerable:!1,configurable:!0}),t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.pause=function(){this._isPlaying&&(this._isPaused=!0,this._isPlaying=!1)},t.prototype.stop=function(){this._isPlaying&&(this._isPlaying=!1,this._isPaused=!1)},t.prototype.play=function(){return this._isPaused&&this._resumePlayBack(),this._isPlaying||this._startPlayBack(),this._playingPromise},t.prototype._startPlayBack=function(){this._isPlaying=!0,this._isPaused=!1,this._playingPromise=new d},t.prototype._resumePlayBack=function(){this._isPaused&&(this._isPaused=!1,this._isPlaying=!0)},t.prototype._wireUpOnEnded=function(){var t=this;this.loop||(this._instance.onended=function(){return t._handleOnEnded()})},t.prototype._handleOnEnded=function(){},t}(),Zr=function(t){function e(e){var n=t.call(this,e)||this;return n._audioContext=Cn.create(),n._volumeNode=n._audioContext.createGain(),n._currentOffset=0,n._createNewBufferSource(),n}return Gr(e,t),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(t){t=b(t,0,1),this._volume=t,this._isPlaying&&this._volumeNode.gain.setTargetAtTime?this._volumeNode.gain.setTargetAtTime(t,this._audioContext.currentTime,.1):this._volumeNode.gain.value=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_playbackRate",{get:function(){return this._instance?1/(this._instance.playbackRate.value||1):null},enumerable:!1,configurable:!0}),e.prototype.pause=function(){t.prototype.pause.call(this),this._instance.stop(0),this._setPauseOffset()},e.prototype.stop=function(){t.prototype.stop.call(this),this._currentOffset=0,this._instance.stop(0),this._instance.onended||this._handleOnEnded()},e.prototype._startPlayBack=function(){t.prototype._startPlayBack.call(this),this._instance||this._createNewBufferSource(),this._rememberStartTime(),this._volumeNode.connect(this._audioContext.destination),this._instance.start(0,0),this._currentOffset=0,this._playingPromise=new d,this._wireUpOnEnded()},e.prototype._resumePlayBack=function(){t.prototype._resumePlayBack.call(this),this._instance.onended=null,this._createNewBufferSource();var e=this._playbackRate*this._src.duration,n=this._currentOffset%e;this._rememberStartTime(-1e3*n),this._instance.start(0,n),this._wireUpOnEnded()},e.prototype._handleOnEnded=function(){this._isPaused||(this._isPlaying=!1,this._playingPromise.resolve(!0))},e.prototype._rememberStartTime=function(t){this._startTime=(new Date).getTime()+(0|t)},e.prototype._setPauseOffset=function(){this._currentOffset=((new Date).getTime()-this._startTime)*this._playbackRate/1e3},e.prototype._createNewBufferSource=function(){this._instance=this._audioContext.createBufferSource(),this._instance.buffer=this._src,this._instance.loop=this.loop,this._instance.playbackRate.setValueAtTime(1,0),this._instance.connect(this._volumeNode)},e}(Qr);function Yr(t){try{var e=new Audio,n=t.match(/.*\.([A-Za-z0-9]+)$/)[1];return!!e.canPlayType("audio/"+n)}catch(t){return k.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",t),!1}}var Jr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),$r=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i=t.call(this,"","")||this;i._loop=!1,i._volume=1,i._duration=void 0,i._isStopped=!1,i._isPaused=!1,i._tracks=[],i._wasPlayingOnHidden=!1,i._processedData=new d,i._audioContext=Cn.create(),i._detectResponseType();for(var r=0,o=e;r<o.length;r++){var s=o[r];if(Yr(s)){i.path=s;break}}return i.path||(i.logger.warn("This browser does not support any of the audio files specified:",e.join(", ")),i.logger.warn("Attempting to use",e[0]),i.path=e[0]),i}return Jr(e,t),Object.defineProperty(e.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t;for(var e=0,n=this._tracks;e<n.length;e++){n[e].loop=this._loop}this.logger.debug("Set loop for all instances of sound",this.path,"to",this._loop)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t;for(var e=0,n=this._tracks;e<n.length;e++){n[e].volume=this._volume}this.emit("volumechange",new xr(this)),this.logger.debug("Set loop for all instances of sound",this.path,"to",this._volume)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"instances",{get:function(){return this._tracks},enumerable:!1,configurable:!0}),e.prototype.wireEngine=function(t){var e=this;t&&(this._engine=t,this._engine.on("hidden",(function(){t.pauseAudioWhenHidden&&e.isPlaying()&&(e._wasPlayingOnHidden=!0,e.pause())})),this._engine.on("visible",(function(){t.pauseAudioWhenHidden&&e._wasPlayingOnHidden&&(e.play(),e._wasPlayingOnHidden=!1)})),this._engine.on("start",(function(){e._isStopped=!1})),this._engine.on("stop",(function(){e.stop(),e._isStopped=!0})))},e.prototype.instanceCount=function(){return this._tracks.length},e.prototype.isPlaying=function(){return this._tracks.some((function(t){return t.isPlaying()}))},e.prototype.play=function(t){return this.isLoaded()?this._isStopped?(this.logger.warn("Cannot start playing. Engine is in a stopped state."),d.resolve(!1)):(this.volume=t||this.volume,this._isPaused?this._resumePlayback():this._startPlayback()):(this.logger.warn("Cannot start playing. Resource",this.path,"is not loaded yet"),d.resolve(!0))},e.prototype.pause=function(){if(this.isPlaying()){for(var t=0,e=this._tracks;t<e.length;t++){e[t].pause()}this._isPaused=!0,this.emit("pause",new xr(this)),this.logger.debug("Paused all instances of sound",this.path)}},e.prototype.stop=function(){for(var t=0,e=this._tracks;t<e.length;t++){e[t].stop()}this.emit("stop",new xr(this)),this._isPaused=!1,this._tracks.length=0,this.logger.debug("Stopped all instances of sound",this.path)},e.prototype.setData=function(t){this.emit("emptied",new xr(this)),this.data=t,this._processedData=new d},e.prototype.processData=function(t){var e=this;return(t instanceof ArrayBuffer?this._processArrayBufferData(t):this._processBlobData(t)).then((function(t){return e._setProcessedData(t)}))},e.prototype.getTrackId=function(t){return this._tracks.indexOf(t)},e.prototype._resumePlayback=function(){if(this._isPaused){for(var t=[],e=0,n=this._tracks;e<n.length;e++){var i=n[e];t.push(i.play())}return this._isPaused=!1,this.emit("resume",new xr(this)),this.logger.debug("Resuming paused instances for sound",this.path,this._tracks),d.join(t)}return d.resolve(!0)},e.prototype._startPlayback=function(){var t=this,e=this._createNewTrack(),n=new d;return e.then((function(e){e.play().then((function(i){return t.emit("playbackend",new xr(t,e)),t._tracks.splice(t.getTrackId(e),1),n.resolve(i),i})),t.emit("playbackstart",new xr(t,e)),t.logger.debug("Playing new instance for sound",t.path)})),n},e.prototype._processArrayBufferData=function(t){var e=this,n=new d;return this._audioContext.decodeAudioData(t,(function(t){n.resolve(t)}),(function(){e.logger.error("Unable to decode  this browser may not fully support this format, or the file may be corrupt, if this is an mp3 try removing id3 tags and album art from the file."),n.resolve(void 0)})),n},e.prototype._processBlobData=function(e){return(new d).resolve(t.prototype.processData.call(this,e))},e.prototype._setProcessedData=function(t){this._processedData.resolve(t),this._duration="object"==typeof t?t.duration:void 0,this.emit("processed",new Pr(this,t))},e.prototype._createNewTrack=function(){var t=this,e=new d;return 0!==this._processedData.state()&&this.processData(this.data),this._processedData.then((function(n){return e.resolve(t._getTrackInstance(n)),n}),(function(e){t.logger.error(e,"Cannot create AudioInstance due to wrong processed data.")})),e},e.prototype._getTrackInstance=function(t){var e=Xr.create(t);return e.loop=this.loop,e.volume=this.volume,e.duration=this.duration,this._tracks.push(e),e},e.prototype._detectResponseType=function(){window.AudioContext?this.responseType=Rr.type.arraybuffer:this.responseType=Rr.type.blob},e}(re),to=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),eo=function(t){function e(e,n,i){void 0===n&&(n=nt.Magenta),void 0===i&&(i=!0);var r=t.call(this,e,"arraybuffer",i)||this;return r.path=e,r.color=n,r.bustCache=i,r.loaded=new d,r._isLoaded=!1,r._stream=null,r._gif=null,r._texture=[],r._animation=null,r._transparentColor=null,r._transparentColor=n,r}return to(e,t),e.prototype.isLoaded=function(){return this._isLoaded},e.prototype.load=function(){var e=this,n=new d;return t.prototype.load.call(this).then((function(){e._stream=new ro(e.getData()),e._gif=new oo(e._stream,e._transparentColor);for(var t=[],i=0;i<e._gif.images.length;i++){var r=new we(e._gif.images[i].src,!1);e._texture.push(r),t.push(r.load())}d.join(t).then((function(){e._isLoaded=!0,n.resolve(e._texture)}))}),(function(){n.reject("Error loading texture.")})),n},e.prototype.asSprite=function(t){return void 0===t&&(t=0),this._texture[t].asSprite()},e.prototype.asSpriteSheet=function(){var t=this._texture.map((function(t){return t.asSprite()}));return new Mr(t)},e.prototype.asAnimation=function(t,e){var n=this.asSpriteSheet();return this._animation=n.getAnimationForAll(t,e),this._animation},Object.defineProperty(e.prototype,"readCheckBytes",{get:function(){return this._gif.checkBytes},enumerable:!1,configurable:!0}),e}(re),no=function(t){return t.reduce((function(t,e){return 2*t+e}),0)},io=function(t){for(var e=[],n=7;n>=0;n--)e.push(!!(t&1<<n));return e},ro=function(t){var e=this;if(this.data=null,this.len=0,this.position=0,this.readByte=function(){if(e.position>=e.data.byteLength)throw new Error("Attempted to read past end of stream.");return e.data[e.position++]},this.readBytes=function(t){for(var n=[],i=0;i<t;i++)n.push(e.readByte());return n},this.read=function(t){for(var n="",i=0;i<t;i++)n+=String.fromCharCode(e.readByte());return n},this.readUnsigned=function(){var t=e.readBytes(2);return(t[1]<<8)+t[0]},this.data=new Uint8Array(t),this.len=this.data.byteLength,0===this.len)throw new Error("No data loaded from file")},oo=function(t,e){var n=this;void 0===e&&(e=nt.Magenta),this._st=null,this._handler={},this._transparentColor=null,this.frames=[],this.images=[],this.globalColorTable=[],this.checkBytes=[],this.parseColorTable=function(t){for(var e=[],i=0;i<t;i++){var r="#"+n._st.readBytes(3).map((function(t){var e=t.toString(16);return 1===e.length?"0"+e:e})).join("");e.push(r)}return e},this.readSubBlocks=function(){var t,e;e="";do{t=n._st.readByte(),e+=n._st.read(t)}while(0!==t);return e},this.parseHeader=function(){var t={sig:null,ver:null,width:null,height:null,colorRes:null,globalColorTableSize:null,gctFlag:null,sorted:null,globalColorTable:[],bgColor:null,pixelAspectRatio:null};if(t.sig=n._st.read(3),t.ver=n._st.read(3),"GIF"!==t.sig)throw new Error("Not a GIF file.");t.width=n._st.readUnsigned(),t.height=n._st.readUnsigned();var e=io(n._st.readByte());t.gctFlag=e.shift(),t.colorRes=no(e.splice(0,3)),t.sorted=e.shift(),t.globalColorTableSize=no(e.splice(0,3)),t.bgColor=n._st.readByte(),t.pixelAspectRatio=n._st.readByte(),t.gctFlag&&(t.globalColorTable=n.parseColorTable(1<<t.globalColorTableSize+1),n.globalColorTable=t.globalColorTable),n._handler.hdr&&n._handler.hdr(t)&&n.checkBytes.push(n._handler.hdr)},this.parseExt=function(t){switch(t.label=n._st.readByte(),t.label){case 249:t.extType="gce",function(t){n.checkBytes.push(n._st.readByte());var e=io(n._st.readByte());t.reserved=e.splice(0,3),t.disposalMethod=no(e.splice(0,3)),t.userInput=e.shift(),t.transparencyGiven=e.shift(),t.delayTime=n._st.readUnsigned(),t.transparencyIndex=n._st.readByte(),t.terminator=n._st.readByte(),n._handler.gce&&n._handler.gce(t)&&n.checkBytes.push(n._handler.gce)}(t);break;case 254:t.extType="com",function(t){t.comment=n.readSubBlocks(),n._handler.com&&n._handler.com(t)&&n.checkBytes.push(n._handler.com)}(t);break;case 1:t.extType="pte",function(t){n.checkBytes.push(n._st.readByte()),t.ptHeader=n._st.readBytes(12),t.ptData=n.readSubBlocks(),n._handler.pte&&n._handler.pte(t)&&n.checkBytes.push(n._handler.pte)}(t);break;case 255:t.extType="app",function(t){switch(n.checkBytes.push(n._st.readByte()),t.identifier=n._st.read(8),t.authCode=n._st.read(3),t.identifier){case"NETSCAPE":!function(t){n.checkBytes.push(n._st.readByte()),t.unknown=n._st.readByte(),t.iterations=n._st.readUnsigned(),t.terminator=n._st.readByte(),n._handler.app&&n._handler.app.NETSCAPE&&n._handler.app.NETSCAPE(t)&&n.checkBytes.push(n._handler.app)}(t);break;default:!function(t){t.appData=n.readSubBlocks(),n._handler.app&&n._handler.app[t.identifier]&&n._handler.app[t.identifier](t)&&n.checkBytes.push(n._handler.app[t.identifier])}(t)}}(t);break;default:t.extType="unknown",function(t){t.data=n.readSubBlocks(),n._handler.unknown&&n._handler.unknown(t)&&n.checkBytes.push(n._handler.unknown)}(t)}},this.parseImg=function(t){t.leftPos=n._st.readUnsigned(),t.topPos=n._st.readUnsigned(),t.width=n._st.readUnsigned(),t.height=n._st.readUnsigned();var e=io(n._st.readByte());t.lctFlag=e.shift(),t.interlaced=e.shift(),t.sorted=e.shift(),t.reserved=e.splice(0,2),t.lctSize=no(e.splice(0,3)),t.lctFlag&&(t.lct=n.parseColorTable(1<<t.lctSize+1)),t.lzwMinCodeSize=n._st.readByte();var i=n.readSubBlocks();t.pixels=function(t,e){for(var n,i,r=0,o=function(t){for(var n=0,i=0;i<t;i++)e.charCodeAt(r>>3)&1<<(7&r)&&(n|=1<<i),r++;return n},s=[],a=1<<t,c=a+1,u=t+1,h=[],l=function(){h=[],u=t+1;for(var e=0;e<a;e++)h[e]=[e];h[a]=[],h[c]=null};;)if(i=n,(n=o(u))!==a){if(n===c)break;if(n<h.length)i!==a&&h.push(h[i].concat(h[n][0]));else{if(n!==h.length)throw new Error("Invalid LZW code.");h.push(h[i].concat(h[i][0]))}s.push.apply(s,h[n]),h.length===1<<u&&u<12&&u++}else l();return s}(t.lzwMinCodeSize,i),t.interlaced&&(t.pixels=function(t,e){for(var n=new Array(t.length),i=t.length/e,r=function(i,r){var o=t.slice(r*e,(r+1)*e);n.splice.apply(n,[i*e,e].concat(o))},o=[0,4,2,1],s=[8,8,4,2],a=0,c=0;c<4;c++)for(var u=o[c];u<i;u+=s[c])r(u,a),a++;return n}(t.pixels,t.width)),n.frames.push(t),n.arrayToImage(t),n._handler.img&&n._handler.img(t)&&n.checkBytes.push(n._handler)},this.parseBlock=function(){var t={sentinel:n._st.readByte(),type:""};switch(String.fromCharCode(t.sentinel)){case"!":t.type="ext",n.parseExt(t);break;case",":t.type="img",n.parseImg(t);break;case";":t.type="eof",n._handler.eof&&n._handler.eof(t)&&n.checkBytes.push(n._handler.eof);break;default:throw new Error("Unknown block: 0x"+t.sentinel.toString(16))}"eof"!==t.type&&n.parseBlock()},this.arrayToImage=function(t){var e=0,i=document.createElement("canvas");i.id=e.toString(),i.width=t.width,i.height=t.height,e++;for(var r=i.getContext("2d"),o=0,s=0,a=0;a<t.pixels.length;a++)s%t.width==0&&(o++,s=0),n.globalColorTable[t.pixels[a]]===n._transparentColor.toHex()?r.fillStyle="rgba(0, 0, 0, 0)":r.fillStyle=n.globalColorTable[t.pixels[a]],r.fillRect(s,o,1,1),s++;var c=new Image;c.src=i.toDataURL(),n.images.push(c)},this._st=t,this._handler={},this._transparentColor=e,this.parseHeader(),this.parseBlock()},so=function(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},ao=function(){function t(t){this._getComparable=t}return t.prototype.find=function(t){return this._find(this._root,t)},t.prototype._find=function(t,e){return null!=t&&(this._getComparable(e)===t.getKey()?t.getData().indexOf(e)>-1:this._getComparable(e)<t.getKey()?this._find(t.getLeft(),e):this._find(t.getRight(),e))},t.prototype.get=function(t){return this._get(this._root,t)},t.prototype._get=function(t,e){return null==t?[]:e===t.getKey()?t.getData():e<t.getKey()?this._get(t.getLeft(),e):this._get(t.getRight(),e)},t.prototype.add=function(t){return null==this._root?(this._root=new co(this._getComparable(t),[t],null,null),!0):this._insert(this._root,t)},t.prototype._insert=function(t,e){return null!=t&&(this._getComparable(e)===t.getKey()?!(t.getData().indexOf(e)>-1)&&(t.getData().push(e),!0):this._getComparable(e)<t.getKey()?null==t.getLeft()?(t.setLeft(new co(this._getComparable(e),[e],null,null)),!0):this._insert(t.getLeft(),e):null==t.getRight()?(t.setRight(new co(this._getComparable(e),[e],null,null)),!0):this._insert(t.getRight(),e))},t.prototype.removeByComparable=function(t){this._root=this._remove(this._root,t)},t.prototype._remove=function(t,e){if(null==t)return null;if(this._getComparable(e)!==t.getKey())return this._getComparable(e)<t.getKey()?(t.setLeft(this._remove(t.getLeft(),e)),t):(t.setRight(this._remove(t.getRight(),e)),t);var n=t.getData().indexOf(e);if(n>-1){if(t.getData().splice(n,1),0===t.getData().length){if(null==t.getLeft()&&null==t.getRight())return null;if(null==t.getLeft())return t.getRight();if(null==t.getRight())return t.getLeft();var i=this._findMinNode(t.getRight());return t.setKey(i.getKey()),t.setData(i.getData()),t.setRight(this._cleanup(t.getRight(),i)),t}return t}return null},t.prototype._cleanup=function(t,e){var n=e.getKey();if(null==t)return null;if(n===t.getKey()){if(null==t.getLeft()&&null==t.getRight())return null;if(null==t.getLeft())return t.getRight();if(null==t.getRight())return t.getLeft();var i=this._findMinNode(t.getRight());return t.setKey(i.getKey()),t.setData(i.getData()),t.setRight(this._cleanup(t.getRight(),i)),t}return e.getKey()<t.getKey()?(t.setLeft(this._cleanup(t.getLeft(),e)),t):(t.setRight(this._cleanup(t.getRight(),e)),t)},t.prototype._findMinNode=function(t){for(var e=t;null!=e.getLeft();)e=e.getLeft();return e},t.prototype.list=function(){var t=new Array;return this._list(this._root,t),t},t.prototype._list=function(t,e){null!=t&&(this._list(t.getLeft(),e),t.getData().forEach((function(t){e.push(t)})),this._list(t.getRight(),e))},t=so([q({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use built in JS array.sort"})],t)}(),co=function(){function t(t,e,n,i){this._key=t,this._data=e,this._left=n,this._right=i}return t.prototype.getKey=function(){return this._key},t.prototype.setKey=function(t){this._key=t},t.prototype.getData=function(){return this._data},t.prototype.setData=function(t){this._data=t},t.prototype.getLeft=function(){return this._left},t.prototype.setLeft=function(t){this._left=t},t.prototype.getRight=function(){return this._right},t.prototype.setRight=function(t){this._right=t},t=so([q({message:"Will be removed in excalibur v0.26.0"})],t)}(),uo=function(){function t(t){this._key=0,this._key=t}return t.prototype.getTheKey=function(){return this._key},t.prototype.setKey=function(t){this._key=t},t}(),ho="0.25.0-alpha.7428+e6fe439";h()}])}));
//# sourceMappingURL=excalibur.min.js.map