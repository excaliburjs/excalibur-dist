/*! excalibur - v0.8.0 - 2017-01-02
* https://github.com/excaliburjs/Excalibur
* Copyright (c) 2017 Excalibur.js <https://github.com/excaliburjs/Excalibur/graphs/contributors>; Licensed BSD-2-Clause*/
var EX_VERSION = "0.8.0";
var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},__decorate=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g};"undefined"==typeof window&&(window={audioContext:function(){}}),"undefined"==typeof window||window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setInterval(a,1e3/60)}),"undefined"==typeof window||window.cancelAnimationFrame||(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(a){}),"undefined"==typeof window||window.AudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null==this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=0;d<f;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}}),Array.prototype.some||(Array.prototype.some=function(a){"use strict";if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=arguments.length>=2?arguments[1]:void 0,e=0;e<c;e++)if(e in b&&a.call(d,b[e],e,b))return!0;return!1}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e});var ex;!function(a){var b=function(){function a(a){this._engine=a,this.stats={currFrame:new c,prevFrame:new c}}return a}();a.Debug=b;var c=function(){function a(){this._id=0,this._delta=0,this._fps=0,this._actorStats={alive:0,killed:0,ui:0,get remaining(){return this.alive-this.killed},get total(){return this.remaining+this.ui}},this._durationStats={update:0,draw:0,get total(){return this.update+this.draw}},this._physicsStats=new d}return a.prototype.reset=function(a){a?(this.id=a.id,this.delta=a.delta,this.fps=a.fps,this.actors.alive=a.actors.alive,this.actors.killed=a.actors.killed,this.actors.ui=a.actors.ui,this.duration.update=a.duration.update,this.duration.draw=a.duration.draw,this._physicsStats.reset(a.physics)):(this.id=this.delta=this.fps=0,this.actors.alive=this.actors.killed=this.actors.ui=0,this.duration.update=this.duration.draw=0,this._physicsStats.reset())},a.prototype.clone=function(){var b=new a;return b.reset(this),b},Object.defineProperty(a.prototype,"id",{get:function(){return this._id},set:function(a){this._id=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"delta",{get:function(){return this._delta},set:function(a){this._delta=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fps",{get:function(){return this._fps},set:function(a){this._fps=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"actors",{get:function(){return this._actorStats},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"duration",{get:function(){return this._durationStats},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"physics",{get:function(){return this._physicsStats},enumerable:!0,configurable:!0}),a}();a.FrameStats=c;var d=function(){function a(){this._pairs=0,this._collisions=0,this._fastBodies=0,this._fastBodyCollisions=0,this._broadphase=0,this._narrowphase=0}return a.prototype.reset=function(a){a?(this.pairs=a.pairs,this.collisions=a.collisions,this.fastBodies=a.fastBodies,this.fastBodyCollisions=a.fastBodyCollisions,this.broadphase=a.broadphase,this.narrowphase=a.narrowphase):(this.pairs=this.collisions=this.fastBodies=0,this.fastBodyCollisions=this.broadphase=this.narrowphase=0)},a.prototype.clone=function(){var b=new a;return b.reset(this),b},Object.defineProperty(a.prototype,"pairs",{get:function(){return this._pairs},set:function(a){this._pairs=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"collisions",{get:function(){return this._collisions},set:function(a){this._collisions=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fastBodies",{get:function(){return this._fastBodies},set:function(a){this._fastBodies=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fastBodyCollisions",{get:function(){return this._fastBodyCollisions},set:function(a){this._fastBodyCollisions=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"broadphase",{get:function(){return this._broadphase},set:function(a){this._broadphase=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"narrowphase",{get:function(){return this._narrowphase},set:function(a){this._narrowphase=a},enumerable:!0,configurable:!0}),a}();a.PhysicsStats=d}(ex||(ex={}));var ex;!function(a){var b=4294967295,c=function(){function a(a){this.seed=a,this._lowerMask=2147483647,this._upperMask=2147483648,this._w=32,this._n=624,this._m=397,this._r=31,this._a=2567483615,this._u=11,this._s=7,this._b=2636928640,this._t=15,this._c=4022730752,this._l=18,this._f=1812433253,this._mt=new Array(this._n),this._mt[0]=(a||Date.now())>>>0;for(var b=1;b<this._n;b++){var c=this._mt[b-1]^this._mt[b-1]>>>this._w-2;this._mt[b]=(this._f*((4294901760&c)>>>16)<<16)+this._f*(65535&c)+b>>>0}this._index=this._n}return a.prototype._twist=function(){for(var a=[0,this._a],c=0,d=0;d<this._n-this._m;d++)c=this._mt[d]&this._upperMask|this._mt[d+1]&this._lowerMask,this._mt[d]=this._mt[d+this._m]^c>>>1^a[1&c]&b;for(;d<this._n-1;d++)c=this._mt[d]&this._upperMask|this._mt[d+1]&this._lowerMask,this._mt[d]=this._mt[d+(this._m-this._n)]^c>>>1^a[1&c]&b;c=this._mt[this._n-1]&this._upperMask|this._mt[0]&this._lowerMask,this._mt[this._n-1]=this._mt[this._m-1]^c>>>1^a[1&c]&b,this._index=0},a.prototype.nextInt=function(){this._index>=this._n&&this._twist();var a=this._mt[this._index++];return a^=a>>>this._u,a^=a<<this._s&this._b,a^=a<<this._t&this._c,a^=a>>>this._l,a>>>0},a.prototype.next=function(){return this.nextInt()*(1/4294967296)},a.prototype.floating=function(a,b){return(b-a)*this.next()+a},a.prototype.integer=function(a,b){return Math.floor((b-a+1)*this.next()+a)},a.prototype.bool=function(a){return void 0===a&&(a=.5),this.next()<=a},a.prototype.pickOne=function(a){return a[this.integer(0,a.length-1)]},a.prototype.pickSet=function(a,b,c){return void 0===c&&(c=!1),c?this._pickSetWithDuplicates(a,b):this._pickSetWithoutDuplicates(a,b)},a.prototype._pickSetWithoutDuplicates=function(a,b){if(b>a.length||b<0)throw new Error("Invalid number of elements to pick, must pick a value 0 < n <= length");if(b===a.length)return a;for(var c=new Array(b),d=0,e=a.slice(0);d<b;){var f=this.integer(0,e.length-1);c[d++]=e[f],e.splice(f,1)}return c},a.prototype._pickSetWithDuplicates=function(a,b){if(b<0)throw new Error("Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT");for(var c=new Array(b),d=0;d<b;d++)c.push(this.pickOne(a));return c},a.prototype.shuffle=function(a){for(var b=a.slice(0),c=null,d=0;d<b.length-2;d++){var e=this.integer(d,b.length-1);c=b[d],b[d]=b[e],b[e]=c}return b},a.prototype.range=function(a,b,c){for(var d=new Array(a),e=0;e<a;e++)d[e]=this.integer(b,c);return d},a.prototype.d4=function(){return this.integer(1,4)},a.prototype.d6=function(){return this.integer(1,6)},a.prototype.d8=function(){return this.integer(1,8)},a.prototype.d10=function(){return this.integer(1,10)},a.prototype.d12=function(){return this.integer(1,12)},a.prototype.d20=function(){return this.integer(1,20)},a}();a.Random=c}(ex||(ex={}));var ex;!function(a){function b(b){return b=a.Util.extend({},{message:"This method will be removed in future versions of Excalibur.",alternateMethod:null},b),function(c,d,e){if("function"!=typeof e.value&&"function"!=typeof e.get&&"function"!=typeof e.set)throw new SyntaxError("Only functions/getters/setters can be marked as obsolete");var f=""+(c.name||"")+(c.name?".":"")+d,g=f+" is marked obsolete: "+b.message+(b.alternateMethod?" Use "+b.alternateMethod+" instead":""),h=a.Util.extend({},e);return e.value?(h.value=function(){return a.Logger.getInstance().warn(g),e.value.apply(this,arguments)},h):(e.get&&(h.get=function(){return a.Logger.getInstance().warn(g),e.get.apply(this,arguments)}),e.set&&(h.set=function(){return a.Logger.getInstance().warn(g),e.set.apply(this,arguments)}),h)}}a.obsolete=b}(ex||(ex={}));var ex;!function(a){var b;!function(b){var c=function(){function a(){}return a.prototype.updatePixel=function(a,b,c){var d=4*(a+b*c.width),e=c.data,f=(e[d+0]+e[d+1]+e[d+2])/3;e[d+0]=f,e[d+1]=f,e[d+2]=f},a}();b.Grayscale=c;var d=function(){function a(){}return a.prototype.updatePixel=function(a,b,c){var d=4*(a+b*c.width),e=c.data;e[d+0]=255-e[d+0],e[d+1]=255-e[d+1],e[d+2]=255-e[d+2]},a}();b.Invert=d;var e=function(){function a(a){this.opacity=a}return a.prototype.updatePixel=function(a,b,c){var d=4*(a+b*c.width),e=c.data;0!==e[d+3]&&(e[d+3]=Math.round(this.opacity*e[d+3]))},a}();b.Opacity=e;var f=function(){function a(a){this.color=a}return a.prototype.updatePixel=function(a,b,c){var d=4*(a+b*c.width),e=c.data;0!==e[d+3]&&(e[d+0]=(e[d+0]+this.color.r)/2,e[d+1]=(e[d+1]+this.color.g)/2,e[d+2]=(e[d+2]+this.color.b)/2)},a}();b.Colorize=f;var g=function(){function b(a){void 0===a&&(a=.1),this.factor=a}return b.prototype.updatePixel=function(b,c,d){var e=4*(b+c*d.width),f=d.data,g=a.Color.fromRGB(f[e+0],f[e+1],f[e+2],f[e+3]).lighten(this.factor);f[e+0]=g.r,f[e+1]=g.g,f[e+2]=g.b,f[e+3]=g.a},b}();b.Lighten=g;var h=function(){function b(a){void 0===a&&(a=.1),this.factor=a}return b.prototype.updatePixel=function(b,c,d){var e=4*(b+c*d.width),f=d.data,g=a.Color.fromRGB(f[e+0],f[e+1],f[e+2],f[e+3]).darken(this.factor);f[e+0]=g.r,f[e+1]=g.g,f[e+2]=g.b,f[e+3]=g.a},b}();b.Darken=h;var i=function(){function b(a){void 0===a&&(a=.1),this.factor=a}return b.prototype.updatePixel=function(b,c,d){var e=4*(b+c*d.width),f=d.data,g=a.Color.fromRGB(f[e+0],f[e+1],f[e+2],f[e+3]).saturate(this.factor);f[e+0]=g.r,f[e+1]=g.g,f[e+2]=g.b,f[e+3]=g.a},b}();b.Saturate=i;var j=function(){function b(a){void 0===a&&(a=.1),this.factor=a}return b.prototype.updatePixel=function(b,c,d){var e=4*(b+c*d.width),f=d.data,g=a.Color.fromRGB(f[e+0],f[e+1],f[e+2],f[e+3]).desaturate(this.factor);f[e+0]=g.r,f[e+1]=g.g,f[e+2]=g.b,f[e+3]=g.a},b}();b.Desaturate=j;var k=function(){function a(a){this.color=a}return a.prototype.updatePixel=function(a,b,c){var d=4*(a+b*c.width),e=c.data;0!==e[d+3]&&(e[d+0]=this.color.r,e[d+1]=this.color.g,e[d+2]=this.color.b)},a}();b.Fill=k}(b=a.Effects||(a.Effects={}))}(ex||(ex={}));var ex;!function(a){var b=function(){function b(a,b){this.x=a,this.y=b}return b.fromAngle=function(a){return new b(Math.cos(a),Math.sin(a))},b.isValid=function(a){return null!==a&&void 0!==a&&(!isNaN(a.x)&&!isNaN(a.y)&&(a.x!==1/0&&a.y!==1/0&&a.x!==-(1/0)&&a.y!==1/0))},b.prototype.setTo=function(a,b){this.x=a,this.y=b},b.prototype.equals=function(a,b){return void 0===b&&(b=.001),Math.abs(this.x-a.x)<=b&&Math.abs(this.y-a.y)<=b},b.prototype.distance=function(a){return a||(a=b.Zero),Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},b.prototype.magnitude=function(){return this.distance()},b.prototype.normalize=function(){var a=this.distance();return a>0?new b(this.x/a,this.y/a):new b(0,1)},b.prototype.average=function(a){return this.add(a).scale(.5)},b.prototype.scale=function(a){return new b(this.x*a,this.y*a)},b.prototype.add=function(a){return new b(this.x+a.x,this.y+a.y)},b.prototype.sub=function(a){return new b(this.x-a.x,this.y-a.y)},b.prototype.addEqual=function(a){return this.x+=a.x,this.y+=a.y,this},b.prototype.subEqual=function(a){return this.x-=a.x,this.y-=a.y,this},b.prototype.scaleEqual=function(a){return this.x*=a,this.y*=a,this},b.prototype.dot=function(a){return this.x*a.x+this.y*a.y},b.prototype.cross=function(a){return a instanceof b?this.x*a.y-this.y*a.x:"number"==typeof a?new b(a*this.y,-a*this.x):void 0},b.prototype.perpendicular=function(){return new b(this.y,-this.x)},b.prototype.normal=function(){return this.perpendicular().normalize()},b.prototype.negate=function(){return this.scale(-1)},b.prototype.toAngle=function(){return Math.atan2(this.y,this.x)},b.prototype.rotate=function(c,d){d||(d=new a.Vector(0,0));var e=Math.sin(c),f=Math.cos(c),g=f*(this.x-d.x)-e*(this.y-d.y)+d.x,h=e*(this.x-d.x)+f*(this.y-d.y)+d.y;return new b(g,h)},b.prototype.clone=function(){return new b(this.x,this.y)},b.prototype.toString=function(){return"("+this.x+", "+this.y+")"},b}();b.Zero=new b(0,0),b.One=new b(1,1),b.Half=new b(.5,.5),b.Up=new b(0,-1),b.Down=new b(0,1),b.Left=new b(-1,0),b.Right=new b(1,0),a.Vector=b;var c=function(){function a(a,b){this.pos=a,this.dir=b.normalize()}return a.prototype.intersect=function(a){var b=a.begin.sub(this.pos);if(0===this.dir.cross(a.getSlope())&&0!==b.cross(this.dir))return-1;var c=this.dir.cross(a.getSlope());if(0===c)return-1;var d=b.cross(a.getSlope())/c;if(d>=0){var e=b.cross(this.dir)/c/a.getLength();if(e>=0&&e<=1)return d}return-1},a.prototype.getPoint=function(a){return this.pos.add(this.dir.scale(a))},a}();a.Ray=c;var d=function(){function c(a,b){this.begin=a,this.end=b}return Object.defineProperty(c.prototype,"slope",{get:function(){return(this.end.y-this.begin.y)/(this.end.x-this.begin.x)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"intercept",{get:function(){return this.begin.y-this.slope*this.begin.x},enumerable:!0,configurable:!0}),c.prototype.getSlope=function(){var a=this.begin,b=this.end,c=a.distance(b);return b.sub(a).scale(1/c)},c.prototype.getLength=function(){var a=this.begin,b=this.end,c=a.distance(b);return c},c.prototype.findPoint=function(b,c){void 0===b&&(b=null),void 0===c&&(c=null);var d=this.slope,e=this.intercept;return null!==b?new a.Vector(b,d*b+e):null!==c?new a.Vector((c-e)/d,c):void 0},c.prototype.hasPoint=function(){var a,c=0;if("number"==typeof arguments[0]&&"number"==typeof arguments[1])a=new b(arguments[0],arguments[1]),c=arguments[2]||0;else{if(!(arguments[0]instanceof b))throw"Could not determine the arguments for Vector.hasPoint";a=arguments[0],c=arguments[1]||0}var d=a.x-this.begin.x,e=a.y-this.begin.y,f=this.end.x-this.begin.x,g=this.end.y-this.begin.y,h=d*g-e*f;return!(Math.abs(h)>c)&&(Math.abs(f)>=Math.abs(g)?f>0?this.begin.x<=a.x&&a.x<=this.end.x:this.end.x<=a.x&&a.x<=this.begin.x:g>0?this.begin.y<=a.y&&a.y<=this.end.y:this.end.y<=a.y&&a.y<=this.begin.y)},c}();a.Line=d;var e=function(){function a(a,b){this.min=a,this.max=b}return a.prototype.overlaps=function(a){return this.max>a.min&&a.max>this.min},a.prototype.getOverlap=function(a){return this.overlaps(a)?this.max>a.max?a.max-this.min:this.max-a.min:0},a}();a.Projection=e}(ex||(ex={}));var ex;!function(a){var b;!function(a){a[a.Box=0]="Box",a[a.RigidBody=1]="RigidBody"}(b=a.CollisionResolutionStrategy||(a.CollisionResolutionStrategy={}));var c;!function(a){a[a.Naive=0]="Naive",a[a.DynamicAABBTree=1]="DynamicAABBTree"}(c=a.BroadphaseStrategy||(a.BroadphaseStrategy={}));var d;!function(a){a[a.Euler=0]="Euler"}(d=a.Integrator||(a.Integrator={}));var e=function(){function b(){}return b.useBoxPhysics=function(){a.Physics.collisionResolutionStrategy=a.CollisionResolutionStrategy.Box},b.useRigidBodyPhysics=function(){a.Physics.collisionResolutionStrategy=a.CollisionResolutionStrategy.RigidBody},b}();e.acc=new a.Vector(0,0),e.enabled=!0,e.collisionPasses=5,e.broadphaseStrategy=c.DynamicAABBTree,e.broadphaseDebug=!1,e.showCollisionNormals=!1,e.showMotionVectors=!1,e.showBounds=!1,e.showArea=!1,e.showContacts=!1,e.showNormals=!1,e.collisionResolutionStrategy=b.Box,e.defaultMass=10,e.integrator=d.Euler,e.integrationSteps=1,e.allowRigidBodyRotation=!0,e.collisionShift=.001,e.dynamicTreeVelocityMultiplyer=2,e.boundsPadding=5,e.surfaceEpsilon=.1,e.checkForFastBodies=!0,e.disableMinimumSpeedForFastBody=!1,a.Physics=e}(ex||(ex={}));var ex;!function(a){var b=function(){function b(a,b,c,d,e){this.bodyA=a,this.bodyB=b,this.mtv=c,this.point=d,this.normal=e}return b.prototype.resolve=function(b,c){if(c===a.CollisionResolutionStrategy.RigidBody)this._resolveRigidBodyCollision(b);else{if(c!==a.CollisionResolutionStrategy.Box)throw new Error("Unknown collision resolution strategy");this._resolveBoxCollision(b)}},b.prototype._applyBoxImpluse=function(b,c,d,e){if((b.collisionType===a.CollisionType.Active||b.collisionType===a.CollisionType.Elastic)&&c.collisionType!==a.CollisionType.Passive)if(b.collisionType===a.CollisionType.Active&&c.collisionType===a.CollisionType.Active&&(d=d.scale(.5)),b.pos.y+=d.y,b.pos.x+=d.x,b.collisionType===a.CollisionType.Elastic)e===a.Side.Left?b.vel.x=Math.abs(b.vel.x):e===a.Side.Right?b.vel.x=-Math.abs(b.vel.x):e===a.Side.Top?b.vel.y=Math.abs(b.vel.y):e===a.Side.Bottom&&(b.vel.y=-Math.abs(b.vel.y));else{if(0!==this.mtv.x){var f=0;b.vel.x<0&&c.vel.x<0?f=Math.min(b.vel.x,c.vel.x):b.vel.x>0&&c.vel.x>0?f=Math.max(b.vel.x,c.vel.x):c.collisionType===a.CollisionType.Fixed&&(f=b.pos.sub(c.pos).dot(b.vel)>0?b.vel.x:c.vel.x),b.vel.x=f}if(0!==this.mtv.y){var g=0;b.vel.y<0&&c.vel.y<0?g=Math.min(b.vel.y,c.vel.y):b.vel.y>0&&c.vel.y>0?g=Math.max(b.vel.y,c.vel.y):c.collisionType===a.CollisionType.Fixed&&(g=b.pos.sub(c.pos).dot(b.vel)>0?b.vel.y:c.vel.y),b.vel.y=g}}},b.prototype._resolveBoxCollision=function(b){var c=this.bodyA.body.actor,d=this.bodyB.body.actor,e=a.Util.getSideFromVector(this.mtv),f=this.mtv.negate();c.emit("collision",new a.CollisionEvent(c,d,e,f)),d.emit("collision",new a.CollisionEvent(d,c,a.Util.getOppositeSide(e),f.negate())),this._applyBoxImpluse(c,d,f,e),this._applyBoxImpluse(d,c,f.negate(),a.Util.getOppositeSide(e))},b.prototype._resolveRigidBodyCollision=function(b){var c=this.bodyA.body,d=this.bodyB.body,e=this.mtv,f=(this.point,this.normal);if(c.actor!==d.actor){var g=c.actor.collisionType===a.CollisionType.Fixed?0:1/c.mass,h=d.actor.collisionType===a.CollisionType.Fixed?0:1/d.mass,i=c.actor.collisionType===a.CollisionType.Fixed?0:1/c.moi,j=d.actor.collisionType===a.CollisionType.Fixed?0:1/d.moi,k=Math.min(c.restitution,d.restitution),l=Math.min(c.friction,d.friction);f=f.normalize();var m=f.normal().normalize(),n=this.point.sub(this.bodyA.getCenter()),o=this.point.sub(this.bodyB.getCenter()),p=d.vel.add(o.cross(-d.rx)).sub(c.vel.sub(n.cross(c.rx))),q=p.dot(f),r=p.dot(m),s=n.dot(m),t=n.dot(f),u=o.dot(m),v=o.dot(f);if(!(q>0)){var w=a.Util.getSideFromVector(this.mtv);c.actor.emit("collision",new a.CollisionEvent(this.bodyA.body.actor,this.bodyB.body.actor,w,this.mtv)),d.actor.emit("collision",new a.CollisionEvent(this.bodyB.body.actor,this.bodyA.body.actor,a.Util.getOppositeSide(w),this.mtv.negate()));var x=-((1+k)*q)/(g+h+i*s*s+j*u*u);if(c.actor.collisionType===a.CollisionType.Fixed?(d.vel=d.vel.add(f.scale(x*h)),a.Physics.allowRigidBodyRotation&&(d.rx-=x*j*-o.cross(f)),d.addMtv(e)):d.actor.collisionType===a.CollisionType.Fixed?(c.vel=c.vel.sub(f.scale(x*g)),a.Physics.allowRigidBodyRotation&&(c.rx+=x*i*-n.cross(f)),c.addMtv(e.negate())):(d.vel=d.vel.add(f.scale(x*h)),c.vel=c.vel.sub(f.scale(x*g)),a.Physics.allowRigidBodyRotation&&(d.rx-=x*j*-o.cross(f),c.rx+=x*i*-n.cross(f)),d.addMtv(e.scale(.5)),c.addMtv(e.scale(-.5))),l&&r){var y=p.sub(f.scale(p.dot(f))).normalize(),z=p.dot(y)/(g+h+t*t*i+v*v*j),A=new a.Vector(0,0);A=Math.abs(z)<=x*l?y.scale(z).negate():y.scale(-x*l),c.actor.collisionType===a.CollisionType.Fixed?(d.vel=d.vel.add(A.scale(h)),a.Physics.allowRigidBodyRotation&&(d.rx+=A.dot(y)*j*o.cross(y))):d.actor.collisionType===a.CollisionType.Fixed?(c.vel=c.vel.sub(A.scale(g)),a.Physics.allowRigidBodyRotation&&(c.rx-=A.dot(y)*i*n.cross(y))):(d.vel=d.vel.add(A.scale(h)),c.vel=c.vel.sub(A.scale(g)),a.Physics.allowRigidBodyRotation&&(d.rx+=A.dot(y)*j*o.cross(y),c.rx-=A.dot(y)*i*n.cross(y)))}}}},b}();a.CollisionContact=b}(ex||(ex={}));var ex;!function(a){a.CollisionJumpTable={CollideCircleCircle:function(b,c){var d=b.radius+c.radius,e=b.body.pos.add(b.pos),f=c.body.pos.add(c.pos);if(e.distance(f)>d)return null;var g=f.sub(e).normalize(),h=g.scale(d-f.distance(e)),i=b.getFurthestPoint(g);return new a.CollisionContact(b,c,h,i,g)},CollideCirclePolygon:function(b,c){var d=(c.getAxes(),b.getCenter(),c.getCenter(),b.testSeparatingAxisTheorem(c));if(!d)return null;var e=d.dot(c.getCenter().sub(b.getCenter()));d=e<0?d.negate():d;var f=[],g=c.getFurthestPoint(d.negate()),h=b.getFurthestPoint(d);return b.contains(g)&&f.push(g),c.contains(h)&&f.push(h),0===f.length&&f.push(h),new a.CollisionContact(b,c,d,2===f.length?f[0].average(f[1]):f[0],d.normalize())},CollideCircleEdge:function(b,c){var d=b.getCenter(),e=c.end.sub(c.begin),f=e.dot(c.end.sub(d)),g=e.dot(d.sub(c.begin));if(g<=0){var h=c.begin.sub(d),i=h.dot(h);return i>b.radius*b.radius?null:new a.CollisionContact(b,c,h.normalize().scale(b.radius-Math.sqrt(i)),c.begin,h.normalize())}if(f<=0){var j=c.end.sub(d),k=j.dot(j);return k>b.radius*b.radius?null:new a.CollisionContact(b,c,j.normalize().scale(b.radius-Math.sqrt(k)),c.end,j.normalize())}var l=e.dot(e),m=c.begin.scale(f).add(c.end.scale(g)).scale(1/l),n=d.sub(m),o=n.dot(n);if(o>b.radius*b.radius)return null;var p=e.perpendicular();p.dot(d.sub(c.begin))<0&&(p.x=-p.x,p.y=-p.y),p=p.normalize();var q=p.scale(Math.abs(b.radius-Math.sqrt(o)));return new a.CollisionContact(b,c,q.negate(),m,p.negate())},CollideEdgeEdge:function(a,b){return null},CollidePolygonEdge:function(b,c){var d=b.getCenter(),e=c.end.sub(c.begin),f=e.normal(),g=e.dot(c.end.sub(d)),h=e.dot(d.sub(c.begin)),i=e.dot(e),j=c.begin.scale(g).add(c.end.scale(h)).scale(1/i),k=(d.sub(j),new a.PolygonArea({points:[c.begin,c.end,c.end.sub(f.scale(10)),c.begin.sub(f.scale(10))]})),l=b.testSeparatingAxisTheorem(k);return l?new a.CollisionContact(b,c,l,b.getFurthestPoint(f.negate()),f.negate()):null},CollidePolygonPolygon:function(b,c){var d=(b.getAxes().concat(c.getAxes()),b.getTransformedPoints().concat(c.getTransformedPoints()),b.testSeparatingAxisTheorem(c));if(!d)return null;var e=d.dot(c.getCenter().sub(b.getCenter()));d=e<0?d.negate():d;var f=[],g=b.getFurthestPoint(d),h=c.getFurthestPoint(d.negate());c.contains(g)&&f.push(g),b.contains(h)&&f.push(h),0===f.length&&f.push(h);var i=2===f.length?f[0].add(f[1]).scale(.5):f[0];return new a.CollisionContact(b,c,d,i,d.normalize())}}}(ex||(ex={}));var ex;!function(a){var b=function(){function b(b){this.pos=a.Vector.Zero.clone(),this.pos=b.pos||a.Vector.Zero.clone(),this.radius=b.radius||0,this.body=b.body||null}return b.prototype.getCenter=function(){return this.body?this.pos.add(this.body.pos):this.pos},b.prototype.contains=function(a){var b=this.body.pos.distance(a);return b<=this.radius},b.prototype.rayCast=function(a,b){void 0===b&&(b=1/0);var c=this.getCenter(),d=a.dir,e=a.pos,f=Math.sqrt(Math.pow(d.dot(e.sub(c)),2)-Math.pow(e.sub(c).distance(),2)+Math.pow(this.radius,2));if(f<0)return null;var g=0;if(0===f)return g=-d.dot(e.sub(c)),g>0&&g<b?a.getPoint(g):null;var h=-d.dot(e.sub(c))+f,i=-d.dot(e.sub(c))-f,j=Math.min(h,i);return j<=b?a.getPoint(j):null},b.prototype.collide=function(c){if(c instanceof b)return a.CollisionJumpTable.CollideCircleCircle(this,c);if(c instanceof a.PolygonArea)return a.CollisionJumpTable.CollideCirclePolygon(this,c);if(c instanceof a.EdgeArea)return a.CollisionJumpTable.CollideCircleEdge(this,c);throw new Error("Circle could not collide with unknown ICollisionArea "+typeof c)},b.prototype.getFurthestPoint=function(a){return this.getCenter().add(a.normalize().scale(this.radius))},b.prototype.getBounds=function(){return new a.BoundingBox(this.pos.x+this.body.pos.x-this.radius,this.pos.y+this.body.pos.y-this.radius,this.pos.x+this.body.pos.x+this.radius,this.pos.y+this.body.pos.y+this.radius)},b.prototype.getAxes=function(){return null},b.prototype.getMomentOfInertia=function(){var b=this.body?this.body.mass:a.Physics.defaultMass;return b*this.radius*this.radius/2},b.prototype.testSeparatingAxisTheorem=function(a){var b=a.getAxes(),c=a.getCenter(),d=a.getFurthestPoint(this.pos.sub(c));b.push(this.pos.sub(d).normalize());for(var e=Number.MAX_VALUE,f=null,g=-1,h=0;h<b.length;h++){var i=a.project(b[h]),j=this.project(b[h]),k=i.getOverlap(j);if(k<=0)return null;k<e&&(e=k,f=b[h],g=h)}return g<0?null:f.normalize().scale(e)},b.prototype.recalc=function(){},b.prototype.project=function(b){var c=[],d=this.getCenter(),e=d.dot(b);return c.push(e),c.push(e+this.radius),c.push(e-this.radius),new a.Projection(Math.min.apply(Math,c),Math.max.apply(Math,c))},b.prototype.debugDraw=function(b,c){void 0===c&&(c=a.Color.Green.clone());var d=this.body?this.body.pos.add(this.pos):this.pos,e=this.body?this.body.rotation:0;b.beginPath(),b.strokeStyle=c.toString(),b.arc(d.x,d.y,this.radius,0,2*Math.PI),b.closePath(),b.stroke(),b.beginPath(),b.moveTo(d.x,d.y),b.lineTo(Math.cos(e)*this.radius+d.x,Math.sin(e)*this.radius+d.y),b.closePath(),b.stroke()},b}();a.CircleArea=b}(ex||(ex={}));var ex;!function(a){var b=function(){function b(b){this.begin=b.begin||a.Vector.Zero.clone(),this.end=b.end||a.Vector.Zero.clone(),this.body=b.body||null,this.pos=this.getCenter()}return b.prototype.getCenter=function(){var a=this.begin.average(this.end).add(this._getBodyPos());return a},b.prototype._getBodyPos=function(){var b=a.Vector.Zero.clone();return this.body.pos&&(b=this.body.pos),b},b.prototype._getTransformedBegin=function(){var a=this.body?this.body.rotation:0;return this.begin.rotate(a).add(this._getBodyPos())},b.prototype._getTransformedEnd=function(){var a=this.body?this.body.rotation:0;return this.end.rotate(a).add(this._getBodyPos())},b.prototype.getSlope=function(){var a=this._getTransformedBegin(),b=this._getTransformedEnd(),c=a.distance(b);return b.sub(a).scale(1/c)},b.prototype.getLength=function(){var a=this._getTransformedBegin(),b=this._getTransformedEnd(),c=a.distance(b);return c},b.prototype.contains=function(a){return!1},b.prototype.rayCast=function(a,b){void 0===b&&(b=1/0);var c=this._getTransformedBegin().sub(a.pos);if(0===a.dir.cross(this.getSlope())&&0!==c.cross(a.dir))return null;var d=a.dir.cross(this.getSlope());if(0===d)return null;var e=c.cross(this.getSlope())/d;if(e>=0&&e<=b){var f=c.cross(a.dir)/d/this.getLength();if(f>=0&&f<=1)return a.getPoint(e)}return null},b.prototype.collide=function(c){if(c instanceof a.CircleArea)return a.CollisionJumpTable.CollideCircleEdge(c,this);if(c instanceof a.PolygonArea)return a.CollisionJumpTable.CollidePolygonEdge(c,this);if(c instanceof b)return a.CollisionJumpTable.CollideEdgeEdge(this,c);throw new Error("Edge could not collide with unknown ICollisionArea "+typeof c)},b.prototype.getFurthestPoint=function(a){var b=this._getTransformedBegin(),c=this._getTransformedEnd();return a.dot(b)>0?b:c},b.prototype.getBounds=function(){var b=this._getTransformedBegin(),c=this._getTransformedEnd();return new a.BoundingBox(Math.min(b.x,c.x),Math.min(b.y,c.y),Math.max(b.x,c.x),Math.max(b.y,c.y))},b.prototype.getAxes=function(){var a=this._getTransformedEnd().sub(this._getTransformedBegin()),b=a.normal(),c=[];return c.push(b),c.push(b.negate()),c.push(b.normal()),c.push(b.normal().negate()),c},b.prototype.getMomentOfInertia=function(){var b=this.body?this.body.mass:a.Physics.defaultMass,c=this.end.sub(this.begin).distance()/2;return b*c*c},b.prototype.recalc=function(){},b.prototype.project=function(b){for(var c=[],d=[this._getTransformedBegin(),this._getTransformedEnd()],e=d.length,f=0;f<e;f++)c.push(d[f].dot(b));return new a.Projection(Math.min.apply(Math,c),Math.max.apply(Math,c))},b.prototype.debugDraw=function(b,c){void 0===c&&(c=a.Color.Red.clone()),b.strokeStyle=c.toString(),b.beginPath(),b.moveTo(this.begin.x,this.begin.y),b.lineTo(this.end.x,this.end.y),b.closePath(),b.stroke()},b}();a.EdgeArea=b}(ex||(ex={}));var ex;!function(a){var b=function(){function b(b){this._transformedPoints=[],this._axes=[],this._sides=[],this.pos=b.pos||a.Vector.Zero.clone();var c=!!b.clockwiseWinding;this.points=(c?b.points.reverse():b.points)||[],this.body=b.body||null,this._calculateTransformation()}return b.prototype.getCenter=function(){return this.body?this.body.pos.add(this.pos):this.pos},b.prototype._calculateTransformation=function(){var a=this.body?this.body.pos.add(this.pos):this.pos,b=this.body?this.body.rotation:0,c=this.points.length;this._transformedPoints.length=0;for(var d=0;d<c;d++)this._transformedPoints[d]=this.points[d].rotate(b).add(a)},b.prototype.getTransformedPoints=function(){return this._transformedPoints.length||this._calculateTransformation(),this._transformedPoints},b.prototype.getSides=function(){if(this._sides.length)return this._sides;for(var b=[],c=this.getTransformedPoints(),d=c.length,e=0;e<d;e++)b.push(new a.Line(c[e],c[(e-1+d)%d]));return this._sides=b,this._sides},b.prototype.recalc=function(){this._sides.length=0,this._axes.length=0,this._transformedPoints.length=0,this.getTransformedPoints(),this.getAxes(),this.getSides()},b.prototype.contains=function(b){var c=new a.Ray(b,new a.Vector(1,0)),d=this.getSides().reduce(function(a,b,d,e){return c.intersect(b)>=0?a+1:a},0);return d%2!==0},b.prototype.collide=function(c){if(c instanceof a.CircleArea)return a.CollisionJumpTable.CollideCirclePolygon(c,this);if(c instanceof b)return a.CollisionJumpTable.CollidePolygonPolygon(this,c);if(c instanceof a.EdgeArea)return a.CollisionJumpTable.CollidePolygonEdge(this,c);throw new Error("Polygon could not collide with unknown ICollisionArea "+typeof c)},b.prototype.getFurthestPoint=function(a){for(var b=this.getTransformedPoints(),c=null,d=-Number.MAX_VALUE,e=0;e<b.length;e++){var f=a.dot(b[e]);f>d&&(d=f,c=b[e])}return c},b.prototype.getBounds=function(){var b=this.getTransformedPoints(),c=b.reduce(function(a,b){return Math.min(a,b.x)},999999999),d=b.reduce(function(a,b){return Math.max(a,b.x)},-99999999),e=b.reduce(function(a,b){return Math.min(a,b.y)},9999999999),f=b.reduce(function(a,b){return Math.max(a,b.y)},-9999999999);return new a.BoundingBox(c,e,d,f)},b.prototype.getMomentOfInertia=function(){for(var b=this.body?this.body.mass:a.Physics.defaultMass,c=0,d=0,e=0;e<this.points.length;e++){var f=(e+1)%this.points.length,g=this.points[f].cross(this.points[e]);c+=g*(this.points[e].dot(this.points[e])+this.points[e].dot(this.points[f])+this.points[f].dot(this.points[f])),d+=g}return b/6*(c/d)},b.prototype.rayCast=function(a,b){void 0===b&&(b=1/0);for(var c=this.getSides(),d=c.length,e=Number.MAX_VALUE,f=-1,g=0;g<d;g++){var h=a.intersect(c[g]);h>=0&&h<e&&h<=b&&(e=h,f=g)}return f>=0?a.getPoint(e):null},b.prototype.getAxes=function(){if(this._axes.length)return this._axes;for(var a=[],b=this.getTransformedPoints(),c=b.length,d=0;d<c;d++)a.push(b[d].sub(b[(d+1)%c]).normal());return this._axes=a,this._axes},b.prototype.testSeparatingAxisTheorem=function(a){for(var b=this,c=a,d=b.getAxes().concat(c.getAxes()),e=Number.MAX_VALUE,f=null,g=-1,h=0;h<d.length;h++){var i=b.project(d[h]),j=c.project(d[h]),k=i.getOverlap(j);if(k<=0)return null;k<e&&(e=k,f=d[h],g=h)}return g===-1?null:f.normalize().scale(e)},b.prototype.project=function(b){for(var c=this.getTransformedPoints(),d=c.length,e=Number.MAX_VALUE,f=-Number.MAX_VALUE,g=0;g<d;g++){var h=c[g].dot(b);e=Math.min(e,h),f=Math.max(f,h)}return new a.Projection(e,f)},b.prototype.debugDraw=function(b,c){void 0===c&&(c=a.Color.Red.clone()),b.beginPath(),b.strokeStyle=c.toString();var d=this.getTransformedPoints()[0];b.moveTo(d.x,d.y),this.getTransformedPoints().forEach(function(a,c){
b.lineTo(a.x,a.y)}),b.lineTo(d.x,d.y),b.closePath(),b.stroke()},b}();a.PolygonArea=b}(ex||(ex={}));var ex;!function(a){var b;!function(b){var c=function(){function b(){}return b.prototype.update=function(b,c,d){var e=d/1e3,f=b.acc.clone();b.collisionType!==a.CollisionType.Active||b instanceof a.UIActor||b instanceof a.Trigger||b instanceof a.Label||f.addEqual(a.Physics.acc),b.oldVel=b.vel,b.vel.addEqual(f.scale(e)),b.pos.addEqual(b.vel.scale(e)).addEqual(f.scale(.5*e*e)),b.rx+=b.torque*(1/b.moi)*e,b.rotation+=b.rx*e,b.scale.x+=b.sx*d/1e3,b.scale.y+=b.sy*d/1e3},b}();b.EulerMovement=c}(b=a.Traits||(a.Traits={}))}(ex||(ex={}));var ex;!function(a){var b=function(){function b(){this._topLeft=new a.Vector(0,0),this._topRight=new a.Vector(0,0),this._bottomLeft=new a.Vector(0,0),this._bottomRight=new a.Vector(0,0)}return b.prototype.isSpriteOffScreen=function(b,c){var d=b.currentDrawing.width,e=b.currentDrawing.height,f=b.rotation,g=b.getCenter(),h=b.getWorldPos();this._topLeft.x=h.x-d/2,this._topLeft.y=h.y-e/2,this._topLeft=this._topLeft.rotate(f,g),this._topRight.x=h.x+d/2,this._topRight.y=h.y-e/2,this._topRight=this._topRight.rotate(f,g),this._bottomLeft.x=h.x-d/2,this._bottomLeft.y=h.y+e/2,this._bottomLeft=this._bottomLeft.rotate(f,g),this._bottomRight.x=h.x+d/2,this._bottomRight.y=h.y+e/2,this._bottomRight=this._bottomRight.rotate(f,g);var i=c.worldToScreenCoordinates(this._topLeft),j=c.worldToScreenCoordinates(this._topRight),k=c.worldToScreenCoordinates(this._bottomLeft),l=c.worldToScreenCoordinates(this._bottomRight);this._xCoords=[],this._yCoords=[],this._xCoords.push(i.x,j.x,k.x,l.x),this._yCoords.push(i.y,j.y,k.y,l.y),this._xMin=Math.min.apply(null,this._xCoords),this._yMin=Math.min.apply(null,this._yCoords),this._xMax=Math.max.apply(null,this._xCoords),this._yMax=Math.max.apply(null,this._yCoords);var m=c.screenToWorldCoordinates(new a.Vector(this._xMin,this._yMin)),n=c.screenToWorldCoordinates(new a.Vector(this._xMax,this._yMax));this._xMinWorld=m.x,this._yMinWorld=m.y,this._xMaxWorld=n.x,this._yMaxWorld=n.y;var o=[new a.Vector(this._xMin,this._yMin),new a.Vector(this._xMax,this._yMin),new a.Vector(this._xMin,this._yMax),new a.Vector(this._xMax,this._yMax)];if(o[0].x<0&&o[1].x>c.canvas.clientWidth&&(o[0].y>0||o[2].y<c.canvas.clientHeight))return!1;if(o[0].y<0&&o[2].y>c.canvas.clientHeight&&(o[1].x>0||o[0].x<c.canvas.clientWidth))return!1;for(var p=0;p<o.length;p++)if(o[p].x>0&&o[p].y>0&&o[p].x<c.canvas.clientWidth&&o[p].y<c.canvas.clientHeight)return!1;return!0},b.prototype.debugDraw=function(b){b.beginPath(),b.strokeStyle=a.Color.White.toString(),b.rect(this._xMinWorld,this._yMinWorld,this._xMaxWorld-this._xMinWorld,this._yMaxWorld-this._yMinWorld),b.stroke(),b.fillStyle=a.Color.Red.toString(),b.beginPath(),b.arc(this._topLeft.x,this._topLeft.y,5,0,2*Math.PI),b.closePath(),b.fill(),b.fillStyle=a.Color.Green.toString(),b.beginPath(),b.arc(this._topRight.x,this._topRight.y,5,0,2*Math.PI),b.closePath(),b.fill(),b.fillStyle=a.Color.Blue.toString(),b.beginPath(),b.arc(this._bottomLeft.x,this._bottomLeft.y,5,0,2*Math.PI),b.closePath(),b.fill(),b.fillStyle=a.Color.Magenta.toString(),b.beginPath(),b.arc(this._bottomRight.x,this._bottomRight.y,5,0,2*Math.PI),b.closePath(),b.fill()},b}();a.CullingBox=b}(ex||(ex={}));var ex;!function(a){var b;!function(b){var c=function(){function b(){this.cullingBox=new a.CullingBox}return b.prototype.update=function(b,c,d){var e=b.eventDispatcher,f=b.anchor,g=b.getGlobalScale(),h=g.x*b.getWidth()/b.scale.x,i=g.y*b.getHeight()/b.scale.y,j=b.getWorldPos(),k=c.worldToScreenCoordinates(new a.Vector(j.x-f.x*h,j.y-f.y*i)),l=1;b.scene&&b.scene.camera&&(l=Math.abs(b.scene.camera.getZoom()));var m=!0;null!=b.currentDrawing&&(m=this.cullingBox.isSpriteOffScreen(b,c)),b.isOffScreen?(k.x+h*l>0&&k.y+i*l>0&&k.x<c.width&&k.y<c.height||!m)&&(e.emit("enterviewport",new a.EnterViewPortEvent),b.isOffScreen=!1):(k.x+h*l<0||k.y+i*l<0||k.x>c.width||k.y>c.height)&&m&&(e.emit("exitviewport",new a.ExitViewPortEvent),b.isOffScreen=!0)},b}();b.OffscreenCulling=c}(b=a.Traits||(a.Traits={}))}(ex||(ex={}));var ex;!function(a){var b;!function(a){var b=function(){function a(){}return a.prototype.update=function(a,b,c){a.enableCapturePointer&&(a.isKilled()||b.input.pointers.propogate(a))},a}();a.CapturePointer=b}(b=a.Traits||(a.Traits={}))}(ex||(ex={}));var ex;!function(a){var b;!function(b){var c=function(){function b(){}return b.prototype.update=function(b,c,d){var e=b.eventDispatcher;if(b.collisionType!==a.CollisionType.PreventCollision&&c.currentScene&&c.currentScene.tileMaps)for(var f=0;f<c.currentScene.tileMaps.length;f++)for(var g,h=c.currentScene.tileMaps[f],i=a.Side.None,j=2,k=!1;(g=h.collides(b))&&!(j--<0);)i=b.getSideFromIntersect(g),e.emit("collision",new a.CollisionEvent(b,null,i,g)),b.collisionType!==a.CollisionType.Active&&b.collisionType!==a.CollisionType.Elastic||(b.pos.y+=g.y,b.pos.x+=g.x,b.collisionType!==a.CollisionType.Elastic||k||(k=!0,i===a.Side.Left?b.vel.x=Math.abs(b.vel.x):i===a.Side.Right?b.vel.x=-Math.abs(b.vel.x):i===a.Side.Top?b.vel.y=Math.abs(b.vel.y):i===a.Side.Bottom&&(b.vel.y=-Math.abs(b.vel.y))))},b}();b.TileMapCollisionDetection=c}(b=a.Traits||(a.Traits={}))}(ex||(ex={}));var ex;!function(a){var b;!function(a){a[a.None=0]="None",a[a.Top=1]="Top",a[a.Bottom=2]="Bottom",a[a.Left=3]="Left",a[a.Right=4]="Right"}(b=a.Side||(a.Side={}))}(ex||(ex={}));var ex;!function(a){var b;!function(b){function c(){var a={},b=!1,d=0,e=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(b=arguments[0],d++);for(var f=function(d){for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(b&&"[object Object]"===Object.prototype.toString.call(d[e])?a[e]=c(!0,a[e],d[e]):a[e]=d[e])};d<e;d++){var g=arguments[d];f(g)}return a}function d(a){for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",d=0;d<a.length;){var e,f,g=255&a.charCodeAt(d++),h=255&a.charCodeAt(d++),i=255&a.charCodeAt(d++),j=g>>2,k=(3&g)<<4|h>>4;isNaN(h)?e=f=64:(e=(15&h)<<2|i>>6,f=isNaN(i)?64:63&i),c+=b.charAt(j)+b.charAt(k)+b.charAt(e)+b.charAt(f)}return c}function e(a,b,c){return Math.min(Math.max(b,a),c)}function f(a,b){return a+Math.random()*(b-a)}function g(a,b){return Math.round(f(a,b))}function h(a){var b=a;if(a>this.TwoPI)for(;b>this.TwoPI;)b-=this.TwoPI;if(a<0)for(;b<0;)b+=this.TwoPI;return b}function i(a){return 180/Math.PI*a}function j(a){return a/180*Math.PI}function k(b){var c=0,d=0,e=function(a){c+=a.offsetLeft,a.offsetParent&&e(a.offsetParent)},f=function(a){d+=a.offsetTop,a.offsetParent&&f(a.offsetParent)};return e(b),f(b),new a.Vector(c,d)}function l(a,b){return b.indexOf(a)===-1&&(b.push(a),!0)}function m(a,b){var c=-1;return(c=b.indexOf(a))>-1&&(b.splice(c,1),!0)}function n(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return!0;return!1}function o(b){return b===a.Side.Top?a.Side.Bottom:b===a.Side.Bottom?a.Side.Top:b===a.Side.Left?a.Side.Right:b===a.Side.Right?a.Side.Left:a.Side.None}function p(b){for(var c=(b.dot(a.Vector.Left),b.dot(a.Vector.Right),b.dot(a.Vector.Up),b.dot(a.Vector.Down),[a.Vector.Left,a.Vector.Right,a.Vector.Up,a.Vector.Down]),d=[a.Side.Left,a.Side.Right,a.Side.Top,a.Side.Bottom],e=-Number.MAX_VALUE,f=-1,g=0;g<c.length;g++)c[g].dot(b)>e&&(e=c[g].dot(b),f=g);return d[f]}b.TwoPI=2*Math.PI,b.extend=c,b.base64Encode=d,b.clamp=e,b.randomInRange=f,b.randomIntInRange=g,b.canonicalizeAngle=h,b.toDegrees=i,b.toRadians=j,b.getPosition=k,b.addItemToArray=l,b.removeItemToArray=m,b.contains=n,b.getOppositeSide=o,b.getSideFromVector=p;var q=function(){function a(b){void 0===b&&(b=a.DefaultSize),this._internalArray=null,this._endPointer=0,this._internalArray=new Array(b)}return a.prototype._resize=function(){for(var a=2*this._internalArray.length,b=new Array(a),c=this.count(),d=0;d<c;d++)b[d]=this._internalArray[d];delete this._internalArray,this._internalArray=b},a.prototype.push=function(a){return this._endPointer===this._internalArray.length&&this._resize(),this._internalArray[this._endPointer++]=a},a.prototype.pop=function(){return this._endPointer=this._endPointer-1<0?0:this._endPointer-1,this._internalArray[this._endPointer]},a.prototype.count=function(){return this._endPointer},a.prototype.clear=function(){this._endPointer=0},a.prototype.internalSize=function(){return this._internalArray.length},a.prototype.elementAt=function(a){if(!(a>=this.count()))return this._internalArray[a]},a.prototype.insert=function(a,b){return a>=this.count()&&this._resize(),this._internalArray[a]=b},a.prototype.remove=function(a){var b=this.count();if(0!==b){for(var c=this._internalArray[a],d=a;d<b;d++)this._internalArray[d]=this._internalArray[d+1];return this._endPointer--,c}},a.prototype.removeElement=function(a){var b=this._internalArray.indexOf(a);this.remove(b)},a.prototype.toArray=function(){return this._internalArray.slice(0,this._endPointer)},a.prototype.forEach=function(a){var b=0,c=this.count();for(b;b<c;b++)a.call(this,this._internalArray[b],b)},a.prototype.map=function(a){for(var b=this.count(),c=0;c<b;c++)this._internalArray[c]=a.call(this,this._internalArray[c],c)},a}();q.DefaultSize=200,b.Collection=q}(b=a.Util||(a.Util={}))}(ex||(ex={}));var ex;!function(a){var b=a.Util.clamp,c=function(){function c(b,c,d,e,f){var g=this;this.sx=c,this.sy=d,this.swidth=e,this.sheight=f,this.rotation=0,this.anchor=new a.Vector(0,0),this.scale=new a.Vector(1,1),this.logger=a.Logger.getInstance(),this.flipVertical=!1,this.flipHorizontal=!1,this.width=0,this.height=0,this.effects=[],this.internalImage=new Image,this.naturalWidth=0,this.naturalHeight=0,this._spriteCanvas=null,this._spriteCtx=null,this._pixelData=null,this._pixelsLoaded=!1,this._dirtyEffect=!1,(c<0||d<0||e<0||f<0)&&this.logger.error("Sprite cannot have any negative dimensions x:",c,"y:",d,"width:",e,"height:",f),this._texture=b,this._spriteCanvas=document.createElement("canvas"),this._spriteCanvas.width=e,this._spriteCanvas.height=f,this._spriteCtx=this._spriteCanvas.getContext("2d"),this._texture.loaded.then(function(){g._spriteCanvas.width=g._spriteCanvas.width||g._texture.image.naturalWidth,g._spriteCanvas.height=g._spriteCanvas.height||g._texture.image.naturalHeight,g._loadPixels(),g._dirtyEffect=!0}).error(function(a){g.logger.error("Error loading texture ",g._texture.path,a)}),this.width=e,this.height=f,this.naturalWidth=e,this.naturalHeight=f}return c.prototype._loadPixels=function(){if(this._texture.isLoaded()&&!this._pixelsLoaded){var a=this._texture.image.naturalWidth||0,c=this._texture.image.naturalHeight||0;this.swidth>a&&this.logger.warn("The sprite width",this.swidth,"exceeds the width",a,"of the backing texture",this._texture.path),this.sheight>c&&this.logger.warn("The sprite height",this.sheight,"exceeds the height",c,"of the backing texture",this._texture.path),this._spriteCtx.drawImage(this._texture.image,b(this.sx,0,a),b(this.sy,0,c),b(this.swidth,0,a),b(this.sheight,0,c),0,0,this.swidth,this.sheight),this.internalImage.src=this._spriteCanvas.toDataURL("image/png"),this._pixelsLoaded=!0}},c.prototype.opacity=function(b){this.addEffect(new a.Effects.Opacity(b))},c.prototype.grayscale=function(){this.addEffect(new a.Effects.Grayscale)},c.prototype.invert=function(){this.addEffect(new a.Effects.Invert)},c.prototype.fill=function(b){this.addEffect(new a.Effects.Fill(b))},c.prototype.colorize=function(b){this.addEffect(new a.Effects.Colorize(b))},c.prototype.lighten=function(b){void 0===b&&(b=.1),this.addEffect(new a.Effects.Lighten(b))},c.prototype.darken=function(b){void 0===b&&(b=.1),this.addEffect(new a.Effects.Darken(b))},c.prototype.saturate=function(b){void 0===b&&(b=.1),this.addEffect(new a.Effects.Saturate(b))},c.prototype.desaturate=function(b){void 0===b&&(b=.1),this.addEffect(new a.Effects.Desaturate(b))},c.prototype.addEffect=function(a){this.effects.push(a),this._texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0},c.prototype.removeEffect=function(a){var b=-1;b="number"==typeof a?a:this.effects.indexOf(a),b<0||b>=this.effects.length||(this.effects.splice(b,1),this._texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0)},c.prototype._applyEffects=function(){var a=this._texture.image.naturalWidth||0,c=this._texture.image.naturalHeight||0;this._spriteCtx.clearRect(0,0,this.swidth,this.sheight),this._spriteCtx.drawImage(this._texture.image,b(this.sx,0,a),b(this.sy,0,c),b(this.swidth,0,a),b(this.sheight,0,c),0,0,this.swidth,this.sheight),this._pixelData=this._spriteCtx.getImageData(0,0,this.swidth,this.sheight);var d=0,e=0,f=0,g=this.effects.length;for(d;d<g;d++)for(f=0;f<this.sheight;f++)for(e=0;e<this.swidth;e++)this.effects[d].updatePixel(e,f,this._pixelData);this._spriteCtx.clearRect(0,0,this.swidth,this.sheight),this._spriteCtx.putImageData(this._pixelData,0,0),this.internalImage.src=this._spriteCanvas.toDataURL("image/png"),this._dirtyEffect=!1},c.prototype.clearEffects=function(){this.effects.length=0,this._applyEffects()},c.prototype.reset=function(){},c.prototype.debugDraw=function(b,c,d){b.save(),b.translate(c,d),b.rotate(this.rotation);var e=this.width*this.scale.x,f=this.height*this.scale.y,g=e*this.anchor.x,h=f*this.anchor.y;b.strokeStyle=a.Color.Black.toString(),b.strokeRect(-g,-h,e,f),b.restore()},c.prototype.draw=function(a,b,c){this._dirtyEffect&&this._applyEffects(),this.width=this.naturalWidth*this.scale.x,this.height=this.naturalHeight*this.scale.y,a.save();var d=this.width*this.anchor.x,e=this.height*this.anchor.y;a.translate(b,c),a.rotate(this.rotation);var f=this.swidth*this.scale.x,g=this.sheight*this.scale.y;this.flipHorizontal&&(a.translate(f,0),a.scale(-1,1)),this.flipVertical&&(a.translate(0,g),a.scale(1,-1)),this.internalImage&&a.drawImage(this.internalImage,0,0,this.swidth,this.sheight,-d,-e,f,g),a.restore()},c.prototype.clone=function(){var a=new c(this._texture,this.sx,this.sy,this.swidth,this.sheight);a.scale=this.scale.clone(),a.rotation=this.rotation,a.flipHorizontal=this.flipHorizontal,a.flipVertical=this.flipVertical;var b=0,d=this.effects.length;for(b;b<d;b++)a.addEffect(this.effects[b]);return a},c}();a.Sprite=c}(ex||(ex={}));var ex;!function(a){var b=function(){function b(b,c,d,e,f){this.image=b,this.columns=c,this.rows=d,this.sprites=[],this._internalImage=b.image,this.sprites=new Array(c*d);var g=0,h=0;for(g=0;g<d;g++)for(h=0;h<c;h++)this.sprites[h+g*c]=new a.Sprite(this.image,h*e,g*f,e,f)}return b.prototype.getAnimationByIndices=function(b,c,d){var e=this,f=c.map(function(a){return e.sprites[a]});return f=f.map(function(a){return a.clone()}),new a.Animation(b,f,d)},b.prototype.getAnimationBetween=function(b,c,d,e){var f=this.sprites.slice(c,d);return f=f.map(function(a){return a.clone()}),new a.Animation(b,f,e)},b.prototype.getAnimationForAll=function(b,c){var d=this.sprites.map(function(a){return a.clone()});return new a.Animation(b,d,c)},b.prototype.getSprite=function(a){if(a>=0&&a<this.sprites.length)return this.sprites[a]},b}();a.SpriteSheet=b;var c=function(b){function c(c,d,e,f,g,h,i){var j=b.call(this,c,f,g,h,i)||this;return j.image=c,j.alphabet=d,j.caseInsensitive=e,j.spWidth=h,j.spHeight=i,j._spriteLookup={},j._colorLookup={},j._currentColor=a.Color.Black.clone(),j._currentOpacity=1,j._sprites={},j._textShadowOn=!1,j._textShadowDirty=!0,j._textShadowColor=a.Color.Black.clone(),j._textShadowSprites={},j._shadowOffsetX=5,j._shadowOffsetY=5,j._sprites=j.getTextSprites(),j}return __extends(c,b),c.prototype.getTextSprites=function(){for(var a={},b=0;b<this.alphabet.length;b++){var c=this.alphabet[b];this.caseInsensitive&&(c=c.toLowerCase()),a[c]=this.sprites[b].clone()}return a},c.prototype.setTextShadow=function(a,b,c){this._textShadowOn=!0,this._shadowOffsetX=a,this._shadowOffsetY=b,this._textShadowColor=c.clone(),this._textShadowDirty=!0;for(var d in this._sprites)this._textShadowSprites[d]=this._sprites[d].clone()},c.prototype.useTextShadow=function(a){this._textShadowOn=a,a&&this.setTextShadow(5,5,this._textShadowColor)},c.prototype.draw=function(b,c,d,e,f){if(f=this._parseOptions(f),this._currentColor.toString()!==f.color.toString()||this._currentOpacity!==f.opacity){this._currentOpacity=f.opacity,this._currentColor=f.color;for(var g in this._sprites)this._sprites[g].clearEffects(),this._sprites[g].fill(f.color),this._sprites[g].opacity(f.opacity)}if(this._textShadowOn&&this._textShadowDirty&&this._textShadowColor){for(var h in this._textShadowSprites)this._textShadowSprites[h].clearEffects(),this._textShadowSprites[h].addEffect(new a.Effects.Fill(this._textShadowColor.clone()));this._textShadowDirty=!1}var i=this.sprites[0],j=i.sheight,k=f.fontSize/j,l=c.length*i.swidth*k+c.length*f.letterSpacing,m=d;f.textAlign===a.TextAlign.Left||f.textAlign===a.TextAlign.Start?m=d:f.textAlign===a.TextAlign.Right||f.textAlign===a.TextAlign.End?m=d-l:f.textAlign===a.TextAlign.Center&&(m=d-l/2);var n=e-j*k;f.baseAlign===a.BaseAlign.Top||f.baseAlign===a.BaseAlign.Hanging?n=e:f.baseAlign===a.BaseAlign.Ideographic||f.baseAlign===a.BaseAlign.Bottom||f.baseAlign===a.BaseAlign.Alphabetic?n=e-j*k:f.baseAlign===a.BaseAlign.Middle&&(n=e-j*k/2);for(var o=0;o<c.length;o++){var p=c[o];this.caseInsensitive&&(p=p.toLowerCase());try{this._textShadowOn&&(this._textShadowSprites[p].scale.x=k,this._textShadowSprites[p].scale.y=k,this._textShadowSprites[p].draw(b,m+this._shadowOffsetX,n+this._shadowOffsetY));var q=this._sprites[p];q.scale.x=k,q.scale.y=k,q.draw(b,m,n),m+=q.width+f.letterSpacing}catch(b){a.Logger.getInstance().error("SpriteFont Error drawing char "+p)}}},c.prototype._parseOptions=function(b){return{fontSize:b.fontSize||10,letterSpacing:b.letterSpacing||0,color:b.color||a.Color.Black.clone(),textAlign:void 0===typeof b.textAlign?a.TextAlign.Left:b.textAlign,baseAlign:void 0===typeof b.baseAlign?a.BaseAlign.Bottom:b.baseAlign,maxWidth:b.maxWidth||-1,opacity:b.opacity||0}},c}(b);a.SpriteFont=c}(ex||(ex={}));var ex;!function(a){var b=function(){function b(b,c,e,f,g,h){var i=this;this.x=b,this.y=c,this.cellWidth=e,this.cellHeight=f,this.rows=g,this.cols=h,this._collidingX=-1,this._collidingY=-1,this._onScreenXStart=0,this._onScreenXEnd=9999,this._onScreenYStart=0,this._onScreenYEnd=9999,this._spriteSheets={},this.logger=a.Logger.getInstance(),this.data=[],this.data=new Array(g*h);for(var j=0;j<h;j++)for(var k=0;k<g;k++)!function(){var a=new d(j*e+b,k*f+c,e,f,j+k*h);i.data[j+k*h]=a}()}return b.prototype.registerSpriteSheet=function(a,b){this._spriteSheets[a]=b},b.prototype.collides=function(b){for(var c=b.pos.x+b.getWidth(),d=b.pos.y+b.getHeight(),e=b.getBounds(),f=[],g=e.left;g<=c;g+=Math.min(b.getWidth()/2,this.cellWidth/2))for(var h=e.top;h<=d;h+=Math.min(b.getHeight()/2,this.cellHeight/2)){var i=this.getCellByPoint(g,h);if(i&&i.solid){var j=e.collides(i.getBounds()),k=b.getCenter().sub(i.getCenter());j&&j.dot(k)>0&&f.push(j)}}if(0===f.length)return null;var l=f.reduce(function(b,c){var d=b.x,e=b.y;return Math.abs(b.x)<Math.abs(c.x)&&(d=c.x),Math.abs(b.y)<Math.abs(c.y)&&(e=c.y),new a.Vector(d,e)});return l},b.prototype.getCellByIndex=function(a){return this.data[a]},b.prototype.getCell=function(a,b){return a<0||b<0||a>=this.cols||b>=this.rows?null:this.data[a+b*this.cols]},b.prototype.getCellByPoint=function(a,b){a=Math.floor((a-this.x)/this.cellWidth),b=Math.floor((b-this.y)/this.cellHeight);var c=this.getCell(a,b);return a>=0&&b>=0&&a<this.cols&&b<this.rows&&c?c:null},b.prototype.update=function(b,c){var d=b.screenToWorldCoordinates(new a.Vector(0,0)),e=b.screenToWorldCoordinates(new a.Vector(b.canvas.clientWidth,b.canvas.clientHeight));this._onScreenXStart=Math.max(Math.floor(d.x/this.cellWidth)-2,0),this._onScreenYStart=Math.max(Math.floor((d.y-this.y)/this.cellHeight)-2,0),this._onScreenXEnd=Math.max(Math.floor(e.x/this.cellWidth)+2,0),this._onScreenYEnd=Math.max(Math.floor((e.y-this.y)/this.cellHeight)+2,0)},b.prototype.draw=function(a,b){a.save(),a.translate(this.x,this.y);var c,d,e,f=this._onScreenXStart,g=Math.min(this._onScreenXEnd,this.cols),h=this._onScreenYStart,i=Math.min(this._onScreenYEnd,this.rows);for(f;f<g;f++){for(h;h<i;h++)for(c=this.getCell(f,h).sprites.filter(function(a){return a.spriteId>-1}),d=0,e=c.length;d<e;d++){var j=this._spriteSheets[c[d].spriteSheetKey];if(j){var k=j.getSprite(c[d].spriteId);k?k.draw(a,f*this.cellWidth,h*this.cellHeight):this.logger.warn("Sprite does not exist for id",c[d].spriteId,"in sprite sheet",c[d].spriteSheetKey,k,j)}else this.logger.warn("Sprite sheet",c[d].spriteSheetKey,"does not exist",j)}h=this._onScreenYStart}a.restore()},b.prototype.debugDraw=function(b){var c=this.cols*this.cellWidth,d=this.rows*this.cellHeight;b.save(),b.strokeStyle=a.Color.Red.toString();for(var e=0;e<this.cols+1;e++)b.beginPath(),b.moveTo(this.x+e*this.cellWidth,this.y),b.lineTo(this.x+e*this.cellWidth,this.y+d),b.stroke();for(var f=0;f<this.rows+1;f++)b.beginPath(),b.moveTo(this.x,this.y+f*this.cellHeight),b.lineTo(this.x+c,this.y+f*this.cellHeight),b.stroke();var g=a.Color.Red.clone();g.a=.3,this.data.filter(function(a){return a.solid}).forEach(function(a){b.fillStyle=g.toString(),b.fillRect(a.x,a.y,a.width,a.height)}),this._collidingY>-1&&this._collidingX>-1&&(b.fillStyle=a.Color.Cyan.toString(),b.fillRect(this.x+this._collidingX*this.cellWidth,this.y+this._collidingY*this.cellHeight,this.cellWidth,this.cellHeight)),b.restore()},b}();a.TileMap=b;var c=function(){function a(a,b){this.spriteSheetKey=a,this.spriteId=b}return a}();a.TileSprite=c;var d=function(){function b(b,c,d,e,f,g,h){void 0===g&&(g=!1),void 0===h&&(h=[]),this.x=b,this.y=c,this.width=d,this.height=e,this.index=f,this.solid=g,this.sprites=h,this._bounds=new a.BoundingBox(this.x,this.y,this.x+this.width,this.y+this.height)}return b.prototype.getBounds=function(){return this._bounds},b.prototype.getCenter=function(){return new a.Vector(this.x+this.width/2,this.y+this.height/2)},b.prototype.pushSprite=function(a){this.sprites.push(a)},b.prototype.removeSprite=function(a){var b=-1;(b=this.sprites.indexOf(a))>-1&&this.sprites.splice(b,1)},b.prototype.clearSprites=function(){this.sprites.length=0},b}();a.Cell=d}(ex||(ex={}));var ex;!function(a){var b=function(){function b(a,b,c,d){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0),this.left=a,this.top=b,this.right=c,this.bottom=d}return b.fromPoints=function(a){for(var c=1/0,d=1/0,e=-(1/0),f=-(1/0),g=0;g<a.length;g++)a[g].x<c&&(c=a[g].x),a[g].x>e&&(e=a[g].x),a[g].y<d&&(d=a[g].y),a[g].y>f&&(f=a[g].y);return new b(c,d,e,f)},b.prototype.getWidth=function(){return this.right-this.left},b.prototype.getHeight=function(){return this.bottom-this.top},b.prototype.rotate=function(c,d){void 0===d&&(d=a.Vector.Zero.clone());var e=this.getPoints().map(function(a){return a.rotate(c,d)});return b.fromPoints(e)},b.prototype.getPerimeter=function(){var a=this.getWidth(),b=this.getHeight();return 2*(a+b)},b.prototype.getPoints=function(){var b=[];return b.push(new a.Vector(this.left,this.top)),b.push(new a.Vector(this.right,this.top)),b.push(new a.Vector(this.right,this.bottom)),b.push(new a.Vector(this.left,this.bottom)),b},b.prototype.toPolygon=function(b){return new a.PolygonArea({body:b?b.body:null,points:this.getPoints(),pos:a.Vector.Zero.clone()})},b.prototype.rayCast=function(a,b){void 0===b&&(b=1/0);var c=-(1/0),d=+(1/0);if(0!==a.dir.x){var e=(this.left-a.pos.x)/a.dir.x,f=(this.right-a.pos.x)/a.dir.x;c=Math.max(c,Math.min(e,f)),d=Math.min(d,Math.max(e,f))}if(0!==a.dir.y){var g=(this.top-a.pos.y)/a.dir.y,h=(this.bottom-a.pos.y)/a.dir.y;c=Math.max(c,Math.min(g,h)),d=Math.min(d,Math.max(g,h))}return d>=Math.max(0,c)&&c<b},b.prototype.contains=function(c){return c instanceof a.Vector?this.left<=c.x&&this.top<=c.y&&this.bottom>=c.y&&this.right>=c.x:c instanceof b&&(this.left<c.left&&this.top<c.top&&c.bottom<this.bottom&&c.right<this.right)},b.prototype.combine=function(a){var c=new b(Math.min(this.left,a.left),Math.min(this.top,a.top),Math.max(this.right,a.right),Math.max(this.bottom,a.bottom));return c},b.prototype.collides=function(c){if(c instanceof b){var d=c,e=this.combine(d);if(e.getWidth()<d.getWidth()+this.getWidth()&&e.getHeight()<d.getHeight()+this.getHeight()){var f=0;f=this.right>=d.left&&this.right<=d.right?d.left-this.right:d.right-this.left;var g=0;return g=this.top<=d.bottom&&this.top>=d.top?d.bottom-this.top:d.top-this.bottom,Math.abs(f)<Math.abs(g)?new a.Vector(f,0):new a.Vector(0,g)}return null}return null},b.prototype.debugDraw=function(b,c){void 0===c&&(c=a.Color.Yellow),b.strokeStyle=c.toString(),b.strokeRect(this.left,this.top,this.getWidth(),this.getHeight())},b}();a.BoundingBox=b}(ex||(ex={}));var ex;!function(a){var b=function(){function b(b){this.actor=b,this.collisionArea=null,this.pos=new a.Vector(0,0),this.oldPos=new a.Vector(0,0),this.vel=new a.Vector(0,0),this.oldVel=new a.Vector(0,0),this.acc=new a.Vector(0,0),this.torque=0,this.mass=1,this.moi=1e3,this.motion=10,this.friction=.99,this.restitution=.2,this.rotation=0,this.rx=0,this._totalMtv=a.Vector.Zero.clone()}return b.prototype.addMtv=function(a){this._totalMtv.addEqual(a)},b.prototype.applyMtv=function(){this.pos.addEqual(this._totalMtv),this._totalMtv.setTo(0,0)},b.prototype.getBounds=function(){return a.Physics.collisionResolutionStrategy===a.CollisionResolutionStrategy.Box?this.actor.getBounds():this.collisionArea.getBounds()},b.prototype.getRelativeBounds=function(){return a.Physics.collisionResolutionStrategy===a.CollisionResolutionStrategy.Box?this.actor.getRelativeBounds():this.actor.getRelativeBounds()},b.prototype.update=function(){this.collisionArea&&this.collisionArea.recalc()},b.prototype.useBoxCollision=function(b){void 0===b&&(b=a.Vector.Zero.clone()),this.collisionArea=new a.PolygonArea({body:this,points:this.actor.getRelativeBounds().getPoints(),pos:b}),this.moi=this.collisionArea.getMomentOfInertia()||this.moi},b.prototype.usePolygonCollision=function(b,c){void 0===c&&(c=a.Vector.Zero.clone()),this.collisionArea=new a.PolygonArea({body:this,points:b,pos:c}),this.moi=this.collisionArea.getMomentOfInertia()||this.moi},b.prototype.useCircleCollision=function(b,c){void 0===c&&(c=a.Vector.Zero.clone()),b||(b=this.actor.getWidth()/2),this.collisionArea=new a.CircleArea({body:this,radius:b,pos:c}),this.moi=this.collisionArea.getMomentOfInertia()||this.moi},b.prototype.useEdgeCollision=function(b,c,d){void 0===d&&(d=a.Vector.Zero.clone()),this.collisionArea=new a.EdgeArea({begin:b,end:c,body:this}),this.moi=this.collisionArea.getMomentOfInertia()||this.moi},b.prototype.debugDraw=function(b){a.Physics.showMotionVectors&&(a.Util.DrawUtil.vector(b,a.Color.Yellow,this.pos,this.acc.add(a.Physics.acc)),a.Util.DrawUtil.vector(b,a.Color.Red,this.pos,this.vel),a.Util.DrawUtil.point(b,a.Color.Red,this.pos)),a.Physics.showBounds&&this.getBounds().debugDraw(b,a.Color.Yellow),a.Physics.showArea&&this.collisionArea.debugDraw(b,a.Color.Green)},b}();a.Body=b}(ex||(ex={}));var ex;!function(a){var b=function(){function b(){this.eventDispatcher=new a.EventDispatcher(this)}return b.prototype.on=function(a,b){this.eventDispatcher.on(a,b)},b.prototype.off=function(a,b){this.eventDispatcher.off(a,b)},b.prototype.emit=function(a,b){this.eventDispatcher.emit(a,b)},b.extend=function(a){var c,d=this;c=a&&a.hasOwnProperty("constructor")?a.constructor:function(){return d.apply(this,arguments)};var e=function(){this.constructor=c};if(e.prototype=d.prototype,c.prototype=new e,a)for(var f in a)a.hasOwnProperty(f)&&(c.prototype[f]=a[f]);return c.extend=b.extend,c},b}();a.Class=b}(ex||(ex={}));var ex;!function(a){var b=function(){function a(b,c,d){this.id=0,this.interval=10,this.fcn=function(){},this.repeats=!1,this._elapsedTime=0,this._totalTimeAlive=0,this.complete=!1,this.scene=null,this.id=a.id++,this.interval=c||this.interval,this.fcn=b||this.fcn,this.repeats=d||this.repeats}return a.prototype.update=function(a){this._totalTimeAlive+=a,this._elapsedTime+=a,this._elapsedTime>this.interval&&(this.fcn.call(this),this.repeats?this._elapsedTime=0:this.complete=!0)},a.prototype.getTimeRunning=function(){return this._totalTimeAlive},a.prototype.cancel=function(){this.scene&&this.scene.cancelTimer(this)},a}();b.id=0,a.Timer=b}(ex||(ex={}));var ex;!function(a){var b=function(){function b(){}return b.prototype.track=function(a){},b.prototype.untrack=function(a){},b.prototype.broadphase=function(b,c){for(var d,e,f=b.filter(function(b){return!b.isKilled()&&b.collisionType!==a.CollisionType.PreventCollision}),g=[],h=0,i=f.length;h<i;h++){d=f[h];for(var j=h+1;j<i;j++){e=f[j];var k;if(k=d.collides(e)){var l=new a.Pair(d.body,e.body);d.getSideFromIntersect(k);l.collision=new a.CollisionContact(d.collisionArea,e.collisionArea,k,d.pos,k),g.some(function(a){return a.id===l.id})||g.push(l)}}}var m=0,n=g.length;for(m;m<n;m++)g[m].resolve(c,a.Physics.collisionResolutionStrategy);return g},b.prototype.narrowphase=function(a){},b.prototype.resolve=function(a,b){},b.prototype.update=function(a){return 0},b.prototype.debugDraw=function(a,b){},b}();a.NaiveCollisionBroadphase=b}(ex||(ex={}));var ex;!function(a){var b=function(){function b(b){this.parent=b,this.parent=b||null,this.body=null,this.bounds=new a.BoundingBox,this.left=null,this.right=null,this.height=0}return b.prototype.isLeaf=function(){return!this.left&&!this.right},b}();a.TreeNode=b;var c=function(){function c(b){void 0===b&&(b=new a.BoundingBox(-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)),this.worldBounds=b,this.root=null,this.nodes={}}return c.prototype._insert=function(a){if(null===this.root)return this.root=a,void(this.root.parent=null);for(var c=a.bounds,d=this.root;!d.isLeaf();){var e,f,g=d.left,h=d.right,i=d.bounds.getPerimeter(),j=d.bounds.combine(c),k=j.getPerimeter(),l=2*k,m=2*(k-i),n=0,o=c.combine(g.bounds);g.isLeaf()?n=o.getPerimeter()+m:(f=g.bounds.getPerimeter(),e=o.getPerimeter(),n=e-f+m);var p=0,q=c.combine(h.bounds);if(h.isLeaf()?p=q.getPerimeter()+m:(f=h.bounds.getPerimeter(),e=q.getPerimeter(),p=e-f+m),l<n&&l<p)break;d=n<p?g:h}var r=d.parent,s=new b(r);s.bounds=c.combine(d.bounds),s.height=d.height+1,null!==r?(r.left===d?r.left=s:r.right=s,s.left=d,s.right=a,d.parent=s,a.parent=s):(s.left=d,s.right=a,d.parent=s,a.parent=s,this.root=s);for(var t=a.parent;t;){if(t=this._balance(t),!t.left)throw new Error("Parent of current leaf cannot have a null left child"+t);if(!t.right)throw new Error("Parent of current leaf cannot have a null right child"+t);t.height=1+Math.max(t.left.height,t.right.height),t.bounds=t.left.bounds.combine(t.right.bounds),t=t.parent}},c.prototype._remove=function(a){if(a===this.root)return void(this.root=null);var b,c=a.parent,d=c.parent;if(b=c.left===a?c.right:c.left,d){d.left===c?d.left=b:d.right=b,b.parent=d;for(var e=d;e;)e=this._balance(e),e.bounds=e.left.bounds.combine(e.right.bounds),e.height=1+Math.max(e.left.height,e.right.height),e=e.parent}else this.root=b,b.parent=null},c.prototype.trackBody=function(a){var c=new b;c.body=a,c.bounds=a.getBounds(),c.bounds.left-=2,c.bounds.top-=2,c.bounds.right+=2,c.bounds.bottom+=2,this.nodes[a.actor.id]=c,this._insert(c)},c.prototype.updateBody=function(b){var c=this.nodes[b.actor.id];if(c){var d=b.getBounds();if(!this.worldBounds.contains(d))return a.Logger.getInstance().warn("Actor with id "+b.actor.id+" is outside the world bounds and will no longer be tracked for physics"),this.untrackBody(b),!1;if(c.bounds.contains(d))return!1;this._remove(c),d.left-=a.Physics.boundsPadding,d.top-=a.Physics.boundsPadding,d.right+=a.Physics.boundsPadding,d.bottom+=a.Physics.boundsPadding;var e=b.vel.x*a.Physics.dynamicTreeVelocityMultiplyer,f=b.vel.y*a.Physics.dynamicTreeVelocityMultiplyer;return e<0?d.left+=e:d.right+=e,f<0?d.top+=f:d.bottom+=f,c.bounds=d,this._insert(c),!0}},c.prototype.untrackBody=function(a){var b=this.nodes[a.actor.id];b&&(this._remove(b),this.nodes[a.actor.id]=null,delete this.nodes[a.actor.id])},c.prototype._balance=function(a){if(null===a)throw new Error("Cannot balance at null node");if(a.isLeaf()||a.height<2)return a;var b=a.left,c=a.right,d=a,e=b,f=c,g=b.left,h=b.right,i=c.left,j=c.right,k=f.height-e.height;
if(k>1)return f.left=d,f.parent=d.parent,d.parent=f,f.parent?f.parent.left===d?f.parent.left=f:f.parent.right=f:this.root=f,i.height>j.height?(f.right=i,d.right=j,j.parent=d,d.bounds=e.bounds.combine(j.bounds),f.bounds=d.bounds.combine(i.bounds),d.height=1+Math.max(e.height,j.height),f.height=1+Math.max(d.height,i.height)):(f.right=j,d.right=i,i.parent=d,d.bounds=e.bounds.combine(i.bounds),f.bounds=d.bounds.combine(j.bounds),d.height=1+Math.max(e.height,i.height),f.height=1+Math.max(d.height,j.height)),f;if(k<-1){if(e.left=d,e.parent=d.parent,d.parent=e,e.parent)if(e.parent.left===d)e.parent.left=e;else{if(e.parent.right!==d)throw"Error rotating Dynamic Tree";e.parent.right=e}else this.root=e;return g.height>h.height?(e.right=g,d.left=h,h.parent=d,d.bounds=f.bounds.combine(h.bounds),e.bounds=d.bounds.combine(g.bounds),d.height=1+Math.max(f.height,h.height),e.height=1+Math.max(d.height,g.height)):(e.right=h,d.left=g,g.parent=d,d.bounds=f.bounds.combine(g.bounds),e.bounds=d.bounds.combine(h.bounds),d.height=1+Math.max(f.height,g.height),e.height=1+Math.max(d.height,h.height)),e}return a},c.prototype.getHeight=function(){return null===this.root?0:this.root.height},c.prototype.query=function(a,b){var c=a.getBounds(),d=function(e){return e&&e.bounds.collides(c)?e.isLeaf()&&e.body!==a?!!b.call(a,e.body)||void 0:d(e.left)||d(e.right):null};return d(this.root)},c.prototype.rayCastQuery=function(a,b,c){void 0===b&&(b=1/0);var d=function(e){return e&&e.bounds.rayCast(a,b)?e.isLeaf()?!!c.call(a,e.body)||void 0:d(e.left)||d(e.right):null};return d(this.root)},c.prototype.getNodes=function(){var a=function(b){return b?[b].concat(a(b.left),a(b.right)):[]};return a(this.root)},c.prototype.debugDraw=function(a,b){var c=function(b){b&&(b.isLeaf()?(a.lineWidth=1,a.strokeStyle="green"):(a.lineWidth=1,a.strokeStyle="white"),b.bounds.debugDraw(a),b.left&&c(b.left),b.right&&c(b.right))};c(this.root)},c}();a.DynamicTree=c}(ex||(ex={}));var ex;!function(a){var b=function(){function b(a,c){this.bodyA=a,this.bodyB=c,this.id=null,this.collision=null,this.id=b.calculatePairHash(a,c)}return b.prototype.collide=function(){this.collision=this.bodyA.collisionArea.collide(this.bodyB.collisionArea)},b.prototype.resolve=function(a,b){this.collision&&this.collision.resolve(a,b)},b.calculatePairHash=function(a,b){return a.actor.id<b.actor.id?"#"+a.actor.id+"+"+b.actor.id:"#"+b.actor.id+"+"+a.actor.id},b.prototype.debugDraw=function(b){this.collision&&(a.Physics.showContacts&&a.Util.DrawUtil.point(b,a.Color.Red,this.collision.point),a.Physics.showCollisionNormals&&a.Util.DrawUtil.vector(b,a.Color.Cyan,this.collision.point,this.collision.normal,30))},b}();a.Pair=b}(ex||(ex={}));var ex;!function(a){var b=function(){function b(){this._dynamicCollisionTree=new a.DynamicTree,this._collisionHash={},this._collisionPairCache=[]}return b.prototype.track=function(b){return b?void this._dynamicCollisionTree.trackBody(b):void a.Logger.getInstance().warn("Cannot track null physics body")},b.prototype.untrack=function(b){return b?void this._dynamicCollisionTree.untrackBody(b):void a.Logger.getInstance().warn("Cannot untrack a null physics body")},b.prototype._canCollide=function(b,c){var d=a.Pair.calculatePairHash(b.body,c.body);return!this._collisionHash[d]&&((b.collisionType!==a.CollisionType.Fixed||c.collisionType!==a.CollisionType.Fixed)&&(c.collisionType!==a.CollisionType.PreventCollision&&!c.isKilled()))},b.prototype.broadphase=function(b,c,d){var e=this,f=c/1e3,g=b.filter(function(b){return!b.isKilled()&&b.collisionType!==a.CollisionType.PreventCollision});this._collisionPairCache=[],this._collisionHash={};for(var h,i=0,j=g.length;i<j;i++)h=g[i],this._dynamicCollisionTree.query(h.body,function(b){if(e._canCollide(h,b.actor)){var c=new a.Pair(h.body,b);e._collisionHash[c.id]=!0,e._collisionPairCache.push(c)}return!1});if(d&&(d.physics.pairs=this._collisionPairCache.length),a.Physics.checkForFastBodies)for(var k=0,l=g;k<l.length;k++){var h=l[k];if(h.collisionType===a.CollisionType.Active){var m=h.vel.magnitude()*f+.5*h.acc.magnitude()*f*f,n=Math.min(h.body.getBounds().getHeight(),h.body.getBounds().getWidth());if(a.Physics.disableMinimumSpeedForFastBody||m>n/2){d&&d.physics.fastBodies++;var o=h.pos.sub(h.oldPos),p=h.body.collisionArea.getCenter(),q=h.body.collisionArea.getFurthestPoint(h.vel),r=q.sub(o),s=new a.Ray(r,h.vel);s.pos=s.pos.add(s.dir.scale(-2*a.Physics.surfaceEpsilon));var t,u=new a.Vector(1/0,1/0);if(this._dynamicCollisionTree.rayCastQuery(s,m+2*a.Physics.surfaceEpsilon,function(b){if(h.body!==b&&b.collisionArea){var c=b.collisionArea.rayCast(s,m+10*a.Physics.surfaceEpsilon);if(c){var d=c.sub(r);d.magnitude()<u.magnitude()&&(u=d,t=b)}}return!1}),t&&a.Vector.isValid(u)){var v=new a.Pair(h.body,t);this._collisionHash[v.id]||(this._collisionHash[v.id]=!0,this._collisionPairCache.push(v));var w=p.sub(q);h.pos=r.add(w).add(u).add(s.dir.scale(2*a.Physics.surfaceEpsilon)),h.body.collisionArea.recalc(),d&&d.physics.fastBodyCollisions++}}}}return this._collisionPairCache},b.prototype.narrowphase=function(a,b){for(var c=0;c<a.length;c++)a[c].collide(),b&&a[c].collision&&b.physics.collisions++},b.prototype.resolve=function(b,c){var d=0,e=this._collisionPairCache.length;for(d=0;d<e;d++)this._collisionPairCache[d].resolve(b,c);for(d=0;d<e;d++)this._collisionPairCache[d].collision&&(this._collisionPairCache[d].bodyA.applyMtv(),this._collisionPairCache[d].bodyB.applyMtv(),this._collisionPairCache[d].bodyA.actor.integrate(b*a.Physics.collisionShift),this._collisionPairCache[d].bodyB.actor.integrate(b*a.Physics.collisionShift))},b.prototype.update=function(a,b){var c=0,d=0,e=a.length;for(d;d<e;d++)this._dynamicCollisionTree.updateBody(a[d].body)&&c++;return c},b.prototype.debugDraw=function(b,c){if(a.Physics.broadphaseDebug&&this._dynamicCollisionTree.debugDraw(b,c),a.Physics.showContacts||a.Physics.showCollisionNormals)for(var d=0,e=this._collisionPairCache;d<e.length;d++){var f=e[d];f.debugDraw(b)}},b}();a.DynamicTreeCollisionBroadphase=b}(ex||(ex={}));var ex;!function(a){var b=function(){function b(){this.z=1,this.dx=0,this.dy=0,this.dz=0,this.ax=0,this.ay=0,this.az=0,this.rotation=0,this.rx=0,this._x=0,this._y=0,this._cameraMoving=!1,this._currentLerpTime=0,this._lerpDuration=1e3,this._totalLerpTime=0,this._lerpStart=null,this._lerpEnd=null,this._isShaking=!1,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._elapsedShakeTime=0,this._xShake=0,this._yShake=0,this._isZooming=!1,this._currentZoomScale=1,this._maxZoomScale=1,this._zoomDuration=0,this._elapsedZoomTime=0,this._zoomIncrement=.01,this._easing=a.EasingFunctions.EaseInOutCubic}return Object.defineProperty(b.prototype,"x",{get:function(){return this._x},set:function(a){this._follow||this._cameraMoving||(this._x=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"y",{get:function(){return this._y},set:function(a){this._follow||this._cameraMoving||(this._y=a)},enumerable:!0,configurable:!0}),b.prototype.setActorToFollow=function(a){this._follow=a},b.prototype.getFocus=function(){return new a.Vector(this.x,this.y)},b.prototype.move=function(b,c,d){if(void 0===d&&(d=a.EasingFunctions.EaseInOutCubic),"function"!=typeof d)throw"Please specify an EasingFunction";return this._follow?(new a.Promise).reject(b):(this._lerpPromise&&this._lerpPromise.state()===a.PromiseState.Pending&&this._lerpPromise.resolve(b),this._lerpPromise=new a.Promise,this._lerpStart=this.getFocus().clone(),this._lerpDuration=c,this._lerpEnd=b,this._currentLerpTime=0,this._cameraMoving=!0,this._easing=d,this._lerpPromise)},b.prototype.shake=function(a,b,c){this._isShaking=!0,this._shakeMagnitudeX=a,this._shakeMagnitudeY=b,this._shakeDuration=c},b.prototype.zoom=function(a,b){void 0===b&&(b=0),this._isZooming=!0,this._maxZoomScale=a,this._zoomDuration=b,b&&(this._zoomIncrement=Math.abs(this._maxZoomScale-this._currentZoomScale)/b*1e3),this._maxZoomScale<1?b?this._zoomIncrement=-1*this._zoomIncrement:(this._isZooming=!1,this._setCurrentZoomScale(this._maxZoomScale)):b||(this._isZooming=!1,this._setCurrentZoomScale(this._maxZoomScale))},b.prototype.getZoom=function(){return this.z},b.prototype._setCurrentZoomScale=function(a){this.z=a},b.prototype.update=function(a,b){this._x+=this.dx*b/1e3,this._y+=this.dy*b/1e3,this.z+=this.dz*b/1e3,this.dx+=this.ax*b/1e3,this.dy+=this.ay*b/1e3,this.dz+=this.az*b/1e3,this.rotation+=this.rx*b/1e3,this._cameraMoving&&(this._currentLerpTime<this._lerpDuration?(this._lerpEnd.x<this._lerpStart.x?this._x=this._lerpStart.x-(this._easing(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):this._x=this._easing(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?this._y=this._lerpStart.y-(this._easing(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):this._y=this._easing(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._currentLerpTime+=b):(this._x=this._lerpEnd.x,this._y=this._lerpEnd.y,this._lerpPromise.resolve(this._lerpEnd),this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1)),this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._xShake=0,this._yShake=0):(this._elapsedShakeTime+=b,this._xShake=(Math.random()*this._shakeMagnitudeX|0)+1,this._yShake=(Math.random()*this._shakeMagnitudeY|0)+1)},b.prototype.draw=function(a,b){var c=this.getFocus(),d=a.canvas.width,e=a.canvas.height,f=d/this.getZoom(),g=e/this.getZoom();a.scale(this.getZoom(),this.getZoom()),a.translate(-c.x+f/2+this._xShake,-c.y+g/2+this._yShake)},b.prototype.debugDraw=function(a){var b=this.getFocus();a.fillStyle="red",a.strokeStyle="white",a.lineWidth=3,a.beginPath(),a.arc(b.x,b.y,15,0,2*Math.PI),a.closePath(),a.stroke(),a.beginPath(),a.arc(b.x,b.y,5,0,2*Math.PI),a.closePath(),a.stroke()},b.prototype._isDoneShaking=function(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration},b.prototype._isDoneZooming=function(){return 0!==this._zoomDuration?this._elapsedZoomTime>=this._zoomDuration:this._maxZoomScale<1?this._currentZoomScale<=this._maxZoomScale:this._currentZoomScale>=this._maxZoomScale},b}();a.BaseCamera=b;var c=function(b){function c(){return b.apply(this,arguments)||this}return __extends(c,b),c.prototype.getFocus=function(){return this._follow?new a.Vector(this._follow.pos.x+this._follow.getWidth()/2,b.prototype.getFocus.call(this).y):b.prototype.getFocus.call(this)},c}(b);a.SideCamera=c;var d=function(b){function c(){return b.apply(this,arguments)||this}return __extends(c,b),c.prototype.getFocus=function(){return this._follow?new a.Vector(this._follow.pos.x+this._follow.getWidth()/2,this._follow.pos.y+this._follow.getHeight()/2):b.prototype.getFocus.call(this)},c}(b);a.LockedCamera=d}(ex||(ex={}));var ex;!function(a){var b;!function(a){a[a.ShortestPath=0]="ShortestPath",a[a.LongestPath=1]="LongestPath",a[a.Clockwise=2]="Clockwise",a[a.CounterClockwise=3]="CounterClockwise"}(b=a.RotationType||(a.RotationType={}))}(ex||(ex={}));var ex;!function(a){var b;!function(b){var c;!function(b){var c=function(){function b(b,c,d,e,f){this.actor=b,this.easingFcn=f,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=new a.Vector(0,0),this._lerpEnd=new a.Vector(0,0),this._initialized=!1,this._stopped=!1,this._distance=0,this._lerpDuration=e,this._lerpEnd=new a.Vector(c,d)}return b.prototype._initialize=function(){this._lerpStart=new a.Vector(this.actor.pos.x,this.actor.pos.y),this._currentLerpTime=0,this._distance=this._lerpStart.distance(this._lerpEnd)},b.prototype.update=function(a){this._initialized||(this._initialize(),this._initialized=!0);var b=this.actor.pos.x,c=this.actor.pos.y;this._currentLerpTime<this._lerpDuration?(b=this._lerpEnd.x<this._lerpStart.x?this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),c=this._lerpEnd.y<this._lerpStart.y?this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this.actor.pos.x=b,this.actor.pos.y=c,this._currentLerpTime+=a):(this.actor.pos.x=this._lerpEnd.x,this.actor.pos.y=this._lerpEnd.y)},b.prototype.isComplete=function(b){return this._stopped||new a.Vector(b.pos.x,b.pos.y).distance(this._lerpStart)>=this._distance},b.prototype.reset=function(){this._initialized=!1},b.prototype.stop=function(){this._stopped=!0},b}();b.EaseTo=c;var d=function(){function b(b,c,d,e){this._started=!1,this._stopped=!1,this._actor=b,this._end=new a.Vector(c,d),this._speed=e}return b.prototype.update=function(b){this._started||(this._started=!0,this._start=new a.Vector(this._actor.pos.x,this._actor.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());var c=this._dir.scale(this._speed);this._actor.vel.x=c.x,this._actor.vel.y=c.y,this.isComplete(this._actor)&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},b.prototype.isComplete=function(b){return this._stopped||new a.Vector(b.pos.x,b.pos.y).distance(this._start)>=this._distance},b.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},b.prototype.reset=function(){this._started=!1},b}();b.MoveTo=d;var e=function(){function b(b,c,d,e){if(this._started=!1,this._stopped=!1,this._actor=b,this._end=new a.Vector(c,d),e<=0)throw a.Logger.getInstance().error("Attempted to moveBy time less than or equal to zero : "+e),new Error("Cannot move in time <= 0");this._time=e}return b.prototype.update=function(b){this._started||(this._started=!0,this._start=new a.Vector(this._actor.pos.x,this._actor.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize(),this._speed=this._distance/(this._time/1e3));var c=this._dir.scale(this._speed);this._actor.vel.x=c.x,this._actor.vel.y=c.y,this.isComplete(this._actor)&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},b.prototype.isComplete=function(b){return this._stopped||new a.Vector(b.pos.x,b.pos.y).distance(this._start)>=this._distance},b.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},b.prototype.reset=function(){this._started=!1},b}();b.MoveBy=e;var f=function(){function b(b,c,d){this._started=!1,this._stopped=!1,this._actor=b,this._actorToFollow=c,this._current=new a.Vector(this._actor.pos.x,this._actor.pos.y),this._end=new a.Vector(c.pos.x,c.pos.y),this._maximumDistance=void 0!==d?d:this._current.distance(this._end),this._speed=0}return b.prototype.update=function(a){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());var b=Math.sqrt(Math.pow(this._actorToFollow.vel.x,2)+Math.pow(this._actorToFollow.vel.y,2));if(0!==b&&(this._speed=b),this._current.x=this._actor.pos.x,this._current.y=this._actor.pos.y,this._end.x=this._actorToFollow.pos.x,this._end.y=this._actorToFollow.pos.y,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){var c=this._dir.scale(this._speed);this._actor.vel.x=c.x,this._actor.vel.y=c.y}else this._actor.vel.x=0,this._actor.vel.y=0;this.isComplete(this._actor)&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},b.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},b.prototype.isComplete=function(a){return this._stopped},b.prototype.reset=function(){this._started=!1},b}();b.Follow=f;var g=function(){function b(b,c,d){this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._actor=b,this._actorToMeet=c,this._current=new a.Vector(this._actor.pos.x,this._actor.pos.y),this._end=new a.Vector(c.pos.x,c.pos.y),this._speed=d||0,void 0!==d&&(this._speedWasSpecified=!0)}return b.prototype.update=function(a){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());var b=Math.sqrt(Math.pow(this._actorToMeet.vel.x,2)+Math.pow(this._actorToMeet.vel.y,2));0===b||this._speedWasSpecified||(this._speed=b),this._current.x=this._actor.pos.x,this._current.y=this._actor.pos.y,this._end.x=this._actorToMeet.pos.x,this._end.y=this._actorToMeet.pos.y,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();var c=this._dir.scale(this._speed);this._actor.vel.x=c.x,this._actor.vel.y=c.y,this.isComplete(this._actor)&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},b.prototype.isComplete=function(a){return this._stopped||this._distanceBetween<=1},b.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},b.prototype.reset=function(){this._started=!1},b}();b.Meet=g;var h=function(){function b(b,c,d,e){this._started=!1,this._stopped=!1,this._actor=b,this._end=c,this._speed=d,this._rotationType=e||a.RotationType.ShortestPath}return b.prototype.update=function(b){if(!this._started){this._started=!0,this._start=this._actor.rotation;var c=Math.abs(this._end-this._start),d=a.Util.TwoPI-c;switch(c>d?(this._shortDistance=d,this._longDistance=c):(this._shortDistance=c,this._longDistance=d),this._shortestPathIsPositive=(this._start-this._end+a.Util.TwoPI)%a.Util.TwoPI>=Math.PI,this._rotationType){case a.RotationType.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case a.RotationType.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case a.RotationType.Clockwise:this._direction=1,this._shortestPathIsPositive?this._distance=this._shortDistance:this._distance=this._longDistance;break;case a.RotationType.CounterClockwise:this._direction=-1,this._shortestPathIsPositive?this._distance=this._longDistance:this._distance=this._shortDistance}}this._actor.rx=this._direction*this._speed,this.isComplete(this._actor)&&(this._actor.rotation=this._end,this._actor.rx=0,this._stopped=!0)},b.prototype.isComplete=function(a){var b=Math.abs(this._actor.rotation-this._start);return this._stopped||b>=Math.abs(this._distance)},b.prototype.stop=function(){this._actor.rx=0,this._stopped=!0},b.prototype.reset=function(){this._started=!1},b}();b.RotateTo=h;var i=function(){function b(b,c,d,e){this._started=!1,this._stopped=!1,this._actor=b,this._end=c,this._time=d,this._rotationType=e||a.RotationType.ShortestPath}return b.prototype.update=function(b){if(!this._started){this._started=!0,this._start=this._actor.rotation;var c=Math.abs(this._end-this._start),d=a.Util.TwoPI-c;switch(c>d?(this._shortDistance=d,this._longDistance=c):(this._shortDistance=c,this._longDistance=d),this._shortestPathIsPositive=(this._start-this._end+a.Util.TwoPI)%a.Util.TwoPI>=Math.PI,this._rotationType){case a.RotationType.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case a.RotationType.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case a.RotationType.Clockwise:this._direction=1,this._shortDistance>=0?this._distance=this._shortDistance:this._distance=this._longDistance;break;case a.RotationType.CounterClockwise:this._direction=-1,this._shortDistance<=0?this._distance=this._shortDistance:this._distance=this._longDistance}this._speed=Math.abs(this._distance/this._time*1e3)}this._actor.rx=this._direction*this._speed,this.isComplete(this._actor)&&(this._actor.rotation=this._end,this._actor.rx=0,this._stopped=!0)},b.prototype.isComplete=function(a){var b=Math.abs(this._actor.rotation-this._start);return this._stopped||b>=Math.abs(this._distance)},b.prototype.stop=function(){this._actor.rx=0,this._stopped=!0},b.prototype.reset=function(){this._started=!1},b}();b.RotateBy=i;var j=function(){function a(a,b,c,d,e){this._started=!1,this._stopped=!1,this._actor=a,this._endX=b,this._endY=c,this._speedX=d,this._speedY=e}return a.prototype.update=function(a){if(this._started||(this._started=!0,this._startX=this._actor.scale.x,this._startY=this._actor.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._actor.scale.x-this._startX)>=this._distanceX)this._actor.sx=0;else{var b=this._endY<this._startY?-1:1;this._actor.sx=this._speedX*b}if(Math.abs(this._actor.scale.y-this._startY)>=this._distanceY)this._actor.sy=0;else{var c=this._endY<this._startY?-1:1;this._actor.sy=this._speedY*c}this.isComplete(this._actor)&&(this._actor.scale.x=this._endX,this._actor.scale.y=this._endY,this._actor.sx=0,this._actor.sy=0)},a.prototype.isComplete=function(a){return this._stopped||Math.abs(this._actor.scale.y-this._startX)>=this._distanceX&&Math.abs(this._actor.scale.y-this._startY)>=this._distanceY},a.prototype.stop=function(){this._actor.sx=0,this._actor.sy=0,this._stopped=!0},a.prototype.reset=function(){this._started=!1},a}();b.ScaleTo=j;var k=function(){function a(a,b,c,d){this._started=!1,this._stopped=!1,this._actor=a,this._endX=b,this._endY=c,this._time=d,this._speedX=(this._endX-this._actor.scale.x)/d*1e3,this._speedY=(this._endY-this._actor.scale.y)/d*1e3}return a.prototype.update=function(a){this._started||(this._started=!0,this._startX=this._actor.scale.x,this._startY=this._actor.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY));var b=this._endX<this._startX?-1:1,c=this._endY<this._startY?-1:1;this._actor.sx=this._speedX*b,this._actor.sy=this._speedY*c,this.isComplete(this._actor)&&(this._actor.scale.x=this._endX,this._actor.scale.y=this._endY,this._actor.sx=0,this._actor.sy=0)},a.prototype.isComplete=function(a){return this._stopped||Math.abs(this._actor.scale.x-this._startX)>=this._distanceX&&Math.abs(this._actor.scale.y-this._startY)>=this._distanceY},a.prototype.stop=function(){this._actor.sx=0,this._actor.sy=0,this._stopped=!0},a.prototype.reset=function(){this._started=!1},a}();b.ScaleBy=k;var l=function(){function a(a,b){this._elapsedTime=0,this._started=!1,this._stopped=!1,this._actor=a,this._delay=b}return a.prototype.update=function(a){this._started||(this._started=!0),this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._elapsedTime+=a},a.prototype.isComplete=function(a){return this._stopped||this._elapsedTime>=this._delay},a.prototype.stop=function(){this._stopped=!0},a.prototype.reset=function(){this._elapsedTime=0,this._started=!1},a}();b.Delay=l;var m=function(){function a(a,b,c,d){void 0===d&&(d=1),this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._actor=a,this._timeVisible=b,this._timeNotVisible=c,this._duration=(b+c)*d}return a.prototype.update=function(a){this._started||(this._started=!0),this._elapsedTime+=a,this._totalTime+=a,this._actor.visible&&this._elapsedTime>=this._timeVisible&&(this._actor.visible=!1,this._elapsedTime=0),!this._actor.visible&&this._elapsedTime>=this._timeNotVisible&&(this._actor.visible=!0,this._elapsedTime=0),this.isComplete(this._actor)&&(this._actor.visible=!0)},a.prototype.isComplete=function(a){return this._stopped||this._totalTime>=this._duration},a.prototype.stop=function(){this._actor.visible=!0,this._stopped=!0},a.prototype.reset=function(){this._started=!1,this._elapsedTime=0,this._totalTime=0},a}();b.Blink=m;var n=function(){function b(a,b,c){this._multiplier=1,this._started=!1,this._stopped=!1,this._actor=a,this._endOpacity=b,this._speed=c}return b.prototype.update=function(b){this._started||(this._started=!0,this._endOpacity<this._actor.opacity?this._multiplier=-1:this._multiplier=1),this._speed>0&&(this._actor.opacity+=this._multiplier*(Math.abs(this._actor.opacity-this._endOpacity)*b)/this._speed),this._speed-=b,this.isComplete(this._actor)&&(this._actor.opacity=this._endOpacity),a.Logger.getInstance().debug("[Action fade] Actor opacity:",this._actor.opacity)},b.prototype.isComplete=function(a){return this._stopped||Math.abs(this._actor.opacity-this._endOpacity)<.05},b.prototype.stop=function(){this._stopped=!0},b.prototype.reset=function(){this._started=!1},b}();b.Fade=n;var o=function(){function a(a){this._started=!1,this._stopped=!1,this._actor=a}return a.prototype.update=function(a){this._actor.actionQueue.clearActions(),this._actor.kill(),this._stopped=!0},a.prototype.isComplete=function(){return this._stopped},a.prototype.stop=function(){},a.prototype.reset=function(){},a}();b.Die=o;var p=function(){function a(a,b){this._method=null,this._actor=null,this._hasBeenCalled=!1,this._actor=a,this._method=b}return a.prototype.update=function(a){this._method.call(this._actor),this._hasBeenCalled=!0},a.prototype.isComplete=function(a){return this._hasBeenCalled},a.prototype.reset=function(){this._hasBeenCalled=!1},a.prototype.stop=function(){this._hasBeenCalled=!0},a}();b.CallMethod=p;var q=function(){function a(a,b,c){this._stopped=!1,this._actor=a,this._actionQueue=new s(a),this._repeat=b,this._originalRepeat=b;var d=0,e=c.length;for(d;d<e;d++)c[d].reset(),this._actionQueue.add(c[d])}return a.prototype.update=function(a){this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._actionQueue.hasNext()||(this._actionQueue.reset(),this._repeat--),this._actionQueue.update(a)},a.prototype.isComplete=function(){return this._stopped||this._repeat<=0},a.prototype.stop=function(){this._stopped=!0},a.prototype.reset=function(){this._repeat=this._originalRepeat},a}();b.Repeat=q;var r=function(){function a(a,b){this._stopped=!1,this._actor=a,this._actionQueue=new s(a);var c=0,d=b.length;for(c;c<d;c++)b[c].reset(),this._actionQueue.add(b[c])}return a.prototype.update=function(a){this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._stopped||(this._actionQueue.hasNext()||this._actionQueue.reset(),this._actionQueue.update(a))},a.prototype.isComplete=function(){return this._stopped},a.prototype.stop=function(){this._stopped=!0,this._actionQueue.clearActions()},a.prototype.reset=function(){},a}();b.RepeatForever=r;var s=function(){function a(a){this._actions=[],this._completedActions=[],this._actor=a}return a.prototype.add=function(a){this._actions.push(a)},a.prototype.remove=function(a){var b=this._actions.indexOf(a);this._actions.splice(b,1)},a.prototype.clearActions=function(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()},a.prototype.getActions=function(){return this._actions.concat(this._completedActions)},a.prototype.hasNext=function(){return this._actions.length>0},a.prototype.reset=function(){this._actions=this.getActions();var a=0,b=this._actions.length;for(a;a<b;a++)this._actions[a].reset();this._completedActions=[]},a.prototype.update=function(a){this._actions.length>0&&(this._currentAction=this._actions[0],this._currentAction.update(a),this._currentAction.isComplete(this._actor)&&this._completedActions.push(this._actions.shift()))},a}();b.ActionQueue=s}(c=b.Actions||(b.Actions={}))}(b=a.Internal||(a.Internal={}))}(ex||(ex={}));var ex;!function(a){var b=function(){function b(){this._actors=[],this._queues=[],null!==arguments&&(this._actors=Array.prototype.slice.call(arguments,0),this._queues=this._actors.map(function(a){return a.actionQueue}))}return b.prototype.clearActions=function(){var a=0,b=this._queues.length;for(a;a<b;a++)this._queues[a].clearActions()},b.prototype.addActorToContext=function(a){this._actors.push(a),this._queues.push(a.actionQueue)},b.prototype.removeActorFromContext=function(a){var b=this._actors.indexOf(a);b>-1&&(this._actors.splice(b,1),this._queues.splice(b,1))},b.prototype.easeTo=function(b,c,d,e){void 0===e&&(e=a.EasingFunctions.Linear);var f=0,g=this._queues.length;for(f;f<g;f++)this._queues[f].add(new a.Internal.Actions.EaseTo(this._actors[f],b,c,d,e));return this},b.prototype.moveTo=function(b,c,d){var e=0,f=this._queues.length;for(e;e<f;e++)this._queues[e].add(new a.Internal.Actions.MoveTo(this._actors[e],b,c,d));return this},b.prototype.moveBy=function(b,c,d){var e=0,f=this._queues.length;for(e;e<f;e++)this._queues[e].add(new a.Internal.Actions.MoveBy(this._actors[e],b,c,d));return this},b.prototype.rotateTo=function(b,c,d){var e=0,f=this._queues.length;for(e;e<f;e++)this._queues[e].add(new a.Internal.Actions.RotateTo(this._actors[e],b,c,d));return this},b.prototype.rotateBy=function(b,c,d){var e=0,f=this._queues.length;for(e;e<f;e++)this._queues[e].add(new a.Internal.Actions.RotateBy(this._actors[e],b,c,d));return this},b.prototype.scaleTo=function(b,c,d,e){var f=0,g=this._queues.length;for(f;f<g;f++)this._queues[f].add(new a.Internal.Actions.ScaleTo(this._actors[f],b,c,d,e));return this},b.prototype.scaleBy=function(b,c,d){var e=0,f=this._queues.length;for(e;e<f;e++)this._queues[e].add(new a.Internal.Actions.ScaleBy(this._actors[e],b,c,d));return this},b.prototype.blink=function(b,c,d){void 0===d&&(d=1);var e=0,f=this._queues.length;for(e;e<f;e++)this._queues[e].add(new a.Internal.Actions.Blink(this._actors[e],b,c,d));return this},b.prototype.fade=function(b,c){var d=0,e=this._queues.length;for(d;d<e;d++)this._queues[d].add(new a.Internal.Actions.Fade(this._actors[d],b,c));return this},b.prototype.delay=function(b){var c=0,d=this._queues.length;for(c;c<d;c++)this._queues[c].add(new a.Internal.Actions.Delay(this._actors[c],b));return this},b.prototype.die=function(){var b=0,c=this._queues.length;for(b;b<c;b++)this._queues[b].add(new a.Internal.Actions.Die(this._actors[b]));return this},b.prototype.callMethod=function(b){var c=0,d=this._queues.length;for(c;c<d;c++)this._queues[c].add(new a.Internal.Actions.CallMethod(this._actors[c],b));return this},b.prototype.repeat=function(b){if(!b)return this.repeatForever(),this;var c=0,d=this._queues.length;for(c;c<d;c++)this._queues[c].add(new a.Internal.Actions.Repeat(this._actors[c],b,this._actors[c].actionQueue.getActions()));return this},b.prototype.repeatForever=function(){var b=0,c=this._queues.length;for(b;b<c;b++)this._queues[b].add(new a.Internal.Actions.RepeatForever(this._actors[b],this._actors[b].actionQueue.getActions()));return this},b.prototype.follow=function(b,c){var d=0,e=this._queues.length;for(d;d<e;d++)void 0===c?this._queues[d].add(new a.Internal.Actions.Follow(this._actors[d],b)):this._queues[d].add(new a.Internal.Actions.Follow(this._actors[d],b,c));return this},b.prototype.meet=function(b,c){var d=0,e=this._queues.length;for(d;d<e;d++)void 0===c?this._queues[d].add(new a.Internal.Actions.Meet(this._actors[d],b)):this._queues[d].add(new a.Internal.Actions.Meet(this._actors[d],b,c));return this},b.prototype.asPromise=function(){var b=this,c=this._queues.map(function(c,d){var e=new a.Promise;return c.add(new a.Internal.Actions.CallMethod(b._actors[d],function(){e.resolve()})),e});return a.Promise.join.apply(this,c)},b}();a.ActionContext=b}(ex||(ex={}));var ex;!function(a){var b=function(b){function c(c,d){var e=b.call(this)||this;if(e.name=c,e.scene=d,e._logger=a.Logger.getInstance(),e._members=[],e.actions=new a.ActionContext,null==d)e._logger.error("Invalid constructor arguments passed to Group: ",c,", scene must not be null!");else{var f=d.groups[c];f&&e._logger.warn("Group with name",c,"already exists. This new group will replace it."),d.groups[c]=e}return e}return __extends(c,b),c.prototype.add=function(b){b instanceof a.Actor&&(b=[].concat(b));var c,d=0,e=b.length;for(d;d<e;d++)c=this.getMembers().indexOf(b[d]),c===-1&&(this._members.push(b[d]),this.scene.add(b[d]),this.actions.addActorToContext(b[d]),
this.eventDispatcher.wire(b[d].eventDispatcher))},c.prototype.remove=function(a){var b=this._members.indexOf(a);b>-1&&(this._members.splice(b,1),this.actions.removeActorFromContext(a),this.eventDispatcher.unwire(a.eventDispatcher))},c.prototype.move=function(b){var c=0,d=this.getMembers(),e=d.length;if(1===arguments.length&&b instanceof a.Vector)for(c;c<e;c++)d[c].pos.x+=b.x,d[c].pos.y+=b.y;else if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var f=arguments[0],g=arguments[1];for(c;c<e;c++)d[c].pos.x+=f,d[c].pos.y+=g}else this._logger.error("Invalid arguments passed to group move",this.name,"args:",arguments)},c.prototype.rotate=function(a){if("number"==typeof arguments[0]){var b=arguments[0],c=0,d=this.getMembers(),e=d.length;for(c;c<e;c++)d[c].rotation+=b}else this._logger.error("Invalid arguments passed to group rotate",this.name,"args:",arguments)},c.prototype.on=function(a,b){this.eventDispatcher.on(a,b)},c.prototype.off=function(a,b){this.eventDispatcher.off(a,b)},c.prototype.emit=function(a,b){this.eventDispatcher.emit(a,b)},c.prototype.contains=function(a){return this.getMembers().indexOf(a)>-1},c.prototype.getMembers=function(){return this._members},c.prototype.getRandomMember=function(){return this._members[Math.floor(Math.random()*this._members.length)]},c.prototype.getBounds=function(){return this.getMembers().map(function(a){return a.getBounds()}).reduce(function(a,b){return a.combine(b)})},c}(a.Class);a.Group=b}(ex||(ex={}));var ex;!function(a){var b=function(){function a(a){this._getComparable=a}return a.prototype.find=function(a){return this._find(this._root,a)},a.prototype._find=function(a,b){return null!=a&&(this._getComparable.call(b)===a.getKey()?a.getData().indexOf(b)>-1:this._getComparable.call(b)<a.getKey()?this._find(a.getLeft(),b):this._find(a.getRight(),b))},a.prototype.get=function(a){return this._get(this._root,a)},a.prototype._get=function(a,b){return null==a?[]:b===a.getKey()?a.getData():b<a.getKey()?this._get(a.getLeft(),b):this._get(a.getRight(),b)},a.prototype.add=function(a){return null==this._root?(this._root=new c(this._getComparable.call(a),[a],null,null),!0):this._insert(this._root,a)},a.prototype._insert=function(a,b){return null!=a&&(this._getComparable.call(b)===a.getKey()?!(a.getData().indexOf(b)>-1)&&(a.getData().push(b),!0):this._getComparable.call(b)<a.getKey()?null==a.getLeft()?(a.setLeft(new c(this._getComparable.call(b),[b],null,null)),!0):this._insert(a.getLeft(),b):null==a.getRight()?(a.setRight(new c(this._getComparable.call(b),[b],null,null)),!0):this._insert(a.getRight(),b))},a.prototype.removeByComparable=function(a){this._root=this._remove(this._root,a)},a.prototype._remove=function(a,b){if(null==a)return null;if(this._getComparable.call(b)!==a.getKey())return this._getComparable.call(b)<a.getKey()?(a.setLeft(this._remove(a.getLeft(),b)),a):(a.setRight(this._remove(a.getRight(),b)),a);var c=a.getData().indexOf(b);if(c>-1){if(a.getData().splice(c,1),0===a.getData().length){if(null==a.getLeft()&&null==a.getRight())return null;if(null==a.getLeft())return a.getRight();if(null==a.getRight())return a.getLeft();var d=this._findMinNode(a.getRight());return a.setKey(d.getKey()),a.setData(d.getData()),a.setRight(this._cleanup(a.getRight(),d)),a}return a}},a.prototype._cleanup=function(a,b){var c=b.getKey();if(null==a)return null;if(c===a.getKey()){if(null==a.getLeft()&&null==a.getRight())return null;if(null==a.getLeft())return a.getRight();if(null==a.getRight())return a.getLeft();var d=this._findMinNode(a.getRight());return a.setKey(d.getKey()),a.setData(d.getData()),a.setRight(this._cleanup(a.getRight(),d)),a}return this._getComparable.call(b)<a.getKey()?(a.setLeft(this._cleanup(a.getLeft(),b)),a):(a.setRight(this._cleanup(a.getRight(),b)),a)},a.prototype._findMinNode=function(a){for(var b=a;null!=b.getLeft();)b=b.getLeft();return b},a.prototype.list=function(){var a=new Array;return this._list(this._root,a),a},a.prototype._list=function(a,b){null!=a&&(this._list(a.getLeft(),b),a.getData().forEach(function(a){b.push(a)}),this._list(a.getRight(),b))},a}();a.SortedList=b;var c=function(){function a(a,b,c,d){this._key=a,this._data=b,this._left=c,this._right=d}return a.prototype.getKey=function(){return this._key},a.prototype.setKey=function(a){this._key=a},a.prototype.getData=function(){return this._data},a.prototype.setData=function(a){this._data=a},a.prototype.getLeft=function(){return this._left},a.prototype.setLeft=function(a){this._left=a},a.prototype.getRight=function(){return this._right},a.prototype.setRight=function(a){this._right=a},a}();a.BinaryTreeNode=c;var d=function(){function a(a){this._key=0,this._key=a}return a.prototype.getTheKey=function(){return this._key},a.prototype.setKey=function(a){this._key=a},a}();a.MockedElement=d}(ex||(ex={}));var ex;!function(a){var b=function(b){function c(c){var d=b.call(this)||this;return d.children=[],d.tileMaps=[],d.groups={},d.uiActors=[],d._isInitialized=!1,d._sortedDrawingTree=new a.SortedList(a.Actor.prototype.getZIndex),d._broadphase=new a.DynamicTreeCollisionBroadphase,d._killQueue=[],d._timers=[],d._cancelQueue=[],d._logger=a.Logger.getInstance(),d.camera=new a.BaseCamera,c&&(d.camera.x=c.width/2,d.camera.y=c.height/2),d}return __extends(c,b),c.prototype.on=function(a,c){b.prototype.on.call(this,a,c)},c.prototype.onInitialize=function(a){this.camera&&(this.camera.x=a.width/2,this.camera.y=a.height/2),this._logger.debug("Scene.onInitialize",this,a)},c.prototype.onActivate=function(){this._logger.debug("Scene.onActivate",this)},c.prototype.onDeactivate=function(){this._logger.debug("Scene.onDeactivate",this)},c.prototype._initializeChildren=function(){for(var a=0,b=this.children;a<b.length;a++){var c=b[a];c._initialize(this.engine)}},Object.defineProperty(c.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!0,configurable:!0}),c.prototype._initialize=function(b){this.isInitialized||(this.onInitialize.call(this,b),this.eventDispatcher.emit("initialize",new a.InitializeEvent(b)),this._initializeChildren(),this._isInitialized=!0)},c.prototype.update=function(b,c){this.emit("preupdate",new a.PreUpdateEvent(b,c,this));var d,e;for(this.camera&&this.camera.update(b,c),d=0,e=this.uiActors.length;d<e;d++)b.stats.currFrame.actors.ui++,this.uiActors[d].update(b,c);for(d=0,e=this.tileMaps.length;d<e;d++)this.tileMaps[d].update(b,c);for(d=0,e=this.children.length;d<e;d++)b.stats.currFrame.actors.alive++,this.children[d].update(b,c);if(this._broadphase&&a.Physics.enabled){var f=Date.now();this._broadphase.update(this.children,c);for(var g=this._broadphase.broadphase(this.children,c,b.stats.currFrame),h=Date.now(),i=Date.now(),j=a.Physics.collisionPasses,k=c/j;j>0;)this._broadphase.narrowphase(g,b.stats.currFrame),this._broadphase.resolve(k,a.Physics.collisionResolutionStrategy),j--;var l=Date.now();b.stats.currFrame.physics.broadphase=h-f,b.stats.currFrame.physics.narrowphase=l-i}var m;for(d=0,e=this._killQueue.length;d<e;d++)m=this.children.indexOf(this._killQueue[d]),m>-1&&(this._sortedDrawingTree.removeByComparable(this._killQueue[d]),this.children.splice(m,1));for(b.stats.currFrame.actors.killed=this._killQueue.length,this._killQueue.length=0,d=0,e=this._cancelQueue.length;d<e;d++)this.removeTimer(this._cancelQueue[d]);this._cancelQueue.length=0,this._timers=this._timers.filter(function(a){return a.update(c),!a.complete}),this.emit("postupdate",new a.PostUpdateEvent(b,c,this))},c.prototype.draw=function(b,c){this.emit("predraw",new a.PreDrawEvent(b,c,this)),b.save(),this.camera&&this.camera.draw(b,c);var d,e;for(d=0,e=this.tileMaps.length;d<e;d++)this.tileMaps[d].draw(b,c);var f=this._sortedDrawingTree.list();for(d=0,e=f.length;d<e;d++)f[d].visible&&!f[d].isOffScreen&&f[d].draw(b,c);for(this.engine&&this.engine.isDebug&&(b.strokeStyle="yellow",this.debugDraw(b)),b.restore(),d=0,e=this.uiActors.length;d<e;d++)this.uiActors[d].visible&&this.uiActors[d].draw(b,c);if(this.engine&&this.engine.isDebug)for(d=0,e=this.uiActors.length;d<e;d++)this.uiActors[d].debugDraw(b);this.emit("postdraw",new a.PostDrawEvent(b,c,this))},c.prototype.debugDraw=function(b){this.emit("predebugdraw",new a.PreDebugDrawEvent(b,this));var c,d;for(c=0,d=this.tileMaps.length;c<d;c++)this.tileMaps[c].debugDraw(b);for(c=0,d=this.children.length;c<d;c++)this.children[c].debugDraw(b);this._broadphase.debugDraw(b,20),this.camera.debugDraw(b),this.emit("postdebugdraw",new a.PostDebugDrawEvent(b,this))},c.prototype.contains=function(a){return this.children.indexOf(a)>-1},c.prototype.add=function(b){return b instanceof a.Actor&&b.unkill(),b instanceof a.UIActor?void(a.Util.contains(this.uiActors,b)||this.addUIActor(b)):b instanceof a.Actor?void(a.Util.contains(this.children,b)||(this._addChild(b),this._sortedDrawingTree.add(b))):b instanceof a.Timer?void(a.Util.contains(this._timers,b)||this.addTimer(b)):void(b instanceof a.TileMap&&(a.Util.contains(this.tileMaps,b)||this.addTileMap(b)))},c.prototype.remove=function(b){return b instanceof a.UIActor?void this.removeUIActor(b):(b instanceof a.Actor&&(this._broadphase.untrack(b.body),this._removeChild(b)),b instanceof a.Timer&&this.removeTimer(b),void(b instanceof a.TileMap&&this.removeTileMap(b)))},c.prototype.addUIActor=function(a){this.uiActors.push(a),a.scene=this},c.prototype.removeUIActor=function(a){var b=this.uiActors.indexOf(a);b>-1&&this.uiActors.splice(b,1)},c.prototype._addChild=function(a){this._broadphase.track(a.body),a.scene=this,this.children.push(a),this._sortedDrawingTree.add(a),a.parent=this.actor},c.prototype.addTileMap=function(a){this.tileMaps.push(a)},c.prototype.removeTileMap=function(a){var b=this.tileMaps.indexOf(a);b>-1&&this.tileMaps.splice(b,1)},c.prototype._removeChild=function(a){this._broadphase.untrack(a.body),this._killQueue.push(a),a.parent=null},c.prototype.addTimer=function(a){return this._timers.push(a),a.scene=this,a},c.prototype.removeTimer=function(a){var b=this._timers.indexOf(a);return b!==-1&&this._timers.splice(b,1),a},c.prototype.cancelTimer=function(a){return this._cancelQueue.push(a),a},c.prototype.isTimerActive=function(a){return this._timers.indexOf(a)>-1},c.prototype.createGroup=function(b){return new a.Group(b,this)},c.prototype.getGroup=function(a){return this.groups[a]},c.prototype.removeGroup=function(b){"string"==typeof b?delete this.groups[b]:b instanceof a.Group?delete this.groups[b.name]:this._logger.error("Invalid arguments to removeGroup",b)},c.prototype.cleanupDrawTree=function(a){this._sortedDrawingTree.removeByComparable(a)},c.prototype.updateDrawTree=function(a){this._sortedDrawingTree.add(a)},c}(a.Class);a.Scene=b}(ex||(ex={}));var ex;!function(a){var b=function(){function a(){}return a}();b.Linear=function(a,b,c,d){return c-=b,c*a/d+b},b.EaseInQuad=function(a,b,c,d){return c-=b,a/=d,c*a*a+b},b.EaseOutQuad=function(a,b,c,d){return c-=b,a/=d,-c*a*(a-2)+b},b.EaseInOutQuad=function(a,b,c,d){return c-=b,a/=d/2,a<1?c/2*a*a+b:(a--,-c/2*(a*(a-2)-1)+b)},b.EaseInCubic=function(a,b,c,d){return c-=b,a/=d,c*a*a*a+b},b.EaseOutCubic=function(a,b,c,d){return c-=b,a/=d,a--,c*(a*a*a+1)+b},b.EaseInOutCubic=function(a,b,c,d){return c-=b,a/=d/2,a<1?c/2*a*a*a+b:(a-=2,c/2*(a*a*a+2)+b)},a.EasingFunctions=b}(ex||(ex={}));var ex;!function(a){var b=function(b){function d(e,f,g,h,i){var j=b.call(this)||this;return j.id=d.maxId++,j.body=new a.Body(j),j._height=0,j._width=0,j.scale=new a.Vector(1,1),j.sx=0,j.sy=0,j.isOffScreen=!1,j.visible=!0,j.opacity=1,j.previousOpacity=1,j.logger=a.Logger.getInstance(),j.scene=null,j.parent=null,j.children=[],j.collisionType=c.PreventCollision,j.collisionGroups=[],j._collisionHandlers={},j._isInitialized=!1,j.frames={},j._effectsDirty=!1,j.currentDrawing=null,j.traits=[],j.enableCapturePointer=!1,j.capturePointer={captureMoveEvents:!1},j._zIndex=0,j._isKilled=!1,j._opacityFx=new a.Effects.Opacity(j.opacity),j.pos.x=e||0,j.pos.y=f||0,j._width=g||0,j._height=h||0,i&&(j.color=i.clone(),j.opacity=i.a),j.traits.push(new a.Traits.TileMapCollisionDetection),j.traits.push(new a.Traits.OffscreenCulling),j.traits.push(new a.Traits.CapturePointer),j.actionQueue=new a.Internal.Actions.ActionQueue(j),j.actions=new a.ActionContext(j),j.anchor=new a.Vector(.5,.5),j.body.useBoxCollision(),j}return __extends(d,b),Object.defineProperty(d.prototype,"collisionArea",{get:function(){return this.body.collisionArea},set:function(a){this.body.collisionArea=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"x",{get:function(){return this.body.pos.x},set:function(a){this.body.pos.x=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"y",{get:function(){return this.body.pos.y},set:function(a){this.body.pos.y=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"pos",{get:function(){return this.body.pos},set:function(a){this.body.pos=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"oldPos",{get:function(){return this.body.oldPos},set:function(a){this.body.oldPos=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"vel",{get:function(){return this.body.vel},set:function(a){this.body.vel=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"oldVel",{get:function(){return this.body.oldVel},set:function(a){this.body.oldVel=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"acc",{get:function(){return this.body.acc},set:function(a){this.body.acc=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"rotation",{get:function(){return this.body.rotation},set:function(a){this.body.rotation=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"rx",{get:function(){return this.body.rx},set:function(a){this.body.rx=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"torque",{get:function(){return this.body.torque},set:function(a){this.body.torque=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"mass",{get:function(){return this.body.mass},set:function(a){this.body.mass=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"moi",{get:function(){return this.body.moi},set:function(a){this.body.moi=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"friction",{get:function(){return this.body.friction},set:function(a){this.body.friction=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"restitution",{get:function(){return this.body.restitution},set:function(a){this.body.restitution=a},enumerable:!0,configurable:!0}),d.prototype.onInitialize=function(a){},Object.defineProperty(d.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!0,configurable:!0}),d.prototype._initialize=function(b){this.isInitialized||(this.onInitialize(b),this.eventDispatcher.emit("initialize",new a.InitializeEvent(b)),this._isInitialized=!0);for(var c=0,d=this.children;c<d.length;c++){var e=d[c];e._initialize(b)}},d.prototype._checkForPointerOptIn=function(a){if(a){var b=a.toLowerCase();"pointerup"!==b&&"pointerdown"!==b&&"pointermove"!==b||(this.enableCapturePointer=!0,"pointermove"===b&&(this.capturePointer.captureMoveEvents=!0))}},d.prototype.on=function(a,b){this._checkForPointerOptIn(a),this.eventDispatcher.on(a,b)},d.prototype.kill=function(){this.scene?(this.emit("kill",new a.KillEvent(this)),this.scene.remove(this),this._isKilled=!0):this.logger.warn("Cannot kill actor, it was never added to the Scene")},d.prototype.unkill=function(){this._isKilled=!1},d.prototype.isKilled=function(){return this._isKilled},d.prototype.add=function(b){b.collisionType=c.PreventCollision,a.Util.addItemToArray(b,this.children)&&(b.parent=this)},d.prototype.remove=function(b){a.Util.removeItemToArray(b,this.children)&&(b.parent=null)},d.prototype.setDrawing=function(b){b=b.toString(),this.currentDrawing!==this.frames[b]&&(null!=this.frames[b]?(this.frames[b].reset(),this.currentDrawing=this.frames[b]):a.Logger.getInstance().error("the specified drawing key '"+b+"' does not exist"))},d.prototype.addDrawing=function(b){2===arguments.length?(this.frames[arguments[0]]=arguments[1],this.currentDrawing||(this.currentDrawing=arguments[1]),this._effectsDirty=!0):(arguments[0]instanceof a.Sprite&&this.addDrawing("default",arguments[0]),arguments[0]instanceof a.Texture&&this.addDrawing("default",arguments[0].asSprite()))},Object.defineProperty(d.prototype,"z",{get:function(){return this.getZIndex()},set:function(a){this.setZIndex(a)},enumerable:!0,configurable:!0}),d.prototype.getZIndex=function(){return this._zIndex},d.prototype.setZIndex=function(a){this.scene.cleanupDrawTree(this),this._zIndex=a,this.scene.updateDrawTree(this)},d.prototype.addCollisionGroup=function(a){this.collisionGroups.push(a)},d.prototype.removeCollisionGroup=function(a){var b=this.collisionGroups.indexOf(a);b!==-1&&this.collisionGroups.splice(b,1)},d.prototype.getCenter=function(){return new a.Vector(this.pos.x+this.getWidth()/2-this.anchor.x*this.getWidth(),this.pos.y+this.getHeight()/2-this.anchor.y*this.getHeight())},d.prototype.getWidth=function(){return this._width*this.getGlobalScale().x},d.prototype.setWidth=function(a){this._width=a/this.scale.x},d.prototype.getHeight=function(){return this._height*this.getGlobalScale().y},d.prototype.setHeight=function(a){this._height=a/this.scale.y},d.prototype.getLeft=function(){return this.getBounds().left},d.prototype.getRight=function(){return this.getBounds().right},d.prototype.getTop=function(){return this.getBounds().top},d.prototype.getBottom=function(){return this.getBounds().bottom},d.prototype.getWorldRotation=function(){return this.parent?this.rotation+this.parent.getWorldRotation():this.rotation},d.prototype.getWorldPos=function(){if(!this.parent)return this.pos.clone();var b=[],c=this;for(b.push(this);c.parent;)c=c.parent,b.push(c);var d=b.reduceRight(function(a,b,c,d){return b.parent?a+b.pos.x*b.getGlobalScale().x:a+b.pos.x},0),e=b.reduceRight(function(a,b,c,d){return b.parent?a+b.pos.y*b.getGlobalScale().y:a+b.pos.y},0),f=c.getWorldPos(),g=this.getWorldRotation();return new a.Vector(d,e).rotate(g,f)},d.prototype.getGlobalScale=function(){if(!this.parent)return new a.Vector(this.scale.x,this.scale.y);var b=this.parent.getGlobalScale();return new a.Vector(this.scale.x*b.x,this.scale.y*b.y)},d.prototype.getBounds=function(){var b=this._getCalculatedAnchor(),c=this.getWorldPos();return new a.BoundingBox(c.x-b.x,c.y-b.y,c.x+this.getWidth()-b.x,c.y+this.getHeight()-b.y).rotate(this.rotation,c)},d.prototype.getRelativeBounds=function(){var b=this._getCalculatedAnchor();return new a.BoundingBox(-b.x,-b.y,this.getWidth()-b.x,this.getHeight()-b.y).rotate(this.rotation)},d.prototype.contains=function(b,c,d){void 0===d&&(d=!1);var e=this.getBounds().contains(new a.Vector(b,c));return d?e||this.children.some(function(a){return a.contains(b,c,!0)}):e},d.prototype.getSideFromIntersect=function(b){return b?Math.abs(b.x)>Math.abs(b.y)?b.x<0?a.Side.Right:a.Side.Left:b.y<0?a.Side.Bottom:a.Side.Top:a.Side.None},d.prototype.collidesWithSide=function(b){var c=this.collides(b);return c?Math.abs(c.x)>Math.abs(c.y)?this.pos.x<b.pos.x?a.Side.Right:a.Side.Left:this.pos.y<b.pos.y?a.Side.Bottom:a.Side.Top:a.Side.None},d.prototype.collides=function(a){var b=this.getBounds(),c=a.getBounds(),d=b.collides(c);return d},d.prototype.onCollidesWith=function(a,b){this._collisionHandlers[a]||(this._collisionHandlers[a]=[]),this._collisionHandlers[a].push(b)},d.prototype.getCollisionHandlers=function(){return this._collisionHandlers},d.prototype.removeCollidesWith=function(a){this._collisionHandlers[a]=[]},d.prototype.within=function(a,b){return Math.sqrt(Math.pow(this.pos.x-a.pos.x,2)+Math.pow(this.pos.y-a.pos.y,2))<=b},d.prototype._getCalculatedAnchor=function(){return new a.Vector(this.getWidth()*this.anchor.x,this.getHeight()*this.anchor.y)},d.prototype._reapplyEffects=function(a){a.removeEffect(this._opacityFx),a.addEffect(this._opacityFx)},d.prototype.integrate=function(b){var c=b/1e3,d=this.acc.clone();this.collisionType!==a.CollisionType.Active||this instanceof a.UIActor||this instanceof a.Trigger||this instanceof a.Label||d.addEqual(a.Physics.acc),this.vel.addEqual(d.scale(c)),this.pos.addEqual(this.vel.scale(c)).addEqual(d.scale(.5*c*c)),this.rx+=this.torque*(1/this.moi)*c,this.rotation+=this.rx*c,this.scale.x+=this.sx*b/1e3,this.scale.y+=this.sy*b/1e3,this.body.update()},d.prototype.update=function(b,c){this._initialize(b),this.emit("preupdate",new a.PreUpdateEvent(b,c,this)),this.actionQueue.update(c),this.color&&(this.color.a=this.opacity),this.previousOpacity!==this.opacity&&(this.previousOpacity=this.opacity,this._opacityFx.opacity=this.opacity,this._effectsDirty=!0),this.oldVel.setTo(this.vel.x,this.vel.y),this.oldPos.setTo(this.pos.x,this.pos.y),this.integrate(c);for(var d=0,e=this.traits;d<e.length;d++){var f=e[d];f.update(this,b,c)}for(var g=0;g<this.children.length;g++)this.children[g]instanceof a.UIActor?b.stats.currFrame.actors.ui++:b.stats.currFrame.actors.alive++,this.children[g].update(b,c);this.eventDispatcher.emit("update",new a.PostUpdateEvent(b,c,this)),this.emit("postupdate",new a.PostUpdateEvent(b,c,this))},d.prototype.draw=function(b,c){if(b.save(),b.translate(this.pos.x,this.pos.y),b.scale(this.scale.x,this.scale.y),b.rotate(this.rotation),b.save(),b.translate(-(this._width*this.anchor.x),-(this._height*this.anchor.y)),this.emit("predraw",new a.PreDrawEvent(b,c,this)),this.currentDrawing){var d=this.currentDrawing,e=(this._width-d.naturalWidth*d.scale.x)*this.anchor.x,f=(this._height-d.naturalHeight*d.scale.y)*this.anchor.y;this._effectsDirty&&(this._reapplyEffects(this.currentDrawing),this._effectsDirty=!1),this.currentDrawing.draw(b,e,f)}else this.color&&(b.fillStyle=this.color.toString(),b.fillRect(0,0,this._width,this._height));b.restore();for(var g=0;g<this.children.length;g++)this.children[g].visible&&this.children[g].draw(b,c);this.emit("postdraw",new a.PostDrawEvent(b,c,this)),b.restore()},d.prototype.debugDraw=function(b){this.emit("predebugdraw",new a.PreDebugDrawEvent(b,this)),this.body.debugDraw(b);var c=this.getBounds();c.debugDraw(b),b.fillText("id: "+this.id,c.left+3,c.top+10),b.fillStyle=a.Color.Yellow.toString(),b.beginPath(),b.arc(this.getWorldPos().x,this.getWorldPos().y,3,0,2*Math.PI),b.closePath(),b.fill();for(var d=0;d<this.traits.length;d++)this.traits[d]instanceof a.Traits.OffscreenCulling&&this.traits[d].cullingBox.debugDraw(b);b.strokeStyle=a.Color.Yellow.toString(),b.beginPath();var e=Math.min(this.getWidth(),this.getHeight());b.arc(this.getWorldPos().x,this.getWorldPos().y,e,0,2*Math.PI),b.closePath(),b.stroke();var f={"0 Pi":0,"Pi/2":Math.PI/2,Pi:Math.PI,"3/2 Pi":3*Math.PI/2},g=b.font;for(var h in f)b.fillStyle=a.Color.Yellow.toString(),b.font="14px",b.textAlign="center",b.fillText(h,this.getWorldPos().x+Math.cos(f[h])*(e+10),this.getWorldPos().y+Math.sin(f[h])*(e+10));b.font=g;for(var i=0;i<this.children.length;i++)this.children[i].debugDraw(b);this.emit("postdebugdraw",new a.PostDebugDrawEvent(b,this))},d}(a.Class);b.maxId=0,a.Actor=b;var c;!function(a){a[a.PreventCollision=0]="PreventCollision",a[a.Passive=1]="Passive",a[a.Active=2]="Active",a[a.Elastic=3]="Elastic",a[a.Fixed=4]="Fixed"}(c=a.CollisionType||(a.CollisionType={}))}(ex||(ex={}));var ex;!function(a){var b;!function(a){a[a.Debug=0]="Debug",a[a.Info=1]="Info",a[a.Warn=2]="Warn",a[a.Error=3]="Error",a[a.Fatal=4]="Fatal"}(b=a.LogLevel||(a.LogLevel={}));var c=function(){function a(){if(this._appenders=[],this.defaultLevel=b.Info,a._instance)throw new Error("Logger is a singleton");return a._instance=this,a._instance.addAppender(new d),a._instance}return a.getInstance=function(){return null==a._instance&&(a._instance=new a),a._instance},a.prototype.addAppender=function(a){this._appenders.push(a)},a.prototype.clearAppenders=function(){this._appenders.length=0},a.prototype._log=function(a,b){null==a&&(a=this.defaultLevel);var c=0,d=this._appenders.length;for(c;c<d;c++)a>=this.defaultLevel&&this._appenders[c].log(a,b)},a.prototype.debug=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];this._log(b.Debug,a)},a.prototype.info=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];this._log(b.Info,a)},a.prototype.warn=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];this._log(b.Warn,a)},a.prototype.error=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];this._log(b.Error,a)},a.prototype.fatal=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];this._log(b.Fatal,a)},a}();c._instance=null,a.Logger=c;var d=function(){function a(){}return a.prototype.log=function(a,c){if(console||console.log||!console.warn||!console.error){var d=[];d.unshift.apply(d,c),d.unshift("["+b[a]+"] : "),a<b.Warn?console.log.apply?console.log.apply(console,d):console.log(d.join(" ")):a<b.Error?console.warn.apply?console.warn.apply(console,d):console.warn(d.join(" ")):console.error.apply?console.error.apply(console,d):console.error(d.join(" "))}},a}();a.ConsoleAppender=d;var e=function(){function a(a,b){this._messages=[],this._canvas=document.createElement("canvas"),this._canvas.width=a||window.innerWidth,this._canvas.height=b||window.innerHeight,this._canvas.style.position="absolute",this._ctx=this._canvas.getContext("2d"),document.body.appendChild(this._canvas)}return a.prototype.log=function(a,c){var d=c.join(",");this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._messages.unshift("["+b[a]+"] : "+d);for(var e=10,f=1,g=0;g<this._messages.length;g++)this._ctx.fillStyle="rgba(255,255,255,"+f.toFixed(2)+")",this._ctx.fillText(this._messages[g],200,e),e+=10,f=f>0?f-.05:0},a}();a.ScreenAppender=e}(ex||(ex={}));var ex;!function(a){var b=function(){function a(){}return a}();a.GameEvent=b;var c=function(a){function b(b){var c=a.call(this)||this;return c.target=b,c}return __extends(b,a),b}(b);a.KillEvent=c;var d=function(a){function b(b){var c=a.call(this)||this;return c.target=b,c}return __extends(b,a),b}(b);a.GameStartEvent=d;var e=function(a){function b(b){var c=a.call(this)||this;return c.target=b,c}return __extends(b,a),b}(b);a.GameStopEvent=e;var f=function(a){function b(b,c,d){var e=a.call(this)||this;return e.ctx=b,e.delta=c,e.target=d,e}return __extends(b,a),b}(b);a.PreDrawEvent=f;var g=function(a){function b(b,c,d){var e=a.call(this)||this;return e.ctx=b,e.delta=c,e.target=d,e}return __extends(b,a),b}(b);a.PostDrawEvent=g;var h=function(a){function b(b,c){var d=a.call(this)||this;return d.ctx=b,d.target=c,d}return __extends(b,a),b}(b);a.PreDebugDrawEvent=h;var i=function(a){function b(b,c){var d=a.call(this)||this;return d.ctx=b,d.target=c,d}return __extends(b,a),b}(b);a.PostDebugDrawEvent=i;var j=function(a){function b(b,c,d){var e=a.call(this)||this;return e.engine=b,e.delta=c,e.target=d,e}return __extends(b,a),b}(b);a.PreUpdateEvent=j;var k=function(a){function b(b,c,d){var e=a.call(this)||this;return e.engine=b,e.delta=c,e.target=d,e}return __extends(b,a),b}(b);a.PostUpdateEvent=k;var l=function(a){function b(b,c,d){var e=a.call(this)||this;return e.engine=b,e.prevStats=c,e.target=d,e}return __extends(b,a),b}(b);a.PreFrameEvent=l;var m=function(a){function b(b,c,d){var e=a.call(this)||this;return e.engine=b,e.stats=c,e.target=d,e}return __extends(b,a),b}(b);a.PostFrameEvent=m;var n=function(a){function b(b,c){var d=a.call(this)||this;return d.index=b,d.gamepad=c,d}return __extends(b,a),b}(b);a.GamepadConnectEvent=n;var o=function(a){function b(b){var c=a.call(this)||this;return c.index=b,c}return __extends(b,a),b}(b);a.GamepadDisconnectEvent=o;var p=function(a){function b(b,c){var d=a.call(this)||this;return d.button=b,d.value=c,d}return __extends(b,a),b}(a.GameEvent);a.GamepadButtonEvent=p;var q=function(a){function b(b,c){var d=a.call(this)||this;return d.axis=b,d.value=c,d}return __extends(b,a),b}(a.GameEvent);a.GamepadAxisEvent=q;var r=function(a){function b(b,c){var d=a.call(this)||this;return d.topic=b,d.handler=c,d}return __extends(b,a),b}(b);a.SubscribeEvent=r;var s=function(a){function b(b,c){var d=a.call(this)||this;return d.topic=b,d.handler=c,d}return __extends(b,a),b}(b);a.UnsubscribeEvent=s;var t=function(a){function b(){return a.call(this)||this}return __extends(b,a),b}(b);a.VisibleEvent=t;var u=function(a){function b(){return a.call(this)||this}return __extends(b,a),b}(b);a.HiddenEvent=u;var v=function(a){function b(b,c,d,e){var f=a.call(this)||this;return f.actor=b,f.other=c,f.side=d,f.intersection=e,f}return __extends(b,a),b}(b);a.CollisionEvent=v;var w=function(a){function b(b){var c=a.call(this)||this;return c.engine=b,c}return __extends(b,a),b}(b);a.InitializeEvent=w;var x=function(a){function b(b){var c=a.call(this)||this;return c.oldScene=b,c}return __extends(b,a),b}(b);a.ActivateEvent=x;var y=function(a){function b(b){var c=a.call(this)||this;return c.newScene=b,c}return __extends(b,a),b}(b);a.DeactivateEvent=y;var z=function(a){function b(){return a.call(this)||this}return __extends(b,a),b}(b);a.ExitViewPortEvent=z;var A=function(a){function b(){return a.call(this)||this}return __extends(b,a),b}(b);a.EnterViewPortEvent=A}(ex||(ex={}));var ex;!function(a){var b=function(){function b(b){this._handlers={},this._wiredEventDispatchers=[],this._log=a.Logger.getInstance(),this._target=b}return b.prototype.emit=function(b,c){if(b){b=b.toLowerCase();var d=this._target;c||(c=new a.GameEvent),c.target=d;var e,f;if(this._handlers[b])for(e=0,f=this._handlers[b].length,e;e<f;e++)this._handlers[b][e].call(d,c);for(e=0,f=this._wiredEventDispatchers.length,e;e<f;e++)this._wiredEventDispatchers[e].emit(b,c)}},b.prototype.on=function(b,c){b=b.toLowerCase(),this._handlers[b]||(this._handlers[b]=[]),this._handlers[b].push(c),"unsubscribe"!==b&&"subscribe"!==b&&this.emit("subscribe",new a.SubscribeEvent(b,c))},b.prototype.off=function(b,c){b=b.toLowerCase();var d=this._handlers[b];if(d)if(c){var e=d.indexOf(c);this._handlers[b].splice(e,1)}else this._handlers[b].length=0;"unsubscribe"!==b&&"subscribe"!==b&&this.emit("unsubscribe",new a.UnsubscribeEvent(b,c))},b.prototype.wire=function(a){a._wiredEventDispatchers.push(this)},b.prototype.unwire=function(a){var b=a._wiredEventDispatchers.indexOf(this);b>-1&&a._wiredEventDispatchers.splice(b,1)},b}();a.EventDispatcher=b}(ex||(ex={}));var ex;!function(a){var b=function(){function a(a,b,c,d){this.r=a,this.g=b,this.b=c,this.a=null!=d?d:1}return a.fromRGB=function(b,c,d,e){return new a(b,c,d,e)},a.fromHex=function(b){var c=/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,d=null;if(d=b.match(c)){var e=parseInt(d[1],16),f=parseInt(d[2],16),g=parseInt(d[3],16),h=1;return d[4]&&(h=parseInt(d[4],16)/255),new a(e,f,g,h)}throw new Error("Invalid hex string: "+b)},a.fromHSL=function(a,b,d,e){void 0===e&&(e=1);var f=new c(a,b,d,e);return f.toRGBA()},a.prototype.lighten=function(a){void 0===a&&(a=.1);var b=c.fromRGBA(this.r,this.g,this.b,this.a);return b.l+=b.l*a,b.toRGBA()},a.prototype.darken=function(a){void 0===a&&(a=.1);var b=c.fromRGBA(this.r,this.g,this.b,this.a);return b.l-=b.l*a,b.toRGBA()},a.prototype.saturate=function(a){void 0===a&&(a=.1);var b=c.fromRGBA(this.r,this.g,this.b,this.a);return b.s+=b.s*a,b.toRGBA()},a.prototype.desaturate=function(a){void 0===a&&(a=.1);var b=c.fromRGBA(this.r,this.g,this.b,this.a);return b.s-=b.s*a,b.toRGBA()},a.prototype.mulitiply=function(b){var c=b.r/255*this.r/255*255,d=b.g/255*this.g/255*255,e=b.b/255*this.b/255*255,f=b.a*this.a;return new a(c,d,e,f)},a.prototype.screen=function(a){var b=a.invert(),c=a.invert();return b.mulitiply(c).invert()},a.prototype.invert=function(){return new a(255-this.r,255-this.g,255-this.b,1-this.a)},a.prototype.average=function(b){var c=(b.r+this.r)/2,d=(b.g+this.g)/2,e=(b.b+this.b)/2,f=(b.a+this.a)/2;return new a(c,d,e,f)},a.prototype.toString=function(){var a=String(this.r.toFixed(0))+", "+String(this.g.toFixed(0))+", "+String(this.b.toFixed(0));return void 0!==this.a||null!==this.a?"rgba("+a+", "+String(this.a)+")":"rgb("+a+")"},a.prototype.fillStyle=function(){return this.toString();
},a.prototype.clone=function(){return new a(this.r,this.g,this.b,this.a)},a}();b.Black=b.fromHex("#000000"),b.White=b.fromHex("#FFFFFF"),b.Gray=b.fromHex("#808080"),b.LightGray=b.fromHex("#D3D3D3"),b.DarkGray=b.fromHex("#A9A9A9"),b.Yellow=b.fromHex("#FFFF00"),b.Orange=b.fromHex("#FFA500"),b.Red=b.fromHex("#FF0000"),b.Vermillion=b.fromHex("#FF5B31"),b.Rose=b.fromHex("#FF007F"),b.Magenta=b.fromHex("#FF00FF"),b.Violet=b.fromHex("#7F00FF"),b.Blue=b.fromHex("#0000FF"),b.Azure=b.fromHex("#007FFF"),b.Cyan=b.fromHex("#00FFFF"),b.Viridian=b.fromHex("#59978F"),b.Green=b.fromHex("#00FF00"),b.Chartreuse=b.fromHex("#7FFF00"),b.Transparent=b.fromHex("#FFFFFF00"),a.Color=b;var c=function(){function a(a,b,c,d){this.h=a,this.s=b,this.l=c,this.a=d}return a.hue2rgb=function(a,b,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?a+6*(b-a)*c:c<.5?b:c<2/3?a+(b-a)*(2/3-c)*6:a},a.fromRGBA=function(b,c,d,e){b/=255,c/=255,d/=255;var f,g,h=Math.max(b,c,d),i=Math.min(b,c,d),j=(h+i)/2;if(h===i)f=g=0;else{var k=h-i;switch(g=j>.5?k/(2-h-i):k/(h+i),h){case b:f=(c-d)/k+(c<d?6:0);break;case c:f=(d-b)/k+2;break;case d:f=(b-c)/k+4}f/=6}return new a(f,g,j,e)},a.prototype.toRGBA=function(){var c,d,e;if(0===this.s)c=d=e=this.l;else{var f=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,g=2*this.l-f;c=a.hue2rgb(g,f,this.h+1/3),d=a.hue2rgb(g,f,this.h),e=a.hue2rgb(g,f,this.h-1/3)}return new b(255*c,255*d,255*e,this.a)},a}()}(ex||(ex={}));var ex;!function(a){var b=function(){function b(b){this.lineWidth=5,this.filled=!1,this._points=[],this.anchor=new a.Vector(0,0),this.rotation=0,this.scale=new a.Vector(1,1),this._points=b;var c=this._points.reduce(function(a,b){return Math.min(a,b.x)},0),d=this._points.reduce(function(a,b){return Math.max(a,b.x)},0);this.width=d-c;var e=this._points.reduce(function(a,b){return Math.min(a,b.y)},0),f=this._points.reduce(function(a,b){return Math.max(a,b.y)},0);this.height=f-e,this.naturalHeight=this.height,this.naturalWidth=this.width}return b.prototype.addEffect=function(a){},b.prototype.removeEffect=function(a){},b.prototype.clearEffects=function(){},b.prototype.reset=function(){},b.prototype.draw=function(a,b,c){a.save(),a.translate(b+this.anchor.x,c+this.anchor.y),a.scale(this.scale.x,this.scale.y),a.rotate(this.rotation),a.beginPath(),a.lineWidth=this.lineWidth;var d=this._points[0];a.moveTo(d.x,d.y);var e=0,f=this._points.length;for(e;e<f;e++)a.lineTo(this._points[e].x,this._points[e].y);a.lineTo(d.x,d.y),a.closePath(),this.filled&&(a.fillStyle=this.fillColor.toString(),a.fill()),a.strokeStyle=this.lineColor.toString(),this.flipHorizontal&&(a.translate(this.width,0),a.scale(-1,1)),this.flipVertical&&(a.translate(0,this.height),a.scale(1,-1)),a.stroke(),a.restore()},b}();a.Polygon=b}(ex||(ex={}));var ex;!function(a){var b=function(b){function c(c,d,e){void 0===e&&(e=!0);var f=b.call(this)||this;return f.path=c,f.responseType=d,f.bustCache=e,f.data=null,f.logger=a.Logger.getInstance(),f.onprogress=function(){},f.oncomplete=function(){},f.onerror=function(){},f}return __extends(c,b),c.prototype.isLoaded=function(){return null!==this.data},c.prototype.wireEngine=function(a){this._engine=a},c.prototype._cacheBust=function(a){var b=/\?\w*=\w*/;return a+=b.test(a)?"&__="+Date.now():"?__="+Date.now()},c.prototype._start=function(a){this.logger.debug("Started loading resource "+this.path)},c.prototype.load=function(){var b=this,c=new a.Promise;if(null!==this.data)return this.logger.debug("Already have data for resource",this.path),c.resolve(this.data),this.oncomplete(),c;var d=new XMLHttpRequest;return d.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),d.responseType=this.responseType,d.onloadstart=function(a){b._start(a)},d.onprogress=this.onprogress,d.onerror=this.onerror,d.onload=function(a){return 200!==d.status?(b.logger.error("Failed to load resource ",b.path," server responded with error code",d.status),b.onerror(d.response),void c.resolve(d.response)):(b.data=b.processData(d.response),b.oncomplete(),b.logger.debug("Completed loading resource",b.path),void c.resolve(b.data))},d.send(),c},c.prototype.getData=function(){return this.data},c.prototype.setData=function(a){this.data=this.processData(a)},c.prototype.processData=function(a){return URL.createObjectURL(a)},c}(a.Class);a.Resource=b}(ex||(ex={}));var ex;!function(a){var b;!function(a){a[a.Resolved=0]="Resolved",a[a.Rejected=1]="Rejected",a[a.Pending=2]="Pending"}(b=a.PromiseState||(a.PromiseState={}));var c=function(){function c(){this._state=b.Pending,this._successCallbacks=[],this._rejectCallback=function(){},this._logger=a.Logger.getInstance()}return c.wrap=function(a){return c.resolve(a)},c.resolve=function(a){var b=(new c).resolve(a);return b},c.reject=function(a){var b=(new c).reject(a);return b},c.join=function(){var a=[];if(arguments.length>0&&!Array.isArray(arguments[0]))for(var b=0;b<arguments.length;b++)a[b-0]=arguments[b];else 1===arguments.length&&Array.isArray(arguments[0])&&(a=arguments[0]);var d=new c;if(!a||!a.length)return d.resolve();var e=a.length,f=0,g=0,h=[];return a.forEach(function(a){a.then(function(){f+=1,f===e?d.resolve():f+g+h.length===e&&d.reject(h)},function(){g+=1,f+g+h.length===e&&d.reject(h)}).error(function(a){h.push(a),h.length+f+g===e&&d.reject(h)})}),d},c.prototype.then=function(a,c){if(a&&(this._successCallbacks.push(a),this.state()===b.Resolved))try{a.call(this,this._value)}catch(a){this._handleError(a)}if(c&&(this._rejectCallback=c,this.state()===b.Rejected))try{c.call(this,this._value)}catch(a){this._handleError(a)}return this},c.prototype.error=function(a){return a&&(this._errorCallback=a),this},c.prototype.resolve=function(a){var c=this;if(this._state!==b.Pending)throw new Error("Cannot resolve a promise that is not in a pending state!");this._value=a;try{this._state=b.Resolved,this._successCallbacks.forEach(function(a){a.call(c,c._value)})}catch(a){this._handleError(a)}return this},c.prototype.reject=function(a){if(this._state!==b.Pending)throw new Error("Cannot reject a promise that is not in a pending state!");this._value=a;try{this._state=b.Rejected,this._rejectCallback.call(this,this._value)}catch(a){this._handleError(a)}return this},c.prototype.state=function(){return this._state},c.prototype._handleError=function(a){if(!this._errorCallback)throw a;this._errorCallback.call(this,a)},c}();__decorate([a.obsolete({alternateMethod:"ex.Promise.resolve/reject"})],c,"wrap",null),a.Promise=c}(ex||(ex={}));var ex;!function(a){var b=function(b){function c(c,d){void 0===d&&(d=!0);var e=b.call(this,c,"blob",d)||this;return e.path=c,e.bustCache=d,e.loaded=new a.Promise,e._isLoaded=!1,e._sprite=null,e._sprite=new a.Sprite(e,0,0,0,0),e}return __extends(c,b),c.prototype.isLoaded=function(){return this._isLoaded},c.prototype.load=function(){var c=this,d=new a.Promise,e=b.prototype.load.call(this);return e.then(function(){c.image=new Image,c.image.addEventListener("load",function(){c._isLoaded=!0,c.width=c._sprite.swidth=c._sprite.naturalWidth=c._sprite.width=c.image.naturalWidth,c.height=c._sprite.sheight=c._sprite.naturalHeight=c._sprite.height=c.image.naturalHeight,c.loaded.resolve(c.image),d.resolve(c.image)}),c.image.src=b.prototype.getData.call(c)},function(){d.reject("Error loading texture.")}),d},c.prototype.asSprite=function(){return this._sprite},c}(a.Resource);a.Texture=b}(ex||(ex={}));var ex;!function(a){function b(){return window.AudioContext?new e:new d}if(window.AudioContext)var c=new window.AudioContext;var d=function(){function b(){this.responseType="blob"}return b.prototype.processData=function(b){var c=URL.createObjectURL(b);return a.Promise.resolve(c)},b.prototype.createInstance=function(a){return new g(a)},b}();a.AudioTag=d;var e=function(){function b(){this._logger=a.Logger.getInstance(),this.responseType="arraybuffer"}return b.prototype.processData=function(b){var d=this,e=new a.Promise;return c.decodeAudioData(b,function(a){e.resolve(a)},function(){d._logger.error("Unable to decode  this browser may not fully support this format, or the file may be corrupt, if this is an mp3 try removing id3 tags and album art from the file."),e.resolve(void 0)}),e},b.prototype.createInstance=function(a){return new h(a)},b.unlock=function(){if(!this._unlocked&&c){var a=c.createBuffer(1,1,22050),b=c.createBufferSource(),d=!1;b.buffer=a,b.connect(c.destination),b.onended=function(){return d=!0},b.noteOn?b.noteOn(0):b.start(0),setTimeout(function(){if(b.playbackState){var a=b;a.playbackState!==a.PLAYING_STATE&&a.playbackState!==a.FINISHED_STATE||(this._unlocked=!0)}else(c.currentTime>0||d)&&(this._unlocked=!0)},0)}},b.isUnlocked=function(){return this._unlocked},b}();e._unlocked=!1,a.WebAudio=e,a.getAudioImplementation=b;var f=function(){function b(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];this._logger=a.Logger.getInstance(),this._data=null,this._tracks=[],this._isLoaded=!1,this._isPaused=!1,this._loop=!1,this._volume=1,this.onprogress=function(){},this.oncomplete=function(){},this.onerror=function(){},this._wasPlayingOnHidden=!1,this.path="";for(var e=0,f=c;e<f.length;e++){var g=f[e];if(b.canPlayFile(g)){this.path=g;break}}this.path||(this._logger.warn("This browser does not support any of the audio files specified:",c.join(", ")),this._logger.warn("Attempting to use",c[0]),this.path=c[0]),this.sound=a.getAudioImplementation()}return b.canPlayFile=function(b){try{var c=new Audio,d=/.*\.([A-Za-z0-9]+)$/,e=b.match(d)[1];return!!c.canPlayType("audio/"+e)}catch(b){return a.Logger.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",b),!1}},b.prototype.wireEngine=function(a){var b=this;a&&(this._engine=a,this._engine.on("hidden",function(){a.pauseAudioWhenHidden&&b.isPlaying()&&(b._wasPlayingOnHidden=!0,b.pause())}),this._engine.on("visible",function(){a.pauseAudioWhenHidden&&b._wasPlayingOnHidden&&(b.play(),b._wasPlayingOnHidden=!1)}))},b.prototype.instanceCount=function(){return this._tracks.length},b.prototype.setVolume=function(a){this._volume=a;for(var b=0,c=this._tracks;b<c.length;b++){var d=c[b];d.setVolume(a)}this._logger.debug("Set volume for all instances of sound",this.path,"to",a)},b.prototype.setLoop=function(a){this._loop=a;for(var b=0,c=this._tracks;b<c.length;b++){var d=c[b];d.setLoop(a)}this._logger.debug("Set loop for all instances of sound",this.path,"to",a)},b.prototype.isPlaying=function(){return this._tracks.some(function(a){return a.isPlaying()})},b.prototype.play=function(){var b=this;if(this._isLoaded){for(var c=[],d=0,e=this._tracks;d<e.length;d++){var f=e[d];c.push(f.play())}if(this._isPaused)return this._isPaused=!1,this._logger.debug("Resuming paused instances for sound",this.path,this._tracks),a.Promise.join(c);var g=this.sound.createInstance(this._data);return g.setLoop(this._loop),g.setVolume(this._volume),this._tracks.push(g),this._logger.debug("Playing new instance for sound",this.path),g.play().then(function(){return b._tracks.splice(b._tracks.indexOf(g),1),!0})}return a.Promise.resolve(!0)},b.prototype.pause=function(){for(var a=0,b=this._tracks;a<b.length;a++){var c=b[a];c.pause()}this._isPaused=!0,this._logger.debug("Paused all instances of sound",this.path)},b.prototype.stop=function(){this._isPaused=!1;for(var a=this._tracks.concat([]),b=0,c=a;b<c.length;b++){var d=c[b];d.stop()}this._logger.debug("Stopped all instances of sound",this.path)},b.prototype.isLoaded=function(){return this._isLoaded},b.prototype.load=function(){var b=this,c=new a.Promise;if(this.getData())return this._logger.debug("Already have data for audio resource",this.path),c.resolve(this.sound),this.oncomplete(),c;this._logger.debug("Started loading sound",this.path);try{this._fetchResource(function(a){return 200!==a.status?(b._logger.error("Failed to load audio resource ",b.path," server responded with error code",a.status),b.onerror(a.response),void c.resolve(null)):void b.setData(a.response).then(function(){b.oncomplete(),b._logger.debug("Completed loading sound",b.path),c.resolve(b.sound)},function(a){return c.resolve(a)})})}catch(a){this._logger.error("Error loading sound! If this is a cross origin error,                you must host your sound with your html and javascript."),this.onerror(a),c.resolve(a)}return c},b.prototype._fetchResource=function(a){var b=new XMLHttpRequest;b.open("GET",this.path,!0),b.responseType=this.sound.responseType,b.onprogress=this.onprogress,b.onerror=this.onerror,b.onload=function(c){return a(b)},b.send()},b.prototype.getData=function(){return this._data},b.prototype.setData=function(a){var b=this;return this.sound.processData(a).then(function(a){return b._isLoaded=!0,b._data=b.processData(a),a})},b.prototype.processData=function(a){return a},b}();a.Sound=f;var g=function(){function b(a){this._src=a,this._isPlaying=!1,this._isPaused=!1,this._loop=!1,this._volume=1,this._audioElement=new Audio(a)}return b.prototype.isPlaying=function(){return this._isPlaying},Object.defineProperty(b.prototype,"loop",{get:function(){return this._loop},enumerable:!0,configurable:!0}),b.prototype.setLoop=function(a){this._loop=a,this._audioElement.loop=a,this._wireUpOnEnded()},b.prototype.setVolume=function(b){this._volume=b,this._audioElement.volume=a.Util.clamp(b,0,1)},b.prototype.play=function(){return this._isPaused?this._resume():this._isPlaying||this._start(),this._playingPromise},b.prototype._start=function(){this._audioElement.load(),this._audioElement.loop=this._loop,this._audioElement.play(),this._isPlaying=!0,this._isPaused=!1,this._playingPromise=new a.Promise,this._wireUpOnEnded()},b.prototype._resume=function(){this._isPaused&&(this._audioElement.play(),this._isPaused=!1,this._isPlaying=!0,this._wireUpOnEnded())},b.prototype.pause=function(){this._isPlaying&&(this._audioElement.pause(),this._isPaused=!0,this._isPlaying=!1)},b.prototype.stop=function(){this._isPlaying&&(this._audioElement.pause(),this._audioElement.currentTime=0,this._handleOnEnded())},b.prototype._wireUpOnEnded=function(){var a=this;this._loop||(this._audioElement.onended=function(){return a._handleOnEnded()})},b.prototype._handleOnEnded=function(){this._isPlaying=!1,this._isPaused=!1,this._playingPromise.resolve(!0)},b}(),h=function(){function b(a){this._buffer=a,this._volumeNode=c.createGain(),this._isPlaying=!1,this._isPaused=!1,this._loop=!1,this._volume=1,this._currentOffset=0}return b.prototype.isPlaying=function(){return this._isPlaying},b.prototype.setVolume=function(b){this._volume=b,this._volumeNode.gain.value=a.Util.clamp(b,0,1)},b.prototype.setLoop=function(a){this._loop=a,this._bufferSource&&(this._bufferSource.loop=a,this._wireUpOnEnded())},b.prototype.play=function(){return this._isPaused?this._resume():this._isPlaying||this._start(),this._playingPromise},b.prototype._start=function(){this._volumeNode.connect(c.destination),this._createBufferSource(),this._bufferSource.start(0,0),this._startTime=(new Date).getTime(),this._currentOffset=0,this._isPlaying=!0,this._isPaused=!1,this._playingPromise=new a.Promise,this._wireUpOnEnded()},b.prototype._resume=function(){if(this._isPaused){this._bufferSource.onended=null,this._createBufferSource();var a=1/this._bufferSource.playbackRate.value*this._buffer.duration;this._bufferSource.start(0,this._currentOffset%a),this._isPaused=!1,this._isPlaying=!0,this._wireUpOnEnded()}},b.prototype._createBufferSource=function(){this._bufferSource=c.createBufferSource(),this._bufferSource.buffer=this._buffer,this._bufferSource.loop=this._loop,this._bufferSource.playbackRate.value=1,this._bufferSource.connect(this._volumeNode)},b.prototype.pause=function(){if(this._isPlaying){this._bufferSource.stop(0);var a=1/(this._bufferSource.playbackRate.value||1);this._currentOffset=((new Date).getTime()-this._startTime)*a/1e3,this._isPaused=!0,this._isPlaying=!1}},b.prototype.stop=function(){this._isPlaying&&(this._bufferSource.stop(0),this._bufferSource.onended||this._handleOnEnded(),this._currentOffset=0,this._isPlaying=!1,this._isPaused=!1)},b.prototype._wireUpOnEnded=function(){var a=this;this._loop||(this._bufferSource.onended=function(){return a._handleOnEnded()})},b.prototype._handleOnEnded=function(){this._isPaused||(this._isPlaying=!1,this._playingPromise.resolve(!0))},b}()}(ex||(ex={}));var ex;!function(a){var b=function(b){function c(c,d,e,f){var g=b.call(this,c,d,e,f)||this;return g.traits=[],g.traits.push(new a.Traits.EulerMovement),g.traits.push(new a.Traits.CapturePointer),g.anchor.setTo(0,0),g.collisionType=a.CollisionType.PreventCollision,g.enableCapturePointer=!0,g}return __extends(c,b),c.prototype.onInitialize=function(a){this._engine=a},c.prototype.contains=function(c,d,e){if(void 0===e&&(e=!0),e)return b.prototype.contains.call(this,c,d);var f=this._engine.worldToScreenCoordinates(new a.Vector(c,d));return b.prototype.contains.call(this,f.x,f.y)},c}(a.Actor);a.UIActor=b}(ex||(ex={}));var ex;!function(a){var b=function(b){function c(c,d,e,f,g,h){var i=b.call(this,c,d,e,f)||this;return i._action=function(){},i.repeats=1,i.target=null,i.repeats=h||i.repeats,i._action=g||i._action,i.collisionType=a.CollisionType.PreventCollision,i.eventDispatcher=new a.EventDispatcher(i),i.actionQueue=new a.Internal.Actions.ActionQueue(i),i}return __extends(c,b),c.prototype.update=function(b,c){if(this.actionQueue.update(c),this.pos.x+=this.vel.x*c/1e3,this.pos.y+=this.vel.y*c/1e3,this.rotation+=this.rx*c/1e3,this.scale.x+=this.sx*c/1e3,this.scale.y+=this.sy*c/1e3,this.target)this.collides(this.target)&&this._dispatchAction();else for(var d=0;d<b.currentScene.children.length;d++){var e=b.currentScene.children[d];e!==this&&e.collisionType!==a.CollisionType.PreventCollision&&this.collides(e)&&this._dispatchAction()}0===this.repeats&&this.kill()},c.prototype._dispatchAction=function(){this._action.call(this),this.repeats--},c.prototype.draw=function(a,b){},c.prototype.debugDraw=function(c){b.prototype.debugDraw.call(this,c),c.save(),c.translate(this.pos.x,this.pos.y);var d=this.getBounds(),e=this.getWorldPos();d.left=d.left-e.x,d.right=d.right-e.x,d.top=d.top-e.y,d.bottom=d.bottom-e.y,c.fillStyle=a.Color.Violet.toString(),c.strokeStyle=a.Color.Violet.toString(),c.fillText("Trigger",10,10),d.debugDraw(c),c.restore()},c}(a.Actor);a.Trigger=b}(ex||(ex={}));var ex;!function(a){var b;!function(a){a[a.Circle=0]="Circle",a[a.Rectangle=1]="Rectangle"}(b=a.EmitterType||(a.EmitterType={}));var c=function(){function b(b,c,d,e,f,g,h,i,j,k){this.position=new a.Vector(0,0),this.velocity=new a.Vector(0,0),this.acceleration=new a.Vector(0,0),this.particleRotationalVelocity=0,this.currentRotation=0,this.focus=null,this.focusAccel=0,this.opacity=1,this.beginColor=a.Color.White.clone(),this.endColor=a.Color.White.clone(),this.life=300,this.fadeFlag=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=a.Color.White.clone(),this.emitter=null,this.particleSize=5,this.particleSprite=null,this.sizeRate=0,this.elapsedMultiplier=0,this.emitter=b,this.life=c||this.life,this.opacity=d||this.opacity,this.endColor=f||this.endColor.clone(),this.beginColor=e||this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.position=g||this.position,this.velocity=h||this.velocity,this.acceleration=i||this.acceleration,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.opacity/this.life,this.startSize=j||0,this.endSize=k||0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.particleSize=this.startSize)}return b.prototype.kill=function(){this.emitter.removeParticle(this)},b.prototype.update=function(b){if(this.life=this.life-b,this.elapsedMultiplier=this.elapsedMultiplier+b,this.life<0&&this.kill(),this.fadeFlag&&(this.opacity=a.Util.clamp(this._aRate*this.life,1e-4,1)),this.startSize>0&&this.endSize>0&&(this.particleSize=a.Util.clamp(this.sizeRate*b+this.particleSize,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=a.Util.clamp(this._currentColor.r+this._rRate*b,0,255),this._currentColor.g=a.Util.clamp(this._currentColor.g+this._gRate*b,0,255),this._currentColor.b=a.Util.clamp(this._currentColor.b+this._bRate*b,0,255),this._currentColor.a=a.Util.clamp(this.opacity,1e-4,1),this.focus){var c=this.focus.sub(this.position).normalize().scale(this.focusAccel).scale(b/1e3);this.velocity=this.velocity.add(c)}else this.velocity=this.velocity.add(this.acceleration.scale(b/1e3));this.position=this.position.add(this.velocity.scale(b/1e3)),this.particleRotationalVelocity&&(this.currentRotation=(this.currentRotation+this.particleRotationalVelocity*b/1e3)%(2*Math.PI))},b.prototype.draw=function(b){return this.particleSprite?(this.particleSprite.rotation=this.currentRotation,this.particleSprite.scale.setTo(this.particleSize,this.particleSize),void this.particleSprite.draw(b,this.position.x,this.position.y)):(this._currentColor.a=a.Util.clamp(this.opacity,1e-4,1),b.fillStyle=this._currentColor.toString(),b.beginPath(),b.arc(this.position.x,this.position.y,this.particleSize,0,2*Math.PI),b.fill(),void b.closePath())},b}();a.Particle=c;var d=function(d){function e(c,e,f,g){var h=d.call(this,c,e,f,g,a.Color.White)||this;h._particlesToEmit=0,h.numParticles=0,h.isEmitting=!0,h.particles=null,h.deadParticles=null,h.minVel=0,h.maxVel=0,h.acceleration=new a.Vector(0,0),h.minAngle=0,h.maxAngle=0,h.emitRate=1,h.particleLife=2e3,h.opacity=1,h.fadeFlag=!1,h.focus=null,h.focusAccel=1,h.startSize=null,h.endSize=null,h.minSize=5,h.maxSize=5,h.beginColor=a.Color.White,h.endColor=a.Color.White,h.particleSprite=null,h.emitterType=b.Rectangle,h.radius=0,h.particleRotationalVelocity=0,h.randomRotation=!1,h.collisionType=a.CollisionType.PreventCollision,h.particles=new a.Util.Collection,h.deadParticles=new a.Util.Collection;for(var i=0;i<h.traits.length;i++)h.traits[i]instanceof a.Traits.OffscreenCulling&&h.traits.splice(i,1);return h}return __extends(e,d),e.prototype.removeParticle=function(a){this.deadParticles.push(a)},e.prototype.emitParticles=function(a){for(var b=0;b<a;b++)this.particles.push(this._createParticle())},e.prototype.clearParticles=function(){this.particles.clear()},e.prototype._createParticle=function(){var d=0,e=0,f=a.Util.randomInRange(this.minAngle,this.maxAngle),g=a.Util.randomInRange(this.minVel,this.maxVel),h=this.startSize||a.Util.randomInRange(this.minSize,this.maxSize),i=g*Math.cos(f),j=g*Math.sin(f);if(this.emitterType===b.Rectangle)d=a.Util.randomInRange(this.pos.x,this.pos.x+this.getWidth()),e=a.Util.randomInRange(this.pos.y,this.pos.y+this.getHeight());else if(this.emitterType===b.Circle){var k=a.Util.randomInRange(0,this.radius);d=k*Math.cos(f)+this.pos.x,e=k*Math.sin(f)+this.pos.y}var l=new c(this,this.particleLife,this.opacity,this.beginColor,this.endColor,new a.Vector(d,e),new a.Vector(i,j),this.acceleration,this.startSize,this.endSize);return l.fadeFlag=this.fadeFlag,l.particleSize=h,this.particleSprite&&(l.particleSprite=this.particleSprite),l.particleRotationalVelocity=this.particleRotationalVelocity,this.randomRotation&&(l.currentRotation=a.Util.randomInRange(0,2*Math.PI)),this.focus&&(l.focus=this.focus.add(new a.Vector(this.pos.x,this.pos.y)),l.focusAccel=this.focusAccel),l},e.prototype.update=function(a,b){var c=this;d.prototype.update.call(this,a,b),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(b/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit))),this.particles.forEach(function(a){return a.update(b)}),this.deadParticles.forEach(function(a){return c.particles.removeElement(a)}),this.deadParticles.clear()},e.prototype.draw=function(a,b){this.particles.forEach(function(b){return b.draw(a)})},e.prototype.debugDraw=function(b){d.prototype.debugDraw.call(this,b),b.fillStyle=a.Color.Black.toString(),b.fillText("Particles: "+this.particles.count(),this.pos.x,this.pos.y+20),this.focus&&(b.fillRect(this.focus.x+this.pos.x,this.focus.y+this.pos.y,3,3),a.Util.DrawUtil.line(b,a.Color.Yellow,this.focus.x+this.pos.x,this.focus.y+this.pos.y,d.prototype.getCenter.call(this).x,d.prototype.getCenter.call(this).y),b.fillText("Focus",this.focus.x+this.pos.x,this.focus.y+this.pos.y))},e}(a.Actor);a.ParticleEmitter=d}(ex||(ex={}));var ex;!function(a){var b=function(){function b(b,c,d,e){this.currentFrame=0,this._oldTime=Date.now(),this.anchor=new a.Vector(0,0),this.rotation=0,this.scale=new a.Vector(1,1),this.loop=!1,this.freezeFrame=-1,this.flipVertical=!1,this.flipHorizontal=!1,this.width=0,this.height=0,this.naturalWidth=0,this.naturalHeight=0,this.sprites=c,this.speed=d,this._engine=b,null!=e&&(this.loop=e),c&&c[0]&&(this.height=c[0]?c[0].height:0,this.width=c[0]?c[0].width:0,this.naturalWidth=c[0]?c[0].naturalWidth:0,this.naturalHeight=c[0]?c[0].naturalHeight:0,this.freezeFrame=c.length-1)}return b.prototype.opacity=function(b){this.addEffect(new a.Effects.Opacity(b))},b.prototype.grayscale=function(){this.addEffect(new a.Effects.Grayscale)},b.prototype.invert=function(){this.addEffect(new a.Effects.Invert)},b.prototype.fill=function(b){this.addEffect(new a.Effects.Fill(b))},b.prototype.colorize=function(b){this.addEffect(new a.Effects.Colorize(b))},b.prototype.lighten=function(b){void 0===b&&(b=.1),this.addEffect(new a.Effects.Lighten(b))},b.prototype.darken=function(b){void 0===b&&(b=.1),this.addEffect(new a.Effects.Darken(b))},b.prototype.saturate=function(b){void 0===b&&(b=.1),this.addEffect(new a.Effects.Saturate(b))},b.prototype.desaturate=function(b){void 0===b&&(b=.1),this.addEffect(new a.Effects.Desaturate(b))},b.prototype.addEffect=function(a){for(var b in this.sprites)this.sprites[b].addEffect(a)},b.prototype.removeEffect=function(a){for(var b in this.sprites)this.sprites[b].removeEffect(a)},b.prototype.clearEffects=function(){for(var a in this.sprites)this.sprites[a].clearEffects()},b.prototype._setAnchor=function(a){for(var b in this.sprites)this.sprites[b].anchor.setTo(a.x,a.y)},b.prototype._setRotation=function(a){for(var b in this.sprites)this.sprites[b].rotation=a},b.prototype._setScale=function(a){for(var b in this.sprites)this.sprites[b].scale=a},b.prototype.reset=function(){this.currentFrame=0},b.prototype.isDone=function(){return!this.loop&&this.currentFrame>=this.sprites.length},b.prototype.tick=function(){var a=Date.now();a-this._oldTime>this.speed&&(this.currentFrame=this.loop?(this.currentFrame+1)%this.sprites.length:this.currentFrame+1,this._oldTime=a)},b.prototype._updateValues=function(){this._setAnchor(this.anchor),this._setRotation(this.rotation),this._setScale(this.scale)},b.prototype.skip=function(a){this.currentFrame=(this.currentFrame+a)%this.sprites.length},b.prototype.draw=function(b,c,d){this.tick(),this._updateValues();var e;this.currentFrame<this.sprites.length&&(e=this.sprites[this.currentFrame],this.flipVertical&&(e.flipVertical=this.flipVertical),this.flipHorizontal&&(e.flipHorizontal=this.flipHorizontal),e.draw(b,c,d)),this.freezeFrame!==-1&&this.currentFrame>=this.sprites.length&&(e=this.sprites[a.Util.clamp(this.freezeFrame,0,this.sprites.length-1)],e.draw(b,c,d)),e&&(this.width=e.width,this.height=e.height)},b.prototype.play=function(a,b){this.reset(),this._engine.playAnimation(this,a,b)},b}();a.Animation=b}(ex||(ex={}));var ex;!function(a){var b;!function(b){var c;!function(b){function c(b,c,d,e,f,g,h,i){void 0===c&&(c=a.Color.Red.clone()),void 0===h&&(h=1),void 0===i&&(i="butt"),b.beginPath(),b.lineWidth=h,b.lineCap=i,b.strokeStyle=c.toString(),b.moveTo(d,e),b.lineTo(f,g),b.closePath(),b.stroke()}function d(b,c,d){void 0===c&&(c=a.Color.Red.clone()),b.beginPath(),b.strokeStyle=c.toString(),b.arc(d.x,d.y,5,0,2*Math.PI),b.closePath(),b.stroke()}function e(a,b,c,d,e){void 0===e&&(e=1);var f=b?b.toString():"blue",g=d.scale(e);a.beginPath(),a.strokeStyle=f,a.moveTo(c.x,c.y),a.lineTo(c.x+g.x,c.y+g.y),a.closePath(),a.stroke()}function f(b,c,d,e,f,g,h,i){void 0===g&&(g=5),void 0===h&&(h=a.Color.White),void 0===i&&(i=null);var j;if("number"==typeof g)j={tl:g,tr:g,br:g,bl:g};else{var k={tl:0,tr:0,br:0,bl:0};for(var l in k)j[l]=g[l]||k[l]}b.beginPath(),b.moveTo(c+j.tl,d),b.lineTo(c+e-j.tr,d),b.quadraticCurveTo(c+e,d,c+e,d+j.tr),b.lineTo(c+e,d+f-j.br),b.quadraticCurveTo(c+e,d+f,c+e-j.br,d+f),b.lineTo(c+j.bl,d+f),b.quadraticCurveTo(c,d+f,c,d+f-j.bl),b.lineTo(c,d+j.tl),b.quadraticCurveTo(c,d,c+j.tl,d),b.closePath(),i&&(b.fillStyle=i.toString(),b.fill()),h&&(b.strokeStyle=h.toString(),b.stroke())}function g(b,c,d,e,f,g){void 0===f&&(f=a.Color.White),void 0===g&&(g=null),b.beginPath(),b.arc(c,d,e,0,2*Math.PI),b.closePath(),g&&(b.fillStyle=g.toString(),b.fill()),f&&(b.strokeStyle=f.toString(),b.stroke())}b.line=c,b.point=d,b.vector=e,b.roundRect=f,b.circle=g}(c=b.DrawUtil||(b.DrawUtil={}))}(b=a.Util||(a.Util={}))}(ex||(ex={}));var ex;!function(a){var b=function(b){function c(c){var d=b.call(this)||this;return d._resourceList=[],d._index=0,d._resourceCount=0,d._numLoaded=0,d._progressCounts={},d._totalCounts={},d.logo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdQAAAB2CAYAAABxhGI9AAAACXBIWXMAAAsSAAALEgHS3X78AAAKnUlEQVR42u3dP2wjSx0H8N8hJIonIRmJjsq0SBR+BQ1dcqKhe0lD77SvSwpKkJKGPulpktfRIMUdEqKIqV57rpAokM4dbSiyq7ONPTP7x39ifz7SFbnEnp3xer47O7uzH15fXwMA6OYHmgAABCoACFQAEKgAgEAFAIEKAAIVAAQqACBQAUCgAoBABQCBCgAIVAAQqAAgUAFAoAIAAhUABCoACFQAEKgAgECFLbmOiNeFf2PbAyz68Pr6qhUgbRwR92v+/zwiJrYHMEKFMmcN///UtgcQqFBk1PD/97U9Qx8VCFSgu4EmAIEKAAIVAAQqACBQ4Z25jojP8eX+0WtNAgIVaOY+Im5j+eKh24h41jQgUIEyZ7F5NaPU7wCBCiwYd/w9cOB+qAlgJ3KLLow0EV198803RWvJfvfddx+0lhEqHKu5JgAjVCBvlhmFzjQRXUekHz9+TP79y8uLRjNChXfvoePvAYEKxNtj1e42/O5JoIJABcrdRMRVLM+X3kTEpaaB988cKuzWg9EobTWdMx0Oly8uN4dqhAoARqgnaN3arHfqu7OyH8ItKLVB/P+CEfMTHyGPY3npx1m8zWGDEeoBfUk/xdti57dr/r1Wv2+6EPow3tZ5rRdS72s1neuF97xvWd+XTH0/V+UMttDWqbI/r2nrxfp+jv2uSjSO7S+OXy/A/3lN+9xX5T5HxEUPZZ0tfB71+w57eJ/HFu+z+jkv1u92YX9fbI/HhX3JA9rp5MPr66tWaG9UfUGbrHIzi7cLUyYFf/tpTady03EEeL8mUJ6i7MKYNvWNqr4Pe2jradXO60LrvPAz2PQ5RPX684ah8dxD+2zantnCgVipSVV+m/tgB9W2DDq2Sx/vM95wcHhZhWVJm8yrv58cSgfTdc70+++/X/r522+/tUKSEepBqo+om4ZLPerMjUwuNnQCtx1GWJtee1FwdD5uWd86xLs8UaVt2aNEO1/saZ/Z5rYMW4zq6v34rGV9Bg3q2eZ9SkeNm9qwyUh30OPIHYFKx5FG03C7znSOqYBq+qW/zpQ3anH037TNHluG6f0WPsPhHvab4QFty7ogOeuxDYcNy2/zu2214WNYWxmBurNO8bGn97pNBOO8xy/9uCorZZ4I2r4C7aJgO7ZV9iE49Dm6NvOWx+pWE9CUq3zbdTp9doz38TbXtzqH9RT5CyWe422OaZoZGeZCabrhPQY9HjwsjpTvCg4YtlE2+Ta/j2bzn8fqrDqgm+6yUHOmAvWUjAtGhbNYvsBknDnqH1Qhc7VmxHgeb/NbudA5j/UXlYwif2p6luhAc9teu1npiHKnDs8if6tCm7JLX3NKpgttXe9ruc9mHMd7a83iwdxF5vt8tutARaCeklRnNK9C8WnNF7geJQ4T4XG3JhSnVdilQrG+yOnrlVHfsEGYzhNBn7Lu6tS7+HJafJQ4EMiNlNqWXZ9WPvVgnVYHG5M1ByDXkT6leX2EgTqJtyt45yv7S2qO3sEZjZhDLXeR+YKdJ0Zdk8QocvH9N732KrNtq+FZ/zzIHABcJrYpd+Xv14lOd5ap76SgrduW/VTQ1qcQpqnbgu4ifZvUMNpd9XuoZmvCtPaQ2Y/BCHVLgbrJTeRPDdVf6pfMKDU2fOkHmVFFfXr3MsouLsnNvV5kRoe5+s431PeuoKPqWnaurY/ZPBEeqwceN4l96iwO6H7Mjq4y7VGPVNe10VaZMzVCPVWpI/Z6FZbcv5fMqGCU+dLfFGzj58jP8+bCdJCo7yzKTwdOF0bu9Ug7V4c+yz7FJfYeGoysUss0HssIdVZwYLDujMqlESoCdTtGsZtbHnJBeNdDSJSs0jTKdMJN1HNX54Wv7bvsU9NkVJVa13dX+/wuArV0X/l5RHyo/lnfF4G6p6DrS0kHdtXhy35TGErDPYZUn2WfWqDOo/lVqdMD2O/hKJhD7S/odukymq9s02QN4EEPR/zbaOumZc+r15zK1Zqznl9jsfiemTM1QmV3HUuTkedlg9HIQzRbUD93dfC+2tpj2fIHEH2+RqCCQH13gZq7hWXTNpVu19OB1fc9nQ0AKOKUb5lU0P1kDyOneoWk0lOZ9cIP0x7qu8+2BhCoR2wYu1+e7DmaXzBSsu5vaX1ne2zrpmUPTmxf7PM1Dm4y/vC7ny7Nif7+z/9ZmtM0Z3panPLtPmra9f16bcK0Dpbnwk43Vd/RHtu6zfNQTy1QBy3aqG2g9nVmxml+BOoJyT3NpWmn9xhfFnu4bvDa+44BXhqqfdf3uUF9+yz77AT31Yue2mjecYQ62NLfgkA9ghHqLNEhNem4H1c6vdyDxhf/bpz5m4coW/c39wi6VH2bPtHlcaV9cvXts+zxCe6rTeqc2ndL7uGd93QwM9bFcAzMoZZ7SgTBbWx+asui61h/iq1+RmjqdbnQXQ3T1DNQ63V/U9ucqm/pMzPb1rePsk/1iTOjgvatR4W3Lc8ULB78pELyrnAfeTcj1NU509/86mfJ33/8+Mf00a05UyPUEw7UVCeWG/WNEiExyHRMt5ltW30izUPk18ytt7lNfc8i//DvtvXto+ySA5BjljsLUF8lPkqMPEtW1JomDsiGBZ9Byb4NAvUITSN9GuwsIj6t6UTOqk7jJREkmzqli8xIs96udSO20sX0H1vW92IL9e1a9rgqVyf91gbPsTy9UD9n9lOkT8k+RfkFR5PMNqxOcdSf32PBvg3vilO+zdxE+okx9Wm0ph36XYsRZCpMF993GOk5qvqB3Dct6jvssb67KvuUNJ3frw92bhr8/STSF0JdRPMLpUCgnsgo9S76PZ246ZFk1wWvK5m3vVoYvW1Sz7nN91jfXbQ1ZQc7TW6HeaoOalypG/8/p/rP1aNAc6ZHzSnfdqPUPhdy2PQw6Nz9gSVhuhiqueUHR3uu7y7K3rdDX4u46ZrPbUa0IFBZ0seKQ3XQTRt2vm3W/a2DbNKys++rvm3ep6+y1x2UdP3bWU9lzra47U1GmlctX/sQ23t+aOlByLTh/4NAPaCRxtcdO5HLSJ/6vNtCwGx67VPmPbvWd1q9frKHtp4kAqRJ2HR9j762JfX3bZ//elPtj13PPDx1+D5tqk/Xi6NO8SHz7MmH19dXrdBNfVFP6T2PT1UHNit87/t4m5+aRH+nQBdvqyhZDKJLfZs8h7XPsqdV2ZOV+tanKB8aln0dyxdAXbV4j4gvt4oMOrbP6vbU73NW7TMlbdTnPrWpfqXfh9HKZ9vke7KuTeZRNtXRSe6+1FV//ce/ln5eXfsXgcqXzr6+9261M3moOoa7E6nvTZTfy7iNsmfb7kjfgXGsvxe0vihsEts9HTquPpt1q1vtahu2TqAiUAEEKj0zhwoARqgAu/OnX/442WH+9xc/Wvr58re/Tr7f41/+ZsRqhAoACFQAEKgAcHjMoQJskJsz/eqrr5Z+vvr7v5fmQFevAl5lztQIFQAQqAAgUAHgIJlDBdhgdQ41N2eKESoAIFABQKACwFEwhwoARqgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAEKgAgUAFAoAKAQAUAgQoACFQAEKgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAQqAAgUAFAoAKAQAUAlvwPcFDns1DsH4sAAAAASUVORK5CYII=",
d.logoWidth=468,d.logoHeight=118,d.backgroundColor="#176BAA",d.getData=function(){},d.setData=function(a){},d.processData=function(a){},d.onprogress=function(b){a.Logger.getInstance().debug("[ex.Loader] Loading "+(100*b.loaded/b.total).toFixed(0))},d.oncomplete=function(){},d.onerror=function(){},c&&d.addResources(c),d}return __extends(c,b),Object.defineProperty(c.prototype,"_image",{get:function(){return this._imageElement||(this._imageElement=new Image,this._imageElement.src=this.logo),this._imageElement},enumerable:!0,configurable:!0}),c.prototype.wireEngine=function(a){this._engine=a},c.prototype.addResource=function(a){var b=this._index++;this._resourceList.push(a),this._progressCounts[b]=0,this._totalCounts[b]=1,this._resourceCount++},c.prototype.addResources=function(a){var b=0,c=a.length;for(b;b<c;b++)this.addResource(a[b])},c.prototype._sumCounts=function(a){var b=0;for(var c in a)b+=0|a[c];return b},c.prototype.isLoaded=function(){return this._numLoaded===this._resourceCount},c.prototype.load=function(){function b(a,c){a[c]&&a[c].load().then(function(){b(a,c+1)})}var c=this,d=new a.Promise,e=this;if(0===this._resourceList.length)return e.oncomplete.call(e),d.resolve();var f=new Array(this._resourceList.length),g=this._resourceList.length;return this._resourceList.forEach(function(a,b){c._engine&&a.wireEngine(c._engine),a.onprogress=function(a){var c=a.total,d=a.loaded;f[b]={loaded:d/c*(100/g),total:100};var h=f.reduce(function(a,b){return{loaded:a.loaded+b.loaded,total:100}},{loaded:0,total:100});e.onprogress.call(e,h)},a.oncomplete=a.onerror=function(){e._numLoaded++,e._numLoaded===e._resourceCount&&(e.oncomplete.call(e),d.resolve())}}),b(this._resourceList,0),d},c.prototype.draw=function(b,c){b.fillStyle=this.backgroundColor,b.fillRect(0,0,this._engine.width,this._engine.height);var d=this._engine.canvas.height/2,e=Math.min(this.logoWidth,.75*this._engine.canvas.width),f=this._engine.width/2-e/2,g=Math.floor(e*(this.logoHeight/this.logoWidth)),h=this._engine.getAntialiasing();this._engine.setAntialiasing(!0),b.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,f,d-g-20,e,g),b.lineWidth=2,a.Util.DrawUtil.roundRect(b,f,d,e,20,10);var i=e*(this._numLoaded/this._resourceCount),j=5,k=i-2*j,l=20-2*j;a.Util.DrawUtil.roundRect(b,f+j,d+j,k>0?k:0,l,5,null,a.Color.White),this._engine.setAntialiasing(h)},c.prototype.update=function(a,b){},c}(a.Class);a.Loader=b;var c=function(b){function c(c,d){var e=b.call(this,d)||this;return e._handleOnTrigger=function(){return e._waitPromise.state()===a.PromiseState.Pending&&(a.WebAudio.unlock(),e._waitPromise.resolve(e._loadedValue),e._playTrigger.style.display="none",!1)},e._playTrigger=document.getElementById(c),e._playTrigger.addEventListener("click",e._handleOnTrigger),e}return __extends(c,b),c.prototype.load=function(){var c=this;this._waitPromise=new a.Promise;b.prototype.load.call(this).then(function(a){c._loaded=!0,c._loadedValue=a,c._playTrigger.style.display="block"},function(a){c._waitPromise.reject(a)});return this._waitPromise},c}(b);a.PauseAfterLoader=c}(ex||(ex={}));var REPORTED_FEATURES={webgl:"WebGL",webaudio:"WebAudio",gamepadapi:"Gamepad API"},ex;!function(a){var b=function(){function b(){this._features=null,this.failedTests=[],this._criticalTests={canvasSupport:function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))},arrayBufferSupport:function(){var a=new XMLHttpRequest;a.open("GET","/");try{a.responseType="arraybuffer"}catch(a){return!1}return"arraybuffer"===a.responseType},dataUrlSupport:function(){var a=document.createElement("canvas");return 0===a.toDataURL("image/png").indexOf("data:image/png")},objectUrlSupport:function(){return"URL"in window&&"revokeObjectURL"in URL&&"createObjectURL"in URL},rgbaSupport:function(){var a=document.createElement("a").style;return a.cssText="background-color:rgba(150,255,150,.5)",(""+a.backgroundColor).indexOf("rgba")>-1}},this._warningTest={webAudioSupport:function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext)},webglSupport:function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("webgl"))}},this._features=this._loadBrowserFeatures()}return b.prototype.getBrowserFeatures=function(){return null===this._features&&(this._features=this._loadBrowserFeatures()),this._features},b.prototype.logBrowserFeatures=function(){for(var a="%cSUPPORTED BROWSER FEATURES\n==========================%c\n",b=["font-weight: bold; color: navy","font-weight: normal; color: inherit"],c=this.getBrowserFeatures(),d=0,e=Object.keys(REPORTED_FEATURES);d<e.length;d++){var f=e[d];c[f]?(a+="(%c%c)",b.push("font-weight: bold; color: green"),b.push("font-weight: normal; color: inherit")):(a+="(%c%c)",b.push("font-weight: bold; color: red"),b.push("font-weight: normal; color: inherit")),a+=" "+REPORTED_FEATURES[f]+"\n"}b.unshift(a),console.log.apply(console,b)},b.prototype._loadBrowserFeatures=function(){var a=this;return{canvas:function(){return a._criticalTests.canvasSupport()}(),arraybuffer:function(){return a._criticalTests.arrayBufferSupport()}(),dataurl:function(){return a._criticalTests.dataUrlSupport()}(),objecturl:function(){return a._criticalTests.objectUrlSupport()}(),rgba:function(){return a._criticalTests.rgbaSupport()}(),webaudio:function(){return a._warningTest.webAudioSupport()}(),webgl:function(){return a._warningTest.webglSupport()}(),gamepadapi:function(){return!!navigator.getGamepads}()}},b.prototype.test=function(){var b=!1;for(var c in this._criticalTests)this._criticalTests[c].call(this)||(this.failedTests.push(c),a.Logger.getInstance().error("Critical browser feature missing, Excalibur requires:",c),b=!0);if(b)return!1;for(var d in this._warningTest)this._warningTest[d]()||a.Logger.getInstance().warn("Warning browser feature missing, Excalibur will have reduced performance:",d);return!0},b}();a.Detector=b}(ex||(ex={}));var ex;!function(a){var b;!function(a){a[a.Em=0]="Em",a[a.Rem=1]="Rem",a[a.Px=2]="Px",a[a.Pt=3]="Pt",a[a.Percent=4]="Percent"}(b=a.FontUnit||(a.FontUnit={}));var c;!function(a){a[a.Left=0]="Left",a[a.Right=1]="Right",a[a.Center=2]="Center",a[a.Start=3]="Start",a[a.End=4]="End"}(c=a.TextAlign||(a.TextAlign={}));var d;!function(a){a[a.Top=0]="Top",a[a.Hanging=1]="Hanging",a[a.Middle=2]="Middle",a[a.Alphabetic=3]="Alphabetic",a[a.Ideographic=4]="Ideographic",a[a.Bottom=5]="Bottom"}(d=a.BaseAlign||(a.BaseAlign={}));var e=function(e){function f(f,g,h,i,j){var k=e.call(this,g,h)||this;return k.fontSize=10,k.fontUnit=b.Px,k.textAlign=c.Left,k.baseAlign=d.Bottom,k.letterSpacing=0,k.caseInsensitive=!0,k._textShadowOn=!1,k._shadowOffsetX=0,k._shadowOffsetY=0,k._shadowColor=a.Color.Black.clone(),k._shadowColorDirty=!1,k._textSprites={},k._shadowSprites={},k._color=a.Color.Black.clone(),k.text=f||"",k.color=a.Color.Black.clone(),k.spriteFont=j,k.collisionType=a.CollisionType.PreventCollision,k.fontFamily=i||"sans-serif",k}return __extends(f,e),f.prototype.getTextWidth=function(a){var b=a.font;a.font=this._fontString;var c=a.measureText(this.text).width;return a.font=b,c},f.prototype._lookupFontUnit=function(a){switch(a){case b.Em:return"em";case b.Rem:return"rem";case b.Pt:return"pt";case b.Px:return"px";case b.Percent:return"%";default:return"px"}},f.prototype._lookupTextAlign=function(a){switch(a){case c.Left:return"left";case c.Right:return"right";case c.Center:return"center";case c.End:return"end";case c.Start:return"start";default:return"start"}},f.prototype._lookupBaseAlign=function(a){switch(a){case d.Alphabetic:return"alphabetic";case d.Bottom:return"bottom";case d.Hanging:return"hangin";case d.Ideographic:return"ideographic";case d.Middle:return"middle";case d.Top:return"top";default:return"alphabetic"}},f.prototype.setTextShadow=function(a,b,c){this.spriteFont.setTextShadow(a,b,c)},f.prototype.useTextShadow=function(a){this.spriteFont.useTextShadow(a)},f.prototype.clearTextShadow=function(){this._textShadowOn=!1,this._shadowOffsetX=0,this._shadowOffsetY=0,this._shadowColor=a.Color.Black.clone()},f.prototype.update=function(a,b){e.prototype.update.call(this,a,b)},f.prototype.draw=function(a,b){a.save(),a.translate(this.pos.x,this.pos.y),a.scale(this.scale.x,this.scale.y),a.rotate(this.rotation),this._textShadowOn&&(a.save(),a.translate(this._shadowOffsetX,this._shadowOffsetY),this._fontDraw(a,b,this._shadowSprites),a.restore()),this._fontDraw(a,b,this._textSprites),e.prototype.draw.call(this,a,b),a.restore()},f.prototype._fontDraw=function(a,b,c){if(this.spriteFont)this.spriteFont.draw(a,this.text,0,0,{color:this.color.clone(),baseAlign:this.baseAlign,textAlign:this.textAlign,fontSize:this.fontSize,letterSpacing:this.letterSpacing,opacity:this.opacity});else{var d=a.textAlign,e=a.textBaseline;a.textAlign=this._lookupTextAlign(this.textAlign),a.textBaseline=this._lookupBaseAlign(this.baseAlign),this.color&&(this.color.a=this.opacity),a.fillStyle=this.color.toString(),a.font=this._fontString,this.maxWidth?a.fillText(this.text,0,0,this.maxWidth):a.fillText(this.text,0,0),a.textAlign=d,a.textBaseline=e}},Object.defineProperty(f.prototype,"_fontString",{get:function(){return""+this.fontSize+this._lookupFontUnit(this.fontUnit)+" "+this.fontFamily},enumerable:!0,configurable:!0}),f.prototype.debugDraw=function(a){e.prototype.debugDraw.call(this,a)},f}(a.Actor);a.Label=e}(ex||(ex={}));var ex;!function(a){var b;!function(b){var c;!function(a){a[a.Touch=0]="Touch",a[a.Mouse=1]="Mouse",a[a.Pen=2]="Pen",a[a.Unknown=3]="Unknown"}(c=b.PointerType||(b.PointerType={}));var d;!function(a){a[a.Left=0]="Left",a[a.Middle=1]="Middle",a[a.Right=2]="Right",a[a.Unknown=3]="Unknown"}(d=b.PointerButton||(b.PointerButton={}));var e;!function(a){a[a.Canvas=0]="Canvas",a[a.Document=1]="Document"}(e=b.PointerScope||(b.PointerScope={}));var f=function(a){function b(b,c,d,e,f,g){var h=a.call(this)||this;return h.x=b,h.y=c,h.index=d,h.pointerType=e,h.button=f,h.ev=g,h}return __extends(b,a),b}(a.GameEvent);b.PointerEvent=f;var g=function(b){function g(a){var c=b.call(this)||this;return c._pointerDown=[],c._pointerUp=[],c._pointerMove=[],c._pointerCancel=[],c._pointers=[],c._activePointers=[],c._engine=a,c._pointers.push(new h),c._activePointers=[-1],c.primary=c._pointers[0],c}return __extends(g,b),g.prototype.on=function(a,c){b.prototype.on.call(this,a,c)},g.prototype.init=function(a){void 0===a&&(a=e.Document);var b=document;b=a===e.Document?document:this._engine.canvas,b.addEventListener("touchstart",this._handleTouchEvent("down",this._pointerDown)),b.addEventListener("touchend",this._handleTouchEvent("up",this._pointerUp)),b.addEventListener("touchmove",this._handleTouchEvent("move",this._pointerMove)),b.addEventListener("touchcancel",this._handleTouchEvent("cancel",this._pointerCancel)),window.PointerEvent?(this._engine.canvas.style.touchAction="none",b.addEventListener("pointerdown",this._handlePointerEvent("down",this._pointerDown)),b.addEventListener("pointerup",this._handlePointerEvent("up",this._pointerUp)),b.addEventListener("pointermove",this._handlePointerEvent("move",this._pointerMove)),b.addEventListener("pointercancel",this._handlePointerEvent("cancel",this._pointerMove))):window.MSPointerEvent?(this._engine.canvas.style.msTouchAction="none",b.addEventListener("MSPointerDown",this._handlePointerEvent("down",this._pointerDown)),b.addEventListener("MSPointerUp",this._handlePointerEvent("up",this._pointerUp)),b.addEventListener("MSPointerMove",this._handlePointerEvent("move",this._pointerMove)),b.addEventListener("MSPointerCancel",this._handlePointerEvent("cancel",this._pointerMove))):(b.addEventListener("mousedown",this._handleMouseEvent("down",this._pointerDown)),b.addEventListener("mouseup",this._handleMouseEvent("up",this._pointerUp)),b.addEventListener("mousemove",this._handleMouseEvent("move",this._pointerMove)))},g.prototype.update=function(a){this._pointerUp.length=0,this._pointerDown.length=0,this._pointerMove.length=0,this._pointerCancel.length=0},g.prototype.at=function(a){if(a>=this._pointers.length)for(var b=this._pointers.length-1,c=a;b<c;b++)this._pointers.push(new h),this._activePointers.push(-1);return this._pointers[a]},g.prototype.count=function(){return this._pointers.length},g.prototype.propogate=function(b){var c=b instanceof a.UIActor,d=0,e=this._pointerUp.length;for(d;d<e;d++)b.contains(this._pointerUp[d].x,this._pointerUp[d].y,!c)&&b.eventDispatcher.emit("pointerup",this._pointerUp[d]);for(d=0,e=this._pointerDown.length,d;d<e;d++)b.contains(this._pointerDown[d].x,this._pointerDown[d].y,!c)&&b.eventDispatcher.emit("pointerdown",this._pointerDown[d]);if(b.capturePointer.captureMoveEvents)for(d=0,e=this._pointerMove.length,d;d<e;d++)b.contains(this._pointerMove[d].x,this._pointerMove[d].y,!c)&&b.eventDispatcher.emit("pointermove",this._pointerMove[d]);for(d=0,e=this._pointerCancel.length,d;d<e;d++)b.contains(this._pointerCancel[d].x,this._pointerCancel[d].y,!c)&&b.eventDispatcher.emit("pointercancel",this._pointerCancel[d])},g.prototype._handleMouseEvent=function(b,d){var e=this;return function(g){g.preventDefault();var h=g.pageX-a.Util.getPosition(e._engine.canvas).x,i=g.pageY-a.Util.getPosition(e._engine.canvas).y,j=e._engine.screenToWorldCoordinates(new a.Vector(h,i)),k=new f(j.x,j.y,0,c.Mouse,g.button,g);d.push(k),e.at(0).eventDispatcher.emit(b,k)}},g.prototype._handleTouchEvent=function(b,e){var g=this;return function(h){h.preventDefault();for(var i=0,j=h.changedTouches.length;i<j;i++){var k=g._pointers.length>1?g._getPointerIndex(h.changedTouches[i].identifier):0;if(k!==-1){var l=h.changedTouches[i].pageX-a.Util.getPosition(g._engine.canvas).x,m=h.changedTouches[i].pageY-a.Util.getPosition(g._engine.canvas).y,n=g._engine.screenToWorldCoordinates(new a.Vector(l,m)),o=new f(n.x,n.y,k,c.Touch,d.Unknown,h);e.push(o),g.at(k).eventDispatcher.emit(b,o),g._pointers.length>1&&("up"===b?g._activePointers[k]=-1:"down"===b&&(g._activePointers[k]=h.changedTouches[i].identifier))}}}},g.prototype._handlePointerEvent=function(b,c){var d=this;return function(e){e.preventDefault();var g=d._pointers.length>1?d._getPointerIndex(e.pointerId):0;if(g!==-1){var h=e.pageX-a.Util.getPosition(d._engine.canvas).x,i=e.pageY-a.Util.getPosition(d._engine.canvas).y,j=d._engine.screenToWorldCoordinates(new a.Vector(h,i)),k=new f(j.x,j.y,g,d._stringToPointerType(e.pointerType),e.button,e);c.push(k),d.at(g).eventDispatcher.emit(b,k),d._pointers.length>1&&("up"===b?d._activePointers[g]=-1:"down"===b&&(d._activePointers[g]=e.pointerId))}}},g.prototype._getPointerIndex=function(a){var b;if((b=this._activePointers.indexOf(a))>-1)return b;for(var c=0;c<this._activePointers.length;c++)if(this._activePointers[c]===-1)return c;return-1},g.prototype._stringToPointerType=function(a){switch(a){case"touch":return c.Touch;case"mouse":return c.Mouse;case"pen":return c.Pen;default:return c.Unknown}},g}(a.Class);b.Pointers=g;var h=function(a){function b(){return a.apply(this,arguments)||this}return __extends(b,a),b}(a.Class);b.Pointer=h}(b=a.Input||(a.Input={}))}(ex||(ex={}));var ex;!function(a){var b;!function(b){var c;!function(a){a[a.Num1=97]="Num1",a[a.Num2=98]="Num2",a[a.Num3=99]="Num3",a[a.Num4=100]="Num4",a[a.Num5=101]="Num5",a[a.Num6=102]="Num6",a[a.Num7=103]="Num7",a[a.Num8=104]="Num8",a[a.Num9=105]="Num9",a[a.Num0=96]="Num0",a[a.Numlock=144]="Numlock",a[a.Semicolon=186]="Semicolon",a[a.A=65]="A",a[a.B=66]="B",a[a.C=67]="C",a[a.D=68]="D",a[a.E=69]="E",a[a.F=70]="F",a[a.G=71]="G",a[a.H=72]="H",a[a.I=73]="I",a[a.J=74]="J",a[a.K=75]="K",a[a.L=76]="L",a[a.M=77]="M",a[a.N=78]="N",a[a.O=79]="O",a[a.P=80]="P",a[a.Q=81]="Q",a[a.R=82]="R",a[a.S=83]="S",a[a.T=84]="T",a[a.U=85]="U",a[a.V=86]="V",a[a.W=87]="W",a[a.X=88]="X",a[a.Y=89]="Y",a[a.Z=90]="Z",a[a.Shift=16]="Shift",a[a.Alt=18]="Alt",a[a.Up=38]="Up",a[a.Down=40]="Down",a[a.Left=37]="Left",a[a.Right=39]="Right",a[a.Space=32]="Space",a[a.Esc=27]="Esc"}(c=b.Keys||(b.Keys={}));var d=function(a){function b(b){var c=a.call(this)||this;return c.key=b,c}return __extends(b,a),b}(a.GameEvent);b.KeyEvent=d;var e=function(a){function b(b){var c=a.call(this)||this;return c._keys=[],c._keysUp=[],c._keysDown=[],c._engine=b,c}return __extends(b,a),b.prototype.on=function(b,c){a.prototype.on.call(this,b,c)},b.prototype.init=function(a){var b=this;a=a||window,a.addEventListener("blur",function(a){b._keys.length=0}),a.addEventListener("keyup",function(a){var c=b._keys.indexOf(a.keyCode);b._keys.splice(c,1),b._keysUp.push(a.keyCode);var e=new d(a.keyCode);b.eventDispatcher.emit("up",e),b.eventDispatcher.emit("release",e)}),a.addEventListener("keydown",function(a){if(b._keys.indexOf(a.keyCode)===-1){b._keys.push(a.keyCode),b._keysDown.push(a.keyCode);var c=new d(a.keyCode);b.eventDispatcher.emit("down",c),b.eventDispatcher.emit("press",c)}})},b.prototype.update=function(a){this._keysDown.length=0,this._keysUp.length=0;for(var b=0;b<this._keys.length;b++)this.eventDispatcher.emit("hold",new d(this._keys[b]))},b.prototype.getKeys=function(){return this._keys},b.prototype.wasPressed=function(a){return this._keysDown.indexOf(a)>-1},b.prototype.isHeld=function(a){return this._keys.indexOf(a)>-1},b.prototype.wasReleased=function(a){return this._keysUp.indexOf(a)>-1},b}(a.Class);b.Keyboard=e}(b=a.Input||(a.Input={}))}(ex||(ex={}));var ex;!function(a){var b;!function(b){var c=function(b){function c(a){var c=b.call(this)||this;return c.enabled=!1,c.supported=!!navigator.getGamepads,c._gamePadTimeStamps=[0,0,0,0],c._oldPads=[],c._pads=[],c._initSuccess=!1,c._navigator=navigator,c._minimumConfiguration=null,c._engine=a,c}return __extends(c,b),c.prototype.init=function(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))},c.prototype.setMinimumGamepadConfiguration=function(a){this._enableAndUpdate(),this._minimumConfiguration=a},c.prototype._enableAndUpdate=function(){this.enabled||(this.enabled=!0,this.update(100))},c.prototype._isGamepadValid=function(a){if(!this._minimumConfiguration)return!0;if(!a)return!1;var b=a.axes.filter(function(a,b,c){return void 0!==typeof a}).length,c=a.buttons.filter(function(a,b,c){return void 0!==typeof a}).length;return b>=this._minimumConfiguration.axis&&c>=this._minimumConfiguration.buttons&&a.connected},c.prototype.on=function(a,c){this._enableAndUpdate(),b.prototype.on.call(this,a,c)},c.prototype.off=function(a,c){this._enableAndUpdate(),b.prototype.off.call(this,a,c)},c.prototype.update=function(b){if(this.enabled&&this.supported){this.init();for(var c=this._navigator.getGamepads(),d=0;d<c.length;d++)if(c[d]){if(!this.at(d).connected&&this._isGamepadValid(c[d])&&this.eventDispatcher.emit("connect",new a.GamepadConnectEvent(d,this.at(d))),this.at(d).connected=!0,!c[d].timestamp||c[d].timestamp!==this._gamePadTimeStamps[d]){this._gamePadTimeStamps[d]=c[d].timestamp,this.at(d).navigatorGamepad=c[d];var g,h,i,j,k;for(g in e)h=e[g],"number"==typeof h&&c[d].buttons[h]&&(k=c[d].buttons[h].value,k!==this._oldPads[d].getButton(h)&&(c[d].buttons[h].pressed?(this.at(d).updateButton(h,k),this.at(d).eventDispatcher.emit("button",new a.GamepadButtonEvent(h,k))):this.at(d).updateButton(h,0)));for(i in f)j=f[i],"number"==typeof j&&(k=c[d].axes[j],k!==this._oldPads[d].getAxes(j)&&(this.at(d).updateAxes(j,k),this.at(d).eventDispatcher.emit("axis",new a.GamepadAxisEvent(j,k))));this._oldPads[d]=this._clonePad(c[d])}}else this.at(d).connected&&this.eventDispatcher.emit("disconnect",new a.GamepadDisconnectEvent(d)),this.at(d).connected=!1}},c.prototype.at=function(a){if(this._enableAndUpdate(),a>=this._pads.length)for(var b=this._pads.length-1,c=a;b<c;b++)this._pads.push(new d),this._oldPads.push(new d);return this._pads[a]},c.prototype.getValidGamepads=function(){this._enableAndUpdate();for(var a=[],b=0;b<this._pads.length;b++)this._isGamepadValid(this.at(b).navigatorGamepad)&&this.at(b).connected&&a.push(this.at(b));return a},c.prototype.count=function(){return this._pads.filter(function(a){return a.connected}).length},c.prototype._clonePads=function(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push(this._clonePad(a[c]));return b},c.prototype._clonePad=function(a){var b,c,e=new d;if(!a)return e;for(b=0,c=a.buttons.length;b<c;b++)a.buttons[b]&&e.updateButton(b,a.buttons[b].value);for(b=0,c=a.axes.length;b<c;b++)e.updateAxes(b,a.axes[b]);return e},c}(a.Class);c.MinAxisMoveThreshold=.05,b.Gamepads=c;var d=function(a){function b(){var b=a.call(this)||this;b.connected=!1,b._buttons=new Array(16),b._axes=new Array(4);var c;for(c=0;c<b._buttons.length;c++)b._buttons[c]=0;for(c=0;c<b._axes.length;c++)b._axes[c]=0;return b}return __extends(b,a),b.prototype.isButtonPressed=function(a,b){return void 0===b&&(b=1),this._buttons[a]>=b},b.prototype.getButton=function(a){return this._buttons[a]},b.prototype.getAxes=function(a){var b=this._axes[a];return Math.abs(b)<c.MinAxisMoveThreshold?0:b},b.prototype.updateButton=function(a,b){this._buttons[a]=b},b.prototype.updateAxes=function(a,b){this._axes[a]=b},b}(a.Class);b.Gamepad=d;var e;!function(a){a[a.Face1=0]="Face1",a[a.Face2=1]="Face2",a[a.Face3=2]="Face3",a[a.Face4=3]="Face4",a[a.LeftBumper=4]="LeftBumper",a[a.RightBumper=5]="RightBumper",a[a.LeftTrigger=6]="LeftTrigger",a[a.RightTrigger=7]="RightTrigger",a[a.Select=8]="Select",a[a.Start=9]="Start",a[a.LeftStick=10]="LeftStick",a[a.RightStick=11]="RightStick",a[a.DpadUp=12]="DpadUp",a[a.DpadDown=13]="DpadDown",a[a.DpadLeft=14]="DpadLeft",a[a.DpadRight=15]="DpadRight"}(e=b.Buttons||(b.Buttons={}));var f;!function(a){a[a.LeftStickX=0]="LeftStickX",a[a.LeftStickY=1]="LeftStickY",a[a.RightStickX=2]="RightStickX",a[a.RightStickY=3]="RightStickY"}(f=b.Axes||(b.Axes={}))}(b=a.Input||(a.Input={}))}(ex||(ex={}));var ex;!function(a){var b;!function(a){a[a.FullScreen=0]="FullScreen",a[a.Container=1]="Container",a[a.Fixed=2]="Fixed"}(b=a.DisplayMode||(a.DisplayMode={}));var c=function(c){function e(d){var f=c.call(this)||this;f._hasStarted=!1,f.debug=new a.Debug(f),f.postProcessors=[],f.scenes={},f._animations=[],f.isFullscreen=!1,f.displayMode=b.FullScreen,f.pauseAudioWhenHidden=!0,f.isDebug=!1,f.debugColor=new a.Color(255,255,255),f.backgroundColor=new a.Color(0,0,100),f.onFatalException=function(b){a.Logger.getInstance().fatal(b)},f._isSmoothingEnabled=!0,f._timescale=1,f._isLoading=!1,d=a.Util.extend({},e._DefaultEngineOptions,d);var g=new a.Detector;if(!d.suppressMinimumBrowserFeatureDetection&&!(f._compatible=g.test())){var h=document.createElement("div");if(h.innerText="Sorry, your browser does not support all the features needed for Excalibur",document.body.appendChild(h),g.failedTests.forEach(function(a){var b=document.createElement("div");b.innerText="Browser feature missing "+a,document.body.appendChild(b)}),d.canvasElementId){var i=document.getElementById(d.canvasElementId);i&&i.parentElement.removeChild(i)}return f}return f._compatible=!0,console.log&&!d.suppressConsoleBootMessage&&(console.log("%cPowered by Excalibur.js (v"+EX_VERSION+")","background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;"),console.log("\n      /| ________________\nO|===|* >________________>\n      \\|"),console.log("Visit","http://excaliburjs.com","for more information")),f._logger=a.Logger.getInstance(),f._logger.defaultLevel===a.LogLevel.Debug&&g.logBrowserFeatures(),f._logger.debug("Building engine..."),f.canvasElementId=d.canvasElementId,d.canvasElementId?(f._logger.debug("Using Canvas element specified: "+d.canvasElementId),f.canvas=document.getElementById(d.canvasElementId)):(f._logger.debug("Using generated canvas element"),f.canvas=document.createElement("canvas")),d.width&&d.height?(void 0===d.displayMode&&(f.displayMode=b.Fixed),f._logger.debug("Engine viewport is size "+d.width+" x "+d.height),f.width=d.width,f.canvas.width=d.width,f.height=d.height,f.canvas.height=d.height):d.displayMode||(f._logger.debug("Engine viewport is fullscreen"),f.displayMode=b.FullScreen),f._loader=new a.Loader,f._initialize(d),f.rootScene=f.currentScene=new a.Scene(f),f.addScene("root",f.rootScene),f.goToScene("root"),f}return __extends(e,c),Object.defineProperty(e.prototype,"fps",{get:function(){return this.stats.currFrame.fps},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stats",{get:function(){return this.debug.stats},enumerable:!0,configurable:!0}),e.prototype.on=function(a,b){c.prototype.on.call(this,a,b)},Object.defineProperty(e.prototype,"timescale",{get:function(){return this._timescale},set:function(b){return b<=0?void a.Logger.getInstance().error("Cannot set engine.timescale to a value of 0 or less than 0."):void(this._timescale=b)},enumerable:!0,configurable:!0}),e.prototype.playAnimation=function(a,b,c){this._animations.push(new d(a,b,c))},e.prototype.addTileMap=function(a){this.currentScene.addTileMap(a)},e.prototype.removeTileMap=function(a){this.currentScene.removeTileMap(a)},e.prototype.addTimer=function(a){return this.currentScene.addTimer(a)},e.prototype.removeTimer=function(a){return this.currentScene.removeTimer(a)},e.prototype.addScene=function(a,b){this.scenes[a]&&this._logger.warn("Scene",a,"already exists overwriting"),this.scenes[a]=b,b.engine=this},e.prototype.removeScene=function(b){if(b instanceof a.Scene)for(var c in this.scenes)this.scenes.hasOwnProperty(c)&&this.scenes[c]===b&&delete this.scenes[c];"string"==typeof b&&delete this.scenes[b]},e.prototype.add=function(b){return b instanceof a.UIActor?void this.currentScene.addUIActor(b):(b instanceof a.Actor&&this._addChild(b),b instanceof a.Timer&&this.addTimer(b),b instanceof a.TileMap&&this.addTileMap(b),void(2===arguments.length&&this.addScene(arguments[0],arguments[1])))},e.prototype.remove=function(b){return b instanceof a.UIActor?void this.currentScene.removeUIActor(b):(b instanceof a.Actor&&this._removeChild(b),b instanceof a.Timer&&this.removeTimer(b),b instanceof a.TileMap&&this.removeTileMap(b),b instanceof a.Scene&&this.removeScene(b),void("string"==typeof b&&this.removeScene(b)))},e.prototype._addChild=function(a){this.currentScene.add(a)},e.prototype._removeChild=function(a){this.currentScene.remove(a)},e.prototype.goToScene=function(b){if(this.scenes[b]){var c=this.currentScene,d=this.scenes[b];this._logger.debug("Going to scene:",b),this.currentScene.isInitialized&&(this.currentScene.onDeactivate.call(this.currentScene),this.currentScene.eventDispatcher.emit("deactivate",new a.DeactivateEvent(d))),this.currentScene=d,this.currentScene._initialize(this),this.currentScene.onActivate.call(this.currentScene),this.currentScene.eventDispatcher.emit("activate",new a.ActivateEvent(c))}else this._logger.error("Scene",b,"does not exist!")},e.prototype.getWidth=function(){return this.currentScene&&this.currentScene.camera?this.width/this.currentScene.camera.getZoom():this.width},e.prototype.getHeight=function(){return this.currentScene&&this.currentScene.camera?this.height/this.currentScene.camera.getZoom():this.height},e.prototype.screenToWorldCoordinates=function(b){var c=b.x,d=b.y;if(c=c/this.canvas.clientWidth*this.getWidth(),d=d/this.canvas.clientHeight*this.getHeight(),c-=this.getWidth()/2,d-=this.getHeight()/2,this.currentScene&&this.currentScene.camera){var e=this.currentScene.camera.getFocus();c+=e.x,d+=e.y}return new a.Vector(Math.floor(c),Math.floor(d))},e.prototype.worldToScreenCoordinates=function(b){var c=b.x,d=b.y;if(this.currentScene&&this.currentScene.camera){var e=this.currentScene.camera.getFocus();c-=e.x,d-=e.y}return c+=this.getWidth()/2,d+=this.getHeight()/2,c=c*this.canvas.clientWidth/this.getWidth(),d=d*this.canvas.clientHeight/this.getHeight(),new a.Vector(Math.floor(c),Math.floor(d))},e.prototype._setHeightByDisplayMode=function(a){this.displayMode===b.Container&&(this.width=this.canvas.width=a.clientWidth,this.height=this.canvas.height=a.clientHeight),this.displayMode===b.FullScreen&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.width=this.canvas.width=a.innerWidth,this.height=this.canvas.height=a.innerHeight)},e.prototype._initialize=function(c){var d=this;if(this.displayMode===b.FullScreen||this.displayMode===b.Container){var e=this.displayMode===b.Container?this.canvas.parentElement||document.body:window;this._setHeightByDisplayMode(e),window.addEventListener("resize",function(a){d._logger.debug("View port resized"),d._setHeightByDisplayMode(e),d._logger.info("parent.clientHeight "+e.clientHeight),d.setAntialiasing(d._isSmoothingEnabled)})}this.input={keyboard:new a.Input.Keyboard(this),pointers:new a.Input.Pointers(this),gamepads:new a.Input.Gamepads(this)},this.input.keyboard.init(),this.input.pointers.init(c?c.pointerScope:a.Input.PointerScope.Document),this.input.gamepads.init();var f,g;"undefined"!=typeof document.hidden?(f="hidden",g="visibilitychange"):"msHidden"in document?(f="msHidden",g="msvisibilitychange"):"webkitHidden"in document&&(f="webkitHidden",g="webkitvisibilitychange"),document.addEventListener(g,function(){document[f]?(d.eventDispatcher.emit("hidden",new a.HiddenEvent),d._logger.debug("Window hidden")):(d.eventDispatcher.emit("visible",new a.VisibleEvent),d._logger.debug("Window visible"))}),this.ctx=this.canvas.getContext("2d"),this.canvasElementId||document.body.appendChild(this.canvas)},e.prototype.setAntialiasing=function(a){this._isSmoothingEnabled=a;var b=this.ctx;b.imageSmoothingEnabled=a;for(var c=0,d=["webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled"];c<d.length;c++){var e=d[c];e in b&&(b[e]=a)}},e.prototype.getAntialiasing=function(){return this.ctx.imageSmoothingEnabled||this.ctx.webkitImageSmoothingEnabled||this.ctx.mozImageSmoothingEnabled||this.ctx.msImageSmoothingEnabled},e.prototype._update=function(b){return this._isLoading?(this._loader.update(this,b),this.input.keyboard.update(b),this.input.pointers.update(b),void this.input.gamepads.update(b)):(this.emit("preupdate",new a.PreUpdateEvent(this,b,this)),this.currentScene.update(this,b),this._animations=this._animations.filter(function(a){return!a.animation.isDone()}),this.input.keyboard.update(b),this.input.pointers.update(b),this.input.gamepads.update(b),this.eventDispatcher.emit("update",new a.PostUpdateEvent(this,b,this)),void this.emit("postupdate",new a.PostUpdateEvent(this,b,this)))},e.prototype._draw=function(b){var c=this.ctx;if(this.emit("predraw",new a.PreDrawEvent(c,b,this)),this._isLoading)return void this._loader.draw(c,b);c.clearRect(0,0,this.width,this.height),c.fillStyle=this.backgroundColor.toString(),c.fillRect(0,0,this.width,this.height),this.currentScene.draw(this.ctx,b);var d=0,e=this._animations.length;for(d;d<e;d++)this._animations[d].animation.draw(c,this._animations[d].x,this._animations[d].y);if(this.isDebug){this.ctx.font="Consolas",this.ctx.fillStyle=this.debugColor.toString();for(var f=this.input.keyboard.getKeys(),g=0;g<f.length;g++)this.ctx.fillText(f[g].toString()+" : "+(a.Input.Keys[f[g]]?a.Input.Keys[f[g]]:"Not Mapped"),100,10*g+10);this.ctx.fillText("FPS:"+this.fps.toFixed(2).toString(),10,10)}for(var h=0;h<this.postProcessors.length;h++)this.postProcessors[h].process(this.ctx.getImageData(0,0,this.width,this.height),this.ctx);this.emit("postdraw",new a.PostDrawEvent(c,b,this))},e.prototype.start=function(b){var c=this;if(!this._compatible){var d=new a.Promise;return d.reject("Excalibur is incompatible with your browser")}var f;return b?(this._loader=b,this._loader.wireEngine(this),f=this.load(this._loader)):f=a.Promise.resolve(),f.then(function(){c.emit("start",new a.GameStartEvent(c))}),this._hasStarted||(this._hasStarted=!0,this._logger.debug("Starting game..."),e.createMainLoop(this,window.requestAnimationFrame,Date.now)(),this._logger.debug("Game started")),f},e.createMainLoop=function(b,c,d){var e=d();return function f(){if(b._hasStarted)try{b._requestId=c(f),b.emit("preframe",new a.PreFrameEvent(b,b.stats.prevFrame,b));var g=d(),h=Math.floor(g-e)||1;h>200&&(h=1);var i=h*b.timescale,j=b.stats.prevFrame.id+1;
b.stats.prevFrame.reset(b.stats.currFrame),b.stats.currFrame.reset(),b.stats.currFrame.id=j,b.stats.currFrame.delta=i,b.stats.currFrame.fps=1/(i/1e3);var k=d();b._update(i);var l=d();b._draw(i);var m=d();b.stats.currFrame.duration.update=l-k,b.stats.currFrame.duration.draw=m-l,e=g,b.emit("postframe",new a.PostFrameEvent(b,b.stats.currFrame,b))}catch(a){window.cancelAnimationFrame(b._requestId),b.stop(),b.onFatalException(a)}}},e.prototype.stop=function(){this._hasStarted&&(this.emit("stop",new a.GameStopEvent(this)),this._hasStarted=!1,this._logger.debug("Game stopped"))},e.prototype.screenshot=function(){var a=new Image,b=this.canvas.toDataURL("image/png");return a.src=b,a},e.prototype.load=function(b){var c=this,d=new a.Promise;return this._isLoading=!0,b.load().then(function(){setTimeout(function(){c._isLoading=!1,d.resolve()},500)}),d},e}(a.Class);c._DefaultEngineOptions={width:0,height:0,canvasElementId:"",pointerScope:a.Input.PointerScope.Document,suppressConsoleBootMessage:null,suppressMinimumBrowserFeatureDetection:null},__decorate([a.obsolete({alternateMethod:"ex.Engine.stats.currFrame.fps"})],c.prototype,"fps",null),a.Engine=c;var d=function(){function a(a,b,c){this.animation=a,this.x=b,this.y=c}return a}()}(ex||(ex={}));
//# sourceMappingURL=excalibur.min.js.map
;
// Concatenated onto excalibur after build
// Exports the excalibur module so it can be used with browserify
// https://github.com/excaliburjs/Excalibur/issues/312
if (typeof module !== 'undefined') {module.exports = ex;}